(function () {var projects={default:{languages:["en","fr","ru","de","es","pt","it","nl","ar","ja","ko","tr","zh","pl","lv"],dictionaries:{common_json:"cleverapps/utils/localization/common_${lang}.json",project_json:"res/localization/${lang}.json"},merge:{dictionaries:{quests_json:"res/localization/quests/quests_${lang}.json"}},homefix:{dictionaries:{farm_json:"res/localization/homefix/homefix_${lang}.json"}},farm:{dictionaries:{farm_json:"res/localization/farm/farm_${lang}.json"}},solitaire:{dictionaries:{solitaire_json:"cleverapps/utils/localization/solitaire/${lang}.json"}},match3:{dictionaries:{lang_json:"match3/res/localization/match3_${lang}.json",skin_json:"match3/res/localization/skins/${skin}/${skin}_${lang}.json"}},board:{dictionaries:{lang_json:"cleverapps/utils/localization/boardgame/boardgame_${lang}.json"},languages:["en","fr","ru","de","es","it","ja","nl"]},leagues:[30,60,100,200,500,1e3,!1],terms:"https://cleverappssg.com/legal/terms.html",
privacy:"https://cleverappssg.com/legal/privacy.html"},mergecraft:{basic:{type:"merge",metha:"none",orientation:"horizontal",staticUrl:"https://mergecraft.cleverappssg.com/publish/html5/",xsollaProjectId:"134757",xsollaLoginProject:"9e48b5cc-b306-11eb-bc85-42010aa80004",fbPixelId:"321147649405995",deployment:"https://mergecraft.cleverappssg.com",title:"Mergest Kingdom: merge puzzle",fakeRestApiURL:"http://localhost:3006",lives:!0,levelEditor:!0,applixir:{accountId:5179,gameId:6359,zoneId:4187},adjust:{token:"4ck88u210vr4",purchaseToken:"2hfeqa",events:{ad_finish_rewarded:"m79fh4",ad_start_interstitial:"p0abbk",retention_2:"qa22qa",retention_7:"w2b0ti"}},stand:{staticUrl:"https://mergecraft-staging.labsystech.ru/publish/html5-staging/",deployment:"https://mergecraft-staging.labsystech.ru",xsollaLoginProject:"9b99f537-af3a-11eb-bc85-42010aa80004"},fonts:[{folder:"marvin-round-nostroke",name:"nostroke",bundle:"digits",size:62},{folder:"marvin-round",name:"default",bundle:"digits",size:45}
,{folder:"marvin-round",name:"default",bundle:"digits",size:62},{folder:"marvin-round",name:"default",bundle:"digits",size:76},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"126844939376182",rewarded:"129195502474459",interstitial:"129195289141147",groupId:"110350677808060"},facebook:{shortname:"mergecraft",appId:"365815270676633",groupId:"mergecraftgroup",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"386728805962593"}},mbga:{appId:"12026923",groupId:""},vk:{shortname:"mergecraft",appId:"7776586",groupId:"mergecraft_group",stand:{appId:"7776276"}},ok:{shortname:"mergecraft",appId:"512000742814",appKey:"CPJGFQJGDIHBABABA",groupId:"60620856950954",stand:{appId:"512000870791",appKey:"CIIKECKGDIHBABABA"}},android:{package:"com.cleverapps.mergecraft",unityGameId:""},amazon:{package:"com.cleverapps.mergecraft",id:"B0922VXRPZ"},ios:{id:"com.cleverapps.mergecraft",id:"1562149254"},mm:{appId:"783650",privateKey:"34f0c62fb0e1d0ac35d00c75acbe6cb5",
groupId:"mergecraft",stand:{appId:"",privateKey:""}},fotostrana:{appId:"mergecraft",privateKey:"33af4305d7414b380c3636f3b03fb70f",groupId:"352927",stand:{appId:"",privateKey:""}},plinga:{appId:"b5203bfef51242c39690c761321d769f"}},wondermerge:{basic:{type:"merge",metha:"none",orientation:"horizontal",title:"WonderMerge",fakeRestApiURL:"http://localhost:3012",lives:!0,levelEditor:!0,adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wondermerge-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wondermerge-staging.labsystech.ru"},fonts:[{folder:"marvin-round-nostroke",name:"nostroke",bundle:"digits",size:62},{folder:"marvin-round",name:"default",bundle:"digits",size:45},{folder:"marvin-round",name:"default",bundle:"digits",size:62},{folder:"marvin-round",name:"default",bundle:"digits",size:76},{folder:"formal",name:"formal",bundle:"admin",size:21}]},facebook:{shortname:"cleverwondermerge",appId:"699542957221997",groupId:"rachelholmesfinddifferences",
gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"597596791051962"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},mergeriddles:{basic:{type:"match3",metha:"simple",staticUrl:"https://mergecraft.cleverappssg.com/publish/html5/",deployment:"https://mergecraft.cleverappssg.com",title:"MergeRiddles",lives:!0,fakeRestApiURL:"http://localhost:3015",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://mergecraft-staging.labsystech.ru/publish/html5-staging/",deployment:"https://mergecraft-staging.labsystech.ru"}},facebook:{shortname:"mergecraft",appId:"365815270676633",groupId:"MergeCraft-Community-104474434917397",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"386728805962593"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},mergeheroes:{basic:{type:"match3",metha:"simple",staticUrl:"https://wondermerge.cleverappssg.com/publish/html5/",
deployment:"https://wondermerge.cleverappssg.com",title:"MergeHeroes",lives:!0,fakeRestApiURL:"http://localhost:3016",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wondermerge-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wondermerge-staging.labsystech.ru"}},facebook:{shortname:"cleverwondermerge",appId:"699542957221997",groupId:"WonderMerge-Community-105125691516212",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"597596791051962"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},wordheaps:{basic:{type:"board",subtype:"stacks",metha:"simple",staticUrl:"https://wordheaps.cleverappssg.com/publish/html5/",deployment:"https://wordheaps.cleverappssg.com",title:"WordHeaps",fakeRestApiURL:"http://localhost:3013",adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://wordheaps-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wordheaps-staging.labsystech.ru"
},fonts:[{folder:"neris-black",name:"default",bundle:"digits",size:40},{folder:"neris-black",name:"default",bundle:"digits",size:90},{folder:"neris-black-nostroke",name:"nostroke",bundle:"digits",size:49},{folder:"neris-black-nostroke",name:"nostroke",bundle:"digits",size:90},{folder:"formal",name:"formal",bundle:"admin",size:21}]},facebook:{shortname:"cleverwordheaps",appId:"299923727721026",groupId:"wordheapscommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"513633536223627"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},differences:{basic:{type:"differences",subtype:"knockoutGame",metha:"simple",staticUrl:"https://differences.cleverappssg.com/publish/html5/",deployment:"https://differences.cleverappssg.com",title:"Differences",fakeRestApiURL:"http://localhost:3004",lives:!0,ui:"plaidui",adjust:{token:"lmk8mnhq4xs0",purchaseToken:"pnfv7v",events:{ad_finish_rewarded:"7e3jp0",ad_start_interstitial:"txnnp5"}},stand:{
staticUrl:"https://differences-staging.labsystech.ru/publish/html5-staging/",deployment:"https://differences-staging.labsystech.ru"},fonts:[{folder:"russo_one",name:"default",bundle:"digits",size:35},{folder:"russo_one",name:"default",bundle:"digits",size:55},{folder:"russo_one-nostroke",name:"nostroke",bundle:"digits",size:35},{folder:"russo_one-nostroke",name:"nostroke",bundle:"digits",size:55},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"466070618121604",rewarded:"466072421454757",interstitial:"466072581454741",groupId:"100462882000800"},facebook:{shortname:"cleverdifferences",appId:"278637090036923",groupId:"rachelholmesfinddifferences",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"195225751884161"}},android:{package:"com.cleverapps.differences",unityGameId:""},amazon:{package:"com.cleverapps.differences",id:"B08R7PCC89"},ios:{package:"com.cleverapps.differences",id:"1546227822"},ok:{shortname:"cleverdifferences",appId:"512000594608",
appKey:"CBLDBOJGDIHBABABA",groupId:"58829738606762",stand:{appId:"512000589370",appKey:"CLDPPNJGDIHBABABA"}},vk:{shortname:"cleverdifferences",appId:"7605538",groupId:"differences_group",stand:{appId:""}},mm:{appId:"782111",privateKey:"44828036769062a2148cbf76f6bd33d6",groupId:"differences",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"",groupId:""},draugiem:{appId:"",groupId:""},fotostrana:{appId:"differences",privateKey:"5b1ff4ce4c7e274ae98bf394d8d6dd37",groupId:"352931",stand:{appId:"",privateKey:""}},plinga:{appId:"120653a94b0a48cf9050fff4a258f5cf"}},tripeaks:{basic:{type:"solitaire",metha:"simple",staticUrl:"https://tripeaks.cleverappssg.com/publish/html5/",deployment:"https://tripeaks.cleverappssg.com",title:"Kings & Queens: Solitaire Tri Peaks",fakeRestApiURL:"http://localhost:3002",lives:!0,levelEditor:!0,adjust:{token:"ng66lafe248w",purchaseToken:"6nlpft",events:{ad_finish_rewarded:"zculm1",ad_start_interstitial:"yxw2sg"}},stand:{
staticUrl:"https://tripeaks-staging.labsystech.ru/publish/html5-staging/",deployment:"https://tripeaks-staging.labsystech.ru"},leagues:[30,60,100,200,500,!1],fonts:[{folder:"carlito-bold-v2-2px",name:"default",bundle:"digits",size:35},{folder:"carlito-bold-v2-2px",name:"default",bundle:"digits",size:65},{folder:"carlito-bold-v2-nostroke",name:"nostroke",bundle:"digits",size:35},{folder:"carlito-bold-v2-nostroke",name:"nostroke",bundle:"digits",size:65},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"582264172486698",rewarded:"583410035705445",interstitial:"583409625705486",groupId:"102297708232957"},facebook:{shortname:"tripeakscard",appId:"1079919015696954",groupId:"KingsAndQueensTripeaksCommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"585880102065094"}},android:{package:"com.cleverapps.tripeaks",unityGameId:""},amazon:{package:"com.cleverapps.tripeaks",id:"B08CNK8GSB"},ios:{package:"com.cleverapps.tripeaks",id:"1523134029"},ok:{
shortname:"tripeaks",appId:"512000516286",appKey:"CPLBOMJGDIHBABABA",groupId:"58210808561834",stand:{appId:"512000567965",appKey:"COJLKNJGDIHBABABA"}},vk:{shortname:"tripeaks",appId:"7522400",groupId:"tripeaks_group",stand:{appId:"7522400"}},mm:{appId:"779517",privateKey:"f5117307f5652c346c8a492698ec5520",groupId:"tripeaks",stand:{appId:"",privateKey:""}},mbga:{appId:"12026813",groupId:""},nk:{appId:"kings-queens",groupId:"1419067"},draugiem:{appId:"",groupId:""},fotostrana:{appId:"tripeaks",privateKey:"b97e8a2478376c1d7261f87ab1b2f8aa",groupId:"352512",stand:{appId:"",privateKey:""}},plinga:{appId:"344fff78cd674f62a549533551505ebb"}},spades:{basic:{type:"solitaire",metha:"simple",lives:!0,staticUrl:"https://spades.cleverappssg.com/publish/html5/",deployment:"https://spades.cleverappssg.com",title:"Spades",fakeRestApiURL:"http://localhost:3014",languages:["en"],adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://spades-staging.labsystech.ru/publish/html5-staging/",
deployment:"https://spades-staging.labsystech.ru"}},facebook:{shortname:"cleverspades",appId:"1152275768461536",groupId:"solitairekingdomcommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"234186548097136"}},android:{package:"",unityGameId:""},amazon:{package:"",id:""},ios:{id:""}},riddles:{basic:{metha:"hose",type:"match3",lives:!0,staticUrl:"https://riddles.gcdn.co/publish/html5/",deployment:"https://riddles.labsystech.ru",results:!0,title:"Candy Riddles",fakeRestApiURL:"http://localhost:3007",levelEditor:!0,adjust:{token:"7h99civw80sg",purchaseToken:"pwy8hj",events:{}},stand:{staticUrl:"https://riddles-staging.labsystech.ru/publish/html5-staging/",deployment:"https://riddles-staging.labsystech.ru"},fonts:[{folder:"riffic-bold",name:"default",bundle:"digits",size:41},{folder:"riffic-bold",name:"default",bundle:"digits",size:82},{folder:"riffic-bold-nostroke",name:"nostroke",bundle:"digits",size:41},{folder:"riffic-bold-nostroke",name:"nostroke",bundle:"digits",
size:82},{folder:"formal",name:"formal",bundle:"admin",size:21},{folder:"custom/marvin_compact_digits",name:"compact_digits",bundle:"compact_digits",size:42},{folder:"custom/riddles_goals",name:"goals_font",bundle:"goals_font",size:41},{folder:"custom/riddles_levels",name:"level_digits",bundle:"level_digits",size:58}]},instant:{appId:"169228177248519",rewarded:"171407780363892",interstitial:"171665730338097",groupId:"337681893427623"},facebook:{shortname:"candyriddles",appId:"1996120880405386",groupId:"CandyRiddlesCommunity",gameroom_rate_postId:"140958473298826",dontLikeGameUrl_postId:"145984586129548",stand:{appId:"109585006443834"}},android:{package:"com.cleverapps.candyriddles",unityGameId:"500007109"},amazon:{package:"com.cleverapps.candyriddles",id:"B078YB7FBX"},ios:{package:"com.cleverapps.riddles",id:"1340236132"},ok:{shortname:"candyriddles",appId:"1269377792",appKey:"CBAMCKKMEBABABABA",groupId:"54360798855338",stand:{appId:"1270935552",appKey:"CBABPBMMEBABABABA"}},vk:{
shortname:"candy_riddles",appId:"6745237",groupId:"candyriddles",stand:{appId:"6790773"}},mm:{appId:"763558",privateKey:"832ab94c8979ec52da1ce740f71d7ad7",groupId:"candyriddles",stand:{appId:"763556",privateKey:"40f493f6966593a1f447980cd30bd92c"}},mbga:{appId:"12026417",groupId:"32844341"},nk:{appId:"candy-riddles",groupId:"1417264"},draugiem:{appId:"riddles",groupId:"riddlespage",stand:{appId:"riddlesstaging",groupId:"riddlespage"}},plinga:{appId:"639df47033804f18bf39e113ef29f4fa"},fotostrana:{appId:"candyriddles",privateKey:"00fcabb0bbbf4de8fd200683a099dc13",groupId:"352511",stand:{appId:"",privateKey:""}}},heroes:{basic:{metha:"farm",type:"match3",lives:!0,staticUrl:"https://heroes.gcdn.co/publish/html5/",deployment:"https://heroes.cleverappssg.com",results:!0,title:"Sugar Heroes",fakeRestApiURL:"http://localhost:3008",adjust:{token:"mmimvhbjk1z4",purchaseToken:"83oly9",events:{}},stand:{staticUrl:"https://heroes-staging.labsystech.ru/publish/html5-staging/",
deployment:"https://heroes-staging.labsystech.ru"},fonts:[{folder:"bryndanwrite",name:"default",bundle:"digits",size:53},{folder:"bryndanwrite",name:"default",bundle:"digits",size:90},{folder:"formal",name:"formal",bundle:"admin",size:21},{folder:"bryndanwrite-nostroke",name:"nostroke",bundle:"digits",size:74},{folder:"custom/marvin_compact_digits",name:"compact_digits",bundle:"compact_digits",size:42},{folder:"custom/heroes_goals",name:"goals_font",bundle:"goals_font",size:60}]},instant:{appId:"2096828893670802",rewarded:"2105178429502515",interstitial:"2105484592805232",groupId:"278630749647866"},facebook:{shortname:"sugarheroes",appId:"205918406663140",groupId:"sugarheroescommunity",gameroom_rate_postId:"",dontLikeGameUrl_postId:"283957348885460",stand:{appId:"148448049182010"}},android:{package:"com.cleverapps.heroes",unityGameId:""},amazon:{package:"com.cleverapps.heroes",id:"B07JMZLTV7"},ios:{package:"com.cleverapps.heroes",id:"1439884631"},ok:{shortname:"sugarheroes",
appId:"1271685376",appKey:"CBACGNMMEBABABABA",groupId:"54384511877290",stand:{appId:"512000694356",appKey:"CFFJJPJGDIHBABABA"}},vk:{shortname:"sugar_heroes",appId:"6830710",groupId:"sugarheroes",stand:{appId:""}},mm:{appId:"763582",privateKey:"8558918e7b85be33743d63b68ac7be00",groupId:"sugarheroes",stand:{appId:"",privateKey:""}},mbga:{appId:"12026480",groupId:"32846074"},nk:{appId:"sugar-heroes",groupId:"1417638"},draugiem:{appId:"sugarheroes",groupId:"sugarheroespage"},plinga:{appId:"b24567e39b5248eabe77a704dbb555a9"},fotostrana:{appId:"sugarheroes",privateKey:"5480cd9bf57b7ed5be7f2decf8541e18",groupId:"352509",stand:{appId:"",privateKey:""}}},adventure:{basic:{metha:"hose",type:"match3",lives:!0,rpg:!0,staticUrl:"https://adventure.gcdn.co/publish/html5/",deployment:"https://adventure.cleverappssg.com",title:"Secrets of Charmland",fakeRestApiURL:"http://localhost:3010",adjust:{token:"yxn8ttu1ydj4",purchaseToken:"2th34l",events:{ad_finish_rewarded:"804ekp",
ad_start_interstitial:"l647mw"}},stand:{staticUrl:"https://adventure-staging.labsystech.ru/publish/html5-staging/",deployment:"https://adventure-staging.labsystech.ru"},fonts:[{folder:"marvin-round",name:"default",bundle:"digits",size:45},{folder:"marvin-round",name:"default",bundle:"digits",size:62},{folder:"formal",name:"formal",bundle:"admin",size:21},{folder:"marvin-round-nostroke",name:"nostroke",bundle:"digits",size:62},{folder:"custom/marvin_compact_digits",name:"compact_digits",bundle:"compact_digits",size:42}]},instant:{appId:"228942985416996",rewarded:"228947032083258",interstitial:"228947125416582",groupId:"secretsofcharmlandlite"},facebook:{shortname:"secretsofcharmland",appId:"1311019545689756",groupId:"secretsofcharmland",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"247075149531781"}},android:{package:"com.cleverapps.adventure",unityGameId:""},amazon:{package:"com.cleverapps.adventure",id:"B08NXG74BD"},ios:{package:"com.cleverapps.adventure",
id:"1541304616"},ok:{shortname:"secretsofcharmland",appId:"512000026303",appKey:"CQLHGFJGDIHBABABA",groupId:"56035155116202",stand:{appId:"512000646929",appKey:"CCBQNOJGDIHBABABA"}},vk:{shortname:"thesecretsofcharmland",appId:"7139584",groupId:"secretsofcharmland",stand:{appId:""}},mm:{appId:"766832",privateKey:"6f8c46ea0f3720ee03b02083db09340b",groupId:"secretsofcharmland",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"secrets-of-charmland",groupId:"1419069"},draugiem:{appId:"",groupId:""},plinga:{appId:"49d17c8657104ee2806feebe41e0f2cd"}},runes:{basic:{metha:"hose",type:"match3",lives:!0,rpg:!0,staticUrl:"https://runes.gcdn.co/publish/html5/",deployment:"https://runes.cleverappssg.com",title:"Heroes of Match-3",fakeRestApiURL:"http://localhost:3011",adjust:{token:"eolgyc1elq0w",purchaseToken:"ya20wl",events:{}},stand:{staticUrl:"https://runes-staging.labsystech.ru/publish/html5-staging/",deployment:"https://runes-staging.labsystech.ru"},fonts:[{
folder:"marvin-round",name:"default",bundle:"digits",size:45},{folder:"marvin-round",name:"default",bundle:"digits",size:62},{folder:"formal",name:"formal",bundle:"admin",size:21},{folder:"marvin-round-nostroke",name:"nostroke",bundle:"digits",size:62},{folder:"custom/marvin_compact_digits",name:"compact_digits",bundle:"compact_digits",size:42}]},instant:{appId:"346516946289630",rewarded:"376156803325644",interstitial:"376156129992378",groupId:"101372134583131"},facebook:{shortname:"heroesofmatch",appId:"582954732182317",groupId:"heroesofmatch3",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"320708625483001"}},android:{package:"com.cleverapps.runes",unityGameId:""},amazon:{package:"com.cleverapps.runes",id:"B07WPW533K"},ios:{package:"com.cleverapps.runes",id:"1476535667"},ok:{shortname:"heroesofmatch",appId:"1279575808",appKey:"CBAIMFENEBABABABA",groupId:"55547515044010",stand:{appId:"512000465394",appKey:"CDPKBMJGDIHBABABA"}},vk:{shortname:"heroesofmatch",
appId:"7016437",groupId:"heroes_of_match",stand:{appId:""}},mm:{appId:"765770",privateKey:"e52e74b4f487b2cccf2405816652956c",groupId:"heroesmatch3",stand:{appId:"",privateKey:""}},mbga:{appId:"12026637",groupId:"32852303"},nk:{appId:"heroes-of-match-3",groupId:"1419068"},draugiem:{appId:"",groupId:""},plinga:{appId:"bfd6c484cdd9475f895bee03e3b633ff"}},wordsoup:{basic:{staticUrl:"https://wordsoup.gcdn.co/publish/html5/",deployment:"https://wordsoup.labsystech.ru",title:"Word Sauce",type:"board",fakeRestApiURL:"http://localhost:3000",metha:"homefix",ui:"plaidui",adjust:{token:"ez2lszhmg4xs",purchaseToken:"1ghfoq",events:{ad_finish_rewarded:"g49v7g",ad_start_interstitial:"kr85gz"}},stand:{staticUrl:"https://wordsoup-staging.labsystech.ru/publish/html5-staging/",deployment:"https://wordsoup-staging.labsystech.ru"},fonts:[{folder:"russo_one",name:"default",bundle:"digits",size:35},{folder:"russo_one",name:"default",bundle:"digits",size:55},{folder:"russo_one-nostroke",name:"nostroke",
bundle:"digits",size:35},{folder:"russo_one-nostroke",name:"nostroke",bundle:"digits",size:55},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"177170139576790",rewarded:"194546684505802",interstitial:"194552307838573",groupId:"wordsaucelite"},facebook:{shortname:"word_soup",appId:"1839614776298283",groupId:"WordSoupPuzzle",gameroom_rate_postId:"520764398277098",dontLikeGameUrl_postId:"",stand:{appId:"1847284985531262"}},android:{package:"org.cocos2dx.wordsoup",unityGameId:""},amazon:{package:"org.cocos2dx.wordsoup",id:"B07192HTZ9"},ios:{package:"org.cocos2dx.wordsoup",id:"1236153570"},ok:{shortname:"wordsoup",appId:"512000025924",appKey:"CFEGGFJGDIHBABABA",groupId:"56042597515434",stand:{appId:"512000436024",appKey:"CJDIKLJGDIHBABABA"}},vk:{shortname:"wordsoup",appId:"7139277",groupId:"wordsauce",stand:{appId:""}},mm:{appId:"766829",privateKey:"bce7dc4c706f1c0f9f53a38586ab0f14",groupId:"wordsauce",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{
appId:"word-soup",groupId:"1419071"},draugiem:{appId:"",groupId:""},plinga:{appId:"8d8965a1f1af4d2b884e0bc48737925d"},fotostrana:{appId:"wordsoup",privateKey:"ec5a95876a991b883c9c4848dde8b6d8",groupId:"352514",stand:{appId:"",privateKey:""}}},crocword:{basic:{metha:"hose",staticUrl:"https://crocword.gcdn.co/publish/html5/",deployment:"https://crocword.labsystech.ru",title:"Croc Word",type:"board",fakeRestApiURL:"http://localhost:3005",ui:"cyanui",adjust:{token:"6c299ak7zkw0",purchaseToken:"taza3r",events:{ad_finish_rewarded:"t1g1gj",ad_start_interstitial:"w692c3"}},stand:{staticUrl:"https://crocword-staging.labsystech.ru/publish/html5-staging/",deployment:"https://crocword-staging.labsystech.ru"},fonts:[{folder:"carlito-bold-v2-2px",name:"default",bundle:"digits",size:35},{folder:"carlito-bold-v2-2px",name:"default",bundle:"digits",size:65},{folder:"carlito-bold-v2-nostroke",name:"nostroke",bundle:"digits",size:35},{folder:"carlito-bold-v2-nostroke",name:"nostroke",bundle:"digits",
size:65},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"156455286289887",rewarded:"156461976289218",interstitial:"156462162955866",groupId:"1017684138380915"},facebook:{shortname:"crocword",appId:"480756825591552",groupId:"CrocwordPuzzleCommunity",gameroom_rate_postId:"365661064045146",dontLikeGameUrl_postId:"",stand:{appId:"2040725746155240"}},android:{package:"com.cleverapps.crocword",unityGameId:""},amazon:{package:"com.cleverapps.crocword",id:"B074JB1CB3"},ios:{package:"com.cleverapps.crocword",id:"1269673961"},ok:{shortname:"crocword",appId:"512000231014",appKey:"CHGHIIJGDIHBABABA",groupId:"56496148775082",stand:{appId:"512000309461",appKey:"CGNJLJJGDIHBABABA"}},vk:{shortname:"crocword",appId:"7234712",groupId:"crocwordgroup",stand:{appId:""}},mm:{appId:"768269",privateKey:"d4754dc73b088c188a115f27a6955a30",groupId:"crocwordgroup",stand:{appId:"",privateKey:""}},fotostrana:{appId:"crocword",privateKey:"f520f6ab3bd7fd0800700c49352315d5",groupId:"352327",
stand:{appId:"",privateKey:""}},mbga:{appId:"12026781",groupId:"32861692"},nk:{appId:"crocword",groupId:"1419072"},draugiem:{appId:"",groupId:""},plinga:{appId:"3e314ff40f40472f9aefed5b046f6dcc"}},magicwords:{basic:{metha:"simple",staticUrl:"https://magicwords.labsystech.ru/publish/html5/",deployment:"https://magicwords.labsystech.ru",title:"Magic Words",fakeRestApiURL:"http://localhost:3003",type:"board",adjust:{token:"",purchaseToken:"",events:{}},stand:{staticUrl:"https://magicwords-staging.labsystech.ru/publish/html5-staging/",deployment:"https://magicwords-staging.labsystech.ru"},fonts:[{folder:"russo_one",name:"default",bundle:"digits",size:35},{folder:"russo_one",name:"default",bundle:"digits",size:55},{folder:"russo_one-nostroke",name:"nostroke",bundle:"digits",size:35},{folder:"russo_one-nostroke",name:"nostroke",bundle:"digits",size:55},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"635365383471881",rewarded:"636636986678054",
interstitial:"636637626677990",groupId:"214767095976110"},facebook:{shortname:"magic_words_puzzle",appId:"116453995539327",groupId:"MagicWordsGameCommunity",gameroom_rate_postId:"424848868061655",dontLikeGameUrl_postId:"",stand:{appId:"442317226120273"}},android:{package:"com.cleverapps.magicwords",unityGameId:""},amazon:{package:"com.cleverapps.magicwords",id:"B071KKB243"},ios:{package:"com.cleverapps.magicwords",id:"1256304845"},ok:{shortname:"magic_words",appId:"512000565237",appKey:"CGPQJNJGDIHBABABA",groupId:"60937355722922",stand:{appId:"",appKey:""}},vk:{shortname:"cleverapps_magic_words",appId:"7803436",groupId:"magic_words_group",stand:{appId:""}},mm:{appId:"783608",privateKey:"dc5f9696c5a5b43246a624bb0e768f82",groupId:"magic_words",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"",groupId:""},draugiem:{appId:"",groupId:""},fotostrana:{appId:"magicwords",privateKey:"ed4e75bb8e2fd91a8842737d2daec10a",groupId:"352932",stand:{appId:"",privateKey:""}},
plinga:{appId:"bbbcbc5c5b53473f9bcabe802b2f5296"}},olympics:{basic:{staticUrl:"https://olympics.gcdn.co/publish/html5/",deployment:"https://olympics.labsystech.ru",title:"Word Olympics",type:"board",fakeRestApiURL:"http://localhost:3009",lives:!0,metha:"knockout",adjust:{token:"oq5rkne31atc",purchaseToken:"1jir4j",events:{}},stand:{staticUrl:"https://olympics-staging.labsystech.ru/publish/html5-staging/",deployment:"https://olympics-staging.labsystech.ru"},fonts:[{folder:"roboto-bold",name:"default",bundle:"digits",size:40},{folder:"roboto-bold",name:"default",bundle:"digits",size:70},{folder:"roboto-bold-nostroke",name:"nostroke",bundle:"digits",size:40},{folder:"roboto-bold-nostroke",name:"nostroke",bundle:"digits",size:70},{folder:"formal",name:"formal",bundle:"admin",size:21},{folder:"custom/marvin_compact_digits",name:"compact_digits",bundle:"compact_digits",size:42}]},instant:{appId:"403603626714071",rewarded:"404667946607639",interstitial:"404667353274365",
groupId:"803998833127843"},facebook:{shortname:"word_olympics",appId:"404908173269801",groupId:"WordOlympicsPuzzle",gameroom_rate_postId:"",dontLikeGameUrl_postId:"",stand:{appId:"144582389701216"}},android:{package:"com.cleverapps.olympics",unityGameId:""},amazon:{package:"com.cleverapps.olympics",id:"B07DGGRN8K"},ios:{package:"com.cleverapps.olympics",id:"1394966990"},ok:{shortname:"olympics",appId:"512000487372",appKey:"CNMQGMJGDIHBABABA",groupId:"57516329402562",stand:{appId:"512000563796",appKey:"CFFLJNJGDIHBABABA"}},vk:{shortname:"wordolympics",appId:"7394144",groupId:"wordolympicsgoup",stand:{appId:""}},mm:{appId:"771991",privateKey:"21595777945c95784a620c87da88c1df",groupId:"wordolympicsgroup",stand:{appId:"",privateKey:""}},mbga:{appId:"",groupId:""},nk:{appId:"crossword-online",groupId:"1419073"},draugiem:{appId:"",groupId:""},fotostrana:{appId:"olympics",privateKey:"11f5cd81d3000cdff01280a75074394a",groupId:"352515",stand:{appId:"",privateKey:""}}},scramble:{basic:{
metha:"simple",staticUrl:"https://scramble.gcdn.co/publish/html5/",deployment:"https://scramble.labsystech.ru",title:"Kitty Scramble",type:"board",subtype:"stacks",languages:["en","fr","ru","it","de","es","nl","pt","ja","ko"],fakeRestApiURL:"http://localhost:3001",levelEditor:!0,changeLevelsDisabled:!0,adjust:{token:"tyz2dqp6yt4w",purchaseToken:"iyhfum",events:{ad_finish_rewarded:"fz4ds8",ad_start_interstitial:"1yuq60",retention_2:"64jbgj",retention_7:"z519a2"}},stand:{staticUrl:"https://scramble-staging.labsystech.ru/publish/html5-staging/",deployment:"https://scramble-staging.labsystech.ru"},fonts:[{folder:"neris-black",name:"default",bundle:"digits",size:40},{folder:"neris-black",name:"default",bundle:"digits",size:90},{folder:"neris-black-nostroke",name:"nostroke",bundle:"digits",size:49},{folder:"neris-black-nostroke",name:"nostroke",bundle:"digits",size:90},{folder:"formal",name:"formal",bundle:"admin",size:21}]},instant:{appId:"170256430308082",rewarded:"170975370236188",
interstitial:"170976206902771",groupId:"kittyscramblelite"},facebook:{shortname:"kittyscramble",appId:"229294690917786",groupId:"kittyscramblecommunity",gameroom_rate_postId:"503600920012105",dontLikeGameUrl_postId:"",stand:{appId:"540455343011567"}},android:{package:"com.cleverapps.scramble",unityGameId:""},amazon:{package:"com.cleverapps.scramble",id:"B073RHS2TQ"},ios:{package:"com.cleverapps.scramble",id:"1256286028"},ok:{shortname:"kittyscramble",appId:"512000595430",appKey:"CHOGBOJGDIHBABABA",groupId:"58437883658410",stand:{appId:"512000542947",appKey:"CEOJENJGDIHBABABA"}},vk:{shortname:"kittyscramble",appId:"7559026",groupId:"kittyscramble_group",stand:{appId:""}},mm:{appId:"781640",privateKey:"ea277cd8e592c36afdc068eef84052ba",groupId:"kittyscramble",stand:{appId:"",privateKey:""}},mbga:{appId:"12026922",groupId:"32869232"},nk:{appId:"kitty-scramble",groupId:"1419070"},draugiem:{appId:"",groupId:""},plinga:{appId:"944186abe50e452dac7f0e8d3e0a8814"},fotostrana:{appId:"scramble",
privateKey:"e2f2fa801cdd8f976a50b78561587172",groupId:"352513",stand:{appId:"",privateKey:""}}}};"undefined"!=typeof exports&&(module.exports=projects);var cleverapps={bundles:{}},projectName=(config="undefined"!=typeof document&&document.ccConfig||cc.game.config).projectName;cleverapps.config=config[projectName],cleverapps.config.debugMode=config.debugMode,cleverapps.config.useStandFbAppId=config.useStandFbAppId,cleverapps.config.name=projectName,cleverapps.config.prefix=projectName,cleverapps.config.restApiURL="/"+projectName+"-rest",cleverapps.config.staticUrl=config.staticUrl||"",cleverapps.config.source=config.source,cleverapps.config.version=config.version,"match3"===cleverapps.config.type&&(match3={}),cleverapps.config.languages||(cleverapps.config.languages="board"===cleverapps.config.type?projects.default.board.languages:projects.default.languages),cleverapps.config.leagues||(cleverapps.config.leagues=projects.default.leagues),cleverapps.config.prices={prolongations:[100,300,
500,700,1e3],boosters:{0:{1:100,3:270,7:600},1:{1:150,3:400,7:900},2:{1:200,3:550,7:1200},3:{1:50},4:{1:150},5:{1:50},6:{1:100},7:{1:150},8:{1:100},9:{1:50},10:{1:50},11:{1:100},12:{1:150},13:{1:50},14:{1:100},15:{1:150}}};var projectAddedToNetwork=function(e,t,s){return!!s[e]&&(!!s[e][t]&&("android"===t?s[e][t].package:"ios"===t||"amazon"===t?s[e][t].id:s[e][t].appId))},generateNetworkLinks=function(e,t){var s={};for(var i in t[e])if(projectAddedToNetwork(e,i,t)){var n=t[e][i],o=!1;switch("undefined"==typeof exports&&(o=cleverapps.config.debugMode&&n.stand&&n.stand.appId),i){case"facebook":s.facebook=o?"https://apps.facebook.com/"+n.stand.appId:"https://apps.facebook.com/"+(n.shortname?n.shortname:n.appId);break;case"android":s.android="https://play.google.com/store/apps/details?id="+n.package;break;case"amazon":s.amazon="https://www.amazon.com/dp/"+n.id;break;case"ios":s.ios="https://apps.apple.com/app/id"+n.id;break;case"instant":s.instant=n.appId;break;case"ok":o?(
s.web_ok="https://ok.ru/game/"+n.stand.appId,s.mobile_ok="https://m.ok.ru/game/"+n.stand.appId):(s.web_ok="https://ok.ru/game/"+n.shortname,s.mobile_ok="https://m.ok.ru/game/"+n.shortname);break;case"vk":o?(s.web_vk="https://vk.com/app"+n.stand.appId,s.mobile_vk="vk://vk.com/app"+n.stand.appId):(s.web_vk="https://vk.com/"+n.shortname,s.mobile_vk="vk://vk.com/"+n.shortname);break;case"mm":o?(s.web_mm="https://my.mail.ru/apps/"+n.stand.appId,s.mobile_mm="https://m.my.mail.ru/apps/"+n.stand.appId):(s.web_mm="https://my.mail.ru/apps/"+n.appId,s.mobile_mm="https://m.my.mail.ru/apps/"+n.appId);break;case"mbga":"undefined"==typeof exports&&cleverapps.config.debugMode?s.mbga="http://sb.yahoo-mbga.jp/game/"+n.appId+"/play":s.mbga="http://yahoo-mbga.jp/game/"+n.appId+"/play",s.sp_mbga="http://sp.mbga.jp/_pf_install?game_id="+n.appId;break;case"nk":s.nk="https://nk.pl/#gry-online/"+n.appId;break;case"draugiem":s.draugiem="https://www.draugiem.lv/"+n.appId;break;case"fotostrana":
s.fotostrana=o?"https://fotostrana.ru/app/"+n.stand.appId:"https://fotostrana.ru/app/"+n.appId}}return s};if("undefined"!=typeof exports)module.exports=generateNetworkLinks;else{for(var project in cleverapps.projectLinks={},projects)cleverapps.projectLinks[project]=generateNetworkLinks(project,projects);var networkConfig=projects[projectName];for(var network in cleverapps.config.rate={urls:{}},cleverapps.config.helpURL={},cleverapps.config.dontLikeGameUrl={},networkConfig)if(projectAddedToNetwork(projectName,network,projects)){var data=networkConfig[network],useStandData=cleverapps.config.debugMode&&data.stand&&data.stand.appId;switch(network){case"facebook":config.plugin||(config.plugin={}),config.plugin.facebook={status:!0,frictionlessRequests:!0,version:"v3.3"},useStandData||cleverapps.config.useStandFbAppId?config.plugin.facebook.appId=data.stand.appId:config.plugin.facebook.appId=data.appId,cleverapps.config.facebook={url:cleverapps.projectLinks[projectName].facebook}
;var helpUrl="https://www.facebook.com/"+data.groupId;cleverapps.config.helpURL.default=helpUrl,cleverapps.config.rate.urls.gameroom=data.gameroom_rate_postId?helpUrl+"/posts/"+data.gameroom_rate_postId:helpUrl,cleverapps.config.rate.urls.facebook="https://www.facebook.com/games/manage/",cleverapps.config.dontLikeGameUrl.default=data.dontLikeGameUrl_postId?helpUrl+"/posts/"+data.dontLikeGameUrl_postId:helpUrl;break;case"android":cleverapps.config.android={url:cleverapps.projectLinks[projectName].android,unityGameId:data.unityGameId},cleverapps.config.rate.urls.android="market://details?id="+data.package;break;case"amazon":cleverapps.config.amazon={url:cleverapps.projectLinks[projectName].amazon},cleverapps.config.rate.urls.amazon="amzn://apps/android?p="+data.package,cleverapps.config.dontLikeGameUrl.amazon=!1;break;case"ios":cleverapps.config.ios={url:cleverapps.projectLinks[projectName].ios},cleverapps.config.rate.urls.ios="itms-apps://itunes.apple.com/app/id"+data.id;break
;case"instant":cleverapps.config.instantAds={rewarded:data.appId+"_"+data.rewarded,interstitial:data.appId+"_"+data.interstitial},cleverapps.config.helpURL.instant="https://www.facebook.com/"+data.groupId;break;case"ok":cleverapps.config.mobile_ok=useStandData?{url:cleverapps.projectLinks[projectName].mobile_ok,appId:data.stand.appId,appKey:data.stand.appKey}:{url:cleverapps.projectLinks[projectName].mobile_ok,appId:data.appId,appKey:data.appKey},cleverapps.config.web_ok={url:cleverapps.projectLinks[projectName].web_ok},cleverapps.config.helpURL.web_ok="https://ok.ru/group/"+data.groupId,cleverapps.config.helpURL.mobile_ok="https://m.ok.ru/group/"+data.groupId;break;case"vk":cleverapps.config.vk=useStandData?{url:cleverapps.projectLinks[projectName].web_vk,appId:data.stand.appId}:{url:cleverapps.projectLinks[projectName].web_vk,appId:data.appId},cleverapps.config.helpURL.web_vk="https://vk.com/"+data.groupId,cleverapps.config.helpURL.mobile_vk="https://m.vk.com/"+data.groupId;break
;case"mm":cleverapps.config.myMailRu=useStandData?{url:cleverapps.projectLinks[projectName].web_mm,appId:data.stand.appId,privateKey:data.stand.privateKey}:{url:cleverapps.projectLinks[projectName].web_mm,appId:data.appId,privateKey:data.privateKey},cleverapps.config.helpURL.web_mm="https://my.mail.ru/community/"+data.groupId,cleverapps.config.helpURL.mobile_mm="https://m.my.mail.ru/community/"+data.groupId;break;case"mbga":cleverapps.config.mbga={url:cleverapps.projectLinks[projectName].mbga},cleverapps.config.sp_mbga={url:data.appId+"-4"},cleverapps.config.helpURL.mbga="http://yahoo-mbga.jp/group/"+data.groupId,cleverapps.config.helpURL.sp_mbga="http://sp.mbga.jp/_grp_view?g="+data.groupId;break;case"nk":cleverapps.config.nk={url:cleverapps.projectLinks[projectName].nk},cleverapps.config.helpURL.nk="https://nk.pl/#grupa/"+data.groupId;break;case"draugiem":cleverapps.config.draugiem={url:cleverapps.projectLinks[projectName].draugiem},
cleverapps.config.helpURL.draugiem="https://www.draugiem.lv/"+data.groupId;break;case"plinga":cleverapps.config.plinga={appId:data.appId};break;case"fotostrana":cleverapps.config.fotostrana=useStandData?{url:cleverapps.projectLinks[projectName].fotostrana,appId:data.stand.appId,privateKey:data.stand.privateKey}:{url:cleverapps.projectLinks[projectName].fotostrana,appId:data.appId,privateKey:data.privateKey},cleverapps.config.helpURL.fotostrana="https://fotostrana.ru/public/"+data.groupId}}}cleverapps.getRequestParameters=function(e){var t={},s=e||window.location.search;if(s)for(var i=(s=s.substr(1)).split("&"),n=0;n<i.length;n++){var o=i[n].split("="),r=o[0],a=o[1]||"";a=decodeURIComponent(a.replace(/\+/g," ")),t[r]=a}return t},cleverapps.config.debugMode&&void 0!==cleverapps.getRequestParameters(window.location.hash).dropDebugMode&&(cleverapps.config.debugMode=!1),cleverapps.EventEmitter=function(){this.bindings={}},cleverapps.EventEmitter.prototype.on=function(t,s,e){
this.bindings[t]||(this.bindings[t]=[]),this.bindings[t].push(s);var i={clear:function(){if(this.bindings[t]){var e=this.bindings[t].indexOf(s);0<=e&&this.bindings[t].splice(e,1)}}.bind(this)};return e instanceof cc.Node&&e.registerCleanupCallback(i.clear),i},cleverapps.EventEmitter.prototype.off=function(e){this.bindings[e]=void 0},cleverapps.EventEmitter.prototype.purge=function(){this.bindings={}},cleverapps.EventEmitter.prototype.trigger=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);var s=t.shift();this.bindings[s]&&this.bindings[s].slice().forEach(function(e){e.apply(this,t)})},cleverapps.EventsQueue=function(e){this.data=[],this.interval=cleverapps.parseInterval(e)},cleverapps.EventsQueue.prototype.add=function(e){this.data.push(e),this.data.sort(),this.shrink()},cleverapps.EventsQueue.prototype.first=function(){if(this.shrink(),0<this.data.length)return this.data[0]},cleverapps.EventsQueue.prototype.shrink=function(){for(
;0<this.data.length&&this.data[0]+this.interval<=Date.now();)this.data.shift()},cleverapps.EventsQueue.prototype.getShrinkLeftTime=function(){if(0<this.data.length)return this.data[0]+this.interval-Date.now()},cleverapps.EventsQueue.prototype.size=function(){return this.shrink(),this.data.length},cleverapps.Cache=function(e){this.capacity=e||100,this.data={},this.queue=[]},cleverapps.Cache.prototype.set=function(e,t){if(!this.data[e]){var s=this.queue.indexOf(e);-1!==s&&this.queue.splice(s,1)}this.data[e]=t,this.queue.push(e),this.queue.length>this.capacity&&(e=this.queue.shift(),delete this.data[e])},cleverapps.Cache.prototype.get=function(e){return this.data[e]},cleverapps.isRumble=function(){var e=cleverapps.metha.getMainObject().knockoutGame;return e&&e.isRumble()},cleverapps.isKnockoutGame=function(){return cleverapps.metha.getMainObject().knockoutGame},cleverapps.humanReadableNumber=function(e,t){return(parseInt(e)||0)*Episode.LEVELS_PER_EPISODE+t+1},
cleverapps.humanUnReadableNumber=function(e){return{level:e%Episode.LEVELS_PER_EPISODE,episode:Math.floor(e/Episode.LEVELS_PER_EPISODE)}},cleverapps.arrayFill=function(e,t){for(var s=[],i=0;i<e;i++)s.push(t);return s},cleverapps.formatAmount=function(e){if(e<1e3)return e;var t=Math.floor(e/1e3);(e-=1e3*t)<10?e="00"+e:e<100&&(e="0"+e);return t+" "+e},cleverapps.cmp=function(e,t){return(e=JSON.stringify(e))===(t=JSON.stringify(t))},cleverapps.loadSdk=function(e,t){var s=t.onSuccess||function(){},i=t.onFailure||function(){};void 0===t.attempt&&(t.attempt=3);var n=document.createElement("script");t.crossorigin&&n.setAttribute("crossorigin","anonymous"),n.setAttribute("type","text/javascript"),n.setAttribute("src",e);var o=function(){clearTimeout(r),1<t.attempt?(document.body.contains(n)&&document.body.removeChild(n),t.attempt--,cleverapps.loadSdk(e,t)):i()}.bind(this);n.onload=function(){clearTimeout(r),s()},n.onerror=o;var r=setTimeout(o,3e4);document.body.appendChild(n)},
cleverapps.setUrlHash=function(e){var t=cleverapps.getRequestParameters(window.location.hash);for(var s in e){var i=e[s];void 0===i?delete t[s]:t[s]=i}window.location.hash=Object.keys(t).map(function(e){return e+"="+t[e]}).join("&")},cleverapps.bySource=function(e){var t,s=cleverapps.User.calcSource();return!cc.sys.isNative&&(-1<(t=navigator.userAgent||navigator.vendor||window.opera).indexOf("FBAN")||-1<t.indexOf("FBAV"))&&(s="gameroom"),e[s]?e[s]:"gameroom"===s&&e.facebook?e.facebook:e.default?e.default:void 0},cleverapps.INTERVALS={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3},cleverapps.padZeroes=function(e,t){for(var s=e+"";s.length<t;)s="0"+s;return s},cleverapps.parseInterval=function(e){var t=1e3*parseInt(e);for(var s in cleverapps.INTERVALS){if(-1!==e.indexOf(s))return t*cleverapps.INTERVALS[s]}return t},cleverapps.goalCollectSound=function(){cleverapps.audio.playSound(bundles.game.urls.goal_inc_effect,{throttle:100})},cleverapps.once=function(t){
return function(){if(t){var e=t;t=void 0,e.apply(this,arguments)}}},cleverapps.shuffle=function(e){for(var t=0;t<e.length;t++){var s=cleverapps.Random.random(e.length),i=e[t];e[t]=e[s],e[s]=i}return e},cleverapps.extractDateFromDateTime=function(e){return new Date(e).setHours(0,0,0,0)},cleverapps.extractNumber=function(e){if(e){for(var t="",s=0;s<e.length;s++){var i=e.charAt(s);i.match(/\d+/g)?t+=i:","!==i&&"."!==i||(t+=".")}return-1!==t.indexOf(".")?parseFloat(t):parseInt(t)}},cleverapps.extend=function(e,t){if(Object.assign)return Object.assign.apply(this,arguments);for(var s=1;s<arguments.length;s++)for(var i in arguments[s])e[i]=arguments[s][i];return e},cleverapps.override=function(e,t){for(var s in t){var i=e[s],n=t[s];i instanceof cc.Color?(console.log("Override color: "+s),e[s]=n):Array.isArray(i)&&Array.isArray(n)?e[s]=n:"object"==typeof i&&"object"==typeof n?cleverapps.override(i,n):e[s]=n}return e},cleverapps.increaseStylesByKoef=function(e,t){for(var s in e){var i=e[s];if(
"number"==typeof i){if(Array.isArray(e))continue;cleverapps.UI.needUpdateSizes(e,s,i)&&(e[s]*=t,e[s]=Math.round(e[s]))}else"object"==typeof i&&cleverapps.UI.needUpdateSizes(e,s,i)&&cleverapps.increaseStylesByKoef(i,t)}},cleverapps.extendStyles=function(e,t){if(t.extendStylesProcessed)return t;var s=cleverapps.overrideStyles(e,t,!0);return s.extendStylesProcessed=!0,cleverapps.extend(t,s),t},cleverapps.overrideStyles=function(e,t,s){for(var i in void 0!==e&&void 0!==t||console.log(e,t),s&&(e=cleverapps.clone(e,!0)),t){var n=e[i],o=t[i];n instanceof cc.Color||n&&n.fnt?e[i]=o:Array.isArray(n)&&Array.isArray(o)?e[i]=o:"object"==typeof n&&"object"==typeof o?cleverapps.overrideStyles(n,o):e[i]=o}return e},cleverapps.overrideColors=function(e,t){var s=function(e){return e instanceof cc.Color||cc.sys.isNative&&e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b&&void 0!==e.a};for(var i in t){var n=e[i],o=t[i];void 0===n?e[i]=o:s(n)&&s(o)?(n.r=o.r,n.g=o.g,n.b=o.b,n.a=o.a
):"object"==typeof n&&"object"==typeof o?cleverapps.overrideColors(n,o):e[i]=o}return e},cleverapps.overrideFonts=function(e,t){for(var s in t){var i=e[s],n=t[s];if(void 0===i)e[s]=n;else{if(cleverapps.config.debugMode)var o=JSON.stringify(i);if(n.size&&(i.size=n.size),n.color&&(i.color=n.color),n.scale&&(i.scale=n.scale),n.alternativeSizes&&(i.alternativeSizes=n.alternativeSizes),n.name&&(i.name=n.name),i.stroke=n.stroke,i.shadow=n.shadow,cleverapps.config.debugMode){var r=JSON.stringify(i);if(o===r)throw console.log("WAS BECOME override "+s),console.log(o,r),"Unnecessary overrideFonts: "+s}}e[s].fnt=!0}return e},cleverapps.clone=function(e,t){if(null===e)return null;if("object"!=typeof e)return e;if(e instanceof cc.Color)return cc.color(e);if(Array.isArray(e)){for(var s=[],i=0;i<e.length;i++)t?s.push(cleverapps.clone(e[i],!0)):s.push(e[i]);return s}s={};for(var n in e)if(e[n]&&e[n].fnt)s[n]=e[n];else if(t){if(e[n]instanceof cc.Node&&cleverapps.config.debugMode
)throw"clone node object with name - "+n;s[n]=cleverapps.clone(e[n],!0)}else s[n]=e[n];return s},cleverapps.accumulate=function(e,t){var s,i,n=void 0;return function(){s=this,i=arguments,void 0===n&&(n=setTimeout(function(){clearTimeout(n),n=void 0,t.apply(s,i)},e))}},cleverapps.async=function(s){return function(){var e=this,t=arguments;setTimeout(function(){s.apply(e,t)},0)}},cleverapps.extendFunc=function(s,i){return function(){var e=this._super;this._super=s;var t=i.apply(this,arguments);return this._super=e,t}},cleverapps.throttle=function(e,t,s){return s=void 0!==s?s:0,function(){s+e<Date.now()&&(s=Date.now(),t.apply(this,arguments))}},cleverapps.postpone=function(e,t){var s,i,n;return function(){s=this,i=arguments,clearTimeout(n),n=setTimeout(function(){t.apply(s,i)},e)}},cleverapps.timeredThrottle=function(s,e,i){var n,o,r;i=void 0!==i?i:0;var a=function(){void 0!==r&&(clearTimeout(r),r=void 0),o=n=void 0},c=function(){n&&o&&(e.apply(n,o),i=Date.now()),a()};return function(){a()
,n=this,o=arguments;var e=Date.now(),t=i+s-e;t<=0?c():r=setTimeout(c,t)}},cleverapps.createSet=function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},cleverapps.contains=function(t,e,s){return s=s||function(e){return e},t=cleverapps.toArray(t||[]).map(s),(e=cleverapps.toArray(e||[]).map(s)).filter(function(e){return-1!==t.indexOf(e)}).length===e.length},cleverapps.substract=function(e,t,s){s=s||function(e){return e},e=e||[];var i={};return(t=t||[]).forEach(function(e){i[s(e)]=!0}),e.filter(function(e){return void 0===i[s(e)]})},cleverapps.intersect=function(e,t){e=e||[];var s={};return(t=t||[]).forEach(function(e){s[e]=!0}),e.filter(function(e){return void 0!==s[e]})},cleverapps.unique=function(e){if("undefined"!=typeof Set&&"function"==typeof Array.from)return Array.from(new Set(e));var t={},s=[];return e.forEach(function(e){!0!==t[e]&&(s.push(e),t[e]=!0)}),s},cleverapps.values=function(e){if(!e)return[];if(Object.values)return Object.values(e);var t=[];for(var s in e)t.push(
e[s]);return t},cleverapps.callFunc=function(e){e()},cleverapps.intervalToString=function(e,t){void 0===t&&(t=!0);var s=(e=Math.ceil(e/1e3))%60,i=(e=Math.floor(e/60))%60,n=Math.floor(e/60);if(s<10&&(s="0"+s),i<10&&(i="0"+i),24<n||24===n&&(0<i||0<s)){var o=Math.floor(n/24);return n%=24,Messages.get("dayTimeString",{day:o,hr:n})}return!t&&n<=24&&0<n?Messages.get("hoursMinutesString",{hr:n,min:i}):(n<10&&(n="0"+n),(t?n+":":"")+i+":"+s)},cleverapps.isLevels=function(){return cleverapps.metha.getType()!==Metha.NONE},cleverapps.isStaging=function(){return!cc.sys.isNative&&cleverapps.config.debugMode&&!cleverapps.isLocalhost()},cleverapps.isLocalhost=function(){return!cc.sys.isNative&&("localhost"===location.host||"127.0.0.1"===location.host||0===location.host.indexOf("192.168."))},cleverapps.isStagingHost=function(){return-1!==location.host.indexOf("staging.labsystech.ru")},cleverapps.isInstant=function(){return"instant"===cc.game.config.source},cleverapps.isOkApp=function(){
var e=!cc.sys.isNative&&window&&window.navigator&&window.navigator.userAgent;return e&&0<=e.indexOf("OkApp")},cleverapps.checkStatus=function(e,t){return Array.isArray(t)||(t=[t]),Array.isArray(e)?0<e.filter(function(e){return cleverapps.checkStatus(e,t)}.bind(this)).length:-1!==t.indexOf(e)||e&&e.errorMessage&&e.errorMessage.status&&-1!==t.indexOf(e.errorMessage.status)},cleverapps.toArray=function(e){return Array.isArray(e)||null==e?e:[e]},cleverapps.wait=function(e,t){if(0!==e){var s=0;return function(){++s===e&&t()}}t()},cleverapps.waitNoMore=function(e,t){var s=setTimeout(function(){console.log("waitNoMore timeout: "+e),s=void 0,t()},e);return function(){void 0!==s&&(clearTimeout(s),t())}},cleverapps.doubleReward=function(e){if(void 0!==e.gold&&(e.gold*=2),void 0!==e.boosters)for(var t in e.boosters)e.boosters[t]*=2;return void 0!==e.exp&&(e.exp*=2),void 0!==e.stars&&(e.stars*=2),void 0!==e.lives&&(e.lives*=2),e},cleverapps.throwAsync=function(e,t){e=e+" "+JSON.stringify((
t||new Error).stack),setTimeout(function(){throw e},0)},cleverapps.isNumber=function(e){return"string"==typeof e&&e&&/^[0-9]+$/.test(e)||"number"==typeof e&&!isNaN(e)},cleverapps.castType=function(e){return"string"==typeof e&&cleverapps.isNumber(e)?parseInt(e):e},cleverapps.rangeArray=function(e,t){for(var s=[],i=e;i<=t;i++)s.push(i);return s},cleverapps.splitToChunks=function(e,t){for(var s=Math.ceil(e.length/t),i=[];0<e.length;)i.push(e.splice(0,s));return i},cleverapps.sign=function(e){return e<0?-1:0<e?1:0};var OverridesContainer=function(){this.overrides=[]};OverridesContainer.prototype.override=function(e,t,s){if(e){var i=e[t];e[t]=s,this.overrides.push({target:e,key:t,value:s,oldValue:i})}},OverridesContainer.prototype.unoverride=function(){var e=this.overrides;this.overrides=[],e.forEach(function(e){e.target[e.key]=e.oldValue})},void 0===Array.prototype.find&&Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw TypeError(
'"this" is null or not defined');var t=Object(this),s=t.length>>>0;if("function"!=typeof e)throw TypeError("predicate must be a function");for(var i=arguments[1],n=0;n<s;){var o=t[n];if(e.call(i,o,n,t))return o;n++}},configurable:!0,writable:!0}),cleverapps.EXCHANGE_RATES={EUR:.9,RUB:64.23,GBP:.79,DEM:1.77,JPY:108.31,INR:70.86,FRF:5.95,CAD:1.32,AUD:1.47,BEF:36.58},cleverapps.NO_ACTION="no_action",cleverapps.ONE_HOUR=cleverapps.parseInterval("1 hour"),cleverapps.ONE_DAY=cleverapps.parseInterval("1 day");var ResourceProcessor={addStaticUrl:function(){var e,s=function(e){return"string"==typeof e&&-1!==[".plist",".atlas"].indexOf(cc.path.extname(e))},n=function(e,t){if("string"==typeof e&&"@"===e.charAt(0))return e;if("string"==typeof e&&-1===e.indexOf(t))return t+e;if("font"===e.type)return e.srcs=e.srcs.map(function(e){return n(e,t)}),e;if("object"==typeof e){var s={};for(var i in e)s[i]=n(e[i],t);return s}return e},t=cleverapps.config,i=Object.keys(bundles);for(var o in i){var r=i[o],
a=bundles[r],c=t.staticUrl,l="";if(cc.sys.isNative&&(c="",l=t.staticUrl.replace("html5-staging","external-staging").replace("html5","external")),c||l)for(var o in a.urls){var p=a.urls[o],d=a.external&&("string"==typeof(e=p)&&-1!==[".png",".jpg"].indexOf(cc.path.extname(e)))&&l||c;d&&(a.urls[o]=n(p,d))}c&&Object.keys(a.jsons).forEach(function(e){var t;(s(a.jsons[e])||"string"==typeof(t=a.jsons[e])&&-1!==[".json"].indexOf(cc.path.extname(t))&&"levels"===e&&a.urls.levels)&&(a.jsons[e]=n(a.jsons[e],c))}),Object.keys(a.urls).forEach(function(e){s(a.urls[e])&&(a.jsons[e]=a.urls[e])})}},calcProbablyNeed:function(){var e=["main","transition","language_"+cleverapps.settings.language],t=cleverapps.Plot.onStartup(void 0,!0),s=[];"object"==typeof t&&(s=t.options,t=t.scene);var i=cleverapps.bundleLoader.getClassBundles(t,this,s);return e=e.concat(i),cleverapps.config.debugMode&&e.push("dev_resources"),e=(e=cleverapps.unique(e)).filter(function(e){return void 0!==bundles[e]&&!bundles[e].noCache})}},
bundles={avatar:{urls:{},injectTo:["main"],frameIds:["%n_frame","%n_frame2"],jsonIds:[],soundIds:[],unpackedIds:[]},battle_pass:{urls:{png:"@%n-03d5672804.png",json:"@%n-3467bcb067.json"},jsons:{ticket_json:"@jsons/battlepass_ticket-56dc4d77d4.json",plist:"@%n-03d5672804.plist",atlas:"@%n-03d5672804.atlas"},frames:{progress_gradient:"#%n-gradient_goldpass.png",progress_lines:"#%n-batlepass_brown.png",progress_bar:"#%n-goldpass_bar.png",progress_substrate:"#%n-goldpass_bar_bg.png",progress_arrows:"#%n-goldpass_bar_scala.png",progress_star:"#%n-goldpass_star.png",ticket_background:"#%n-under_bg_goldpass.png",description_background:"#%n-under_worker_batlepass.png",build_task_icon:"#%n-worker_batlepass.png",shining:"#%n-blik_pass.png",timer_substrate:"#%n-timer_substrate.png",timer_icon:"#%n-timer_icon.png",guide_button_png:"#%n-guide_button.png",guide_button_on_png:"#%n-guide_button_on.png",offer_badge:"#%n-offer_badge.png",icon_background:"#%n-icon_background.png",
icon_ribbon:"#%n-icon_ribbon.png",gold_small_png:"#%n-reward_icons-ruby_small.png",reward_gold_png:"#%n-reward_icons-ruby.png",coin_small_png:"#%n-reward_icons-coin_small.png",reward_coin_png:"#%n-reward_icons-coin.png",reward_exp_png:"#%n-reward_icons-exp.png",reward_wand_png:"#%n-reward_icons-wand.png",reward_worker_png:"#%n-reward_icons-worker.png",reward_energy_png:"#%n-reward_icons-energy.png",shop_energy_png:"#%n-reward_icons-energy_shop.png",shop_gold_png:"#%n-reward_icons-ruby_shop.png",shop_coin_png:"#%n-reward_icons-coin_shop.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",
nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",
default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",
default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},beatfriendwindow:{urls:{png:"@%n-9cd2fd2bb8.png",json:"@%n-c5a6085512.json"},jsons:{
plist:"@%n-9cd2fd2bb8.plist"},frames:{beat_friend_bg_png:"#%n-windows-beat_friend_bg.png"}},bonus_round_window:{urls:{}},bonus_world_easter:{urls:{png:"@%n-fcfdda61f6.png",json:"@%n-be5c1c72a3.json"},jsons:{plist:"@%n-fcfdda61f6.plist"},frames:{nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",
nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",
default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",
default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},bonus_world_summer:{urls:{png:"@%n-dfd1f77da1.png",json:"@%n-bcd901c03f.json"},jsons:{plist:"@%n-dfd1f77da1.plist"},frames:{nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",
nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",
default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",
default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",
default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},bonus_world_valentines:{urls:{png:"@%n-c705f0107c.png",json:"@%n-3cb2851652.json"},jsons:{plist:"@%n-c705f0107c.plist"},frames:{nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",
nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",
default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",
default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},bonusworkerwindow:{urls:{},injectTo:["main"],frameIds:["info_background","timer_substrate","sanglass_timer_icon"],jsonIds:[],soundIds:[],unpackedIds:[]},boosters_before:{urls:{},injectTo:["main"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},boosters_sale:{urls:{}},browser_resources:{urls:{left_bg:"@left_bg-f3a9f3f672.jpg",right_bg:"@right_bg-1c7fd1cdaf.jpg"}},
buildable:{urls:{},injectTo:["game"],frameIds:["%n_exclamation"],jsonIds:["%n_below_json","%n_above_json"],soundIds:["build_start_effect","build_finish_effect"],unpackedIds:[]},buttons:{urls:{},injectTo:["game","main"],frameIds:["window_button_png","window_button_on_png","window_button_disabled_png","blue_button_png","blue_button_on_png","small_blue_button","small_blue_button_on"],jsonIds:[],soundIds:[],unpackedIds:[]},buttons_main:{urls:{},injectTo:["main"],frameIds:["window_close_png","window_close_on_png","blue_button_png","blue_button_on_png","help_button_png","help_button_on_png","exit_button_icon","scene_exit_button","small_green_button","small_green_button_on","small_blue_button","small_blue_button_on","music_off_png","music_on_png","sound_off_png","sound_on_png","close_small","close_small_on","red_button","red_button_on"],jsonIds:[],soundIds:[],unpackedIds:[]},buyfogwindow:{urls:{png:"@%n-ce58a9e324.png",json:"@%n-c252617a74.json"},jsons:{
island_items_json:"@jsons/mediterranean_cay-3db7e4bcea.json",plist:"@%n-ce58a9e324.plist",atlas:"@%n-ce58a9e324.atlas"},frames:{button_block:"#%n-orderswindow-icon_background.png"}},castle:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n_animation_json"],soundIds:[],unpackedIds:[]},centerhint:{urls:{},injectTo:["main"],frameIds:["worker_hint_png"],jsonIds:[],soundIds:[],unpackedIds:[]},chat:{urls:{window_bg:"@window_bg-122eed08e5.jpg",strict_font_ttf:{type:"font",name:"Rubic",srcs:["~%n/all/font.ttf","~%n/all/font.eot"]},png:"@%n-9cc19994c6.png",json:"@%n-1293cae7d7.json"},jsons:{plist:"@%n-9cc19994c6.plist"},frames:{dialog_box_green:"#%n-dialog_box.png",dialog_box_white:"#%n-dialog_box_2.png",icon_back:"#%n-icon_back.png",panel_off:"#%n-panel_off.png",panel_on:"#%n-panel_on.png",panelup:"#%n-panelup.png",paneldown:"#%n-paneldown.png",textbox:"#%n-textbox.png",checkmark_tmp:"#%n-checkmark_0.png",checkmark_sent:"#%n-checkmark_1.png",checkmark_read:"#%n-checkmark_2.png",
checkmark_gift:"#%n-checkmark_yes.png",gift_bg:"#%n-gift_bg.png",accept_button:"#%n-button_accept.png",accept_button_on:"#%n-button_accept_press.png",no_button:"#%n-no_button.png",no_button_on:"#%n-no_button_press.png"}},chests:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["chest_animation_json"],soundIds:[],unpackedIds:[]},coins_time:{urls:{png:"@%n-078653152f.png",json:"@%n-e054ed831c.json"},jsons:{plist:"@%n-078653152f.plist"},frames:{gold_and_hammer:"#%n-coinstime-coinstime.png"}},collectible:{urls:{},injectTo:["game"],frameIds:[],jsonIds:[],soundIds:["fruit_fly_finish_effect","coins_fly_finish_effect","wand_fly_finish_effect","exp_fly_finish_effect"],unpackedIds:[]},combo_background:{urls:{},injectTo:["game"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},confirmexit_window:{urls:{}},controlbuttons:{urls:{},injectTo:["game","main"],frameIds:["menu_icon_png","button_png","button_on_png","fullscreen_icon_png","back_button_png","back_button_on_png","back_icon_png"],jsonIds:[],
soundIds:[],unpackedIds:[]},cryptex:{urls:{}},daily_cup:{urls:{}},daily_minigame_window:{urls:{}},dailytasks:{urls:{png:"@%n-c214068797.png",json:"@%n-d0c76baa61.json"},jsons:{plist:"@%n-c214068797.plist"},frames:{daily_task_icon_0_png:"#%n-dailytask_fb_icon.png",daily_task_icon_1_png:"#%n-icon1.png",daily_task_icon_2_png:"#%n-icon2.png",daily_task_icon_3_png:"#%n-icon3.png",daily_task_icon_4_png:"#%n-level_open.png",daily_task_icon_6_png:"#%n-free_moves_friends.png",daily_task_icon_7_png:"#%n-adicon.png",daily_task_icon_13_png:"#%n-coin_task.png",daily_task_icon_17_png:"#%n-hint_task.png",daily_task_icon_19_png:"#%n-episode_task.png",daily_task_icon_20_png:"#%n-gift_task.png",daily_task_icon_22_png:"#%n-overtake_task.png",daily_task_icon_23_png:"#%n-bonus_task.png",missions_easy_bg_png:"#%n-mission-easy_frame_1.png",missions_medium_bg_png:"#%n-mission-medium_frame_1.png",missions_hard_bg_png:"#%n-mission-hard_frame_1.png",missions_frame_white_png:"#%n-mission-frame_white.png",
missions_frame_green_png:"#%n-mission-frame_green.png",daily_task_icon_bg_png:"#%n-dailytask_icon_bg.png",daily_task_missions_easy_top_png:"#%n-mission-easy_top_1.png",daily_task_missions_medium_top_png:"#%n-mission-medium_top_1.png",daily_task_missions_hard_top_png:"#%n-mission-hard_top_1.png"}},dialogues:{urls:{},injectTo:["main"],frameIds:["bg_png","dialogue_name","arrow_png","bg_minimal_png"],jsonIds:["default_json","worker_json","dwarf_json","king_json","bear_json","elf_json","warlock_json","troll_json","miner_json","seller_json","knight_json"],soundIds:[],unpackedIds:[]},dialogues_minimal:{urls:{png:"@%n-c9193c9342.png",json:"@%n-8e7a8a7cb9.json"},jsons:{dialogue_minimal_json:"@jsons/dwarf_minimal-de8f7ab500.json",worker_minimal_json:"@jsons/worker_minimal-371af214fc.json",dwarf_minimal_json:"@jsons/dwarf_minimal-de8f7ab500.json",king_minimal_json:"@jsons/king_minimal-58263414df.json",bear_minimal_json:"@jsons/bear_minimal-c0a1142c83.json",
elf_minimal_json:"@jsons/elf_minimal-6aa3492faa.json",warlock_minimal_json:"@jsons/warlock_minimal-01d7adcdfb.json",troll_minimal_json:"@jsons/troll_minimal-e250aba704.json",knight_minimal_json:"@jsons/knight_minimal-9f726e2dc0.json",plist:"@%n-c9193c9342.plist",atlas:"@%n-c9193c9342.atlas"},frames:{bg_minimal_png:"#%n-dialogues-bg.png"}},digits:{urls:{},injectTo:["slot_machine","battle_pass","minesweeper","bonus_world_summer","bonus_world_easter","bonus_world_valentines","admin","tile_shop","game","main"],frameIds:["nostroke62pt_0","nostroke62pt_1","nostroke62pt_2","nostroke62pt_3","nostroke62pt_4","nostroke62pt_5","nostroke62pt_6","nostroke62pt_7","nostroke62pt_8","nostroke62pt_9","nostroke62pt_colon","nostroke62pt_slash","nostroke62pt_plus","nostroke62pt_minus","nostroke62pt_x","nostroke62pt_space","default45pt_0","default45pt_1","default45pt_2","default45pt_3","default45pt_4","default45pt_5","default45pt_6","default45pt_7","default45pt_8","default45pt_9","default45pt_colon",
"default45pt_slash","default45pt_plus","default45pt_minus","default45pt_x","default45pt_space","default45pt_asterisk","default62pt_0","default62pt_1","default62pt_2","default62pt_3","default62pt_4","default62pt_5","default62pt_6","default62pt_7","default62pt_8","default62pt_9","default62pt_colon","default62pt_slash","default62pt_plus","default62pt_minus","default62pt_x","default62pt_space","default62pt_asterisk","default76pt_0","default76pt_1","default76pt_2","default76pt_3","default76pt_4","default76pt_5","default76pt_6","default76pt_7","default76pt_8","default76pt_9","default76pt_colon","default76pt_slash","default76pt_plus","default76pt_minus","default76pt_x","default76pt_space","default76pt_asterisk"],jsonIds:[],soundIds:[],unpackedIds:[]},discreteprogress:{urls:{},injectTo:["game"],frameIds:["dp_background","dp_stroke","dp_progress_0","dp_progress_1","dp_progress_2","dp_progress_3","dp_background_small","dp_stroke_small","dp_progress_0_small","dp_progress_1_small",
"dp_progress_2_small","dp_progress_3_small"],jsonIds:[],soundIds:[],unpackedIds:[]},easter:{urls:{}},energy_feast:{urls:{png:"@%n-b694124b20.png",json:"@%n-5dfbf0fa66.json"},jsons:{feast_mission_board:"@jsons/feastmissionboard-6af0eadf5e.json",big_energy_bug_json:"@jsons/energy_bug-0af0c6bae3.json",medium_energy_bug_json:"@jsons/energy_bug_midle-801209cdf5.json",small_energy_bug_json:"@jsons/energy_bug_mini-971b2ccf2d.json",big_coins_bug_json:"@jsons/coins_bug-934bfd0733.json",medium_coins_bug_json:"@jsons/coins_bug_midle-22656bac20.json",small_coins_bug_json:"@jsons/coins_bug_mini-3642ad4e05.json",plist:"@%n-b694124b20.plist",atlas:"@%n-b694124b20.atlas"},frames:{energy_reward:"#%n-feastmissionwindow-rewards_energy.png",coins_reward:"#%n-feastmissionwindow-rewards_coins.png"}},energy_time:{urls:{png:"@%n-5a976acaeb.png",json:"@%n-1878181b24.json"},jsons:{jinn_json:"@jsons/jinn-78433219cf.json",plist:"@%n-5a976acaeb.plist",atlas:"@%n-5a976acaeb.atlas"},frames:{energy:"#%n-%n_icon.png"}
},energylotterywindow:{urls:{open_lot_effect:"~sounds/lottery_open-9b80fced7f.mp3",png:"@%n-6bd5925a2f.png",json:"@%n-c0fefa67a2.json"},jsons:{energy_lottery_json:"@jsons/lottery_window-e23d1bab1e.json",energy_lottery_icon_json:"@jsons/lottery_target-058e7bc2c4.json",energy_lottery_axe_json:"@jsons/lottery_target_axe-8b315d2d86.json",atlas:"@%n-6bd5925a2f.atlas"}},energyup:{urls:{},injectTo:["game"],frameIds:["button_energy_png"],jsonIds:[],soundIds:[],unpackedIds:[]},episode_0:{urls:{json:"~%n/all/%n-20968405c5.json"},jsons:{levels:"~%n/all/jsons/0-fed680372c.json"},episodeNo:0,levelsAmount:1,hard:[],tricky:[],language:"en"},episode_ads:{urls:{json:"~%n/all/%n-6faa56b90b.json"},jsons:{levels:"~%n/all/jsons/ads-ef7ee45014.json"},episodeNo:"ads",levelsAmount:75,hard:[],tricky:[],language:"en"},episode_coming_soon:{urls:{},levelPositions:"levels_1"},episode_editor:{urls:{json:"~%n/all/%n-fc283e41ec.json"},jsons:{levels:"~%n/all/jsons/editor-4b313b1748.json"},episodeNo:"editor",
levelsAmount:1,hard:[],tricky:[],language:"en"},episode_ice:{urls:{json:"~%n/all/%n-3632f281fa.json"},jsons:{levels:"~%n/all/jsons/ice-3cf54a4144.json"},episodeNo:"ice",levelsAmount:1,hard:[],tricky:[],language:"en"},episode_purple:{urls:{json:"~%n/all/%n-abf8df6885.json"},jsons:{levels:"~%n/all/jsons/purple-80fa375ea7.json"},episodeNo:"purple",levelsAmount:2,hard:[],tricky:[],language:"en"},episode_sand:{urls:{json:"~%n/all/%n-41bd61f2e1.json"},jsons:{levels:"~%n/all/jsons/sand-7a9482f47f.json"},episodeNo:"sand",levelsAmount:1,hard:[],tricky:[],language:"en"},episode_tests:{urls:{json:"~%n/all/%n-06644edfed.json"},jsons:{levels:"~%n/all/jsons/tests-22c5e6a1ea.json"},episodeNo:"tests",levelsAmount:16,hard:[],tricky:[],language:"en"},exclamations:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["animation"],soundIds:[],unpackedIds:[]},extrawindow:{urls:{}},favorite_sale:{urls:{png:"@%n-6685027b50.png",json:"@%n-b6b550b0ff.json"},jsons:{plist:"@%n-6685027b50.plist"},frames:{
plus_png:"#%n-plus_big.png"}},finger:{urls:{},injectTo:["game","main"],frameIds:["tutorial_click_png","tutorial_hand_png"],jsonIds:[],soundIds:[],unpackedIds:[]},finish_episode_0:{urls:{episode_finish_image:{}}},finish_episode_0_ru:{urls:{episode_finish_image:{}}},finish_episode_1:{urls:{episode_finish_image:{}}},finish_episode_1_ru:{urls:{episode_finish_image:{}}},finish_episode_window:{urls:{}},fireworks:{urls:{}},flying:{urls:{},injectTo:["game"],frameIds:["%n_coin_png","%n_energy_png","%n_wand_png","%n_ruby_png","%n_exp_png"],jsonIds:[],soundIds:[],unpackedIds:[]},fog:{urls:{},injectTo:["game"],frameIds:["%n_png","%n_down_left_png","%n_down_right_png","%n_up_left_png","%n_up_right_png","%n_blocker_png","%n_blocker_cloud_png","button_wand_png"],jsonIds:[],soundIds:[],unpackedIds:[]},fruit:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n_growing_json","%n_ripe_json","%n_ready_json"],soundIds:[],unpackedIds:[]},game:{urls:{background_music_game:"~sounds/music-ec69870ba2.mp3",
merge_effect:"~sounds/merge-e4e5546e39.mp3",new_order_effect:"~sounds/new_order-5c4e628f54.mp3",prize_view_created_effect:"~sounds/prize_view_created-2ab1bf8cfb.mp3",spawn_start_effect:"~sounds/spawn_start-2a94083a1c.mp3",spawn_landing_effect:"~sounds/spawn_landing-7a01ef36e5.mp3",spawn_fail_effect:"~sounds/spawn_fail-fdaf8d74be.mp3",spawn_beetle_effect:"~sounds/beetles_collect-45552f26d7.mp3",specialoffer_appearance_effect:"~sounds/merchant_appearance-2b35d35856.mp3",specialoffer_window_effect:"~sounds/merchant_window-bed8e8d86f.mp3",specialoffer_buying_effect:"~sounds/build_finish-b77cae7e58.mp3",specialoffer_destruction_effect:"~sounds/merchant_disappearance-afcf5922f0.mp3",specialoffer_helicopter_effect:"~sounds/helicopter-e232bb32d1.mp3",instantworker_build_effect:"~sounds/build_robot-aad7453d1d.mp3",unit_desturction_effect:"~sounds/remove_thing-91a578ee13.mp3",coins_drop_effect:"~sounds/coins_drop-887037b04e.mp3",upgradable_build_effect:"~sounds/build_castle-506cac56a5.mp3",
pixel_fly_effect:"~sounds/beetles-be60a9cb4f.mp3",pixel_spawn_effect:"~sounds/beetles_emergence-5aaae60895.mp3",barrel_appear_sfx:"~sounds/barrel-ef78b26e8a.mp3",particle_texture:"@particle_texture-1f5ee453a5.png",build_start_effect:"~sounds/build_start-89fef2be77.mp3",build_finish_effect:"~sounds/build_finish-b77cae7e58.mp3",mining_start_effect:"~sounds/mining_ground_start-d433e147de.mp3",mining_wood_start_effect:"~sounds/mining_wood_start-53bf2d0df8.mp3",mining_stone_start_effect:"~sounds/mining_stone_start-f5be5d43a5.mp3",mining_wagon_start_effect:"~sounds/mining_metal_start-d3cc3f14da.mp3",fruit_fly_finish_effect:"~sounds/fruit_fly-1545a6f0d2.mp3",coins_fly_finish_effect:"~sounds/coins_fly-48c8f148ba.mp3",wand_fly_finish_effect:"~sounds/wand_fly-532f1d572a.mp3",exp_fly_finish_effect:"~sounds/progress_fly-a84efaa03e.mp3",png:"@%n-682f9e4868.png",json:"@%n-ccc74391be.json"},jsons:{hint_button_arrow_json:"@jsons/hint_button_arrow-008e7a2d92.json",
coins_reward_json:"@jsons/coins_reward-9f92bd9090.json",crown_json:"@jsons/level_crown-e904aad65e.json",pack_icon_json:"@jsons/icon_pack1-7fbeaf6294.json",pack1_icon_json:"@jsons/icon_pack2-8762a7422b.json",pack2_icon_json:"@jsons/icon_pack3-83801f7d10.json",premium_icon_json:"@jsons/icon_premium-66e0e30c1f.json",energy_feast_icon_json:"@jsons/energy_tournament-0c6bde045e.json",coins_feast_icon_json:"@jsons/coins_tournament-b344f62a3c.json",battlepass_icon_json:"@jsons/battlepass_icon-9b2581bfc4.json",coins_time_icon_json:"@jsons/coinstime_icon-d55a09a2da.json",energy_time_icon_json:"@jsons/energybox-bc83107f5f.json",orders_json:"@jsons/orders_icon-3704aded22.json",units_shop_json:"@jsons/market_icon-b2c01578b1.json",units_library_json:"@jsons/units_icon-b7f7e718c4.json",animation:"@jsons/exclamation-35af20d755.json",recipe_bubble_down_json:"@jsons/artifacts_fx_down-1267ba4947.json",recipe_bubble_up_json:"@jsons/artifacts_fx_up-d925abbab0.json",
change_stage_cloud_json:"@jsons/change_stage_cloud-75b91d9cc3.json",appearance_json:"@jsons/appearance-9e5ca9f3e9.json",destruction_json:"@jsons/destruction-921b98d783.json",reward_highlight_json:"@jsons/reward_highlight-301f6517a1.json",flickering_json:"@jsons/flickering-4e399f86fb.json",merge_json:"@jsons/merge_effect-36644caa10.json",hint_json:"@jsons/hint-72b78cc889.json",rays_json:"@jsons/rays-3e73ee9a62.json",pixels_json:"@jsons/bug-6941ca9c25.json",adsbarrel_json:"@jsons/barrel-c505763d4c.json",bonus_shining_json:"@jsons/bonus_shining-b92e59c120.json",specialoffer_helicopter_json:"@jsons/specialoffer_helicopter-9a5c4aee75.json",battle_star:"@jsons/batlepass_star-91902393b4.json",prize_shining_json:"@jsons/prize_shining-76ce817bdc.json",particles_drag_json:"~%n/all/jsons/particle_drag-fe3c84b9a8.json",particles_spawn_json:"~%n/all/jsons/particle_spawn-f85df30f5d.json",particles_collect_json:"~%n/all/jsons/particle_collect-0ca24e371d.json",
levelup_path_json:"~%n/all/jsons/levelup_path-47ce4f0d5b.json",buildable_below_json:"@jsons/building_completion_down-5e32ffeee2.json",buildable_above_json:"@jsons/building_completion_up-965cd41bbc.json",mining_start_json:"@jsons/dwarf-fe7fb74f18.json",timer_json:"@jsons/sandglass-5ec0151b4c.json",fruit_growing_json:"@jsons/growing_plant-7134cde171.json",fruit_ripe_json:"@jsons/ripe_plant-13509ffc59.json",fruit_ready_json:"@jsons/fruit_ready-a0e953db7c.json",castle_animation_json:"@jsons/castle_animation-76ec3dd840.json",shine_animation_json:"@jsons/gem_animation-8bc76ded63.json",chest_animation_json:"@jsons/treasure-f735f61bf6.json",unit_bamboo10:"@jsons/bamboo_stage10-2b8273dae0.json",unit_bamboo11:"@jsons/bamboo_stage11-22c933802f.json",unit_bamboogenerator1:"@jsons/bamboogenerator_stage1-b2df0cceac.json",unit_bamboogenerator2:"@jsons/bamboogenerator_stage2-425e9e0ba1.json",unit_bamboogenerator3:"@jsons/bamboogenerator_stage3-b3a1c9b0b4.json",
unit_bear7:"@jsons/bear_stage7-5cd4b6b667.json",unit_dwarf2:"@jsons/dwarf_stage2-7d56c72510.json",unit_elf8:"@jsons/elf_stage8-5179d15722.json",unit_king4:"@jsons/king_stage4-7962c495dd.json",unit_knight11:"@jsons/knight_stage11-f3d15a90d3.json",unit_sapphire11:"@jsons/sapphire_stage11-727de2ebc1.json",unit_sapphire12:"@jsons/sapphire_stage12-c55dce6bd5.json",unit_sapphiregenerator1:"@jsons/sapphiregenerator_stage1-76d5b48e99.json",unit_sapphiregenerator2:"@jsons/sapphiregenerator_stage2-e9b2036852.json",unit_sapphiregenerator3:"@jsons/sapphiregenerator_stage3-bd8ab58bb7.json",unit_specialoffer1:"@jsons/specialoffer_stage1-4cc375ce00.json",unit_stone10:"@jsons/stone_stage10-2ee1915290.json",unit_stone11:"@jsons/stone_stage11-d57f3c9637.json",unit_stonegenerator1:"@jsons/stonegenerator_stage1-d3968925dc.json",unit_stonegenerator2:"@jsons/stonegenerator_stage2-0aab40802d.json",unit_stonegenerator3:"@jsons/stonegenerator_stage3-14099c3c16.json",
unit_troll10:"@jsons/troll_stage10-d0e5f5d2b2.json",unit_wagon10:"@jsons/wagon_stage10-61e5f61a89.json",unit_wagon11:"@jsons/wagon_stage11-6a551cf1ac.json",unit_wagongenerator1:"@jsons/wagongenerator_stage1-16beb4ef1c.json",unit_wagongenerator2:"@jsons/wagongenerator_stage2-bced3cd7b1.json",unit_wagongenerator3:"@jsons/wagongenerator_stage3-f76c43d67f.json",unit_wands1:"@jsons/wands_stage1-535476df2f.json",unit_wands2:"@jsons/wands_stage2-5b3cd3b124.json",unit_wands3:"@jsons/wands_stage3-742c20d24e.json",unit_wands4:"@jsons/wands_stage4-d94ad946f6.json",unit_wands5:"@jsons/wands_stage5-d9b2d0d3e1.json",unit_wands6:"@jsons/wands_stage6-a067e2a882.json",unit_warlock9:"@jsons/warlock_stage9-510edb7c9c.json",unit_wood9:"@jsons/wood_stage9-795fc48e1c.json",unit_wood10:"@jsons/wood_stage10-d944fe5492.json",unit_woodgenerator1:"@jsons/woodgenerator_stage1-adb1dc400c.json",unit_woodgenerator2:"@jsons/woodgenerator_stage2-f73d0647d0.json",
unit_woodgenerator3:"@jsons/woodgenerator_stage3-4f76fc159e.json",unit_worker5:"@jsons/worker_stage5-594a29e321.json",plist:"@%n-682f9e4868.plist",atlas:"@%n-682f9e4868.atlas"},frames:{ratewindow_on:"#%n-rate-star.png",mission_star0_png:"#%n-missions-mission_star_0.png",mission_star1_png:"#%n-missions-mission_star_1.png",adicon_png:"#%n-shared-adicon.png",tutorial_click_png:"#%n-tutorial-circle.png",tutorial_hand_png:"#%n-tutorial-hand.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",
nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",
default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",
default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png",menu_icon_png:"#%n-controlbuttons-menu.png",button_png:"#%n-controlbuttons-menu_button.png",
button_on_png:"#%n-controlbuttons-menu_button_on.png",fullscreen_icon_png:"#%n-controlbuttons-fullscreen_icon.png",back_button_png:"#%n-controlbuttons-back_button.png",back_button_on_png:"#%n-controlbuttons-back_button_on.png",back_icon_png:"#%n-controlbuttons-back.png",life_png:"#%n-menubar-energy.png",coin_png:"#%n-menubar-ruby.png",menubar_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",plus_button_on_png:"#%n-menubar-plus_on.png",bar_timer_png:"#%n-menubar-bar_timer.png",small_timer_icon_png:"#%n-menubar-timer.png",menubar_attention_png:"#%n-orderswindow-attention_exclamation_large.png",menubar_progress_png:"#%n-level-progressbar.png",menubar_round_bg_png:"#%n-level-level_round.png",merge_coin_png:"#%n-menubar-coin.png",merge_wand_png:"#%n-menubar-wand.png",merge_worker_png:"#%n-menubar-worker.png",window_button_png:"#%n-buttons-button.png",window_button_on_png:"#%n-buttons-button_on.png",window_button_disabled_png:"#%n-buttons-button_off.png",
blue_button_png:"#%n-buttons-button_blue.png",blue_button_on_png:"#%n-buttons-button_blue_on.png",small_blue_button:"#%n-buttons-small_blue_button.png",small_blue_button_on:"#%n-buttons-small_blue_button_on.png",icon_bg:"#%n-sidebar-icon_bg.png",lock:"#%n-sidebar-lock_sidebar.png",attention_png:"#%n-orderswindow-attention_exclamation_large.png",icon_text_bg:"#%n-sidebar-icon_text_bg.png",caption_bg:"#%n-sidebar-icon_text_bg.png",gamemessage_bg_png:"#%n-%n_message-level_msg_bg.png",generator_star_on:"#%n-woodgenerator-star_on.png",generator_star_off:"#%n-woodgenerator-star_off.png",bar_png:"#%n-bar.png",bar_bg_png:"#%n-bar_bg.png",pickaxe:"#%n-dragonmine-pickaxe.png",seller_icon:"#%n-ui-seller_icon.png",hint_background_png:"#%n-dialogues-bg.png",upgradable_level_png:"#%n-ui-upgradable_level.png",upgradable_bar_png:"#%n-ui-upgradable_bar.png",upgradable_bar_bg_png:"#%n-ui-upgradable_bar_bg.png",guide_button_png:"#%n-ui-guide_button.png",guide_button_on_png:"#%n-ui-guide_button_on.png",
first_place_prize_png:"#%n-energyplantchest-stage3.png",second_place_prize_png:"#%n-energyplantchest-stage2.png",third_place_prize_png:"#%n-energyplantchest-stage1.png",stand_ground:"#%n-ui-ground.png",buildable_exclamation:"#%n-ui-small_exclamation.png",fog_png:"#%n-cloud2-cloud_1.png",fog_down_left_png:"#%n-cloud2-cloud_down_left.png",fog_down_right_png:"#%n-cloud2-cloud_down_right.png",fog_up_left_png:"#%n-cloud2-cloud_up_left.png",fog_up_right_png:"#%n-cloud2-cloud_up_right.png",fog_blocker_png:"#%n-cloud-lock.png",fog_blocker_cloud_png:"#%n-cloud-lock_cloud.png",button_wand_png:"#%n-buttons-button_wand.png",flying_coin_png:"#%n-flying-coin.png",flying_energy_png:"#%n-flying-energy.png",flying_wand_png:"#%n-flying-wand.png",flying_ruby_png:"#%n-flying-ruby.png",flying_exp_png:"#%n-flying-exp.png",background:"#%n-ui-%n_ui_bg.png",background_warning:"#%n-infoview-%n_ui_bg2.png",pointer:"#%n-infoview-%n_ui_bg_pointer.png",pointer2:"#%n-infoview-%n_ui_bg_pointer_small.png",
pointer2_warning:"#%n-infoview-%n_ui_bg_pointer2_small.png",timer_icon_large:"#%n-ui-timer_icon.png",timer_substrate:"#%n-ui-timer_substrate.png",timer_icon_png:"#%n-infoview-%n_ui_clock.png",timer_ribbon_icon_png:"#%n-infoview-clock_with_ribbon.png",watch_ad_icon:"#%n-ui-speedup_watch_icon.png",coins_feast_icon:"#%n-ui-speedup_coins_icon.png",energy_time_icon1:"#%n-energy_time-bubble1.png",energy_time_icon2:"#%n-energy_time-bubble2.png",energy_time_icon3:"#%n-energy_time-bubble3.png",progress_background:"#%n-discreteprogress-bar_bg.png",progress_stroke:"#%n-discreteprogress-stroke_dark.png",progress_bar:"#%n-discreteprogress-bar_red.png",small_attention_exclamation:"#%n-orderswindow-attention_exclamation.png",small_attention_exclamation_disabled:"#%n-orderswindow-attention_exclamation_gray.png",small_ok_exclamation:"#%n-orderswindow-attention_ok.png",attention_ok:"#%n-orderswindow-attention_ok_large.png",attention_exclamation:"#%n-orderswindow-attention_exclamation_large.png",
attention_exclamation_disabled:"#%n-orderswindow-attention_exclamation_gray_large.png",attention_sandglass:"#%n-orderswindow-attention_sandglass_large.png",attention_coin:"#%n-orderswindow-attention_coin_large.png",icon_background:"#%n-orderswindow-icon_background.png",icon_background_light:"#%n-orderswindow-icon_background_light.png",icon_blocker:"#%n-orderswindow-order_lock.png",next_arrow:"#%n-orderswindow-next_arrow.png",details_background:"#%n-orderswindow-details_background.png",timer:"#%n-infoview-%n_ui_clock.png",dwarf_head:"#%n-infoview-dwarf_head.png",instant_dwarf_head:"#%n-infoview-instant_dwarf_head.png",button_ruby_png:"#%n-buttons-button_ruby.png",button_coin_png:"#%n-buttons-button_coin.png",dp_background:"#%n-discreteprogress-bar_bg.png",dp_stroke:"#%n-discreteprogress-stroke_dark.png",dp_progress_0:"#%n-discreteprogress-bar_0.png",dp_progress_1:"#%n-discreteprogress-bar_1.png",dp_progress_2:"#%n-discreteprogress-bar_2.png",
dp_progress_3:"#%n-discreteprogress-bar_3.png",dp_background_small:"#%n-discreteprogress-bar_bg_small.png",dp_stroke_small:"#%n-discreteprogress-stroke_white_small.png",dp_progress_0_small:"#%n-discreteprogress-bar_0_small.png",dp_progress_1_small:"#%n-discreteprogress-bar_1_small.png",dp_progress_2_small:"#%n-discreteprogress-bar_2_small.png",dp_progress_3_small:"#%n-discreteprogress-bar_3_small.png",small_icon_dwarf:"#%n-heroes-dwarf_small.png",small_icon_king:"#%n-heroes-king_small.png",small_icon_bear:"#%n-heroes-bear_small.png",small_icon_elf:"#%n-heroes-elf_small.png",small_icon_warlock:"#%n-heroes-warlock_small.png",small_icon_troll:"#%n-heroes-troll_small.png",small_icon_knight:"#%n-heroes-knight_small.png",fog_icon_png:"#%n-icons-fog.png",bonus_merge:"#%n-repeated_quests-bonus_merge.png",build_object:"#%n-repeated_quests-worker_batlepass.png",unit_apple1:"#%n-apple-stage1.png",unit_apple2:"#%n-apple-stage2.png",unit_apple3:"#%n-apple-stage3.png",
unit_apple4:"#%n-apple-stage4.png",unit_apple5:"#%n-apple-stage5.png",unit_apple6:"#%n-apple-stage6.png",unit_bamboo1:"#%n-bamboo-stage1.png",unit_bamboo2:"#%n-bamboo-stage2.png",unit_bamboo3:"#%n-bamboo-stage3.png",unit_bamboo4:"#%n-bamboo-stage4.png",unit_bamboo5:"#%n-bamboo-stage5.png",unit_bamboo6:"#%n-bamboo-stage6.png",unit_bamboo7:"#%n-bamboo-stage7.png",unit_bamboo8:"#%n-bamboo-stage8.png",unit_bamboo9:"#%n-bamboo-stage9.png",unit_bamboochest1:"#%n-bamboochest-stage1.png",unit_bamboochest2:"#%n-bamboochest-stage2.png",unit_bamboochest3:"#%n-bamboochest-stage3.png",unit_bamboosource1:"#%n-bamboosource-stage1.png",unit_bamboosource2:"#%n-bamboosource-stage2.png",unit_bamboosource3:"#%n-bamboosource-stage3.png",unit_bamboosource4:"#%n-bamboosource-stage4.png",unit_bamboosource5:"#%n-bamboosource-stage5.png",unit_bamboosource6:"#%n-bamboosource-stage6.png",unit_bear1:"#%n-bear-stage1.png",unit_bear2:"#%n-bear-stage2.png",unit_bear3:"#%n-bear-stage3.png",
unit_bear4:"#%n-bear-stage4.png",unit_bear5:"#%n-bear-stage5.png",unit_bear6:"#%n-bear-stage6.png",unit_candies1:"#%n-candies-stage1.png",unit_candies2:"#%n-candies-stage2.png",unit_candies3:"#%n-candies-stage3.png",unit_candies4:"#%n-candies-stage4.png",unit_candies5:"#%n-candies-stage5.png",unit_candies6:"#%n-candies-stage6.png",unit_coins1:"#%n-coins-stage1.png",unit_coins2:"#%n-coins-stage2.png",unit_coins3:"#%n-coins-stage3.png",unit_coins4:"#%n-coins-stage4.png",unit_coins5:"#%n-coins-stage5.png",unit_coins6:"#%n-coins-stage6.png",unit_coins7:"#%n-coins-stage7.png",unit_coins8:"#%n-coins-stage8.png",unit_coinsplant1:"#%n-coinsplant-stage1.png",unit_coinsplant2:"#%n-coinsplant-stage2.png",unit_coinsplant3:"#%n-coinsplant-stage3.png",unit_coinsplantchest1:"#%n-coinsplantchest-stage1.png",unit_coinsplantchest2:"#%n-coinsplantchest-stage2.png",unit_coinsplantchest3:"#%n-coinsplantchest-stage3.png",unit_corn1:"#%n-corn-stage1.png",unit_corn2:"#%n-corn-stage2.png",
unit_corn3:"#%n-corn-stage3.png",unit_corn4:"#%n-corn-stage4.png",unit_corn5:"#%n-corn-stage5.png",unit_corn6:"#%n-corn-stage6.png",unit_crystal1:"#%n-crystal-stage1.png",unit_crystal2:"#%n-crystal-stage2.png",unit_crystal3:"#%n-crystal-stage3.png",unit_crystal4:"#%n-crystal-stage4.png",unit_decorator1:"#%n-decorator-stage1.png",unit_dishes1:"#%n-dishes-stage1.png",unit_dishes2:"#%n-dishes-stage2.png",unit_dishes3:"#%n-dishes-stage3.png",unit_dishes4:"#%n-dishes-stage4.png",unit_dishes5:"#%n-dishes-stage5.png",unit_dishes6:"#%n-dishes-stage6.png",unit_dishes7:"#%n-dishes-stage7.png",unit_dishes8:"#%n-dishes-stage8.png",unit_dishes9:"#%n-dishes-stage9.png",unit_dishes10:"#%n-dishes-stage10.png",unit_dishes11:"#%n-dishes-stage11.png",unit_dishes12:"#%n-dishes-stage12.png",unit_dishes13:"#%n-dishes-stage13.png",unit_dishes14:"#%n-dishes-stage14.png",unit_dishes15:"#%n-dishes-stage15.png",unit_dishes16:"#%n-dishes-stage16.png",unit_dishes17:"#%n-dishes-stage17.png",
unit_dishes18:"#%n-dishes-stage18.png",unit_dishes19:"#%n-dishes-stage19.png",unit_dishes20:"#%n-dishes-stage20.png",unit_dragonmine1:"#%n-dragonmine-stage1.png",unit_dwarf1:"#%n-dwarf-stage1.png",unit_elf1:"#%n-elf-stage1.png",unit_elf2:"#%n-elf-stage2.png",unit_elf3:"#%n-elf-stage3.png",unit_elf4:"#%n-elf-stage4.png",unit_elf5:"#%n-elf-stage5.png",unit_elf6:"#%n-elf-stage6.png",unit_elf7:"#%n-elf-stage7.png",unit_energyplant1:"#%n-energyplant-stage1.png",unit_energyplant2:"#%n-energyplant-stage2.png",unit_energyplant3:"#%n-energyplant-stage3.png",unit_energyplantchest1:"#%n-energyplantchest-stage1.png",unit_energyplantchest2:"#%n-energyplantchest-stage2.png",unit_energyplantchest3:"#%n-energyplantchest-stage3.png",unit_freechest1:"#%n-freechest-stage1.png",unit_herochest1:"#%n-herochest-stage1.png",unit_iron1:"#%n-iron-stage1.png",unit_iron2:"#%n-iron-stage2.png",unit_iron3:"#%n-iron-stage3.png",unit_iron4:"#%n-iron-stage4.png",unit_iron5:"#%n-iron-stage5.png",
unit_iron6:"#%n-iron-stage6.png",unit_iron7:"#%n-iron-stage7.png",unit_iron8:"#%n-iron-stage8.png",unit_iron9:"#%n-iron-stage9.png",unit_iron10:"#%n-iron-stage10.png",unit_king1:"#%n-king-stage1.png",unit_king2:"#%n-king-stage2.png",unit_king3:"#%n-king-stage3.png",unit_knight1:"#%n-knight-stage1.png",unit_knight2:"#%n-knight-stage2.png",unit_knight3:"#%n-knight-stage3.png",unit_knight4:"#%n-knight-stage4.png",unit_knight5:"#%n-knight-stage5.png",unit_knight6:"#%n-knight-stage6.png",unit_knight7:"#%n-knight-stage7.png",unit_knight8:"#%n-knight-stage8.png",unit_knight9:"#%n-knight-stage9.png",unit_knight10:"#%n-knight-stage10.png",unit_magicplant1:"#%n-magicplant-stage1.png",unit_magicplant2:"#%n-magicplant-stage2.png",unit_magicplant3:"#%n-magicplant-stage3.png",unit_magicplant4:"#%n-magicplant-stage4.png",unit_magicplant5:"#%n-magicplant-stage5.png",unit_magicplant6:"#%n-magicplant-stage6.png",unit_magicplant7:"#%n-magicplant-stage7.png",unit_magicplant8:"#%n-magicplant-stage8.png",
unit_magicplant9:"#%n-magicplant-stage9.png",unit_mushrooms1:"#%n-mushrooms-stage1.png",unit_mushrooms2:"#%n-mushrooms-stage2.png",unit_mushrooms3:"#%n-mushrooms-stage3.png",unit_mushrooms4:"#%n-mushrooms-stage4.png",unit_mushrooms5:"#%n-mushrooms-stage5.png",unit_mushrooms6:"#%n-mushrooms-stage6.png",unit_rubies1:"#%n-rubies-stage1.png",unit_rubies2:"#%n-rubies-stage2.png",unit_rubies3:"#%n-rubies-stage3.png",unit_rubies4:"#%n-rubies-stage4.png",unit_rubies5:"#%n-rubies-stage5.png",unit_rubies6:"#%n-rubies-stage6.png",unit_rubiesplant1:"#%n-rubiesplant-stage1.png",unit_rubiesplant2:"#%n-rubiesplant-stage2.png",unit_rubiesplant3:"#%n-rubiesplant-stage3.png",unit_rubiesplantchest1:"#%n-rubiesplantchest-stage1.png",unit_rubiesplantchest2:"#%n-rubiesplantchest-stage2.png",unit_rubiesplantchest3:"#%n-rubiesplantchest-stage3.png",unit_sacks1:"#%n-sacks-stage1.png",unit_sacks2:"#%n-sacks-stage2.png",unit_sacks3:"#%n-sacks-stage3.png",unit_sapphire1:"#%n-sapphire-stage1.png",
unit_sapphire2:"#%n-sapphire-stage2.png",unit_sapphire3:"#%n-sapphire-stage3.png",unit_sapphire4:"#%n-sapphire-stage4.png",unit_sapphire5:"#%n-sapphire-stage5.png",unit_sapphire6:"#%n-sapphire-stage6.png",unit_sapphire7:"#%n-sapphire-stage7.png",unit_sapphire8:"#%n-sapphire-stage8.png",unit_sapphire9:"#%n-sapphire-stage9.png",unit_sapphire10:"#%n-sapphire-stage10.png",unit_sapphirechest1:"#%n-sapphirechest-stage1.png",unit_sapphirechest2:"#%n-sapphirechest-stage2.png",unit_sapphirechest3:"#%n-sapphirechest-stage3.png",unit_sapphiresource1:"#%n-sapphiresource-stage1.png",unit_sapphiresource2:"#%n-sapphiresource-stage2.png",unit_sapphiresource3:"#%n-sapphiresource-stage3.png",unit_sapphiresource4:"#%n-sapphiresource-stage4.png",unit_sapphiresource5:"#%n-sapphiresource-stage5.png",unit_sapphiresource6:"#%n-sapphiresource-stage6.png",unit_stone1:"#%n-stone-stage1.png",unit_stone2:"#%n-stone-stage2.png",unit_stone3:"#%n-stone-stage3.png",unit_stone4:"#%n-stone-stage4.png",
unit_stone5:"#%n-stone-stage5.png",unit_stone6:"#%n-stone-stage6.png",unit_stone7:"#%n-stone-stage7.png",unit_stone8:"#%n-stone-stage8.png",unit_stone9:"#%n-stone-stage9.png",unit_stonechest1:"#%n-stonechest-stage1.png",unit_stonechest2:"#%n-stonechest-stage2.png",unit_stonechest3:"#%n-stonechest-stage3.png",unit_stonesource1:"#%n-stonesource-stage1.png",unit_stonesource2:"#%n-stonesource-stage2.png",unit_stonesource3:"#%n-stonesource-stage3.png",unit_stonesource4:"#%n-stonesource-stage4.png",unit_stonesource5:"#%n-stonesource-stage5.png",unit_stonesource6:"#%n-stonesource-stage6.png",unit_strawberry1:"#%n-strawberry-stage1.png",unit_strawberry2:"#%n-strawberry-stage2.png",unit_strawberry3:"#%n-strawberry-stage3.png",unit_strawberry4:"#%n-strawberry-stage4.png",unit_strawberry5:"#%n-strawberry-stage5.png",unit_strawberry6:"#%n-strawberry-stage6.png",unit_treasure1:"#%n-treasure-stage1.png",unit_treasure2:"#%n-treasure-stage2.png",unit_treasure3:"#%n-treasure-stage3.png",
unit_troll1:"#%n-troll-stage1.png",unit_troll2:"#%n-troll-stage2.png",unit_troll3:"#%n-troll-stage3.png",unit_troll4:"#%n-troll-stage4.png",unit_troll5:"#%n-troll-stage5.png",unit_troll6:"#%n-troll-stage6.png",unit_troll7:"#%n-troll-stage7.png",unit_troll8:"#%n-troll-stage8.png",unit_troll9:"#%n-troll-stage9.png",unit_wagon1:"#%n-wagon-stage1.png",unit_wagon2:"#%n-wagon-stage2.png",unit_wagon3:"#%n-wagon-stage3.png",unit_wagon4:"#%n-wagon-stage4.png",unit_wagon5:"#%n-wagon-stage5.png",unit_wagon6:"#%n-wagon-stage6.png",unit_wagon7:"#%n-wagon-stage7.png",unit_wagon8:"#%n-wagon-stage8.png",unit_wagon9:"#%n-wagon-stage9.png",unit_wagonchest1:"#%n-wagonchest-stage1.png",unit_wagonchest2:"#%n-wagonchest-stage2.png",unit_wagonchest3:"#%n-wagonchest-stage3.png",unit_wagonsource1:"#%n-wagonsource-stage1.png",unit_wagonsource2:"#%n-wagonsource-stage2.png",unit_wagonsource3:"#%n-wagonsource-stage3.png",unit_wagonsource4:"#%n-wagonsource-stage4.png",unit_wagonsource5:"#%n-wagonsource-stage5.png",
unit_wagonsource6:"#%n-wagonsource-stage6.png",unit_warlock1:"#%n-warlock-stage1.png",unit_warlock2:"#%n-warlock-stage2.png",unit_warlock3:"#%n-warlock-stage3.png",unit_warlock4:"#%n-warlock-stage4.png",unit_warlock5:"#%n-warlock-stage5.png",unit_warlock6:"#%n-warlock-stage6.png",unit_warlock7:"#%n-warlock-stage7.png",unit_warlock8:"#%n-warlock-stage8.png",unit_wheat1:"#%n-wheat-stage1.png",unit_wheat2:"#%n-wheat-stage2.png",unit_wheat3:"#%n-wheat-stage3.png",unit_wheat4:"#%n-wheat-stage4.png",unit_wheat5:"#%n-wheat-stage5.png",unit_wheat6:"#%n-wheat-stage6.png",unit_wood1:"#%n-wood-stage1.png",unit_wood2:"#%n-wood-stage2.png",unit_wood3:"#%n-wood-stage3.png",unit_wood4:"#%n-wood-stage4.png",unit_wood5:"#%n-wood-stage5.png",unit_wood6:"#%n-wood-stage6.png",unit_wood7:"#%n-wood-stage7.png",unit_wood8:"#%n-wood-stage8.png",unit_woodchest1:"#%n-woodchest-stage1.png",unit_woodchest2:"#%n-woodchest-stage2.png",unit_woodchest3:"#%n-woodchest-stage3.png",
unit_woodsource1:"#%n-woodsource-stage1.png",unit_woodsource2:"#%n-woodsource-stage2.png",unit_woodsource3:"#%n-woodsource-stage3.png",unit_woodsource4:"#%n-woodsource-stage4.png",unit_woodsource5:"#%n-woodsource-stage5.png",unit_woodsource6:"#%n-woodsource-stage6.png",unit_worker1:"#%n-worker-stage1.png",unit_worker2:"#%n-worker-stage2.png",unit_worker3:"#%n-worker-stage3.png",unit_worker4:"#%n-worker-stage4.png",button_energy_png:"#%n-buttons-button_energy.png"}},game_background:{urls:{background:{}}},game_background_hard:{urls:{background:{}}},gamemessage:{urls:{},injectTo:["game"],frameIds:["%n_bg_png"],jsonIds:[],soundIds:[],unpackedIds:[]},git:{urls:{},injectTo:["admin","wysiwyg"],frameIds:["push_icon","revert_icon","regular_button","regular_button_on","delete_button","scroll_bg","scroll_content_bg","loading"],jsonIds:[],soundIds:[],unpackedIds:[]},guidewindow:{urls:{png:"@%n-faaf91b403.png",json:"@%n-b199748661.json"},jsons:{plist:"@%n-faaf91b403.plist"},frames:{
stage_background:"#%n-%n_stage_background.png",upper_arrow:"#%n-%n_up_arrow.png",lower_arrow:"#%n-%n_down_arrow.png",blue_light:"#%n-%n_blue_light.png",blue_light_foreground:"#%n-%n_blue_light2.png",blue_light_tears:"#%n-%n_blue_light3.png",yellow_light:"#%n-%n_yellow_light.png",white_arrows:"#%n-%n_white_arrow.png",white_arrow_up:"#%n-%n_white_arrowup.png",white_plus:"#%n-%n_white_plus.png",three_white_arrows:"#%n-%n_white_three_arrow.png",crystals:"#%n-%n_crystal.png",progress:"#%n-%n_progressbar.png",tile_light:"#%n-%n_tile_light.png",guide_attention:"#%n-orderswindow-attention_exclamation.png",guide_rays:"#%n-%n_score_rays.png",energies:"#%n-%n_energy.png",coins:"#%n-%n_coins.png",treasure:"#%n-energyplantchest-stage3.png",rating:"#%n-%n_rating.png",worker_with_building:"#%n-worker_batlepass.png",prizes_heap:"#%n-prizes_heap.png",guide_stage_1:"#%n-%n_mines.png",guide_stage_2:"#%n-%n_pickaxe.png",guide_prize:"#%n-%n_rewards.png"}},halloween:{urls:{png:"@%n-827215f455.png",
json:"@%n-95d3bf1960.json"},jsons:{halloween_jack_json:"@jsons/%n_jack-26aa44dede.json",halloween_candle_json:"@jsons/%n_candle-fedb3d9112.json",halloween_owls_json:"@jsons/%n_owls-e2cf4ee13f.json",plist:"@%n-827215f455.plist",atlas:"@%n-827215f455.atlas"},frames:{halloween_web_bottom:"#%n-%n_decor_1.png",halloween_web_top:"#%n-%n_decor_2.png",halloween_decor_forest:"#%n-%n_decor_forest.png",halloween_pumpkins:"#%n-%n_pumpkins.png",halloween_roots_top_left:"#%n-%n_roots_top_left.png",halloween_roots_top_right:"#%n-%n_roots_top_right.png"}},help_from_friends:{urls:{}},hero:{urls:{},injectTo:["main"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},infoview:{urls:{},injectTo:["game"],frameIds:["timer","dwarf_head","instant_dwarf_head","button_ruby_png","button_coin_png"],jsonIds:[],soundIds:[],unpackedIds:[]},language_ar:{urls:{json:"@%n-58ec8003b1.json"},jsons:{common_json:"~%n/all/jsons/common_ar-ff3f6e247a.json",project_json:"~%n/all/jsons/ar-42ae6ed203.json",
quests_json:"~%n/all/jsons/quests_ar-ea0cd45660.json"}},language_de:{urls:{json:"@%n-6723f4200e.json"},jsons:{common_json:"~%n/all/jsons/common_de-4c6a5d99e9.json",project_json:"~%n/all/jsons/de-67df0df926.json",quests_json:"~%n/all/jsons/quests_de-984548beb9.json"}},language_en:{urls:{json:"@%n-2c9b7c99c0.json"},jsons:{common_json:"~%n/all/jsons/common_en-098b9104f9.json",project_json:"~%n/all/jsons/en-805236bcd0.json",quests_json:"~%n/all/jsons/quests_en-30af09ad3c.json"}},language_es:{urls:{json:"@%n-385a9d3e4f.json"},jsons:{common_json:"~%n/all/jsons/common_es-2d359f149b.json",project_json:"~%n/all/jsons/es-c32dee9274.json",quests_json:"~%n/all/jsons/quests_es-617486efad.json"}},language_fr:{urls:{json:"@%n-29d9f8485f.json"},jsons:{common_json:"~%n/all/jsons/common_fr-ce6fe778ee.json",project_json:"~%n/all/jsons/fr-ec38221181.json",quests_json:"~%n/all/jsons/quests_fr-75f04c0992.json"}},language_it:{urls:{json:"@%n-b6c8dd00a0.json"},jsons:{
common_json:"~%n/all/jsons/common_it-82f320193e.json",project_json:"~%n/all/jsons/it-9248f4e26b.json",quests_json:"~%n/all/jsons/quests_it-34cf3d6eb8.json"}},language_ja:{urls:{json:"@%n-b1d9c75dfc.json"},jsons:{common_json:"~%n/all/jsons/common_ja-f1390e4b91.json",project_json:"~%n/all/jsons/ja-4f4a7f0163.json",quests_json:"~%n/all/jsons/quests_ja-a2c1f3f1da.json"}},language_ko:{urls:{json:"@%n-c5be61ffc7.json"},jsons:{common_json:"~%n/all/jsons/common_ko-ad9f5a5554.json",project_json:"~%n/all/jsons/ko-938df6a599.json",quests_json:"~%n/all/jsons/quests_ko-b6f64939c2.json"}},language_lv:{urls:{json:"@%n-f84b542f27.json"},jsons:{common_json:"~%n/all/jsons/common_lv-7d56bf925c.json",project_json:"~%n/all/jsons/lv-b58b68923a.json",quests_json:"~%n/all/jsons/quests_lv-c34ab20405.json"}},language_nl:{urls:{json:"@%n-2a4b879dd9.json"},jsons:{common_json:"~%n/all/jsons/common_nl-a2b8cfb3b2.json",project_json:"~%n/all/jsons/nl-759a52c63e.json",
quests_json:"~%n/all/jsons/quests_nl-7b8ab014a2.json"}},language_pl:{urls:{json:"@%n-6637f0a701.json"},jsons:{common_json:"~%n/all/jsons/common_pl-0cbee76b22.json",project_json:"~%n/all/jsons/pl-a93dbdc7e8.json",quests_json:"~%n/all/jsons/quests_pl-f1fefc85a7.json"}},language_pt:{urls:{json:"@%n-a76f86b2bc.json"},jsons:{common_json:"~%n/all/jsons/common_pt-4104cca34c.json",project_json:"~%n/all/jsons/pt-db0931f9b7.json",quests_json:"~%n/all/jsons/quests_pt-aecfe5d351.json"}},language_ru:{urls:{json:"@%n-2a07433e35.json"},jsons:{common_json:"~%n/all/jsons/common_ru-a412a7349e.json",project_json:"~%n/all/jsons/ru-68106a7ecc.json",quests_json:"~%n/all/jsons/quests_ru-9e2eb341dd.json"}},language_tr:{urls:{json:"@%n-459fb79238.json"},jsons:{common_json:"~%n/all/jsons/common_tr-ed38066da9.json",project_json:"~%n/all/jsons/tr-bc56ae186f.json",quests_json:"~%n/all/jsons/quests_tr-d6eb664c3c.json"}},language_zh:{urls:{json:"@%n-95b7c5d580.json"},jsons:{
common_json:"~%n/all/jsons/common_zh-7092f209a9.json",project_json:"~%n/all/jsons/zh-cc3a34c56b.json",quests_json:"~%n/all/jsons/quests_zh-18a5852fdd.json"}},languageswindow:{urls:{png:"@%n-3f7c8c7a12.png",json:"@%n-87396ff51c.json"},jsons:{plist:"@%n-3f7c8c7a12.plist"},frames:{buttoncheck_png:"#%n-languages-check.png",buttonbg_png:"#%n-languages-bg.png",buttonbg_on_png:"#%n-languages-bg_on.png"}},lantern:{urls:{}},lantern_window:{urls:{}},levelupwindow:{urls:{levelup_effect:"~sounds/levelup-e235634d89.mp3",png:"@%n-ebd799a8e5.png",json:"@%n-7d80718448.json"},jsons:{levelup_json:"@jsons/levelup-127644b63e.json",atlas:"@%n-ebd799a8e5.atlas"}},loading_scene_backgrounds:{urls:{background:"@background-9aad858ebb.jpg"}},lose_window:{urls:{png:"@%n-775dae63d5.png",json:"@%n-b126a95d95.json"},jsons:{lose_json:"@jsons/lose-5481b24ffc.json",atlas:"@%n-775dae63d5.atlas"}},lottery:{urls:{},injectTo:["tile_shop","main"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},magic_tournament:{urls:{}},
main:{urls:{click_effect:"~sounds/click-3d30f98dd7.mp3",coins_effect:"~sounds/coins-8e71c0d2cf.mp3",notification_effect:"~sounds/notification-4fd5211563.mp3",window_effect:"~sounds/window-f2adec4f73.mp3",reward_window_effect:"~sounds/reward-6fd002b7a1.mp3",basefont_ttf:{type:"font",name:"Marvin-Round",srcs:["~%n/all/marvin_round.ttf","~%n/all/marvin_round.eot"]},png:"@%n-d1f581d8f0.png",json:"@%n-db3e061863.json"},jsons:{share_json:"~%n/all/jsons/share-107f96e29c.json",wait_json:"@jsons/loading-d6cee9aa0e.json",reward_spine_json:"@jsons/reward_animation-287c7e5ee5.json",friday_schedule:{url:"cleverapps/utils/events/client/mergecraftschedule.json",data:"[]",inline:!0},play_button_transition_json:"@jsons/play_button_transition-86d4e931e5.json",quests_data_json:{url:"cleverapps/src/mergecraft/quests_data.json",
data:'{"spreadsheet":{"url":"https://docs.google.com/spreadsheets/d/1r89PbbHDEOJXDOrYFo41WHDyi2jaQYQv6_8AAEsyZYs/","sheet":4},"quests":{"wheat_3":{"dialogue":[{"text":"messages:Quest.wheat_3.step1","person":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":15}},"dishes_0":{"dialogue":[{"text":"messages:Quest.dishes_0.step1","person":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":5}},"woodsource_1_1":{"dialogue":[{"text":"messages:Quest.woodsource_1_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.woodsource_1_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.woodsource_1_1.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.woodsource_1_1.step4","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":55,"coins":15}},"woodsource_1_0":{"goal":3,"prize":{"exp":20,"coins":25}},"wood_1":{"dialogue":[{"text":"messages:Quest.wood_1.step1","person":"worker"}],"goal":3,"prize":{"exp":50,"coins":10}},"wood_2":{"goal":2,"prize":{"exp":20,"coins":15}},"wood_3":{"dialogue":[{"text":"messages:Quest.wood_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_3.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.wood_3.step3","person":"dwarf","person2":"worker_right"}],"goal":2,"prize":{"exp":30,"coins":100}},"wood_4":{"dialogue":[{"text":"messages:Quest.wood_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_4.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":100,"coins":5}},"wood_5":{"dialogue":[{"text":"messages:Quest.wood_5.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_5.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":100,"coins":10}},"wood_6":{"dialogue":[{"text":"messages:Quest.wood_6.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_6.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":150,"coins":10}},"wood_7":{"dialogue":[{"text":"messages:Quest.wood_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_7.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":200,"coins":10}},"king_1":{"dialogue":[{"text":"messages:Quest.king_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.king_1.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":25,"coins":10}},"king_2":{"dialogue":[{"text":"messages:Quest.king_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.king_2.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":100}},"king_3":{"dialogue":[{"text":"messages:Quest.king_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.king_3.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":5}},"dragonisland_1":{"dialogue":[{"text":"messages:Quest.dragonisland_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.dragonisland_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.dragonisland_1.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.dragonisland_1.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":5}},"bear_1":{"dialogue":[{"text":"messages:Quest.bear_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.bear_1.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_1.step4","person":"king_right","person2":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":5}},"bear_2":{"dialogue":[{"text":"messages:Quest.bear_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_2.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.bear_2.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_2.step4","person":"king_right","person2":"dwarf"}],"goal":1,"prize":{"exp":25,"coins":5}},"bear_3":{"dialogue":[{"text":"messages:Quest.bear_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_3.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.bear_3.step3","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":50,"coins":100}},"bear_4":{"dialogue":[{"text":"messages:Quest.bear_4.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.bear_4.step2","person":"worker_right","person2":"king"}],"goal":1,"prize":{"exp":75,"coins":5}},"bear_5":{"dialogue":[{"text":"messages:Quest.bear_5.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_5.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.bear_5.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bear_5.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":100,"coins":5}},"bear_6":{"dialogue":[{"text":"messages:Quest.bear_6.step1","person":"worker","person2":"king_right"},{"text":"messages:Quest.bear_6.step2","person":"king_right","person2":"worker"}],"goal":1,"prize":{"exp":125,"coins":5}},"candies_4":{"dialogue":[{"text":"messages:Quest.candies_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.candies_4.step2","person":"worker_right","person2":"dwarf"}],"goal":5,"prize":{"exp":50,"coins":5}},"wood_9":{"dialogue":[{"text":"messages:Quest.wood_9.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_9.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.wood_9.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wood_9.step4","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.wood_9.step5","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":500,"coins":150}},"wheat_4":{"goal":11,"prize":{"exp":50,"coins":5}},"stone_1":{"dialogue":[{"text":"messages:Quest.stone_1.step1","person":"dwarf","person2":"king_right"},{"text":"messages:Quest.stone_1.step2","person":"king_right","person2":"dwarf"}],"goal":3,"prize":{"exp":20,"coins":5}},"stone_2":{"dialogue":[{"text":"messages:Quest.stone_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.stone_2.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":25,"coins":5}},"stone_3":{"dialogue":[{"text":"messages:Quest.stone_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.stone_3.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.stone_3.step3","person":"dwarf","person2":"worker_right"}],"goal":2,"prize":{"exp":50,"coins":5}},"stone_4":{"dialogue":[{"text":"messages:Quest.stone_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.stone_4.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":75,"coins":5}},"stone_5":{"dialogue":[{"text":"messages:Quest.stone_5.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.stone_5.step2","person":"worker_right","person2":"king"}],"goal":2,"prize":{"exp":100,"coins":5}},"stone_6":{"dialogue":[{"text":"messages:Quest.stone_6.step1","person":"king","person2":"dwarf_right"},{"text":"messages:Quest.stone_6.step2","person":"dwarf_right","person2":"king"}],"goal":2,"prize":{"exp":125,"coins":10}},"stone_7":{"dialogue":[{"text":"messages:Quest.stone_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.stone_7.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":150,"coins":10}},"stone_8":{"dialogue":[{"text":"messages:Quest.stone_8.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.stone_8.step2","person":"dwarf_right","person2":"worker"}],"goal":2,"prize":{"exp":175,"coins":10}},"stone_10":{"dialogue":[{"text":"messages:Quest.stone_10.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.stone_10.step2","person":"worker_right","person2":"king"},{"text":"messages:Quest.stone_10.step3","person":"dwarf_right","person2":"king"}],"goal":1,"prize":{"exp":500,"coins":150}},"wagon_1":{"dialogue":[{"text":"messages:Quest.wagon_1.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.wagon_1.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.wagon_1.step3","person":"bear_right","person2":"worker"}],"goal":3,"prize":{"exp":20,"coins":5}},"wagon_2":{"dialogue":[{"text":"messages:Quest.wagon_2.step1","person":"worker","person2":"bear_right"},{"text":"messages:Quest.wagon_2.step2","person":"bear_right","person2":"worker"}],"goal":2,"prize":{"exp":25,"coins":5}},"wagon_3":{"dialogue":[{"text":"messages:Quest.wagon_3.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.wagon_3.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":50,"coins":5}},"wagon_4":{"dialogue":[{"text":"messages:Quest.wagon_4.step1","person":"king","person2":"bear_right"},{"text":"messages:Quest.wagon_4.step2","person":"bear_right","person2":"king"},{"text":"messages:Quest.wagon_4.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.wagon_4.step4","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":75,"coins":5}},"wagon_5":{"dialogue":[{"text":"messages:Quest.wagon_5.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wagon_5.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.wagon_5.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.wagon_5.step4","person":"bear_right","person2":"dwarf"}],"goal":2,"prize":{"exp":100,"coins":5}},"wagon_6":{"dialogue":[{"text":"messages:Quest.wagon_6.step1","person":"king","person2":"dwarf_right"},{"text":"messages:Quest.wagon_6.step2","person":"dwarf_right","person2":"king"},{"text":"messages:Quest.wagon_6.step3","person":"bear","person2":"dwarf_right"}],"goal":2,"prize":{"exp":125,"coins":10}},"wagon_7":{"dialogue":[{"text":"messages:Quest.wagon_7.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.wagon_7.step2","person":"bear_right","person2":"dwarf"}],"goal":2,"prize":{"exp":150,"coins":10}},"wagon_8":{"dialogue":[{"text":"messages:Quest.wagon_8.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.wagon_8.step2","person":"worker","person2":"bear_right"},{"text":"messages:Quest.wagon_8.step3","person":"bear_right","person2":"worker"}],"goal":2,"prize":{"exp":175,"coins":10}},"wagon_10":{"dialogue":[{"text":"messages:Quest.wagon_10.step1","person":"bear","person2":"worker_right"},{"text":"messages:Quest.wagon_10.step2","person":"worker_right","person2":"bear"},{"text":"messages:Quest.wagon_10.step3","person":"dwarf_right","person2":"bear"}],"goal":1,"prize":{"exp":500,"coins":150}},"elf_1":{"dialogue":[{"text":"messages:Quest.elf_1.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.elf_1.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.elf_1.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.elf_1.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":5}},"elf_2":{"dialogue":[{"text":"messages:Quest.elf_2.step1","person":"bear","person2":"king_right"},{"text":"messages:Quest.elf_2.step2","person":"king_right","person2":"bear"}],"goal":1,"prize":{"exp":25,"coins":5}},"elf_3":{"dialogue":[{"text":"messages:Quest.elf_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.elf_3.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.elf_3.step3","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.elf_3.step4","person":"king","person2":"bear_right"}],"goal":1,"prize":{"exp":50,"coins":5}},"elf_4":{"dialogue":[{"text":"messages:Quest.elf_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.elf_4.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.elf_4.step3","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":75,"coins":5}},"elf_5":{"dialogue":[{"text":"messages:Quest.elf_5.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.elf_5.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.elf_5.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.elf_5.step4","person":"bear_right","person2":"dwarf"}],"goal":1,"prize":{"exp":100,"coins":5}},"elf_6":{"dialogue":[{"text":"messages:Quest.elf_6.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.elf_6.step2","person":"worker_right","person2":"king"}],"goal":1,"prize":{"exp":125,"coins":10}},"elf_7":{"dialogue":[{"text":"messages:Quest.elf_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.elf_7.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":150,"coins":10}},"warlock_1":{"dialogue":[{"text":"messages:Quest.warlock_1.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.warlock_1.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.warlock_1.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.warlock_1.step4","person":"bear_right","person2":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":5}},"warlock_2":{"dialogue":[{"text":"messages:Quest.warlock_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.warlock_2.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.warlock_2.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.warlock_2.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":25,"coins":5}},"warlock_3":{"dialogue":[{"text":"messages:Quest.warlock_3.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.warlock_3.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.warlock_3.step3","person":"dwarf","person2":"bear_right"}],"goal":1,"prize":{"exp":50,"coins":5}},"warlock_4":{"dialogue":[{"text":"messages:Quest.warlock_4.step1","person":"elf","person2":"dwarf_right"},{"text":"messages:Quest.warlock_4.step2","person":"dwarf_right","person2":"elf"},{"text":"messages:Quest.warlock_4.step3","person":"elf","person2":"dwarf_right"}],"goal":1,"prize":{"exp":75,"coins":5}},"warlock_5":{"dialogue":[{"text":"messages:Quest.warlock_5.step1","person":"king","person2":"elf_right"},{"text":"messages:Quest.warlock_5.step2","person":"elf_right","person2":"king"},{"text":"messages:Quest.warlock_5.step3","person":"king","person2":"elf_right"}],"goal":1,"prize":{"exp":100,"coins":5}},"warlock_6":{"dialogue":[{"text":"messages:Quest.warlock_6.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.warlock_6.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.warlock_6.step3","person":"dwarf","person2":"bear_right"}],"goal":1,"prize":{"exp":125,"coins":10}},"warlock_7":{"dialogue":[{"text":"messages:Quest.warlock_7.step1","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.warlock_7.step2","person":"elf_right","person2":"dwarf"}],"goal":1,"prize":{"exp":150,"coins":10}},"warlock_8":{"dialogue":[{"text":"messages:Quest.warlock_8.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.warlock_8.step2","person":"worker_right","person2":"king"}],"goal":1,"prize":{"exp":175,"coins":10}},"magicplant_1":{"dialogue":[{"text":"messages:Quest.magicplant_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.magicplant_1.step3","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":20,"coins":5}},"magicplant_2":{"dialogue":[{"text":"messages:Quest.magicplant_2.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.magicplant_2.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.magicplant_2.step3","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.magicplant_2.step4","person":"dwarf_right","person2":"worker"}],"goal":1,"prize":{"exp":25,"coins":5}},"magicplant_3":{"dialogue":[{"text":"messages:Quest.magicplant_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_3.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":5}},"magicplant_4":{"dialogue":[{"text":"messages:Quest.magicplant_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_4.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.magicplant_4.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_4.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":75,"coins":5}},"magicplant_5":{"dialogue":[{"text":"messages:Quest.magicplant_5.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_5.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.magicplant_5.step3","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":100,"coins":5}},"magicplant_6":{"dialogue":[{"text":"messages:Quest.magicplant_6.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_6.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.magicplant_6.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_6.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":125,"coins":10}},"magicplant_7":{"dialogue":[{"text":"messages:Quest.magicplant_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_7.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":150,"coins":10}},"magicplant_8":{"dialogue":[{"text":"messages:Quest.magicplant_8.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_8.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.magicplant_8.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.magicplant_8.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":175,"coins":10}},"troll_1":{"dialogue":[{"text":"messages:Quest.troll_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.troll_1.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":5}},"troll_2":{"dialogue":[{"text":"messages:Quest.troll_2.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.troll_2.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.troll_2.step3","person":"dwarf","person2":"bear_right"}],"goal":1,"prize":{"exp":25,"coins":5}},"troll_3":{"dialogue":[{"text":"messages:Quest.troll_3.step1","person":"bear","person2":"elf_right"},{"text":"messages:Quest.troll_3.step2","person":"elf_right","person2":"bear"},{"text":"messages:Quest.troll_3.step3","person":"bear","person2":"elf_right"}],"goal":1,"prize":{"exp":50,"coins":5}},"troll_4":{"dialogue":[{"text":"messages:Quest.troll_4.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.troll_4.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":75,"coins":5}},"troll_5":{"dialogue":[{"text":"messages:Quest.troll_5.step1","person":"king","person2":"warlock_right"},{"text":"messages:Quest.troll_5.step2","person":"warlock_right","person2":"king"},{"text":"messages:Quest.troll_5.step3","person":"king","person2":"warlock_right"}],"goal":1,"prize":{"exp":100,"coins":5}},"troll_6":{"dialogue":[{"text":"messages:Quest.troll_6.step1","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.troll_6.step2","person":"elf_right","person2":"dwarf"},{"text":"messages:Quest.troll_6.step3","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.troll_6.step4","person":"elf_right","person2":"dwarf"}],"goal":1,"prize":{"exp":125,"coins":10}},"troll_7":{"dialogue":[{"text":"messages:Quest.troll_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.troll_7.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":150,"coins":10}},"troll_8":{"dialogue":[{"text":"messages:Quest.troll_8.step1","person":"dwarf","person2":"king_right"},{"text":"messages:Quest.troll_8.step2","person":"king_right","person2":"dwarf"}],"goal":1,"prize":{"exp":175,"coins":10}},"troll_9":{"dialogue":[{"text":"messages:Quest.troll_9.step1","person":"king","person2":"warlock_right"},{"text":"messages:Quest.troll_9.step2","person":"warlock_right","person2":"king"},{"text":"messages:Quest.troll_9.step3","person":"elf_right","person2":"king"}],"goal":1,"prize":{"exp":200,"coins":10}},"bamboo_1":{"dialogue":[{"text":"messages:Quest.bamboo_1.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.bamboo_1.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.bamboo_1.step3","person":"dwarf","person2":"bear_right"}],"goal":3,"prize":{"exp":20,"coins":5}},"bamboo_2":{"dialogue":[{"text":"messages:Quest.bamboo_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bamboo_2.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":25,"coins":5}},"bamboo_3":{"dialogue":[{"text":"messages:Quest.bamboo_3.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.bamboo_3.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.bamboo_3.step3","person":"dwarf","person2":"worker_right"}],"goal":2,"prize":{"exp":50,"coins":5}},"bamboo_4":{"dialogue":[{"text":"messages:Quest.bamboo_4.step1","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.bamboo_4.step2","person":"elf_right","person2":"dwarf"},{"text":"messages:Quest.bamboo_4.step3","person":"dwarf","person2":"elf_right"}],"goal":2,"prize":{"exp":75,"coins":5}},"bamboo_5":{"dialogue":[{"text":"messages:Quest.bamboo_5.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.bamboo_5.step2","person":"worker_right","person2":"king"},{"text":"messages:Quest.bamboo_5.step3","person":"king","person2":"worker_right"}],"goal":2,"prize":{"exp":100,"coins":5}},"bamboo_6":{"dialogue":[{"text":"messages:Quest.bamboo_6.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.bamboo_6.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.bamboo_6.step3","person":"worker","person2":"dwarf_right"}],"goal":2,"prize":{"exp":125,"coins":10}},"bamboo_7":{"dialogue":[{"text":"messages:Quest.bamboo_7.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bamboo_7.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.bamboo_7.step3","person":"bear_right","person2":"dwarf"}],"goal":2,"prize":{"exp":150,"coins":10}},"bamboo_8":{"dialogue":[{"text":"messages:Quest.bamboo_8.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bamboo_8.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":175,"coins":10}},"bamboo_10":{"dialogue":[{"text":"messages:Quest.bamboo_10.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.bamboo_10.step2","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":200,"coins":10}},"sapphire_1":{"dialogue":[{"text":"messages:Quest.sapphire_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.sapphire_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.sapphire_1.step3","person":"dwarf","person2":"worker_right"}],"goal":3,"prize":{"exp":20,"coins":5}},"sapphire_2":{"dialogue":[{"text":"messages:Quest.sapphire_2.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.sapphire_2.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":25,"coins":5}},"sapphire_3":{"dialogue":[{"text":"messages:Quest.sapphire_3.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.sapphire_3.step2","person":"worker_right","person2":"dwarf"}],"goal":2,"prize":{"exp":50,"coins":5}},"sapphire_4":{"dialogue":[{"text":"messages:Quest.sapphire_4.step1","person":"bear","person2":"worker_right"},{"text":"messages:Quest.sapphire_4.step2","person":"dwarf_right","person2":"bear"},{"text":"messages:Quest.sapphire_4.step3","person":"worker_right","person2":"bear"}],"goal":2,"prize":{"exp":75,"coins":5}},"sapphire_5":{"dialogue":[{"text":"messages:Quest.sapphire_5.step1","person":"elf","person2":"worker_right"},{"text":"messages:Quest.sapphire_5.step2","person":"worker_right","person2":"elf"},{"text":"messages:Quest.sapphire_5.step3","person":"elf","person2":"worker_right"}],"goal":2,"prize":{"exp":100,"coins":5}},"sapphire_6":{"dialogue":[{"text":"messages:Quest.sapphire_6.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.sapphire_6.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.sapphire_6.step3","person":"dwarf","person2":"worker_right"}],"goal":2,"prize":{"exp":125,"coins":10}},"sapphire_7":{"dialogue":[{"text":"messages:Quest.sapphire_7.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.sapphire_7.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.sapphire_7.step3","person":"worker","person2":"dwarf_right"}],"goal":2,"prize":{"exp":150,"coins":10}},"sapphire_8":{"dialogue":[{"text":"messages:Quest.sapphire_8.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.sapphire_8.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.sapphire_8.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.sapphire_8.step4","person":"bear_right","person2":"dwarf"}],"goal":2,"prize":{"exp":175,"coins":10}},"sapphire_9":{"dialogue":[{"text":"messages:Quest.sapphire_9.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.sapphire_9.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.sapphire_9.step3","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.sapphire_9.step4","person":"dwarf_right","person2":"worker"}],"goal":2,"prize":{"exp":200,"coins":10}},"sapphire_11":{"dialogue":[{"text":"messages:Quest.sapphire_11.step1","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.sapphire_11.step2","person":"elf_right","person2":"dwarf"},{"text":"messages:Quest.sapphire_11.step3","person":"dwarf","person2":"elf_right"},{"text":"messages:Quest.sapphire_11.step4","person":"elf_right","person2":"dwarf"}],"goal":1,"prize":{"exp":225,"coins":15}},"knight_1":{"dialogue":[{"text":"messages:Quest.knight_1.step1","person":"dwarf","person2":"king_right"},{"text":"messages:Quest.knight_1.step2","person":"king_right","person2":"dwarf"}],"goal":1,"prize":{"exp":20,"coins":5}},"knight_2":{"dialogue":[{"text":"messages:Quest.knight_2.step1","person":"dwarf","person2":"troll_right"},{"text":"messages:Quest.knight_2.step2","person":"troll_right","person2":"dwarf"},{"text":"messages:Quest.knight_2.step3","person":"dwarf","person2":"troll_right"},{"text":"messages:Quest.knight_2.step4","person":"troll_right","person2":"dwarf"}],"goal":1,"prize":{"exp":25,"coins":5}},"knight_3":{"dialogue":[{"text":"messages:Quest.knight_3.step1","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.knight_3.step2","person":"bear_right","person2":"dwarf"},{"text":"messages:Quest.knight_3.step3","person":"dwarf","person2":"bear_right"},{"text":"messages:Quest.knight_3.step4","person":"bear_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":5}},"knight_4":{"dialogue":[{"text":"messages:Quest.knight_4.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.knight_4.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.knight_4.step3","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.knight_4.step4","person":"dwarf_right","person2":"worker"}],"goal":1,"prize":{"exp":75,"coins":5}},"knight_5":{"dialogue":[{"text":"messages:Quest.knight_5.step1","person":"dwarf","person2":"warlock_right"},{"text":"messages:Quest.knight_5.step2","person":"warlock_right","person2":"dwarf"},{"text":"messages:Quest.knight_5.step3","person":"dwarf","person2":"warlock_right"}],"goal":1,"prize":{"exp":100,"coins":5}},"knight_6":{"dialogue":[{"text":"messages:Quest.knight_6.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.knight_6.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.knight_6.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.knight_6.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":125,"coins":10}},"knight_7":{"dialogue":[{"text":"messages:Quest.knight_7.step1","person":"king","person2":"worker_right"},{"text":"messages:Quest.knight_7.step2","person":"worker_right","person2":"king"}],"goal":1,"prize":{"exp":150,"coins":10}},"knight_8":{"dialogue":[{"text":"messages:Quest.knight_8.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.knight_8.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.knight_8.step3","person":"worker","person2":"dwarf_right"}],"goal":1,"prize":{"exp":175,"coins":10}},"knight_9":{"dialogue":[{"text":"messages:Quest.knight_9.step1","person":"bear","person2":"dwarf_right"},{"text":"messages:Quest.knight_9.step2","person":"dwarf_right","person2":"bear"},{"text":"messages:Quest.knight_9.step3","person":"bear","person2":"dwarf_right"}],"goal":1,"prize":{"exp":200,"coins":10}},"knight_10":{"dialogue":[{"text":"messages:Quest.knight_10.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.knight_10.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.knight_10.step3","person":"dwarf","person2":"worker_right"}],"goal":1,"prize":{"exp":225,"coins":15}},"r_collectfruit":{"goal":[6,12],"prize":{"exp":50,"coins":5}},"r_createfruit":{"goal":[1,2],"prize":{"exp":15,"coins":10}},"r_bonusmerge":{"goal":[3,6],"prize":{"exp":50,"coins":10}},"r_open_freechest":{"goal":3,"prize":{"exp":50,"coins":5}},"r_open_herochest":{"goal":[1,3],"prize":{"exp":125,"coins":10}},"r_open_randomchest":{"goal":[5,10],"prize":{"exp":50,"coins":5}},"r_use_randomcastle":{"goal":2,"prize":{"exp":50,"coins":5}},"r_use_randommine":{"goal":[5,10],"prize":{"exp":50,"coins":5}},"r_builditems":{"goal":[15,30],"prize":{"exp":50,"coins":10}},"woodgenerator_1":{"dialogue":[{"text":"messages:Quest.woodgenerator_1.step1","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.woodgenerator_1.step2","person":"worker_right","person2":"dwarf"},{"text":"messages:Quest.woodgenerator_1.step3","person":"dwarf","person2":"worker_right"},{"text":"messages:Quest.woodgenerator_1.step4","person":"worker_right","person2":"dwarf"}],"goal":1,"prize":{"exp":50,"coins":25}},"woodgenerator_2":{"dialogue":[{"text":"messages:Quest.woodgenerator_2.step1","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.woodgenerator_2.step2","person":"dwarf_right","person2":"worker"},{"text":"messages:Quest.woodgenerator_2.step3","person":"worker","person2":"dwarf_right"},{"text":"messages:Quest.woodgenerator_2.step4","person":"dwarf_right","person2":"worker"}],"goal":1,"prize":{"exp":100,"coins":40}}}}',
inline:!0},crown_json:"@jsons/level_crown-e904aad65e.json",pack_icon_json:"@jsons/icon_pack1-7fbeaf6294.json",pack1_icon_json:"@jsons/icon_pack2-8762a7422b.json",pack2_icon_json:"@jsons/icon_pack3-83801f7d10.json",premium_icon_json:"@jsons/icon_premium-66e0e30c1f.json",energy_feast_icon_json:"@jsons/energy_tournament-0c6bde045e.json",coins_feast_icon_json:"@jsons/coins_tournament-b344f62a3c.json",battlepass_icon_json:"@jsons/battlepass_icon-9b2581bfc4.json",coins_time_icon_json:"@jsons/coinstime_icon-d55a09a2da.json",energy_time_icon_json:"@jsons/energybox-bc83107f5f.json",orders_json:"@jsons/orders_icon-3704aded22.json",units_shop_json:"@jsons/market_icon-b2c01578b1.json",units_library_json:"@jsons/units_icon-b7f7e718c4.json",transition_json:"@jsons/transition-1def927b5d.json",default_json:"@jsons/dwarf_dialogue-9a98cb93aa.json",worker_json:"@jsons/worker_dialogue-15774db988.json",dwarf_json:"@jsons/dwarf_dialogue-9a98cb93aa.json",king_json:"@jsons/king_dialogue-d39ef28038.json",
bear_json:"@jsons/bear_dialogue-278fac3cde.json",elf_json:"@jsons/elf_dialogue-02edab26ca.json",warlock_json:"@jsons/warlock_dialogue-7e6976dbfc.json",troll_json:"@jsons/troll_dialogue-948b91fed2.json",miner_json:"@jsons/miner_dialogue-a25b10be99.json",seller_json:"@jsons/seller-bbdbd6ffb6.json",knight_json:"@jsons/knight_dialogue-154350e4bc.json",ow_rewards_highlight_json:"@jsons/orders-202ff163f6.json",plist:"@%n-d1f581d8f0.plist",atlas:"@%n-d1f581d8f0.atlas"},frames:{notification_bg_png:"#%n-notification-notification_bg.png",fb_icon_png:"#%n-socialicons-fb_icon.png",ok_icon_png:"#%n-socialicons-ok_icon.png",vk_icon_png:"#%n-socialicons-vk_icon.png",xsolla_icon_png:"#%n-socialicons-xsolla_icon.png",nk_icon_png:"#%n-socialicons-nk_icon.png",mm_icon_png:"#%n-socialicons-mm_icon.png",fs_icon_png:"#%n-socialicons-fs_icon.png",draugiem_icon_png:"#%n-socialicons-draugiem_icon.png",mobage_icon_png:"#%n-socialicons-mobage_icon.png",google_icon_png:"#%n-socialicons-google_icon.png",
apple_icon_png:"#%n-socialicons-apple_icon.png",white_button_png:"#%n-socialicons-white_button.png",white_outline_button_png:"#%n-socialicons-white_outline_button.png",white_outline_button_on_png:"#%n-socialicons-white_outline_button_on.png",white_shadow_button_png:"#%n-socialicons-white_shadow_button.png",white_shadow_button_on_png:"#%n-socialicons-white_shadow_button_on.png",blue_outline_button_png:"#%n-socialicons-blue_outline_button.png",blue_outline_button_on_png:"#%n-socialicons-blue_outline_button_on.png",select_friend_checkbox:"#%n-selectfriends-checkbox_sf.png",select_friend_checkbox_selected:"#%n-selectfriends-checkbox_mark.png",light_bg_png:"#%n-tournament-light_bg.png",light_bg_you_png:"#%n-tournament-light_bg_you.png",row_player_png:"#%n-tournament-row_player.png",row_you_png:"#%n-tournament-row_you.png",levelstart_cup_1:"#%n-leaderboard-1_place.png",levelstart_cup_2:"#%n-leaderboard-2_place.png",levelstart_cup_3:"#%n-leaderboard-3_place.png",
shop_tab_off:"#%n-base-tab_2.png",shop_tab_on:"#%n-base-tab_1.png",wood_bg:"#%n-base-window_background.png",android_avatar:"#%n-avatars-android_avatar.png",ios_avatar:"#%n-avatars-ios_avatar.png",user_avatar:"#%n-avatars-user_avatar.png",default_avatar:"#%n-avatars-default_avatar.jpg",window_title_bg_png:"#%n-windows-window_title_bg.png",timer_bg_png:"#%n-ui-timer_substrate.png",tooltip_bg_png:"#%n-tooltip-box.png",tooltip_shadow_arrow_png:"#%n-tooltip-arrow.png",tooltip_arrow_png:"#%n-tooltip-arrow2.png",gold_small_png:"#%n-reward_icons-ruby_small.png",reward_gold_png:"#%n-reward_icons-ruby.png",coin_small_png:"#%n-reward_icons-coin_small.png",reward_coin_png:"#%n-reward_icons-coin.png",reward_exp_png:"#%n-reward_icons-exp.png",reward_wand_png:"#%n-reward_icons-wand.png",reward_worker_png:"#%n-reward_icons-worker.png",reward_energy_png:"#%n-reward_icons-energy.png",shop_energy_png:"#%n-reward_icons-energy_shop.png",shop_gold_png:"#%n-reward_icons-ruby_shop.png",
shop_coin_png:"#%n-reward_icons-coin_shop.png",window_bg_png:"#%n-base-window_background.png",tab_attention:"#%n-orderswindow-attention_exclamation_large.png",tab_icon_specials:"#%n-tabs-specials.png",tab_icon_orders:"#%n-tabs-orders.png",tab_icon_recipes:"#%n-tabs-recipes.png",tab_icon_ingredients:"#%n-tabs-ingredients.png",tab_icon_chest:"#%n-tabs-chest.png",tab_icon_fruit:"#%n-tabs-fruit.png",tab_icon_heroes:"#%n-tabs-heroes.png",tab_icon_resource:"#%n-tabs-resource.png",tab_icon_source:"#%n-tabs-source.png",tab_icon_valuable:"#%n-tabs-valuable.png",window_title_background:"#%n-base-window_title_background.png",window_foreground_png:"#%n-base-window_foreground.png",window_close_png:"#%n-base-close_button.png",window_close_on_png:"#%n-base-close_button_on.png",adicon_png:"#%n-shared-adicon.png",tutorial_click_png:"#%n-tutorial-circle.png",tutorial_hand_png:"#%n-tutorial-hand.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",
nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",
default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",
default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",
default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png",toolbar_attention_icon_png:"#%n-orderswindow-attention_exclamation.png",menu_icon_png:"#%n-controlbuttons-menu.png",button_png:"#%n-controlbuttons-menu_button.png",button_on_png:"#%n-controlbuttons-menu_button_on.png",fullscreen_icon_png:"#%n-controlbuttons-fullscreen_icon.png",back_button_png:"#%n-controlbuttons-back_button.png",back_button_on_png:"#%n-controlbuttons-back_button_on.png",back_icon_png:"#%n-controlbuttons-back.png",life_png:"#%n-menubar-energy.png",coin_png:"#%n-menubar-ruby.png",menubar_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",plus_button_on_png:"#%n-menubar-plus_on.png",bar_timer_png:"#%n-menubar-bar_timer.png",
small_timer_icon_png:"#%n-menubar-timer.png",menubar_attention_png:"#%n-orderswindow-attention_exclamation_large.png",menubar_progress_png:"#%n-level-progressbar.png",menubar_round_bg_png:"#%n-level-level_round.png",merge_coin_png:"#%n-menubar-coin.png",merge_wand_png:"#%n-menubar-wand.png",merge_worker_png:"#%n-menubar-worker.png",window_button_png:"#%n-buttons-button.png",window_button_on_png:"#%n-buttons-button_on.png",window_button_disabled_png:"#%n-buttons-button_off.png",blue_button_png:"#%n-buttons-button_blue.png",blue_button_on_png:"#%n-buttons-button_blue_on.png",small_blue_button:"#%n-buttons-small_blue_button.png",small_blue_button_on:"#%n-buttons-small_blue_button_on.png",help_button_png:"#%n-buttons-help_small.png",help_button_on_png:"#%n-buttons-help_small_on.png",exit_button_icon:"#%n-buttons-exit_icon.png",scene_exit_button:"#%n-buttons-scene_exit.png",small_green_button:"#%n-buttons-small_green_button.png",small_green_button_on:"#%n-buttons-small_green_button_on.png",
music_off_png:"#%n-sounds-music_off.png",music_on_png:"#%n-sounds-music_on.png",sound_off_png:"#%n-sounds-sound_off.png",sound_on_png:"#%n-sounds-sound_on.png",close_small:"#%n-buttons-close_small.png",close_small_on:"#%n-buttons-close_small_on.png",red_button:"#%n-buttons-red_button.png",red_button_on:"#%n-buttons-red_button_on.png",icon_bg:"#%n-sidebar-icon_bg.png",lock:"#%n-sidebar-lock_sidebar.png",attention_png:"#%n-orderswindow-attention_exclamation_large.png",icon_text_bg:"#%n-sidebar-icon_text_bg.png",caption_bg:"#%n-sidebar-icon_text_bg.png",bounty_ready_icon:"#%n-friend_messages-bounty_ready_icon.png",avatar_frame:"#%n-avatars-avatar_frame.png",avatar_frame2:"#%n-avatars-avatar_frame2.png",bg_png:"#%n-dialogues-bg.png",dialogue_name:"#%n-dialogues-char_name_bg.png",arrow_png:"#%n-dialogues-arrow_bg.png",bg_minimal_png:"#%n-dialogues-mini_bg.png",hero_background:"#%n-orderswindow-hero_bg.png",hero_selected_background:"#%n-orderswindow-chosen_hero_bg.png",
plus_separator:"#%n-orderswindow-plus.png",equal_separator:"#%n-orderswindow-equally.png",worker_hint_png:"#%n-hint-worker_hint.png",info_background:"#%n-orderswindow-icon_background.png",timer_substrate:"#%n-game-bar_bg.png",sanglass_timer_icon:"#%n-speedup-speedup_sandglass.png",ow_tab_header_on:"#%n-base-window_title_background.png",ow_scroll_background:"#%n-orderswindow-hero_bg.png",icon_unknown:"#%n-heroes-unknown.png",icon_dwarf:"#%n-heroes-dwarf.png",icon_king:"#%n-heroes-king.png",icon_bear:"#%n-heroes-bear.png",icon_elf:"#%n-heroes-elf.png",icon_warlock:"#%n-heroes-warlock.png",icon_troll:"#%n-heroes-troll.png",icon_knight:"#%n-heroes-knight.png",horizontal_scroll_foreground:"#%n-orderswindow-horizontal_scroll_foreground.png"}},map_decorators:{urls:{},injectTo:["tiles"],frameIds:["bush5","decorator_acorn","decorator_blue_rock10","decorator_break_left","decorator_break_right","decorator_bumps","decorator_bush","decorator_bush2","decorator_bush3","decorator_bush4",
"decorator_bush6","decorator_cactus","decorator_cactus2","decorator_cactus_1","decorator_cactus_2","decorator_cave","decorator_cave2","decorator_cave3","decorator_columns","decorator_crystal","decorator_door","decorator_dragon_tale","decorator_eggs","decorator_eggs2","decorator_fence","decorator_frozen_tree","decorator_gem1","decorator_gem10","decorator_gem11","decorator_gem2","decorator_gem3","decorator_gem4","decorator_gem5","decorator_gem6","decorator_gem7","decorator_gem8","decorator_gem9","decorator_green_stone","decorator_green_stone1","decorator_ice_arc","decorator_ice_cave","decorator_ice_crystall","decorator_ice_crystall_2","decorator_ice_eggs","decorator_ice_fir","decorator_ice_siderock","decorator_ice_stairway","decorator_ice_waterfall","decorator_icerock_1","decorator_icerock_10","decorator_icerock_2","decorator_icerock_3","decorator_icerock_4","decorator_icerock_5","decorator_icerock_6","decorator_icerock_7","decorator_icerock_8","decorator_icerock_9","decorator_iglu",
"decorator_island","decorator_lava","decorator_leaf","decorator_leaf2","decorator_leaf3","decorator_leaf4","decorator_leaf_stone","decorator_leaf_stone2","decorator_light_plant","decorator_light_plant1","decorator_lilies","decorator_mushroom1","decorator_mushroom2","decorator_pillar1","decorator_pillar2","decorator_pillar3","decorator_pillar4","decorator_plant","decorator_plant2","decorator_plant3","decorator_purple_rock10","decorator_rock","decorator_rock10","decorator_rock11","decorator_rock12","decorator_rock13","decorator_rock14","decorator_rock15","decorator_rock16","decorator_rock17","decorator_rock18","decorator_rock19","decorator_rock2","decorator_rock20","decorator_rock3","decorator_rock4","decorator_rock5","decorator_rock6","decorator_rock7","decorator_rock8","decorator_rock9","decorator_roots","decorator_roots2","decorator_roots3","decorator_roots4","decorator_sand_cracks","decorator_sand_cracks2","decorator_sand_cracks3","decorator_sand_rock","decorator_sand_rock10",
"decorator_sand_waterfall","decorator_sandcave_1","decorator_sandcave_2","decorator_sandcave_3","decorator_sandcave_4","decorator_sandcave_5","decorator_sandcave_6","decorator_sandrock_1","decorator_sandrock_2","decorator_sandrock_3","decorator_sandrock_4","decorator_sandstone","decorator_slope","decorator_snow_rock","decorator_snow_rock10","decorator_snowdrift","decorator_snowman","decorator_stairs","decorator_stairs2","decorator_stone1","decorator_stone2","decorator_stone4","decorator_stone5","decorator_tree","decorator_tumbleweed","decorator_water_grid","decorator_water_stone","decorator_water_stone1","decorator_waterfall","decorator_waterfall2","decorator_waterice"],jsonIds:[],soundIds:[],unpackedIds:[]},memorial:{urls:{}},menubar:{urls:{},injectTo:["minesweeper","game","main"],frameIds:["life_png","coin_png","%n_bg_png","plus_button_png","plus_button_on_png","bar_timer_png","small_timer_icon_png","%n_attention_png","%n_progress_png","%n_round_bg_png","merge_coin_png",
"merge_wand_png","merge_worker_png"],jsonIds:["crown_json"],soundIds:[],unpackedIds:[]},merge:{urls:{},injectTo:["game"],frameIds:["generator_star_on","generator_star_off","bar_png","bar_bg_png","pickaxe","seller_icon","hint_background_png","upgradable_level_png","upgradable_bar_png","upgradable_bar_bg_png","guide_button_png","guide_button_on_png","first_place_prize_png","second_place_prize_png","third_place_prize_png","stand_ground"],jsonIds:["recipe_bubble_down_json","recipe_bubble_up_json","change_stage_cloud_json","appearance_json","destruction_json","reward_highlight_json","flickering_json","%n_json","hint_json","rays_json","pixels_json","adsbarrel_json","bonus_shining_json","specialoffer_helicopter_json","battle_star","prize_shining_json"],soundIds:["%n_effect","new_order_effect","prize_view_created_effect","spawn_start_effect","spawn_landing_effect","spawn_fail_effect","spawn_beetle_effect","specialoffer_appearance_effect","specialoffer_window_effect",
"specialoffer_buying_effect","specialoffer_destruction_effect","specialoffer_helicopter_effect","instantworker_build_effect","unit_desturction_effect","coins_drop_effect","upgradable_build_effect","pixel_fly_effect","pixel_spawn_effect","barrel_appear_sfx"],unpackedIds:[]},mergeui:{urls:{},injectTo:["game"],frameIds:["background","background_warning","pointer","pointer2","pointer2_warning","timer_icon_large","timer_substrate","timer_icon_png","timer_ribbon_icon_png","watch_ad_icon","coins_feast_icon","energy_time_icon1","energy_time_icon2","energy_time_icon3","progress_background","progress_stroke","progress_bar","small_attention_exclamation","small_attention_exclamation_disabled","small_ok_exclamation","attention_ok","attention_exclamation","attention_exclamation_disabled","attention_sandglass","attention_coin","icon_background","icon_background_light","icon_blocker","next_arrow","details_background"],jsonIds:["timer_json"],soundIds:[],unpackedIds:[]},metha_simple_main:{urls:{}},
metha_top_layer_0:{urls:{}},mineable:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["mining_start_json"],soundIds:["mining_start_effect","mining_wood_start_effect","mining_stone_start_effect","mining_wagon_start_effect"],unpackedIds:[]},minesweeper:{urls:{background:"@mine_bg-80472b209d.jpg",pickaxe_sfx:"~sounds/sh_s_mine_pick-0a4b67c384.mp3",bomb_sfx:"~sounds/sh_s_mine_bomb-138b718681.mp3",mine_vin_sfx:"~sounds/mine_bonus-f9a6fcbb66.mp3",miner_fail_sfx:"~sounds/dwarf_lose-dd54669226.mp3",miner_good_sfx:"~sounds/dwarf_win-d54cd1a686.mp3",victory_sfx:"~sounds/sh_s_mine_win-b422bddbd6.mp3",buy_continue_sfx:"~sounds/sh_s_mine_no_bomb-d6e71bc122.mp3",mine_music:"~sounds/mine_music-6e08d898f5.mp3",png:"@%n-e7232556d5.png",json:"@%n-8f39d8ae27.json"},jsons:{minesweeper:"@jsons/%n-3531e526ba.json",bg_json:"@jsons/mine_bg-8f1ab5b900.json",custom_cursor_json:"@jsons/pickaxe-ef40eb38d2.json",victory_animation:"@jsons/mine_victory-673e41778e.json",crown_json:"@jsons/level_crown-e904aad65e.json",
plist:"@%n-e7232556d5.plist",atlas:"@%n-e7232556d5.atlas"},frames:{progressbar:"#%n-progressbar.png",guide_button_png:"#%n-guide_button.png",guide_button_on_png:"#%n-guide_button_on.png",flag_png:"#%n-%n_flag.png",bucket_png:"#%n-%n_bucket.png",details_background:"#%n-orderswindow-icon_background.png",gold_small_png:"#%n-reward_icons-ruby_small.png",reward_gold_png:"#%n-reward_icons-ruby.png",coin_small_png:"#%n-reward_icons-coin_small.png",reward_coin_png:"#%n-reward_icons-coin.png",reward_exp_png:"#%n-reward_icons-exp.png",reward_wand_png:"#%n-reward_icons-wand.png",reward_worker_png:"#%n-reward_icons-worker.png",reward_energy_png:"#%n-reward_icons-energy.png",shop_energy_png:"#%n-reward_icons-energy_shop.png",shop_gold_png:"#%n-reward_icons-ruby_shop.png",shop_coin_png:"#%n-reward_icons-coin_shop.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",
nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",
default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",
default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",
default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png",life_png:"#%n-menubar-energy.png",coin_png:"#%n-menubar-ruby.png",menubar_bg_png:"#%n-menubar-bar_bg.png",plus_button_png:"#%n-menubar-plus.png",plus_button_on_png:"#%n-menubar-plus_on.png",bar_timer_png:"#%n-menubar-bar_timer.png",small_timer_icon_png:"#%n-menubar-timer.png",menubar_attention_png:"#%n-orderswindow-attention_exclamation_large.png",menubar_progress_png:"#%n-level-progressbar.png",menubar_round_bg_png:"#%n-level-level_round.png",merge_coin_png:"#%n-menubar-coin.png",merge_wand_png:"#%n-menubar-wand.png",merge_worker_png:"#%n-menubar-worker.png"}},moves:{urls:{},injectTo:["game"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},newelements:{urls:{quest_new_effect:"~sounds/quest_new-b06184316e.mp3",quest_completed_effect:"~sounds/quest_completed-2f7bbc5994.mp3",
png:"@%n-44a73a3d50.png",json:"@%n-07f945f120.json"},jsons:{scroll_json:"@jsons/scroll-a3150f37dd.json",shining_json:"@jsons/shining-7974626fa1.json",plist:"@%n-44a73a3d50.plist",atlas:"@%n-44a73a3d50.atlas"},frames:{elements_icon_bg:"#%n-icon_bg.png"}},openchestwindow:{urls:{},injectTo:["game"],frameIds:["icon_background","icon_background_light"],jsonIds:[],soundIds:[],unpackedIds:[]},orderswindow:{urls:{},injectTo:["main"],frameIds:["hero_background","hero_selected_background","plus_separator","equal_separator"],jsonIds:["ow_rewards_highlight_json"],soundIds:[],unpackedIds:[]},particle:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%ns_drag_json","%ns_spawn_json","%ns_collect_json","levelup_path_json"],soundIds:[],unpackedIds:["%n_texture"]},piggybank_window:{urls:{}},promotion_adventure_en:{urls:{image:"@adventure-5d35db83ca.jpg"}},promotion_adventure_ru:{urls:{image:"@adventure-81c39864ca.jpg"}},promotion_crocword_de:{urls:{image:"@crocword-8e180fa28c.jpg"}},
promotion_crocword_en:{urls:{image:"@crocword-50a3c2e09b.jpg"}},promotion_crocword_es:{urls:{image:"@crocword-5d726c18ef.jpg"}},promotion_crocword_fr:{urls:{image:"@crocword-b29ec54414.jpg"}},promotion_crocword_it:{urls:{image:"@crocword-52921a2490.jpg"}},promotion_crocword_ru:{urls:{image:"@crocword-04c2173528.jpg"}},promotion_differences_en:{urls:{image:"@differences-f96d4306e7.jpg"}},promotion_differences_ru:{urls:{image:"@differences-247f801ff4.jpg"}},promotion_heroes_en:{urls:{image:"@heroes-a832bb6d6d.jpg"}},promotion_heroes_ru:{urls:{image:"@heroes-09bae5b254.jpg"}},promotion_magicwords_de:{urls:{image:"@magicwords-27fe6117a0.jpg"}},promotion_magicwords_en:{urls:{image:"@magicwords-04657482ac.jpg"}},promotion_magicwords_es:{urls:{image:"@magicwords-9992e631df.jpg"}},promotion_magicwords_fr:{urls:{image:"@magicwords-39ad2d700d.jpg"}},promotion_magicwords_it:{urls:{image:"@magicwords-da3d9e149d.jpg"}},promotion_magicwords_ru:{urls:{image:"@magicwords-27091fcfcc.jpg"}},
promotion_mergecraft_en:{urls:{image:"@mergecraft-14d19e6dc3.jpg"}},promotion_mergecraft_ru:{urls:{image:"@mergecraft-801c1a3952.jpg"}},promotion_olympics_de:{urls:{image:"@olympics-499c616821.jpg"}},promotion_olympics_en:{urls:{image:"@olympics-fb3fadbc6f.jpg"}},promotion_olympics_es:{urls:{image:"@olympics-767b28ab28.jpg"}},promotion_olympics_fr:{urls:{image:"@olympics-28fa89a300.jpg"}},promotion_olympics_it:{urls:{image:"@olympics-a9eb2d4445.jpg"}},promotion_olympics_ru:{urls:{image:"@olympics-657a1659cd.jpg"}},promotion_riddles_en:{urls:{image:"@riddles-6e4a64f461.jpg"}},promotion_riddles_ru:{urls:{image:"@riddles-a04f70fa4d.jpg"}},promotion_runes_en:{urls:{image:"@runes-4189fa6106.jpg"}},promotion_runes_ru:{urls:{image:"@runes-8ea348dfc8.jpg"}},promotion_scramble_en:{urls:{image:"@scramble-245e9c08c0.jpg"}},promotion_scramble_fr:{urls:{image:"@scramble-da8e269592.jpg"}},promotion_scramble_ru:{urls:{image:"@scramble-5a0aa23d2f.jpg"}},promotion_tripeaks_de:{urls:{
image:"@tripeaks-d748eb75e8.jpg"}},promotion_tripeaks_en:{urls:{image:"@tripeaks-228cedda9d.jpg"}},promotion_tripeaks_es:{urls:{image:"@tripeaks-e80b0dbc61.jpg"}},promotion_tripeaks_fr:{urls:{image:"@tripeaks-c7665a69ae.jpg"}},promotion_tripeaks_it:{urls:{image:"@tripeaks-82d49cd2e2.jpg"}},promotion_tripeaks_ru:{urls:{image:"@tripeaks-2efc59480b.jpg"}},promotion_wordsoup_de:{urls:{image:"@wordsoup-8392808e0c.jpg"}},promotion_wordsoup_en:{urls:{image:"@wordsoup-26337c641b.jpg"}},promotion_wordsoup_es:{urls:{image:"@wordsoup-cde236a3a6.jpg"}},promotion_wordsoup_fr:{urls:{image:"@wordsoup-d02f7f9b50.jpg"}},promotion_wordsoup_it:{urls:{image:"@wordsoup-c9f4605075.jpg"}},promotion_wordsoup_ru:{urls:{image:"@wordsoup-4b87340634.jpg"}},repeated_quests:{urls:{},injectTo:["game"],frameIds:["bonus_merge","build_object"],jsonIds:[],soundIds:[],unpackedIds:[]},request_center:{urls:{},injectTo:["main"],frameIds:["bounty_ready_icon"],jsonIds:[],soundIds:[],unpackedIds:[]},reward_element:{urls:{},
injectTo:["game"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},reward_icons:{urls:{},injectTo:["slot_machine","battle_pass","minesweeper","tile_shop","main","admin"],frameIds:["gold_small_png","reward_gold_png","coin_small_png","reward_coin_png","reward_exp_png","reward_wand_png","reward_worker_png","reward_energy_png","shop_energy_png","shop_gold_png","shop_coin_png"],jsonIds:[],soundIds:[],unpackedIds:[]},rose_tournament:{urls:{}},rotate_phone:{urls:{rotate_png:"@phoneturn_horizontal-b996b69ae0.png"}},ruby_tournament:{urls:{}},select_friend_window:{urls:{},injectTo:["main"],frameIds:[],jsonIds:[],soundIds:[],unpackedIds:[]},shared:{urls:{},injectTo:["game","main"],frameIds:["adicon_png"],jsonIds:[],soundIds:[],unpackedIds:[]},shine:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n_animation_json"],soundIds:[],unpackedIds:[]},sidebar:{urls:{},injectTo:["game","main"],frameIds:["icon_bg","lock","attention_png","icon_text_bg","caption_bg"],jsonIds:["pack_icon_json",
"pack1_icon_json","pack2_icon_json","premium_icon_json","energy_feast_icon_json","coins_feast_icon_json","battlepass_icon_json","coins_time_icon_json","energy_time_icon_json","orders_json","units_shop_json","units_library_json"],soundIds:[],unpackedIds:[]},simple:{urls:{}},slot_machine:{urls:{png:"@%n-d9cbde7fdd.png",json:"@%n-09a8856c4c.json"},jsons:{plist:"@%n-d9cbde7fdd.plist"},frames:{gold_small_png:"#%n-reward_icons-ruby_small.png",reward_gold_png:"#%n-reward_icons-ruby.png",coin_small_png:"#%n-reward_icons-coin_small.png",reward_coin_png:"#%n-reward_icons-coin.png",reward_exp_png:"#%n-reward_icons-exp.png",reward_wand_png:"#%n-reward_icons-wand.png",reward_worker_png:"#%n-reward_icons-worker.png",reward_energy_png:"#%n-reward_icons-energy.png",shop_energy_png:"#%n-reward_icons-energy_shop.png",shop_gold_png:"#%n-reward_icons-ruby_shop.png",shop_coin_png:"#%n-reward_icons-coin_shop.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",
nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",
default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",
default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",
default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},slot_machine_rules_window:{urls:{}},sounds:{urls:{}},specialenergyofferwindow:{urls:{png:"@%n-12d28519d4.png",json:"@%n-c447d734b8.json"},jsons:{jinn_lamp_json:"@jsons/jinn_lamp-4fc3014b59.json",jinn_json:"@jsons/jinn-78433219cf.json",atlas:"@%n-12d28519d4.atlas"}},starchest_window:{urls:{}},starter_pack:{urls:{starter_pack_effect:"~sounds/%n-fedcb853ee.mp3",png:"@%n-0044338dbe.png",json:"@%n-df2f8e8a20.json"},jsons:{pack_json:"@jsons/%n-f2985a0f7d.json",atlas:"@%n-0044338dbe.atlas"}},store_links:{urls:{amazon_png:"@amazon-fff217ce99.png",ios_png:"@appstore-7ca2da36e4.png",android_png:"@googleplay-d959d72ee5.png"}},stuck_window:{urls:{}},subscription_window:{urls:{
png:"@%n-7607e50faf.png",json:"@%n-ec7fb0a57c.json"},jsons:{subscription_json:"@jsons/subscription-0b76254c28.json",plist:"@%n-7607e50faf.plist",atlas:"@%n-7607e50faf.atlas"},frames:{subscription_amount_png:"#%n-subscription-starter_letter.png",subscription_energy_png:"#%n-subscription-subscription_energy.png",subscription_worker_png:"#%n-subscription-subscription_dworf.png",subscription_chest_png:"#%n-subscription-subscription_chest.png",subscription_timer_substrate:"#%n-subscription-timer_substrate.png",subscription_timer_icon:"#%n-subscription-timer_icon.png"}},temp_good_finish_window:{urls:{}},tile_shop:{urls:{badge_appear_effect:"~sounds/badge_appear-7102ce72e2.mp3",png:"@%n-07a6d6e9e2.png",json:"@%n-76f1c996fb.json"},jsons:{shop_sparkles_small_json:"@jsons/shop_sparkles_small-11e96d2c9e.json",shop_sparkles_large_json:"@jsons/shop_sparkles_large-cba75331e0.json",plist:"@%n-07a6d6e9e2.plist",atlas:"@%n-07a6d6e9e2.atlas"},frames:{shop_tile_bg_png:"#%n-shop_bg_white.png",
feature_tile_bg_png:"#%n-shop_bg_best.png",feature_button_png:"#%n-feature_tile_button.png",feature_button_on_png:"#%n-feature_tile_button_on.png",shop_badge_bestseller_png:"#%n-shop_best_seller.png",tile_stripe_png:"#%n-shop_red_ribbon.png",tile_best_stripe_png:"#%n-shop_red_ribbon_best.png",red_stripe_png:"#%n-shop_purple_ribbon.png",unlimitedLives_png:"#%n-energy_for_video.png",shop_gold1_png:"#%n-shop_coins_500.png",shop_gold2_png:"#%n-shop_coins_500.png",shop_gold3_png:"#%n-shop_coins_1800.png",heap_gold_png:"#%n-shop_coins_3800.png",shop_gold4_png:"#%n-shop_coins_6000.png",shop_gold5_png:"#%n-shop_coins_25000.png",small_shop_button:"#%n-small_shop_button.png",small_shop_button_on:"#%n-small_shop_button_on.png",ok_icon_png:"#%n-socialicons-ok_icon.png",shop_discount_png:"#%n-shop_sale_ribbon.png",shop_discount_png_off:"#%n-shop_sale_ribbon_off.png",tile_best_stripe_png_off:"#%n-shop_red_ribbon_best_off.png",energy_for_coins_png:"#%n-energy_for_coins.png",
energy_for_coins_png_off:"#%n-energy_for_coins_off.png",energy_for_video_png:"#%n-energy_for_video.png",energy_for_video_png_off:"#%n-energy_for_video_off.png",energy_lottery_png:"#%n-energy_lottery.png",energy_lottery_png_off:"#%n-energy_lottery_off.png",soft_currency_small_png:"#%n-soft_currency_small.png",soft_currency_medium_png:"#%n-soft_currency_medium.png",soft_currency_large_png:"#%n-soft_currency_large.png",feature_button_off_png:"#%n-shop_button_off.png",small_shop_button_off:"#%n-shop_button_off.png",shop_timer_icon_png:"#%n-infoview-game_ui_clock.png",gold_small_png:"#%n-reward_icons-ruby_small.png",reward_gold_png:"#%n-reward_icons-ruby.png",coin_small_png:"#%n-reward_icons-coin_small.png",reward_coin_png:"#%n-reward_icons-coin.png",reward_exp_png:"#%n-reward_icons-exp.png",reward_wand_png:"#%n-reward_icons-wand.png",reward_worker_png:"#%n-reward_icons-worker.png",reward_energy_png:"#%n-reward_icons-energy.png",shop_energy_png:"#%n-reward_icons-energy_shop.png",
shop_gold_png:"#%n-reward_icons-ruby_shop.png",shop_coin_png:"#%n-reward_icons-coin_shop.png",nostroke62pt_0:"#%n-marvin-round-nostroke-62pt-0.png",nostroke62pt_1:"#%n-marvin-round-nostroke-62pt-1.png",nostroke62pt_2:"#%n-marvin-round-nostroke-62pt-2.png",nostroke62pt_3:"#%n-marvin-round-nostroke-62pt-3.png",nostroke62pt_4:"#%n-marvin-round-nostroke-62pt-4.png",nostroke62pt_5:"#%n-marvin-round-nostroke-62pt-5.png",nostroke62pt_6:"#%n-marvin-round-nostroke-62pt-6.png",nostroke62pt_7:"#%n-marvin-round-nostroke-62pt-7.png",nostroke62pt_8:"#%n-marvin-round-nostroke-62pt-8.png",nostroke62pt_9:"#%n-marvin-round-nostroke-62pt-9.png",nostroke62pt_colon:"#%n-marvin-round-nostroke-62pt-colon.png",nostroke62pt_slash:"#%n-marvin-round-nostroke-62pt-slash.png",nostroke62pt_plus:"#%n-marvin-round-nostroke-62pt-plus.png",nostroke62pt_minus:"#%n-marvin-round-nostroke-62pt-minus.png",nostroke62pt_x:"#%n-marvin-round-nostroke-62pt-x.png",nostroke62pt_space:"#%n-marvin-round-nostroke-62pt-space.png",
default45pt_0:"#%n-marvin-round-45pt-0.png",default45pt_1:"#%n-marvin-round-45pt-1.png",default45pt_2:"#%n-marvin-round-45pt-2.png",default45pt_3:"#%n-marvin-round-45pt-3.png",default45pt_4:"#%n-marvin-round-45pt-4.png",default45pt_5:"#%n-marvin-round-45pt-5.png",default45pt_6:"#%n-marvin-round-45pt-6.png",default45pt_7:"#%n-marvin-round-45pt-7.png",default45pt_8:"#%n-marvin-round-45pt-8.png",default45pt_9:"#%n-marvin-round-45pt-9.png",default45pt_colon:"#%n-marvin-round-45pt-colon.png",default45pt_slash:"#%n-marvin-round-45pt-slash.png",default45pt_plus:"#%n-marvin-round-45pt-plus.png",default45pt_minus:"#%n-marvin-round-45pt-minus.png",default45pt_x:"#%n-marvin-round-45pt-x.png",default45pt_space:"#%n-marvin-round-45pt-space.png",default45pt_asterisk:"#%n-marvin-round-45pt-asterisk.png",default62pt_0:"#%n-marvin-round-62pt-0.png",default62pt_1:"#%n-marvin-round-62pt-1.png",default62pt_2:"#%n-marvin-round-62pt-2.png",default62pt_3:"#%n-marvin-round-62pt-3.png",
default62pt_4:"#%n-marvin-round-62pt-4.png",default62pt_5:"#%n-marvin-round-62pt-5.png",default62pt_6:"#%n-marvin-round-62pt-6.png",default62pt_7:"#%n-marvin-round-62pt-7.png",default62pt_8:"#%n-marvin-round-62pt-8.png",default62pt_9:"#%n-marvin-round-62pt-9.png",default62pt_colon:"#%n-marvin-round-62pt-colon.png",default62pt_slash:"#%n-marvin-round-62pt-slash.png",default62pt_plus:"#%n-marvin-round-62pt-plus.png",default62pt_minus:"#%n-marvin-round-62pt-minus.png",default62pt_x:"#%n-marvin-round-62pt-x.png",default62pt_space:"#%n-marvin-round-62pt-space.png",default62pt_asterisk:"#%n-marvin-round-62pt-asterisk.png",default76pt_0:"#%n-marvin-round-76pt-0.png",default76pt_1:"#%n-marvin-round-76pt-1.png",default76pt_2:"#%n-marvin-round-76pt-2.png",default76pt_3:"#%n-marvin-round-76pt-3.png",default76pt_4:"#%n-marvin-round-76pt-4.png",default76pt_5:"#%n-marvin-round-76pt-5.png",default76pt_6:"#%n-marvin-round-76pt-6.png",default76pt_7:"#%n-marvin-round-76pt-7.png",
default76pt_8:"#%n-marvin-round-76pt-8.png",default76pt_9:"#%n-marvin-round-76pt-9.png",default76pt_colon:"#%n-marvin-round-76pt-colon.png",default76pt_slash:"#%n-marvin-round-76pt-slash.png",default76pt_plus:"#%n-marvin-round-76pt-plus.png",default76pt_minus:"#%n-marvin-round-76pt-minus.png",default76pt_x:"#%n-marvin-round-76pt-x.png",default76pt_space:"#%n-marvin-round-76pt-space.png",default76pt_asterisk:"#%n-marvin-round-76pt-asterisk.png"}},tiles:{urls:{png:"@%n-b194f8cb3d.png",json:"@%n-c9efa4f789.json"},jsons:{buy_fog_tile_json:"@jsons/island_fx-e1dda0faf8.json",plist:"@%n-b194f8cb3d.plist",atlas:"@%n-b194f8cb3d.atlas"},frames:{water:"#%n-terrain-water.png",fog2_png:"#%n-cloud2-cloud_2.png",bush5:"#%n-decorators-bush5.png",decorator_acorn:"#%n-decorators-decorator_acorn.png",decorator_blue_rock10:"#%n-decorators-decorator_blue_rock10.png",decorator_break_left:"#%n-decorators-decorator_break_left.png",decorator_break_right:"#%n-decorators-decorator_break_right.png",
decorator_bumps:"#%n-decorators-decorator_bumps.png",decorator_bush:"#%n-decorators-decorator_bush.png",decorator_bush2:"#%n-decorators-decorator_bush2.png",decorator_bush3:"#%n-decorators-decorator_bush3.png",decorator_bush4:"#%n-decorators-decorator_bush4.png",decorator_bush6:"#%n-decorators-decorator_bush6.png",decorator_cactus:"#%n-decorators-decorator_cactus.png",decorator_cactus2:"#%n-decorators-decorator_cactus2.png",decorator_cactus_1:"#%n-decorators-decorator_cactus_1.png",decorator_cactus_2:"#%n-decorators-decorator_cactus_2.png",decorator_cave:"#%n-decorators-decorator_cave.png",decorator_cave2:"#%n-decorators-decorator_cave2.png",decorator_cave3:"#%n-decorators-decorator_cave3.png",decorator_columns:"#%n-decorators-decorator_columns.png",decorator_crystal:"#%n-decorators-decorator_crystal.png",decorator_door:"#%n-decorators-decorator_door.png",decorator_dragon_tale:"#%n-decorators-decorator_dragon_tale.png",decorator_eggs:"#%n-decorators-decorator_eggs.png",
decorator_eggs2:"#%n-decorators-decorator_eggs2.png",decorator_fence:"#%n-decorators-decorator_fence.png",decorator_frozen_tree:"#%n-decorators-decorator_frozen_tree.png",decorator_gem1:"#%n-decorators-decorator_gem1.png",decorator_gem10:"#%n-decorators-decorator_gem10.png",decorator_gem11:"#%n-decorators-decorator_gem11.png",decorator_gem2:"#%n-decorators-decorator_gem2.png",decorator_gem3:"#%n-decorators-decorator_gem3.png",decorator_gem4:"#%n-decorators-decorator_gem4.png",decorator_gem5:"#%n-decorators-decorator_gem5.png",decorator_gem6:"#%n-decorators-decorator_gem6.png",decorator_gem7:"#%n-decorators-decorator_gem7.png",decorator_gem8:"#%n-decorators-decorator_gem8.png",decorator_gem9:"#%n-decorators-decorator_gem9.png",decorator_green_stone:"#%n-decorators-decorator_green_stone.png",decorator_green_stone1:"#%n-decorators-decorator_green_stone1.png",decorator_ice_arc:"#%n-decorators-decorator_ice_arc.png",decorator_ice_cave:"#%n-decorators-decorator_ice_cave.png",
decorator_ice_crystall:"#%n-decorators-decorator_ice_crystall.png",decorator_ice_crystall_2:"#%n-decorators-decorator_ice_crystall_2.png",decorator_ice_eggs:"#%n-decorators-decorator_ice_eggs.png",decorator_ice_fir:"#%n-decorators-decorator_ice_fir.png",decorator_ice_siderock:"#%n-decorators-decorator_ice_siderock.png",decorator_ice_stairway:"#%n-decorators-decorator_ice_stairway.png",decorator_ice_waterfall:"#%n-decorators-decorator_ice_waterfall.png",decorator_icerock_1:"#%n-decorators-decorator_icerock_1.png",decorator_icerock_10:"#%n-decorators-decorator_icerock_10.png",decorator_icerock_2:"#%n-decorators-decorator_icerock_2.png",decorator_icerock_3:"#%n-decorators-decorator_icerock_3.png",decorator_icerock_4:"#%n-decorators-decorator_icerock_4.png",decorator_icerock_5:"#%n-decorators-decorator_icerock_5.png",decorator_icerock_6:"#%n-decorators-decorator_icerock_6.png",decorator_icerock_7:"#%n-decorators-decorator_icerock_7.png",
decorator_icerock_8:"#%n-decorators-decorator_icerock_8.png",decorator_icerock_9:"#%n-decorators-decorator_icerock_9.png",decorator_iglu:"#%n-decorators-decorator_iglu.png",decorator_island:"#%n-decorators-decorator_island.png",decorator_lava:"#%n-decorators-decorator_lava.png",decorator_leaf:"#%n-decorators-decorator_leaf.png",decorator_leaf2:"#%n-decorators-decorator_leaf2.png",decorator_leaf3:"#%n-decorators-decorator_leaf3.png",decorator_leaf4:"#%n-decorators-decorator_leaf4.png",decorator_leaf_stone:"#%n-decorators-decorator_leaf_stone.png",decorator_leaf_stone2:"#%n-decorators-decorator_leaf_stone2.png",decorator_light_plant:"#%n-decorators-decorator_light_plant.png",decorator_light_plant1:"#%n-decorators-decorator_light_plant1.png",decorator_lilies:"#%n-decorators-decorator_lilies.png",decorator_mushroom1:"#%n-decorators-decorator_mushroom1.png",decorator_mushroom2:"#%n-decorators-decorator_mushroom2.png",decorator_pillar1:"#%n-decorators-decorator_pillar1.png",
decorator_pillar2:"#%n-decorators-decorator_pillar2.png",decorator_pillar3:"#%n-decorators-decorator_pillar3.png",decorator_pillar4:"#%n-decorators-decorator_pillar4.png",decorator_plant:"#%n-decorators-decorator_plant.png",decorator_plant2:"#%n-decorators-decorator_plant2.png",decorator_plant3:"#%n-decorators-decorator_plant3.png",decorator_purple_rock10:"#%n-decorators-decorator_purple_rock10.png",decorator_rock:"#%n-decorators-decorator_rock.png",decorator_rock10:"#%n-decorators-decorator_rock10.png",decorator_rock11:"#%n-decorators-decorator_rock11.png",decorator_rock12:"#%n-decorators-decorator_rock12.png",decorator_rock13:"#%n-decorators-decorator_rock13.png",decorator_rock14:"#%n-decorators-decorator_rock14.png",decorator_rock15:"#%n-decorators-decorator_rock15.png",decorator_rock16:"#%n-decorators-decorator_rock16.png",decorator_rock17:"#%n-decorators-decorator_rock17.png",decorator_rock18:"#%n-decorators-decorator_rock18.png",
decorator_rock19:"#%n-decorators-decorator_rock19.png",decorator_rock2:"#%n-decorators-decorator_rock2.png",decorator_rock20:"#%n-decorators-decorator_rock20.png",decorator_rock3:"#%n-decorators-decorator_rock3.png",decorator_rock4:"#%n-decorators-decorator_rock4.png",decorator_rock5:"#%n-decorators-decorator_rock5.png",decorator_rock6:"#%n-decorators-decorator_rock6.png",decorator_rock7:"#%n-decorators-decorator_rock7.png",decorator_rock8:"#%n-decorators-decorator_rock8.png",decorator_rock9:"#%n-decorators-decorator_rock9.png",decorator_roots:"#%n-decorators-decorator_roots.png",decorator_roots2:"#%n-decorators-decorator_roots2.png",decorator_roots3:"#%n-decorators-decorator_roots3.png",decorator_roots4:"#%n-decorators-decorator_roots4.png",decorator_sand_cracks:"#%n-decorators-decorator_sand_cracks.png",decorator_sand_cracks2:"#%n-decorators-decorator_sand_cracks2.png",decorator_sand_cracks3:"#%n-decorators-decorator_sand_cracks3.png",
decorator_sand_rock:"#%n-decorators-decorator_sand_rock.png",decorator_sand_rock10:"#%n-decorators-decorator_sand_rock10.png",decorator_sand_waterfall:"#%n-decorators-decorator_sand_waterfall.png",decorator_sandcave_1:"#%n-decorators-decorator_sandcave_1.png",decorator_sandcave_2:"#%n-decorators-decorator_sandcave_2.png",decorator_sandcave_3:"#%n-decorators-decorator_sandcave_3.png",decorator_sandcave_4:"#%n-decorators-decorator_sandcave_4.png",decorator_sandcave_5:"#%n-decorators-decorator_sandcave_5.png",decorator_sandcave_6:"#%n-decorators-decorator_sandcave_6.png",decorator_sandrock_1:"#%n-decorators-decorator_sandrock_1.png",decorator_sandrock_2:"#%n-decorators-decorator_sandrock_2.png",decorator_sandrock_3:"#%n-decorators-decorator_sandrock_3.png",decorator_sandrock_4:"#%n-decorators-decorator_sandrock_4.png",decorator_sandstone:"#%n-decorators-decorator_sandstone.png",decorator_slope:"#%n-decorators-decorator_slope.png",
decorator_snow_rock:"#%n-decorators-decorator_snow_rock.png",decorator_snow_rock10:"#%n-decorators-decorator_snow_rock10.png",decorator_snowdrift:"#%n-decorators-decorator_snowdrift.png",decorator_snowman:"#%n-decorators-decorator_snowman.png",decorator_stairs:"#%n-decorators-decorator_stairs.png",decorator_stairs2:"#%n-decorators-decorator_stairs2.png",decorator_stone1:"#%n-decorators-decorator_stone1.png",decorator_stone2:"#%n-decorators-decorator_stone2.png",decorator_stone4:"#%n-decorators-decorator_stone4.png",decorator_stone5:"#%n-decorators-decorator_stone5.png",decorator_tree:"#%n-decorators-decorator_tree.png",decorator_tumbleweed:"#%n-decorators-decorator_tumbleweed.png",decorator_water_grid:"#%n-decorators-decorator_water_grid.png",decorator_water_stone:"#%n-decorators-decorator_water_stone.png",decorator_water_stone1:"#%n-decorators-decorator_water_stone1.png",decorator_waterfall:"#%n-decorators-decorator_waterfall.png",
decorator_waterfall2:"#%n-decorators-decorator_waterfall2.png",decorator_waterice:"#%n-decorators-decorator_waterice.png",green_ground_1_green:"#%n-green-ground_1.png",green_ground_2_green:"#%n-green-ground_2.png",grow12_right_green:"#%n-green-grow12_right.png",grow12_left_green:"#%n-green-grow12_left.png",grow12_corner_green:"#%n-green-grow12_corner.png",grow12_both_green:"#%n-green-grow12_both.png",level1_up_corner_green:"#%n-green-level1_up_corner.png",level1_down_corner_green:"#%n-green-level1_down_corner.png",level1_left_corner_green:"#%n-green-level1_left_corner.png",level1_right_corner_green:"#%n-green-level1_right_corner.png",level2_up_corner_green:"#%n-green-level2_up_corner.png",level1_up_both_green:"#%n-green-level1_up_both.png",level1_up_right_only_green:"#%n-green-level1_up_right_only.png",level1_up_right_only_last_green:"#%n-green-level1_up_right_only_last.png",level1_up_left_only_green:"#%n-green-level1_up_left_only.png",
level1_up_left_only_last_green:"#%n-green-level1_up_left_only_last.png",level2_up_both_green:"#%n-green-level2_up_both.png",level2_up_right_only_green:"#%n-green-level2_up_right_only.png",level2_up_right_only_last_green:"#%n-green-level2_up_right_only_last.png",level2_up_left_only_green:"#%n-green-level2_up_left_only.png",level2_up_left_only_last_green:"#%n-green-level2_up_left_only_last.png",level1_down_both_green:"#%n-green-level1_down_both.png",level1_down_right_only_green:"#%n-green-level1_down_right_only.png",level1_down_left_only_green:"#%n-green-level1_down_left_only.png",level1_left_inner_green:"#%n-green-level1_left_inner.png",level1_left_inner_last_green:"#%n-green-level1_left_inner_last.png",level1_right_inner_green:"#%n-green-level1_right_inner.png",level1_right_inner_last_green:"#%n-green-level1_right_inner_last.png",level2_left_inner_green:"#%n-green-level2_left_inner.png",level2_left_inner_last_green:"#%n-green-level2_left_inner_last.png",
level2_right_inner_green:"#%n-green-level2_right_inner.png",level2_right_inner_last_green:"#%n-green-level2_right_inner_last.png",grounded_bg_green:"#%n-green-grounded.png",green_ground_1_ice:"#%n-ice-ground_1.png",green_ground_2_ice:"#%n-ice-ground_2.png",grow12_right_ice:"#%n-ice-grow12_right.png",grow12_left_ice:"#%n-ice-grow12_left.png",grow12_corner_ice:"#%n-ice-grow12_corner.png",grow12_both_ice:"#%n-ice-grow12_both.png",level1_up_corner_ice:"#%n-ice-level1_up_corner.png",level1_down_corner_ice:"#%n-ice-level1_down_corner.png",level1_left_corner_ice:"#%n-ice-level1_left_corner.png",level1_right_corner_ice:"#%n-ice-level1_right_corner.png",level2_up_corner_ice:"#%n-ice-level2_up_corner.png",level1_up_both_ice:"#%n-ice-level1_up_both.png",level1_up_right_only_ice:"#%n-ice-level1_up_right_only.png",level1_up_right_only_last_ice:"#%n-ice-level1_up_right_only_last.png",level1_up_left_only_ice:"#%n-ice-level1_up_left_only.png",
level1_up_left_only_last_ice:"#%n-ice-level1_up_left_only_last.png",level2_up_both_ice:"#%n-ice-level2_up_both.png",level2_up_right_only_ice:"#%n-ice-level2_up_right_only.png",level2_up_right_only_last_ice:"#%n-ice-level2_up_right_only_last.png",level2_up_left_only_ice:"#%n-ice-level2_up_left_only.png",level2_up_left_only_last_ice:"#%n-ice-level2_up_left_only_last.png",level1_down_both_ice:"#%n-ice-level1_down_both.png",level1_down_right_only_ice:"#%n-ice-level1_down_right_only.png",level1_down_left_only_ice:"#%n-ice-level1_down_left_only.png",level1_left_inner_ice:"#%n-ice-level1_left_inner.png",level1_left_inner_last_ice:"#%n-ice-level1_left_inner_last.png",level1_right_inner_ice:"#%n-ice-level1_right_inner.png",level1_right_inner_last_ice:"#%n-ice-level1_right_inner_last.png",level2_left_inner_ice:"#%n-ice-level2_left_inner.png",level2_left_inner_last_ice:"#%n-ice-level2_left_inner_last.png",level2_right_inner_ice:"#%n-ice-level2_right_inner.png",
level2_right_inner_last_ice:"#%n-ice-level2_right_inner_last.png",grounded_bg_ice:"#%n-ice-grounded.png",green_ground_1_purple:"#%n-purple-ground_1.png",green_ground_2_purple:"#%n-purple-ground_2.png",grow12_right_purple:"#%n-purple-grow12_right.png",grow12_left_purple:"#%n-purple-grow12_left.png",grow12_corner_purple:"#%n-purple-grow12_corner.png",grow12_both_purple:"#%n-purple-grow12_both.png",level1_up_corner_purple:"#%n-purple-level1_up_corner.png",level1_down_corner_purple:"#%n-purple-level1_down_corner.png",level1_left_corner_purple:"#%n-purple-level1_left_corner.png",level1_right_corner_purple:"#%n-purple-level1_right_corner.png",level2_up_corner_purple:"#%n-purple-level2_up_corner.png",level1_up_both_purple:"#%n-purple-level1_up_both.png",level1_up_right_only_purple:"#%n-purple-level1_up_right_only.png",level1_up_right_only_last_purple:"#%n-purple-level1_up_right_only_last.png",level1_up_left_only_purple:"#%n-purple-level1_up_left_only.png",
level1_up_left_only_last_purple:"#%n-purple-level1_up_left_only_last.png",level2_up_both_purple:"#%n-purple-level2_up_both.png",level2_up_right_only_purple:"#%n-purple-level2_up_right_only.png",level2_up_right_only_last_purple:"#%n-purple-level2_up_right_only_last.png",level2_up_left_only_purple:"#%n-purple-level2_up_left_only.png",level2_up_left_only_last_purple:"#%n-purple-level2_up_left_only_last.png",level1_down_both_purple:"#%n-purple-level1_down_both.png",level1_down_right_only_purple:"#%n-purple-level1_down_right_only.png",level1_down_left_only_purple:"#%n-purple-level1_down_left_only.png",level1_left_inner_purple:"#%n-purple-level1_left_inner.png",level1_left_inner_last_purple:"#%n-purple-level1_left_inner_last.png",level1_right_inner_purple:"#%n-purple-level1_right_inner.png",level1_right_inner_last_purple:"#%n-purple-level1_right_inner_last.png",level2_left_inner_purple:"#%n-purple-level2_left_inner.png",level2_left_inner_last_purple:"#%n-purple-level2_left_inner_last.png",
level2_right_inner_purple:"#%n-purple-level2_right_inner.png",level2_right_inner_last_purple:"#%n-purple-level2_right_inner_last.png",grounded_bg_purple:"#%n-purple-grounded.png",green_ground_1_sand:"#%n-sand-ground_1.png",green_ground_2_sand:"#%n-sand-ground_2.png",grow12_right_sand:"#%n-sand-grow12_right.png",grow12_left_sand:"#%n-sand-grow12_left.png",grow12_corner_sand:"#%n-sand-grow12_corner.png",grow12_both_sand:"#%n-sand-grow12_both.png",level1_up_corner_sand:"#%n-sand-level1_up_corner.png",level1_down_corner_sand:"#%n-sand-level1_down_corner.png",level1_left_corner_sand:"#%n-sand-level1_left_corner.png",level1_right_corner_sand:"#%n-sand-level1_right_corner.png",level2_up_corner_sand:"#%n-sand-level2_up_corner.png",level1_up_both_sand:"#%n-sand-level1_up_both.png",level1_up_right_only_sand:"#%n-sand-level1_up_right_only.png",level1_up_right_only_last_sand:"#%n-sand-level1_up_right_only_last.png",level1_up_left_only_sand:"#%n-sand-level1_up_left_only.png",
level1_up_left_only_last_sand:"#%n-sand-level1_up_left_only_last.png",level2_up_both_sand:"#%n-sand-level2_up_both.png",level2_up_right_only_sand:"#%n-sand-level2_up_right_only.png",level2_up_right_only_last_sand:"#%n-sand-level2_up_right_only_last.png",level2_up_left_only_sand:"#%n-sand-level2_up_left_only.png",level2_up_left_only_last_sand:"#%n-sand-level2_up_left_only_last.png",level1_down_both_sand:"#%n-sand-level1_down_both.png",level1_down_right_only_sand:"#%n-sand-level1_down_right_only.png",level1_down_left_only_sand:"#%n-sand-level1_down_left_only.png",level1_left_inner_sand:"#%n-sand-level1_left_inner.png",level1_left_inner_last_sand:"#%n-sand-level1_left_inner_last.png",level1_right_inner_sand:"#%n-sand-level1_right_inner.png",level1_right_inner_last_sand:"#%n-sand-level1_right_inner_last.png",level2_left_inner_sand:"#%n-sand-level2_left_inner.png",level2_left_inner_last_sand:"#%n-sand-level2_left_inner_last.png",level2_right_inner_sand:"#%n-sand-level2_right_inner.png",
level2_right_inner_last_sand:"#%n-sand-level2_right_inner_last.png",grounded_bg_sand:"#%n-sand-grounded.png",green_ground_1_blue:"#%n-blue-ground_1.png",green_ground_2_blue:"#%n-blue-ground_2.png",grow12_right_blue:"#%n-blue-grow12_right.png",grow12_left_blue:"#%n-blue-grow12_left.png",grow12_corner_blue:"#%n-blue-grow12_corner.png",grow12_both_blue:"#%n-blue-grow12_both.png",level1_up_corner_blue:"#%n-blue-level1_up_corner.png",level1_down_corner_blue:"#%n-blue-level1_down_corner.png",level1_left_corner_blue:"#%n-blue-level1_left_corner.png",level1_right_corner_blue:"#%n-blue-level1_right_corner.png",level2_up_corner_blue:"#%n-blue-level2_up_corner.png",level1_up_both_blue:"#%n-blue-level1_up_both.png",level1_up_right_only_blue:"#%n-blue-level1_up_right_only.png",level1_up_right_only_last_blue:"#%n-blue-level1_up_right_only_last.png",level1_up_left_only_blue:"#%n-blue-level1_up_left_only.png",level1_up_left_only_last_blue:"#%n-blue-level1_up_left_only_last.png",
level2_up_both_blue:"#%n-blue-level2_up_both.png",level2_up_right_only_blue:"#%n-blue-level2_up_right_only.png",level2_up_right_only_last_blue:"#%n-blue-level2_up_right_only_last.png",level2_up_left_only_blue:"#%n-blue-level2_up_left_only.png",level2_up_left_only_last_blue:"#%n-blue-level2_up_left_only_last.png",level1_down_both_blue:"#%n-blue-level1_down_both.png",level1_down_right_only_blue:"#%n-blue-level1_down_right_only.png",level1_down_left_only_blue:"#%n-blue-level1_down_left_only.png",level1_left_inner_blue:"#%n-blue-level1_left_inner.png",level1_left_inner_last_blue:"#%n-blue-level1_left_inner_last.png",level1_right_inner_blue:"#%n-blue-level1_right_inner.png",level1_right_inner_last_blue:"#%n-blue-level1_right_inner_last.png",level2_left_inner_blue:"#%n-blue-level2_left_inner.png",level2_left_inner_last_blue:"#%n-blue-level2_left_inner_last.png",level2_right_inner_blue:"#%n-blue-level2_right_inner.png",level2_right_inner_last_blue:"#%n-blue-level2_right_inner_last.png",
grounded_bg_blue:"#%n-blue-grounded.png"}},tiles_blue:{urls:{},injectTo:["tiles"],frameIds:["green_ground_1_blue","green_ground_2_blue","grow12_right_blue","grow12_left_blue","grow12_corner_blue","grow12_both_blue","level1_up_corner_blue","level1_down_corner_blue","level1_left_corner_blue","level1_right_corner_blue","level2_up_corner_blue","level1_up_both_blue","level1_up_right_only_blue","level1_up_right_only_last_blue","level1_up_left_only_blue","level1_up_left_only_last_blue","level2_up_both_blue","level2_up_right_only_blue","level2_up_right_only_last_blue","level2_up_left_only_blue","level2_up_left_only_last_blue","level1_down_both_blue","level1_down_right_only_blue","level1_down_left_only_blue","level1_left_inner_blue","level1_left_inner_last_blue","level1_right_inner_blue","level1_right_inner_last_blue","level2_left_inner_blue","level2_left_inner_last_blue","level2_right_inner_blue","level2_right_inner_last_blue","grounded_bg_blue"],jsonIds:[],soundIds:[],unpackedIds:[]},
tiles_green:{urls:{},injectTo:["tiles"],frameIds:["green_ground_1_green","green_ground_2_green","grow12_right_green","grow12_left_green","grow12_corner_green","grow12_both_green","level1_up_corner_green","level1_down_corner_green","level1_left_corner_green","level1_right_corner_green","level2_up_corner_green","level1_up_both_green","level1_up_right_only_green","level1_up_right_only_last_green","level1_up_left_only_green","level1_up_left_only_last_green","level2_up_both_green","level2_up_right_only_green","level2_up_right_only_last_green","level2_up_left_only_green","level2_up_left_only_last_green","level1_down_both_green","level1_down_right_only_green","level1_down_left_only_green","level1_left_inner_green","level1_left_inner_last_green","level1_right_inner_green","level1_right_inner_last_green","level2_left_inner_green","level2_left_inner_last_green","level2_right_inner_green","level2_right_inner_last_green","grounded_bg_green"],jsonIds:[],soundIds:[],unpackedIds:[]},tiles_ice:{
urls:{},injectTo:["tiles"],frameIds:["green_ground_1_ice","green_ground_2_ice","grow12_right_ice","grow12_left_ice","grow12_corner_ice","grow12_both_ice","level1_up_corner_ice","level1_down_corner_ice","level1_left_corner_ice","level1_right_corner_ice","level2_up_corner_ice","level1_up_both_ice","level1_up_right_only_ice","level1_up_right_only_last_ice","level1_up_left_only_ice","level1_up_left_only_last_ice","level2_up_both_ice","level2_up_right_only_ice","level2_up_right_only_last_ice","level2_up_left_only_ice","level2_up_left_only_last_ice","level1_down_both_ice","level1_down_right_only_ice","level1_down_left_only_ice","level1_left_inner_ice","level1_left_inner_last_ice","level1_right_inner_ice","level1_right_inner_last_ice","level2_left_inner_ice","level2_left_inner_last_ice","level2_right_inner_ice","level2_right_inner_last_ice","grounded_bg_ice"],jsonIds:[],soundIds:[],unpackedIds:[]},tiles_purple:{urls:{},injectTo:["tiles"],frameIds:["green_ground_1_purple",
"green_ground_2_purple","grow12_right_purple","grow12_left_purple","grow12_corner_purple","grow12_both_purple","level1_up_corner_purple","level1_down_corner_purple","level1_left_corner_purple","level1_right_corner_purple","level2_up_corner_purple","level1_up_both_purple","level1_up_right_only_purple","level1_up_right_only_last_purple","level1_up_left_only_purple","level1_up_left_only_last_purple","level2_up_both_purple","level2_up_right_only_purple","level2_up_right_only_last_purple","level2_up_left_only_purple","level2_up_left_only_last_purple","level1_down_both_purple","level1_down_right_only_purple","level1_down_left_only_purple","level1_left_inner_purple","level1_left_inner_last_purple","level1_right_inner_purple","level1_right_inner_last_purple","level2_left_inner_purple","level2_left_inner_last_purple","level2_right_inner_purple","level2_right_inner_last_purple","grounded_bg_purple"],jsonIds:[],soundIds:[],unpackedIds:[]},tiles_sand:{urls:{},injectTo:["tiles"],frameIds:[
"green_ground_1_sand","green_ground_2_sand","grow12_right_sand","grow12_left_sand","grow12_corner_sand","grow12_both_sand","level1_up_corner_sand","level1_down_corner_sand","level1_left_corner_sand","level1_right_corner_sand","level2_up_corner_sand","level1_up_both_sand","level1_up_right_only_sand","level1_up_right_only_last_sand","level1_up_left_only_sand","level1_up_left_only_last_sand","level2_up_both_sand","level2_up_right_only_sand","level2_up_right_only_last_sand","level2_up_left_only_sand","level2_up_left_only_last_sand","level1_down_both_sand","level1_down_right_only_sand","level1_down_left_only_sand","level1_left_inner_sand","level1_left_inner_last_sand","level1_right_inner_sand","level1_right_inner_last_sand","level2_left_inner_sand","level2_left_inner_last_sand","level2_right_inner_sand","level2_right_inner_last_sand","grounded_bg_sand"],jsonIds:[],soundIds:[],unpackedIds:[]},toolbar:{urls:{},injectTo:["main"],frameIds:["%n_attention_icon_png"],jsonIds:[],soundIds:[],
unpackedIds:[]},tooltip:{urls:{},injectTo:["main"],frameIds:["%n_bg_png","%n_shadow_arrow_png","%n_arrow_png"],jsonIds:[],soundIds:[],unpackedIds:[]},transition:{urls:{},injectTo:["main"],frameIds:[],jsonIds:["%n_json"],soundIds:[],unpackedIds:[]},treasuresearch:{urls:{}},tulpan_tournament:{urls:{}},unit_apple:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_bamboo:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9"],jsonIds:["%n10","%n11"],soundIds:[],unpackedIds:[]},unit_bamboochest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_bamboogenerator:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1","%n2","%n3"],soundIds:[],unpackedIds:[]},unit_bamboosource:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_bear:{urls:{},injectTo:["game"],frameIds:["%n1","%n2",
"%n3","%n4","%n5","%n6"],jsonIds:["%n7"],soundIds:[],unpackedIds:[]},unit_candies:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_coins:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_coinsplant:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_coinsplantchest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_corn:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_crystal:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_decorator:{urls:{},injectTo:["game"],frameIds:["%n1"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_dishes:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9",
"%n10","%n11","%n12","%n13","%n14","%n15","%n16","%n17","%n18","%n19","%n20"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_dragonmine:{urls:{},injectTo:["game"],frameIds:["%n1"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_dwarf:{urls:{},injectTo:["game"],frameIds:["%n1"],jsonIds:["%n2"],soundIds:[],unpackedIds:[]},unit_elf:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7"],jsonIds:["%n8"],soundIds:[],unpackedIds:[]},unit_energyplant:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_energyplantchest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_freechest:{urls:{},injectTo:["game"],frameIds:["%n1"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_herochest:{urls:{},injectTo:["game"],frameIds:["%n1"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_icons:{urls:{},injectTo:["game"],frameIds:["small_icon_dwarf","small_icon_king","small_icon_bear","small_icon_elf",
"small_icon_warlock","small_icon_troll","small_icon_knight","fog_icon_png"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_iron:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9","%n10"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_king:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:["%n4"],soundIds:[],unpackedIds:[]},unit_knight:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9","%n10"],jsonIds:["%n11"],soundIds:[],unpackedIds:[]},unit_magicplant:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_mushrooms:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_rubies:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_rubiesplant:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"
],jsonIds:[],soundIds:[],unpackedIds:[]},unit_rubiesplantchest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_sacks:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_sapphire:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9","%n10"],jsonIds:["%n11","%n12"],soundIds:[],unpackedIds:[]},unit_sapphirechest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_sapphiregenerator:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1","%n2","%n3"],soundIds:[],unpackedIds:[]},unit_sapphiresource:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_specialoffer:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1"],soundIds:[],unpackedIds:[]},unit_stone:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9"],
jsonIds:["%n10","%n11"],soundIds:[],unpackedIds:[]},unit_stonechest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_stonegenerator:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1","%n2","%n3"],soundIds:[],unpackedIds:[]},unit_stonesource:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_strawberry:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_treasure:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_troll:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9"],jsonIds:["%n10"],soundIds:[],unpackedIds:[]},unit_wagon:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8","%n9"],jsonIds:["%n10","%n11"],soundIds:[],unpackedIds:[]},unit_wagonchest:{urls:{},injectTo:["game"],
frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_wagongenerator:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1","%n2","%n3"],soundIds:[],unpackedIds:[]},unit_wagonsource:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_wands:{urls:{},injectTo:["game"],frameIds:[],jsonIds:["%n1","%n2","%n3","%n4","%n5","%n6"],soundIds:[],unpackedIds:[]},unit_warlock:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8"],jsonIds:["%n9"],soundIds:[],unpackedIds:[]},unit_wheat:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_wood:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6","%n7","%n8"],jsonIds:["%n9","%n10"],soundIds:[],unpackedIds:[]},unit_woodchest:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_woodgenerator:{urls:{},injectTo:[
"game"],frameIds:[],jsonIds:["%n1","%n2","%n3"],soundIds:[],unpackedIds:[]},unit_woodsource:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4","%n5","%n6"],jsonIds:[],soundIds:[],unpackedIds:[]},unit_worker:{urls:{},injectTo:["game"],frameIds:["%n1","%n2","%n3","%n4"],jsonIds:["%n5"],soundIds:[],unpackedIds:[]},units_shop:{urls:{png:"@%n-47114eaf2e.png",json:"@%n-7715aa2a54.json"},jsons:{plist:"@%n-47114eaf2e.plist"},frames:{bg_png:"#%n-market-market_bg.png",lock_png:"#%n-market-market_lock.png",title_png:"#%n-market-market_title.png",cart_top_png:"#%n-market-market_cart.png",cart_bottom_png:"#%n-market-market_cart_bg.png",amount_bg_png:"#%n-tile_shop-shop_red_ribbon_best.png"}},unitslibrarywindow:{urls:{},injectTo:["main"],frameIds:["ow_tab_header_on","ow_scroll_background","icon_unknown","icon_dwarf","icon_king","icon_bear","icon_elf","icon_warlock","icon_troll","icon_knight","horizontal_scroll_foreground"],jsonIds:[],soundIds:[],unpackedIds:[]},valentines:{urls:{}},
victorywindow:{urls:{png:"@%n-8716db0f85.png",json:"@%n-d94f2578fe.json"},jsons:{plist:"@%n-8716db0f85.plist"},frames:{level_victory_reward_bg:"#%n-victory-reward_bg.png"}},wardrobe_window:{urls:{}},windows:{urls:{},injectTo:["main"],frameIds:["window_bg_png","tab_attention","tab_icon_specials","tab_icon_orders","tab_icon_recipes","tab_icon_ingredients","tab_icon_chest","tab_icon_fruit","tab_icon_heroes","tab_icon_resource","tab_icon_source","tab_icon_valuable","window_title_background","window_foreground_png","window_close_png","window_close_on_png"],jsonIds:[],soundIds:[],unpackedIds:[]},world_map:{urls:{}},xmas:{urls:{}}},buildConfig={resolutions:{high:{scale:1,id:"high",height:1334,options:{pngcrush:!0,depth:6}},h1200:{scale:.9,id:"h1200",height:1200,options:{pngcrush:!0,depth:6}},h1000:{scale:.75,id:"h1000",height:1e3,options:{pngcrush:!0,depth:6}},h800:{scale:.6,id:"h800",height:800,options:{pngcrush:!0,depth:6},horizontal:!0},low:{scale:.5,id:"low",height:667,options:{
pngcrush:!0,depth:6},horizontal:!0},highmobile:{scale:1,id:"highmobile",height:1334,options:{pngcrush:!0,depth:5},mobile:!0},h1200mobile:{scale:.9,id:"h1200mobile",height:1200,options:{pngcrush:!0,depth:5},mobile:!0},h1000mobile:{scale:.75,id:"h1000mobile",height:1e3,options:{pngcrush:!0,depth:5},mobile:!0}},target:"web",env:"release",buildDir:"publish/html5"},resolutions=buildConfig.resolutions,unmifiyBundlesRec=function(e,t,s){var i=e[t];if("object"==typeof i)for(var n in i)unmifiyBundlesRec(i,n,s);else"string"==typeof i&&(i=(i=(i=i.replace("@","~%n/%r/")).replace("~","res/packed/")).replace(new RegExp("%n","g"),s),"undefined"!=typeof unpackedBundles&&unpackedBundles[s]&&unpackedBundles[s][e[t]]&&(unpackedMap[i]=unpackedBundles[s][e[t]]),e[t]=i)},isVirtualLink=function(e){return"string"==typeof e&&"@"===e.charAt(0)},parseVirtualLink=function(e){return{bundle:e.substr(1,e.indexOf("#")-1),id:e.substr(e.lastIndexOf("#")+1)}},processVirtualUrl=function(e,t){if(!isVirtualLink(e))return e
;var s=parseVirtualLink(e),i=bundles[s.bundle];for(var n in i.injectTo){var o=i.injectTo[n];if(cleverapps.bundleLoader.isLoaded(o))return bundles[o].urls[s.id]}if(t&&t.useUnusedBundles)for(var n in i.injectTo){o=i.injectTo[n];if(cleverapps.bundleLoader.isUnused(o))return bundles[o].urls[s.id]}var r="no urlId "+e+" for bundle "+s.bundle;if(console.log(r),cleverapps.config.debugMode)throw r},getVirtualLinkType=function(e){return e.split("#")[1]},processVirtualImage=function(e){if(!isVirtualLink(e))return e;var t=getVirtualLinkType(e);return"frame"===t?processVirtualFrame(e):"url"===t?processVirtualUrl(e):void 0},processVirtualFrame=function(e){if(!isVirtualLink(e))return e;var t=parseVirtualLink(e),s=bundles[t.bundle];for(var i in s.injectTo){var n=s.injectTo[i];if(cleverapps.bundleLoader.isLoaded(n))return bundles[n].frames[t.id]}var o="no frameId "+e+" for bundle "+t.bundle;if(console.log(o),cleverapps.config.debugMode)throw o},processVirtualJson=function(e){if(!isVirtualLink(e)
)return e;var t=parseVirtualLink(e),s=bundles[t.bundle];for(var i in s.injectTo){var n=s.injectTo[i];if(cleverapps.bundleLoader.isLoaded(n))return bundles[n].jsons[t.id]}var o="no json "+e+" for bundle "+t.bundle;if(console.log(o),cleverapps.config.debugMode)throw o},processInlineJSONs=function(e){for(var t in e.jsons){var s=e.jsons[t];if(s.inline){var i=JSON.parse(s.data),n=s.url;cc.loader.cache[n]=i,e.jsons[t]=n}}},unminifyBundles=function(e){for(var t in e=e||Object.keys(bundles)){var s=e[t];unmifiyBundlesRec(bundles,s,s),bundles[s].frames||(bundles[s].frames={}),bundles[s].jsons||(bundles[s].jsons={}),processInlineJSONs(bundles[s]);var i=bundles[s];i.injectTo&&i.frameIds&&(i.frameIds.forEach(function(e){i.frames[e]="@"+s+"#frame#"+e}),delete i.frameIds),i.injectTo&&i.jsonIds&&(i.jsonIds.forEach(function(e){i.jsons[e]="@"+s+"#json#"+e}),delete i.jsonIds),i.injectTo&&i.soundIds&&(i.soundIds.forEach(function(e){i.urls[e]="@"+s+"#url#"+e}),delete i.soundIds),
i.injectTo&&i.unpackedIds&&(i.unpackedIds.forEach(function(e){i.urls[e]="@"+s+"#url#"+e}),delete i.unpackedIds)}"undefined"!=typeof unpackedBundles&&(unpackedBundles=void 0,delete unpackedMap[bundles.dev_resources.frames.border])};unminifyBundles(),ResourceProcessor.addStaticUrl();var Bundle=function(e){this.name=e,this.data=bundles[e]};Bundle.prototype.onLoad=function(){var e=cc.loader.getRes(this.data.urls.json);for(var t in e){var s=this.data.jsons[t],i=e[t];"string"==typeof s&&".plist"===cc.path.extname(s)&&(i=cc.plistParser.parse(i)),cc.loader.cache[s]=i}this.data.jsons.plist&&cc.spriteFrameCache.addSpriteFrames(this.data.jsons.plist)},Bundle.prototype.isResourceSound=function(e){return!!e&&(e.music||"string"==typeof e&&(-1!==e.indexOf("/sfx/")||-1!==e.indexOf(".mp3")))},Bundle.prototype.listSoundUrls=function(){return cc.sys.isWebViewAudio?[]:cleverapps.values(this.data.urls).filter(function(e){return this.isResourceSound(e)&&!isVirtualLink(e)}.bind(this))},
Bundle.prototype.listUrls=function(){return cleverapps.values(this.data.urls).filter(function(e){return!this.isResourceSound(e)&&!isVirtualLink(e)}.bind(this))},Bundle.prototype.listJsons=function(){return cleverapps.values(this.data.jsons)},Bundle.prototype.injectTo=function(t){["urls","frames","jsons"].forEach(function(e){cleverapps.extend(t,this.data[e])},this)};var BundleLoader=function(){this.handles={},this.blockedCounter=0,this.unusedResources={},this.unusedBundles={},this.waitWindow=void 0,this.onceFinishLoadCallback=void 0};BundleLoader.prototype.whenLoadFinish=function(e){0===this.blockedCounter?e():this.onceFinishLoadCallback=cleverapps.once(e)},BundleLoader.prototype.addBlockWindow=function(){if(0===this.blockedCounter){var e=cc.director.getRunningScene();e&&e.scene&&!cleverapps.scenes.isLoaderScene()&&!this.waitWindow&&(this.waitWindow=new WaitWindow)}this.blockedCounter++},BundleLoader.prototype.removeBlockWindow=function(){this.blockedCounter--,this.blockedCounter<=0&&(
this.waitWindow&&(this.waitWindow.close(),this.waitWindow=void 0),this.onceFinishLoadCallback&&this.onceFinishLoadCallback())},BundleLoader.prototype.onFailure=function(e,t){var s=this.getHandle(e),i=s&&s.onFailures;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAIL_BUNDLE+e),s&&s.blocked?(this.waitWindow&&(this.waitWindow.close(),this.waitWindow=!1),console.log("Show RestartWindow."),new RestartWindow):this.deleteBundle(e,!0),cleverapps.versionChecker.isClientVersionActual()&&!cleverapps.config.debugMode&&cleverapps.checkStatus(t,404)&&setTimeout(function(){throw"load actual bundle "+e+" 404 error"},0),i&&i.forEach(function(e){e(t)})},BundleLoader.prototype.loadBundles=function(e,t){var s=t&&t.onSuccess||function(){},i=t&&t.onFailure,n=cleverapps.wait(e&&e.length||0,s);i&&(i=cleverapps.once(i));for(var o=0;o<e.length;o++){var r={onSuccess:n,onFailure:i,blocked:t&&t.blocked};this.loadBundle(e[o],r)}},BundleLoader.prototype.getHandle=function(e){return this.handles[e]},
BundleLoader.prototype.countLoaded=function(e){if(Array.isArray(e))return e.filter(function(e){return this.countLoaded(e)}.bind(this)).length;var t=this.getHandle(e);return t&&t.loaded?1:0},BundleLoader.prototype.isLoaded=function(e){return Array.isArray(e)||(e=[e]),this.countLoaded(e)===e.length},BundleLoader.prototype.loadBundle=function(s,e){if(s&&s.loadBundle)s.loadBundle(e);else{var i=bundles[s],t=this.getHandle(s),n=(e=e||{}).onSuccess,o=e.onFailure,r=e.blocked;if(t)return t.counter++,void(t.loaded?n&&n(i):(n&&t.onSuccesses.push(n),o&&t.onFailures.push(o),!t.blocked&&r&&(t.blocked=!0,this.addBlockWindow())));var a=[];n&&(a=Array.isArray(n)?n:[n]);var c=[];o&&(c=Array.isArray(o)?o:[o]);var l={loaded:!1,counter:1,onSuccesses:a,onFailures:c,blocked:r};if(this.handles[s]=l,r&&this.addBlockWindow(),l.onLoadedUrls=cleverapps.once(function(){l.loaded=!0,l.blocked&&this.removeBlockWindow(),new Bundle(s).onLoad();for(var e=0;e<l.onSuccesses.length;e++)a[e].call(this,i)
;delete l.onSuccesses,delete l.onFailures,delete l.blocked}.bind(this)),bundles[s].injectTo)l.onLoadedUrls();else{var p=3,d=function(){if(this.getHandle(s)){var e=cc.game.config.noCache;i.noCache&&!e&&(cc.game.config.noCache=!0),console.log("retryCount:",p);var t=new Bundle(s).listUrls();console.log("LoadUrls-name:",s," urls:",t),cc.loader.load(new Bundle(s).listUrls(),function(e){if(console.log("status:",e),e){console.log("load failed",e,JSON.stringify(new Bundle(s).listUrls())),console.log("retryCount:",p);var t=cleverapps.checkStatus(e,404);console.log("CheckResult:",t),p<=1||t?cleverapps.versionChecker.loadClientVersion(function(){console.log("loadClientVersion"),this.onFailure(s,e)}.bind(this)):(console.log("Success"),p--,d())}else l.onLoadedUrls(),cc.loader.load(new Bundle(s).listSoundUrls())}.bind(this)),cc.game.config.noCache=e}}.bind(this);d()}}},BundleLoader.prototype.checkUrlUseInLoadedBundles=function(e){for(var t in this.handles){var s=new Bundle(t),i=s.listUrls().concat(
s.listSoundUrls());for(var n in i)if(i[n]===e)return!0}return!1},BundleLoader.prototype.deleteBundles=function(e){if(e)for(var t=0;t<e.length;t++)this.deleteBundle(e[t])},BundleLoader.prototype.deleteBundle=function(e,t){var s=this.handles[e];if(void 0!==s&&-1===["main","transition","episodes_resources"].indexOf(e)&&(s.counter--,!(0<s.counter||bundles[e].storage)))if(bundles[e].injectTo)delete this.handles[e];else{t||s.loaded||!s.blocked||console.log("Remove blocked loading bundle (maybe error!)",e),s.loaded&&this.clearOverrides(s);var i=new Bundle(e),n=i.listUrls().concat(i.listSoundUrls());for(var o in s.onLoadedUrls=function(){},delete this.handles[e],n){var r=n[o];this.checkUrlUseInLoadedBundles(r)||(this.unusedResources[r]=!0)}this.unusedBundles[e]=!0}},BundleLoader.prototype.override=function(e,t,s,i){e.overrides=e.overrides||new OverridesContainer,e.overrides.override(t,s,i)},BundleLoader.prototype.clearOverrides=function(e){e.overrides&&(e.unoverride(),delete e.overrides)},
BundleLoader.prototype.isUnused=function(e){return!this.isLoaded(e)&&this.unusedBundles[e]},BundleLoader.prototype.clearUnusedResources=function(){var e=cc.director.getRunningScene();e&&!e.stopListeners&&e.sceneBundles&&e.performRecursive(function(e){e.refreshVirtualSpriteFrame&&e.refreshVirtualSpriteFrame()});var t=this.unusedResources;for(var s in t)if(!this.checkUrlUseInLoadedBundles(s)){var i=cc.textureCache.getTextureForKey(s);i&&(cc.spriteFrameCache.removeSpriteFramesFromTexture(i),cc.textureCache.removeTextureForKey(s)),cc.loader.release(s)}this.unusedResources={},Object.keys(this.unusedBundles).forEach(function(e){bundles[e].injectTo||this.handles[e]||new Bundle(e).listJsons().forEach(function(e){delete cleverapps.Spine.cache[e]})}.bind(this)),this.unusedBundles={}},BundleLoader.prototype.getClassBundles=function(e,t,s){var i=[];return"function"==typeof e.BUNDLES?i=e.BUNDLES.apply(t,s):Array.isArray(e.BUNDLES)&&(i=e.BUNDLES),cleverapps.skins.getBundle()&&i.push(
cleverapps.skins.getBundle()),i},BundleLoader.prototype.allLoaded=function(e){return 0===e.filter(function(e){return bundles[e]&&!this.isLoaded(e)},this).length};var cleverapps_events={APP_INITIALIZE:"app_initialize",PUSH_IOS:"push_ios",BEFORE_LEAVE_WINDOW:"before_leave_window",BEFORE_LEAVE_CATCH:"before_leave_catch",BOOKMARK:"bookmark",JOIN_GROUP:"join_group",AD_READY:"ad_ready",AD_START:"ad_start",AD_FINISH:"ad_finish",HINT_USED:"hint_used",REWARD_RECEIVED:"reward_received",SHOP_OPEN:"shop_open",TILE_SHOP_OPEN:"tile_shop_open",DAU:"dau",DAU_LANGUAGE:"dau_language",USER_GOLD_DAU:"user_gold_dau",UNIQUE_START:"lev_start",UNIQUE_FINISH:"lev_finish",ERROR_AMOUNT:"error_amount",DAU_WFRIENDS_0:"dau_wfriends_0",DAU_WFRIENDS_1:"dau_wfriends_1",DAU_WFRIENDS_2:"dau_wfriends_2",DAU_WFRIENDS_3:"dau_wfriends_3",DAU_WFRIENDS_4:"dau_wfriends_4",DAU_WFRIENDS_5:"dau_wfriends_5",RETENTION_0:"retention_0",RETENTION_1:"retention_1",RETENTION_2:"retention_2",RETENTION_3:"retention_3",
RETENTION_7:"retention_7",RETENTION_14:"retention_14",RETENTION_30:"retention_30",PRODUCT_BOUGHT:"product_bought",PRODUCT_BOUGHT_LANGUAGE:"product_bought_language",PURCHASE_VALIDATE_SUCCESS:"purchase_validate_success",PURCHASE_VALIDATE_FAILURE:"purchase_validate_failure",MOVES_SHOW:"moves_show",MOVES_BOUGHT:"moves_bought",MOVES_USED_FORCE:"moves_used_force",UNDO_USED:"undo",UNDO_USED_FORCE:"undo_force",BOMB_MOVES_BOUGHT:"bomb_moves_bought",LIVES_BOUGHT:"lives_bought",LIVES_FOR_VIDEO_SHOP:"lives_video_shop",BONUS_WORKER_BOUGHT:"bonus_worker_bought",SOFT_CURRENCY_BUY:"soft_buy",SOFT_CURRENCY_COST:"soft_cost",SHARE:"share",SHARE_ITEM:"share_item",BOOSTERS_BOUGHT:"boosters_bought",BOOSTERS_BOUGHT_ITEM:"boosters_bought_item",BOOSTERS_EXECUTE:"boosters_execute",STAR_CHEST_OPEN:"star_chest_open",STAR_CHEST_OPEN_ITEM:"star_chest_open_item",DAILY_BONUS:"daily_bonus",DAILY_BONUS_DOUBLE:"daily_bonus_double",UNITS_SHOP_RUBY:"units_shop_ruby",UNITS_SHOP_COINS:"units_shop_coins",
UNITS_SHOP_ITEM:"units_shop_item",SPECIAL_OFFER_COUNT:"special_offer_count",SPECIAL_OFFER_BUY:"special_offer_buy",SPECIAL_OFFER_RUBY:"special_offer_ruby",FEAST_PACK_BUY:"_feast_pack_buy",FEAST_PACK_RUBY:"_feast_pack_ruby",MONEY_FOG_RUBY:"money_fog_ruby",MONEY_FOG:"money_fog",GUN_FORCE:"gun_force",DAILY_TASKS_FORCE:"daily_tasks_force",FREE_HINT_FORCE:"free_hint_force",FREE_PAINT_FORCE:"free_paint_force",HEROES_AVAILABLE_FORCE:"heroes_available_force",LANTERN_FORCE:"lantern_force",FIRST_BOOSTERS_BEFORE:"first_boosters_before",SECOND_BOOSTERS_BEFORE:"second_boosters_before",THIRD_BOOSTERS_BEFORE:"third_boosters_before",FREE_WILDCARD_FORCE:"free_wildcard_force",FREE_UNDO_FORCE:"free_undo_force",FREE_ADD_MOVES_FORCE:"free_add_moves_force",MOVES_FOR_BUY_SUCCESS:"moves_for_buy_success",MOVES_FOR_BUY_SHOW:"moves_for_buy_show",MOVES_FOR_VIDEO_SUCCESS:"moves_for_video_success",MOVES_FOR_VIDEO_SHOW:"moves_for_video_show",LIVES_FOR_VIDEO_SUCCESS:"lives_for_video_success",
LIVES_FOR_VIDEO_SHOW:"lives_for_video_show",COINS_FOR_VIDEO_SUCCESS:"coins_for_video_success",COINS_FOR_VIDEO_SHOW:"coins_for_video_show",HINT_FOR_INVITE_SUCCESS:"hint_for_invite_success",HINT_FOR_INVITE_SHOW:"hint_for_invite_show",SIGN_IN_REWARD:"sign_in_reward",HELP_BY_FIVE_ATTEMPTS:"help_by_five_attemts",HELP_BY_ATTEMPTS_DAU:"help_by_attemts_dau",HELP_BY_ATTEMPTS_ONE_AND_MORE:"help_by_attemts_1_and_more",HELP_BY_ATTEMPTS_THREE_AND_MORE:"help_by_attemts_3_and_more",HELP_BY_ATTEMPTS_FIVE_AND_MORE:"help_by_attemts_5_and_more",FREE_MOVES:"free_moves",FREE_BOMB_MOVES:"free_bomb_moves",RATE_WINDOW:"rate_window",RATE_SEND:"rate_send",RATE_1:"rate_1",RATE_2:"rate_2",RATE_3:"rate_3",RATE_4:"rate_4",RATE_5:"rate_5",TUTORIAL_STEP_1:"tutorial_step_1",TUTORIAL_STEP_2:"tutorial_step_2",TUTORIAL_STEP_3:"tutorial_step_3",TUTORIAL_COMPLETED:"fb_mobile_tutorial_completion",LEVEL_PASS_EVENT:"level_passed",LEVEL_START:"level_start",LEVEL_FINISH:"level_finish",LEVEL_GIVEUP:"level_giveup",
ACHIEVED_LEVEL:"fb_mobile_level_achieved",LEVEL_PASSED_TIME:"level_passed_time",LEVEL_STARS:"level_stars",LEVEL_LEFT_MOVES:"level_left_moves",LEVEL_UP:"level_up",LEVEL_FPS:"level_fps",PLAY_TIMES:"play_times",MESSAGE_SENT_FRIEND:"message_friend",MESSAGE_SENT_INVITE:"message_invite",MESSAGE_SENT_PREFIX:"message_sent_",MESSAGE_CANCEL_PREFIX:"message_cancel_",MESSAGE_ERROR:"message_error",FAKEFB_BY_TIMEOUT:"fakefb_by_timeout",FAKEFB_BY_SCRIPT_ERROR:"fakefb_by_script_error",FACEBOOK_INITED:"facebook_inited",PAYER_PROMO_FOUND:"payer_promo_found",PAYER_PROMO_SHOW:"payer_promo_show",PAYER_PROMO_BUY:"payer_promo_buy",PAYER_PROMO_DONE:"payer_promo_done",BOUNTY_OPENED:"bounty_opened",PACKWINDOW_OPENED:"packwindow_opened",PACK_STARTED:"pack_started",PACK_BOUGHT:"pack_bought",PACK_BOUGHT_WITH_PAYMENT:"pack_bought_with_payment",FREE_HINT_SHOWED:"free_hint_showed",TOURNAMENT_LEVEL_PLACE:"tournament_level_place",VIRAL_SENT_NONE:"viral_sent0",VIRAL_SENT_3:"viral_sent3",
VIRAL_SENT_REST:"viral_sent_rest",FPS_AUTO:"fps_auto",FPS_LOW:"fps_low",FPS_HIGH:"fps_high",REWARDED_AVAILABLE:"rewarded_available",REWARDED_WATCHED:"rewarded_watched",MAKE_CHOICE:"make_choice",REDO_CHOICE:"redo_choice",BUY_CHOICE:"buy_choice",REWARDED_CHOICE:"rewarded_choice",REWARDED_SHARE:"rewarded_share_1",REWARDED_HINT:"rewarded_hint_1",REWARDED_ADD_MOVES:"rewarded_add_moves_1",REWARDED_ADD_LIVES:"rewarded_add_lives_1",REWARDED_ADD_COINS:"rewarded_add_coins_1",REWARDED_TOOLBAR:"rewarded_toolbar_1",REWARDED_DAILY_BONUS:"rewarded_dailybonus_1",REWARDED_TOOLBAR_WINDOW_SHOW:"rewarded_toolbar_window_show",REWARDED_TOOLBAR_WINDOW_CLOSE:"rewarded_toolbar_window_close",REWARD_BUY:"reward_buy",LEADERS_WINDOW_OPEN:"leaders_window_open",NEW_LEAGUE:"new_league",PERIODIC_BONUS_FORCE:"periodic_bonus_force",BONUS_ROUND_FORCE:"bonus_round_force",GIVEUP_ATTENTION:"giveup_attention",GIVEUP_MISSION:"giveup_mission",GIVEUP_CHANGE:"giveup_change",GIVEUP_ATTENTION_NEARLY:"giveup_attention1",
GIVEUP_CHANGE_NEARLY:"giveup_change1",SESSION_DAILY_TASK_AVAILABLE:"session_daily_task_available",SESSION_DAILY_TASK_FINISH:"session_daily_task_finish",SESSION_DAILY_TASK_REWARD:"session_daily_task_reward",SESSION_DAILY_TASK_OPEN_WINDOW:"session_daily_task_open_window",DAILY_TASK_CREATE:"daily_task_create",DAILY_TASK_REWARD:"daily_task_rewarded",DAILY_TASKS_OPEN_WINDOW:"daily_tasks_open_window",DAILY_TASKS_START:"daily_tasks_start",SPEND_COINS:"spend_coins",FB_SPEND_COINS:"fb_mobile_spent_credits",FBLOGINORINVITE_LOGIN:"extra_login",FBLOGINORINVITE_INVITE:"extra_invite",HIGHSCORE_INVITE:"extra_highscore_invite",BOOSTER_CELL_ADDED:"booster_cell_added",BOOSTER_CELL_COLLECTED:"booster_cell_collected",BOOSTER_CELL_RECEIVED:"booster_cell_recevied",BUY_MOVES:"buy_moves_",MISSION_FINISH:"mission_finish",COMBO_PRIZE:"combo_3",COOKIEJAR_REWARD:"cookiejar_reward",GUN_SHOT_FORCE:"gunshotforce",GUN_SHOT:"gunshot",FAIL_BUNDLE:"fail_bundle_",PIGGY_BANK:"piggy_bank",
PIGGY_BANK_LEVEL:"piggy_bank_level_",ACTIVE_TIME:"active_time",CHRISTMAS_FORCE:"christmas_force",CRYPTEX_REWARD:"cryptex_reward",CRYPTEX_FAIL:"cryptex_fail",WIN_KNOCKOUT:"win_knockout",LOSE_KNOCKOUT:"lose_knockout",SUBSCRIPTION_WINDOW_OPEN:"subscription_window_open",SUBSCRIPTION_REWARD:"subscription_reward",SUBSCRIPTION_BOUGHT:"subscription_bought",SUBSCRIPTION_CANCELLED:"subscription_cancelled",DAILY_CUP_REWARD:"daily_cup_reward",DAILY_CUP_DAU:"daily_cup_dau",DAILY_CUP_PLAYERS:"daily_cup_players",INSTANT_SHORTCUT_SHOW:"instant_shortcut_show",INSTANT_SHORTCUT:"instant_shortcut",INSTANT_BOT_SHOW:"instant_bot_show",INSTANT_BOT_ERROR:"instant_bot_error",INSTANT_BOT:"instant_bot",INSTANT_UPDATE:"instant_update",INSTANT_PAYMENT:"instant_payment_",INSTANT_CONSUME:"instant_consume_",MISSION_DAU:"mission_dau",MISSION_START_DAU:"mission_start_dau",FAVORITE_REGULAR:"favorite_regular",FAVORITE_PRODUCT_BOUGHT:"favorite_sale_product_bought",LANTERN_COMBO_NO_PLACE:"lantern_combo_no_place",
LANTERN_MULTICOLOR_NO_PLACE:"lantern_multicolor_no_place",BOOSTER_COMBO_NO_PLACE:"booster_combo_no_place",BOOSTER_MULTICOLOR_NO_PLACE:"booster_multicolor_no_place",BATTLE_PASS_FINISH_TASK:"battle_pass_finish_task",BATTLE_PASS_RECEIVED:"battle_pass_received",BATTLE_PASS_RECEIVED_PREMIUM:"battle_pass_received_premium",BATTLE_PASS_BOUGHT:"battle_pass_bought",METHA_ITEM:"metha_item",METHA_LEVEL:"metha_level",MINIGAME_FINISH:"minigame_finish",MINIGAME_REWARD:"minigame_reward",MINESWEEPER_START:"minesweeper_start",MINESWEEPER_VICTORY:"minesweeper_victory",MINESWEEPER_CONTINUE:"minesweeper_continue",MINESWEEPER_CONTINUE_RUBY:"minesweeper_continue_ruby",LOCALSTORAGE_CLEARED:"localstorage_cleared",LOCALSTORAGE_ERROR_SET_ITEM:"localstorage_error_set_item",PAYMENT_OPEN:"payment_open",PAYMENT_CANCEL:"payment_cancel",PAYMENT_FAILURE:"payment_failure",PAYMENT_NOT_INITIALIZED:"payment_not_initialized",PAYMENT_NOT_REFRESHED:"payment_not_refreshed",PAYMENT_SUCCESS:"payment_success",
TREASURE_SEARCH_START:"treasure_search_start",TREASURE_SEARCH_FINISH:"treasure_search_finish",SIMPLE_METHA_BACKGROUND:"simple_metha_background",CARD_SKIN_CHANGED:"card_skin_changed",CARD_SKIN_BOUGHT_USING_COINS:"card_skin_bought_using_coins",LOGIN:"login",SIGN_UP:"sign_up",TUTORIAL_COMPLETE:"tutorial_complete",TUTORIAL_BEGIN:"tutorial_begin",SEARCH:"search",PRESENT_OFFER:"present_offer",JOIN_GROUP:"join_group",SELECT_CONTENT:"select_content",UNLOCK_ACHIEVEMENT:"unlock_achievement",POST_SCORE:"post_score",BONUS_WORLD_LEVEL:"bonus_world_level",PRODUCT_BOUGHT_BONUS_WORLD:"product_bought_bonus_world",BONUS_WORLD_DAU:"bonus_world_dau",BONUS_WORLD_LEVEL_DAU:"bonus_world_level_dau",BONUS_WORLD_REWARD:"BONUS_WORLD_REWARD",SLOT_MACHINE_DAU:"slot_machine_dau",SLOT_MACHINE_SPIN_DAU:"slot_machine_spin_dau",SLOT_MACHINE_SPIN:"slot_machine_spin",SLOT_MACHINE_TICKET:"slot_machine_ticket",PRODUCT_BOUGHT_BUILDING:"product_bought_building"};"undefined"!=typeof module&&(module.exports=cleverapps_events),
cleverapps.setupResolution=function(){var l;cc.view.enableRetina(!0),cc.view.adjustViewPort(!0);var e=cleverapps.setupDesignResolution=function(e){var S=cc.view.getFrameSize();if(e=e||{},cc.sys.isMobile||"undefined"==typeof window||(S={width:window.innerWidth,height:window.innerHeight},l=window.innerHeight),!(S.width<cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE||S.height<cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE)&&(void 0===cleverapps.rightOrientation||(cleverapps.rightOrientation="horizontal"===cleverapps.config.orientation?S.width>S.height:S.width<S.height,cleverapps.rotatePhoneInfo(cleverapps.rightOrientation),cleverapps.rightOrientation))){void 0!==cleverapps&&cleverapps.decCanvasHeight&&S.height>cleverapps.decCanvasHeight&&(S.height-=cleverapps.decCanvasHeight),e.sceneMaxWidthOverride&&(cleverapps.styles.SCENE_MAX_WIDTH=e.sceneMaxWidthOverride),e.width&&(S.width=e.width),e.height&&(S.height=e.height);var t=S.width/S.height;if(S.width&&S.height){var s={width:S.width,height:S.height}
;cleverapps.info.setKeyValue("resolution",s)}var i=cleverapps.styles.SCENE_HEIGHT,n=i*t;if(n<cleverapps.styles.SCENE_MIN_WIDTH&&(i=(n=cleverapps.styles.SCENE_MIN_WIDTH)/t),cc.sys.isNative)cc.view.setDesignResolutionSize(n,i,cc.ResolutionPolicy.SHOW_ALL);else{var o=cc.ContainerStrategy.extend({apply:function(e,t){var s,i,n=S.width,o=S.height,r=cc.container.style,a=t.width,c=t.height,l=n/a,p=o/c;l<p?(s=n,i=c*l):(s=a*p,i=o);var d=Math.round((n-s)/2);s=Math.round(s),i=Math.round(i),this._setupContainer(e,s,i),e._isRotated?r.marginLeft=o+"px":r.margin="0",r.paddingLeft="0",r.paddingRight="0",r.paddingTop="0",r.paddingBottom="0",r.padding="0",r.margin="0 "+d+"px";var h=document.getElementById("bg");h&&(h.style.position="absolute",h.style.left="0px",h.style.top="0px");var u=document.getElementById("LeftBg");if(u)if(0<d){u.style.width=d+1+"px";var g=bundles.browser_resources.urls.left_bg||bundles.browser_resources.urls.pattern_bg_png;g&&(u.style.backgroundImage="url('"+g+"')")
}else u.style.width="0";var v=document.getElementById("RightBg");if(v)if(0<d){v.style.left=d+s-1+"px",v.style.width=n-d-s+2+"px";var m=bundles.browser_resources.urls.right_bg||bundles.browser_resources.urls.pattern_bg_png;m&&(v.style.backgroundImage="url('"+m+"')")}else v.style.width="0";var f=document.getElementById("LeftSideBar"),_=document.getElementById("RightSideBar");if(f&&bundles.browser_resources.urls.sidebar){var y=cleverapps.styles.SIDEBAR_WIDTH,w=Math.ceil(y*i/1334),T=Math.ceil(5*i/1334);T<cleverapps.styles.MIN_SIDEBAR_X&&(T=cleverapps.styles.MIN_SIDEBAR_X),0<d?(f.style.left=d-w+T+"px",f.style.width=w+"px",f.style.backgroundImage="url('"+bundles.browser_resources.urls.sidebar+"')",_.style.left=d+s-T+"px",_.style.width=w+"px",_.style.backgroundImage="url('"+bundles.browser_resources.urls.sidebar+"')"):(f.style.width="0",_.style.width="0")}}});if(cleverapps.isInstant()&&cleverapps.styles.INSTANT_SCENE_MAX_WIDTH&&(
cleverapps.styles.SCENE_MAX_WIDTH=cleverapps.styles.INSTANT_SCENE_MAX_WIDTH),n>cleverapps.styles.SCENE_MAX_WIDTH){var r=resolutions[cleverapps.settings.calcResolution()].horizontal;n=void 0!==cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&n>=cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&(S.height<cleverapps.styles.SCENE_HORIZONTAL_MAX_HEIGHT||r||cleverapps.wideMode&&cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL)?cleverapps.styles.SCENE_HORIZONTAL_WIDTH:cleverapps.styles.SCENE_MAX_WIDTH}var a=new cc.ResolutionPolicy(new o,cc.ContentStrategy.SHOW_ALL);cc.view.setDesignResolutionSize(n,i,a),void 0!==cleverapps&&cleverapps.canvasTop&&(document.getElementById("Cocos2dGameContainer").style["margin-top"]=cleverapps.canvasTop)}var c=cc.director.getRunningScene();c&&c.onChangeSize&&c.onChangeSize(),c&&c.replacing&&(cleverapps.FixedWidthScene.changedSize=!0),cleverapps.onResolutionChanged(),cleverapps.canBlockOrientation=cleverapps.MobileOK.isAppropriate(
)||cleverapps.MobileMyMailRu.isAppropriate()||cleverapps.SPMobage.isAppropriate(),cleverapps.canBlockOrientation||!cc.sys.isMobile||cc.sys.isNative||(cleverapps.canBlockOrientation=!0),void 0===cleverapps.rightOrientation&&cleverapps.canBlockOrientation&&("horizontal"!==cleverapps.config.orientation&&n<i||"horizontal"===cleverapps.config.orientation&&i<n)&&(cleverapps.rightOrientation=!0,cleverapps.rotatePhoneInfo(!0))}};cc.view._orientationChanging=!1,cc.view.resizeWithBrowserSize(!0),cc.view.setResizeCallback(e),resolutionScale=resolutions[cleverapps.settings.calcResolution()].scale,cleverapps.UI.updateSizes(resolutionScale),cleverapps.UI.selectSkinResources(cleverapps.settings.calcResolution()),cleverapps.home&&cleverapps.home.setupResolution(),cleverapps.farm&&cleverapps.farm.setupResolution(),e(),cc.sys.isMobile||"undefined"==typeof window||setTimeout(function(){l!==window.innerHeight&&e(),setTimeout(function(){l!==window.innerHeight&&e()},3e3)},1e3)},
cleverapps.rotatePhoneInfo=function(e){document.getElementById("RotatePhoneText").innerText=Messages.get("Rotate.device"),document.getElementById("RotatePhoneIcon").src=bundles.rotate_phone.urls.rotate_png,document.getElementById("RotatePhone").style.display=e?"none":"block"},cleverapps.afterResolutionChanged=function(e){cleverapps._afterResolutionChangedCallbacks||(cleverapps._afterResolutionChangedCallbacks=[]),cleverapps._afterResolutionChangedCallbacks.push(e)},cleverapps.onResolutionChanged=function(){cleverapps._resolutionChangeTimeout&&clearInterval(cleverapps._resolutionChangeTimeout),cleverapps._whenResolutionStableTimeouts&&(cleverapps._whenResolutionStableTimeouts.forEach(function(e){clearInterval(e)}),delete cleverapps._whenResolutionStableTimeouts),cleverapps._afterResolutionChangedCallbacks&&cleverapps._afterResolutionChangedCallbacks.forEach(function(e){e()}),cleverapps._resolutionChangeTimeout=setTimeout(cleverapps.onResolutionStable,500)},
cleverapps.onResolutionStable=function(){cleverapps._whenResolutionStableCallbacks&&(cleverapps._whenResolutionStableCallbacks.forEach(function(e){e()}),delete cleverapps._whenResolutionStableCallbacks)},cleverapps.whenResolutionStable=function(e){cleverapps._whenResolutionStableCallbacks||(cleverapps._whenResolutionStableCallbacks=[]),e=cleverapps.once(e),cleverapps._whenResolutionStableCallbacks.push(e),cleverapps._whenResolutionStableTimeouts||(cleverapps._whenResolutionStableTimeouts=[]),cleverapps._whenResolutionStableTimeouts.push(setTimeout(e,500))},window.ENABLE_IMAEG_POOL=!1,cleverapps.EVENTS=cleverapps_events,cleverapps.whenAllInitialized=function(e){cleverapps.allInitialized&&e(),cleverapps.__whenAllInitializedCallbacks||(cleverapps.__whenAllInitializedCallbacks=[]),cleverapps.__whenAllInitializedCallbacks.push(e)},cleverapps.afterAllLoadingFinish=function(){cleverapps.allInitialized=!0,
cleverapps.__whenAllInitializedCallbacks&&cleverapps.__whenAllInitializedCallbacks.forEach(function(e){e()})},cleverapps.customBoardGameInitialization=function(e){levels.gameHints=new levels.GameHints,levels.cookieJar=new cleverapps.CookieJar,levels.tutorial=new cleverapps.Tutorial},cleverapps.customMatch3Initialization=function(e){levels.levelAttempts=new levels.LevelAttempts},cleverapps.afterResourceLoaded=function(e){"undefined"!=typeof document&&(document.title=Messages.get(cleverapps.config.title)),levels.initialize(),"board"===cleverapps.config.type?cleverapps.customBoardGameInitialization(e):"match3"===cleverapps.config.type&&cleverapps.customMatch3Initialization(e),cleverapps.metha.distract({focus:"afterAllLoadingFinish",actions:[function(e){"undefined"!=typeof FBInstant?FBInstant.startGameAsync().then(e):e()},function(e){if(cleverapps.afterAllLoadingFinish(),cleverapps.dailyLevel.isStartFromPortlet())return cleverapps.eventLogger.logEvent(
"daily_level_channel_"+cleverapps.dailyLevel.getCurrentEvent()),void cleverapps.dailyLevel.start(e);"mergecraft"===cleverapps.config.name&&cleverapps.config.editorMode&&cleverapps.isLocalhost()&&(e(),cleverapps.config.adminMode=!0,new Episode(0).getLevel(0).edit()),cleverapps.Plot.onStartup(e)}]})},cleverapps.createGlobalObjects=function(){Missions.initialize(),cleverapps.bundleLoader=new BundleLoader,cleverapps.flags=new cleverapps.Flags,cleverapps.social=cleverapps.SocialManager.create(),cleverapps.eventBus=new cleverapps.EventEmitter,cleverapps.DataLoader.init(),cleverapps.synchronizer=new cleverapps.Synchronizer,cleverapps.eventLogger=new cleverapps.EventsLogger,cleverapps.metha=new Metha,cleverapps.playSession=new PlaySession,cleverapps.info=new cleverapps.Information;var e=levels.initUser();return cleverapps.abTest=new cleverapps.ABTest,cleverapps.history=new History,cleverapps.scenes=new cleverapps.Scenes,cleverapps.environment=new cleverapps.Environment,
cleverapps.communityManager=new CommunityManager,cleverapps.skins=new cleverapps.SkinManager,cleverapps.windows=new Windows,cleverapps.settings=new cleverapps.Settings(e),cleverapps.audio=new cleverapps.Audio,cleverapps.versionChecker=new VersionChecker,cleverapps.userresult=new UserResult,cleverapps.info.reportPhone(),cleverapps.info.reportUserAgent(),cleverapps.info.reportAppVersion(),cleverapps.info.reportMaxTextureSize(),cleverapps.info.reportSysLanguage(),cleverapps.firebase=cleverapps.FirebaseManager.run(),cleverapps.firebase.init(),cleverapps.metha.getType()===Metha.FARM?(cleverapps.farm=new Farm,MethaHelper.prepare()):cleverapps.metha.getType()===Metha.HOMEFIX?(cleverapps.home=new Home,MethaHelper.prepare()):cleverapps.metha.getType()===Metha.KNOCKOUT&&(cleverapps.knockout=new Knockout),cleverapps.metha.getType()===Metha.SIMPLE&&(cleverapps.simple=new Simple),cleverapps.promotion=new cleverapps.Promotion,cleverapps.adjust=new cleverapps.Adjust,
cleverapps.facebookEventsLogger=new cleverapps.FacebookEventsLogger,cleverapps.friends=new FriendsCache,cleverapps.invitalbleFriends=new FriendsCache(!0),cleverapps.payments=cleverapps.PaymentsManager.init(),cleverapps.paymentsHistory=new cleverapps.PaymentsHistory,cleverapps.localPushes=new cleverapps.LocalPushes,levels.progress=new Progress,levels.episodes=EpisodesManager.create(),cleverapps.serverFlags=new cleverapps.ServerFlags,cleverapps.periodicBonus=new cleverapps.MiniGame(e),cleverapps.boostersCounter=new cleverapps.BoostersCounter(e),cleverapps.gun=new Gun,cleverapps.isKnockoutGame()&&(cleverapps.knockoutTutorial=new KnockoutTutorial),cleverapps.tempGoods=new cleverapps.TempGoods,cleverapps.config.lives&&(cleverapps.lives=new cleverapps.Lives(e)),cleverapps.dailyTasks=new cleverapps.DailyTasks(e),cleverapps.forces=new Forces,cleverapps.packManager=new PackManager,cleverapps.piggyBank=new PiggyBank,Subscription.IsModelAvailable()&&(cleverapps.subscription=new Subscription),
"undefined"!=typeof Heroes&&(match3.heroes=new Heroes),"match3"===cleverapps.config.type&&(cleverapps.starChest=new cleverapps.StarChest),levels.friendSorter=new FriendSorter,levels.friendRequests=new levels.FriendRequests,cleverapps.eventManager=new EventManager,cleverapps.competitionPlayers=new CompetitionPlayers,cleverapps.competitionStatistics=new CompetitionStatistics,cleverapps.bountyManager=new BountyManager,cleverapps.leadersWindowTable=new cleverapps.Table,cleverapps.dailyCupLeadersWindowTable=new cleverapps.Table,cleverapps.dailyCup=new DailyCup(DailyCup.TYPE_DAILY),-1!==["olympics","differences"].indexOf(cleverapps.config.name)&&(cleverapps.weeklyCup=new DailyCup(DailyCup.TYPE_WEEKLY),cleverapps.weeklyCupTop=new WeeklyCupTop),-1!==["tripeaks","spades"].indexOf(cleverapps.config.name)&&(cleverapps.cardSkins=new CardSkins),"merge"===cleverapps.config.type&&(cleverapps.unitSyncer=new UnitSyncer,cleverapps.unitSaver=new UnitSaver),cleverapps.dailyLevel=new DailyLevel,
cleverapps.user.calcIdfa(),cleverapps.rewardedAdsManager=new RewardedAdsManager,cleverapps.toolbar=new Toolbar,cleverapps.sideBar=new SideBar,cleverapps.menuBar=new MenuBar,cleverapps.missionManager=new MissionManager,void 0!==cleverapps.BonusRoundChest&&(cleverapps.bonusRoundChest=new cleverapps.BonusRoundChest(e),cleverapps.toolbar.addItem(new BonusRoundToolbarItem)),cleverapps.exclamation=new Exclamation,cleverapps.tooltipManager=new TooltipManager,PlayButton.IsAvailable()&&(cleverapps.playButton=new PlayButton),cleverapps.consoleStream=new cleverapps.ConsoleStream,cleverapps.chat=new Chat,cleverapps.keyboardController=new KeyboardController,cleverapps.wideMode=new cleverapps.WideMode,e},cleverapps.onStart=function(){"undefined"!=typeof document&&(document.title=cleverapps.config.title);var e=cleverapps.createGlobalObjects(),t=2;cleverapps.flags.norest||(t++,cleverapps.synchronizer._onceFirstSyncCompletedListener=cleverapps.waitNoMore(3e3,function(){console.log("first sync"),i()})),
cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.LocalPushes.IosWebViewSender.askPermission();var s=function(){cleverapps.afterResourceLoaded(e)},i=cleverapps.wait(t,function(){cc.loaderScene.beforeTransitionAnimations?cc.loaderScene.beforeTransitionAnimations(s):s()});cleverapps.social.initialize(function(){cleverapps.versionChecker.check(),0===levels.user.getProgress()&&(cc.sys.isNative||cleverapps.social.loginPlacement||"sp_mbga"===cleverapps.User.calcSource()||cleverapps.social.needWindowForLogin()||cleverapps.social.checkConnection()),cleverapps.social.isLoggedIn()?cleverapps.SocialManager.onLogin():cleverapps.synchronizer.syncWhenReady(),cleverapps.FBLike.createLikeButtons(),cleverapps.NativeLinks.createLinks(),i()}),function(){cleverapps.setupResolution(),cleverapps.Spine.prepare(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.Parallax.refresh);var e=cc.LoaderScene;cc.loaderScene=new LoaderScene,cc.loaderScene.init(),
cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){cc.loaderScene._updateTransform()}),cc.loaderScene.sceneBundles=ResourceProcessor.calcProbablyNeed();var t=[].concat.apply([],cc.loaderScene.sceneBundles.map(function(e){return new Bundle(e).listUrls()}));e.preload(t,function(){cleverapps.bundleLoader.loadBundles(cc.loaderScene.sceneBundles,{onSuccess:function(){cc.sys.isNative||"undefined"==typeof logTimeStart||(logTimeStartTimeout&&clearTimeout(logTimeStartTimeout),logTimeStart.save()),Messages.preload(cleverapps.settings.language,i)}})})}()},cleverapps.styles={},cleverapps.styles.ALIGN_BOTTOM="b",cleverapps.styles.GetRealCoord=function(e,t){return"number"==typeof e?e:e===cleverapps.styles.ALIGN_BOTTOM?t.height/2:void 0},cleverapps.styles.SCENE_HEIGHT=1334,cleverapps.styles.SCENE_MAX_WIDTH=1500,cleverapps.styles.SCENE_MIN_WIDTH=660,cleverapps.SETUP_RESOLUTION_MIN_FRAME_SIZE=150,cleverapps.styles.SQUARE_MODE_WIDTH=1300,cleverapps.styles.SIDEBAR_WIDTH=35,
cleverapps.styles.MIN_SIDEBAR_X=2,cleverapps.styles.COLORS={BLACK:new cc.Color(0,0,0,255),BLACK_STROKE:new cc.Color(0,0,0,90),COLOR_GRAY:new cc.Color(200,200,200,255),COLOR_DARK_GRAY:new cc.Color(150,150,150,255),COLOR_VERY_DARK_GRAY:new cc.Color(100,100,100,255),WHITE:new cc.Color(255,255,255,255),GREEN:new cc.Color(13,119,0,255),YELLOW:new cc.Color(255,255,0,255),HOVER:new cc.Color(230,230,230,255),COLOR_BROWN:new cc.Color(60,45,25,255),COLOR_RED:new cc.Color(255,0,0,255),MESSAGE_GREEN:new cc.Color(4,160,41,255),LIFE_GREEN:new cc.Color(24,200,61,255),PINK:new cc.Color(255,102,102,255),COLOR_DARK_BROWN:new cc.Color(120,85,85,255),HERO_STATS_UPGRADE:new cc.Color(57,237,7,255),GUN_PRICE_FONT_COLOR:new cc.Color(176,125,82,255),REWARDS_TEXT_STROKE_COLOR:new cc.Color(76,98,109,255),GRAY_SCALE_COLOR:new cc.Color(135,135,135,255),GRAY_SCALE_RESTORE_COLOR:new cc.Color(255,255,255,255),DAILY_TOURNAMENT_TIMER:new cc.Color(130,70,40,255),BOOSTERS_SALE_TEXT_COLOR:new cc.Color(191,164,119,255),
DARK_RED:new cc.Color(200,0,0,255),COLOR_DARK_YELLOW:new cc.Color(255,194,9,255),COLOR_BROWN_2:new cc.Color(173,61,0,255),COLOR_WINDOW_TEXT:new cc.Color(130,70,40,255),COLOR_VERYLIGHTBROWN:new cc.Color(220,191,144,255),TOOLTIP_COLOR:new cc.Color(148,49,19,255),COINS_REWARD_YELLOW:new cc.Color(255,244,55,255),COINS_REWARD_STROKE_COLOR:new cc.Color(149,67,23,255),MINIGAME_REWARD_TEXT:new cc.Color(66,68,80)},cleverapps.styles.DECORATORS={DARK_OLIVE_GREEN_STROKE:{color:new cc.Color(121,94,46,255),size:4},WHITE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,-4),blur:5},BROWN_STROKE:{color:cleverapps.styles.COLORS.COLOR_BROWN_2,size:3},BUTTON_TEXT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,0),blur:5},BUTTON_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:2},WINDOW_WHITE_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:1},REWARDS_TEXT_STROKE:{color:cleverapps.styles.COLORS.REWARDS_TEXT_STROKE_COLOR,size:3},
DAILY_TOURNAMENT_TITLE_STROKE:{color:new cc.Color(116,17,168,255),size:4},TILE_SHOP_WINDOW_STROKE:{color:new cc.Color(150,111,72,255),size:2},TILE_SHOP_WINDOW_TITLE_SHADOW:{color:new cc.Color(112,109,109,255),direction:cc.size(0,-4),blur:0},IMAGE_FONT_STROKE:{color:cleverapps.styles.COLORS.BLACK_STROKE,size:1},IMAGE_FONT_SHADOW:{color:cleverapps.styles.COLORS.BLACK,direction:cc.size(0,-1),blur:3},TRANSPARENT_BLACK_2PX:{color:cleverapps.styles.COLORS.BLACK_STROKE,size:2}},cleverapps.styles.FONTS=cleverapps.overrideFonts({},{VICTORY_TEXT:{size:56,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.WHITE_TEXT_SHADOW},GUN_PRICE_TEXT:{size:40,color:cleverapps.styles.COLORS.GUN_PRICE_FONT_COLOR},MISSION_RULES_BUTTON_TEXT:{size:64,color:cleverapps.styles.COLORS.WHITE},FBLOGINORINVITE_TEXT:{size:28,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,
shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},SUBSCRIPTION_BUTTON_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIPTION_OFFERS_MAIN_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},SUBSCRIPTION_OFFERS_TEXT:{size:16,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_OFFERS_MAIN_TEXT:{size:38,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_OFFERS_TEXT:{size:16,color:cleverapps.styles.COLORS.WHITE,
shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_ARROW_TEXT:{size:32,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TOURNAMENTSTORY_BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE},BUTTON_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},GAME_REWARD_BUTTON_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.BUTTON_TEXT_SHADOW,stroke:cleverapps.styles.DECORATORS.BUTTON_TEXT_STROKE},TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},VICTORY_CHEST_TEXT:{name:"default",size:50},SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},
SMALL_TEXT_BROWN:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},WINDOW_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},MISSIONS_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},DAILY_TASK_BOOSTER_AMOUNT_TEXT:{size:60,color:cleverapps.styles.COLORS.COLOR_BROWN},WINDOW_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TERMS_TEXT:{size:22,color:cleverapps.styles.COLORS.COLOR_GRAY},SUBSCRIBE_CTA_TITLE:{size:36,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_FEATURE_TEXT:{size:36,color:cleverapps.styles.COLORS.COLOR_VERY_DARK_GRAY},SUBSCRIBE_BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIBE_CTA_TEXT:{size:36,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIBE_TERMS_BUTTIONS_TEXT:{size:24,color:cleverapps.styles.COLORS.COLOR_BROWN},
SUBSCRIPTION_MAIN_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN},SUBSCRIPTION_REWARD_READY_TEXT:{size:34,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT:{size:18,color:cleverapps.styles.COLORS.GUN_PRICE_FONT_COLOR},REWARDS_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.REWARDS_TEXT_STROKE},HERO_STATS_VALUE:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},HERO_UPGRADE:{size:34,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},HERO_STATS_UPGRADE_VALUE:{size:30,color:cleverapps.styles.COLORS.HERO_STATS_UPGRADE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},INFO_EXP_TEXT:{size:37,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SMALL_TEXT_ERROR:{size:30,color:cleverapps.styles.COLORS.COLOR_RED},EPISODE_TITLE_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},SHARE_BUTTON_REWARD_TEXT:{},
WHITE_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SMALL_WHITE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},LIVES_AMOUNT_TEXT:{name:"default",size:40},DAILY_TASKS_LEVEL_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},DAILY_TASK_BUTTON_TEXT:{size:46,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},PIGGY_BANK_AMOUNT_TEXT:{size:44,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},PACK_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.BLACK},FORCE_MESSAGE_TEXT:{size:40,color:cleverapps.styles.COLORS.COLOR_BROWN},DAILY_TOURNAMENT_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.DAILY_TOURNAMENT_TITLE_STROKE},DAILY_TOURNAMENT_TEXT:{size:40,
color:cleverapps.styles.COLORS.DAILY_TOURNAMENT_TIMER},BIG_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},BREAKVIEW_AMOUNT_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},TILE_SHOP_WINDOW_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_STROKE},TILE_SHOP_WINDOW_TITLE_TEXT:{size:85,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_WINDOW_TITLE_SHADOW},WHITE_TITLE_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},LEVEL_TUTORIAL_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},TOOLTIP_TEXT:{size:40,color:cleverapps.styles.COLORS.TOOLTIP_COLOR},TOOLTIP_FONT:{color:cleverapps.styles.COLORS.TOOLTIP_COLOR,size:40},TREASURE_SEARCH_PROGRESS_BAR_TEXT:{name:"default",size:35,
color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},DAILY_TASK_PROGRESS_FONT:{name:"default",size:35}}),cleverapps.styles.SpineSkins={},cleverapps.Environment=function(){this.episodeNo=levels.user.episode,this.levelNo=levels.user.level,this.scene=void 0,this.onOpenWindowListener=function(e){},this.paused=!1,this.onShowCallbacks=[],this.onShowCounter=0,cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.onShow.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,this.onHide.bind(this)),this.onShowTime=Date.now()},cleverapps.whenShow=function(s){return function(){var e=this,t=arguments;cleverapps.environment.whenShow(function(){s.apply(e,t)})}},cleverapps.Environment.prototype.whenShow=function(e){this.paused?this.onShowCallbacks.push(e):e()},cleverapps.Environment.prototype.onHide=function(){this.paused=!0,this.onShowTimeout&&(clearTimeout(this.onShowTimeout),delete this.onShowTimeout)},
cleverapps.Environment.prototype.onShow=function(){this.onShowTime=Date.now(),this.onShowCounter++,this.onShowTimeout=setTimeout(function(){delete this.onShowTimeout,this.paused=!1;var e=this.onShowCallbacks;this.onShowCallbacks=[],e.forEach(function(e){this.whenShow(e)}.bind(this))}.bind(this),300)},cleverapps.Environment.prototype.setScene=function(e){this.scene=e,cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.isDailyCupScene=function(){return this.scene===cleverapps.Environment.SCENE_DAILY_CUP},cleverapps.Environment.prototype.isMainScene=function(){return this.scene===cleverapps.Environment.SCENE_MAIN||"merge"===cleverapps.config.type&&this.scene===cleverapps.Environment.SCENE_GAME},cleverapps.Environment.prototype.isMethaScene=function(){return this.scene===cleverapps.Environment.SCENE_METHA||this.scene===cleverapps.Environment.SCENE_MAIN&&!cleverapps.metha.withSimpleMain()},
cleverapps.Environment.prototype.isHeroesScene=function(){return this.scene===cleverapps.Environment.SCENE_HEROES},cleverapps.Environment.prototype.isGameScene=function(){return this.scene===cleverapps.Environment.SCENE_GAME},cleverapps.Environment.prototype.isEditorScene=function(){return this.scene===cleverapps.Environment.SCENE_EDITOR},cleverapps.Environment.prototype.isChatScene=function(){return this.scene===cleverapps.Environment.SCENE_CHAT},cleverapps.Environment.prototype.isMiniGameScene=function(){return this.scene===cleverapps.Environment.SCENE_MINE||this.scene===cleverapps.Environment.SCENE_SLOT_MACHINE},cleverapps.Environment.prototype.isAdministratorScene=function(){return this.scene===cleverapps.Environment.SCENE_ADMINISTRATOR},cleverapps.Environment.prototype.isSceneWithPreview=function(){return this.scene===cleverapps.Environment.SCENE_EDITOR||this.scene===cleverapps.Environment.SCENE_ADMINISTRATOR||this.scene===cleverapps.Environment.SCENE_WYSIWYG},
cleverapps.Environment.prototype.isWysiwygScene=function(){return this.scene===cleverapps.Environment.SCENE_WYSIWYG},cleverapps.Environment.prototype.isBonusWorldScene=function(){return this.scene===cleverapps.Environment.SCENE_BONUS_WORLD},cleverapps.Environment.prototype.isSlotMachineScene=function(){return this.scene===cleverapps.Environment.SCENE_SLOT_MACHINE},cleverapps.Environment.prototype.onOpenWindow=function(e){this.onOpenWindowListener(e),cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.onCloseWindow=function(e){cleverapps.firebase&&cleverapps.firebase.setScreenName(this.getScreen(),this.getScene())},cleverapps.Environment.prototype.getActiveWindow=function(){var e=cleverapps.windows&&cleverapps.windows.currentWindow();if(e&&e.name)return e.name},cleverapps.Environment.prototype.getScreen=function(){return this.getActiveWindow()||this.getScene()},cleverapps.Environment.prototype.getScene=function(){
return this.scene},cleverapps.Environment.SCENE_MAIN="main",cleverapps.Environment.SCENE_METHA="metha",cleverapps.Environment.SCENE_GAME="game",cleverapps.Environment.SCENE_EDITOR="editor",cleverapps.Environment.SCENE_ADMINISTRATOR="administrator",cleverapps.Environment.SCENE_COMICS="comics",cleverapps.Environment.SCENE_HEROES="heroes",cleverapps.Environment.SCENE_CARD_SKINS="cardskins",cleverapps.Environment.SCENE_DAILY_CUP="dailycup",cleverapps.Environment.SCENE_TRIPEAKS="tripeaks",cleverapps.Environment.SCENE_CHAT="chat",cleverapps.Environment.SCENE_WYSIWYG="wysiwyg",cleverapps.Environment.SCENE_BONUS_WORLD="bonusworld",cleverapps.Environment.SCENE_SLOT_MACHINE="slotmachine",cleverapps.Environment.SCENE_MINE="mine",resolutionScale=1,cleverapps.UI={stableKeys:["verticalAlignment","texType","opacity","scale9","parent","scale","minScale","maxScale","rotation","baseScale","zoomScale","zoom","scaleX","scaleY","anchorX","anchorY","zIndex","zOrder","mobileScaleAdd","coinScale",
"SIDEBAR_WIDTH","MOBILE_MENU_SCALE","MIN_SIDEBAR_X","duration","delay","idleDelay","visiblePages","type","hideDirection","widthMultiplier","number","zeroPercentage","mobileScale","innerScale","dialogueStages","baseline","skew","anchor","factorX","factorY","smallMargin"],needUpdateSizes:function(e,t,s){return!(s instanceof cc.Color)&&(("direction"!==t||"object"==typeof s)&&!(0<=cleverapps.UI.stableKeys.indexOf(t)))},updateSizes:function(i){var n={},o=[],r=function(e){if(!e.isUpdated)for(var t in e.isUpdated=!0,o.push(e),e){var s=e[t];if("number"==typeof s){if(Array.isArray(e))continue;cleverapps.UI.needUpdateSizes(e,t,s)&&(n[t]=!0,e[t]*=i,e[t]=Math.round(e[t]))}else"object"==typeof s&&cleverapps.UI.needUpdateSizes(e,t,s)&&r(s)}};cleverapps.styles.isUpdated||(r(cleverapps.styles),cleverapps.config.fonts.forEach(function(e){e.originalSize=e.size+""}),r(cleverapps.config.fonts),cleverapps.values(Forces).forEach(function(e){e.style&&r(e.style),e.Finger&&r(e.Finger)}),o.forEach(function(e){
delete e.isUpdated}),cleverapps.styles.isUpdated=!0)},selectSkinResources:function(e){var n=function(e,t,s){for(var i in e)"string"==typeof e[i]&&(e[i]=e[i].replace("/%r/","/"+t+"/")),s&&"object"==typeof e[i]&&n(e[i],t,s)};for(var t in n(res,e),bundles){var s=bundles[t];n(s.urls,e),n(s.frames,e),n(s.jsons,e)}for(var i in cleverapps.styles){var o=cleverapps.styles[i];n(o,e,!0)}if("object"==typeof HeroesLibrary&&n(HeroesLibrary,e,!0),"undefined"!=typeof CardSkins&&n(CardSkins,e,!0),"undefined"!=typeof unpackedMap)for(var t in unpackedMap)-1!==t.indexOf("/%r/")&&(unpackedMap[t.replace("/%r/","/"+e+"/")]=unpackedMap[t],delete unpackedMap[t])},HORIZONTAL:0,VERTICAL:1,ALIGN_START:1,ALIGN_CENTER:2,ALIGN_END:3,TOP_TO_BOTTOM:2,SCALE_ANIMATION:2,OPACITY_ANIMATION:3,arrangeWithMargins:function(r,a){var c=a.margin;void 0===c&&(c=0);var l=0;l=a.direction===cleverapps.UI.HORIZONTAL?a.x||0:a.y||0;var p=a.iterator;return p||(p=function(e,t,s){if(
a.align===cleverapps.UI.ALIGN_START||a.align===cleverapps.UI.ALIGN_END){var i=a.direction===cleverapps.UI.HORIZONTAL?e.height*e.scaleY/2:e.width*e.scaleX/2;a.align===cleverapps.UI.ALIGN_END&&(i=-i),a.direction===cleverapps.UI.HORIZONTAL?s+=i:t+=i}e.setPositionRound(t,s)}),r.forEach(function(e,t){a.direction===cleverapps.UI.TOP_TO_BOTTOM&&(e=r[r.length-1-t]);var s=e.baseScaleX||e.baseScale||e.scaleX,i=e.baseScaleY||e.baseScale||e.scaleY;if(a.direction===cleverapps.UI.HORIZONTAL){var n=e.y;void 0!==a.y&&(n=a.y-(.5-e.anchorY)*e.height*Math.abs(i)),p(e,l+e.width*Math.abs(s)*e.anchorX,n),l+=e.width*Math.abs(s)}else{var o=e.x;void 0!==a.x&&(o=a.x-(.5-e.anchorX)*e.width*Math.abs(s)),p(e,o,l+e.height*Math.abs(i)*e.anchorY),l+=e.height*Math.abs(i)}l+=c}),l-c},calculateContentSize:function(e){var t=0,s=0;return e.children.forEach(function(e){t<e.x+e.width*e.scaleX/2&&(t=e.x+e.width*e.scaleX/2),s<e.y+e.height*e.scaleY/2&&(s=e.y+e.height*e.scaleY/2)}),cc.size(Math.round(t),Math.round(s))},
fitToBox:function(e,t){var s=Math.min(t.width/e.width,t.height/e.height,t.maxScale||1);e.setScale(s)},LabelTTF:cc.extend(cc.LabelTTF.extend({ctor:function(e,t){this.___enabled=!0,this._strokeOpacity=0,this._super("",t)},onEnter:function(){this.___enabled=!0,this._super()},onExit:function(){this.___enabled=!1,this._super()},fitToHeight:function(e){for(;this.height>e;)this.setFontSize(this.getFontSize()-1)},fitTo:function(e,t){if(this._autoDimensions&&(this.setDimensions(0,0),2048<this.width)){var s=this.getString();cleverapps.throwAsync("Text width > 2048 - "+s)}cleverapps.UI.ImageFont.prototype.fitTo.apply(this,arguments)},canAttachLastLine:function(){var e=this._renderCmd._strings;return!(!e||e.length<=1)&&(10<=e[e.length-2].length&&e[e.length-1].length<=2)},setDimensions:function(){var e=cc.configuration.getMaxTextureSize()/cc.view.getDevicePixelRatio();1<arguments.length?arguments[0]>e&&(arguments[0]=e):1===arguments.length&&arguments[0].width&&arguments[0].width>e&&(
arguments[0].width=e),this._super.apply(this,arguments),this._autoDimensions=!1},setFontSize:function(e){cleverapps.styles.UI.glyphScale&&-1!==["ja","zh","ko"].indexOf(cleverapps.settings.language)&&(e=Math.round(e*cleverapps.styles.UI.glyphScale.scale)),this._super(e)},setFont:function(e){if(this.___enabled){this.setFontFillColor(e.color||cleverapps.styles.COLORS.WHITE),this.setFontSize(e.size);var t=cleverapps.styles.UI.TTFText,s=t.verticalAlignment;this.safariCheck()&&(s=t.safari.verticalAlignment),void 0!==s&&this.setVerticalAlignment(s),e.shadow?this.enableShadow(e.shadow.color,e.shadow.direction,e.shadow.blur):this.disableShadow(),e.stroke?this.enableStroke(e.stroke.color,e.stroke.size):this.disableStroke(),e.lineHeight&&this.setLineHeight(e.lineHeight);var i=this.getString();cc.LabelTTF.prototype.setString.call(this,""),cc.LabelTTF.prototype.setString.call(this,i)}},enableStroke:function(e,t){this._super(e,t);var s=e.a/255;this._strokeOpacity!==s&&(this._strokeOpacity=s,
this._renderCmd._setColorsString())},byLetterAnimation:function(e){var i=(e=e||{}).speed||.03,t=e.delay||.1;if(cc.sys.isMobile&&!cc.sys.isNative)return this.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.FadeIn(.3))),void(e.callback&&e.callback());this._fullString=this.getString();var n=0;this._byLetterAnimationRunning&&this.stopAllActions(),this._byLetterAnimationRunning=!0,this._byLetterAnimationDone=function(){this._byLetterAnimationRunning&&(this.stopAllActions(),this._byLetterAnimationRunning=!1,cc.LabelTTF.prototype.setString.call(this,this._fullString),this._byLetterAnimationDone=void 0,e.callback&&e.callback())}.bind(this),cc.LabelTTF.prototype.setString.call(this,"");var o=void 0,r=function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){var e=0<n?this._fullString[n-1]:void 0;n++;var t=this._fullString[n-1];if(" "===e&&" "!==t){for(var s=n;s<this._fullString.length&&" "!==this._fullString[s];)s++
;cc.LabelTTF.prototype.setString.call(this,this._fullString.substr(0,s)),o&&this.height!==o&&(this._fullString=this._fullString.substr(0,n-2)+"\n"+this._fullString.substr(n-1))}cc.LabelTTF.prototype.setString.call(this,this._fullString.substr(0,n)),n<this._fullString.length?(r(i),o=this.height):this._byLetterAnimationDone&&this._byLetterAnimationDone()}.bind(this))))}.bind(this);r(t)},byLetterAnimationFinish:function(){this._byLetterAnimationRunning&&this._byLetterAnimationDone()},countToAnimation:function(e,t){for(var s=e-this.getString(),i=0<s?1:-1,n=t/Math.abs(s),o=[],r=0;r<Math.abs(s);r++)o.push(new cc.Sequence(new cc.CallFunc(function(){this.setString(+this.getString()+i)}.bind(this)),new cc.DelayTime(n)));this.runAction(new cc.Sequence(o))},setString:function(e,t){this.___enabled&&(e=cleverapps.UI.LabelTTF.GetLocalizedText(e,t),cc.LabelTTF.prototype.setString.call(this,e))},setTextureRect:function(){this._super.apply(this,arguments),this._offsetPosition=cc.p(0,this.getBaseline())
},safariCheck:function(){var e=cleverapps.UI.getBrowserName();return"Safari"===e||"Mobile Safari"===e||cc.sys.isWebView&&cc.sys.OS_IOS===cc.sys.os},getBaseline:function(){var e=cleverapps.styles.UI.TTFText,t=e.baseline;return this.safariCheck()&&(t=e.safari.baseline),this.getFontSize()<=40?Math.floor(t*this.getFontSize()/3):t*this.getFontSize()}}),{GetLocalizedText:function(e,t){return"number"==typeof e?e+"":"string"!=typeof e||0!==e.indexOf("messages:")?(e||"")+"":Messages.get(e.substring("messages:".length),t)}}),jumpAnimation:function(e,t,s){var i=(s=s||{}).time||.5,n=s.h||cleverapps.styles.UI.jumpAnimation.h,o=s.parent||cc.director.getRunningScene().scene,r=e.getParent();e.replaceParentSamePlace(o,{keepScale:!0});var a=cc.p(e.x,e.y),c=cc.p(e.x+t.x,e.y+t.y),l=cc.pMidpoint(a,c);l.y+=n;var p=new cc.BezierTo(i,[a,l,c]).easing(cc.easeIn(1));if(s.spawn||s.sound){var d=[];s.spawn&&d.push(s.spawn),s.sound&&d.push(new cc.Sequence(new cc.DelayTime(void 0===s.soundDelay?.5:s.soundDelay),
new cc.CallFunc(cleverapps.audio.playSound.bind(cleverapps.audio,s.sound)))),d.push(p),p=new cc.Spawn(d)}e.runAction(new cc.Sequence(p,new cc.CallFunc(function(){e.replaceParentSamePlace(r),s.callback&&s.callback()})))},collectAnimation:function(e,t,s){s=s||{};var i,n=cc.director.getRunningScene();i=s.parent?s.parent:n,e.replaceParentSamePlace(i,{keepScale:!0});var o,r=e.getPosition(),a=i.convertToNodeSpace(t.parent.convertToWorldSpace(t.getPosition()));if(s.jump)o=cc.p(r.x,a.y);else{var c=cc.pSub(a,r),l=cc.pMult(cc.pNormalize(cc.pPerp(c)),cleverapps.styles.UI.collectAnimation.bezierX),p=cc.pMidpoint(r,a),d=cc.pAdd(p,l),h=cc.pSub(p,l),u=cc.p(n.width/2,n.height/2),g=cc.pDistance(d,u),v=cc.pDistance(h,u);o=cc.pSub(r,cc.pMult(c,.33)),o=g<v?cc.pAdd(o,l):cc.pSub(o,l)}var m=s.time?s.time:.7;s.speed&&(m=(cc.pDistance(r,o)+cc.pDistance(o,a))/s.speed)<.3&&(m=.3),s.callback&&e.runAction(new cc.Sequence(new cc.DelayTime(m),new cc.CallFunc(s.callback))),e.runAction(new cc.Sequence(new cc.Spawn(
new cc.BezierTo(m,[r,o,a]),new cc.ScaleTo(m,s.noScale?e.getScale():1)),new cc.CallFunc(function(){!1!==s.finishRemove&&e.removeFromParent(),s.targetEffect&&(t.stopAllActions(),t.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.1),new cc.ScaleTo(.15,1))))}))),e.setLocalZOrder(10)},jumpCollectAnimation:function(t,s){var e=s.jump,i=s.collect;e.callback=function(){var e=s.delay||.3;i.callback=s.callback,i.jump=!0,t.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(function(){cleverapps.UI.collectAnimation(t,i.target,i)})))},e.time=e.time||.4;var n=t.getScale();t.setScale(.5*n),e.spawn=new cc.ScaleTo(e.time,1.2*n);var o=e.dist||cleverapps.styles.UI.jumpCollectAnimation.dist;cleverapps.UI.jumpAnimation(t,o,e)},animateDelta:function(e,t){if(0!==e){0<e&&(e="+"+e);var s=cleverapps.UI.generateImageText(""+e,t.font||cleverapps.styles.FONTS.WHITE_TEXT||cleverapps.styles.FONTS.TEXT);if(t.icon){var i=new cc.Sprite(t.icon);t.iconScale&&i.setScale(t.iconScale),(s=new cleverapps.Layout([s,i],
{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.UI.delta.margin})).setCascadeOpacityEnabled(!0)}t.parent&&t.parent.addChild(s),s.setPositionRound(t),t.zOrder&&s.setLocalZOrder(t.zOrder);var n=cleverapps.styles.UI.delta.y;t.dy&&(n=t.dy),t.delay=t.delay||0;var o=t.duration||2;return s.opacity=0,s.runAction(new cc.Sequence(new cc.DelayTime(t.delay),new cc.CallFunc(function(){s.opacity=255}),new cc.Spawn(new cc.MoveBy(o,cc.p(0,n)),new cc.Sequence(new cc.FadeTo(o,0),new cc.RemoveSelf)))),s}},getFontName:function(e){return void 0===e&&(e=bundles.main.urls.basefont_ttf),cc.sys.isNative&&!cc.sys.isWebView&&cc.sys.os===cc.sys.OS_ANDROID?e.srcs[0]:e.name},generateImageText:function(e,t,s,i){if(cleverapps.config.debugMode&&!cleverapps.UI.ImageFont.IsApplicable(t,e))throw console.log(t),"Not applicable image font: "+e;return e=cleverapps.UI.LabelTTF.GetLocalizedText(e,s),new cleverapps.UI.ImageFont(e,t,i)},generateOnlyText:function(e,t,s){var i=new cleverapps.UI.LabelTTF("",
cleverapps.UI.getFontName(t.font));e=cleverapps.UI.LabelTTF.GetLocalizedText(e,s);var n=cleverapps.UI.getSceneSize();return e.length*t.size*.5>n.width&&(i.setDimensions(n.width,0),i._autoDimensions=!0),i.setString(e),i.setFont(t),i},generateTTFText:function(e,t,s){var i;return cleverapps.UI.ImageFont.IsApplicable(t,e)?i=new cleverapps.UI.ImageFont(e,t):(i=new cleverapps.UI.LabelTTF("",cleverapps.UI.getFontName(t.font)),170<(e=cleverapps.UI.LabelTTF.GetLocalizedText(e,s)).length&&(i.setDimensions(cleverapps.UI.getSceneSize().width,0),i._autoDimensions=!0),i.setString(e),i.setFont(t)),i},CheckBox:cc.Node.extend({ctor:function(e){this._super(),(e=e||{}).styles=e.styles||{},this.options=e,this.onChangeCallback=e.onChange||function(e){};var t=[];this.createCheckBox(),t.push(this.checkBox),e.label&&(this.createLabel(),t.push(this.label));var s=this.getStyles(),i=new cleverapps.Layout(t,{margin:s.margin,padding:s.padding,direction:void 0!==e.direction?e.direction:cleverapps.UI.HORIZONTAL})
;this.addChild(i),this.setAnchorPoint2(),this.setContentSize2(i.getContentSize()),i.setPositionRound(this.width/2,this.height/2),cleverapps.UI.applyHover(this)},_onChange:function(e,t){switch(t){case ccui.CheckBox.EVENT_SELECTED:this.onChangeCallback(!0);break;case ccui.CheckBox.EVENT_UNSELECTED:this.onChangeCallback(!1)}cleverapps.audio.playSound(bundles.main.urls.click_effect)},createCheckBox:function(){var e=this.getStyles(),t=this.checkBox=new ccui.CheckBox;t.loadTextureBackGround(this.getSpriteFrameName(e.bgImage),ccui.Widget.PLIST_TEXTURE),t.loadTextureFrontCross(this.getSpriteFrameName(e.checkImage),ccui.Widget.PLIST_TEXTURE),t.addEventListener(this._onChange.bind(this),t),t.setSelected(this.options.isSelected)},createLabel:function(){this.label=cleverapps.UI.generateTTFText(this.options.label.text,this.options.label.font||cleverapps.styles.FONTS.WINDOW_TEXT),this.options.label.clickable&&cleverapps.UI.onClick(this,function(){this.checkBox.setSelected(!this.checkBox.isSelected()
),this._onChange(null,this.checkBox.isSelected()?ccui.CheckBox.EVENT_SELECTED:ccui.CheckBox.EVENT_UNSELECTED)}.bind(this),{noThrottle:!0})},getSpriteFrameName:function(e){return"#"===e[0]?e.substr(1):e},setSelected:function(e){this.checkBox.setSelected(e)},getStyles:function(){return this.styles||(this.styles=cleverapps.overrideStyles(cleverapps.styles.UI.CheckBox,this.options.styles,!0)),this.styles}}),makeHideable:function(e,t){e.hideHandler=new cleverapps.UI.HideHandler(e,t)},wrap:function(e,t){if(0===e.children.length)return e;for(var s,i,n,o,r=0;r<e.children.length;r++){var a=e.children[r],c=a.baseScaleX||a.baseScale||a.scaleX,l=a.baseScaleY||a.baseScale||a.scaleY,p=a.height,d=a.width;t&&(p=a.getBoundingBox().height,d=a.getBoundingBox().width,l=c=1);var h=a.y-p*l*a.anchorY,u=h+p*l;(void 0===s||h<s)&&(s=h),(void 0===i||i<u)&&(i=u);var g=a.x-d*c*a.anchorX,v=g+d*c;(void 0===n||g<n)&&(n=g),(void 0===o||o<v)&&(o=v)}return o<0&&(o=0),i<0&&(i=0),0<s&&(s=0),0<n&&(n=0),n=-n,s=-s,
e.setContentSize2(n+o,s+i),e.children.forEach(function(e){e.x+=n,e.y+=s}),e.setAnchorPoint2(),e},shake:function(t,e){var s=(e=e||{}).delay||0,i=e.power||1,n=e.vibro;void 0===n&&(n=500);var o=e.strength;o||(o=cleverapps.styles.UI.shake);var r=e.base;r||(r={x:t.x,y:t.y,r:t.rotation});var a=[{x:2,y:1,r:0},{x:-1,y:-2,r:-1},{x:-3,y:0,r:1},{x:0,y:2,r:0},{x:1,y:-1,r:1},{x:0,y:0,r:0}].map(function(e){return new cc.CallFunc(function(){t.setPosition(r.x+e.x*o.dx*i,r.y+e.y*o.dy*i),t.setRotation(r.r+e.r)})}),c=[new cc.DelayTime(s/1e3)];cleverapps.settings.vibro&&n&&c.push(new cc.CallFunc(function(){cc.sys.isNative&&void 0!==cc.Device?cc.Device.vibrate(n/1e3):"undefined"!=typeof navigator&&navigator.vibrate&&navigator.vibrate(n)})),a.forEach(function(e){c.push(e),c.push(new cc.DelayTime(.05))}),t.stopAllActions(),t.runAction(new cc.Sequence(c))},wrapWithPadding:function(e,t,s){if(t=t?{left:t.left||t.x||0,right:t.right||t.x||0,top:t.top||t.y||0,bottom:t.bottom||(t.isTop?0:t.y)||0}:{left:0,right:0,
top:0,bottom:0},s)return e.children.forEach(function(e){e.x+=t.left,e.y+=t.bottom}),e.width+=t.left+t.right,e.height+=t.top+t.bottom,e;var i=new cc.Node;return i.addChild(e),i.setContentSize2(e.width*e.scaleX+t.left+t.right,e.height*e.scaleY+t.top+t.bottom),i.setAnchorPoint2(),e.setPosition(t.left+e.width*e.scaleX/2,t.bottom+e.height*e.scaleY/2),i},targetContainPoint:function(e,t,s){if(s){if(!cc.rectContainsPoint(cc.rect(0,0,e.width,e.height),t))return!1;if(t.x+=(s.width-e.width)/2,t.x<0||t.x>s.width)return!1;var i=s.width/2,n=s.height/2;t.x>i&&(t.x=s.width-t.x);var o=e.height;return o<s.height&&(o=s.height),t.y>n&&t.y<o-n?!0:(t.y>n&&(t.y=o-t.y),!(t.y<0||t.y>n)&&(i-t.x)*n<t.y*i)}var r=e.clickPosition||{x:0,y:0};return cc.rectContainsPoint(cc.rect(r.x,r.y,e.width,e.height),t)},onDrag:function(s,i){var n,o=void 0!==(i=i||{}).dragMinDist?i.dragMinDist:cleverapps.styles.UI.DRAG_MIN_DIST,e=cleverapps.UI.DRAG_THROTTLE,r=cleverapps.throttle(e,i.onDragMove?i.onDragMove:function(){}),a=!1,t=!1
;return void 0!==i.swallowTouches&&(t=i.swallowTouches),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:t,onTouchBegan:function(e){if(!s.isDisplayed())return!1;var t=cleverapps.UI.targetContainPoint(s,s.convertTouchToNodeSpace(e),i.isometricCell);return t&&(n=e.getLocation(),i.onTouchBegan&&i.onTouchBegan(e)),t},onTouchMoved:function(e){var t=e.getLocation();if(cc.pDistance(t,n)>=o){if(!a){if(i.onDragStart&&!i.onDragStart())return;a=!0}i.followPointer&&s.setPositionRound(s.parent.convertTouchToNodeSpace(e)),r({dx:t.x-n.x,dy:t.y-n.y,touch:e})}},onTouchEnded:function(e){if(a||0===o){a=!1;var t=e.getLocation();i.onDragMove&&i.onDragMove({dx:t.x-n.x,dy:t.y-n.y,touch:e}),i.onDragEnd&&i.onDragEnd({dx:t.x-n.x,dy:t.y-n.y,touch:e})}}},s)},onTouchBegan:function(s,i,n){n=n||{},i&&!n.noThrottle&&(i=cleverapps.throttle(n.clickThrottle||cleverapps.UI.CLICK_THROTTLE,i));var e=!0;return void 0!==n.swallowTouches&&(e=n.swallowTouches),cc.eventManager.addListener({
event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:e,onTouchBegan:function(e){if(!s.isDisplayed())return!1;var t=s.convertTouchToNodeSpace(e);return!!cleverapps.UI.targetContainPoint(s,t,n.isometricCell)&&(i(t),!0)}},s)},onClick:function(i,s,n){n=n||{},s&&!n.noThrottle&&(s=cleverapps.throttle(n.clickThrottle||cleverapps.UI.CLICK_THROTTLE,s));var o,r,a=n.ignoreOnTouchMoved,c=void 0===n.ignoreOnTouchMovedThreshold?cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold:n.ignoreOnTouchMovedThreshold,e=!0;return void 0!==n.swallowTouches&&(e=n.swallowTouches),n.useInteractiveScale&&!i.applyInteractiveScale&&(i.applyInteractiveScale=cleverapps.UI.applyInteractiveScale),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:e,onTouchBegan:function(e){if(!i.isDisplayed())return!1;if(n.filter&&!n.filter())return!1;var t=i.getCropContainer();if(t&&!cc.rectContainsPoint(cc.rect(0,0,t.width,t.height),t.convertTouchToNodeSpace(e)))return!1
;var s=cleverapps.UI.targetContainPoint(i,i.convertTouchToNodeSpace(e),n.isometricCell);return s&&(o=e.getLocation(),r=!0,i.onTouchBegan&&i.onTouchBegan(),n.useInteractiveScale&&i.applyInteractiveScale&&(i.isTouchBegan=!0,i.applyInteractiveScale())),s},onTouchMoved:function(e){if(a&&r){var t=o,s=e.getLocation(),i=Math.abs(t.x-s.x)+Math.abs(t.y-s.y);c<i&&(r=!1)}},onTouchEnded:function(e){i.onTouchEnded&&i.onTouchEnded(),n.useInteractiveScale&&i.applyInteractiveScale&&(i.isTouchBegan=!1,i.applyInteractiveScale());var t=i.convertTouchToNodeSpace(e);if(cleverapps.UI.targetContainPoint(i,t,n.isometricCell)&&r)return s(t),!0}},i)},applyHover:function(a,c){a.onMouseOver||(a.onMouseOver=function(){a.applyInteractiveScale(),a.settings&&a.settings.hint&&a.showHint(a.settings.hint)}),a.onMouseOut||(a.onMouseOut=function(){a.applyInteractiveScale(),a.settings&&a.settings.hint&&a.hideHint()}),c=c||{},a.applyInteractiveScale||(a.applyInteractiveScale=cleverapps.UI.applyInteractiveScale),
a.hoverListener=cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){var t=e.getLocation(),s=a.getCropContainer(),i=a.convertToNodeSpace(t),n=a.getContentSize(),o=a.hoverPosition||{x:0,y:0},r=cc.rect(o.x,o.y,n.width,n.height);c.filter&&!c.filter()||!cc.rectContainsPoint(r,i)||s&&!cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),s.convertToNodeSpace(t))?a.mouseOver&&(a.mouseOver=!1,a.onMouseOut()):a.mouseOver||(a.mouseOver=!0,a.onMouseOver())}},a)},removeHover:function(e){e.hoverListener&&(cc.eventManager.removeListener(e.hoverListener),delete e.hoverListener)},applyInteractiveScale:function(){var e=void 0===this.baseScale?1:this.baseScale;this.selected&&this.selectedScale?this.setScale(e*this.selectedScale):this.isTouchBegan?this.setScale(.97*e):this.mouseOver?this.setScale(1.03*e):this.setScale(e)},convertToGrayScale:function(e,t){"undefined"!=typeof gl&&(e.spine&&(e=e.spine),t?e.normalShader?e.setShaderProgram(e.normalShader
):e.opacity=255:cc.shaderCache&&cleverapps.Shaders&&cc.shaderCache.getProgram(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY)?(e.normalShader||(e.normalShader=e.getShaderProgram()),e.setShaderProgram(cc.shaderCache.getProgram(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY))):e.opacity=150)},_setShaderUpdate:function(e,t,s){if(e._superUpdate)e.update=e._superUpdate.bind(e),delete e._superUpdate,e.normalShader&&e.setShaderProgram(e.normalShader);else if(cc.shaderCache&&cleverapps.Shaders&&cc.shaderCache.getProgram(t)){e.normalShader||(e.normalShader=e.getShaderProgram()),e.setShaderProgram(cc.shaderCache.getProgram(t));var i=e.getShaderProgram();e._superUpdate=e.update,e.scheduleUpdate(),e.update=function(e){s(e,i)}.bind(e)}},toggleFlickering:function(i,e){if("undefined"!=typeof gl){var n=(e=e||{}).flickSpeed||2,o=e.flickPause||.2,r=e.color;(!r||!Array.isArray(r)||r.length<3)&&(r=[.35,.35,.35]);var a=0;this._setShaderUpdate(i,cleverapps.Shaders.FLICKER_SHADER_KEY,function(e,t){i._superUpdate(e),t.use(
),a+=e;var s=Math.abs(Math.sin(Math.max(a-o,0)*n));s=Math.max(0,Math.min(1,s)),t.setUniformLocationWith1f("sineTime",s),t.setUniformLocationWith3f("flickColor",r[0],r[1],r[2])})}},toggleBlur:function(l,p){if((p=p||{}).animate=p.animate||{},"undefined"!=typeof gl){var s=p.blurLength||.005,d=p.strength||1,h=function(e,t){l.blurShader.use(),l.blurShader.setUniformLocationWith1f("u_blurOffset",s),l.blurShader.setUniformLocationWith1f("u_blurStrength",e),l.blurShader.setUniformLocationWith1f("u_extent",t)},e=function(e,t){t=t||function(){};var s=p.animate.type||cleverapps.UI.BLUR_ANIMATION.FADE,i=p.animate.time||.2,n=p.animate.steps||20,o=e?d:0,r=e?1:0,a=d/n,c=1/n;l.blurAction=l.runAction(new cc.Sequence(new cc.Repeat(new cc.Sequence(new cc.CallFunc(function(){s===cleverapps.UI.BLUR_ANIMATION.FADE?h(o+=e?-a:a,1):h(d,r+=e?-c:c)}),new cc.DelayTime(i/n)),n),new cc.CallFunc(t))),l.blurAction.whenDone=t};if(l.blurAction&&!l.blurAction.isDone()&&(l.stopAction(l.blurAction),l.blurAction.whenDone()
,delete l.blurAction),l.normalShader){var t=function(){l.setShaderProgram(l.normalShader),delete l.normalShader,delete l.blurShader};p.animate?e(!0,function(){t(),p.animate.callback&&p.animate.callback()}):t()}else if(cc.shaderCache&&cleverapps.Shaders){var i=cleverapps.Shaders.BLUR_FADE_KEY;p.animate.type===cleverapps.UI.BLUR_ANIMATION.CURTAIN&&(i=p.animate.reverseCurtain?cleverapps.Shaders.BLUR_CURTAIN_REVERSE_KEY:cleverapps.Shaders.BLUR_CURTAIN_KEY),cc.shaderCache.getProgram(i)&&(l.normalShader=l.getShaderProgram(),l.setShaderProgram(cc.shaderCache.getProgram(i)),l.blurShader=l.getShaderProgram(),p.animate?e(!1,p.animate.callback):h(d,1))}}else p.animate&&p.animate.callback&&p.animate.callback()},getSceneSize:function(){var e=cc.director.getWinSize();return e.height=cleverapps.styles.SCENE_HEIGHT,e},getSceneOffsetY:function(){var e=cc.director.getRunningScene(),t=1;return e&&e.scene&&(t=e.scene.resizeScale),(cc.director.getWinSize().height-cleverapps.styles.SCENE_HEIGHT*t)/2/t},
createPatternSprite:function(e,t){void 0===t&&(t=cc.director.getWinSize());var s=new cc.Sprite(e);if("auto"===t.width&&(t.width=s.width-2),"auto"===t.height&&(t.height=s.height-2),"undefined"!=typeof gl&&s.getTexture()){s.getTexture().setTexParameters({minFilter:gl.NEAREST,magFilter:gl.NEAREST,wrapS:gl.REPEAT,wrapT:gl.REPEAT});var i=s.getTextureRect();i.width=t.width,i.height=t.height,s.setTextureRect(i)}else t.width&&t.height&&s.setScale(t.width/s.width,t.height/s.height);return s.setPositionRound(t.width/2,t.height/2),s},createSprite:function(e){if(!e)return new cc.Sprite;var t=e&&e.image||e;if(t=processVirtualImage(t),void 0!==e.scale9&&!1!==e.scale9){var s,i,n=cleverapps.UI.createScale9Sprite(t,e.scale9);e.sizes?(s=e.sizes[cleverapps.wideMode.mode].width,i=e.sizes[cleverapps.wideMode.mode].height):(s=e.width,i=e.height);var o=e.rotation;if(e.rotations&&(o=e.rotations[cleverapps.wideMode.mode]),o){var r=i;i=s,s=r,n.setRotation(o)}return n.setContentSize2(s,i),n}var a=t;return(
t=new cc.Sprite(t)).scale=e.scale||1,t.spriteFrameName=a,t},getScale9Rect:function(e,t){void 0===t&&(t=cleverapps.UI.Scale9Rect.Default);var s=(e instanceof cc.SpriteFrame?e:cc.spriteFrameCache.getSpriteFrame(e)).getOriginalSize(),i=t===cleverapps.UI.Scale9Rect.TwoPixelXY,n=Math.round(i?s.width/2-1:s.width/3),o=Math.round(i?2:s.width/3),r=t===cleverapps.UI.Scale9Rect.TwoPixelY||t===cleverapps.UI.Scale9Rect.TwoPixelXY,a=Math.round(r?s.height/2-1:s.height/3),c=Math.round(r?2:s.height/3);return cc.rect(n,a,o,c)},createScale9Sprite:function(e,t){if(!(e instanceof cc.SpriteFrame?e:cc.spriteFrameCache.getSpriteFrame(e))){if(cleverapps.config.debugMode)throw"No scale9 sprite: "+e;return new cc.Scale9Sprite}var s=new cc.Scale9Sprite(e,cleverapps.UI.getScale9Rect(e,t));return s.spriteFrameName=e,s},createAnimation:function(e){e=e.spine;var t=new cleverapps.Spine(e.json);return t.setAnimation(0,e.openAnimation,!1),e.idleAnimation&&t.setCompleteListener(function(){t.setAnimation(0,e.idleAnimation
,!0)}),t},getBrowserName:function(){return cleverapps.UI.browserName?cleverapps.UI.browserName:cleverapps.UI.browserName=(new UAParser).getBrowser().name}},cc.LabelTTF.RenderCmd.prototype._setColorsString=function(){var e=this._displayedColor,t=this._node,s=t._shadowColor||this._displayedColor,i=t._strokeColor,n=t._textFillColor,o=e.r/255,r=e.g/255,a=e.b/255;this._shadowColorStr="rgba("+(0|o*s.r)+","+(0|r*s.g)+","+(0|a*s.b)+","+t._shadowOpacity+")",this._fillColorStr="rgba("+(0|o*n.r)+","+(0|r*n.g)+","+(0|a*n.b)+", 1)",this._strokeColorStr="rgba("+(0|o*i.r)+","+(0|r*i.g)+","+(0|a*i.b)+","+t._strokeOpacity+")"},cc.LabelTTF.WebGLRenderCmd.prototype._setColorsString=cc.LabelTTF.RenderCmd.prototype._setColorsString,cc.LabelTTF.CacheRenderCmd.prototype._setColorsString=cc.LabelTTF.RenderCmd.prototype._setColorsString,cc.LabelTTF.CanvasRenderCmd.prototype._setColorsString=cc.LabelTTF.RenderCmd.prototype._setColorsString,cleverapps.styles.UI={DRAG_MIN_DIST:5,jumpAnimation:{h:200},
jumpCollectAnimation:{dist:{x:100,y:-100}},collectAnimation:{bezierX:700},delta:{y:20,icon:{margin:5}},Avatar:{x:8,top:8,bottom:8},onClick:{ignoreOnTouchMovedThreshold:30},shake:{dx:1,dy:1},TTFText:{verticalAlignment:void 0,baseline:0,safari:{verticalAlignment:void 0,baseline:0}},CheckBox:{checkImage:bundles.main.frames.goal_done_sign,bgImage:bundles.main.frames.select_friend_checkbox,margin:10}},cleverapps.UI.Scale9Rect={Default:0,TwoPixelX:1,TwoPixelY:2,TwoPixelXY:3},cleverapps.UI.DRAG_THROTTLE=50,cleverapps.UI.CLICK_THROTTLE=500,cleverapps.UI.SOCIAL_CLICK_THROTTLE=cleverapps.UI.CLICK_THROTTLE,cleverapps.UI.BLUR_ANIMATION={FADE:1,CURTAIN:2},cc.PlaySound=cc.ActionInstant.extend({sound:void 0,ctor:function(e,t){cc.FiniteTimeAction.prototype.ctor.call(this),this.sound=e,this.options=t},update:function(e){cleverapps.audio.playSound(this.sound,this.options)},reverse:function(){return this},clone:function(){return new cc.PlaySound(this.sound,this.options)}}),
cleverapps.UI.ScrollBarContainer=cc.Node.extend({}),cleverapps.UI.ScrollView=ccui.Layout.extend({ctor:function(e,t){switch(this.options=t||{},this.dir=cleverapps.UI.ScrollView.DIR_NONE,this.options.childrenVisibility=void 0===this.options.childrenVisibility?cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK:this.options.childrenVisibility,this.options.childrenVisibilityPadding=this.options.childrenVisibilityPadding||0,this.options.childrenVisibility){case cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR:this.childrenVisibility=new ScrollChildrenLinearVisibility(this);break;case cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK:this.childrenVisibility=new ScrollChildrenFullCheckVisibility(this)}this._super(),(void 0===this.options.clipping||this.options.clipping)&&this.setClippingEnabled(!0),this.setAnchorPoint2(),this.centerNode=new cc.Node,this.addChild(this.centerNode),!1!==this.options.scrollBarEnabled&&(this.barContainer=new cleverapps.UI.ScrollBarContainer,
this.addChild(this.barContainer,2),this.barContainer.setCascadeOpacityEnabled(!0),this.barContainer.setOpacity(0),this.barContainer.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeTo(.3,255))),this.barHandler=new ScrollBarHandler(this)),this.zoom=1,this.options.zoom&&(this.zoomHandler=new cleverapps.UI.ZoomHandler(this)),this.scrollHandler=new cleverapps.UI.ScrollHandler(this,{mouseScroll:!this.options.zoom,touchPadding:this.options.touchPadding,outOfBoundaryScale:this.options.outOfBoundaryScale,inertialScrollFactor:this.options.inertialScrollFactor}),e&&this.setInnerContent(e),this.scheduleUpdate()},isEmpty:function(){return!this.innerContent||!this.innerContent.children.length},setContentSize:function(e,t){var s=this.width,i=this.height,n=this.innerContent&&this.innerContent.getPosition();this._super(e,t),s===this.width&&i===this.height||(this.barContainer&&this.barContainer.setContentSize(this.getContentSize()),this.centerNode&&this.centerNode.setPosition(this.width/2,
this.height/2),this.innerContent&&(this.calcBorders(),this.scrollToPoint(cc.p(-n.x,-n.y))))},updateVisibility:function(){if(this.innerContent.setVisibleRect&&this.innerContent.setVisibleRect(this.getVisibleRect()),this.childrenVisibility&&this.currentVisibleChildIds&&!this.isEmpty()&&this.width+this.height!==0){var e,t=this.childrenVisibility.visibleIds(),s=this.innerContent.children;for(e=0;e<this.currentVisibleChildIds.length;e++)s[this.currentVisibleChildIds[e]].hideDirty=!0;for(e=0;e<t.length;e++){(i=s[t[e]]).hideDirty&&delete i.hideDirty,i.visible=!0}for(e=0;e<this.currentVisibleChildIds.length;e++){var i;(i=s[this.currentVisibleChildIds[e]]).hideDirty&&(delete i.hideDirty,i.visible=!1)}this.currentVisibleChildIds=t}},getVisibleRect:function(){return cc.rect(Math.round(this.innerContent.width/2-this.width/this.zoom/2-this.innerContent.x),Math.round(this.innerContent.height/2-this.height/this.zoom/2-this.innerContent.y),Math.round(this.width/this.zoom),Math.round(
this.height/this.zoom))},isVisiblePoint:function(e){var t=this.getVisibleRect();return cc.rectContainsPoint(t,e)},calcBorders:function(){if(this.isEmpty())return this.min=cc.p(0,0),void(this.max=cc.p(0,0));this.min=cc.p(-this.innerContent.width/2+this.width/this.zoom/2,-this.innerContent.height/2+this.height/this.zoom/2),0<this.min.x&&(this.min.x=0),0<this.min.y&&(this.min.y=0),this.max=cc.p(this.innerContent.width/2-this.width/this.zoom/2,this.innerContent.height/2-this.height/this.zoom/2),this.max.x<0&&(this.max.x=0),this.max.y<0&&(this.max.y=0),this.setDirection(),this.barHandler&&this.barHandler.reset()},setInnerContent:function(e){this.innerContent&&this.innerContent.removeFromParent(),this.innerContent=e,this.innerContent.setAnchorPoint2(),this.innerContent.setPositionRound(0,0),this.centerNode.addChild(e),this.width&&this.height?(this.updateInnerContent(),this.scrollToDefault()):this.initChildrenVisibility()},scrollToDefault:function(){this.innerContent&&this.scrollTo(
cleverapps.UI.ScrollView.SCROLLS.UPPER_LEFT)},initChildrenVisibility:function(){if(this.childrenVisibility){this.currentVisibleChildIds=[];for(var e=0;e<this.innerContent.children.length;e++)this.currentVisibleChildIds.push(e)}},updateInnerContent:function(){this.calcBorders(),this.initChildrenVisibility(),this.scrollToPoint(this.normalizePoint(this.getContainerPosition()))},borderTouchScrollIteration:function(e,t,s){s*=.01;var i=this.width/this.zoom/2*s,n=this.height/this.zoom/2*s;t/=this.zoom;var o=this.centerNode.convertTouchToNodeSpace(e),r=0,a=0,c=this.getContainerPosition();o.x<-i&&(r=c.x-t>=this.min.x?-t:this.min.x-c.x),o.x>i&&(r=c.x+t<=this.max.x?t:this.max.x-c.x),o.y<-n&&(a=c.y-t>=this.min.y?-t:this.min.y-c.y),o.y>n&&(a=c.y+t<=this.max.y?t:this.max.y-c.y),(r||a)&&this.scrollToPoint(cc.p(c.x+r,c.y+a))},calcNodeDelta:function(e,t){var s=cleverapps.extend({left:1,right:1,top:1,bottom:1},t&&t.visibleBox),i=e.getBoundingBox(),n=cc.p(i.x,i.y),o=cc.p(i.x+i.width,i.y+i.height)
;n=this.centerNode.convertToNodeSpace(e.getParent().convertToWorldSpace(n)),o=this.centerNode.convertToNodeSpace(e.getParent().convertToWorldSpace(o));var r=cc.p(-this.width/this.zoom/2*s.left,-this.height/this.zoom/2*s.bottom),a=cc.p(this.width/this.zoom/2*s.right,this.height/this.zoom/2*s.top),c=cc.p(0,0);return n.x<r.x&&(c.x=-(r.x-n.x)),o.x>a.x&&(c.x=o.x-a.x),n.y<r.y&&(c.y=-(r.y-n.y)),o.y>a.y&&(c.y=o.y-a.y),c},isNodeVisible:function(e,t){var s=this.calcNodeDelta(e,t);return 0===s.x&&0===s.y},scrollToMakeNodeVisible:function(e,t,s){var i=this.calcNodeDelta(e,s);this.scrollHandler.startAutoScroll(i,t,s)},scrollTo:function(e,t,s){var i=(s=s||{}).callback;if(void 0!==e){switch(e){case cleverapps.UI.ScrollView.SCROLLS.UPPER_LEFT:e=cc.p(this.min.x,this.max.y);break;case cleverapps.UI.ScrollView.SCROLLS.CENTER:e=cc.p(0,0);break;case cleverapps.UI.ScrollView.SCROLLS.LOWER_RIGHT:e=cc.p(this.max.x,this.min.y);break;default:e instanceof cc.Node&&(e=this.innerContent.convertToNodeSpace(
e.getParent().convertToWorldSpace(e.getPosition()))),e.x-=this.innerContent.width/2,e.y-=this.innerContent.height/2}e=this.normalizePoint(e),t?this.scrollHandler.startAutoScroll(cc.pSub(e,this.getContainerPosition()),t,s):(this.scrollToPoint(e),i&&i())}else i&&i()},scrollBy:function(e,t,s){var i=cc.pAdd(e,this.getContainerPosition());i.x+=this.innerContent.width/2,i.y+=this.innerContent.height/2,this.scrollTo(i,t,s)},zoomTo:function(e,t){this.zoomHandler.zoomTo(e,t)},update:function(e){this._super(e),this.scrollHandler.processAutoScroll(e),this.zoomHandler&&this.zoomHandler.processZoom(e)},getCurScrollPercent:function(){if(!this.innerContent)return{x:0,y:0};var e=this.max.x-this.min.x,t=this.max.y-this.min.y;return{x:0!==e?(this.innerContent.x-this.min.x)/e*100:0,y:0!==t?(this.innerContent.y-this.min.y)/t*100:0}},normalizePoint:function(e){return{x:Math.max(this.min.x,Math.min(this.max.x,e.x)),y:Math.max(this.min.y,Math.min(this.max.y,e.y))}},getContainerPosition:function(){
return cc.p(-this.innerContent.x,-this.innerContent.y)},getCurrentPosition:function(){var e=this.innerContent.getPosition();return{x:-e.x+this.innerContent.width/2,y:-e.y+this.innerContent.height/2}},scrollToPoint:function(e){this.innerContent.setPosition(-e.x,-e.y),this.updateVisibility(),this.barHandler&&this.barHandler.updatePos(),this.options.containerMovedListener&&this.options.containerMovedListener()},scrollToPercent:function(e,t){var s;if(e=Math.min(100,Math.max(0,e)),this.dir&cleverapps.UI.ScrollView.DIR_VERTICAL){var i=(this.max.y-this.min.y)*e/100+this.min.y;s=cc.p(this.innerContent.x,i)}else{var n=(this.max.x-this.min.x)*e/100+this.min.x;s=cc.p(n,this.innerContent.y)}t?this.scrollHandler.startAutoScroll(cc.pSub(s,this.getContainerPosition()),t):this.scrollToPoint(s)},stopAutoScroll:function(){this.scrollHandler.stopAutoScroll()},setDirection:function(){this.options.direction?this.dir=this.options.direction:(this.dir=cleverapps.UI.ScrollView.DIR_BOTH,
this.min.y===this.max.y&&(this.dir^=cleverapps.UI.ScrollView.DIR_VERTICAL),this.min.x===this.max.x&&(this.dir^=cleverapps.UI.ScrollView.DIR_HORIZONTAL))},getInnerContainer:function(){return this.innerContent},setBarPadding:function(e){this.barHandler&&this.barHandler.setPadding(e)}}),cleverapps.UI.ScrollView.SCROLLS={UPPER_LEFT:0,CENTER:1,LOWER_RIGHT:2},cleverapps.UI.ScrollView.DIR_NONE=0,cleverapps.UI.ScrollView.DIR_VERTICAL=1,cleverapps.UI.ScrollView.DIR_HORIZONTAL=2,cleverapps.UI.ScrollView.DIR_BOTH=cleverapps.UI.ScrollView.DIR_VERTICAL|cleverapps.UI.ScrollView.DIR_HORIZONTAL,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE=0,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR=1,cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK=2;var ScrollBarHandler=function(e){this.scroll=e};ScrollBarHandler.prototype.reset=function(){!this.barY&&this.scroll.dir&cleverapps.UI.ScrollView.DIR_VERTICAL&&this.scroll.min.y!==this.scroll.max.y&&(this.barY=new ScrollBar(this.scroll,
cleverapps.UI.ScrollView.DIR_VERTICAL)),!this.barX&&this.scroll.dir&cleverapps.UI.ScrollView.DIR_HORIZONTAL&&this.scroll.min.x!==this.scroll.max.x&&(this.barX=new ScrollBar(this.scroll,cleverapps.UI.ScrollView.DIR_HORIZONTAL)),this.barX&&this.barX.reset(),this.barY&&this.barY.reset(),this.updatePos()},ScrollBarHandler.prototype.setAutoHide=function(e){this.barX&&(this.barX.autoHideEnabled=e),this.barY&&(this.barY.autoHideEnabled=e)},ScrollBarHandler.prototype.setPadding=function(e){this.barPadding=e,this.barX&&this.barX.setPadding(this.barPadding),this.barY&&this.barY.setPadding(this.barPadding)},ScrollBarHandler.prototype.updatePos=function(){var e=this.scroll.scrollHandler.getHowMuchOutOfBoundary();this.barY&&this.barY.onScrolled(e),this.barX&&this.barX.onScrolled(e)},ScrollBarHandler.prototype.onTouchBegan=function(){this.barY&&this.barY.onTouchBegan(),this.barX&&this.barX.onTouchBegan()},ScrollBarHandler.prototype.onTouchEnded=function(){this.barY&&this.barY.onTouchEnded(),
this.barX&&this.barX.onTouchEnded()};var ScrollBar=ccui.ScrollViewBar.extend({ctor:function(e,t){this.scroll=e,this.dir=t,this._super(e,t),e.barContainer.addChild(this),this.autoHideEnabled=!1,this.setPadding(this.scroll.barHandler.barPadding),this.addControls(),this.setWidth(cleverapps.styles.ScrollBar.barWidth)},setPadding:function(e){e=e||{};var t=cleverapps.styles.ScrollBar,s=void 0!==e.cornerPadding?e.cornerPadding:t.cornerPadding,i=void 0!==e.sidePadding?e.sidePadding:t.sidePadding,n=cc.p(this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL?i:s,this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL?s:i);this.setPositionFromCorner(n),this.onScrolled(this.scroll.scrollHandler.getHowMuchOutOfBoundary())},reset:function(){this.scroll.dir&this.dir?this.setVisible(!0):this.setVisible(!1)},onScrolled:function(e){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var t=this.scroll.getInnerContainer(),s=0,i=0,n=0,o=0
;this._direction===cleverapps.UI.ScrollView.DIR_VERTICAL?(s=t.height,i=this.scroll.height,n=e.y,o=-t.getPositionY()+(this.scroll.max.y-this.scroll.min.y)/2):this._direction===cleverapps.UI.ScrollView.DIR_HORIZONTAL&&(s=t.width,i=this.scroll.width,n=e.x,o=-t.getPositionX()+(this.scroll.max.x-this.scroll.min.x)/2);var r=this._calculateLength(s,i,n),a=this._calculatePosition(s,i,o,n,r);this._updateLength(r),this.setPosition(a)},getActualContentSize:function(){return{width:this._body.getBoundingBox().width,height:this._body.getBoundingBox().height}},addControls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onBarTouchBegan.bind(this),onTouchMoved:this.onBarTouchMoved.bind(this),onTouchEnded:this.onBarTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this)},onBarTouchBegan:function(e){if(!this.visible)return!1;var t=this.convertTouchToNodeSpace(e),s=this.getActualContentSize()
;return cc.rectContainsPoint(cc.rect(-s.width/2,0,s.width,s.height),t)?(this.scroll.scrollHandler.stopAutoScroll(),!0):void 0},onBarTouchMoved:function(e){var t=this.convertToNodeSpace(e.getLocation()),s=this.convertToNodeSpace(e.getPreviousLocation()),i=cc.pSub(t,s),n=this.getPosToPercent(i);this.scroll.scrollToPercent(n)},getPosToPercent:function(e){if(this.dir===cleverapps.UI.ScrollView.DIR_VERTICAL){var t=this.scroll.height-2*this.getPositionFromCorner().y-this.getActualContentSize().height;return(this.y+e.y-this.getPositionFromCorner().y)/t*100}t=this.scroll.width-2*this.getPositionFromCorner().x-this.getActualContentSize().height;return(this.x+e.y-this.getPositionFromCorner().x)/t*100},onBarTouchEnded:function(e){}});cleverapps.styles.ScrollBar={barWidth:12,cornerPadding:20,sidePadding:20};var ScrollChildrenLinearVisibility=function(e){this.scroll=e};ScrollChildrenLinearVisibility.prototype.visibleIds=function(){var e,t;if(this.scroll.innerContent.children.length<=1)e=0,
t=this.scroll.innerContent.children.length;else{var s,i,n=this.scroll.innerContent.children.length-1,o=this.scroll.innerContent.children[0].getPosition(),r=this.scroll.innerContent.children[n].getPosition();r.x-=o.x,r.x/=n,r.y-=o.y,r.y/=n,0!==r.y?(s=r.y,i=this.scroll.innerContent.children[0].height/2,e=(-this.scroll.innerContent.y-o.y+this.scroll.innerContent.height/2-this.scroll.height/2)/s,t=(this.scroll.height+2*i)/s):(s=r.x,i=this.scroll.innerContent.children[0].width/2,e=(-this.scroll.innerContent.x-o.x+this.scroll.innerContent.width/2-this.scroll.width/2)/s,t=(this.scroll.width+2*i)/s),t<0&&(e-=t=-t),e=Math.ceil(e-i/Math.abs(s)),t=Math.floor(t+2*i/Math.abs(s))}for(var a=[],c=0;c<t;c++)this.scroll.innerContent.children[e+c]&&a.push(e+c);return a};var ScrollChildrenFullCheckVisibility=function(e){this.scroll=e};ScrollChildrenFullCheckVisibility.prototype.visibleIds=function(){for(var e=[],t=this.scroll.zoom,s=this.scroll.options.childrenVisibilityPadding||0,
i=0;i<this.scroll.innerContent.children.length;i++){var n=this.scroll.innerContent.children[i],o=n.x-this.scroll.innerContent.width/2,r=n.y-this.scroll.innerContent.height/2;-this.scroll.innerContent.x-this.scroll.width/t/2-n.width/2-s<=o&&o<=-this.scroll.innerContent.x+this.scroll.width/t/2+n.width/2+s&&-this.scroll.innerContent.y-this.scroll.height/t/2-n.height/2-s<=r&&r<=-this.scroll.innerContent.y+this.scroll.height/t/2+n.height/2+s&&e.push(i)}return e},cleverapps.UI.HideHandler=function(e,t){switch(this.target=e,this.initialized=!1,this.direction=t||cleverapps.UI.HORIZONTAL,this.isShow=!0,this.paused=!1,e.hide||(e.hide=e.createListener(this.hide.bind(this))),e.show||(e.show=e.createListener(this.show.bind(this))),e.isShown=e.createListener(function(){return this.isShow}.bind(this)),this.direction){case cleverapps.UI.SCALE_ANIMATION:e.hideAnimation||(e.hideAnimation=e.createListener(this.scaleHideAnimation.bind(this))),e.showAnimation||(e.showAnimation=e.createListener(
this.scaleShowAnimation.bind(this)));break;case cleverapps.UI.OPACITY_ANIMATION:e.hideAnimation||(e.hideAnimation=e.createListener(this.opacityHideAnimation.bind(this))),e.showAnimation||(e.showAnimation=e.createListener(this.opacityShowAnimation.bind(this)));break;default:e.hideAnimation||(e.hideAnimation=e.createListener(this.hideAnimation.bind(this))),e.showAnimation||(e.showAnimation=e.createListener(this.showAnimation.bind(this)))}e.showForDuration=e.createListener(this.showForDuration.bind(this)),e.toggle=e.createListener(this.toggle.bind(this)),e.pauseHideHandler=e.createListener(this.pauseHideHandler.bind(this)),e.resumeHideHandler=e.createListener(this.resumeHideHandler.bind(this)),e.parent&&this.initialize()},cleverapps.UI.HideHandler.prototype.pauseHideHandler=function(){this.paused=!0},cleverapps.UI.HideHandler.prototype.resumeHideHandler=function(){this.paused=!1},cleverapps.UI.HideHandler.prototype.toggle=function(e,t){e?this.show(t):this.hide(t)},
cleverapps.UI.HideHandler.prototype.showForDuration=function(e,t){t=t||{};this.clearTimeouts(),this.show(),this.callbackTimeout=setTimeout(function(){e&&e()},500),this.hideTimeout=setTimeout(function(){this.hide(),this.clearTimeouts()}.bind(this),2e3)},cleverapps.UI.HideHandler.prototype.postponeHiding=function(e){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){this.hide(),this.clearTimeouts()}.bind(this),e))},cleverapps.UI.HideHandler.prototype.clearTimeouts=function(){this.callbackTimeout&&(clearTimeout(this.callbackTimeout),delete this.callbackTimeout),this.hideTimeout&&(clearTimeout(this.hideTimeout),delete this.hideTimeout)},cleverapps.UI.HideHandler.prototype.showAnimation=function(e,t,s){if(s=s||{},this.target.stopAllActions(),e)return this.target.setPosition(this.originalPosition),void(this.target.visible=!0);var i=new cc.MoveTo(s.duration||.3,this.originalPosition);s.easing&&i.easing(new cc.easeBackOut),this.target.visible=!0,
this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),i))},cleverapps.UI.HideHandler.prototype.hideAnimation=function(e,t,s){if(s=s||{},this.target.stopAllActions(),e)return this.target.setPosition(this.hidePosition),void(this.target.visible=!1);var i=new cc.MoveTo(s.duration||.15,this.hidePosition);s.easing&&i.easing(new cc.easeBackIn),this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),i,new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.opacityShowAnimation=function(e,t){this.target.stopAllActions();var s=this.target.baseOpacity||255;if(e)return this.target.visible=!0,void this.target.setOpacity(s);this.target.visible=!0,this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.FadeTo(.3,s)))},cleverapps.UI.HideHandler.prototype.opacityHideAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setOpacity(0),void(this.target.visible=!1);this.target.runAction(new cc.Sequence(
new cc.DelayTime(t||0),new cc.FadeTo(.15,0),new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.scaleShowAnimation=function(e,t){this.target.stopAllActions();var s=this.target.baseScale||1;if(e)return this.target.visible=!0,void this.target.setScale(s);this.target.visible=!0,this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.3,s)))},cleverapps.UI.HideHandler.prototype.scaleHideAnimation=function(e,t){if(this.target.stopAllActions(),e)return this.target.setScale(0),void(this.target.visible=!1);this.target.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.15,0),new cc.CallFunc(function(){this.target.visible=!1}.bind(this))))},cleverapps.UI.HideHandler.prototype.show=function(e,t,s){(!0!==this.isShow||e)&&(this.isShow=!0,this.initialized&&!this.paused&&(this.clearTimeouts(),this.target.showAnimation(e,t,s)))},cleverapps.UI.HideHandler.prototype.hide=function(e,t,s){(!1!==this.isShow||e)&&(
this.isShow=!1,this.initialized&&!this.paused&&this.target.hideAnimation(e,t,s))},cleverapps.UI.HideHandler.prototype.initialize=function(){if(!this.initialized){if(this.initialized=!0,this.target.originalPosition?this.originalPosition=this.target.originalPosition:this.originalPosition=this.target.getPosition(),this.target.hidePosition)this.hidePosition=this.target.calculatePositionRound(this.target.hidePosition);else{var e,t=this.target.getParent().convertToWorldSpace(this.originalPosition),s=cc.director.getWinSize();this.direction===cleverapps.UI.VERTICAL?(e=t.y>s.height/2?s.height-t.y:-t.y,this.hidePosition=cc.p(this.originalPosition.x,this.originalPosition.y+2*e)):(e=t.x>s.width/2?s.width-t.x:-t.x,this.hidePosition=cc.p(this.originalPosition.x+2*e,this.originalPosition.y))}this.paused||(!1===this.isShow?this.target.hideAnimation(!0):this.target.showAnimation(!0))}},cleverapps.UI.ScrollHandler=function(e,t){t=t||{},this.target=e,this.bounceEnabled=!0,
this.outOfBoundaryScale=t.outOfBoundaryScale||.5,this.inertialScrollFactor=t.inertialScrollFactor||1,this.touchPadding=t.touchPadding,this.initAutoScrollParams(),!1!==t.mouseScroll&&this.enableMouseWheelScroll(),this.enableTouchScroll()},cleverapps.UI.ScrollHandler.prototype.enableMouseWheelScroll=function(){"mouse"in cc.sys.capabilities&&cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){this.target.isDisplayed()&&cc.rectContainsPoint(cc.rect(0,0,this.target.width,this.target.height),this.target.convertToNodeSpace(e.getLocation()))&&(this.handleMouseWheel(e.getScrollY()),e.stopPropagation())}.bind(this)},this.target)},cleverapps.UI.ScrollHandler.prototype.handleMouseWheel=function(e){if(0!=(this.target.dir&cleverapps.UI.ScrollView.DIR_VERTICAL)){var t=this.getHowMuchOutOfBoundary();!this.fltEqualZero(t)&&(t.y<0&&0<e||0<t.y&&e<0)||this.lastMouseWheelTime&&this.lastMouseWheelTime>Date.now()-100||((!this.mouseWheelSpeed||this.lastMouseWheelTime<Date.now(
)-500||e*this.mouseWheelSpeed<0)&&(this.mouseWheelSpeed=0),Math.abs(e)<65&&this.lastMouseWheelTime&&this.lastMouseWheelTime>Date.now()-2e3||(this.mouseWheelSpeed+=cleverapps.styles.ScrollHandler.mouseWheelAcceleration*Math.sign(e),Math.abs(this.mouseWheelSpeed)>cleverapps.styles.ScrollHandler.mouseWheelMaxSpeed&&(this.mouseWheelSpeed=Math.sign(this.mouseWheelSpeed)*cleverapps.styles.ScrollHandler.mouseWheelMaxSpeed),Math.abs(this.mouseWheelSpeed)<cleverapps.styles.ScrollHandler.mouseWheelMinSpeed&&(this.mouseWheelSpeed=Math.sign(this.mouseWheelSpeed)*cleverapps.styles.ScrollHandler.mouseWheelMinSpeed),this.startInertialScroll(cc.p(0,this.mouseWheelSpeed)),this.lastMouseWheelTime=Date.now()))}},cleverapps.UI.ScrollHandler.prototype.enableTouchScroll=function(){var e=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),
onTouchCancelled:this.onTouchEnded.bind(this)},this.target);this.target.scrollListener=e},cleverapps.UI.ScrollHandler.prototype.onTouchBegan=function(e){var t=0,s=this.target.width,i=0,n=this.target.height;if(this.touchPadding&&(this.touchPadding.top&&(n-=this.touchPadding.top),this.touchPadding.bottom&&(i+=this.touchPadding.bottom,n-=this.touchPadding.bottom),this.touchPadding.right&&(s-=this.touchPadding.right),this.touchPadding.left&&(t+=this.touchPadding.left,s-=this.touchPadding.left)),!this.target.touchScrollDisabled&&this.target.isDisplayed()&&cc.rectContainsPoint(cc.rect(t,i,s,n),this.target.convertTouchToNodeSpace(e)))return this.handlePress(),!0},cleverapps.UI.ScrollHandler.prototype.onTouchMoved=function(e){this.handleMove(this.getTouchDelta(e))},cleverapps.UI.ScrollHandler.prototype.onTouchEnded=function(e){this.handleRelease(this.getTouchDelta(e,!0))},cleverapps.UI.ScrollHandler.prototype.getTouchDelta=function(e,t){var s=this.target.convertToNodeSpace(e.getLocation()),
i=this.target.convertToNodeSpace(e.getPreviousLocation());t&&!cc.rectContainsPoint(cc.rect(0,0,this.target.width,this.target.height),s)&&(s=i);var n=cc.pMult(cc.pSub(i,s),1/this.target.zoom);return 0==(this.target.dir&cleverapps.UI.ScrollView.DIR_HORIZONTAL)&&(n.x=0),0==(this.target.dir&cleverapps.UI.ScrollView.DIR_VERTICAL)&&(n.y=0),n},cleverapps.UI.ScrollHandler.prototype.initAutoScrollParams=function(){this._outOfBoundaryAmountDirty=!0,this._outOfBoundaryAmount=cc.p(0,0)},cleverapps.UI.ScrollHandler.prototype.afterContainerScale=function(){this._outOfBoundaryAmountDirty=!0;var e=this.getHowMuchOutOfBoundary();this.fltEqualZero(e)||this.startAutoScroll(e,0)},cleverapps.UI.ScrollHandler.prototype.afterContainerMove=function(){this._outOfBoundaryAmountDirty=!0,this.target.barHandler&&this.target.barHandler.updatePos(),!this.bounceEnabled||this.inTouch||this._autoScrolling||this.startBounceBackIfNeeded()},cleverapps.UI.ScrollHandler.prototype.startBounceBackIfNeeded=function(){if(
!this.bounceEnabled)return!1;var e=this.getHowMuchOutOfBoundary();if(this.fltEqualZero(e))return!1;return this.startAutoScroll(e,1),!0},cleverapps.UI.ScrollHandler.prototype.handlePress=function(){this.inTouch=!0,this.stopAutoScroll(),this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this.target.barHandler&&this.target.barHandler.onTouchBegan()},cleverapps.UI.ScrollHandler.prototype.handleMove=function(e){if(this.bounceEnabled){var t=this.getHowMuchOutOfBoundary(e);e.x*=0===t.x?1:this.outOfBoundaryScale,e.y*=0===t.y?1:this.outOfBoundaryScale}else{t=this.getHowMuchOutOfBoundary(e);e.x+=t.x,e.y+=t.y}this.gatherMoveData(e);var s=cc.pAdd(this.target.getContainerPosition(),e);this.moveContainer(s)},cleverapps.UI.ScrollHandler.prototype.gatherMoveData=function(e){for(;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(e)
;var t=(new Date).getTime();this._touchMoveTimeDeltas.push((t-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=t},cleverapps.UI.ScrollHandler.prototype.handleRelease=function(e){if(this.inTouch=!1,this.gatherMoveData(e),!this.startBounceBackIfNeeded()){var t=this.calcTouchVelocity();0===t.x&&0===t.y||this.startInertialScroll(t)}this.target.barHandler&&this.target.barHandler.onTouchEnded()},cleverapps.UI.ScrollHandler.prototype.calcAutoScrollPercentage=function(){var e=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);return this._autoScrollEasing?e=this._autoScrollEasing.easing(e):this._autoScrollAttenuate&&(e=(e-=1)*e*e*e*e+1),e},cleverapps.UI.ScrollHandler.prototype.processAutoScroll=function(e){if(this._autoScrolling&&!this.inTouch){var t=1,s=this.calcAutoScrollPercentage();0<=s&&s<=1&&this.isNecessaryAutoScrollBrake()&&(t=.05),this._autoScrollAccumulatedTime+=e*(1/t),s=this.calcAutoScrollPercentage(),Math.abs(s-1)<=1e-4&&(s=1,
this.stopAutoScroll());var i=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,s));i=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(i,this._autoScrollBrakingStartPosition),t)),this.moveContainer(i)}},cleverapps.UI.ScrollHandler.prototype.moveContainer=function(e){this.target.scrollToPoint(e),this.afterContainerMove()},cleverapps.UI.ScrollHandler.prototype.isOutOfBoundary=function(){var e=this.getHowMuchOutOfBoundary();return!this.fltEqualZero(e)},cleverapps.UI.ScrollHandler.prototype.calcTouchVelocity=function(){var e=this._touchMoveTimeDeltas.reduce(function(e,t){return e+t},0);if(0===e||.5<=e)return cc.p(0,0);var t=cc.p(0,0);return this._touchMoveDisplacements.forEach(function(e){t.x+=e.x,t.y+=e.y}),cc.pMult(t,1/e)},cleverapps.UI.ScrollHandler.prototype.isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this.isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,
this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.target.getContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},cleverapps.UI.ScrollHandler.prototype.startInertialScroll=function(e){var t=.7*this.inertialScrollFactor,s=cc.pMult(e,t),i=this.calculateAutoScrollTimeByInitialSpeed(cc.pLength(e));this.startAutoScroll(s,i)},cleverapps.UI.ScrollHandler.prototype.calculateAutoScrollTimeByInitialSpeed=function(e){return Math.sqrt(Math.sqrt(e/5))*this.inertialScrollFactor},cleverapps.UI.ScrollHandler.prototype.fltEqualZero=function(e){return Math.abs(e.x)<=1e-4&&Math.abs(e.y)<=1e-4},cleverapps.UI.ScrollHandler.prototype.startAutoScroll=function(e,t,s){s=s||{},this._autoScrolling=!0,this._autoScrollTargetDelta=e,this._autoScrollAttenuate=!0,this._autoScrollStartPosition=this.target.getContainerPosition(),this._autoScrollTotalTime=t,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),
this._autoScrollCallback=s.callback,this._autoScrollEasing=s.easing;var i=this.getHowMuchOutOfBoundary();if(!this.fltEqualZero(i)){this._autoScrollCurrentlyOutOfBoundary=!0;var n=this.getHowMuchOutOfBoundary(e);(0<i.x*n.x||0<i.y*n.y)&&(this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.target.getContainerPosition())}},cleverapps.UI.ScrollHandler.prototype.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollCallback&&(this._autoScrollCallback(),delete this._autoScrollCallback)},cleverapps.UI.ScrollHandler.prototype.getHowMuchOutOfBoundary=function(e){if(void 0===e&&(e=cc.p(0,0)),0===e.x&&0===e.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=cc.p(0,0),s=this.target.getContainerPosition();return s.x+e.x>this.target.max.x?t.x=this.target.max.x-(s.x+e.x):s.x+e.x<this.target.min.x&&(t.x=this.target.min.x-(s.x+e.x)),s.y+e.y<this.target.min.y?t.y=this.target.min.y-(s.y+e.y):s.y+e.y>this.target.max.y&&(t.y=this.target.max.y-(s.y+e.y)),
0===e.x&&0===e.y&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),t},cleverapps.UI.ScrollHandler.prototype.isProcessing=function(){return this.inTouch||this._autoScrolling},cleverapps.styles.ScrollHandler={mouseWheelAcceleration:200,mouseWheelMinSpeed:500,mouseWheelMaxSpeed:2e3},cleverapps.UI.MapScrollHandler=function(e,t){t=t||{},this.target=e,this.bounceEnabled=!1,this.initAutoScrollParams()},cleverapps.UI.MapScrollHandler.prototype.initAutoScrollParams=function(){this._outOfBoundaryAmountDirty=!0,this._outOfBoundaryAmount=cc.p(0,0)},cleverapps.UI.MapScrollHandler.prototype.afterContainerMove=function(){this._outOfBoundaryAmountDirty=!0},cleverapps.UI.MapScrollHandler.prototype.handlePress=function(){this._autoScrolling=!1,this._touchMovePreviousTimestamp=(new Date).getTime(),this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[]},cleverapps.UI.MapScrollHandler.prototype.gatherMoveData=function(e){var t=this.getHowMuchOutOfBoundary(e);for(e.x+=t.x,
e.y+=t.y;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(e);var s=(new Date).getTime();this._touchMoveTimeDeltas.push((s-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=s},cleverapps.UI.MapScrollHandler.prototype.handleRelease=function(e){this.gatherMoveData(e);var t=this.calcTouchVelocity();0===t.x&&0===t.y||this.startInertialScroll(t)},cleverapps.UI.MapScrollHandler.prototype.processAutoScroll=function(e){if(this._autoScrolling){var t=this.isNecessaryAutoScrollBrake()?.05:1;this._autoScrollAccumulatedTime+=e*(1/t);var s=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(s=(s-=1)*s*s*s*s+1);var i=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,s)),n=Math.abs(s-1)<=1e-4,o=cc.pSub(i,this.target.getContainerPosition()),r=this.getHowMuchOutOfBoundary(o);this.fltEqualZero(r)||(i.x+=r.x,
i.y+=r.y,n=!0),n&&(this._autoScrolling=!1),this.target.moveContainer(cc.pSub(i,this.target.getContainerPosition()))}},cleverapps.UI.MapScrollHandler.prototype.isOutOfBoundary=function(){var e=this.getHowMuchOutOfBoundary();return!this.fltEqualZero(e)},cleverapps.UI.MapScrollHandler.prototype.calcTouchVelocity=function(){var e=this._touchMoveTimeDeltas.reduce(function(e,t){return e+t},0);if(0===e||e>=this._touchTotalTimeThreshold)return cc.p(0,0);var t=cc.p(0,0);return this._touchMoveDisplacements.forEach(function(e){t.x+=e.x,t.y+=e.y}),cc.pMult(t,1/e)},cleverapps.UI.MapScrollHandler.prototype.isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this.isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},
cleverapps.UI.MapScrollHandler.prototype.startInertialScroll=function(e){var t=cc.pMult(e,.7),s=this.calculateAutoScrollTimeByInitialSpeed(cc.pLength(e));this.startAutoScroll(t,s,!0)},cleverapps.UI.MapScrollHandler.prototype.calculateAutoScrollTimeByInitialSpeed=function(e){return Math.sqrt(Math.sqrt(e/5))},cleverapps.UI.MapScrollHandler.prototype.fltEqualZero=function(e){return Math.abs(e.x)<=1e-4&&Math.abs(e.y)<=1e-4},cleverapps.UI.MapScrollHandler.prototype.startAutoScroll=function(e,t){this._autoScrolling=!0,this._autoScrollTargetDelta=e,this._autoScrollAttenuate=!0,this._autoScrollStartPosition=this.target.getContainerPosition(),this._autoScrollTotalTime=t,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var s=this.getHowMuchOutOfBoundary();if(!this.fltEqualZero(s)){this._autoScrollCurrentlyOutOfBoundary=!0;var i=this.getHowMuchOutOfBoundary(e);(0<s.x*i.x||0<s.y*i.y)&&(this._autoScrollBraking=!0)}},
cleverapps.UI.MapScrollHandler.prototype.stopAutoScroll=function(){this._autoScrolling=!1},cleverapps.UI.MapScrollHandler.prototype.getHowMuchOutOfBoundary=function(e){if(void 0===e&&(e=cc.p(0,0)),0===e.x&&0===e.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var t=cc.p(0,0),s=this.target.container.getBoundingBox();return 0<s.x+e.x?t.x=-(s.x+e.x):s.width+s.x+e.x<this.target.width&&(t.x=this.target.width-(s.width+s.x+e.x)),s.height+s.y+e.y<this.target.height?t.y=this.target.height-(s.height+s.y+e.y):0<s.y+e.y&&(t.y=-(s.y+e.y)),0===e.x&&0===e.y&&(this._outOfBoundaryAmount=t,this._outOfBoundaryAmountDirty=!1),t},cleverapps.UI.Button=cc.Node.extend({ctor:function(r){this._super(),this.setAnchorPoint2(),(this.settings=r).styles&&(r.width=r.width||r.styles.width,r.height=r.height||r.styles.height,r.padding=r.padding||r.styles.padding),r.button_images&&(this.settings.button_png=this.settings.button_png||r.button_images.button_png,
this.settings.button_on_png=this.settings.button_on_png||r.button_images.button_on_png,this.settings.button_off_png=this.settings.button_off_png||r.button_images.button_off_png);var e=cleverapps.styles.UI.Button;this.bright=!0,this.createBackground(),r.disabled&&this.disable();var a=r.contentOffset&&void 0!==r.contentOffset.x?r.contentOffset.x:e.contentOffset.x,c=r.contentOffset&&void 0!==r.contentOffset.y?r.contentOffset.y:e.contentOffset.y,l=void 0!==r.contentPadding?r.contentPadding:e.contentPadding;if(r.content)["content","contentOff"].forEach(function(e,t){if(r[e]){if(r.padding&&void 0!==r.padding.left&&void 0!==r.padding.bottom){var s=cc.rect(r.padding.left,r.padding.bottom,r.width-r.padding.left-r.padding.right,r.height-r.padding.bottom-r.padding.top);r[e].setAnchorPoint2(),r[e].setPositionRound(s.x+s.width/2,s.y+s.height/2),cleverapps.UI.fitToBox(r[e],{width:s.width,height:s.height})}else{r[e].setPositionRound(this.width/2+a,this.height/2+c),r[e].setAnchorPoint2();var i=r[e],
n=.8*this.width-l;if(!1!==r.fitTo)if(i.fitTo)i.fitTo(n);else{var o=n/i.width;o<1&&i.setScale(o)}}this[e]=r[e],this.addChild(this[e]),0<t&&this[e].setVisible(!1)}},this);else if(r.text){var t=this.text=cleverapps.UI.generateTTFText(r.text,r.font||cleverapps.styles.FONTS.BUTTON_TEXT),s=t.width;r.padding&&r.padding.x&&(s+=2*r.padding.x),s>r.maxWidth&&(s=r.maxWidth),s>this.width&&this.resize(s,this.height);var i=Math.min(s,.8*this.width);r.padding&&r.padding.x&&(i-=2*r.padding.x);var n=this.height;r.padding&&r.padding.y&&(n-=2*r.padding.y),t.fitTo(i,n),t.setPositionRound(this.width/2+a,this.height/2+c),this.addChild(t)}if(r.onMouseOver&&(this.onMouseOver=r.onMouseOver),r.onMouseOut&&(this.onMouseOut=r.onMouseOut),cleverapps.UI.applyHover(this,{filter:r.filter}),cleverapps.UI.onClick(this,this.action.bind(this),{clickThrottle:r.clickThrottle,noThrottle:r.noThrottle,swallowTouches:r.swallowTouches,ignoreOnTouchMoved:r.ignoreOnTouchMoved,useInteractiveScale:r.useInteractiveScale,
filter:r.filter}),r.mark){var o=this.mark=new cc.Sprite(e.mark.icon);o.setAnchorPoint2(),o.setPositionRound(e.mark),this.addChild(o),o.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1))))}},showAlert:function(){!this.disabled&&this.settings.spine&&this.settings.button_alert_animation&&(this.alert=!0,this.background.setAnimation(0,this.settings.button_alert_animation,!0))},hideAlert:function(){this.settings.spine&&(this.alert=!1,this._innerUpdateBgContent())},setMarkVisible:function(e){this.mark&&this.mark.setVisible(e)},showHint:function(e){setTimeout(function(){!this.disabled&&this.isDisplayed()&&!this.hint&&this.mouseOver&&(this.hint=new cleverapps.UI.Tooltip(this.background,{text:e,size:cleverapps.styles.UI.Button.tooltipSize,position:this.settings.hintPosition||cleverapps.styles.UI.Tooltip.LOCATION.above}),this.addChild(this.hint),this.hint.setPositionRound(this.settings.hintPosition||cleverapps.styles.UI.Tooltip.LOCATION.above),
this.hint.replaceParentSamePlace(cc.director.getRunningScene()))}.bind(this),1e3)},hideHint:function(){this.hint&&(this.hint.removeFromParent(),this.hint=void 0)},createBackground:function(){if(this.settings.noBg)this.setContentSize2(this.settings.width,this.settings.height);else{var e,t;if(this.settings.spine)e=this.settings.width,t=this.settings.height,this.background=new cleverapps.Spine(this.settings.spine),this.settings.skin&&this.background.setSkin(this.settings.skin),this.background.setAnimation(0,this.settings.button_animation,!0);else{var s=function(e){var t=new cc.Sprite(e).getSpriteFrame();return t.spriteFrameName=e,t};this.button_png=s(this.settings.button_png||bundles.buttons.frames.window_button_png),this.button_on_png=s(this.settings.button_on_png||bundles.buttons.frames.window_button_on_png),this.button_off_png=s(this.settings.button_off_png||bundles.buttons.frames.window_button_disabled_png),this.background=cleverapps.UI.createScale9Sprite(
this.button_png.spriteFrameName,this.settings.scale9Rect),e=this.settings.width||this.background.width,t=this.settings.height||this.background.height}this.addChild(this.background),this.resize(e,t)}},setBackgroundImage:function(e){this.button_png=new cc.Sprite(e).getSpriteFrame(),this.button_png.spriteFrameName=e,this._innerUpdateBgContent()},setBackgroundImagePressed:function(e){this.button_on_png=new cc.Sprite(e).getSpriteFrame(),this.button_on_png.spriteFrameName=e,this._innerUpdateBgContent()},resize:function(e,t){var s=cleverapps.styles.UI.Button;if(this.setContentSize2(e,t),!this.settings.spine){if(s.scaleYOnly&&!1!==this.settings.scale){var i=t/this.background.height;i<1&&(i=1),this.background.width=e/i,this.background.setScale(i)}else this.background.setContentSize2(e,t);this.settings.mirrorX&&this.background.setScaleX(-this.background.scaleX)}this.background.setPositionRound(this.width/2,this.height/2)},onTouchBegan:function(){this.disabled||(
this.settings.spine?this.settings.button_on_animation&&this.background.setAnimation(0,this.settings.button_on_animation,!0):this.background&&this.background.setSpriteFrame(this.button_on_png))},onTouchEnded:function(){this.disabled||this._innerUpdateBgContent()},action:function(){this.disabled||this._isAncestorsVisible(this)&&(cleverapps.audio.playSound(this.settings.click_effect||bundles.main.urls.click_effect),this.settings.onClicked())},setBright:function(e){this.bright=e,this._innerUpdateBgContent()},disable:function(){this.disabled||(this.disabled=!0,this._innerUpdateBgContent(),this.tmpOnMouseOver=this.onMouseOver,this.onMouseOver=function(){},this.tmpOnMouseOut=this.onMouseOut,this.onMouseOut=function(){})},enable:function(){this.disabled&&(this.disabled=!1,this._innerUpdateBgContent(),this.tmpOnMouseOver&&(this.onMouseOver=this.tmpOnMouseOver,this.tmpOnMouseOver=void 0),this.tmpOnMouseOut&&(this.onMouseOut=this.tmpOnMouseOut,this.tmpOnMouseOut=void 0))},
setLoadingState:function(e){this.settings.loadingImg&&this.parent&&this.loadingState!==e&&(this.loadingState=e,this.loading&&!this.loadingState?(this.loading.runAction(new cc.RemoveSelf),delete this.loading,this.setVisible(!0)):this.loadingState&&(this.setVisible(!1),this.loading=new cc.Sprite(this.settings.loadingImg),this.parent.addChild(this.loading),this.loading.setAnchorPoint(this.getAnchorPoint()),cleverapps.UI.fitToBox(this.loading,this.getContentSize()),this.loading.runAction(new cc.RepeatForever(new cc.RotateBy(5,360))),this.loading.setPositionRound(this.getPosition())))},_innerUpdateBgContent:function(){var e=this.bright&&!this.disabled;this.settings.spine?this.alert?this.background.setAnimation(0,this.settings.button_alert_animation,!0):this.background.setAnimation(0,this.settings.button_off_animation&&!e?this.settings.button_off_animation:this.settings.button_animation,!0):(this.background&&this.background.setSpriteFrame(e?this.button_png:this.button_off_png),
this.content&&this.contentOff&&(e?(this.content.setVisible(!0),this.contentOff.setVisible(!1)):(this.content.setVisible(!1),this.contentOff.setVisible(!0))))},_isAncestorsVisible:function(e){if(null==e)return!0;var t=e.getParent();return!(t&&!t.isVisible())&&this._isAncestorsVisible(t)}}),cleverapps.styles.UI.Button={contentPadding:15,contentOffset:{x:0,y:0},tooltipSize:{width:180,height:80},mark:{icon:bundles.toolbar.frames.toolbar_attention_icon_png,x:{align:"right",dx:10},y:{align:"center"}}},cleverapps.UI.Button.Images={},cleverapps.UI.StateButton=cc.Node.extend({ctor:function(e){this._super(),this.buttonLabelStyles=[cleverapps.styles.FONTS.SWITCH_BUTTON_OFF,cleverapps.styles.FONTS.SWITCH_BUTTON_ON];var t=new cc.Sprite(bundles.switch_state_button.frames.switch_state_button),s=new cc.Sprite(bundles.switch_state_button.frames.switch_state_2_button||bundles.switch_state_button.frames.switch_state_button);bundles.switch_state_button.frames.switch_state_2_button||(s.setScaleX(-1),
this.buttonLabelStyles.reverse()),this.setContentSize2(t.width,t.height),this.setAnchorPoint2(),this.onClick=e.onClick,this.fitTo=(e.fitTo||.4)*this.width,this.state=0,this.states=[t,s],s.visible=!1,this.states.forEach(function(e){e.setPosition(this.width/2,this.height/2),this.addChild(e)},this);var n=cleverapps.styles.UI.StateButton;this.labels=[e.off,e.on].map(function(e,t){var s=new cleverapps.UI.generateTTFText(e,this.buttonLabelStyles[t]);s.setPositionRound(0===t?n.offText:n.onText),s.fitTo(this.fitTo);var i=new cc.Node;return i.setContentSize2(this.width/2,this.height),i.setAnchorPoint2(),i.setPosition(0===t?this.width/4:this.width/4*3,this.height/2),this.addChild(i),i.addChild(s),s},this),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.action.bind(this))},setState:function(e){this.state!==e&&(this.states[this.state].visible=!1,this.labels[this.state].setFont(this.buttonLabelStyles[1]),this.labels[this.state].fitTo(this.fitTo),this.state=e,
this.states[this.state].visible=!0,this.labels[this.state].setFont(this.buttonLabelStyles[0]),this.labels[this.state].fitTo(this.fitTo))},action:function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),this.setState(0===this.state?1:0),this.onClick(this.state)}}),cleverapps.overrideColors(cleverapps.styles.COLORS,{COLOR_SWITCH_BUTTON_OFF:new cc.Color(85,93,70,255)}),cleverapps.styles.FONTS=cleverapps.overrideFonts(cleverapps.styles.FONTS,{SWITCH_BUTTON_ON:{size:38,color:cleverapps.styles.COLORS.WHITE},SWITCH_BUTTON_OFF:{size:24,color:cleverapps.styles.COLORS.COLOR_SWITCH_BUTTON_OFF}}),cleverapps.styles.UI.StateButton={onText:{x:{align:"center",dx:-8},y:{align:"center",dy:0}},offText:{x:{align:"center",dx:8},y:{align:"center",dy:0}}},cleverapps.Layout=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t,e.forEach(function(e){e&&this.addChild(t.each?e.applyStyles(t.each):e)},this),this.reshape()},reshape:function(){return cleverapps.UI.arrangeWithMargins(
this.children,this.options),cleverapps.UI.wrap(this,this.options),this.options.padding&&cleverapps.UI.wrapWithPadding(this,this.options.padding,!0),this}}),cleverapps.Layout.AsyncChild=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint2()}}),cleverapps.Layout.AsyncChild.prototype.reshape=function(e){this.setContentSize2(e.width*e.scaleX,e.height*e.scaleY),this.addChild(e),e.setPositionRound(this.width/2,this.height/2),this.alignment&&this.setPositionRound(this.alignment),this.parent&&this.parent.reshape&&this.parent.reshape()},cleverapps.GridLayout=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{};for(var s=0;s<e.length;++s){var i=e[s];this.addChild(i)}this.reshape()},reshape:function(){var s=this.options;s.padding=s.padding||{},s.margin=s.margin||{},s.align=s.align||{},s.separator=s.separator||{},s={columns:s.columns||1,direction:s.direction||cleverapps.GridLayout.TOP_TO_BOTTOM,margin:{x:s.margin.x||0,y:s.margin.y||0},padding:{
left:s.padding.left||s.padding.x||0,right:s.padding.right||s.padding.x||0,top:s.padding.top||s.padding.y||0,bottom:s.padding.bottom||s.padding.y||0},align:{x:s.align.x||cleverapps.GridLayout.ALIGN_CENTER,y:s.align.y||cleverapps.GridLayout.ALIGN_CENTER},cell:s.cell&&{width:s.cell.width||0,height:s.cell.height||0},separator:{vertical:s.separator.vertical,horizontal:s.separator.horizontal}};for(var e=this.children.filter(function(e){return!e.separator||(e.removeFromParent(),!1)}),t=[],i=0;i<e.length;i+=s.columns)t.push(e.slice(i,i+s.columns));s.direction&cleverapps.GridLayout.REVERSED&&t.reverse();var n=[],o=[];if(s.cell){for(i=0;i<t.length;++i)o[i]=s.cell.height;for(i=0;i<s.columns;++i)n[i]=s.cell.width}else for(i=0;i<t.length;++i)for(var r=0,a=t[i];r<a.length;++r){var c=a[r];n[r]=Math.max(c.width*c.scaleX,n[r]||0),o[i]=Math.max(c.height*c.scaleY,o[i]||0)}var l,p=s.padding.bottom;for(i=0;i<t.length;++i){for(l=s.padding.left,r=0,a=t[i];r<a.length;++r){c=a[r];var d={},h={};switch(s.align.x
){case cleverapps.GridLayout.ALIGN_START:d.x=0,h.x=l;break;case cleverapps.GridLayout.ALIGN_END:d.x=1,h.x=l+n[r];break;default:d.x=.5,h.x=l+n[r]/2}switch(s.align.y){case cleverapps.GridLayout.ALIGN_START:d.y=0,h.y=p;break;case cleverapps.GridLayout.ALIGN_END:d.y=1,h.y=p+o[i];break;default:d.y=.5,h.y=p+o[i]/2}c.setAnchorPoint2(d.x,d.y),c.setPositionRound(h.x,h.y),s.separator.horizontal&&r!==a.length-1&&this.addSeparator(s.separator.horizontal,l+n[r],p,s.margin.x,o[i]),s.separator.vertical&&i!==t.length-1&&this.addSeparator(s.separator.horizontal,l,p+o[i],n[r],s.margin.y),l+=n[r]+s.margin.x}p+=o[i]+s.margin.y}l=n.reduce(function(e,t){return e+t+s.margin.x},0)+s.padding.left+s.padding.right-s.margin.x,p+=s.padding.top-s.margin.y,this.setContentSize2(l,p)},addSeparator:function(e,t,s,i,n){var o=new cc.Sprite(e.image);o.setAnchorPoint2(),o.setPositionRound(t+(e.x?o.calculateCoordinate(e.x,"x",i):i/2),s+(e.y?o.calculateCoordinate(e.y,"y",n):n/2)),o.separator=!0,this.addChild(o)}}),
cleverapps.GridLayout.REVERSED=256,cleverapps.GridLayout.BOTTOM_TO_TOP=1,cleverapps.GridLayout.TOP_TO_BOTTOM=257,cleverapps.GridLayout.ALIGN_CENTER=0,cleverapps.GridLayout.ALIGN_START=1,cleverapps.GridLayout.ALIGN_END=2,cleverapps.Shaders={GRAYSCALE_SPRITE_KEY:"grayscaleSprite",FLICKER_SHADER_KEY:"flicker",BLUR_FADE_KEY:"blur_fade",BLUR_CURTAIN_KEY:"blur_curtain",BLUR_CURTAIN_REVERSE_KEY:"blur_curtain_reverse",VERTEX_SRC:"  attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position = CC_PMatrix * a_position;  \n    v_fragmentColor = a_color; \n    v_texCoord = a_texCoord; \n}",GRAYSCALE_SRC:"varying vec2 v_texCoord;\nvarying vec4 v_fragmentColor; \nvoid main(){vec4 col = texture2D(CC_Texture0, v_texCoord);\nfloat gray = dot(col.rgb, vec3(0.25, 0.25, 0.25));\ngl_FragColor = v_fragmentColor * vec4(gray, gray, gray, col.a);\n}\n",
FLICKER_FRAGM:"precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform float sineTime; \nuniform vec3 flickColor; \nvoid main() \n{ \n    vec4 c = texture2D(CC_Texture0, v_texCoord); \n    vec3 deltacolor = c.rgb * flickColor * sineTime;\n    vec3 color = clamp(c.rgb + deltacolor, 0.0, 1.0);\n    gl_FragColor = v_fragmentColor * vec4(color, c.a); \n}",
BLUR_TEMPLATE:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform float u_blurOffset;\nuniform float u_extent;\nuniform float u_blurStrength;\n#define MAX_BLUR_WIDTH 4\nbool skipPixel(float y)\n{\n   %{skipFunction}}\nvoid main()\n{\n    vec2 u_blurOffset1 = vec2(0.0, float(u_blurOffset));\n    vec2 u_blurOffset2 = vec2(float(u_blurOffset), 0.0);\n    vec2 u_blurOffset3 = vec2(float(u_blurOffset) * sqrt(2.0), float(u_blurOffset) * sqrt(2.0));\n    vec2 u_blurOffset4 = vec2(float(u_blurOffset) * sqrt(2.0), -float(u_blurOffset) * sqrt(2.0));\n    vec4 color = texture2D(CC_Texture0, v_texCoord);\n    if (skipPixel(v_texCoord.y)) {\n       gl_FragColor = color;\n    } else {\n       float blurWidth = u_blurStrength * float(MAX_BLUR_WIDTH);\n       vec4 blurColor  = vec4(color.rgb, 1.0);\n       for (int i = 1; i < MAX_BLUR_WIDTH; ++ i)\n       {\n           if ( float(i) >= blurWidth ) break;           float weight = 1.0 - float(i) / blurWidth;\n           weight = weight * weight * (3.0 - 2.0 * weight); // smoothstep\n           vec4 sampleColor1 = texture2D(CC_Texture0, v_texCoord + u_blurOffset1 * float(i));\n           vec4 sampleColor2 = texture2D(CC_Texture0, v_texCoord - u_blurOffset1 * float(i));\n           vec4 sampleColor3 = texture2D(CC_Texture0, v_texCoord + u_blurOffset2 * float(i));\n           vec4 sampleColor4 = texture2D(CC_Texture0, v_texCoord - u_blurOffset2 * float(i));\n           vec4 sampleColor5 = texture2D(CC_Texture0, v_texCoord + u_blurOffset3 * float(i));\n           vec4 sampleColor6 = texture2D(CC_Texture0, v_texCoord - u_blurOffset3 * float(i));\n           vec4 sampleColor7 = texture2D(CC_Texture0, v_texCoord + u_blurOffset4 * float(i));\n           vec4 sampleColor8 = texture2D(CC_Texture0, v_texCoord - u_blurOffset4 * float(i));\n           blurColor += vec4(sampleColor1.rgb + sampleColor2.rgb + sampleColor3.rgb + sampleColor4.rgb + sampleColor5.rgb + sampleColor6.rgb + sampleColor7.rgb + sampleColor8.rgb, 8.0) * weight; \n       }\n       gl_FragColor = vec4(blurColor.rgb / blurColor.w, color.a);\n    }\n}",
BLUR_FADE_FRAGM:"",BLUR_CURTAIN_FRAGM:"",BLUR_CURTAIN_REVERSE_FRAGM:"",BLUR_FADE_SKIP:"   return false;\n",BLUR_CURTAIN_SKIP:"   return y > u_extent;\n",BLUR_CURTAIN_REVERSE_SKIP:"   return y < (1. - u_extent);\n",initialize:function(){if("undefined"!=typeof gl){var e=function(t,e,s){try{var i=new cc.GLProgram;i.initWithString(e,s),i.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION),i.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS),i.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR),i.link(),i.updateUniforms(),cc.shaderCache.addProgram(i,t)}catch(e){cleverapps.Shaders[t]=void 0,console.log(e)}};e(cleverapps.Shaders.GRAYSCALE_SPRITE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.GRAYSCALE_SRC),e(cleverapps.Shaders.FLICKER_SHADER_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.FLICKER_FRAGM),cleverapps.Shaders.BLUR_FADE_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_FADE_SKIP),
cleverapps.Shaders.BLUR_CURTAIN_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_CURTAIN_SKIP),cleverapps.Shaders.BLUR_CURTAIN_REVERSE_FRAGM=cleverapps.Shaders.BLUR_TEMPLATE.replace("%{skipFunction}",cleverapps.Shaders.BLUR_CURTAIN_REVERSE_SKIP),e(cleverapps.Shaders.BLUR_FADE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_FADE_FRAGM),e(cleverapps.Shaders.BLUR_CURTAIN_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_CURTAIN_FRAGM),e(cleverapps.Shaders.BLUR_CURTAIN_REVERSE_KEY,cleverapps.Shaders.VERTEX_SRC,cleverapps.Shaders.BLUR_CURTAIN_REVERSE_FRAGM)}}},cleverapps.UI.Avatar=cc.Node.extend({ctor:function(e,t){var s=e;e&&(e.avatar||e.id)&&(s=e.avatar,t=e.id),this._super();var i=t===levels.user.id,n=new cc.Sprite(i?bundles.main.frames.user_avatar:bundles.main.frames.default_avatar);this.addChild(n),this.avatar=n;var o=e&&e.frame;o||(o=i?bundles.avatar.frames.avatar_frame2:bundles.avatar.frames.avatar_frame);var r=new cc.Sprite(o)
;r.setLocalZOrder(1),this.addChild(r);var a=cleverapps.styles.UI.Avatar;this.setAnchorPoint(.5,.5),this.setContentSize2(r.getContentSize()),n.setPositionRound(this.width/2,this.height/2+(a.bottom-a.top)/2),r.setPositionRound(this.width/2,this.height/2),this.adjustSize(),(this.image=s)&&"string"==typeof s&&cleverapps.social.isLoggedIn()&&t&&0<=s.indexOf("fbsbx.com")&&(cleverapps.social instanceof cleverapps.MobileFacebook||cleverapps.social instanceof cleverapps.Html5)&&(this.avatarFBUserId=t,this.onImageLoadErrorSafe=this.createListener(this.onImageLoadError.bind(this))),this.onImageLoadSafe=this.createListener(this.onImageLoad.bind(this))},onImageLoadError:function(){cleverapps.social.aboutUser(this.avatarFBUserId,this.createListener(this.onFBUserLoaded.bind(this)))},onFBUserLoaded:function(e){if(e&&e.picture&&e.picture.data&&e.picture.data.url){this.image=e.picture.data.url,this.onImageLoadErrorSafe=void 0,this.setImage(this.image);var t={avatar:this.image}
;cleverapps.RestClient.post("/info/"+this.avatarFBUserId,t,function(e){},function(){console.log("Failed updating user avatar: "+t.avatar)})}},onEnter:function(){if(this._super(),this.image){var t=!0;["stub_128x128.gif","camera_200.png"].forEach(function(e){"string"==typeof this.image&&-1!==this.image.indexOf(e)&&(t=!1)}.bind(this)),t&&this.setImage(this.image)}},adjustSize:function(){this.avatar.setScale((this.width-2*cleverapps.styles.UI.Avatar.x)/this.avatar.width,(this.height-cleverapps.styles.UI.Avatar.top-cleverapps.styles.UI.Avatar.bottom)/this.avatar.height)},onImageLoad:cleverapps.whenShow(function(e,t){if(e)this.onImageLoadErrorSafe&&this.onImageLoadErrorSafe(),console.log("Error loading avatar image!");else try{var s=new cc.Sprite(t);s.setPositionRound(this.width/2,this.height/2),this.avatar.removeFromParent(),this.addChild(s),this.avatar=s,this.adjustSize()}catch(e){console.log("Cross-domain??",e)}}),loadGif:function(n){if(cc.sys.isNative||(n=n.replace("https:","").replace(
"http:","")),n!==this.imageUrl){this.imageUrl=n;try{var o=new SuperGif;o.load_url(n,this.createListener(function(){if(n===this.imageUrl){var e=o.getFrames();if(Array.isArray(e)&&0<e.length){var t=new cc.Sprite(e[0]);t.setPositionRound(this.width/2,this.height/2),this.avatar.removeFromParent(),this.addChild(t),this.avatar=t,this.adjustSize();var s=[];e.forEach(function(e){s.push(new cc.Sprite(e).getSpriteFrame())});var i=new cc.Animation(s,.075);this.avatar.runAction(new cc.RepeatForever(cc.animate(i)))}}}.bind(this)))}catch(e){n===this.imageUrl&&delete this.imageUrl,console.log("Cross-domain??",e),this.onImageLoadErrorSafe&&this.onImageLoadErrorSafe()}}},getImageSpriteFrame:function(e){if(0===e.indexOf("#"))return cc.spriteFrameCache.getSpriteFrame(e)||cc.spriteFrameCache.getSpriteFrame(e.replace(/\//g,"-"))||cc.spriteFrameCache.getSpriteFrame(e.replace(/\//g,"-").replace("#","#main-"))},setImage:cleverapps.whenShow(function(s){if(s instanceof cc.SpriteFrame)this.avatar.setSpriteFrame(
s),this.adjustSize();else if(0===s.indexOf("#")&&this.getImageSpriteFrame(s))this.avatar.setSpriteFrame(this.getImageSpriteFrame(s)),this.adjustSize();else if(-1!==s.indexOf(".gif"))this.loadGif(s);else{var e=cleverapps.UI.Avatar.cache.get(s);if(e)return void this.onImageLoadSafe(0,e);var i=cleverapps.environment.onShowCounter;cc.loader.loadImg(s,cleverapps.whenShow(function(e,t){if(i!==cleverapps.environment.onShowCounter&&cc.sys.isNative)return cc.textureCache.removeTextureForKey(s),void this.setImage(s);this.onImageLoadSafe(e,t)}.bind(this)))}})}),cleverapps.UI.Avatar.cache=new cleverapps.Cache,cleverapps.UI.Avatar.preload=function(s,i){if(i=i||function(){},Array.isArray(s)){var t=cleverapps.wait(s.length,i);s.forEach(function(e){cleverapps.UI.Avatar.preload(e.avatar||e,t)})}else if("string"==typeof s&&0!==s.indexOf("#")&&-1===s.indexOf(".gif")){var e=cleverapps.UI.Avatar.cache.get(s);e?i(e):cc.loader.loadImg(s,function(e,t){e||cleverapps.UI.Avatar.cache.set(s,t),i(!e&&t)})}else i()
},cleverapps.Parallax={apply:function(e){e.scene&&(e=e.scene),e.parallaxContainer=new cc.Node,e.parallaxContainer.setAnchorPoint(.5,.5),e.parallaxContainer.setLocalZOrder(cleverapps.styles.parallax.zOrder),e.addChild(e.parallaxContainer),e._parallaxContainerPosition={x:0,y:0},this.isAvailable()&&(cc.sys.isNative||(cc.sys.BROWSER_TYPE_MOBILE_QQ=cc.sys.browserType),cleverapps.Parallax.onChangeSize(e),cleverapps.Parallax.refresh=cleverapps.Parallax._refresh.bind(e),cleverapps.Parallax.setEnabled=cleverapps.Parallax._changeEnabled.bind(e),e._parallaxEnabled=!0,cc.inputManager.setAccelerometerInterval(1/60),cc.inputManager.setAccelerometerEnabled(!0),cc.eventManager.addListener({event:cc.EventListener.ACCELERATION,callback:cleverapps.Parallax._handleOrientation.bind(e)},e))},isAvailable:function(){return cc.sys.isMobile&&cc.sys.capabilities.hasOwnProperty("accelerometer")&&"board"===!cleverapps.config.type},onChangeSize:function(e){if(e.scene&&(e=e.scene),this.isAvailable(
)&&e.parallaxContainer){var t=(cleverapps.styles.SCENE_HEIGHT+2*cleverapps.styles.parallax.height)/cleverapps.styles.SCENE_HEIGHT;e.width+2*cleverapps.styles.parallax.width>cleverapps.styles.SQUARE_MODE_WIDTH&&(t=Math.max(t,(cleverapps.styles.SQUARE_MODE_WIDTH+2*cleverapps.styles.parallax.width)/cleverapps.styles.SQUARE_MODE_WIDTH)),e.parallaxContainer.setScale(t),e._parallaxContainerPosition={x:(e.width-e.width*t)/2,y:(e.height-e.height*t)/2},e.parallaxContainer.setPosition(e._parallaxContainerPosition)}},setEnabled:function(){},refresh:function(){},_changeEnabled:function(e){e||this.parallaxContainer.stopAllActions(),e!==this._parallaxEnabled&&(this._parallaxEnabled=e,this._parallaxEnabled&&cleverapps.Parallax.refresh())},_refresh:function(){this._parallaxEnabled&&(delete this._parallaxBaseAngle,delete this._parallaxDx,delete this._parallaxDy,this._parallaxEnabled=!1,this.parallaxContainer.stopAllActions(),this.parallaxContainer.runAction(new cc.Sequence(new cc.MoveTo(.3,
this._parallaxContainerPosition),new cc.CallFunc(function(){this._parallaxEnabled=!0}.bind(this)))))},_handleOrientation:function(e){if(this._parallaxEnabled&&!(Math.abs(e.x)<1e-4&&Math.abs(e.y)<1e-4)){var t=90*e.x,s=90*e.y;this._parallaxBaseAngle||(this._parallaxBaseAngle={x:t,y:s},this._parallaxDx=t,this._parallaxDy=s),this._parallaxDx=.1*t+.9*this._parallaxDx,this._parallaxDy=.1*s+.9*this._parallaxDy,t=this._parallaxDx-this._parallaxBaseAngle.x,s=this._parallaxDy-this._parallaxBaseAngle.y,Math.abs(t)<cleverapps.Parallax.PARALLAX_MAX_ANGLE&&(this.parallaxContainer.x=this._parallaxContainerPosition.x+t*cleverapps.styles.parallax.width/cleverapps.Parallax.PARALLAX_MAX_ANGLE),Math.abs(s)<cleverapps.Parallax.PARALLAX_MAX_ANGLE&&(this.parallaxContainer.y=this._parallaxContainerPosition.y+s*cleverapps.styles.parallax.height/cleverapps.Parallax.PARALLAX_MAX_ANGLE)}},PARALLAX_MAX_ANGLE:30},cleverapps.styles.parallax={width:40,height:40,zOrder:0},cleverapps.FixedWidthScene=cc.Scene.extend({
ctor:function(e){cleverapps.wideMode.refresh(),this._super(),cleverapps.environment.setScene(e);var t=cc.director.getWinSize();this.setContentSize(t),this.scene=new cc.Node,this.scene.resizeScale=1,this.scene.sceneName=e,this.scene.setPositionRound(this.width/2,this.height/2),this.scene.setAnchorPoint(.5,.5),this.scene.setContentSize2(cleverapps.UI.getSceneSize());var s=new ShadowView;s.setPosition(0,-cleverapps.UI.getSceneOffsetY()),this.scene.addChild(s,20),this.addChild(this.scene),cleverapps.Parallax.apply(this),this.backgroundStyles=this.getBackgroundStyles(),this.setBackground(),this.ctorCustomize(),this.needDisplayIntro=!0,this.addMenuBar(),cleverapps.windows.reset();var i=this.getAudioStyles();this.runAction(new cc.Sequence(new cc.DelayTime(i.delay||0),new cc.CallFunc(function(){cleverapps.audio.insertDisk(i.res)}))),this.currentOrientation=this.calcOrientation()},calcOrientation:function(){
return cc.sys.isNative||void 0===typeof window?0:window.innerHeight<window.innerWidth?0:1},getAudioStyles:function(){return cleverapps.styles.FixedWidthScene.sound},_playIntro:function(){this.needDisplayIntro=!1,cleverapps.metha.display({focus:"Scene.intro",action:this.displayIntro.bind(this)})},displayIntro:function(e){e()},addMenuBar:function(){if(this.upMenuButtons&&(this.upMenuButtons.removeFromParent(),delete this.upMenuButtons),!MenuControlButton.needToAddInsidePanel()){var e=this.upMenuButtons=new SceneControlButtonsView;e.deltaY=cleverapps.UI.getSceneOffsetY()-cleverapps.styles.MenuBar.minOffest,e.deltaY<0&&(e.deltaY=0),e.alignment=cleverapps.clone(e.alignment,!0),e.alignment.y.dy+=e.deltaY,this.scene.addChild(e)}var t=Boolean(this.upMenuBar);this.upMenuBar&&this.upMenuBar.removeFromParent();var s=this.upMenuButtons?this.upMenuButtons.x-this.upMenuButtons.width/2:this.scene.width;this.upMenuBar=new MenuBarView(s,this.scene),t&&cleverapps.menuBar.getSceneItems().forEach(
function(e){cleverapps.metha.isControlEnabled(e.getControlName())&&cleverapps.metha.showControlsWhileFocused(e.getControlName(),!0)})},getBackgroundStyles:function(){return cleverapps.skins.getSlot("sceneBg")||cleverapps.styles.FixedWidthScene.background},setBackground:function(){var e=this.backgroundStyles;if(e)if(e.pattern){var t=cc.director.getWinSize();t.height+=2,(i=this.background=new cc.Node).setAnchorPoint(.5,.5),i.setPosition(t.width/2,t.height/2-cleverapps.UI.getSceneOffsetY()),i.setContentSize(t);var s=cleverapps.UI.createPatternSprite(e.background||e.pattern,t);i.addChild(s),i.setLocalZOrder(-10),this.updateBackgroundScale(),this.scene.addChild(i)}else{var i=this.background=new cc.Sprite(e.background);if(e.animation){var n=this.background.animation=new cleverapps.Spine(e.animation);n.setAnimation(0,"animation",!0),e.skin&&n.setSkin(e.skin),n.setPositionRound(i.width/2,i.height/2),i.addChild(n)}i.setPosition(this.scene.width/2,this.scene.height/2),this.updateBackgroundScale(
);var o=this.scene.parallaxContainer;!1===e.parallax?(o=this.scene,i.setLocalZOrder(-10)):o.setLocalZOrder(-10),o.addChild(i)}},getRefreshSceneActionOnChangeSize:function(){return!1},onChangeSize:function(e){var t=this.calcOrientation();if(t!==this.currentOrientation||e){if(t===this.currentOrientation&&(cleverapps.MobileOK.isAppropriate()||cleverapps.MobileMyMailRu.isAppropriate()))return;this.currentOrientation=t;var s=this.getRefreshSceneActionOnChangeSize();if(s){var i=function(e){cleverapps.eventLogger.logEvent("refreshscene_changesize"),s(e)};return void(cleverapps.metha.isFocused()?cleverapps.FixedWidthScene.canDistractChangeSize?(cleverapps.FixedWidthScene.canDistractChangeSize=!1,cleverapps.metha.distract({focus:"refreshSceneOnChangeSize"+Date.now(),action:i})):cleverapps.FixedWidthScene.changedOrientation=!0:(cleverapps.FixedWidthScene.canDistractChangeSize=!1,cleverapps.metha.display({focus:"refreshSceneOnChangeSize"+Date.now(),action:i})))}}cleverapps.metha.isFocused(
)&&!cleverapps.FixedWidthScene.canDistractChangeSize&&(cleverapps.FixedWidthScene.changedSize=!0),this.setContentSize(cc.view.getDesignResolutionSize()),this.setContentSize2(this.getContentSize()),this.scene.resizeScale=Math.min(1,this.getContentSize().width/this.scene.width),this.scene.setScale(this.scene.resizeScale),this.scene.setPositionRound(this.width/2,this.height/2),this.updateBackgroundScale();var n,o=cleverapps.UI.getSceneOffsetY(),r=o-cleverapps.styles.MenuBar.minOffest;r<0&&(r=0),this.upMenuBar&&(n=r-this.upMenuBar.deltaY,this.upMenuBar.y+=n,this.upMenuBar.hideHandler&&(this.upMenuBar.hideHandler.originalPosition.y+=n,this.upMenuBar.hideHandler.hidePosition.y+=n),this.upMenuBar.deltaY=r),this.upMenuButtons&&(n=r-this.upMenuButtons.deltaY,this.upMenuButtons.y+=n,this.upMenuButtons.hideHandler&&(this.upMenuButtons.hideHandler.originalPosition.y+=n,this.upMenuButtons.hideHandler.hidePosition.y+=n),this.upMenuButtons.deltaY=r),this.downToolBar&&(n=o-this.downToolBar.deltaY,
this.downToolBar.y-=n,this.downToolBar.hideHandler&&(this.downToolBar.hideHandler.originalPosition.y-=n,this.downToolBar.hideHandler.hidePosition.y-=n),this.downToolBar.deltaY=o),cleverapps.Notification.remove(!0),cleverapps.eventBus.trigger("changeSceneSize")},updateBackgroundScale:function(){if(this.background){var e=this.backgroundStyles;if("number"==typeof e.scale)this.background.setScale(e.scale);else{var t=this.bgScaleMargin||1,s=Math.max(this.width/this.background.width*t/this.scene.scale,this.height/this.background.height*t/this.scene.scale);if(this.background.setScale(s),cleverapps.isInstant()){var i=this.background.height/t*s;i>this.height&&(this.background.y=this.height/2+(i-this.height)/3)}this.background.stopAllActions()}}},onExit:function(){this._super(),cleverapps.bundleLoader.clearUnusedResources()},onEnter:function(){this._super(),cc.sys.garbageCollect()},onTransitionAnimationDidStart:function(){cleverapps.audio.fadeOut()},visit:function(e){this.shadowVisitQueue=[],
this._super.apply(this,arguments),this.afterVisitShadow()},afterVisitShadow:function(){this.afterVisitShadowProcessing=!0;var e=this.shadowVisitQueue||[];this.shadowVisitQueue=[],e.forEach(cleverapps.callFunc),this.afterVisitShadowProcessing=!1},closeAction:function(){cleverapps.metha.display({focus:"closeScene",action:function(e){cleverapps.metha.gotoMainScene(e)}})}}),cleverapps.FixedWidthScene.prototype.createFilmEffect=function(e){(e=e||{}).layerSizeKoef=void 0!==e.layerSizeKoef?e.layerSizeKoef:.1,e.layerTimeout=e.layerTimeout||.3,e.onComplete=e.onComplete||function(){},this.scene.stopAllActions(),this.scene.basePosition=this.scene.getPosition();var t={x:this.scene.basePosition.x,y:this.scene.basePosition.y};if(e.scale=e.scale||1.3,this.upperFilmLayer=new cc.LayerColor(cc.color.BLACK,this.scene.width,this.scene.height*e.layerSizeKoef+(e.layerSizeKoef?3:0)),this.downFilmLayer=new cc.LayerColor(cc.color.BLACK,this.scene.width,this.scene.height*e.layerSizeKoef+(e.layerSizeKoef?3:0)),
e.moveBy&&(e.moveBy.x&&(t.x+=e.moveBy.x),e.moveBy.y)){if(e.moveBy.y<0){var s=this.upperFilmLayer.height+this.scene.height*(e.scale-1)/2;e.moveBy.y<-s&&(e.moveBy.y=-s)}else{s=this.downFilmLayer.height+this.scene.height*(e.scale-1)/2;e.moveBy.y>s&&(e.moveBy.y=s)}t.y+=e.moveBy.y}this.upperFilmLayer.setPositionRound(0,this.height-this.upperFilmLayer.height+2),this.downFilmLayer.setPositionRound(0,-1),this.downFilmLayer.setLocalZOrder(50),this.upperFilmLayer.setLocalZOrder(50),this.addChild(this.upperFilmLayer),this.addChild(this.downFilmLayer),e.silent?(this.scene.setScale(e.scale),this.scene.setPositionRound(t),e.onComplete()):(e.scaleTimeout=e.scaleTimeout||1,this.upperFilmLayer.setOpacity(0),this.downFilmLayer.setOpacity(0),this.scene.runAction(new cc.Sequence(new cc.DelayTime(e.layerTimeout),new cc.Spawn(new cc.MoveTo(e.scaleTimeout,t),new cc.ScaleTo(e.scaleTimeout,e.scale)),new cc.CallFunc(e.onComplete))),this.upperFilmLayer.runAction(new cc.FadeTo(e.layerTimeout,255)),
this.downFilmLayer.runAction(new cc.FadeTo(e.layerTimeout,255))),e.noControls||(cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0},onTouchEnded:function(){return e.onClick&&e.onClick(),!0}},this.upperFilmLayer),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0},onMouseMove:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0}},this.upperFilmLayer))},cleverapps.FixedWidthScene.prototype.removeFilmEffect=function(e){var t;(e=e||{}).scaleTimeout=void 0===e.scaleTimeout?1:e.scaleTimeout,e.layerTimeout=e.layerTimeout||.3,this.scene.stopAllActions(),this.stopAllActions(),this.scene.runAction(new cc.Spawn(new cc.MoveTo(e.scaleTimeout,this.scene.basePosition),new cc.ScaleTo(e.scaleTimeout,1))),this.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),new cc.CallFunc(function(){this.scene.setScale(1),
this.scene.setPositionRound(this.scene.basePosition),e.onComplete&&e.onComplete()}.bind(this)))),e.scaleLayerSameTime&&(e.layerTimeout=e.scaleTimeout,e.scaleTimeout=0),this.upperFilmLayer&&(this.upperFilmLayer.stopAllActions(),t=e.layerSlide?new cc.MoveBy(e.layerTimeout,{x:0,y:this.upperFilmLayer.height}):new cc.FadeTo(e.layerTimeout,0),this.upperFilmLayer.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),t,new cc.RemoveSelf)),this.upperFilmLayer=void 0),this.downFilmLayer&&(this.downFilmLayer.stopAllActions(),t=e.layerSlide?new cc.MoveBy(e.layerTimeout,{x:0,y:-this.downFilmLayer.height}):new cc.FadeTo(e.layerTimeout,0),this.downFilmLayer.runAction(new cc.Sequence(new cc.DelayTime(e.scaleTimeout),t,new cc.RemoveSelf)),this.downFilmLayer=void 0)};var SceneProxy=function(e,t,arguments){this.superClass=e,this.self=t,this.arguments=arguments,cleverapps.newSceneStack=(new Error).stack,this.instance=void 0,this.callbacks=[]};SceneProxy.prototype.instantiate=function(){
var e=cc.Node.superClassCreateFunction(this.superClass);this.instance=e.apply(this.self,this.arguments),this.instance.sceneBundles=this.sceneBundles,this.instance.isWide=this.isWide,this.onLoad()},SceneProxy.prototype.onLoad=function(){this.callbacks.forEach(function(e){e(this.instance)},this),this.callbacks=[]},SceneProxy.prototype.whenLoaded=function(e){this.instance?e(this.instance):this.callbacks.push(e)},cleverapps.FixedWidthScene.superExtend=cleverapps.FixedWidthScene.extend,cleverapps.FixedWidthScene.extend=function(){var s=cleverapps.FixedWidthScene.superExtend.apply(this,arguments),i=function(){cleverapps.eventManager.setCurrentFeatures(),cleverapps.skins.update(),cleverapps.gameSceneLogs=[],cleverapps.gameSceneLogs.push("arguments in SceneClass arg0: "+!!arguments[0]+" arg1: "+!!arguments[1]+" argsLength: "+arguments.length);var e=new SceneProxy(s,this,arguments);e.sceneBundles=cleverapps.bundleLoader.getClassBundles(i,this,arguments).filter(function(e){return bundles[e]}),
e.isWide=i.IS_WIDE,cleverapps.config.debugMode&&e.sceneBundles.push("dev_resources"),this.onSuccess=cleverapps.accumulate(0,e.instantiate.bind(e)),cleverapps.bundleLoader.loadBundles(e.sceneBundles,{onSuccess:this.onSuccess.bind(this),onFailure:function(){new RestartWindow}});var t=cc.director.getRunningScene();return t&&t.sceneBundles&&(t.performRecursive(function(e){e.stopAllActions()}),cleverapps.bundleLoader.deleteBundles(t.sceneBundles),delete t.sceneBundles),cc.pool.drainAllPools(),e};return i.DebugConstructor=s,i.prototype=s.prototype,i.extend=cleverapps.FixedWidthScene.extend,i},cleverapps.FixedWidthScene.prototype.ctorCustomize=function(){},cleverapps.styles.FixedWidthScene={background:!1,sound:{res:bundles.main.urls.background_music_map,delay:.5}};var Windows=function(){this.list=[],this.bundles=0,this.onHideShadow=function(e){},this.onShowShadow=function(e){},this.onMoveShadowUp=function(){},this.onMoveShadowDown=function(){},this.onOpenListeners={},this.onCloseListeners={},
this.onAllClosed=[],this.onceNoWindowsListener=void 0};Windows.prototype.isActive=function(){return 0<this.list.length||0<this.bundles},Windows.prototype.reset=function(){this.list=[],this.onAllClosed=[],this.bundles=0,this.onHideShadow()},Windows.prototype.currentWindow=function(){if(0!==this.list.length)return this.list[this.list.length-1]},Windows.prototype.add=function(e){if(cleverapps.metha.isFocused()||-1!==["promptwindow"].indexOf(e.name)||cleverapps.metha.debugMessage("Trying to show window without user focus!"),e instanceof WaitWindow)e.displaySelf();else{if(0<this.list.length){var t=this.list[this.list.length-1];e.windowForce?this.onMoveShadowUp():(t.setVisible(!1),this.onHideShadow(),t.initializedSuccess&&t.onHide())}if(this.list.push(e),this.showWindow(),1===this.list.length&&!(this.list[0]instanceof Force))for(var s in this.onOpenListeners)this.onOpenListeners[s]()}},Windows.prototype.hideWindow=function(){var e=this.currentWindow();e&&e.hideSelf()},
Windows.prototype.showWindow=function(){var e=this.currentWindow();e&&e.displaySelf()},Windows.prototype.whenAllClosed=function(e){cleverapps.windows.isActive()?cleverapps.windows.onAllClosed.push(e):e()},Windows.prototype.notifyMetha=function(){if(!this.isActive()&&cleverapps.metha.onceNoWindowsListener){var e=cleverapps.metha.onceNoWindowsListener;cleverapps.metha.onceNoWindowsListener=void 0,e(),cleverapps.metha.isFocused()||cleverapps.bundleLoader.clearUnusedResources()}},Windows.prototype.closeCallback=function(e){for(this.delete(e),e.onClose&&e.onClose(),cleverapps.environment&&cleverapps.environment.onCloseWindow(e.name),e.closeAnimationCallbacks&&(e.closeAnimationCallbacks.forEach(function(e){e()}),e.closeAnimationCallbacks=[]),e.shareCheckBox&&e.shareCheckBox.onWindowClose(),e.removeFromParent();!this.isActive()&&0<this.onAllClosed.length;){this.onAllClosed.shift()()}setTimeout(this.notifyMetha.bind(this),0)},Windows.prototype.remove=function(e){e.closed||(e.closed=!0,e.stop()
,e.beforeCloseAnimation(function(){e===this.currentWindow()?e.closeAnimation(this.closeCallback.bind(this,e)):this.closeCallback(e)}.bind(this)))},Windows.prototype.delete=function(e){var t=e===this.currentWindow(),s=this.list.indexOf(e);if(-1!==s&&this.list.splice(s,1),t)if(0===this.list.length){this.onHideShadow(),cleverapps.Parallax.setEnabled(!0);var i=cc.director.getRunningScene();i&&i.onShow&&i.onShow(),setTimeout(function(){0===this.list.length&&cleverapps.values(this.onCloseListeners).forEach(cleverapps.callFunc)}.bind(this),e.closeDuration())}else e.windowForce?this.onMoveShadowDown():this.showWindow()};var ShadowView=cc.Node.extend({ctor:function(){if(this._super(),this.shadow=new ShadowLayer,this.shadow.setOpacity(0),this.addChild(this.shadow),this.shadow.visible=!1,this.show=!1,!cleverapps.windows)throw new Error("No cleverapps.windows cleverapps.allInitialized - "+cleverapps.allInitialized);cleverapps.windows.onHideShadow=this.createListener(this.deleteShadow.bind(this)),
cleverapps.windows.onShowShadow=this.createListener(this.createShadow.bind(this)),cleverapps.windows.onMoveShadowUp=this.createListener(this.moveUp.bind(this)),cleverapps.windows.onMoveShadowDown=this.createListener(this.moveDown.bind(this))}});ShadowView.prototype.createShadow=function(e){if(!this.show){this.show=!0,this.shadow.stopAllActions(),this.shadow.visible=!0,e.color&&this.shadow.setColor(e.color);var t=cleverapps.styles.ShadowView;this.shadow.runAction(new cc.FadeTo(t.duration,e.opacity||t.opacity))}},ShadowView.prototype.deleteShadow=function(){if(this.show){this.show=!1,this.shadow.stopAllActions();var e=cleverapps.styles.ShadowView;this.shadow.runAction(new cc.Sequence(new cc.FadeTo(e.duration,0),new cc.CallFunc(function(){this.shadow.visible=!1}.bind(this))))}},ShadowView.prototype.moveUp=function(){this.setLocalZOrder(30)},ShadowView.prototype.moveDown=function(){this.setLocalZOrder(20)},cleverapps.styles.ShadowView={duration:.3,opacity:110}
;var BaseWindow=cc.Node.extend({listBundles:function(){return[]},ctor:function(e){if(!cleverapps.environment.isEditorScene()||this.editorWindow){this._super(),this.isBundlesLoaded=!1;var t=arguments;e=void 0!==e?e:{};var s=cc.director.getRunningScene();if(e.parentScene||s.windowsContainer||(s=s.scene),cleverapps.config.wysiwygMode&&(s=cc.director.getRunningScene()).emulatorScene&&(s=s.emulatorScene),s.addChild(this),this.adjustBaseWindow(),this.setLocalZOrder(21),cleverapps.windows.add(this),this.applyTouch(),cleverapps.eventBus.on("changeSceneSize",this.adjustBaseWindow.bind(this),this),this.bundles=this.listBundles.apply(this,arguments)||[],cleverapps.skins.getBundle()&&this.bundles.push(cleverapps.skins.getBundle()),this.bundles.push("windows"),this.bundles=cleverapps.unique(this.bundles),this.bundles=this.bundles.filter(function(e){return bundles[e]}),0!==this.bundles.length){this.showLoading();var i=[this.createListener(function(){this.hideLoading(),this.runWindow(t)}.bind(this)),
this.createListener(function(){this.deleteSelf(),new RestartWindow}.bind(this))];Array.prototype.push.apply(i,arguments),this.load.apply(this,i)}else this.runWindow(t)}},load:function(e,t,s){cleverapps.bundleLoader.loadBundles(this.bundles,{onSuccess:e,onFailure:t})},adjustBaseWindow:function(){var e=cc.director.getRunningScene(),t=e.width,s=e.height;this.setScale(1/this.parent.getScale()),this.setContentSize(t,s),this.setPositionRound((this.parent.width*this.parent.getScale()-t)/2,(this.parent.height*this.parent.getScale()-s)/2),this.loading&&this.loading.setPositionRound(t/2,s/2)},applyTouch:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchStart.bind(this),onTouchEnded:this.onTouchEnd.bind(this)},this),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){return!!this.isVisible()&&(e&&e.stopPropagation&&e.stopPropagation(),!0)}.bind(this),onMouseScroll:function(e){
return!!this.isVisible()&&(e&&e.stopPropagation&&e.stopPropagation(),!0)}.bind(this)},this)},showLoading:function(){var e=this.loading=WaitWindow.prototype.showLoading.call(this);e.setPositionRound(this.width/2,this.height/2),this.addChild(e),e.visible=!1,e.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.CallFunc(function(){e.visible=!0})))},hideLoading:function(){this.loading&&(this.loading.removeFromParent(),delete this.loading)},hasAppeared:function(){return this.isBundlesLoaded},runWindow:function(e){this.isBundlesLoaded=!0,this.onWindowLoaded.apply(this,e),this.initializedSuccess?this.displaySelf():this.deleteSelf()},hideSelf:function(){cleverapps.windows.currentWindow()===this&&(this.setVisible(!1),this.styles.shadow&&cleverapps.windows.onHideShadow(),this.onHide())},displaySelf:function(){this.hasAppeared()&&cleverapps.windows.currentWindow()===this&&(this.setVisible(!0),this.styles.shadow&&cleverapps.windows.onShowShadow(this.styles.shadow),
cleverapps.environment&&cleverapps.environment.onOpenWindow(this.name),this.popUpAnimation(),this.onShow())},deleteSelf:function(){cleverapps.windows.delete(this),this.removeFromParent()},stop:function(){cc.eventManager.removeListeners(this,!0)},beforeCloseAnimation:function(e){e()},close:function(){!0===this.closed&&cleverapps.throwAsync("Closing already closed window: "+this.name),this.isBundlesLoaded&&!this.closed&&(cleverapps.bundleLoader.deleteBundles(this.bundles),cleverapps.windows.remove(this))}}),Window=BaseWindow.extend({addBottomButtons:function(e){var t=this.buttons=new Buttons(e);this.window.addChild(t);var s=(i=this.styles.BottomButton||cleverapps.styles.Window.BottomButton).bottomPadding;if(t.setPositionRound(this.window.width/2,t.height/2+s),this.shareCheckBox){var i=cleverapps.styles.Window.ShareCheckBox;this.shareCheckBox.setPositionRound(this.window.width/2,t.y+t.height/2+this.shareCheckBox.height/2+i.offsetBottom)}},onWindowLoaded:function(e){
this.initializedSuccess=!0,cleverapps.Parallax.setEnabled(!1);var t=this.styles=e.styles||cleverapps.styles.Window;this.name=e&&e.name||e&&e.title||"window",this.onClose=e&&e.onClose||this.onClose,this.extraWidth=e.extraWidth||0,this.extraHeight=e.extraHeight||0,this.contentOffsetX=e.contentOffsetX||0,this.contentOffsetY=e.contentOffsetY||0;var s=e.content;if(s){this.customizeContent();var i=s.getContentSize(),n=[];if(e.button){var o=this.button=new BottomButton(this,e.button);n.push(o)}e.buttons&&(n=n.concat(e.buttons)),this.withBg=!e.noBackground&&!t.noBackground,!e.shareCheckBox||cleverapps.flags.noviral||cleverapps.flags.noshares||(this.createShareCheckBox(n,e.shareCheckBox),i.height+=this.getShareCheckBoxHeight());var r=this.windowSize=this.calcBackgroundSize(i,e);this.withBg?this.window=this.createBackground(r,t,e):(this.window=new cc.Node,this.window.setContentSize2(r),this.window.setAnchorPoint2(.5,.5),this.addChild(this.window)),
e.foreground&&e.adjustToContent&&this.addForeground(s,e.foreground);var a=cleverapps.skins.getSlot("windowDecors",{decors:t.decors,window:this,level:e.level});a&&(this.decors=new Decors(this,a)),this.adjustWindow(e),this.withBg&&this.createInnerBackground(),!1!==e.closeButton&&!1!==t.closeButton&&(this.withBg&&!t.bandButton||t.regularCloseButton||e.regularCloseButton?this.createCloseButton():this.createCloseBandButton()),e.help&&this.createHelpButton(e.help),t.Title&&e.title&&(this.addTitle(e.title),t.Title.bg&&!e.noTitleBg&&this.addTitleBg(t.Title.bg));var c=e.adjustToContent?0:t.contentOffset+this.getShareCheckBoxHeight()/2;s.setPositionRound(this.window.width/2+this.contentOffsetX,this.window.height/2+c+this.contentOffsetY),this.window.addChild(s),this.shareCheckBox&&(this.window.addChild(this.shareCheckBox),this.shareCheckBox.setPositionRound(this.window.width/2,this.shareCheckBox.height/2+t.ShareCheckBox.offsetBottom)),0<n.length&&this.addBottomButtons(n),cleverapps.eventBus.on(
"changeSceneSize",this.onChangeSceneSizeWindow.bind(this,e),this)}(!1!==e.closeButton||e.closeByBackButton)&&(this.closeByBackButton=this.close.bind(this));var l=this.onTouchInShadow;this.onTouchInShadow=function(){},this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){l?this.onTouchInShadow=l:e.notCloseByTouchInShadow||(this.onTouchInShadow=this.close.bind(this))}.bind(this)))),this.closeAnimationCallbacks=[],this.customize(),this.checkFit(s)},adjustWindow:function(e){var t=cc.size(this.windowSize.width,this.windowSize.height),s=cleverapps.UI.getSceneSize();cleverapps.config.wysiwygMode&&cc.director.getRunningScene().emulatorScene&&(s=cc.director.getRunningScene().emulatorScene.getContentSize()),t.width+2*this.styles.Background.paddingX>s.width&&(t.width=s.width-2*this.styles.Background.paddingX),t.height+2*this.styles.Background.paddingY>s.height&&(t.height=s.height-2*this.styles.Background.paddingY),this.windowScale=Math.min(t.width/this.windowSize.width,
t.height/this.windowSize.height),this.styles.noWindowScale&&(this.windowScale=1),this.window.setScale(this.windowScale);var i=e.bgOffset||this.styles.bgOffset,n=i?i.x:0,o=i?i.y:0;this.window.setPositionRound(this.width/2+n,this.height/2+o),this.window.basePosition=this.window.getPosition()},onChangeSceneSizeWindow:function(e){this.adjustWindow(e),this.closeButton instanceof BandButton&&this.createCloseBandButton(!0)},addTitleBg:function(e){var t,s=cleverapps.skins.getSlot("windowTitle",{image:e.image});!1===e.scale9?t=new cc.Sprite(s):(t=cleverapps.UI.createScale9Sprite(s,e.scale9),!e.adjustToWindow&&e.adjustToText&&(t.height+=e.adjustToText.height||0)),t.setLocalZOrder(e.zIndex),this.window.addChild(t),t.setPositionRound(e.x,e.y),this.titleBg=t,this.decors&&this.decors.initTitleDecorators(),this.updateTitleBg()},checkFit:function(e){var t=cleverapps.UI.getSceneSize(),s=t.width+cleverapps.styles.Window.checkFitThreshold;if(this.window&&this.window.width*this.window.scale>s){
var i="Window width "+this.window.width+" scale "+this.window.scale+" windowScale "+this.windowScale+" is greater than scene width "+t.width;e&&(i+=", content width "+e.width+" scale "+e.scale),cleverapps.throwAsync(i)}},createCloseBandButton:function(e){this.closeButton&&this.closeButton.removeFromParent();var t=new BandButton({onClicked:this.close.bind(this)});this.addChild(t,1),e||(t.hide(!0),t.show(.2)),this.closeButton=t},createCloseButton:function(){var e,t=this.styles.CloseButton;e=new cleverapps.UI.Button({button_png:bundles.main.frames.window_close_png,button_on_png:bundles.main.frames.window_close_on_png,onClicked:this.close.bind(this)}),this.styles.CloseButton.relativeToScene?(this.addChild(e),e.setPositionRound(this.styles.CloseButton.relativeToScene)):(this.window.addChild(e),e.setPositionRound(this.window.width-e.width/2+t.offsetX,this.window.height-e.height/2+t.offsetY)),e.setLocalZOrder(this.styles.CloseButton.zOrder),this.closeButton=e},createHelpButton:function(e){
var t=this.styles.HelpButton,s=new cleverapps.UI.Button({button_png:bundles.buttons_main.frames.help_button_png,button_on_png:bundles.buttons_main.frames.help_button_on_png,onClicked:e});s.setPositionRound(t),s.setLocalZOrder(t.zOrder),this.helpButton=s,this.window.addChild(s)},createShareCheckBox:function(e,t){var s=!0;cleverapps.social.isLoggedIn()||(s=!1),e&&e.forEach(function(e){e instanceof ShareBonusButton&&e.shareBonus.type===cleverapps.ShareBonus.DIALOG&&(s=!1),e.doubleType===RewardWindow.DOUBLE_SHARE&&(s=!1)}),s&&(this.shareCheckBox=new ShareCheckBox(t,this))},getShareCheckBoxHeight:function(){return this.shareCheckBox?this.shareCheckBox.height+this.styles.ShareCheckBox.offsetBottom+this.styles.ShareCheckBox.offsetTop:0},onChangeBackground:function(e){this.decors&&this.decors.updateAll(),this.titleBg&&this.titleBg.setPositionRound(this.styles.Title.bg)},customizeContent:function(){},customize:function(){},onShow:function(){this.shareCheckBox&&this.shareCheckBox.updateState()},
onHide:function(){},createBackground:function(e,t,s){var i;i=s.windowBg?s.windowBg:t.Background.image?t.Background.image:bundles.windows.frames.window_bg_png;var n=cleverapps.skins.getSlot("windowBg",{image:i,level:s.level}),o=cleverapps.UI.createScale9Sprite(n,t.Background.scale9);return o.setContentSize2(e),t.Background.opacity&&o.setOpacity(t.Background.opacity),this.addChild(o),this.bg=o,t.Background.stitches&&new StitchesComponent(this.bg,t.Background.stitches),o},addForeground:function(e,t){"string"==typeof t&&(t={image:t});var s=this.foreground=cleverapps.UI.createScale9Sprite(t.image,cleverapps.UI.Scale9Rect.TwoPixelXY);return s.setAnchorPoint2(0,0),s.setPositionRound(0,0),s.setContentSize2(e.width,e.height),s.setLocalZOrder(1),e.addChild(s),s},createInnerBackground:function(){if(this.styles.Background.inner){var e=this.innerBg=cleverapps.UI.createScale9Sprite(bundles.main.frames.window_inner_bg_png);e.setContentSize2(this.window.width-2*this.styles.Background.inner.padding.x,
this.window.height-2*this.styles.Background.inner.padding.y),this.window.addChild(e),e.setPositionRound(this.styles.Background.inner)}},calcBackgroundSize:function(e,t){var s=!this.withBg&&!(this.styles.noBackground&&this.styles.noBackground.keepSize||t.noBackground&&t.noBackground.keepSize),i=e.width+(this.withBg&&!t.adjustToContent?2*this.styles.Border.x:0)+this.extraWidth,n=e.height+(s||t.adjustToContent?0:2*this.styles.Border.y)+this.extraHeight,o=void 0!==t.minHeight?t.minHeight:cleverapps.styles.Window.minHeight;n<o&&(n=o);var r=void 0!==t.minWidth?t.minWidth:cleverapps.styles.Window.minWidth;return i<r&&(i=r),cc.size(i,n)},touchInShadow:function(e){if(!this.initializedSuccess)return!1;if(this.window){var t=this.window.convertToNodeSpace(e.getLocation()),s=this.window.getContentSize();if(cc.rectContainsPoint(cc.rect(0,0,s.width,s.height),t))return!1}return!0},onTouchStart:function(e){return!!this.isVisible()&&(this.touchStartInShadow=this.touchInShadow(e),!0)},
onTouchEnd:function(e){this.touchStartInShadow&&this.touchInShadow(e)&&this.onTouchInShadow(e)},addTitle:function(e){var t=e;e.text&&(t=e.text);var s=cleverapps.styles.FONTS.WINDOW_TITLE_TEXT;e.font&&(s=e.font);var i={};e.toReplace&&(i=e.toReplace);var n=this.styles.Title.offset||cleverapps.styles.Window.Title.offset;this.styles.Title.offsetY&&(n=this.styles.Title.offsetY);var o=this.styles.Title.offsetX?this.styles.Title.offsetX:0,r=cleverapps.UI.generateTTFText(t,s,i);r.setPositionRound(this.window.width/2-o,this.window.height-n),r.setAnchorPoint2(),r.setLocalZOrder(this.styles.Title.zIndex),this.window.titleText=r,this.window.addChild(r),this.setTitle(t,i)},setTitle:function(e,t){this.window.titleText&&(this.window.titleText.setString(e,t),!this.closeButton||this.closeButton instanceof BandButton?this.window.titleText.fitTo(this.window.width*this.styles.maxTitleSize.scale):this.window.titleText.fitTo(this.window.width-2*(this.closeButton.width+this.styles.titleCloseButtonMargin))),
this.titleBg&&this.updateTitleBg()},updateTitleBg:function(){var e=this.styles.Title.bg;if(e.adjustToWindow){var t=this.window.width+e.adjustToWindow.width;!1===e.scale9?this.titleBg.setScale(t/this.titleBg.width):this.titleBg.setContentSize2(t,this.titleBg.getContentSize().height),!this.closeButton||this.closeButton instanceof BandButton||!e.adjustToWindow.closeButtonOffset||this.closeButton.setPositionRound(this.titleBg.x+this.titleBg.width*this.titleBg.scaleX/2-this.closeButton.width/2+e.adjustToWindow.closeButtonOffset.x,this.titleBg.y+e.adjustToWindow.closeButtonOffset.y),this.helpButton&&e.adjustToWindow.helpButtonOffset&&this.helpButton.setPositionRound(this.titleBg.x-this.titleBg.width*this.titleBg.scaleX/2+this.helpButton.width/2+e.adjustToWindow.helpButtonOffset.x,this.titleBg.y+e.adjustToWindow.helpButtonOffset.y)}else if(e.adjustToText){this.titleBg.setContentSize(this.window.titleText.width+e.adjustToText.width,this.titleBg.height);var s=this.window.titleText.getPosition()
;e.adjustToText.offset&&(s.x+=e.adjustToText.offset.x,s.y+=e.adjustToText.offset.y),this.titleBg.setPositionRound(s),!this.closeButton||this.closeButton instanceof BandButton||!e.adjustToText.closeButtonOffset||this.closeButton.setPositionRound(this.titleBg.x+this.titleBg.width/2-this.closeButton.width/2+e.adjustToText.closeButtonOffset.x,this.titleBg.y+e.adjustToText.closeButtonOffset.y),this.helpButton&&e.adjustToText.helpButtonOffset&&this.helpButton.setPositionRound(this.titleBg.x-this.titleBg.width/2+this.helpButton.width/2+e.adjustToText.helpButtonOffset.x,this.titleBg.y+e.adjustToText.helpButtonOffset.y)}else{t=this.window.titleText.getContentSize().width;t*=1.2;var i=this.styles.Title.bg.minWidth,n=this.styles.Title.bg.maxWidth;i&&t<i&&(t=i),n&&n<t&&(t=n),this.titleBg.scaleX=t/this.titleBg.width}this.decors&&this.decors.updateAll()}});cleverapps.styles.Window={shadow:!0,checkFitThreshold:10,maxTitleSize:{scale:.77},titleCloseButtonMargin:46,CloseButton:{offsetX:20,offsetY:20,
zOrder:1},HelpButton:{zOrder:1,x:{align:"left",dx:70},y:{align:"top",dy:-45}},BottomButton:{width:void 0,height:void 0,bottomPadding:50,padding:{x:30},marginX:30},minHeight:200,minWidth:240,contentOffset:16,windowShowUpAnimation:{name:"default",force:!1},Background:{image:bundles.windows.frames.window_bg_png,scale9:cleverapps.UI.Scale9Rect.Default,paddingX:15,paddingY:40},Title:{offset:70,zIndex:2},Border:{x:75,y:150},ShareCheckBox:{offsetBottom:15,offsetTop:-20},closeAnimation:{duration:200}},Window.prototype.onPopUpAnimationFinished=function(){},Window.prototype.popUpAnimation=function(){var e=this.chooseAnimation();e?(this.window&&this.window.stopAllActions(),e.open.call(this,this.onPopUpAnimationFinished.bind(this))):this.onPopUpAnimationFinished()},Window.prototype.stop=function(){BaseWindow.prototype.stop.apply(this),this.window&&this.window.stopAllActions()},Window.prototype.closeAnimation=function(e){cleverapps.audio.playSound(
bundles.main.urls.close_window_effect||bundles.main.urls.window_effect);var t=this.chooseAnimation();!t||0<cleverapps.windows.list.length&&!this.styles.windowShowUpAnimation.force?e():t.close.call(this,e)},Window.prototype.chooseAnimation=function(){var e=this.styles;if(e.windowShowUpAnimation&&(this.window||this instanceof Force))return this.bg||e.windowShowUpAnimation.force?WINDOW_ANIMATIONS[e.windowShowUpAnimation.name]:WINDOW_ANIMATIONS.default},Window.prototype.closeDuration=function(){return(this.styles||cleverapps.styles.Window).closeAnimation.duration},cleverapps.overrideFonts(cleverapps.styles.FONTS,{WINDOW_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.COLOR_BROWN}});var BottomButton=cleverapps.UI.Button.extend({ctor:function(e,t){var s=cleverapps.styles.Window.BottomButton;t.onClicked=function(){!1!==e.visible?t.onPressed?t.onPressed():e.close():console.log("Blocked onClick as invisible")}.bind(this),t.font=t.font||cleverapps.styles.FONTS.BUTTON_TEXT,
t.texType=t.hasOwnProperty("texType")?t.texType:s.texType,t.width=t.width||s.width,t.height=t.height||s.height,t.padding=t.padding||s.padding,this._super(t)}});cc.checkGLErrorDebug=function(e,t){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var s=cc._renderContext.getError();s||"afterCreateProgramObj"!==t||e._programObj instanceof WebGLProgram||(s="notWebGLProgram"),s&&!cc.sys.isNative&&(alert("An error occurred"),window.location.reload())}};var checkBrokenLink=function(e,t){e||0===t.length||null===e||(console.log(t),cleverapps.throwAsync("broken frame: "+e))};if(cc.Scale9Sprite.prototype.ctor=cleverapps.extendFunc(cc.Scale9Sprite.prototype.ctor,function(e){checkBrokenLink(e,arguments);var t=isVirtualLink(e)?e:e&&e.virtualFrameName;this._super.apply(this,arguments),this.virtualFrameName=t}),cc.Sprite.prototype.ctor=cleverapps.extendFunc(cc.Sprite.prototype.ctor,function(e){checkBrokenLink(e,arguments);var t,s=isVirtualLink(e)?e:e&&e.virtualFrameName
;0<arguments.length&&"string"==typeof e&&(e=t=processVirtualImage(e)),this._super.apply(this,arguments),this.virtualFrameName=s,this.spriteFrameName=t}),cc.Sprite.prototype.setSpriteFrame=cleverapps.extendFunc(cc.Sprite.prototype.setSpriteFrame,function(e){return checkBrokenLink(e,arguments),this.virtualFrameName=isVirtualLink(e)?e:e&&e.virtualFrameName,"string"==typeof(e=processVirtualImage(e))&&0===e.indexOf("#")&&(e=e.substr(1,e.length-1)),this.spriteFrameName=e&&e.spriteFrameName||e,this._super.call(this,e)}),cc.Sprite.prototype.getSpriteFrame=cleverapps.extendFunc(cc.Sprite.prototype.getSpriteFrame,function(){var e=this._super.call(this);return e&&(e.spriteFrameName=this.spriteFrameName,e.virtualFrameName=this.virtualFrameName),e}),cc.Sprite.prototype.refreshVirtualSpriteFrame=function(){this.virtualFrameName&&this.setSpriteFrame(this.virtualFrameName)},cc.Scale9Sprite.prototype.setSpriteFrame=cleverapps.extendFunc(cc.Scale9Sprite.prototype.setSpriteFrame,function(e){
return checkBrokenLink(e,arguments),this.virtualFrameName=isVirtualLink(e)?e:e&&e.virtualFrameName,this.spriteFrameName="string"==typeof e?e:e&&e.spriteFrameName,this._super.call(this,e)}),cc.Scale9Sprite.prototype.refreshVirtualSpriteFrame=function(){this.virtualFrameName&&this.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(this.virtualFrameName))},cc.spriteFrameCache.getSpriteFrame=cleverapps.extendFunc(cc.spriteFrameCache.getSpriteFrame,function(e){var t=isVirtualLink(s)?e:"";"string"==typeof(e=processVirtualImage(e))&&0===e.indexOf("#")&&(e=e.substr(1,e.length-1));var s=this._super.call(this,e);return s&&(s.spriteFrameName=e,s.virtualFrameName=t),s}),cleverapps.styles.FONTS.SYSTEM={type:{name:"Arial"},size:20,color:cleverapps.styles.COLORS.BLACK},cc.Node.prototype.replaceParent=function(e){this.removeFromParent(!1),e.addChild(this)},cc.Node.prototype.adjustScaleTo=function(e){for(var t=1;e;)t/=e.scale,e=e.parent;for(var s=this;s;)t*=s.scale,s=s.parent;return t},
cc.Node.prototype.replaceParentSamePlace=function(e,t){t&&t.keepScale&&this.setScale(this.adjustScaleTo(e));var s=e.convertToNodeSpace(this.parent.convertToWorldSpace(this.getPosition()));this.replaceParent(e),this.setPosition(s)},cc.Node.prototype.debugGetName=function(){var s=this.constructor,i="[unknown]";return[window,cc,ccui,cleverapps,cleverapps.UI,sp,levels].forEach(function(e){for(var t in e)if(e[t]===s){i=t;break}}),i},cc.Node.prototype.debugParents=function(){for(var e=[],t=this;t;)e.push(t.debugGetName()),t=t.parent;console.log("window.debug -> "+e.join("->"))},cc.Node.prototype.debugBorder=function(e){window.debug=this,e=e||{},(selectedNode=this).debugBorderDx=this.debugBorderDx||0,this.debugBorderDy=this.debugBorderDy||0;var n=function(e){return+e.toFixed(2)},t=function(e){var t=this.getBoundingBox();return[n(t.width)+"x"+n(t.height)+" ("+this.width+"x"+this.height+")","scale: "+this.scaleX+" x "+this.scaleY,"pos: "+this.x+" x "+this.y,
"offset: "+this.debugBorderDx+" x "+this.debugBorderDy,"rotation "+this.rotation].join(e)}.bind(this);"object"==typeof selectedNode&&"function"==typeof selectedNode.unselect&&selectedNode!==this&&selectedNode.unselect();var s=function(e,t){var s=0<=e?1:-1,i=n(Math.abs(e)+t);return i<=0?e:i*s},i=function(){console.log(t("\t")),this.labelSavedPtr&&e.showPosition&&this.labelSavedPtr.setString(t("\n"))}.bind(this);if(this.debugBorderKeyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(e){if(-1!==[cc.KEY.up,cc.KEY.down,cc.KEY.right,cc.KEY.left].indexOf(e)){if(window.keyboardAnchorsMode){switch(e){case cc.KEY.left:this.anchorX-=.01,this.debugBorderDx-=.01;break;case cc.KEY.right:this.anchorX+=.01,this.debugBorderDx-=.01;break;case cc.KEY.down:this.anchorY-=.01,this.debugBorderDy-=.01;break;case cc.KEY.up:this.anchorY+=.01,this.debugBorderDy-=.01}console.log("anchors: "+Math.floor(100*this.anchorX)/100+" x "+Math.floor(100*this.anchorY
)/100+"\toffsets: "+Math.floor(100*this.debugBorderDx)/100+" x "+Math.floor(100*this.debugBorderDy)/100)}else if(cleverapps.keyboardController.isPressed(cc.KEY.r)){switch(e){case cc.KEY.down:case cc.KEY.left:--this.rotation;break;case cc.KEY.up:case cc.KEY.right:++this.rotation}i()}else if(cleverapps.keyboardController.isPressed(cc.KEY.s)){switch(e){case cc.KEY.up:this.scaleX=s(this.scaleX,.05),this.scaleY=s(this.scaleY,.05);break;case cc.KEY.down:this.scaleX=s(this.scaleX,-.05),this.scaleY=s(this.scaleY,-.05)}i()}else{var t=cleverapps.keyboardController.isPressed(cc.KEY.shift)?10:1;switch(e){case cc.KEY.left:this.x-=t,this.debugBorderDx-=t;break;case cc.KEY.right:this.x+=t,this.debugBorderDx+=t;break;case cc.KEY.down:this.y-=t,this.debugBorderDy-=t;break;case cc.KEY.up:this.y+=t,this.debugBorderDy+=t}i()}this.onArrowPressed&&this.onArrowPressed(e)}}.bind(this)}),cc.eventManager.addListener(this.debugBorderKeyboardListener,this),!this.spriteSavedPtr){
var o=cleverapps.UI.createScale9Sprite(bundles.dev_resources.frames.border,cleverapps.UI.Scale9Rect.TwoPixelY);o.setAnchorPoint2(0,0),o.setContentSize(this.getContentSize()),this.spriteSavedPtr=o;var r=[new cc.Color(255,0,0,255),new cc.Color(255,0,255,0),new cc.Color(255,255,0,0)];o.setColor(cleverapps.Random.choose(r,this.debugGetName().length)),this.addChild(o),o.setLocalZOrder(10)}if(!this.labelSavedPtr){var a;a=e.labelText?e.labelText:e.showZOrder?this.getLocalZOrder():e.showPosition?t("\n"):this.getContentSize().width+" x "+this.getContentSize().height+" "+this.debugGetName();var c=cleverapps.UI.generateTTFText(a,cleverapps.styles.FONTS.SYSTEM);c.setAnchorPoint2(0,0),c.setPosition(0,this.getContentSize().height),(this.labelSavedPtr=c)._super_setString=c.setString,c.setString=function(){c._super_setString.apply(c,arguments),c.setScaleX(Math.abs(c.scaleX)*this.scaleX<0?-1:1),c.setScaleY(Math.abs(c.scaleY)*this.scaleY<0?-1:1)}.bind(this),c.setScaleX(Math.abs(c.scaleX
)*this.scaleX<0?-1:1),c.setScaleY(Math.abs(c.scaleY)*this.scaleY<0?-1:1),this.addChild(c),c.setLocalZOrder(10)}e.noResLinks||this.showUnpackedRes()},cc.Node.prototype.runForAllChildren=function(t,s){var i=0,n=function(e){i++,e.getChildrenCount()&&e.getChildren().forEach(function(e){t(e),(!s.depth||i<s.depth)&&n(e)})};(s=s||{}).selfRun&&t(this),n(this)},cc.Node.prototype.showUnpackedRes=function(){if("undefined"!=typeof unpackedMap){var r=0,a=function(e){if(e.getChildrenCount()&&r++<10&&e.getChildren().forEach(function(e){a(e)}),e.constructor===cc.Sprite||e.constructor===cc.Scale9Sprite){var t=processVirtualImage(e.spriteFrameName);if(t)if("#"!==t[0]&&(t="#"+t),n=unpackedMap[t]){var s=n.indexOf("/"),i="https://github.com/rvvslv/"+n.substring(0,s)+"/tree/master"+n.substring(s);console.log(e.spriteFrameName+"\n"+i)}}if(e.constructor===sp.SkeletonAnimation){var n,o=processVirtualJson(e.jsonName);if(o)if(n=unpackedMap[o]){s=n.indexOf("/"),i="https://github.com/rvvslv/"+n.substring(0,s
)+"/tree/master"+n.substring(s,n.lastIndexOf("/"));console.log(e.jsonName.substring(0,e.jsonName.lastIndexOf("-"))+".json\n"+i)}}};a(this)}},cc.Node.prototype.cleanupBorder=function(){this.spriteSavedPtr&&(this.spriteSavedPtr.removeFromParent(),delete this.spriteSavedPtr),this.labelSavedPtr&&(this.labelSavedPtr.removeFromParent(),delete this.labelSavedPtr),cc.eventManager.removeListener(this.debugBorderKeyboardListener),"object"==typeof selectedNode&&selectedNode===this&&(selectedNode=void 0),window.debug===this&&(window.debug=void 0)},cc.Node.prototype.isRunningSafe=function(){return this.runningSafe&&this.isRunning()},cc.Node.listener=function(e){return function(){if(!this.stopListeners)return e.apply(this,arguments)}},cc.Node.prototype.createListener=function(e){var t=this;return this.registerCleanupCallback(function(){e=t=void 0}),function(){if(e&&t&&!t.stopListeners)return e.apply(t,arguments)}},cc.Node.prototype.cleanableValue=function(e){if(!e)return e;var t={value:e}
;return this.registerCleanupCallback(function(){delete t.value}),t},cc.Node.prototype.hasTouch=function(e){if(!this.visible)return!1;var t=this.convertTouchToNodeSpace(e);return cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)},cc.Node.prototype.createListener_onExitTransitionDidStart=cc.Node.prototype.onExitTransitionDidStart,cc.Node.prototype.onExitTransitionDidStart=function(){this.stopListeners=!0,this.runningSafe=!1,this._cropContainerDirty=!0,this.createListener_onExitTransitionDidStart()},cc.Node.RegisterShowAffected=function(e){},cleverapps.config.debugMode&&!cc.sys.isNative){var showDrawCalls=void 0;cc.Node.prototype.showDrawCall=function(e){void 0!==showDrawCalls&&((showDrawCalls[this.__instanceId]=this).numberOfDraw=cc.g_NumberOfDraws,this.drawStack=(new Error).stack,this.drawInfo=JSON.stringify(e))};var analyzeDrawCalls=function(){cleverapps.values(showDrawCalls).sort(function(e,t){return e.numberOfDraw-t.numberOfDraw}).forEach(function(e){e.debugBorder({
labelText:e.numberOfDraw,noResLinks:!0});var t=e.numberOfDraw+" "+e.debugGetName();e instanceof cc.LabelTTF&&(t+=" "+e.getString()),"string"==typeof e.spriteFrameName&&(t+=" "+e.spriteFrameName),"string"==typeof e.jsonName&&(t+=" "+e.jsonName),e.drawInfo&&(t+=" drawInfo - "+e.drawInfo,delete e.drawInfo),"SkeletonAnimation"===e.debugGetName()&&(t+=" stack - "+e.drawStack),console.log(t)}),console.log(Object.keys(showDrawCalls).length+" draw calls"),console.log(cc.g_NumberOfVertexes+" vertexes")};cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.KEYBOARD,isTextsVisible:!0,onKeyPressed:function(e){var t=cleverapps.keyboardController.isPressed(cc.KEY.ctrl);t&&e===cc.KEY.q?void 0===showDrawCalls?(showDrawCalls={},setTimeout(analyzeDrawCalls,100)):(cleverapps.values(showDrawCalls).forEach(function(e){e.cleanupBorder()}),showDrawCalls=void 0):t&&e===cc.KEY.y?(this.isTextsVisible?$(cc.LabelTTF).filter(function(e){return cc.rectIntersectsRect(e.getBoundingBoxToWorld(),
cc.director.getRunningScene().getBoundingBox())}).hide():$(cc.LabelTTF).show(),this.isTextsVisible=!this.isTextsVisible):e===cc.KEY.Delete&&(window.debug&&window.debug.onDeletePressed?window.debug.onDeletePressed():window.debug&&window.debug.removeFromParent&&(window.debug.removeFromParent(),window.debug=void 0))}}),2);var matchedDebugNodes=[];cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,processTouch:function(t){if(t&&t.visible&&!("undefined"!=typeof EditorScene&&t instanceof EditorScene)&&(t.hasTouch(this.touch)&&!this.excluded.some(function(e){return t instanceof e})&&(this.matchedNode=t,this.preferred.some(function(e){return t instanceof e})&&(this.preferredNode=t)),t.children))for(var e=0;e<t.children.length&&!this.preferredNode;e++)this.processTouch(t.children[e])},onTouchBegan:function(e){if(!cleverapps.config.wysiwygMode){var t=cleverapps.keyboardController.isPressed(cc.KEY.ctrl),
s=cleverapps.keyboardController.isPressed(cc.KEY.shift),i=cleverapps.keyboardController.isPressed(cc.KEY.c),n=cleverapps.keyboardController.isPressed(cc.KEY.a);return this.matchedNode=void 0,this.preferredNode=void 0,this.touch=e,this.excluded=[SideBarView,cleverapps.UI.ScrollView,cleverapps.UI.ScrollBarContainer],void 0!==CenterHint&&this.excluded.push(CenterHint),"undefined"!=typeof KeypadView&&this.excluded.push(KeypadView),void 0!==FireworksAnimation&&this.excluded.push(FireworksAnimation),void 0!==MergeTutorialView&&this.excluded.push(MergeTutorialView),n||this.excluded.push(cleverapps.Spine,sp.SkeletonAnimation),this.preferred=[],void 0!==UnitView&&this.preferred.push(UnitView),i?(this.processTouch(cc.director.getRunningScene()),!!(this.matchedNode&&void 0!==UnitView&&this.matchedNode instanceof UnitView)&&(Game.currentGame.addUnits(new Unit(this.matchedNode.unit)),!0)):(t||s)&&(t&&(matchedDebugNodes.forEach(function(e){e.cleanupBorder()}),matchedDebugNodes=[]),this.processTouch(
cc.director.getRunningScene()),this.matchedNode)?(this.matchedNode.debugParents(),this.matchedNode.debugBorder({showPosition:!0}),matchedDebugNodes.push(this.matchedNode),!0):(matchedDebugNodes.length&&(matchedDebugNodes.forEach(function(e){e.cleanupBorder()}),matchedDebugNodes=[]),!1)}}}),-100)}cc.Node.prototype.createListener_onEnterTransitionDidFinish=cc.Node.prototype.onEnterTransitionDidFinish,cc.Node.prototype.onEnterTransitionDidFinish=function(){this.stopListeners=!1,this.runningSafe=!0,cc.Node.prototype.createListener_onEnterTransitionDidFinish.apply(this,arguments),"function"!=typeof this.listNodeBundles||this.nodeBundles||(this.nodeBundles=this.listNodeBundles()||[],cleverapps.bundleLoader.loadBundles(this.nodeBundles)),cc.Node.RegisterShowAffected(this)},cc.Node.prototype.createListener_cleanup=cc.Node.prototype.cleanup,cc.Node.prototype.cleanup=function(){this.stopListeners=!0,this.runningSafe=!1,this.runCleanupCallbacks(),this.createListener_cleanup(),this.nodeBundles&&(
cleverapps.bundleLoader.deleteBundles(this.nodeBundles),delete this.nodeBundles)},cc.Node.prototype.registerTarget=function(e,t){(e[t=t||"target"]=this).registerCleanupCallback(function(){this===e[t]&&delete e[t]}.bind(this))},cc.Node.prototype.registerCleanupCallback=function(e){this.cleanupCallbacks||(this.cleanupCallbacks=[]),this.cleanupCallbacks.push(e)},cc.Node.prototype.runCleanupCallbacks=function(){(this.cleanupCallbacks||[]).forEach(function(e){e()}),this.cleanupCallbacks=[]};var oldAddChild=cc.Node.prototype.addChild;if(cc.Node.prototype.addChild=function(e){oldAddChild.apply(this,arguments),e.alignment&&e.setPositionRound(e.alignment),e.hideHandler&&e.hideHandler.initialize()},cc.Node.prototype.calculatePositionRound=function(e,t){if(Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),void 0===t&&(t=e.y,e=e.x),"object"==typeof e||"object"==typeof t){if(!this.parent)return cc.p(e,t);var s=this.parent.getContentSize();"object"==typeof e&&(e=this.calculateCoordinate(e,"x",
s.width)),"object"==typeof t&&(t=this.calculateCoordinate(t,"y",s.height))}return cc.p(Math.floor(e),Math.floor(t))},cc.Node.prototype.setPositionRound=function(e,t){var s=this.calculatePositionRound(e,t);"object"!=typeof s.x&&"object"!=typeof s.y||this.parent?this.setPosition(s.x,s.y):this.alignment=s},cc.Node.prototype.calculateCoordinate=function(t,e,s){if(t.random){var i=void 0!==t.random.start?t.random.start:0,n=void 0!==t.random.end?t.random.end:s;return Math.round(Math.random()*(n-i)+i)}var o="x"===e?this.getAnchorPoint().x:this.getAnchorPoint().y,r="x"===e?"dx":"dy",a=0;Object.keys(t).forEach(function(e){0===e.indexOf(r)&&(a+=t[e])});var c="x"===e?this.width*Math.abs(this.scaleX):this.height*Math.abs(this.scaleY);switch(t.align||"center"){case"left":case"bottom":a+=Math.abs(o)<.1?0:Math.abs(o-1)<.1?c:c/2,"center"===t.anchor&&(a-=c/2);break;case"center":a+=s/2+(Math.abs(o)<.1?-c/2:Math.abs(o-1)<.1?c/2:0);break;case"right":case"top":a+=s+(Math.abs(o)<.1?-c:Math.abs(o-1)<.1?0:-c/2
),"center"===t.anchor&&(a+=c/2)}return a},cc.Node.prototype.getRelativeCoordinates=function(e){var t=e.hideHandler&&e.hideHandler.originalPosition||e.originalPosition||e.getPosition();return this.getParent().convertToNodeSpace(e.getParent().convertToWorldSpace(t))},cc.Node.prototype.setAnchorPoint2=function(e,t){void 0===e&&(e=.5),void 0===t&&(t=.5),0<this.width&&(e=Math.round(this.width*e)/this.width),0<this.height&&(t=Math.round(this.height*t)/this.height),this.setAnchorPoint(e,t)},cc.Node.prototype.setContentSize2=function(e,t){Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),void 0===t&&(t=e.height,e=e.width),this.setContentSize(2*Math.round(e/2),2*Math.round(t/2))},cc.Node.prototype.setScale2=function(e){Array.isArray(e)&&(e=e[cleverapps.wideMode.mode]),this.setScale(e)},cc.Node.prototype.isDisplayed=function(){for(var e=this;e;){if(!e.isVisible())return!1;e=e.getParent()}return!0},cc.Node.prototype.setVisibleAsync=function(e,t){"function"!=typeof(t=t||this).setVisible&&(t=this),
this.runAction(new cc.CallFunc(function(){t.setVisible(e)}))},cc.Node.prototype.runAsync=function(e){this.runAction(new cc.CallFunc(e))},cc.Node.prototype.getCenterPos=function(){var e=this.getBoundingBox();return e.x+=e.width/2,e.y+=e.height/2,{x:Math.round(e.x),y:Math.round(e.y)}},cc.Sprite.prototype.setSpriteFrameAsync=function(e){this.runAction(new cc.CallFunc(function(){this.setSpriteFrame(e)}.bind(this)))},cc.pRound=function(e,t){return void 0===t&&(t=e.y,e=e.x),"number"==typeof e&&(e=Math.floor(e)),"number"==typeof t&&(t=Math.floor(t)),cc.p(e,t)},cc.sizeRound=function(e,t){return void 0===t&&(t=e.height,e=e.width),cc.size(e,t)},cc.size2=function(e,t){return void 0===t&&(t=e.height,e=e.width),cc.size(2*Math.round(e/2),2*Math.round(t/2))},cc.Node.prototype.applyStyles=function(e){var t=new cc.Node;return e.size&&t.setContentSize2(e.size),this.setPositionRound(t.width/2,t.height/2),t.addChild(this),t},cc.Node.superClassCreateFunction=function(t){function e(e){
return cleverapps.gameSceneLogs.push("arguments in superClassCreateFunction arg0: "+!!e[0]+" arg1: "+!!e[1]+" argsLength: "+e.length),t.apply(this,e)}return e.prototype=t.prototype,function(){return new e(arguments)}},cc.Node.prototype.getBoundingBox=function(){var e=this.scaleX,t=this.scaleY,s=this.baseScaleX||this.baseScale||e,i=this.baseScaleY||this.baseScale||t,n=e!==s||t!==i;n&&this.setScale(s,i);var o=cc.rect(0,0,this._contentSize.width,this._contentSize.height),r=cc._rectApplyAffineTransformIn(o,this.getNodeToParentTransform());return n&&this.setScale(e,t),r},cc.Node.prototype.getGlobalBoundingBox=function(e,t){e||(e=this.getBoundingBox(),this.originalPosition&&(e.x+=this.originalPosition.x-this.x,e.y+=this.originalPosition.y-this.y)),t=t||this.getParent();var s=cc.director.getRunningScene().scene.convertToNodeSpace(t.convertToWorldSpace(cc.p(e.x,e.y)));return e.x=s.x,e.y=s.y,e},cc.Node.prototype.setOverShadow=function(e){this.overShadow!==e&&(this.overShadow=e,
this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0,this.overShadow?this.visit=cc.Node.prototype.visitAfterShadow:this.visit=cc.Node.prototype.visit,this.setListenersOverShadow(e))},cc.Node.prototype.setListenersOverShadow=function(e){this.listenersOverShadow!==e&&(this.listenersOverShadow=e,cc.eventManager._setDirty(cc.EventListener.TOUCH_ONE_BY_ONE,cc.eventManager.DIRTY_SCENE_GRAPH_PRIORITY),cc.eventManager._setDirty(cc.EventListener.MOUSE,cc.eventManager.DIRTY_SCENE_GRAPH_PRIORITY),cc.eventManager._setDirty(cc.EventListener.TOUCH_ALL_AT_ONCE,cc.eventManager.DIRTY_SCENE_GRAPH_PRIORITY))},cc.Node.prototype.visitAfterShadow=function(e){var t=cc.director.getRunningScene(),s=this,i=arguments,n=function(){cc.Node.prototype.visit.apply(s,i)};if(t.afterVisitShadowProcessing||!e)n();else{var o=e._renderCmd,r=o._dirtyFlag;t.shadowVisitQueue.push(function(){var e=o._dirtyFlag;o._dirtyFlag=r,n(),o._dirtyFlag=e})}},
cc.Node.prototype.getCropContainer=function(){if(!1===this._cropContainerDirty)return this.cropContainer;for(var e=this;e&&!(e instanceof cleverapps.UI.ScrollView);)e=e.parent;return this._cropContainerDirty=!1,this.cropContainer=e,this.cropContainer},cc.Node.prototype.setCascadeOpacityEnabledRecursively=function(t){this.performRecursive(function(e){e.setCascadeOpacityEnabled(t)})},cc.Node.prototype.setRecCascadeColorEnabled=function(){this.performRecursive(function(e){e.setCascadeColorEnabled(!0)})},cc.Node.prototype.performRecursive=function(e){for(var t=[this];0<t.length;){var s=t.pop();e(s),t=t.concat(s.children)}},cc.sys.isNative&&config.debugMode&&!cc.sys.isWebView&&(Function.prototype.debugBindSuper=Function.prototype.bind,Function.prototype.bind=function(e){if("object"!=typeof this.prototype)throw console.log("Function.this.prototype - is not an object",JSON.stringify((new Error).stack)),new TypeError("Function.this.prototype - is not an object")
;return Function.prototype.debugBindSuper.apply(this,arguments)}),config.debugMode)var previewRes=function(s){var e=(s=processVirtualImage(s)||processVirtualJson(s)).split(".").slice(-1)[0],i=function(e){var t=cc.director.getRunningScene();t.addChild(e),e.setPositionRound(t.width/2,t.height/2)};if("json"===e){var t=function(){var e=new cleverapps.Spine(s),t=Object.keys(e.data.animations);e.setAnimation(0,t[0],!0),e.setSkin(cleverapps.Spine.getSkins(s)[0]||"default"),e.debugBorder(),i(e),console.log(t)};cleverapps.Spine.isAnimationLoaded(s)?t():cleverapps.bundleLoader.loadBundle(cleverapps.Spine.listBundles(s),{onSuccess:t})}else"png"!==e&&"jpg"!==e||i(cleverapps.UI.createScale9Sprite(s))},checkFonts=function(e){for(var t=[],s=15;s<90;s+=5){var i={name:e||"default",size:s||40,fnt:!0},n=cleverapps.UI.generateOnlyText("Some",i),o=cleverapps.UI.generateTTFText("1235",i),r=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:5});t.unshift(r)}var a=new cleverapps.Layout(t,{
direction:cleverapps.UI.VERTICAL,margin:5});cc.director.getRunningScene().addChild(a),a.setPositionRound(cleverapps.UI.getSceneSize().width/2,cleverapps.UI.getSceneSize().height/2)};cc.CallFunc.prototype.initWithFunctionSuper=cc.CallFunc.prototype.initWithFunction,cc.CallFunc.prototype.initWithFunction=function(e,t,s){var i=this.initWithFunctionSuper.apply(this,arguments);return this._function&&!this._function.call&&cleverapps.throwAsync("no call method on CallFunc function"),i},cc.ACTION_TAG_SHOW=10,cc.ACTION_TAG_HIDE=11,cc.ACTION_TAG_PLAYERS_WARNING=13,cleverapps.Particles=cc.ParticleSystem.extend({ctor:function(e,t){var s=cc.loader.getRes(processVirtualJson(e));s.textureFileName=t,this._super(s)},stop:function(e){e=e||function(){},delete this.target,this.setAutoRemoveOnFinish(!0),this.stopSystem(),this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(e),new cc.RemoveSelf))},followTarget:function(e){this.setPositionType(cc.ParticleSystem.TYPE_RELATIVE),this.target=e,
this.updateRelativePosition(),e.registerCleanupCallback(function(){this.target===e&&this.stop()}.bind(this))},updateRelativePosition:function(){if(this.target&&this.getParent()&&this.target.getParent()){var e=this.getRelativeCoordinates(this.target);this.setPositionRound(e)}},update:function(e){this.updateRelativePosition(),this._super(e)}}),cleverapps.Spine=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint2(),e=cleverapps.skins.getSlot("spine",{json:e}),e=processVirtualJson(e);var s=cleverapps.Spine.jsonToBundle[e];if(!cleverapps.bundleLoader.isLoaded(s)&&"loading_scene"!==s&&e&&s&&cleverapps.throwAsync("Json "+e+" bundle "+s+" not loaded"),void 0===s)throw console.log("json bundles cache",cleverapps.Spine.jsonToBundle),"Can't find bundle for json - "+e+" in bundles cache ";this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),cc.loader.getRes(bundles[s].jsons.atlas)||cleverapps.throwAsync("Atlas "+e+" bundle "+s+" not loaded");var i=e,
n=bundles[s].jsons.atlas;t=t||1,cleverapps.Spine.cache[e]&&cleverapps.Spine.cache[e][t]&&(i=cleverapps.Spine.cache[e][t].data,n=cleverapps.Spine.cache[e][t].atlas);var o=this.spine=sp.SkeletonAnimation.createWithJsonFile(i,n,t);for(var r in cleverapps.styles.SpineSkins)if(cleverapps.styles.SpineSkins[r].json===e){o.setSkin(cleverapps.styles.SpineSkins[r].skin);break}o.jsonName=e,cleverapps.Spine.cache[e]||(cleverapps.Spine.cache[e]={}),cleverapps.Spine.cache[e][t]||(cleverapps.Spine.cache[e][t]={data:o._skeletonData,atlas:!0}),this.data=cc.loader.getRes(e);var a=this.data.skeleton;this.setContentSize2(a.width*resolutionScale,a.height*resolutionScale),o.setPositionRound(this.width/2,this.height/2),this.addChild(o),this.runningAnimation=void 0,this.setVisible(!1),this.startVisibleListener=function(){},cleverapps.Spine.debugSlots&&this.setDebugSlots(!0),cleverapps.Spine.debugBones&&this.setDebugBones(!0)},setStartVisibleListener:function(e){this.startVisibleListener=e},setIdle:function(e
){this.idle=e,void 0===this.runningAnimation&&this.setAnimation(0,this.idle,!0)},setIdleSet:function(s){var i=0;cleverapps.values(s).forEach(function(e){i+=e});var e=function(){var e=Math.random()*i;for(var t in s)if((e-=s[t])<=0)return t};this.setAnimation(0,e(),!1),this.setCompleteListener(function(){this.setAnimation(0,e(),!1)}.bind(this))},setAnimation:function(e,t,s){this.spine.setAnimation(e,t,s);var i=this.spine.jsonName;if(!this.data.animations[t]){var n=(new Error).stack;setTimeout(function(){throw"Not found animation "+t+" in json "+i+" .. "+n},0)}this.visible||(this.visible=!0,this.startVisibleListener())},addAnimation:function(e,t,s,i){this.spine.addAnimation(e,t,s,i)},findAnimation:function(e){return this.spine.findAnimation(e)},setTimeScale:function(e){this.spine.setTimeScale(e)},getTimeScale:function(){return this.spine.getTimeScale()},clearTrack:function(e){this.spine.clearTrack(e)},setSkin:function(e){this.spine.setSkin(e)},setStartListener:function(e){
this.spine.setStartListener(e)},setCompleteListener:function(e){this.spine.setCompleteListener(e)},setCompleteListenerRemove:function(e){this.setCompleteListener(function(){e&&e(),this.runAction(new cc.RemoveSelf)}.bind(this))},setCompleteListenerOnce:function(e){this.setCompleteListener(function(){e(),this.setCompleteListener(function(){})}.bind(this))},setAnimationAndIdleAfter:function(e,t){this.setAnimation(0,e,!1),this.addAnimation(0,t,!0)},setDebugSlots:function(e){this.spine.setDebugSolots(e)},setDebugBones:function(e){this.spine.setDebugBones(e)},rotateMesh:function(t){this.setRotation(-t),this.runForAllChildren(function(e){e===this.spine?this.spine._skeleton.getRootBone().rotation=-t:e.setRotation(t)}.bind(this),{depth:1})}}),cleverapps.Spine.updateSkin=function(e,t,s){t=processVirtualJson(t),cleverapps.styles.SpineSkins[e]={json:t,skin:s}},cleverapps.Spine.hasAnimation=function(e,t){var s=cleverapps.Spine.getSkeletonData(t);return s&&s.animations&&void 0!==s.animations[e]},
cleverapps.Spine.getSkins=function(e){var t=cleverapps.Spine.getSkeletonData(e);return Object.keys(t.skins).filter(function(e){return"default"!==e})},cleverapps.Spine.getSkeletonData=function(e){return cc.loader.getRes(processVirtualJson(e))},cleverapps.Spine.isAnimationLoaded=function(e){return e=processVirtualJson(e),e=cleverapps.skins.getSlot("spine",{json:e}),cleverapps.bundleLoader.isLoaded(cleverapps.Spine.jsonToBundle[e])},cleverapps.Spine.prepare=function(){var e={};for(var t in bundles){var s=bundles[t];if(!s.injectTo&&(0!==t.indexOf("episode_")||1!==Object.keys(s.jsons).length||!s.jsons.levels))for(var i in s.jsons){var n=s.jsons[i],o=t;if(0===i.indexOf("island_")&&0===t.indexOf("episode_")&&(o="episodes_resources"),e[n]&&e[n]!==o)throw"Already exist json: "+n;e[n]=o}}cleverapps.Spine.jsonToBundle=e},cleverapps.Spine.listBundles=function(t){Array.isArray(t)||(t=[t]);var s=[];return t.forEach(function(e){t&&cleverapps.Spine.jsonToBundle[e]&&s.push(
cleverapps.Spine.jsonToBundle[e])}),cleverapps.unique(s)},cleverapps.Spine.removeSlot=function(e,t){e=processVirtualJson(e),e=cleverapps.skins.getSlot("spine",{json:e}),(e=cc.loader.getRes(e)).slots=e.slots.filter(function(e){return e.name!==t}),cleverapps.values(e.skins).forEach(function(e){delete e[t]}),cleverapps.values(e.animations).forEach(function(e){delete e.slots[t]})},cleverapps.Spine.cache={};var ShadowLayer=cc.LayerColor.extend({ctor:function(){var e=this.baseSize=cc.director.getWinSize();this._super(cleverapps.styles.COLORS.BLACK,1.05*e.width+5,1.05*e.height+5),this.setAnchorPoint2(0,0),this.setPosition(.025*-e.width-2,.025*-e.height-2),cleverapps.eventBus.on("changeSceneSize",this.onChangeSize.bind(this),this)},onChangeSize:function(){var e=cc.director.getWinSize(),t=Math.max(e.width/this.baseSize.width,this.baseSize.width/e.width),s=Math.max(e.height/this.baseSize.height,this.baseSize.height/e.height);this.setScale(t*s)},visit:function(e){if(this._super.apply(this,
arguments),this.isVisible()){var t=cc.director.getRunningScene();t&&t.afterVisitShadow&&t.afterVisitShadow()}}});cc.eventManager._sortEventListenersOfSceneGraphPriorityDes=function(e,t){var s=cc.eventManager._nodePriorityMap,i=e._getSceneGraphPriority(),n=t._getSceneGraphPriority();if(!(t&&n&&s[n.__instanceId]))return-1;if(!e||!i||!s[i.__instanceId])return 1;var o=s[t._getSceneGraphPriority().__instanceId]-s[e._getSceneGraphPriority().__instanceId];return 0===o?e.__instanceId-t.__instanceId:o},cc.eventManager._visitTarget_processRoot=function(){var e=this._globalZOrderNodeMap,t=[];for(var s in e)t.push(s);t.sort(this._sortNumberAsc);var n,o,r=t.length,a=this._nodePriorityMap;for(i=0;i<r;i++)for(n=e[t[i]],o=0;o<n.length;o++)a[n[o]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}},cc.eventManager._visitTargetSuper=cc.eventManager._visitTarget,cc.eventManager._visitTarget=function(t,e){e&&(this.shadowVisitQueue=[]);var s=function(){this.visitQueueProcessing=!0
;var e=this.shadowVisitQueue;this.shadowVisitQueue=[],e.forEach(cleverapps.callFunc),this.visitQueueProcessing=!1}.bind(this);if(!t.overShadow||this.visitQueueProcessing){if(t.listenersOverShadow&&!this.visitQueueProcessing){var i=this._globalZOrderNodeMap;this.shadowVisitQueue.push(function(){var e=i[t.getGlobalZOrder()].indexOf(t.__instanceId);-1!==e&&i[t.getGlobalZOrder()].splice(e,1),i[t.getGlobalZOrder()].push(t.__instanceId)})}cc.eventManager._visitTargetSuper.apply(this,arguments),t instanceof ShadowLayer&&t.visible&&s(),e&&0<this.shadowVisitQueue.length&&(s(),this._visitTarget_processRoot())}else{var n=this,o=arguments;this.shadowVisitQueue.push(function(){cc.eventManager._visitTargetSuper.apply(n,o)})}},cc.game.pause=cleverapps.extendFunc(cc.game.pause,function(){this.isPaused()||(this._super.apply(this,arguments),cleverapps.eventBus.trigger("gamePause"))}),cc.game.resume=cleverapps.extendFunc(cc.game.resume,function(){this.isPaused()&&(this._super.apply(this,arguments),
cleverapps.eventBus.trigger("gameResume"))}),cc.game.resumeNative=function(){this.config?this.isPaused()&&this.resume():setTimeout(this.resumeNative.bind(this),1e3)},function(){var e=function(){cleverapps.newSceneStack=cleverapps.newSceneStack||(new Error).stack,this._super.apply(this,arguments)};cc.Director.prototype.runScene=cleverapps.extendFunc(cc.Director.prototype.runScene,e),cc.Director.prototype.popToSceneStackLevel=cleverapps.extendFunc(cc.Director.prototype.popToSceneStackLevel,e),cc.Director.prototype.pushScene=cleverapps.extendFunc(cc.Director.prototype.pushScene,e),cc.Director.prototype.popScene=cleverapps.extendFunc(cc.Director.prototype.popScene,e)}(),cc.getCenter=function(e){if(e&&0!==e.length){var t=0,s=0;return e.forEach(function(e){t+=e.x,s+=e.y}),cc.p(t/e.length,s/e.length)}},cc.getCenterPoint=function(e){if(e&&0!==e.length){var t=0,s=0;e.forEach(function(e){t+=e.x,s+=e.y});var i=cc.p(t/e.length,s/e.length),n=e[0],o=cc.pDistance(n,i);return e.forEach(function(e){
var t=cc.pDistance(e,i);t<o&&(n=e,o=t)}),n}},cc.getDistanceChebyshev=function(e,t){return Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))},cc.rectScale=function(e,t){return cc.rect(e.x+e.width/2*(1-t),e.y+e.height/2*(1-t),e.width*t,e.height*t)};var UIScrollBarFix=function(){var e=function(e,t){var s=new Image;s.src=e,setTimeout(function(){cc.textureCache.cacheImage(t,s)},0)};e(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY),e(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY)};cc.KEYBOARD_RETURNTYPE_DEFAULT=0,cc.KEYBOARD_RETURNTYPE_DONE=1,cc.KEYBOARD_RETURNTYPE_SEND=2,cc.KEYBOARD_RETURNTYPE_SEARCH=3,cc.KEYBOARD_RETURNTYPE_GO=4,cc.EDITBOX_INPUT_MODE_ANY=0,cc.EDITBOX_INPUT_MODE_EMAILADDR=1,cc.EDITBOX_INPUT_MODE_NUMERIC=2,cc.EDITBOX_INPUT_MODE_PHONENUMBER=3,cc.EDITBOX_INPUT_MODE_URL=4,cc.EDITBOX_INPUT_MODE_DECIMAL=5,cc.EDITBOX_INPUT_MODE_SINGLELINE=6,cc.EDITBOX_INPUT_FLAG_PASSWORD=0,cc.EDITBOX_INPUT_FLAG_SENSITIVE=1,
cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD=2,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE=3,cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS=4,cc.EditBoxDelegate=cc.Class.extend({editBoxEditingDidBegin:function(e){},editBoxEditingDidEnd:function(e){},editBoxTextChanged:function(e,t){},editBoxReturn:function(e){}}),cc.EditBox=cc.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:cc.EDITBOX_INPUT_MODE_ANY,_editBoxInputFlag:cc.EDITBOX_INPUT_FLAG_SENSITIVE,_keyboardReturnType:cc.KEYBOARD_RETURNTYPE_DEFAULT,_maxLength:50,_text:"",_textColor:null,_placeholderText:"",_placeholderFontName:"",_placeholderFontSize:14,_placeholderColor:null,_className:"EditBox",_touchListener:null,_touchEnabled:!0,ctor:function(e,t){cc.Node.prototype.ctor.call(this),this._anchorPoint=cc.p(.5,.5),this._textColor=cc.color.WHITE,this._placeholderColor=cc.color.GRAY,this._renderCmd._createLabels(),this.createDomElementIfNeeded(),this.initWithSizeAndBackgroundSprite(e,t),
this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchEnded:this._onTouchEnded.bind(this)}),cc.eventManager.addListener(this._touchListener,this),this.setInputFlag(this._editBoxInputFlag)},setTouchEnabled:function(e){this._touchEnabled!==e&&(this._touchEnabled=e,this._touchEnabled?cc.eventManager.addListener(this._touchListener,this):cc.eventManager.removeListener(this._touchListener))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.EditBox.CanvasRenderCmd(this):new cc.EditBox.WebGLRenderCmd(this)},setContentSize:function(e,t){void 0!==e.width&&void 0!==e.height&&(t=e.height,e=e.width),cc.Node.prototype.setContentSize.call(this,e,t),this._updateEditBoxSize(e,t)},setVisible:function(e){cc.Node.prototype.setVisible.call(this,e),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){
this._renderCmd._edTxt||this._renderCmd._createDomTextArea()},setTabIndex:function(e){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=e)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warn("The dom control is not created!"),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warn("The dom control is not created!"),!1)},stayOnTop:function(e){this._alwaysOnTop!==e&&(this._alwaysOnTop=e,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd._removeDomFromGameContainer()},_isAncestorsVisible:function(e){if(null==e)return!0;var t=e.getParent();return!(t&&!t.isVisible())&&this._isAncestorsVisible(t)},_onTouchBegan:function(e){if(this.isVisible()&&this._isAncestorsVisible(this)){var t=e.getLocation(),s=cc.rect(0,0,this._contentSize.width,this._contentSize.height)
;return!!cc.rectContainsPoint(s,this.convertToNodeSpace(t))||(this._renderCmd._endEditing(),!1)}},_onTouchEnded:function(){this.isVisible()&&this._isAncestorsVisible(this)&&this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(e,t){this._backgroundSprite&&this._backgroundSprite.setContentSize(e,t)},_updateEditBoxSize:function(e,t){var s="number"==typeof e.width?e.width:e,i="number"==typeof e.height?e.height:t;this._updateBackgroundSpriteSize(s,i),this._renderCmd.updateSize(s,i)},setLineHeight:function(e){this._renderCmd.setLineHeight(e)},setFont:function(e,t){this._renderCmd.setFont(e,t)},_setFont:function(e){this._renderCmd._setFont(e)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(e){this._renderCmd.setFontName(e)},setFontSize:function(e){this._renderCmd.setFontSize(e)},setString:function(e){e.length>=this._maxLength&&(e=e.slice(0,this._maxLength)),this._text=e,this._renderCmd.setString(e)},setFontColor:function(e){
this._textColor=e,this._renderCmd.setFontColor(e)},setMaxLength:function(e){isNaN(e)||(e<0&&(e=65535),this._maxLength=e,this._renderCmd.setMaxLength(e))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(e){null!==e&&(this._renderCmd.setPlaceHolder(e),this._placeholderText=e)},setPlaceholderFont:function(e,t){this._placeholderFontName=e,this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(e){var t=cc.LabelTTF._fontStyleRE.exec(e);t&&(this._placeholderFontName=t[2],this._placeholderFontSize=parseInt(t[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(e){this._placeholderFontName=e,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(e){this._placeholderFontSize=e,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(e){this._placeholderColor=e,this._renderCmd.setPlaceholderFontColor(e)},setInputFlag:function(e){
this._editBoxInputFlag=e,this._renderCmd.setInputFlag(e)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(e,t){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=t,this.setContentSize(e),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(e.width,e.height)),this.x=0,!(this.y=0)},setDelegate:function(e){this._delegate=e},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(e){if(this._editBoxInputMode!==e){var t=this.getString();this._editBoxInputMode=e,this._renderCmd.setInputMode(e),this._renderCmd.transform(),this.setString(t),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(e){this._keyboardReturnType=e,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(e,t){this._edWidth=e.width,
this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=e.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(t)}});var _p=cc.EditBox.prototype;_p.font,cc.defineGetterSetter(_p,"font",null,_p._setFont),_p.fontName,cc.defineGetterSetter(_p,"fontName",null,_p.setFontName),_p.fontSize,cc.defineGetterSetter(_p,"fontSize",null,_p.setFontSize),_p.fontColor,cc.defineGetterSetter(_p,"fontColor",null,_p.setFontColor),_p.string,cc.defineGetterSetter(_p,"string",_p.getString,_p.setString),_p.maxLength,cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength),_p.placeHolder,cc.defineGetterSetter(_p,"placeholder",_p.getPlaceHolder,_p.setPlaceHolder),_p.placeHolderFont,cc.defineGetterSetter(_p,"placeholderFont",null,_p._setPlaceholderFont),_p.placeHolderFontName,cc.defineGetterSetter(_p,"placeholderFontName",null,_p.setPlaceholderFontName),_p.placeHolderFontSize,cc.defineGetterSetter(_p,"placeholderFontSize",null,
_p.setPlaceholderFontSize),_p.placeHolderFontColor,cc.defineGetterSetter(_p,"placeholderFontColor",null,_p.setPlaceholderFontColor),_p.inputFlag,cc.defineGetterSetter(_p,"inputFlag",null,_p.setInputFlag),_p.delegate,cc.defineGetterSetter(_p,"delegate",null,_p.setDelegate),_p.inputMode,cc.defineGetterSetter(_p,"inputMode",null,_p.setInputMode),_p.returnType,cc.defineGetterSetter(_p,"returnType",null,_p.setReturnType),_p=null,cc.EditBox.create=function(e,t,s,i){return new cc.EditBox(e,t,s,i)},function(e){e._polyfill={zoomInvalid:!1},cc.sys.OS_ANDROID!==cc.sys.os||cc.sys.browserType!==cc.sys.BROWSER_TYPE_SOUGOU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_360||(e._polyfill.zoomInvalid=!0)}(cc.EditBox),function(v){function s(e){var t=e.convertToWorldSpace(cc.p(0,0)),s=cc.visibleRect.height,i=cc.visibleRect.width,n=.5;s<i&&(n=.7),setTimeout(function(){if(window.scrollY<40&&t.y<s*n){var e=s*n-t.y-window.scrollY;e<35&&(e=35),320<e&&(e=320),window.scrollTo(e,e)}},400)}var e=function(
){}.prototype=Object.create(Object.prototype);e.updateMatrix=function(){if(this._edTxt){var e=this._node,t=cc.view._scaleX,s=cc.view._scaleY,i=cc.view._devicePixelRatio,n=this._worldTransform;t/=i,s/=i;var o=cc.game.container,r=n.a*t,a=n.b,c=n.c,l=n.d*s,p=o&&o.style.paddingLeft&&parseInt(o.style.paddingLeft),d=o&&o.style.paddingBottom&&parseInt(o.style.paddingBottom),h=n.tx*t+p,u=n.ty*s+d;v.zoomInvalid&&(this.updateSize(e._contentSize.width*r,e._contentSize.height*l),l=r=1);var g="matrix("+r+","+-a+","+-c+","+l+","+h+","+-u+")";this._edTxt.style.transform=g,this._edTxt.style["-webkit-transform"]=g,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},e.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},e.stayOnTop=function(e){e?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",
this._showLabels())},e._beginEditingOnMobile=function(e){this.__orientationChanged=function(){s(e)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},e._endEditingOnMobile=function(){if(this.__rotateScreen){var e=cc.game.container.style;e["-webkit-transform"]="rotate(90deg)",e.transform="rotate(90deg)";var t=cc.view,s=t._originalDesignResolutionSize.width,i=t._originalDesignResolutionSize.height;0<s&&t.setDesignResolutionSize(s,i,t._resolutionPolicy),this.__rotateScreen=!1}window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},e._onFocusOnMobile=function(e){if(cc.view._isRotated){
var t=cc.game.container.style;t["-webkit-transform"]="rotate(0deg)",t.transform="rotate(0deg)",t.margin="0px",window.scrollTo(35,35),this.__rotateScreen=!0}else this.__rotateScreen=!1;s(e)},e._createDomInput=function(){this._removeDomFromGameContainer();var s=this,e=this._edTxt=document.createElement("input");return e.type="text",e.style.fontFamily=this._edFontName,e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,e.style.outline="medium",e.style.padding="0",e.style.textTransform="uppercase",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left="2px",e.style.className="cocosEditBox",this.setMaxLength(s._editBox._maxLength),e.addEventListener("input",function(){var e=s._editBox;this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength)),e._delegate&&e._delegate.editBoxTextChanged&&e._text!==this.value&&(
e._text=this.value,s._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("keypress",function(e){var t=s._editBox;e.keyCode===cc.KEY.enter&&(e.stopPropagation(),e.preventDefault(),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),t._text=this.value,s._updateDomTextCases(),s._endEditing(),t._delegate&&t._delegate.editBoxReturn&&t._delegate.editBoxReturn(t),cc._canvas.focus())}),e.addEventListener("focus",function(){var e=s._editBox;this.style.fontSize=s._edFontSize+"px",this.style.color=cc.colorToHex(e._textColor),s._hiddenLabels(),cc.sys.isMobile&&s._onFocusOnMobile(e),e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)}),e.addEventListener("blur",function(){var e=s._editBox;e._text=this.value,s._updateDomTextCases(),e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e),""===this.value&&(
this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),s._endEditing()}),this._addDomToGameContainer(),e},e._createDomTextArea=function(){this._removeDomFromGameContainer();var s=this,e=this._edTxt=document.createElement("textarea");return e.type="text",e.style.fontFamily=this._edFontName,e.style.fontSize=this._edFontSize+"px",e.style.color="#000000",e.style.border=0,e.style.background="transparent",e.style.width="100%",e.style.height="100%",e.style.active=0,e.style.outline="medium",e.style.padding="0",e.style.resize="none",e.style.textTransform="uppercase",e.style.overflow_y="scroll",e.style.display="none",e.style.position="absolute",e.style.bottom="0px",e.style.left="2px",e.style.className="cocosEditBox",this.setMaxLength(s._editBox._maxLength),e.addEventListener("input",function(){this.value.length>this.maxLength&&(this.value=this.value.slice(0,this.maxLength));var e=s._editBox
;e._delegate&&e._delegate.editBoxTextChanged&&e._text.toLowerCase()!==this.value.toLowerCase()&&(e._text=this.value,s._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),e.addEventListener("focus",function(){var e=s._editBox;s._hiddenLabels(),this.style.fontSize=s._edFontSize+"px",this.style.color=cc.colorToHex(e._textColor),cc.sys.isMobile&&s._onFocusOnMobile(e),e._delegate&&e._delegate.editBoxEditingDidBegin&&e._delegate.editBoxEditingDidBegin(e)}),e.addEventListener("keypress",function(e){var t=s._editBox;e.keyCode===cc.KEY.enter&&(e.stopPropagation(),t._delegate&&t._delegate.editBoxReturn&&t._delegate.editBoxReturn(t))}),e.addEventListener("blur",function(){var e=s._editBox;e._text=this.value,s._updateDomTextCases(),e._delegate&&e._delegate.editBoxEditingDidEnd&&e._delegate.editBoxEditingDidEnd(e),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),s._endEditing()}),this._addDomToGameContainer(),e},
e._createLabels=function(){var e=this._editBox.getContentSize();this._textLabel||(this._textLabel=new cc.LabelTTF,this._textLabel.setAnchorPoint(cc.p(0,1)),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=new cc.LabelTTF,this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(e)},e._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},e._updateLabelPosition=function(e){if(this._textLabel&&this._placeholderLabel){var t=cc.size(e.width-2,e.height);this._textLabel.setContentSize(t),this._textLabel.setDimensions(t),this._placeholderLabel.setLineHeight(e.height);var s=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===cc.EDITBOX_INPUT_MODE_ANY?(this._textLabel.setPosition(2,e.height),this._placeholderLabel.setPosition(2,e.height),
this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP)):(this._textLabel.setPosition(2,e.height),this._placeholderLabel.setPosition(2,(e.height+s.height)/2),this._placeholderLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this._textLabel.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER))}},e.setLineHeight=function(e){this._textLabel&&this._textLabel.setLineHeight(e)},e._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},e._updateDomTextCases=function(){var e,t=this._editBox._editBoxInputFlag;t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD?this._editBox._text=this._editBox._text.replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()}):t===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_SENTENCE&&(
this._editBox._text=(e=this._editBox._text).charAt(0).toUpperCase()+e.slice(1))},e._updateLabelStringStyle=function(){if("password"===this._edTxt.type){for(var e="",t=this._editBox._text.length,s=0;s<t;++s)e+="●";this._textLabel&&this._textLabel.setString(e)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},e._showLabels=function(){this._hiddenLabels(),""===this._edTxt.value?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},e._beginEditing=function(){this._editBox._alwaysOnTop||"none"===this._edTxt.style.display&&(this._edTxt.style.display="",this._edTxt.focus()),cc.sys.isMobile&&!this._editingMode&&this._beginEditingOnMobile(this._editBox),this._editingMode=!0},e._endEditing=function(){if(this._editBox._alwaysOnTop||(
this._edTxt.style.display="none"),this._showLabels(),cc.sys.isMobile&&this._editingMode){var e=this;setTimeout(function(){e._endEditingOnMobile()},400)}this._editingMode=!1},e._setFont=function(e){var t=cc.LabelTTF._fontStyleRE.exec(e),s=t[2],i=parseInt(t[1]);t&&this.setFont(s,i)},e.setFont=function(e,t){this._edFontName=e||this._edFontName,this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},e.setFontName=function(e){this._edFontName=e||this._edFontName,this._updateDOMFontStyle()},e.setFontSize=function(e){this._edFontSize=e||this._edFontSize,this._updateDOMFontStyle()},e.setFontColor=function(e){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(e)),this._textLabel&&this._textLabel.setColor(e))},e.setPlaceHolder=function(e){this._placeholderLabel.setString(e)},e.setMaxLength=function(e){this._edTxt&&(this._edTxt.maxLength=e)},e._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontName(
this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},e.setPlaceholderFontColor=function(e){this._placeholderLabel.setColor(e)},e._updateDomInputType=function(){var e=this._editBox._editBoxInputMode;e===cc.EDITBOX_INPUT_MODE_EMAILADDR?this._edTxt.type="email":e===cc.EDITBOX_INPUT_MODE_DECIMAL||e===cc.EDITBOX_INPUT_MODE_NUMERIC?this._edTxt.type="number":e===cc.EDITBOX_INPUT_MODE_PHONENUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):e===cc.EDITBOX_INPUT_MODE_URL?this._edTxt.type="url":(this._edTxt.type="text",this._editBox._keyboardReturnType===cc.KEYBOARD_RETURNTYPE_SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===cc.EDITBOX_INPUT_FLAG_PASSWORD&&(this._edTxt.type="password")},e.setInputFlag=function(e){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",
e===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":e===cc.EDITBOX_INPUT_FLAG_INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},e.setInputMode=function(e){e===cc.EDITBOX_INPUT_MODE_ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();var t=this._node.getContentSize();this.updateSize(t.width,t.height)},e.setString=function(e){this._edTxt&&null!==e&&(""===(this._edTxt.value=e)?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(
!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},e._updateDOMFontStyle=function(){this._edTxt&&(""!==this._edTxt.value&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px"),this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontName(this._edFontName)))},e.updateSize=function(e,t){var s=this._edTxt;s&&(s.style.width=e+"px",s.style.height=t+"px",this._updateLabelPosition(cc.size(e,t)))},e._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},e._removeDomFromGameContainer=function(){var e=this._edTxt;if(e){("contains"in cc.game.container?cc.game.container.contains(e):cc.game.container.compareDocumentPosition(e)%16)&&cc.game.container.removeChild(e)}this._edTxt=null},e.initializeRenderCmd=function(e){this._editBox=e,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,
this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},cc.EditBox.CanvasRenderCmd=function(e){this._rootCtor(e),this.initializeRenderCmd(e)};var t=cc.EditBox.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(e,t),t.constructor=cc.EditBox.CanvasRenderCmd,t.transform=function(e,t){this.originTransform(e,t),this.updateMatrix()},cc.EditBox.WebGLRenderCmd=function(e){this._rootCtor(e),this.initializeRenderCmd(e)};var i=cc.EditBox.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(e,i),i.constructor=cc.EditBox.WebGLRenderCmd,i.transform=function(e,t){this.originTransform(e,t),this.updateMatrix()}}(cc.EditBox._polyfill),cleverapps.Plot={decideNext:function(e){if(e.isRegular()&&!e.isCurrentLevel()&&cleverapps.metha.getType()===Metha.HOSE&&"board"!==cleverapps.config.type&&cleverapps.config.results)return Boatswain.REPLAY_INTENT;var t=e.isRegular();if((cleverapps.metha.getType(
)===Metha.KNOCKOUT||cleverapps.forces.checkMainForces())&&(t=!1),t)switch(cleverapps.metha.getType()){case Metha.FARM:cleverapps.farm.isCompleted()||cleverapps.metha.withSimpleMain()||(cleverapps.farm.getBuilding().getQuest().isCompleted()&&(t=!1),cleverapps.farm.justCollectedDialogue&&(t=!1));break;case Metha.HOMEFIX:if(!cleverapps.home.isCompleted()&&!cleverapps.metha.withSimpleMain()){var s=cleverapps.home.getFurnitureToUpgrade();if(s){var i=s.getInfo().cost;cleverapps.home.stars>=i&&cleverapps.home.stars-cleverapps.home.amountLevelStars(e)<i&&(t=!1)}}break;case Metha.SIMPLE:t=0===cleverapps.user.episode&&cleverapps.user.level<3;break;case Metha.HOSE:if(e.isCurrentLevel()&&!e.isLastLevelOnEpisode()||(t=!1),t){var n=cleverapps.Plot.getDialogueAfterLevel(e),o=e.episode.levels[e.levelNo+1];(n||o.isHard())&&(t=!1)}}return t&&cleverapps.missionManager.skipNext()&&(t=!1),t?Boatswain.NEXT_INTENT:Boatswain.EXIT_INTENT},GameLeave:function(e,t){var s=t.level,i=this.isEpisodeFinished(s
)&&cleverapps.metha.getType()===Metha.HOSE&&!cleverapps.Plot.isPassedAllEpisodes,n=[];if(this.isEpisodeFinished(s)&&!cleverapps.Plot.isPassedAllEpisodes){var o=levels.user.episode-1,r=cleverapps.styles.comicses["finishEpisode"+o]||cleverapps.styles.comicses.finishEpisode;r&&n.push(function(e){ComicsScene.showComics(e,r)})}var a,c=function(e){var t=cleverapps.missionManager.getMissionWithIntent();!i&&t&&t.logic.willUseIntent(s)?t.useMissionIntent(e):(cleverapps.rewardedAdsManager&&!cleverapps.isLocalhost()&&cleverapps.rewardedAdsManager.showInterstitial(),cleverapps.metha.gotoMainScene(e))};cleverapps.isKnockoutGame()&&s.isRegular()?((a=cleverapps.metha.getMainObject().knockoutGame.rumble).moveNextRound(),a.outcome===Rumble.OUTCOME_UNKNOWN?n.push(function(e){cleverapps.metha.getMainObject().wantsToPlay(e)}):(a.outcome===Rumble.OUTCOME_WIN&&(n.push(function(e){cleverapps.metha.getMainObject().knockoutGame.openWindow(e)}),n.push(function(e){new KnockoutVictoryWindow,
cleverapps.metha.onceNoWindowsListener=e})),n.push(c))):n.push(c);cleverapps.metha.getType()===Metha.KNOCKOUT&&s.isRegular()&&((a=cleverapps.knockout.knockoutGame.rumble)&&a.outcome===Rumble.OUTCOME_WIN&&(cleverapps.knockout.gotoNextCupAnimation=!0,n.push(function(e){cleverapps.knockout.gotoNextCup(e)}),n.push(function(e){cleverapps.knockout.gotoNextCupAnimation=!1,e()})));if(i){levels.episodes.changeEpisodeAnimation=!0;var l=levels.user.episode-1,p=l+1;n.push(function(e){cleverapps.metha.compound(e,[function(e){cleverapps.Plot.onFinishEpisode(e,{episode:levels.episodes.episodes[l]})},function(e){levels.episodes.changeEpisodeAnimation=!1,levels.episodes.gotoNextEpisode(e,!0,p)},function(e){cleverapps.Plot.onStartEpisode(e,{episode:levels.episodes.episodes[p]})}])})}s.isRegular()&&s.isPassed&&s.isCurrentLevel()&&cleverapps.Plot.getDialogueAfterLevel(s)&&n.push(function(e){cleverapps.Plot.finishLevelDialogue(e,s)}),cleverapps.metha.compound(e,n)},onFinishEpisode:function(e,t){
cleverapps.metha.showControlsWhileFocused("mainTableView"),cleverapps.metha.compound(e,[function(e){new FinishEpisodeWindow(t),cleverapps.metha.onceNoWindowsListener=e},function(e){t.episode.animatePass(e)}])},onStartup:function(e,t){return 0===levels.user.episode&&0===levels.user.level?this.onFirstInit(e,t):t?cleverapps.metha.getMainScene():void cleverapps.metha.gotoMainScene(e)},onFirstInit:function(e,t){var s=[];if(cleverapps.styles.comicses&&cleverapps.styles.comicses.begin){if(t)return{scene:ComicsScene,options:[cleverapps.styles.comicses.begin]};s.push(function(e){ComicsScene.showComics(e,cleverapps.styles.comicses.begin)})}else if(this.hasStartEpisodeWindow())return t?cleverapps.metha.getMainScene():(s.push(function(e){cleverapps.metha.gotoMainScene(e)}),s.push(function(e){this.onStartEpisode(e,{episode:levels.episodes.getCurrentEpisode()})}.bind(this)),void cleverapps.metha.compound(e,s));if(cleverapps.metha.getType()===Metha.HOSE||cleverapps.metha.getType(
)===Metha.SIMPLE||cleverapps.metha.withSimpleMain()){if(t)return GameScene;s.push(function(e){cleverapps.metha.wantsToPlay(e)})}else{if(t)return cleverapps.metha.getMainScene();s.push(function(e){cleverapps.metha.gotoMainScene(e)})}cleverapps.metha.compound(e,s)},hasStartEpisodeWindow:function(){return cleverapps.metha.getType()===Metha.HOSE&&"riddles"===cleverapps.config.name},onStartEpisode:function(e,t){if(t.episode.isComingSoon())new FinisherWindow,cleverapps.metha.onceNoWindowsListener=e;else{var s=[];s.push(function(e){t.episode.animateOpen(e)}),this.hasStartEpisodeWindow()&&s.push(function(e){new StartEpisodeWindow(t.episode),cleverapps.metha.onceNoWindowsListener=e}),cleverapps.metha.compound(e,s)}},onFirstHeroesOpen:function(e,t){var s=[function(e){new HeroWindow({color:t.color},{type:"unlocked"}),cleverapps.metha.onceNoWindowsListener=e}];if(cleverapps.styles.comicses){var i=ColorCell.CODE_COLORS[t.color];cleverapps.styles.comicses[i]&&s.push(function(e){
ComicsScene.showComics(e,cleverapps.styles.comicses[i])})}cleverapps.metha.compound(e,s)},isEpisodeFinished:function(e){return e.isRegular()&&e.isPassed&&e.isLastLevelOnEpisode()&&e.isCurrentLevel()},getDialogueAfterLevel:function(e){if(!cleverapps.styles.dialogues||!e.isRegular())return!1;var t=cleverapps.user.getHumanReadableNumber()-1;return cleverapps.styles.dialogues["finishLevel"+t]},finishLevelDialogue:function(e,t){var s=this.getDialogueAfterLevel(t);if(s){var i=cc.director.getRunningScene();cleverapps.metha.compound(e,[function(e){s.bundles?cleverapps.bundleLoader.loadBundles(s.bundles,{onSuccess:function(){e()},blocked:!0}):e()},function(e){var t=i.scene.height*(1.2-1);i.createFilmEffect({scale:1.2,layerTimeout:0,scaleTimeout:1,moveBy:{y:t},onComplete:e})},function(e){var t=new Dialogue(s.dialogue,{autoClose:!0,autoScroll:3,parentScene:!0,showUp:!0});t.on("afterClose",e),new DialogueView(t,{overlay:!0}).setLocalZOrder(51),t.run()},function(e){i.removeFilmEffect({
scaleTimeout:.4,scaleLayerSameTime:!0,layerSlide:!0,onComplete:e})}])}}},cleverapps.styles.comicses={};var Dialogue=function(e,t){cleverapps.EventEmitter.call(this),this.options=t||{},this.parentScene=t.parentScene,this.autoScroll=3,void 0!==this.options.autoScroll&&(this.autoScroll=this.options.autoScroll),this.data=Array.isArray(e)?e:[e],this.stage=-1,this.stageData=this.data[0],this.personSlots=[void 0,void 0],this.bundlesToLoad=["dialogues"].concat(cleverapps.unique(this.options.bundles||[]).filter(function(e){return bundles[e]})),this.onceFinishTyping=function(){}};Dialogue.prototype=Object.create(cleverapps.EventEmitter.prototype),(Dialogue.prototype.constructor=Dialogue).prototype.onBundlesLoaded=function(){this.waitingForBundles&&(delete this.waitingForBundles,this.next())},Dialogue.prototype.run=function(){cleverapps.metha.isFocused()||(console.log("Dialogue:",this.data),cleverapps.metha.debugMessage("Trying to show dialogue without user focus!")),
cleverapps.bundleLoader.isLoaded(this.bundlesToLoad)?this.next():this.waitingForBundles=!0},Dialogue.prototype.finishClose=function(){this.closeCallback&&(this.closeCallback(),delete this.closeCallback),this.trigger("afterClose")},Dialogue.prototype.close=function(e){this.closing||(this.closing=!0,this.closeCallback=e,this.trigger("beforeClose"))},Dialogue.prototype.next=function(e){if(this.typing)return this.onceFinishTyping=function(){},void this.finishTyping();e=e||0,this.stage<this.data.length-1?this.incStage(e):this.options.autoClose&&this.createTimeout(this.close.bind(this),1e3*e)},Dialogue.prototype.incStage=function(e){clearTimeout(this.incTimeout),this.onceFinishTyping=function(){},this.incTimeout=this.createTimeout(function(){this.stage++,this.stageData=this.data[this.stage],this.onChangeStage(),this.options.showUp&&0===this.stage&&this.trigger("showUp"),this.onceFinishTyping=this.finishTyping.bind(this)}.bind(this),1e3*e)},Dialogue.prototype.createTimeout=function(e,t){
return new cleverapps.CountDown(t,{onFinish:function(){this.closing||e()}.bind(this),pauseOnGameHide:!0})},Dialogue.prototype.onChangeStage=function(){this.typing=!0;var e=this.extractPersons();(e[0]&&"right"===e[0].position||e[1]&&"left"===e[1].position)&&(e=e.reverse());var i=void 0;e.forEach(function(e,t){e&&e.active&&(i=e);var s=this.personSlots[t];this.areSamePersons(e,s)?this.trigger("updatePerson",e):(s&&this.trigger("hidePerson",s.position),e&&this.trigger("showPerson",e))},this),this.trigger("updateButton",!this.stageData.noButton,this.stage===this.data.length-1),this.trigger("changeText",this.stageData.text,i,function(){this.onceFinishTyping()}.bind(this)),this.trigger("updatePersonTitle",i),this.trigger("changedStage"),this.personSlots=e},Dialogue.prototype.extractPersons=function(){var e=this.stageData.person;void 0===e&&(e={position:"left"}),e&&(e.active=!0);var t=this.stageData.person2;return t&&(t.active=!1),[e,t]},Dialogue.prototype.areSamePersons=function(e,t){
return e&&t&&e.position===t.position&&(!e.styles&&!t.styles||e.styles.json===t.styles.json)},Dialogue.prototype.finishTyping=function(){this.typing=!1,this.trigger("finishTyping"),this.autoScroll&&this.next(this.autoScroll)},Dialogue.prototype.screenClicked=function(){this.trigger("screenClicked"),this.next()},Dialogue.prototype.buttonClicked=function(){this.typing&&this.next(),this.next(),this.trigger("buttonClicked")},Dialogue.POSITIONS={TOP:"top",TOP_LOWER:"top_lower",BOTTOM:"bottom",CENTER:"center"};var Force=Window.extend({ctor:function(e,t,s){this.windowForce="function"===t.window?t.window():t.window,this.forceConfig=t,this.options=s||{},this._super(e,t)},moveNodeAndKeepScale:function(e){var t=new cc.Node;t.setScale(e.adjustScaleTo(this)/e.scale),this.addChild(t),e.realParent=e.getParent(),e.replaceParentSamePlace(t)},returnNode:function(e){e.replaceParentSamePlace(e.realParent)},onWindowLoaded:function(e,t){this.id=t.id,this._super({name:"forcewindow"+this.id,
notCloseByTouchInShadow:!0,closeButton:!1,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.Force,!0)}),this.setLocalZOrder(31),cleverapps.toolbar.freezeUpdates(),this.element=e,this.element.realParent=void 0;var s=this.options.rects||[];if(e!==Force.NO_ELEMENT&&s.push(this.element.getGlobalBoundingBox()),this.options.highlights&&this.options.highlights.forEach(function(e){this.moveNodeAndKeepScale(e)},this),e!==Force.NO_ELEMENT&&(this.moveNodeAndKeepScale(e),!1!==t.Finger)){var i,n=this.options.scaleX||1,o=this.options.scaleY||1,r=cc.p(0,0),a=0,c=e;if(t.Finger){var l=t.Finger;"function"==typeof l&&(l=l()),l.mobile&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(l=l.mobile),r=cc.p(l.x||0,l.y||0),l.startY&&(i=cc.p(0,l.startY)),l.rotation&&(a=l.rotation),l.useForceTarget&&(c=this.findForceTarget(e))}this.finger=new FingerView({scaleX:n,scaleY:o}),this.finger.setRotation(a);var p=function(){this.finger.setPosition(this.convertToNodeSpace(
c.parent.convertToWorldSpace(c.getPosition())))}.bind(this);this.finger.standardLoop({fadeInPosition:r,fadeInStartPosition:i,delayOnBeginAndFinish:!0,loops:1,onIterationFinish:p}),p(),this.addChild(this.finger)}var d="function"==typeof t.text?t.text(t):t.text;if(d){var h=new MinimalDialogue({text:d,person:t.person,rects:s,parent:this,forcePosition:"function"==typeof t.position?t.position():t.position});this.addChild(h)}(e===Force.NO_ELEMENT||this.forceConfig.closeByTouchInShadow)&&this.addCloseByTouchInShadow(),t.event&&cleverapps.eventLogger.logEvent(t.event),e!==Force.NO_ELEMENT&&(this.watchElementInterval=setInterval(function(){this.element.parent&&this.element.visible||cleverapps.forces.closeRunningForce()}.bind(this),5e3))},onClose:function(){this.watchElementInterval&&clearInterval(this.watchElementInterval),this.element.parent&&(this.finger&&this.finger.removeFromParent(!0),this.element&&this.element!==Force.NO_ELEMENT&&this.returnNode(this.element)),
this.options.highlights&&this.options.highlights.forEach(function(e){e.getParent()&&this.returnNode(e)},this),cleverapps.toolbar.unfreezeUpdates()},addCloseByTouchInShadow:function(){this.clickArea=new cc.Node,this.clickArea.setContentSize(this.getContentSize()),this.addChild(this.clickArea),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce()}.bind(this.clickArea)},this.clickArea)},stop:function(){},listBundles:function(){return["dialogues_minimal"]},findForceTarget:function(e){for(var t=[e],s=0;s<t.length;++s){var i=t[s];if(i.forceTarget)return i;t=t.concat(i.children)}return e}});cleverapps.styles.Force={windowShowUpAnimation:{name:"instant",force:!0}},Force.NO_ELEMENT="emptyForceElement";var Forces=function(){this.shownForces=[],this.load(),this.runningForceWindow=void 0,this.onceForceClosed=void 0};Forces.prototype.isRunningForce=function(e){
return void 0!==this.runningForceWindow&&(void 0===e||this.runningForceWindow.id===e.id)},Forces.prototype.whenForceClosed=function(e){this._whenForceClosedCallbacks||(this._whenForceClosedCallbacks=[]),this._whenForceClosedCallbacks.push(e)},Forces.prototype._runForceClosedCallbacks=function(){this._whenForceClosedCallbacks&&(this._whenForceClosedCallbacks.forEach(function(e){e()}),delete this._whenForceClosedCallbacks)},Forces.prototype.closeRunningForce=function(){if(this.runningForceWindow.close(),this._runForceClosedCallbacks(this.runningForceWindow.id),void 0!==this.runningForceWindow.id&&this.saveForce(this.runningForceWindow.id),this.runningForceWindow=void 0,this.onceForceClosed){var e=this.onceForceClosed;this.onceForceClosed=void 0,e()}},Forces.prototype.reset=function(){this.shownForces=[],this.save()},Forces.prototype.load=function(){this.shownForces=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FORCES)||[]},Forces.prototype.save=function(e){
cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FORCES,this.shownForces),e||cleverapps.synchronizer.addUpdateTask("forces")},Forces.prototype.getInfo=function(){var t=0;return this.shownForces.forEach(function(e){t+=Math.pow(2,e)}),{forces:t}},Forces.prototype.updateInfo=function(e,t){this.shownForces=[];for(var s=e.forces,i=Forces.SYNCED_FORCES-1;0<=i;i--){var n=Math.pow(2,i);n<=s&&(s-=n,this.shownForces.push(i))}this.shownForces=this.shownForces.reverse(),this.save(t)},Forces.prototype.isAvailable=function(e,t){return!(!e||e&&e!==Force.NO_ELEMENT&&!e.isRunningSafe())&&(void 0===t.id||-1===this.shownForces.indexOf(t.id))},Forces.prototype.isShown=function(e){return void 0!==e&&(this.shownForces&&0<=this.shownForces.indexOf(e))},Forces.prototype.saveForce=function(e){e&&!this.isShown(e)&&(this.shownForces.push(e),this.save())},Forces.prototype.clearForce=function(e){var t=this.shownForces.indexOf(e);-1!==t&&(this.shownForces.splice(t,1),this.save())},
Forces.prototype.create=function(e,t,s){if(this.isAvailable(e,t))return this.runningForceWindow=new Force(e,t,s)},Forces.prototype.checkMainForces=function(){return this.checkDailyTasksForce()||this.checkPeriodicBonusForce()||this.checkBonusRoundForce()||this.checkHeroesForce()},Forces.prototype.checkDailyTasksForce=function(){return cleverapps.dailyTasks&&levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)&&!this.isShown(Forces.DAILY_TASKS_FORCE.id)},Forces.prototype.checkPeriodicBonusForce=function(){return cleverapps.periodicBonus&&cleverapps.periodicBonus.isAvailable()&&!this.isShown(Forces.PERIODIC_BONUS_FORCE.id)},Forces.prototype.checkBonusRoundForce=function(){return cleverapps.bonusRoundChest&&cleverapps.bonusRoundChest.isActive()&&!this.isShown(Forces.BONUS_ROUND_FORCE.id)},Forces.prototype.checkHeroesForce=function(){return"undefined"!=typeof match3&&match3.heroes.available()&&!this.isShown(Forces.HEROES_AVAILABLE.id)},Forces.SYNCED_FORCES=52,
Forces.FREE_WILDCARD_FORCE={id:1,event:cleverapps.EVENTS.FREE_WILDCARD_FORCE,text:"messages:WildCardTutorialMessage"},Forces.FREE_UNDO_FORCE={id:2,event:cleverapps.EVENTS.FREE_UNDO_FORCE,text:"messages:UndoTutorialMessage"},Forces.FREE_HINT_FORCE={id:3,event:cleverapps.EVENTS.FREE_HINT_FORCE,text:"messages:hintTutorialMessage"},Forces.FIRST_BOOSTERS_BEFORE={id:4,window:!0,event:cleverapps.EVENTS.FIRST_BOOSTERS_BEFORE,text:"messages:FirstBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.SECOND_BOOSTERS_BEFORE={id:5,window:!0,event:cleverapps.EVENTS.SECOND_BOOSTERS_BEFORE,text:"messages:SecondBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.THIRD_BOOSTERS_BEFORE={id:6,window:!0,event:cleverapps.EVENTS.THIRD_BOOSTERS_BEFORE,text:"messages:ThirdBoostersBefore.force",position:Dialogue.POSITIONS.BOTTOM},Forces.FREE_ADD_MOVES_FORCE={id:7,event:cleverapps.EVENTS.FREE_ADD_MOVES_FORCE,text:"messages:AddMovesTutorialMessage",Finger:{y:50}},Forces.FREE_PAINT_FORCE={
id:8,event:cleverapps.EVENTS.FREE_PAINT_FORCE,text:"messages:Paint.force"},Forces.DAILY_TASKS_FORCE={id:10,event:cleverapps.EVENTS.DAILY_TASKS_FORCE,text:"messages:Forces.DailyTasks",Finger:{startY:100}},Forces.COOLDOWN_FORCE={id:11,text:"messages:CoolDownNode.force",button:{text:"messages:SkipButton"},Finger:!1},Forces.PERIODIC_BONUS_FORCE={id:12,event:cleverapps.EVENTS.PERIODIC_BONUS_FORCE,text:"messages:Forces.PeriodicBonus",Finger:{startY:100}},Forces.GUN={id:15,event:cleverapps.EVENTS.GUN_FORCE,person:"board"!==cleverapps.config.type&&-1===["differences","tripeaks"].indexOf(cleverapps.config.name)&&void 0,text:"messages:Forces.Gun",Finger:{startY:100,x:100,y:130}},Forces.HEROES_AVAILABLE={id:17,event:cleverapps.EVENTS.HEROES_AVAILABLE_FORCE,text:"messages:Forces.HeroesAvailable"},Forces.DAILY_CUP={id:18,text:"messages:DailyCup.force"},Forces.LANTERN={id:20,event:cleverapps.EVENTS.LANTERN_FORCE,text:"messages:LanternWindow.force"},Forces.BONUS_ROUND_FORCE={id:21,
event:cleverapps.EVENTS.BONUS_ROUND_FORCE,text:"messages:Forces.BonusRound",Finger:{startY:100}},Forces.UNLOCK_HEROES={text:"messages:Forces.UnlockHero",Finger:{y:-70}},Forces.UPGRADE_HEROES={text:"messages:Forces.UpgradeFirstHero",Finger:{y:-70}},Forces.METHA_PLAY_BUTTON={id:23,text:function(){return cleverapps.metha.getType()===Metha.SIMPLE?"messages:SimpleMethaPlayButton.force":"messages:MethaPlayButton.force"},position:Dialogue.POSITIONS.TOP_LOWER},Forces.KNOCKOUT_PLAYERS={id:24,text:"messages:KnockoutPlayers.force",button:{text:"messages:SkipButton"},Finger:!1},Forces.KEYPAD={id:25,text:"messages:Keypad.force",button:{text:"messages:SkipButton"},Finger:!1,position:function(){if("differences"===cleverapps.config.type)return Dialogue.POSITIONS.BOTTOM}},Forces.COMBO={id:26,text:"messages:Combo.force"},Forces.COOKIEJAR={id:27,text:"messages:Cookiejar.force",button:{text:"messages:OK"},closeByTouchInShadow:!0},Forces.CRYPTEX={id:28,text:"messages:Cryptex.force"},
Forces.FREE_SHUFFLE_FORCE={id:29,event:cleverapps.EVENTS.FREE_SHUFFLE_FORCE,text:"messages:ShuffleBooster.force"},Forces.PHOTO_CLOVER={id:30,text:"messages:PhotoClover.force"},Forces.TRICKY_LEVEL={id:31,text:"messages:TrickyLevelForce",Finger:!1},Forces.SIMPLE={id:32,text:"messages:Simple.Force",Finger:function(){return cleverapps.styles.ProgressView.force.finger}},Forces.BONUS_WORLD={id:33},Forces.SLOT_MACHINE_ICON={id:34,text:"messages:SlotMachine.IconForce"},Forces.SLOT_MACHINE={id:35,text:"messages:SlotMachine.Force"},Forces.BUY_ENERGY_ICON={id:36,text:"messages:BuyEnergy.IconForce",Finger:{useForceTarget:!0}},Forces.UNITS_SHOP_ICON={id:37,text:"messages:UnitsShop.IconForce"},Forces.BUY_ENERGY_SHOP={window:!0,Finger:{useForceTarget:!0}};var Actor=cc.Node.extend({ctor:function(e){this._super(),this.setContentSize(e.size),this.setAnchorPoint2();var t=e;t.boostersAmountPosition&&(t=t.boostersAmountPosition[Game.currentGame.boosters.amountAvailable()]),
t=t.wideModePositions?t.wideModePositions[cleverapps.wideMode.mode]:t.position,this.setPositionRound(t),this.baseScaleX=this.baseScaleY=1,e.scales&&(this.baseScaleX=this.baseScaleY=e.scales[cleverapps.wideMode.mode]),e.scaleX&&(this.baseScaleX*=e.scaleX),e.scaleY&&(this.baseScaleY*=e.scaleY),this.setScale(this.baseScaleX,this.baseScaleY),this.spine=new cleverapps.Spine(e.spine),this.currSpine=e.spine,this.currSpineId=e.spineId,this.currSfx=e.sfx,e.spinePosition?this.spine.setPositionRound(this.width/2+e.spinePosition.x,this.height/2+e.spinePosition.y):this.spine.setPositionRound(this.width/2,0),this.addChild(this.spine),e.skin&&(this.spine.setSkin(e.skin),this.currSkin=e.skin),this.spine.setAnimation(0,Actor.ANIMATIONS.IDLE,!0),this.alive=!0},shake:function(){this.stopAllActions(),this.setScale(this.baseScaleX,this.baseScaleY),this.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.07*this.baseScaleX,.93*this.baseScaleY),new cc.ScaleTo(.05,this.baseScaleX,this.baseScaleY)))},
animate:function(t,s){if(s=s||{},!this.alive){if(t!==Actor.ANIMATIONS.REVIVE)return;this.alive=!0}var e;(-1!==[Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE].indexOf(t)&&(this.alive=!1),-1!==[Actor.ANIMATIONS.HURT,Actor.ANIMATIONS.HURT2].indexOf(t)&&(-1!==[Actor.ANIMATIONS.ATTACK1,Actor.ANIMATIONS.ATTACK2,Actor.ANIMATIONS.ATTACK3,Actor.ANIMATIONS.ATTACK4].indexOf(this.animationRunning)&&(this.animationRunning=!1),-1!==[Actor.ANIMATIONS.HURT,Actor.ANIMATIONS.HURT2].indexOf(this.animationRunning)&&this.animationStarted<Date.now()-300&&(this.animationRunning=!1)),-1!==[Actor.ANIMATIONS.GUN,Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE,Actor.ANIMATIONS.REVIVE,Actor.ANIMATIONS.HEAL,Actor.ANIMATIONS.ENEMY_ATTACK].indexOf(t)&&(this.animationRunning=!1),this.animationRunning)||(this.currSfx&&!s.noSFX&&(e=this.currSfx[t]),e&&this.runAction(new cc.Sequence(new cc.DelayTime(s.sfxDelay||cleverapps.styles.Actor.sfx.delay),new cc.CallFunc(function(){cleverapps.audio.playSound(e)}))),
this.animationRunning=t,this.animationStarted=Date.now(),this.spine.setAnimation(0,t,!1),this.spine.setCompleteListener(function(){var e;this.animationRunning=!1,this.spine.setCompleteListener(function(){}),e=s.idleAnimation?s.idleAnimation:-1!==[Actor.ANIMATIONS.DIE,Actor.ANIMATIONS.DIE_IDLE].indexOf(t)?Actor.ANIMATIONS.DIE_IDLE:Actor.ANIMATIONS.IDLE,this.spine.setAnimation(0,e,!0),s.callback&&s.callback()}.bind(this)))}});Actor.ANIMATIONS={},Actor.ANIMATIONS.ENEMY_ATTACK="attack",Actor.ANIMATIONS.ATTACK1="attack1",Actor.ANIMATIONS.ATTACK2="attack2",Actor.ANIMATIONS.ATTACK3="attack3",Actor.ANIMATIONS.ATTACK4="attack4",Actor.ANIMATIONS.IDLE="idle",Actor.ANIMATIONS.HURT="hurt",Actor.ANIMATIONS.HURT2="hurt2",Actor.ANIMATIONS.DIE="die",Actor.ANIMATIONS.DIE_IDLE="die_idle",Actor.ANIMATIONS.HEAL="heal",Actor.ANIMATIONS.REVIVE="revive",Actor.ANIMATIONS.GUN="punish",cleverapps.styles.Actor={sfx:{delay:.7}},cleverapps.WideMode=function(){this.refresh()},
cleverapps.WideMode.prototype.refresh=function(){this.mode=cleverapps.WideMode.VERTICAL;var e=cc.director.getWinSize();e.width>cleverapps.styles.SQUARE_MODE_WIDTH&&(this.mode=cleverapps.WideMode.SQUARE),void 0!==cleverapps.styles.HORIZONTAL_MODE_WIDTH?e.width>cleverapps.styles.HORIZONTAL_MODE_WIDTH&&(this.mode=cleverapps.WideMode.HORIZONTAL):void 0!==cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&e.width===cleverapps.styles.SCENE_HORIZONTAL_WIDTH&&(this.mode=cleverapps.WideMode.HORIZONTAL)},cleverapps.WideMode.VERTICAL=0,cleverapps.WideMode.SQUARE=1,cleverapps.WideMode.HORIZONTAL=2;var Competition=function(e){this.type=e.type;var t=void 0;(this.options=e).store&&((t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION+"_"+this.type))||-1===[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY,Mission.TYPE_LETTER].indexOf(this.type)||(t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION)),cleverapps.DataLoader.remove(
cleverapps.DataLoaderTypes.COMPETITION));t?(this.results=t.results,e.algo.lastProcessed=t.algorithm):e.players?this.results=e.players:this.results=this.listFakePlayers(e.amount),this.player=this.getPlayerById(cleverapps.user.id),this.player||(this.player={player:!0,id:cleverapps.user.id,name:cleverapps.friends.getPlayer().name,avatar:cleverapps.friends.getPlayer().avatar,amount:0},this.results.push(this.player)),void 0!==e.playerResult&&(this.player.amount=e.playerResult),this.running=!0,this.onChangeResultsListeners={},this.onLoseListener=function(){},this.algorithm=new CompetitionAlgorithm(this,this.options.algo),0<this.countFakePlayers()&&this.onPlayersAvailable()};Competition.prototype.start=function(){this.algorithm.start()},Competition.optionsForTournament=function(e){var t="tournament",s=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION+"_"+t)||{};if(e.emptySave||s.level===e.level.getHumanReadableNumber()){var i=s.results||[];if(e.emptySave){
Competition.CLEAN_SAVED(t);var n=[.5,.8,1.1].sort(function(){return Math.random()<.5?-1:1});(i=cleverapps.competitionPlayers.listPlayers(3)||[]).forEach(function(e,t){e.amount=0,e.force=n[t]})}if(!(i.length<3)){cleverapps.UI.Avatar.preload(i);var o=cleverapps.competitionStatistics.getBoardGameWordOpenByKeypadLengthTime(e.keypad.amountKeys());return{type:t,amount:3,level:e.level,store:!0,lose:!1,players:i,algo:{noPlayerEpisodeCoef:!0,averageProcessTimeout:cleverapps.parseInterval(o+" seconds"),botAheadPlayerCoef:.25,botAheadPlayerBigDifferenceCoef:.3,bigDistanceLength:1,offlineProcess:!0,useRealForce:!0,duration:cleverapps.parseInterval("3 hour"),maxResult:e.totalItemsToSolve()}}}}},Competition.optionsForKnockoutGame=function(e){var t=10;"board"===cleverapps.config.type?t=cleverapps.competitionStatistics.getBoardGameWordOpenByKeypadLengthTime(e.keypad.amountKeys()):"differences"===cleverapps.config.type&&(t=cleverapps.competitionStatistics.getOneDifferenceFindTime())
;var s=cleverapps.metha.getMainObject().knockoutGame.rumble,i=s.getCurrentRound().getOpponent(cleverapps.user.id);i.force=[.6,.8,1][s.rounds.length-1],i.amount=0;var n=.3,o=1.5,r=.5;switch(cleverapps.metha.getMainObject().knockoutGame.calcTournamentType()){case KnockoutGame.BOT_CANNOT_WIN_TOURNAMENT:r=0,o=2,t=Math.floor(.8*t);break;case KnockoutGame.VERY_EASY_TOURNAMENT:n=.3,o=2,t=Math.floor(2.5*t);break;case KnockoutGame.EASY_TOURNAMENT:n=.4,o=1,r=.3,t=Math.floor(1.3*t);break;case KnockoutGame.NORMAL_TOURNAMENT:n=.5,o=1.2,r=.3,t=Math.floor(1.1*t);break;case KnockoutGame.DIFFICULT_TOURNAMENT:n=.6,o=1.5,t=Math.floor(.8*t);break;case KnockoutGame.VERY_DIFFICULT_TOURNAMENT:n=.8,o=1.5,t=Math.floor(.5*t)}return{type:"knockout",amount:1,players:[i],algo:{noPlayerEpisodeCoef:!0,averageProcessTimeout:cleverapps.parseInterval(t+" seconds"),botAheadPlayerCoef:n,botAheadPlayerBigDifferenceCoef:.5,playerAheadBotCoef:o,playerAheadBotBigDifferenceCoef:2,bigDistanceLength:1,offlineProcess:!1,
useRealForce:!0,duration:cleverapps.parseInterval("3 hour"),maxResult:e.totalItemsToSolve(),botFinishCoef:r}}},Competition.optionsByMission=function(e){var t={store:!0,type:e.type,playerResult:e.result,amount:Array.isArray(e.competition.amount)?cleverapps.Random.random(e.competition.amount[0],e.competition.amount[1],!1):e.competition.amount};return t.algo={start:e.started,finish:e.finishTime()},cleverapps.extend(t.algo,e.competition),t},Competition.prototype.calcPlace=function(){return this.results.sort(function(e,t){return t.amount!==e.amount?t.amount-e.amount:e.event&&t.event&&e.event!==t.event?e.event-t.event:e===this.player?-1:t===this.player?1:0}.bind(this)),this.results.indexOf(this.player)},Competition.prototype.updatePlayerResult=function(e,t){this.options.algo.maxResult&&t>this.options.algo.maxResult&&(t=this.options.algo.maxResult);for(var s=0;s<this.results.length;s++)if(this.results[s].id===e){this.results[s].amount=t,this.results[s].event=Date.now(),
this.runChangeResultsListeners(e);break}this.getFinishedOpponents().length===this.options.amount&&!1!==this.options.lose&&this.onLoseListener()},Competition.prototype.getFinishedOpponents=function(){return this.results.filter(function(e){return e.id!==cleverapps.user.id&&e.amount===this.options.algo.maxResult}.bind(this))},Competition.prototype.runChangeResultsListeners=function(t){cleverapps.values(this.onChangeResultsListeners).forEach(function(e){e(t)})},Competition.prototype.stop=function(){this.running=!1,delete cleverapps.competitionPlayers.onAvailableListeners[this.type],this.algorithm.stop()},Competition.prototype.onPlayersAvailable=function(){if(delete cleverapps.competitionPlayers.onAvailableListeners[this.type],this.running){var e=cleverapps.competitionPlayers.listPlayers(Math.min(this.countFakePlayers(),cleverapps.competitionPlayers.getAmount()));this.replaceFakePlayers(e),0<this.countFakePlayers()&&(
cleverapps.competitionPlayers.onAvailableListeners[this.type]=this.onPlayersAvailable.bind(this))}},Competition.CLEAN_SAVED=function(e){cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.COMPETITION+"_"+e)},Competition.prototype.listFakePlayers=function(e){for(var t=[],s=0;s<e;s++)t.push({id:Math.round(1e6*Math.random()),name:"player"+s,fake:!0});return t},Competition.prototype.countFakePlayers=function(e){var t=0;return this.results.forEach(function(e){e.fake&&t++}),t},Competition.prototype.replaceFakePlayers=function(e){for(var t=0,s=0;s<this.results.length&&t<e.length;s++){var i=this.results[s];i.fake&&(i.id=e[t].id,i.name=e[t].name,i.avatar=e[t].avatar,delete i.fake,t++)}this.save()},Competition.prototype.getPlayerById=function(t){return this.results.filter(function(e){return e.id===t})[0]},Competition.prototype.getResults=function(){return this.results.slice()},Competition.prototype.save=function(){this.options.store&&cleverapps.DataLoader.save(
cleverapps.DataLoaderTypes.COMPETITION+"_"+this.type,{results:this.results,algorithm:this.algorithm.getData(),level:this.options.level?this.options.level.getHumanReadableNumber():void 0})},Competition.prototype.onUserInfoChanged=function(){this.player.name=cleverapps.friends.getPlayer().name,this.player.avatar=cleverapps.friends.getPlayer().avatar,this.player.id=cleverapps.friends.getPlayer().id,this.save()};var CompetitionPlayers=function(){this.onAvailableListeners={},this.load(),this.reload(),setInterval(this.reload.bind(this),cleverapps.parseInterval(CompetitionPlayers.RELOAD_INTERVAL))};CompetitionPlayers.prototype.reload=function(){if(!this.reloading){this.reloading=!0;var e=function(e){this.reloading=!1,this.players=[];for(var t=0;t<e.length;t++)e[t].id!==levels.user.id&&e[t].name&&0<e[t].name.length&&this.players.push({id:e[t].id,name:e[t].name,avatar:e[t].avatar});if(this.save(),0<this.players.length)for(var s in this.onAvailableListeners)this.onAvailableListeners[s]()}.bind(
this),t=function(){this.reloading=!1}.bind(this),s="/competitionplayers/?locale="+cleverapps.settings.language;cleverapps.config.debugMode&&(s="https://riddles.labsystech.ru/riddles-rest"+s),cleverapps.RestClient.get(s,{},e,t)}},CompetitionPlayers.prototype.getAmount=function(){return this.players.length},CompetitionPlayers.prototype.listPlayers=function(e){var t=this.players.splice(0,e);return this.save(),this.reload(),t},CompetitionPlayers.prototype.load=function(){this.players=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION_PLAYERS)||[]},CompetitionPlayers.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.COMPETITION_PLAYERS,this.players)},CompetitionPlayers.RELOAD_INTERVAL="30 minutes";var CompetitionStatistics=function(){this.load()};CompetitionStatistics.prototype.onGameStarted=function(t){"board"===cleverapps.config.type&&(t.onChangeOutcomeListeners.competitionStatistics=function(){var e=Math.floor(t.timer.getTime(
)/t.board.countTotalWords()/1e3);this.saveBoardGameWordOpenByKeypadLengthTime(t.keypad.amountKeys(),e)}.bind(this))},CompetitionStatistics.prototype._newData=function(e,t){this.data[e]&&this._isAppropriateValue(e,t)&&(this.data[e]=Math.round(.9*this.data[e]+.1*t),this.save())},CompetitionStatistics.prototype._isAppropriateValue=function(e,t){return t>CompetitionStatistics.DEFAULTS[e]/5&&t<5*CompetitionStatistics.DEFAULTS[e]},CompetitionStatistics.prototype.saveBoardGameWordOpenByKeypadLengthTime=function(e,t){this._newData("brd_l"+e,t)},CompetitionStatistics.prototype.getBoardGameWordOpenByKeypadLengthTime=function(e){return e=Math.min(Math.max(e,4),9),this.data["brd_l"+e]},CompetitionStatistics.prototype.saveOneDifferenceFindTime=function(e){console.log("save diff time",e),this._newData("diff_time",e)},CompetitionStatistics.prototype.getOneDifferenceFindTime=function(){return this.data.diff_time},CompetitionStatistics.prototype.load=function(){this.updateInfo(
cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.COMPETITION_STATISTICS)||{})},CompetitionStatistics.prototype.updateInfo=function(e,t){for(var s in this.data={},CompetitionStatistics.DEFAULTS)this.data[s]=e[s]&&this._isAppropriateValue(s,e[s])?e[s]:CompetitionStatistics.DEFAULTS[s];t&&this.save(!0)},CompetitionStatistics.prototype.getInfo=function(){var e={};for(var t in CompetitionStatistics.DEFAULTS)CompetitionStatistics.DEFAULTS[t]!==this.data[t]&&(e[t]=this.data[t]);return e},CompetitionStatistics.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.COMPETITION_STATISTICS,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("competitionstatistics")},CompetitionStatistics.DEFAULTS={brd_l4:8,brd_l5:15,brd_l6:20,brd_l7:30,brd_l8:40,brd_l9:50,diff_time:30};var CompetitionAlgorithm=function(e,t){this.competition=e,void 0===(this.options=t).start&&(t.start=Date.now(),t.finish=t.start+t.duration),this.lastProcessed=t.lastProcessed||t.start}
;CompetitionAlgorithm.prototype.start=function(){this.isPrepared()||this.prepareFromScratch(),this.competition.running&&(this.intervalProcess(),this.runInterval=setInterval(function(){this.competition.running?this.intervalProcess():this.stop()}.bind(this),this.intervalTimeout()))},CompetitionAlgorithm.prototype.stop=function(){this.runInterval&&(clearInterval(this.runInterval),this.runInterval=void 0)},CompetitionAlgorithm.prototype.getData=function(){return this.lastProcessed},CompetitionAlgorithm.prototype.process=function(e){for(var t=[],s=0;s<this.competition.results.length;s++){var i=this.competition.results[s];if(!i.player&&Math.random()<this.botProcessProb(i,e)){if(this.options.maxResult&&i.amount===this.options.maxResult)continue;var n=i.amount+this.processAmount();this.options.maxResult&&n>this.options.maxResult&&(n=this.options.maxResult),i.amount!==n&&t.push({id:i.id,amount:n})}}if(0<t.length){for(s=0;s<t.length;s++)this.competition.updatePlayerResult(t[s].id,t[s].amount)
;this.competition.save()}},CompetitionAlgorithm.prototype.isPrepared=function(){for(var e=0;e<this.competition.results.length;e++)if(!this.competition.results[e].player)return void 0!==this.competition.results[e].force;return!0},CompetitionAlgorithm.prototype.prepareFromScratch=function(){this.competition.results.forEach(function(e){e.player||(e.amount=0,e.force=Math.floor(Math.random()*(CompetitionAlgorithm.BOT_MAX_FORCE+1)),this.options.minBotForce&&(e.force=Math.max(e.force,this.options.minBotForce)),e.sleep=this.generateSleepPeriod())},this),this.competition.save()},CompetitionAlgorithm.prototype.generateSleepPeriod=function(){var e=this.options.finish-this.options.start;if(!(e<cleverapps.parseInterval("1 hour"))){var t=Math.floor(e/4+Math.random()*e/4),s=this.options.start+Math.floor(Math.random()*(e-t));return{s:s,f:s+t}}},CompetitionAlgorithm.prototype.offlineCoef=function(){return.3},CompetitionAlgorithm.prototype.playerAheadBotCoef=function(e){
return void 0!==this.options.playerAheadBotCoef?this.options.playerAheadBotCoef:1},CompetitionAlgorithm.prototype.playerAheadBot5AmountCoef=function(e){return void 0!==this.options.playerAheadBotBigDifferenceCoef?this.options.playerAheadBotBigDifferenceCoef:2},CompetitionAlgorithm.prototype.botAheadPlayerCoef=function(e){return void 0!==this.options.botAheadPlayerCoef?this.options.botAheadPlayerCoef:.3},CompetitionAlgorithm.prototype.botAheadPlayer5AmountCoef=function(e){return void 0!==this.options.botAheadPlayerBigDifferenceCoef?this.options.botAheadPlayerBigDifferenceCoef:.1},CompetitionAlgorithm.prototype.mediumAmount=function(){var e=this.options.step;return e&&0<e.length?e.reduce(function(e,t){return e+t},0)/e.length:1},CompetitionAlgorithm.prototype.processAmount=function(){var e=this.options.step;return e?2<e.length?cleverapps.Random.choose(e,!1):cleverapps.Random.random(e[0],e[1],!1):1},CompetitionAlgorithm.prototype.getBotForceCoef=function(e){if(this.options.useRealForce
)return e;var t=[0,.03,.08,.15,.25,.35,.5,.7,1,1.5,2];return(void 0!==t[e]?t[e]:2)*(this.options.forceCoef||1)},CompetitionAlgorithm.prototype.sleepNow=function(e){return!!e.sleep&&(e.sleep.s<=this.lastProcessed&&this.lastProcessed<=e.sleep.f)},CompetitionAlgorithm.prototype.bigDistanceLength=function(){return this.options.bigDistanceLength?this.options.bigDistanceLength:5},CompetitionAlgorithm.prototype.calcFromBotAmountCoef=function(e){if(!this.options.maxResult||this.options.maxResult<2)return 1;var t=(this.options.maxResult-1)/2;return 1.25-.75*(e.amount-t)/t},CompetitionAlgorithm.prototype.botProcessProb=function(e,t){if(this.sleepNow(e))return 0;var s=this.competition.player.amount,i=this.perIntervalProb(t);return e.amount>=s?(i*=this.botAheadPlayerCoef(e),e.amount>s+this.bigDistanceLength()*this.mediumAmount()&&(i*=this.botAheadPlayer5AmountCoef(e))):(i*=this.playerAheadBotCoef(e),s>e.amount+this.bigDistanceLength()*this.mediumAmount()&&(i*=this.playerAheadBot5AmountCoef(e))),
this.options.botFinishCoef&&this.options.maxResult&&e.amount+this.mediumAmount()>=this.options.maxResult&&(i*=this.options.botFinishCoef),(i*=this.calcFromBotAmountCoef(e))*this.playerEpisodeCoef()*this.getBotForceCoef(e.force)},CompetitionAlgorithm.prototype.perIntervalProb=function(e){return e?(this.offlinePerIntervalProb||(this.offlinePerIntervalProb=this.offlineCoef()*this.intervalTimeout(e)/this.maxForceBotAverageProcessTimeout()),this.offlinePerIntervalProb):(this.onlinePerIntervalProb||(this.onlinePerIntervalProb=this.intervalTimeout(e)/this.maxForceBotAverageProcessTimeout()),this.onlinePerIntervalProb)},CompetitionAlgorithm.prototype.intervalTimeout=function(e){return cleverapps.parseInterval(e?"10 minutes":"5 seconds")},CompetitionAlgorithm.prototype.freeze=function(e){var t=Date.now();this.lastProcessed>t?this.lastProcessed+=e:this.lastProcessed=t+e},CompetitionAlgorithm.prototype.intervalProcess=function(){var e=Math.min(Date.now(),this.options.finish);if(!(
this.lastProcessed>e)){var t=this.intervalTimeout(!0),s=this.intervalTimeout();if(!1!==this.options.offlineProcess)for(;this.lastProcessed<e-2*t;)this.lastProcessed+=t,this.process(!0);for(;this.lastProcessed<e-s/2;)this.lastProcessed+=s,this.process();this.lastProcessed=e,this.competition.save()}},CompetitionAlgorithm.prototype.maxForceBotAverageProcessTimeout=function(){return this.options.averageProcessTimeout?this.options.averageProcessTimeout:cleverapps.parseInterval("3 minutes")},CompetitionAlgorithm.prototype.playerEpisodelevel=function(){return 10<=levels.user.episode?2:5<=levels.user.episode?1:0},CompetitionAlgorithm.prototype.playerEpisodeCoef=function(){return this.options.noPlayerEpisodeCoef?1:[.1,.13,.15][this.playerEpisodelevel()]},CompetitionAlgorithm.BOT_MAX_FORCE=10,cleverapps.Notification=cc.Scale9Sprite.extend({ctor:function(){this._super(bundles.main.frames.notification_bg_png),this.setLocalZOrder(cleverapps.styles.Notification.zOrder),this.baseHeight=new cc.Sprite(
bundles.main.frames.notification_bg_png).height},setMessage:function(e,t){this.text&&(this.text.removeFromParent(!0),this.text=void 0),this.image&&(this.image.removeFromParent(!0),this.image=void 0);var s,i,n=cleverapps.styles.Notification,o=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.NOTIFICATION_TEXT?cleverapps.styles.FONTS.NOTIFICATION_TEXT:cleverapps.styles.FONTS.TEXT,t.toReplace),r=.85*cleverapps.UI.getSceneSize().width,a=!1;t.image&&(s=t.image.width*t.image.scale,i=t.image.height*t.image.scale,r-=s+n.image.margin),o.width>r&&(a=!0,o.setDimensions(r,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)),this.text=o,this.addChild(o);var c=Math.max(n.width,o.width+n.paddingX+(t.image?s+n.image.margin:0)),l=Math.max(n.height,this.baseHeight);a&&(l=Math.max(l,o.height-2*n.text.y+n.paddingY)),t.image&&(l=Math.max(l,i+2*n.image.margin-2*n.text.y+n.paddingY)),this.setContentSize(c,l),o.setPositionRound(t.image?this.width/2+s/2+n.image.margin/2:this.width/2,
this.height/2+n.text.y),t.image&&(this.image=t.image,this.addChild(t.image),t.image.setPositionRound(s/2+2*n.image.margin,this.height/2+n.text.y+n.image.y)),this.customize(),this.setPosition(this.base),cleverapps.audio.playSound(bundles.main.urls.notification_effect),this.runAction(new cc.Sequence(new cc.MoveTo(.2,this.target),new cc.DelayTime(3),new cc.MoveTo(.5,this.base),new cc.RemoveSelf))},customize:function(){var e=cc.director.getWinSize();this.base=cc.p(e.width/2,e.height+this.height/2),this.target=cc.p(e.width/2,e.height-this.height/2-cleverapps.UI.getSceneOffsetY()+cleverapps.styles.Notification.targetY)}}),cleverapps.Notification.create=function(e,t){t=t||{};var s=cc.director.getRunningScene();if(s&&Messages.isInitialized()&&e&&cleverapps.allInitialized&&!cleverapps.scenes.isLoaderScene()){var i=s.getChildByTag(cleverapps.Notification.TAG);i?i.stopAllActions():((i=new cleverapps.Notification).setTag(cleverapps.Notification.TAG),s.addChild(i)),
this.leaveOnResize=t.leaveOnResize,i.setMessage(e,t)}},cleverapps.Notification.remove=function(e){var t=cc.director.getRunningScene();if(t&&!cleverapps.scenes.isLoaderScene()&&(!e||!this.leaveOnResize)){var s=t.getChildByTag(cleverapps.Notification.TAG);s&&s.removeFromParent()}},cleverapps.Notification.TAG=101,cleverapps.styles.Notification={zOrder:22,targetY:90,image:{margin:15,y:-10},text:{y:-30},height:200,width:150,paddingX:80,paddingY:30};var PagingScrollView=cc.Node.extend({ctor:function(e){this._super(),e=e||{},this.currentPage=e.beginPage?e.beginPage:0,this.amountPages=e.amountPages?e.amountPages:0;var t=this.styles=e.styles;this.direction=void 0!==t.direction?t.direction:PagingScrollView.DIRECTIONS.Horizontal,this.autoScroll=!t.noAutoScroll,this.visiblePages=t.visiblePages,this.prevPageShowed=t.prevEpisodeShowed,this.firstOffset=0,this.pageHeight=e.pageHeight,this.pageWidth=e.pageWidth,this.middlePage=!1,cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,
swallowTouches:e.swallowTouches,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this),e.noWheelScroll||cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){if(!this.isMoving&&!cleverapps.windows.list.length){var t=e._scrollY;if(0!=t)if(this.autoScroll)0<t?this.onNextPageListener():this.onPrevPageListener();else{t=0<t?cleverapps.styles.PagingScrollView.wheelScrollSpeed:-cleverapps.styles.PagingScrollView.wheelScrollSpeed,this.basePosition=this.container.getPosition();var s=this.getScrollLength();this.direction===PagingScrollView.DIRECTIONS.Horizontal?(t=Math.max(this.basePosition.x-this.firstOffset,Math.min(s.x+this.basePosition.x,t)),this.deltaMove([-t,0])):(t=Math.max(this.basePosition.y-this.firstOffset,Math.min(s.y+this.basePosition.y,t)),this.deltaMove([0,-t]))}}}.bind(this)},this),this.onNextPageListener=function(){},
this.onPrevPageListener=function(){},this.onScrolledToCurrentPage=function(){},this.container=new cc.Node,this.addChild(this.container),this.scheduleUpdate()},update:function(e){this._super(e),1<this.visiblePages&&this.calcCurrentPage(!0)},calcFirstOffset:function(){this.styles.firstOffset?this.firstOffset=this.styles.firstOffset:1<this.visiblePages&&(this.isHorizontal()?this.firstOffset=this.pageWidth/2:this.firstOffset=this.pageHeight/2)},getScrollLength:function(){var e={x:0,y:0};return this.direction===PagingScrollView.DIRECTIONS.Horizontal?e.x=(this.amountPages-this.visiblePages)*this.pageWidth:(e.y=(this.amountPages-this.visiblePages)*this.pageHeight+cleverapps.styles.PagingScrollView.comingSoonExtraLength[cleverapps.wideMode.mode],e.y-=2*cleverapps.UI.getSceneOffsetY()),e},onTouchBegan:function(e){if(cleverapps.metha.isFocused())return!1;if(this.touchBeganId=e.getID(),this.isMoving){if(this.autoScroll)return!1;this.container.stopAllActions(),this.calcCurrentPage()}
var t=this.convertTouchToNodeSpace(e);return this.horizontalLookDirection=void 0,this.basePoint=t,this.prevPoint=t,this.prevPointTime=0,this.prevPointCalcTimes=0,this.deltaPoint=0,this.basePosition=this.container.getPosition(),this.isMoving=!1,cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)},deltaMove:function(e,t){var s=this.getScrollLength();if(this.isHorizontal()){if(this.basePosition.x+e[0]>this.firstOffset+1e-6||this.basePosition.x+e[0]+1e-6<-s.x)return void(this.isMoving=!1)}else if(this.basePosition.y+e[1]>this.firstOffset+1e-6||this.basePosition.y+e[1]+1e-6<-s.y)return void(this.isMoving=!1);var i=t?PagingScrollView.MOVE_TRESHOLD:0;(Math.abs(e[0])>i*this.pageWidth||Math.abs(e[1])>i*this.pageHeight)&&(this.isMoving=!0,this.showPages(e)),this.isMoving&&(cleverapps.audio.playSound(bundles.main.urls.pagingscroll),t?(this.container.setPosition(this.basePosition.x+e[0],this.basePosition.y+e[1]),this.autoScroll||this.calcCurrentPage()):(this.showPages(e),
this.container.runAction(new cc.Sequence(new cc.MoveTo(.3,{x:this.basePosition.x+e[0],y:this.basePosition.y+e[1]}),new cc.CallFunc(function(){this.isMoving=!1,this.calcCurrentPage()}.bind(this))))))},onTouchMoved:function(e){if(this.touchBeganId!==e.getID())return!1;var t=this.convertTouchToNodeSpace(e),s=[t.x-this.basePoint.x,t.y-this.basePoint.y];if(!this.autoScroll&&this.isVertical()&&this.width<cleverapps.styles.SCENE_MAX_WIDTH&&!cleverapps.styles.horizontalScrollDisabled&&(void 0===this.horizontalLookDirection&&(Math.abs(s[0])>PagingScrollView.MOVE_TRESHOLD*this.pageWidth||Math.abs(s[1])>PagingScrollView.MOVE_TRESHOLD*this.pageHeight)&&(Math.abs(s[0])>2*Math.abs(s[1])?this.horizontalLookDirection=!0:this.horizontalLookDirection=!1),this.horizontalLookDirection)){var i=s[0];return i=Math.min(i,(cleverapps.styles.SCENE_MAX_WIDTH-this.width)/2-this.basePosition.x),i=Math.max(i,-(cleverapps.styles.SCENE_MAX_WIDTH-this.width)/2-this.basePosition.x),void this.container.setPosition(
this.basePosition.x+i,this.basePosition.y)}this.isHorizontal()?s[1]=0:s[0]=0,this.autoScroll||this.calcDeltaPoint(t),this.deltaMove(s,!0)},onEnter:function(){this._super(),this.showCurrentPageOnly()},onExitTransitionDidStart:function(){this._super(),this.showCurrentPageOnly()},showPages:function(e){for(var t={},s=0;s<this.visiblePages;s++)t[this.currentPage+s]=!0;this.prevPageShowed&&(t[this.currentPage-1]=!0);var i=this.currentPage+(e[0]<0||e[1]<0?this.visiblePages:-1);if(t[i]=!0,"number"==typeof this.middlePage)t[this.middlePage]&&(t[this.middlePage+1]=!0),t[this.middlePage]=!0;else{var n=this.currentPage+(e[0]<0||e[1]<0?-1:this.visiblePages);t[n]=!0}this.getPages().forEach(function(e){e.setVisible(t[e.pageNo])}.bind(this))},getPages:function(){return this.container.getChildren().filter(function(e){return void 0!==e.pageNo})},getVisiblePages:function(){return this.container.getChildren().filter(function(e){return void 0!==e.pageNo&&e.visible})},showCurrentPageOnly:function(){
this.getPages().forEach(function(e){e.setVisible(this.currentPage+(this.prevPageShowed?-1:0)<=e.pageNo&&e.pageNo<this.currentPage+this.visiblePages||this.middlePage===e.pageNo)}.bind(this))},isHorizontal:function(){return this.direction===PagingScrollView.DIRECTIONS.Horizontal},isVertical:function(){return!this.isHorizontal()},getCurrentPagePosition:function(e){void 0===e&&(e=this.currentPage);var t=new cc.p(this.isHorizontal()?-e*this.pageWidth:0,this.isVertical()?-e*this.pageHeight:0);if(1<this.visiblePages){t=cc.p(t.x+(this.isHorizontal()?this.firstOffset:0),t.y+(this.isVertical()?this.firstOffset:0));var s=this.getScrollLength();this.isHorizontal()?t.x=Math.min(this.firstOffset,Math.max(t.x,-s.x)):t.y=Math.min(this.firstOffset,Math.max(t.y,-s.y))}return t},calcCurrentPage:function(e){var t=this.container.getPosition(),s=this.pageWidth;this.isHorizontal()?t=t.x:(t=t.y,s=this.pageHeight),0<t&&(t=0);var i=this.currentPage;this.currentPage=cleverapps.config.rpg?Math.floor(-t/s
)+1:Math.round(-t/s),e&&i===this.currentPage||(this.middlePage=this.currentPage+this.visiblePages,this.showCurrentPageOnly(),i<this.currentPage?this.onNextPageListener():i>this.currentPage&&this.onPrevPageListener())},scrollToPositionInPage:function(e,t){var s,i=this.getCurrentPagePosition();this.direction===PagingScrollView.DIRECTIONS.Horizontal?((s=this.width/2+e.x)<0&&0===this.currentPage&&(s=0),i.x=Math.max(this.container.x-s,-(this.amountPages-1)*this.width)):((s=this.height/2+e.y-.3*this.height)<0&&0===this.currentPage&&(s=0),i.y=Math.max(this.container.y-s,-(this.amountPages-1)*this.height),i.y<0&&(i.y+=cleverapps.UI.getSceneOffsetY())),this.scrollToPosition(i,t)},scrollToPosition:function(e,t,s){t?(this.container.setPosition(e),this.calcCurrentPage()):(this.container.stopAllActions(),s=s||1,this.showPages([e.x-this.container.x,e.y-this.container.y]),this.isMoving=!0,this.container.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.MoveTo(s,e),new cc.CallFunc(function(){
this.calcCurrentPage(),this.isMoving=!1}.bind(this)))))},scrollToCurrentPage:function(e,t,s,i){var n=this.getCurrentPagePosition(i);if(e)this.container.setPosition(n),this.autoScroll?this.showCurrentPageOnly():this.calcCurrentPage(),this.onScrolledToCurrentPage();else{t&&(cleverapps.audio.playSound(bundles.main.urls.window_effect),"riddles"===cleverapps.config.name&&(n=cc.p(n.x+(this.isHorizontal()?.167*this.pageWidth:0),n.y+(this.isVertical()?.167*this.pageHeight:0)))),this.container.stopAllActions();var o=.25;s&&(o=cleverapps.styles.PagingScrollView.slowScroll.timeout),this.showPages([this.container.x-n.x,n.y-this.container.y]),this.isMoving=!0,this.container.runAction(new cc.Sequence(new cc.MoveTo(o,n),new cc.CallFunc(function(){this.autoScroll?this.showCurrentPageOnly():this.calcCurrentPage(),this.onScrolledToCurrentPage(),this.isMoving=!1}.bind(this))))}},calcDeltaPoint:function(e){var t=Date.now();if(0===this.prevPointTime)return this.prevPointTime=t,void(this.prevPoint=e)
;this.prevPointTime<t-PagingScrollView.SCROLL_SPEED_PERIODS[this.prevPointCalcTimes]&&(this.prevPointTime<t-200&&(this.prevPoint=e),this.deltaPoint=this.isHorizontal()?e.x-this.prevPoint.x:e.y-this.prevPoint.y,this.deltaPoint=this.deltaPoint/(t-this.prevPointTime)*cleverapps.styles.PagingScrollView.touchScrollSpeedLevel,this.prevPointTime=t,this.prevPointCalcTimes<PagingScrollView.SCROLL_SPEED_PERIODS.length-1&&this.prevPointCalcTimes++,this.prevPoint=e)},onTouchEnded:function(e){if(this.touchBeganId!==e.getID())return!1;if(this.isMoving=!1,this.autoScroll){var t=this.getCurrentPagePosition(),s=this.container.getPosition();Math.abs(t.x-s.x)>PagingScrollView.SWIPE_TRESHOLD*this.pageWidth||Math.abs(t.y-s.y)>PagingScrollView.SWIPE_TRESHOLD*this.pageHeight?s.x<t.x||s.y<t.y?this.onNextPageListener():this.onPrevPageListener():this.scrollToCurrentPage(!1)}else{if(this.horizontalLookDirection)return this.isMoving=!0,void this.container.runAction(new cc.Sequence(new cc.MoveTo(.5,{x:0,
y:this.basePosition.y}).easing(cc.easeOut(3)),new cc.CallFunc(function(){this.isMoving=!1}.bind(this))));this.calcCurrentPage(),this.calcDeltaPoint(this.convertTouchToNodeSpace(e)),this.deltaPoint=Math.max(Math.min(Math.round(this.deltaPoint),5),-5),this.showPages([this.deltaPoint,this.deltaPoint]),this.isMoving=!0;var i=this.container.getPosition(),n=Math.max(.5,Math.sqrt(Math.abs(this.deltaPoint))/2),o=this.getScrollLength();this.direction===PagingScrollView.DIRECTIONS.Horizontal?(i.x=Math.min(this.firstOffset,Math.max(i.x+this.deltaPoint*cleverapps.styles.PagingScrollView.scrollInertia,-o.x)),i.y=0):(i.x=0,i.y=Math.min(this.firstOffset,Math.max(i.y+this.deltaPoint*cleverapps.styles.PagingScrollView.scrollInertia,-o.y))),this.container.runAction(new cc.Sequence(new cc.MoveTo(n,i).easing(cc.easeOut(2)),new cc.CallFunc(function(){this.calcCurrentPage(),this.isMoving=!1}.bind(this))))}},addPage:function(e){this.container.addChild(e),e.onShow&&e.onShow(),
this.isMoving||this.showCurrentPageOnly()}});cleverapps.styles.PagingScrollView={touchScrollSpeedLevel:2,wheelScrollSpeed:700,scrollInertia:200,comingSoonExtraLength:[0,0,0],slowScroll:{timeout:.8}},PagingScrollView.DIRECTIONS={Horizontal:0,Vertical:1},PagingScrollView.MOVE_TRESHOLD=.01,PagingScrollView.SWIPE_TRESHOLD=.05,PagingScrollView.SCROLL_SPEED_PERIODS=[25,50,75,100];var MapScrollView=cc.Node.extend({ctor:function(){this._super(),this.container=new cc.Node,this.addChild(this.container),this.scheduleUpdate(),this.scrollHandler=new cleverapps.UI.MapScrollHandler(this),this.zoom=1,this.updateChildren=cleverapps.throttle(25,this.checkChildrenVisibility.bind(this))},zoomTo:function(t){var s=this.zoom,i=Date.now(),n=(t.zoom-s)/t.timeout;this._zoomInterval=setInterval(this.createListener(function(){var e=Date.now()-i;if(e>=t.timeout)return this.setZoom(t.zoom),clearInterval(this._zoomInterval),void(t.onComplete&&t.onComplete());this.setZoom(s+n*e,t.centerPoint)}),13)},setZoom:function(
e,t){this.scrollHandler.stopAutoScroll();var s=cc.director.getWinSize(),i=this.getContainerSize();e=Math.max(e,cleverapps.styles.WorldMap.zoom.minScale,s.width/i.width,s.height/i.height),e=Math.min(e,1.1);var n=this.zoom;this.zoom=e,this.setScale(this.zoom);var o=this.getContainerPosition();this.setContentSize2(Math.ceil(s.width/this.zoom),Math.ceil(s.height/this.zoom));var r=0,a=0;if(n&&(r=Math.ceil(s.width/this.zoom)-Math.ceil(s.width/n),a=Math.ceil(s.height/this.zoom)-Math.ceil(s.height/n)),t){var c=Math.abs(t.x)+s.width/2-i.width/2;0<c&&(0<t.x?r-=c:r+=c);var l=Math.abs(t.y)+s.height/2-i.height/2;0<l&&(0<t.y?a-=l:a+=l)}this.setContainerPosition(this.availableScrollPosition({x:o.x+r/2,y:o.y+a/2}),this.zoom<n)},setContainerSize:function(e){this.innerWidth=e.width,this.innerHeight=e.height,this.container.setContentSize2(e)},getContainerSize:function(){return this.container.getContentSize()},getContainerPosition:function(){return this.container.getPosition()},
setContainerPosition:function(e,t){(e.x!==this.container.getPositionX()||e.y!==this.container.getPositionY()||t)&&(this.container.setPosition(e),this.updateChildren(),this.scrollHandler.afterContainerMove())},update:function(e){this._super(e),this.scrollHandler.processAutoScroll(e)},onEnter:function(){this._super(),this.addControls()},checkChildrenVisibility:function(){this.container.getChildren().forEach(function(e){!e.visible&&this.isInContainer(e)?e.visible=!0:e.visible&&!this.isInContainer(e)&&(e.visible=!1)},this)},isInContainer:function(e){var t=cleverapps.styles.MapScrollView.visiblePadding,s=this.getContainerPosition(),i=this.getContentSize(),n=cc.rect(-s.x,-s.y,i.width,i.height),o=e.getBoundingBox();o.x-=t.width/2,o.y-=t.height/2,o.width+=t.width/2,o.height+=t.height/2;var r=cc.rectIntersection(n,o);return 0<r.width&&0<r.height},addControls:function(){cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:function(e){if(cleverapps.metha.isControlEnabled()){
var t=e._scrollY;0!==t&&(t=0<t?.05:-.05,this.setZoom(this.zoom+t))}}.bind(this)},this),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchEnded.bind(this)},this),cc.sys.isMobile&&cc.sys.capabilities.touches&&this.addPinchZoom()},addPinchZoom:function(){var n={},o=0,r=function(){var e=Object.keys(n).slice(0,2).map(function(e){return n[e]},this),t=e[0],s=e[1];return Math.abs(t.x-s.x)+Math.abs(t.y-s.y)},e=function(e){for(var t=0;t<e.length&&t<2;t++)n[e[t].getID()]=e[t].getLocationInView();1<Object.keys(n).length&&(this.pinchZooming=!0,o=r())}.bind(this),t=function(e){for(var t=0;t<e.length&&t<2;t++)n[e[t].getID()]=e[t].getLocationInView();if(cleverapps.metha.isControlEnabled()&&1<Object.keys(n).length){var s=r(),i=o-s;3<Math.abs(i)&&(o=s,this.setZoom(this.zoom-85e-5*i))}}.bind(this),s=function(e){for(
var t=0;t<e.length;t++)delete n[e[t].getID()];Object.keys(n).length<2&&(this.pinchZooming=!1)}.bind(this);cc.eventManager.addListener({event:cc.EventListener.TOUCH_ALL_AT_ONCE,onTouchesBegan:e,onTouchesMoved:t,onTouchesCancelled:s,onTouchesEnded:s},this)},onTouchBegan:function(e){return!!cleverapps.metha.isControlEnabled()&&(this.container.stopAllActions(),this.scrollHandler.handlePress(),cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),this.convertTouchToNodeSpace(e)))},onTouchMoved:function(e){if(!cleverapps.metha.isControlEnabled())return!1;var t=this.convertToNodeSpace(e.getLocation()),s=this.convertToNodeSpace(e.getPreviousLocation()),i=cc.pSub(t,s);this.pinchZooming||(this.scrollHandler.gatherMoveData(i),this.moveContainer(i))},onTouchEnded:function(e){if(!cleverapps.metha.isControlEnabled())return!1;if(!this.pinchZooming){var t=this.convertToNodeSpace(e.getLocation()),s=this.convertToNodeSpace(e.getPreviousLocation()),i=cc.pSub(t,s);this.scrollHandler.handleRelease(i)}},
moveContainer:function(e){var t=cc.pAdd(this.getContainerPosition(),e);this.setContainerPosition(t)}});cleverapps.styles.MapScrollView={visiblePadding:{width:40,height:40}};var PagesViewParallax=function(e,t,s){if(this.parallaxBackgrounds=[],this.direction=s,e&&e.layers){for(var i=cleverapps.UI.getSceneSize(),n="scene"===e.width?i.width:e.width,o="scene"===e.height?i.height:e.height,r=0;r<e.layers[cleverapps.wideMode.mode];r++){var a,c=bundles.main.urls["episodes_bg_jpg_"+r],l=bundles[e.bundle];if(l&&(a=l.jsons["side_animation_"+r]),c||a){var p=new ParallaxBackground(e.speed[r],this.direction,function(e){var t=new cc.Node;if(t.setContentSize2(n,o),t.setAnchorPoint2(),c){var s=new cc.Sprite(c);s.setPositionRound(t.width/2,t.height/2),this.parallaxBackgrounds.push(s),t.addChild(s)}if(a){var i=new cleverapps.Spine(a);i.setAnimation(0,"animation",!0),t.addChild(i),i.setPositionRound(t.width/2,t.height/2)}return t}.bind(this));p.setLocalZOrder(e.zIndex[r]),t.addChild(p)}}this.updateScale()}
};PagesViewParallax.prototype.updateScale=function(){var s=cc.director.getWinSize();this.parallaxBackgrounds.forEach(function(e){var t=Math.max(s.width/e.width,s.height/e.height);e.setScale(t)})};var ParallaxBackground=cc.Node.extend({ctor:function(e,t,s){this._super(),this.ratio=e,this.direction=t;var i=this.frame1=new ParallaxFrame(s(0),cc.p(0,0),t);this.addChild(i);var n=this.frame2=new ParallaxFrame(s(1),cc.p(i.width-2,i.height-2),t);this.addChild(n),this.scheduleUpdate()},onEnterTransitionDidFinish:function(){this._super(),this.updatePosition()},update:function(e){this._super(e),this.updatePosition()},updatePosition:function(){this.y=-this.parent.y*(1-this.ratio),this.x=-this.parent.x*(1-this.ratio),this.frame1.updatePosition(),this.frame2.updatePosition()}}),ParallaxFrame=cc.Node.extend({ctor:function(e,t,s){this._super(),this.direction=s,this.offset=t,this.frame=e,this.addChild(e),this.setContentSize2(e.getContentSize()),this.setAnchorPoint2(),this.setPositionRound(this.width/2,
this.height/2)},updatePosition:function(){var e=cleverapps.UI.getSceneSize(),t=this.frame,s=t.width,i=t.height;if(this.direction===PagingScrollView.DIRECTIONS.Horizontal){var n=-(this.parent.parent.x+this.parent.x);t.x=Math.floor(n/s)*s+s/2+this.offset.x,t.y=i/2,t.visible=0<=-n+t.x+s/2&&-n+t.x-s/2<e.width}else{var o=-(this.parent.parent.y+this.parent.y);t.x=s/2,t.y=Math.floor(o/i)*i+i/2+this.offset.y,t.visible=0<=-o+t.y+i/2&&-o+t.y-i/2<e.height}}}),Fireworks=cc.Node.extend({ctor:function(e,t){this._super(),this.loop=void 0===e||e,cleverapps.bundleLoader.loadBundle("fireworks",{onSuccess:function(){this.sound=t||bundles.fireworks.urls.fireworks_effect,this.runOnePass()}.bind(this)}),this.setLocalZOrder(100)},runOnePass:function(){var e=cleverapps.styles.Fireworks.delays,t=cleverapps.styles.SCENE_HEIGHT*cleverapps.styles.SCENE_MAX_WIDTH,s=cleverapps.UI.getSceneSize(),i=s.height*s.width,n=Math.round(i/t*e.length);e=(e=e.sort(function(e,t){return Math.random()-.5})).slice(0,n)
;var o=cleverapps.wait(e.length,this.runOnePass.bind(this));e.forEach(function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e/1e3),new cc.CallFunc(function(){this.createFirework(),this.loop&&o()}.bind(this))))}.bind(this))},createFirework:function(e){if(!cleverapps.flags.fireworkDisabled){var t=FireworksAnimation.Create();t.setScale(.3*Math.random()+.7),t.setAnimation(0,"animation"+(Math.floor(Math.random()*Fireworks.AMOUNT_ANIMATIONS)+1),!1),t.setCompleteListener(function(){t.removeFromParent(),cc.pool.putInPool(t)});var s=cleverapps.UI.getSceneSize();t.setPositionRound({random:{start:0,end:s.width}},{random:{start:Math.round(s.height/3),end:s.height}}),this.addChild(t),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){cleverapps.audio.playSound(this.sound)}.bind(this))))}}}),FireworksAnimation=cleverapps.Spine.extend({ctor:function(){this._super(bundles.fireworks.jsons.fireworks_json)}});FireworksAnimation.Create=function(){return cc.pool.hasObject(
FireworksAnimation)?cc.pool.getFromPool(FireworksAnimation):new FireworksAnimation},Fireworks.AMOUNT_ANIMATIONS=5,cleverapps.styles.Fireworks={delays:[0,100,200,300,400,500,3e3,3050,3130,3330,3400,4600,6e3,6030,6130,6200,6400,6420,6450]};var FingerView=cc.Node.extend({ctor:function(t){t=t||{},this._super(),this.setLocalZOrder(100),this.setAnchorPoint2(),this.setScale(t.scaleX||1,t.scaleY||1),this.finger=new cc.Sprite(t.image?t.image:bundles.finger.frames.tutorial_hand_png),this.finger.setAnchorPoint(FingerView.ANCHOR_POINT),this.moveSpeed=500,this.actions=[],t.pathColor&&(this.pathNode=new cleverapps.Path(cc.color(t.pathColor.r,t.pathColor.g,t.pathColor.b,FingerView.PATH_BASE_ALPHA)),this.pathNode.lineWidth=FingerView.PATH_LINE_WIDTH,this.addChild(this.pathNode,-2),this.pathNode.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(.02),new cc.CallFunc(this.drawPath.bind(this)))))),this.addChild(this.finger),this.finger.setOpacity(0),
t.control&&cleverapps.metha.registerControl(t.control,this.createListener(function(e){this.stopAllActions(),e&&t.showDelay?this.runAction(new cc.Sequence(new cc.DelayTime(t.showDelay),new cc.Show)):this.setVisible(e)}.bind(this)))},standardLoop:function(e){((e=e||{}).delayOnBegin||e.delayOnBeginAndFinish)&&this.delay(e.delay||1),this.fadeIn(e.fadeInPosition||{x:0,y:0},e.fadeInStartPosition),this.addPressLoops(e.loops||2,1===e.loops?.3:.1),this.fadeOut(),e.delayOnBegin&&!e.delayOnBeginAndFinish||this.delay(e.delay||1),e.runOnce?this.runOnce(function(){this.removeFromParent()}.bind(this)):this.run({looped:!0,onIterationFinish:e.onIterationFinish})},addPressLoops:function(e,t){for(var s=0;s<(e||1);s++)this.delay(.1),this.press(),this.delay(t||.1),this.unPress()},clearActions:function(){this.actions=[]},drawPath:function(){this.pathNode.draw(this.finger.getPosition())},addAction:function(e){this.actions.push(e)},run:function(e){
FingerView.currentFinger&&FingerView.currentFinger.removeFromParent(),(FingerView.currentFinger=this).registerCleanupCallback(function(){FingerView.currentFinger===this&&(FingerView.currentFinger=void 0)}.bind(this)),this.currentAction=0,this.runOptions=e||{},this.startCurrentAction()},runOnce:function(e){this.run({looped:!1,onFinish:function(){this.clearActions(),e&&e()}.bind(this)})},startCurrentAction:function(){if(0!==this.actions.length){if(this.currentAction===this.actions.length){if(!this.runOptions.looped)return void(this.runOptions.onFinish&&this.runOptions.onFinish());this.currentAction=0,this.runOptions.onIterationFinish&&this.runOptions.onIterationFinish()}this.actions[this.currentAction](this.nextAction.bind(this))}},nextAction:function(){this.currentAction++,this.startCurrentAction()},fadeIn:function(t,s){s=s||cc.p(t.x,t.y+cleverapps.styles.FingerView.dy),this.addAction(function(e){this.finger.setOpacity(0),this.finger.setScale(1),this.finger.setRotation(
FingerView.FINGER_UNPRESSED_ANGLE),this.pressed=!1,this.finger.setPosition(s),this.finger.runAction(new cc.Sequence(new cc.MoveTo(.3,cc.p(t.x+cleverapps.styles.FingerView.deltaXforCircle,t.y)),new cc.CallFunc(e))),this.finger.runAction(new cc.FadeIn(.3))}.bind(this))},fadeOut:function(){this.addAction(function(e){this.finger.runAction(new cc.MoveTo(.3,cc.p(this.finger.x,this.finger.y-cleverapps.styles.FingerView.dy))),this.finger.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.CallFunc(e)))}.bind(this))},delay:function(t){this.addAction(function(e){this.finger.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(e)))}.bind(this))},moveTo:function(s){this.addAction(function(e){var t=Math.sqrt((s.x-this.finger.x)*(s.x-this.finger.x)+(s.y-this.finger.y)*(s.y-this.finger.y))/this.moveSpeed;this.finger.runAction(new cc.Sequence(new cc.MoveTo(t,s),new cc.CallFunc(function(){this.pressed&&this.pathNode&&this.pathNode.push(s),e()}.bind(this))))}.bind(this))},unPress:function(){
this.addAction(function(e){this.pressed=!1,this.finger.runAction(new cc.RotateTo(.2,FingerView.FINGER_UNPRESSED_ANGLE)),this.pathNode&&this.pathNode.animateFadeOut(400),this.finger.runAction(new cc.Sequence(new cc.ScaleTo(.2,1),new cc.CallFunc(e)))}.bind(this))},press:function(i){i=i||{},this.addAction(function(s){this.pressed=!0,this.pathNode&&(this.pathNode.reset(),this.pathNode.push(this.finger.getPosition())),this.finger.runAction(new cc.RotateTo(.2,FingerView.FINGER_PRESSED_ANGLE)),this.finger.runAction(new cc.Sequence(new cc.ScaleTo(.2,.7),new cc.CallFunc(function(){if(i.noCircle)s();else{var e=new cc.Sprite(bundles.finger.frames.tutorial_click_png),t=this.finger.getPosition();e.setPosition(cc.p(t.x-cleverapps.styles.FingerView.deltaXforCircle,t.y)),e.setScale(0),this.addChild(e,-1),e.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.FadeTo(.3,0),new cc.RemoveSelf)),e.runAction(new cc.ScaleTo(.5,1)),s()}}.bind(this))))}.bind(this))},getFingerPosition:function(){
return this.finger.getPosition()},blinkTo:function(t){this.addAction(function(e){this.finger.setPosition(t),e()}.bind(this))}});FingerView.BUNDLES=["finger"],FingerView.ANCHOR_POINT=cc.p(.1,.9),FingerView.PATH_BASE_ALPHA=255,FingerView.PATH_SEGMENTS=100,FingerView.PATH_LINE_WIDTH=15,FingerView.FINGER_PRESSED_ANGLE=0,FingerView.FINGER_UNPRESSED_ANGLE=-7,cleverapps.styles.FingerView={dy:50,deltaXforCircle:0},cleverapps.CountDownView=cc.Node.extend({ctor:function(e,t){var s;this.style=t||{},s=this.style.background_content?this.style.background_content:cleverapps.UI.createSprite(this.style.background_image),this._super(),this.setAnchorPoint(.5,.5),s&&(this.setContentSize2(s.getContentSize()),s.setPositionRound(this.width/2,this.height/2),this.addChild(s)),s.setCascadeOpacityEnabled(!0),s.setCascadeColorEnabled(!0),this.countDown=e;var i=new cc.Node;i.setPositionRound(this.width/2,this.height/2),i.setCascadeOpacityEnabled(!0),i.setCascadeColorEnabled(!0),this.addChild(i),this.leftTimeText=i
,this.refresh(),this.width||(this.setContentSize2(this.text.width*this.text.scaleX,this.text.height*this.text.scaleY),this.updatePosition()),this.countDown.onSecond=this.createListener(this.refresh.bind(this))},fitTo:function(e,t){this.text&&this.text.fitTo(e,t)},recreateText:function(e){this.text&&this.text.removeFromParent(!0),cleverapps.UI.ImageFont.IsApplicable(this.style.font,e)?this.text=new cleverapps.UI.ImageFont(e,this.style.font,{fixedNumberWidth:!0}):this.text=cleverapps.UI.generateOnlyText(e,this.style.font),this.leftTimeText.addChild(this.text)},setString:function(e){this.text?cleverapps.UI.ImageFont.intertypeSetString({textObj:this.text,string:e,font:this.style.font,recreateFunc:this.recreateText.bind(this)}):this.recreateText(e)},updatePosition:function(){var e=this.style.timerPosition;this.text instanceof cleverapps.UI.LabelTTF&&(e=this.style.regularFontTimerPosition||this.style.timerPosition),e=e||cleverapps.styles.CountDownView.timerPosition,
this.leftTimeText.setPositionRound(this.width/2+e.x,this.height/2+e.y)},refresh:function(){var e=cleverapps.intervalToString(this.countDown.getTimeLeft(),this.style.showHours);this.setString(e),this.updatePosition()},whatToDoOnStop:function(){this.countDown.permanent?this.countDown.onSecond=function(){}:this.countDown.remove()},cleanup:function(){this._super(),this.whatToDoOnStop()}}),cleverapps.CountDown=function(e,t){this.onSecond=function(){},t=t||{},this.onFinish=t.onFinish||function(){},this.onTick=t.onTick||function(){},this.permanent=t.permanent,this.pauseOnGameHide=t.pauseOnGameHide,e<=0?this.onFinish():this.resetTimeLeft(e),cleverapps.CountDownManager.isPaused&&this.pause()},cleverapps.CountDown.prototype.remove=function(){void 0!==this.interval&&cleverapps.CountDownManager.removeListener(this.interval),this.interval=void 0,this.onFinish=function(){},this.onSecond=function(){}},cleverapps.CountDown.prototype.stop=function(){this.remove(),this.timeStop=Date.now()},
cleverapps.CountDown.prototype.pause=function(){this.pauseOnGameHide&&!this.isPaused()&&this.isRunning()&&(this.timeFinish-Date.now()<=0||(this.timePause=Date.now(),cleverapps.CountDownManager.pause(this.interval)))},cleverapps.CountDown.prototype.resume=function(){this.isPaused()&&(this.timeFinish=Date.now()+(this.timeFinish-this.timePause),delete this.timePause,cleverapps.CountDownManager.resume(this.interval))},cleverapps.CountDown.prototype.isPaused=function(){return void 0!==this.timePause},cleverapps.CountDown.prototype.isRunning=function(){return void 0!==this.interval},cleverapps.CountDown.prototype.getTimeLeft=function(){return this.timeFinish?this.timeStop?this.timeFinish-this.timeStop:Math.max(this.timeFinish-Date.now(),0):0},cleverapps.CountDown.prototype.resetTimeLeft=function(e){this.resume(),this.timeStart=Date.now(),this.timeFinish=this.timeStart+e,void 0===this.interval&&(this.interval=cleverapps.CountDownManager.addListener(this))},
cleverapps.CountDown.prototype.nextSecond=function(e){var t=this.timeFinish-e;t<0&&(t=0),this.onTick(t),this.onSecond(t),0===t&&(cleverapps.CountDownManager.removeListener(this.interval),this.interval=void 0,this.onFinish())},cleverapps.LongTimeout=function(e,t,s){t<=cleverapps.LongTimeout.THRESHOLD?this.timeout=setTimeout(e,t):((s=s||{}).onFinish=e,cleverapps.CountDown.call(this,t,s))},cleverapps.LongTimeout.prototype=Object.create(cleverapps.CountDown.prototype),cleverapps.LongTimeout.prototype.constructor=cleverapps.CountDown,cleverapps.LongTimeout.prototype.remove=function(){void 0!==this.timeout?clearTimeout(this.timeout):cleverapps.CountDown.prototype.remove.apply(this,arguments)},cleverapps.CountDownManager={listeners:{},pausedListeners:{},uid:0,interval:!1,isPaused:!1,onTick:function(){var e=Date.now();for(var t in this.listeners)this.listeners[t]&&this.listeners[t].nextSecond(e)},initHideListeners:function(){cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){for(
var e in this.isPaused=!1,this.pausedListeners)this.pausedListeners[e].resume()}.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){for(var e in this.isPaused=!0,this.listeners)this.listeners[e].pause()}.bind(this))},addListener:function(e){var t=this.uid;return this.listeners[t]=e,this.uid++,!1===this.interval&&(this.interval=setInterval(this.onTick.bind(this),cleverapps.CountDown.INTERVAL),this.initHideListeners()),t},removeListener:function(e){delete this.listeners[e]},pause:function(e){this.listeners[e]&&(this.pausedListeners[e]=this.listeners[e],this.removeListener(e))},resume:function(e){this.pausedListeners[e]&&(this.listeners[e]=this.pausedListeners[e],delete this.pausedListeners[e])}},cleverapps.CountDown.INTERVAL=1e3,cleverapps.LongTimeout.THRESHOLD=cleverapps.CountDown.INTERVAL,cleverapps.styles.CountDownView={timerPosition:{x:0,y:0}};var clearTimeoutSuper=clearTimeout,clearIntervalSuper=clearInterval;clearTimeout=function(e){
e instanceof cleverapps.CountDown?e.remove():clearTimeoutSuper(e)},clearInterval=function(e){e instanceof cleverapps.CountDown?e.remove():clearIntervalSuper(e)};var ExitControlButton={onClicked:function(){cc.director.getRunningScene().closeAction()},isAvailableAtScene:function(){return cleverapps.environment.isMainScene()?!!cleverapps.administrator:!!cleverapps.environment.isEditorScene()||(!cleverapps.environment.isGameScene()||-1===["riddles","heroes"].indexOf(config.projectName))&&(!cleverapps.environment.isChatScene()&&(!!cleverapps.environment.isAdministratorScene()||levels&&levels.user&&levels.user.checkAvailable({level:1})))}},FullscreenControlButton={onClicked:function(){FullscreenControlButton.fullscreenElement()?FullscreenControlButton.exitFullscreen():FullscreenControlButton.requestFullscreen()},isAvailableAtScene:function(){if(cleverapps.config.wysiwygMode)return!1;if(cleverapps.config.editorMode&&"merge"!==cleverapps.config.type)return!1;if(
cleverapps.environment.isChatScene()||cleverapps.environment.isMiniGameScene())return!1;if(cc.sys.isNative||cc.sys.isMobile||cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL||cleverapps.isInstant()||cleverapps.Mobage.isAppropriate()||cleverapps.MobileOK.isAppropriate())return!1;var e=document.documentElement;return e.requestFullscreen||e.webkitRequestFullscreen||e.msRequestFullscreen||e.mozRequestFullscreen},fullscreenElement:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullscreenElement},requestFullscreen:function(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullscreen&&e.mozRequestFullscreen()},exitFullscreen:function(e){FullscreenControlButton.isAvailableAtScene()&&FullscreenControlButton.fullscreenElement()?(document.exitFullscreen?document.exitFullscreen(
):document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozExitFullscreen&&document.mozExitFullscreen(),e&&setTimeout(e,100)):e&&e()}},MenuControlButton={onClicked:function(){cleverapps.metha.display({focus:"SettingsWindowFromMenu",action:function(e){new SettingsWindow,cleverapps.metha.onceNoWindowsListener=e}})},isAvailableAtScene:function(){return!(cleverapps.environment.isEditorScene()||cleverapps.environment.isChatScene()||cleverapps.environment.isMiniGameScene())},needToAddInsidePanel:function(){return cleverapps.environment.isGameScene()&&"undefined"!=typeof ControlsPanel&&ControlsPanel.IS_DOWN()&&-1!==["riddles","heroes"].indexOf(cleverapps.config.name)}},SceneControlButton=cleverapps.UI.Button.extend({ctor:function(e){e=e||{},this.options=e;var t=cleverapps.styles.SceneControlButton;if(this._super({button_png:e.button_png?e.button_png:bundles.controlbuttons.frames.button_png,
button_on_png:e.button_on_png?e.button_on_png:bundles.controlbuttons.frames.button_on_png,onClicked:e.logic.onClicked,content:new cc.Sprite(e.icon),contentPadding:t.contentPadding,mark:e.mark}),e.mark){this.setMarkVisible(!1);var s=function(){this.setMarkVisible(cleverapps.chat.hasUnread&&("merge"===cleverapps.config.type||!Game.currentGame))}.bind(this);cleverapps.chat.load(s,s)}SceneDecors.add(this,cleverapps.skins.getSlot("sceneControlButton",{target:this})),this.baseScale=t.scale[cleverapps.wideMode.mode],this.setScale(this.baseScale)}});cleverapps.styles.SceneControlButton={scale:[1,1,1],contentPadding:0};var SceneControlButtonsView=cc.Node.extend({ctor:function(){this._super();var e=SceneControlButtonsView.controlButtons.filter(function(e){return e.logic.isAvailableAtScene()}).map(function(e){return new SceneControlButton(e)}),t=cleverapps.styles.SceneControlButtonsView,s=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin});s.setAnchorPoint2(0,0),
this.addChild(s),this.setContentSize(s.getContentSize()),this.setAnchorPoint2(),this.setLocalZOrder(2),this.setPositionRound(t.position),cleverapps.environment.isWysiwygScene()&&"merge"===cleverapps.config.type&&(this.setScale(.5),this.setPositionRound({x:{align:"right",dx:-20},y:{align:"top",dy:-10}})),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("SceneControlButtonsView",this)}});cleverapps.styles.SceneControlButtonsView={margin:16,position:{x:{align:"right",dx:-20},y:{align:"top",dy:-10}}},SceneControlButtonsView.menuButtonData={logic:MenuControlButton,icon:bundles.controlbuttons.frames.menu_icon_png,mark:!0},SceneControlButtonsView.controlButtons=[{logic:ExitControlButton,icon:bundles.controlbuttons.frames.back_icon_png,button_png:bundles.controlbuttons.frames.back_button_png,button_on_png:bundles.controlbuttons.frames.back_button_on_png},{logic:FullscreenControlButton,icon:bundles.controlbuttons.frames.fullscreen_icon_png},
SceneControlButtonsView.menuButtonData];var MenuBar=function(){this.items=cleverapps.MenuBarItems().map(function(e){return e.modelClass?new e.modelClass(e):new MenuBarItem(e)})};MenuBar.prototype.getSceneItems=function(){var t=[];return this.items.forEach(function(e){this.isAvailableOnScene(e.config)?(e.init(),t.push(e)):e.stop()}.bind(this)),t},MenuBar.prototype.stopItems=function(){this.items.forEach(function(e){e.stop()}.bind(this))},MenuBar.prototype.isAvailableOnScene=function(e){if(e.availableOnScenes)return 0<=e.availableOnScenes.indexOf(cleverapps.environment.scene);if("GoldItem"===e.name){var t=[cleverapps.Environment.SCENE_MAIN,cleverapps.Environment.SCENE_HEROES,cleverapps.Environment.SCENE_DAILY_CUP,cleverapps.Environment.SCENE_METHA,cleverapps.Environment.SCENE_CARD_SKINS,cleverapps.Environment.SCENE_BONUS_WORLD,cleverapps.Environment.SCENE_SLOT_MACHINE];return"match3"!==cleverapps.config.type&&t.push(cleverapps.Environment.SCENE_GAME),0<=t.indexOf(
cleverapps.environment.scene)}if("LivesItem"===e.name){var s=[cleverapps.Environment.SCENE_MAIN,cleverapps.Environment.SCENE_METHA,cleverapps.Environment.SCENE_BONUS_WORLD];return cleverapps.dailyCup.cupWithLives()&&s.push(cleverapps.Environment.SCENE_DAILY_CUP),"merge"===cleverapps.config.type&&s.push(cleverapps.Environment.SCENE_GAME),cleverapps.lives&&0<=s.indexOf(cleverapps.environment.scene)}return"CryptexItem"===e.name?cleverapps.environment.isGameScene()&&Game.currentGame.cryptex:"BonusRoundTimerItem"===e.name&&(cleverapps.environment.isGameScene()&&Game.currentGame.bonusRoundCountDown)},cleverapps.MenuBarItems=function(){var e=[],t="riddles"!==cleverapps.config.name;return"merge"===cleverapps.config.type&&e.push({name:"GameLevelItem",target:!0,viewClass:MenuBarGameLevelView,modelClass:GameLevelMenuBarItem,availableOnScenes:[cleverapps.Environment.SCENE_GAME]}),e.push({name:"GoldItem",lottery:!0,needPayments:!RewardedAdsManager.IsEnabled()||cleverapps.flags.almostNoAds,
target:!0,plusButton:t,value:function(){return cleverapps.user.gold},updater:function(e){cleverapps.user.onChangeGold=e},icon:bundles.menubar.frames.coin_png,onClickWindow:HardCurrencyShopWindow,deltaSound:bundles.main.urls.coins_effect},{name:"LivesItem",lottery:!0,target:!0,plusButton:t,force:Forces.BUY_ENERGY_ICON,viewClass:MenuBarWithTimeoutView,modelClass:LivesMenuBarItem,value:function(){return cleverapps.lives.amount},icon:bundles.menubar.frames.life_png,onClickWindow:LivesShopWindow}),"merge"===cleverapps.config.type&&e.push({name:"CoinsItem",target:!0,plusButton:t,value:function(){return Game.currentGame.coins},updater:function(e){Game.currentGame.onChangeCoinsListener=e},onClickWindow:SoftCurrencyShopWindow,keepOpenWithWindow:"MenuBarGoldItem",icon:bundles.menubar.frames.merge_coin_png,deltaSound:bundles.collectible.urls.coins_fly_finish_effect,availableOnScenes:[cleverapps.Environment.SCENE_GAME]},{name:"WandsItem",target:!0,value:function(){return Game.currentGame.wands},
updater:function(e){Game.currentGame.onChangeWandsListener=e},icon:bundles.menubar.frames.merge_wand_png,deltaSound:bundles.collectible.urls.wand_fly_finish_effect,availableOnScenes:[cleverapps.Environment.SCENE_GAME]},{name:"WorkersItem",plusButton:t,target:!0,timerTTF:!0,viewClass:MenuBarWithTimeoutView,modelClass:WorkersMenuBarItem,value:function(){return Game.currentGame.workers.countRegularFree()},onClickWindow:BonusWorkerWindow,keepOpenWithWindow:"MenuBarGoldItem",icon:bundles.menubar.frames.merge_worker_png,availableOnScenes:[cleverapps.Environment.SCENE_GAME]}),cleverapps.config.metha===Metha.HOMEFIX&&e.push({name:"MethaStarsItem",plusButton:t,value:function(){return cleverapps.home.stars},updater:function(e){cleverapps.home.onChangeStars=e},onClickWindow:HomefixRulesWindow,icon:bundles.menubar.frames.menubar_metha_stars,availableOnScenes:[cleverapps.Environment.SCENE_METHA,cleverapps.Environment.SCENE_MAIN]}),void 0!==typeof match3&&e.push({name:"ExpItem",plusButton:t,
lottery:!0,needPayments:!0,value:function(){return cleverapps.user.exp},updater:function(e){cleverapps.user.onChangeExpListeners.expview=e},onClickWindow:ExpInfoWindow,icon:bundles.menubar.frames.exp_png,availableOnScenes:[cleverapps.Environment.SCENE_HEROES]}),0<=["board","differences"].indexOf(cleverapps.config.type)&&e.push({name:"CryptexItem",centerAlign:!0,helpButton:!0,force:Forces.CRYPTEX,icon:bundles.menubar.frames.cryptex_png,onClickWindow:CryptexWindow,modelClass:CryptexMenuBarItem}),e.push({name:"BonusRoundTimerItem",centerAlign:!0,tooltip:"BonusRoundCountdownTooltip",animation:bundles.menubar.jsons.bound_round_timer_json,modelClass:BonusRoundMenuBarItem}),e};var MenuBarItem=function(e){this.config=e,this.timerShowHours=!1,this.onRemove=function(){},this.onChangeText=function(){},this.onShowForce=function(){}};MenuBarItem.prototype.init=function(){this.stopped=!1,cleverapps.extend(this,this.config),this.changeText=cleverapps.accumulate(100,function(){if(!this.stopped){
var e=0;void 0!==this.currentValue&&(e=this.getCurrentValue()-this.currentValue),this.currentValue=this.getCurrentValue(),this.onChangeText(e)}}.bind(this)),this.currentValue=this.getCurrentValue(),this.config.onClickWindow&&(this.canActionNow=function(){return!(!this.config.force||!cleverapps.forces.isRunningForce(this.config.force))||!cleverapps.metha.isFocused()}.bind(this),this.action=function(){this.config.force&&cleverapps.forces.isRunningForce(this.config.force)&&cleverapps.forces.closeRunningForce(),cleverapps.metha.display({focus:"MenuBarItemWindow",control:this.keepOpenWithWindow?[this.getControlName(),this.keepOpenWithWindow]:this.getControlName(),action:function(e){new this.config.onClickWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}.bind(this),this.onClickWindow=void 0),this.config.updater&&(this.config.updater.call(this,this.changeText.bind(this)),this.updater=void 0),this.customInit()},MenuBarItem.prototype.customInit=function(){},
MenuBarItem.prototype.getName=function(){return this.config.name},MenuBarItem.prototype.getControlName=function(){return"MenuBar"+this.getName()},MenuBarItem.prototype.getCurrentValue=function(){return this.config.value?this.config.value():void 0},MenuBarItem.prototype.getViewClass=function(){return this.config.viewClass||MenuBarItemView},MenuBarItem.prototype.getText=function(){if(this.timer)return cleverapps.intervalToString(this.timer.getTimeLeft(),this.timerShowHours);var e=this.getCurrentValue();return void 0!==e?e+"":""},MenuBarItem.prototype.updateAll=function(){this.timerRefresh()},MenuBarItem.prototype.calcTimerTTF=function(){var e=this.timer&&this.timer.getTimeLeft()||0;return e>=cleverapps.ONE_DAY-1e3||!this.timerShowHours&&e>cleverapps.ONE_HOUR-1e3},MenuBarItem.prototype.timerRefresh=function(){this.timerTTF===this.calcTimerTTF()?(this.onChangeText(),this.onRefreshTimer&&this.onRefreshTimer()):this.updateTimer()},MenuBarItem.prototype.updateTimer=function(){var e=this.timer
;this.stopTimer(),this.onChangeTimer&&this.onChangeTimer(!!this.timer==!!e),this.onRefreshTimer&&this.onRefreshTimer()},MenuBarItem.prototype.stop=function(){this.stopped=!0,this.stopTimer()},MenuBarItem.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timer=!1)},MenuBarItem.prototype.setTimer=function(e){this.timer=e,this.timer.onSecond=this.timerRefresh.bind(this),this.timerTTF=this.calcTimerTTF()};var LivesMenuBarItem=function(e){MenuBarItem.call(this,e),this.onAttentionOnListener=function(){},this.onAttentionOffListener=function(){},this.onUpdatePlusButton=function(){},this.onUpdateTotalIcon=function(){},this.onUpdateLotteryIcon=function(){}};LivesMenuBarItem.prototype=Object.create(MenuBarItem.prototype),(LivesMenuBarItem.prototype.constructor=LivesMenuBarItem).prototype.customInit=function(){this.attention=!1,this.keepOpenWithWindow="merge"===cleverapps.config.type?"MenuBarCoinsItem":"MenuBarGoldItem",
cleverapps.lives.onChangeAmountListeners.livesview=this.updateAll.bind(this),cleverapps.lives.onStartRegenerateListener=this.updateAll.bind(this),cleverapps.lives.onBuyUnlimitedLivesListener=this.updateAll.bind(this),cleverapps.lives.onShowIconForceListener=function(e){this.onShowForce(e)}.bind(this),this.updateAll(),Game.currentGame&&Game.currentGame.energyLottery&&(Game.currentGame.energyLottery.onLotteryStatusChanged=this.updateAttention.bind(this))},LivesMenuBarItem.prototype.getTotal=function(){return cleverapps.Lives.MAX_REGEN_AMOUNT},LivesMenuBarItem.prototype.updateAttention=function(){var e=!1;Game.currentGame&&Game.currentGame.energyLottery&&(e=Game.currentGame.energyLottery.isAvailable()&&Game.currentGame.energyLottery.isReady()),this.attention!==e&&((this.attention=e)?this.onAttentionOnListener():this.onAttentionOffListener())},LivesMenuBarItem.prototype.updateAll=function(){this.changeText(),cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)?(
this.plusButton=!1,this.totalIcon=bundles.menubar.frames.unlim_png):(this.plusButton=this.config.plusButton,this.totalIcon=!1),this.onUpdatePlusButton(),this.onUpdateTotalIcon(),this.updateTimer(),this.updateAttention()},LivesMenuBarItem.prototype.updateTimer=function(){var e=this.timer;this.stopTimer(),this.lottery=!0,cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)?(this.lottery=!1,this.setTimer(new cleverapps.CountDown(cleverapps.tempGoods.goodLeftTime(cleverapps.TempGoods.UNLIMITED_LIVES),{onFinish:function(){cleverapps.metha.isFocused()||!cleverapps.environment.isMainScene()&&!cleverapps.environment.isDailyCupScene()||cleverapps.tempGoods.displayPromotionOnFinish(),this.updateAll()}.bind(this)}),!1)):cleverapps.lives.amount<cleverapps.Lives.MAX_REGEN_AMOUNT&&0<cleverapps.lives.calcTimeLeft()&&(this.lottery=!1,this.setTimer(new cleverapps.CountDown(cleverapps.lives.calcTimeLeft(),{onFinish:this.updateAll.bind(this)}),!1)),this.onUpdateLotteryIcon(),
this.onChangeTimer&&this.onChangeTimer(!!this.timer==!!e),this.onRefreshTimer&&this.timer&&this.onRefreshTimer()};var WorkersMenuBarItem=function(e){MenuBarItem.call(this,e),this.timerShowHours=!0};WorkersMenuBarItem.prototype=Object.create(MenuBarItem.prototype),(WorkersMenuBarItem.prototype.constructor=WorkersMenuBarItem).prototype.customInit=function(){Game.currentGame.workers.onChangeStatusListener=this.changeText.bind(this),Game.currentGame.workers.onChangeTotalAmount=function(){this.changeText(),this.updateTimer()}.bind(this),this.updateTimer()},WorkersMenuBarItem.prototype.getTotal=function(){return Game.currentGame.workers.countRegularTotal()},WorkersMenuBarItem.prototype.highlightTotal=function(){return Game.currentGame&&Game.currentGame.workers.isBonusWorkerBuyed()||!1},WorkersMenuBarItem.prototype.updateTimer=function(){var e=this.timer;this.stopTimer(),Game.currentGame&&Game.currentGame.workers.isBonusWorkerBuyed()&&this.setTimer(new cleverapps.CountDown(
Game.currentGame.workers.bonusWorkerLeftTime(),{onFinish:this.updateTimer.bind(this)}),!0),this.onChangeTimer&&this.onChangeTimer(!!this.timer==!!e),this.onRefreshTimer&&this.timer&&this.onRefreshTimer()};var CryptexMenuBarItem=function(e){MenuBarItem.call(this,e)};CryptexMenuBarItem.prototype=Object.create(MenuBarItem.prototype),(CryptexMenuBarItem.prototype.constructor=CryptexMenuBarItem).prototype.customInit=function(){this.setTimer(Game.currentGame.cryptex.countdown),Game.currentGame.cryptex.onShowForceListener=function(){this.onShowForce(this.config.force)}.bind(this),Game.currentGame.cryptex.onStop=function(){this.onRemove()}.bind(this)};var BonusRoundMenuBarItem=function(e){MenuBarItem.call(this,e)};BonusRoundMenuBarItem.prototype=Object.create(MenuBarItem.prototype),(BonusRoundMenuBarItem.prototype.constructor=BonusRoundMenuBarItem).prototype.customInit=function(){this.setTimer(Game.currentGame.bonusRoundCountDown),
Game.currentGame.onChangeOutcomeListeners.menuBarBonusRoundTimer=function(e){e===GameBase.OUTCOME_LOST&&(setTimeout(function(){cleverapps.metha.hideControlsWhileFocused(this.getControlName())}.bind(this),800),this.onSetAnimationListener("timeout"))}.bind(this)};var GameLevelMenuBarItem=function(e){MenuBarItem.call(this,e),this.onChangeLevelNo=function(){},this.onChangeExpProgress=function(){}};GameLevelMenuBarItem.prototype=Object.create(MenuBarItem.prototype),(GameLevelMenuBarItem.prototype.constructor=GameLevelMenuBarItem).prototype.customInit=function(){Game.currentGame.gameLevel.onChangeValue=function(){this.onChangeLevelNo()}.bind(this),Game.currentGame.gameLevel.onChangeExp=function(){this.onChangeExpProgress()}.bind(this)},GameLevelMenuBarItem.prototype.debugAction=function(){Game.currentGame.gameLevel.addExp(Game.currentGame.gameLevel.nextLevelThreshold())},GameLevelMenuBarItem.prototype.getCurrentValue=function(){return{level:Game.currentGame.gameLevel.getLevel(),
currentExp:cleverapps.user.exp,thresholdExp:Game.currentGame.gameLevel.nextLevelThreshold()}};var MenuBarItemView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.styles=cleverapps.styles.MenuBarItem,this.item=e,this.centerAlign=this.item.centerAlign,this.reset(!0),this.item.onRemove=this.createListener(this.remove.bind(this)),this.item.onChangeText=this.createListener(this.onChangeText.bind(this)),this.item.onChanged=this.createListener(this.reset.bind(this)),this.item.onShowForce=this.createListener(this.showForce.bind(this)),this.item.onAttentionOnListener=this.createListener(this.turnOnAttention.bind(this)),this.item.onAttentionOffListener=this.createListener(this.turnOffAttention.bind(this)),this.item.onSetAnimationListener=this.createListener(this.setAnimation.bind(this)),this.item.onUpdatePlusButton=this.createListener(this.updatePlusButton.bind(this)),this.item.onUpdateLotteryIcon=this.createListener(this.updateLotteryIcon.bind(this)),
this.item.target&&(cleverapps.styles.MenuBar[this.item.getName()]||(cleverapps.styles.MenuBar[this.item.getName()]={}),this.registerTarget(cleverapps.styles.MenuBar[this.item.getName()])),e.tooltip&&cleverapps.tooltipManager.create(this,{text:Messages.get(e.tooltip),position:cleverapps.styles.UI.Tooltip.LOCATION.below,control:this.item.getControlName()+"Tooltip",swallowTouches:!1})},updatePlusButton:function(){!!this.item.plusButton!=!!this.plusButton&&(this.item.plusButton?this.addPlusButton():(this.plusButton.removeFromParent(),delete this.plusButton))},updateLotteryIcon:function(){!!this.item.lottery!=!!this.lotteryIcon&&(this.item.lottery?-1!==["board","differences"].indexOf(cleverapps.config.type)&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&cleverapps.environment.isGameScene()||Lottery.addIcon(this,cleverapps.styles.MenuBarItem.lotteryIconPosition):(this.lotteryIcon.removeFromParent(),delete this.lotteryIcon))},setAnimation:function(e){
this.icon instanceof cleverapps.Spine&&this.icon.setAnimation(0,e,!1)},makeHideable:function(){cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl(this.item.getControlName(),this)},reset:function(){this.turnOffAttention(),this.removeAllChildren(),this.addBg(),this.addIcon(),this.bg.setPositionRound(this.bg.width/2+this.iconRealWidth/2,this.styles.bg.height/2),this.setContentSize2(this.bg.width+this.iconRealWidth/2,this.bg.height),this.addPlusButton(),this.addHelpButton(),this.addText(),this.addAction(),SceneDecors.add(this,cleverapps.skins.getSlot("menuBarItem",{target:this})),this.updateLotteryIcon(),this.item.attention&&this.turnOnAttention()},updateToSmallSize:function(e){this.useSmallSize=!0,this.needDelta=e,this.reset(!0)},remove:function(){this.pauseHideHandler(),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf))},showForce:function(e){this.show(!0),cleverapps.forces.create(this,e)},updateText:function(){
this.text.setString(this.item.getText())},onChangeText:function(e){if(this.animateChange(e)){this.text.stopAllActions(),this.text.setScale(this.text.baseScale);var t=this.item.deltaSound;!t||cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.customCollectAnimation||cleverapps.audio.playSound(t),this.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.4*this.text.baseScale),new cc.CallFunc(function(){cleverapps.UI.animateDelta(e,{x:this.bg.width/2+this.iconRealWidth/2,y:this.styles.deltaAnimation.dy,parent:this,font:cleverapps.styles.FONTS.MENUBAR_TEXT_DELTA||cleverapps.styles.FONTS.MENUBAR_TEXT}),this.updateText(),this.text.setPositionRound(this.getTextPosition())}.bind(this)),new cc.ScaleTo(.2,this.text.baseScale),new cc.CallFunc(function(){this.textFitTo()}.bind(this)))),this.icon&&(this.icon.stopAllActions(),this.icon.setScale(this.icon.baseScale),this.icon.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.2*this.icon.baseScale).easing(cc.easeIn(1)),new cc.ScaleTo(.15,
this.icon.baseScale).easing(cc.easeOut(1)))))}else this.updateText(),this.textFitTo(),this.text.setPositionRound(this.getTextPosition())},animateChange:function(e){return e&&!this.item.timer},addIcon:function(){this.item.animation?(this.icon=new cleverapps.Spine(this.item.animation),this.icon.setAnimation(0,"idle",!0)):this.icon=new cc.Sprite(this.item.icon),this.icon.baseScale=this.icon.getScale(),this.iconRealWidth=this.styles.icon.fullInsideBg?0:this.icon.getBoundingBox().width,this.addChild(this.icon),this.icon.setPositionRound({x:this.iconRealWidth/2+this.styles.icon.x,y:this.styles.bg.height/2+this.styles.icon.y})},addBg:function(){this.bg=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.menubar_bg_png,cleverapps.UI.Scale9Rect.TwoPixelXY);var e=this.styles.bg.width;this.useSmallSize&&(e=this.needDelta>this.styles.bg.width-this.styles.bg.minWidth?this.styles.bg.minWidth:this.styles.bg.width-this.needDelta),this.bg.setContentSize2(e,this.styles.bg.height),this.addChild(
this.bg)},textFitTo:function(){var e=this.width-this.styles.iconBlockWidth;(this.helpButton||this.plusButtonOnBg)&&(e-=this.styles.plusBlockWidth),this.text.fitTo(e),this.text.baseScale=this.text.scale},getTextPosition:function(){var e=0;this.helpButton||this.plusButtonOnBg||(e=cleverapps.styles.MenuBarItem.noPlusDx);var t=cleverapps.styles.MenuBarItem.textOffset.y;return this.separateText?this.separateText instanceof cleverapps.UI.ImageFont&&(t=cleverapps.styles.MenuBarItem.textOffset.imageFont||0):this.text instanceof cleverapps.UI.ImageFont&&(t=cleverapps.styles.MenuBarItem.textOffset.imageFont||0),cc.p(this.width/2+this.iconRealWidth/4+cleverapps.styles.MenuBarItem.textOffset.x+e,this.height/2+t)},addText:function(){var e=this.item.getText();if(cleverapps.UI.ImageFont.IsApplicable(cleverapps.styles.FONTS.MENUBAR_TEXT,e))var t=cleverapps.UI.generateImageText(e,cleverapps.styles.FONTS.MENUBAR_TEXT);else t=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.MENUBAR_TEXT)
;this.addChild(t),(this.text=t).baseScale=t.scale,t.setPositionRound(this.getTextPosition()),this.textFitTo()},addAction:function(){var e=!0;this.item.action||(e=!1),this.item.needPayments&&cleverapps.flags.nopayments&&(e=!1),cleverapps.UI.onClick(this,function(){e&&this.item.action()}.bind(this),{useInteractiveScale:e,filter:this.item.canActionNow,swallowTouches:!1}),e&&cleverapps.UI.applyHover(this,{filter:this.item.canActionNow})},addPlusButton:function(){if(this.item.plusButton){if(!this.item.needPayments||!cleverapps.flags.nopayments){var e=this.plusButton=new cleverapps.UI.Button({button_png:bundles.menubar.frames.plus_button_png,button_on_png:bundles.menubar.frames.plus_button_on_png,onClicked:this.item.action,filter:this.item.canActionNow});e.forceTarget=!0,this.addChild(e);var t=cc.p(this.icon.x+this.iconRealWidth/2,0);this.styles.plusButton&&this.styles.plusButton.position&&(this.plusButtonOnBg=!0,t=this.styles.plusButton.position),e.setPositionRound(t)}
}else this.plusButtonOnBg=!1},addHelpButton:function(){if(this.item.helpButton){var e=this.helpButton=new cleverapps.UI.Button({button_png:bundles.menubar.frames.menubar_help_button_png,button_on_png:bundles.menubar.frames.menubar_help_button_on_png,onClicked:this.item.action});this.addChild(e),e.setPositionRound(this.styles.helpButton.position)}},turnOnAttention:function(){if(!this.attention){var e=cleverapps.styles.MenuBarItem.attention,t=this.attention=new cc.Sprite(bundles.menubar.frames.menubar_attention_png);t.setLocalZOrder(2),t.setPositionRound(this.icon.x+e.x,this.icon.y+e.y),t.setScale(e.scale),this.addChild(t),t.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1*t.scale),new cc.ScaleTo(.3,t.scale))))}},turnOffAttention:function(){this.attention&&(this.attention.removeFromParent(),delete this.attention)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MENUBAR_TEXT:{name:"default",size:40}}),cleverapps.styles.MenuBarItem={textOffset:{x:0,y:0},noPlusDx:14,
bg:{width:200,minWidth:170,height:50},iconBlockWidth:50,plusBlockWidth:50,deltaAnimation:{dy:-5},icon:{fullInsideBg:!1,x:-10,y:0},iconText:{position:{x:{align:"center",dx:0},y:{align:"center",dy:0}}},plusButton:{position:{x:{align:"right",dx:-5},y:{align:"center",dy:0}}},helpButton:{position:{x:{align:"right",dx:-5},y:{align:"center",dy:0}}},totalIcon:{x:{align:"center"},y:{align:"center"}},attention:{x:25,y:-42,scale:.9}};var MenuBarWithTimeoutView=MenuBarItemView.extend({ctor:function(e){this._super(e),this.item.onChangeTimer=this.createListener(this.onChangeTimer.bind(this)),this.item.onRefreshTimer=this.createListener(this.onRefreshTimer.bind(this)),this.item.onUpdateTotalIcon=this.createListener(this.updateTotalIcon.bind(this))},onChangeTimer:function(e){this.timer&&!!this.timer instanceof cleverapps.UI.ImageFont^!!this.item.timerTTF&&this.removeTimer(e),this.item.timer?this.createTimer(e):this.removeTimer(e)},updateToSmallSize:function(){},reset:function(e){this._super(e),
this.updateTotalIcon(),this.timerBlock=void 0,this.onChangeTimer(!0)},animateChange:function(e){return e},createTimer:function(e){if(!this.timerBlock){this.timerBlock=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.bar_timer_png),this.timerBlock.setCascadeOpacityEnabled(!0);var t=this.bg.width-2*this.styles.timer.padding.x;if(this.timerBlock.setContentSize2(t,this.styles.timer.height),this.timerBlock.setPositionRound(this.styles.timer.position),this.addChild(this.timerBlock,-1),bundles.menubar.frames.small_timer_icon_png){var s=new cc.Sprite(bundles.menubar.frames.small_timer_icon_png);s.setPositionRound(this.styles.timer.icon),this.timerBlock.addChild(s)}this.item.timerTTF?this.timer=cleverapps.UI.generateOnlyText("",cleverapps.styles.FONTS.MENUBAR_TIMER_TEXT):this.timer=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.MENUBAR_TIMER_TEXT,{},{fixedNumberWidth:!0}),this.timerBlock.addChild(this.timer),e?this.onRefreshTimer():(this.timerBlock.setOpacity(0),
this.timerBlock.runAction(new cc.Sequence(new cc.FadeIn(.3),new cc.CallFunc(this.onRefreshTimer.bind(this)))))}},removeTimer:function(e){this.timerBlock&&(e?this.timerBlock.removeFromParent():this.timerBlock.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.RemoveSelf)),this.timerBlock=void 0)},onRefreshTimer:function(){this.timerBlock&&(this.timer.setString(this.item.getText()),this.timer.setFont(cleverapps.styles.FONTS.MENUBAR_TIMER_TEXT),this.timer.fitTo(cleverapps.styles.MenuBarItem.timer.text.width),this.item.timerTTF?this.timer.setPositionRound(this.styles.timer.ttfText):this.timer.setPositionRound(this.styles.timer.text))},updateTotalIcon:function(){this.totalIcon&&this.totalIcon.removeFromParent(),this.item.totalIcon&&(this.totalIcon=new cc.Sprite(this.item.totalIcon),this.addChild(this.totalIcon),this.totalIcon.setPositionRound(this.styles.totalIcon))},updateText:function(){if(this.text.removeAllChildren(),!this.item.totalIcon){var e=this.item.getCurrentValue(),
t=this.item.getTotal(),s=cleverapps.UI.generateImageText(e,cleverapps.styles.FONTS.MENUBAR_TEXT);this.styles.noColoredText||(t<=e?s.setColor(cleverapps.styles.COLORS.GREEN):e<.1*t&&s.setColor(cleverapps.styles.COLORS.COLOR_RED));var i=this.separateText=cleverapps.UI.generateImageText("/",cleverapps.styles.FONTS.MENUBAR_TEXT),n=cleverapps.UI.generateImageText(t,cleverapps.styles.FONTS.MENUBAR_TEXT);this.item.highlightTotal&&this.item.highlightTotal()&&n.setColor(cleverapps.styles.COLORS.COLOR_BONUS);var o=new cleverapps.Layout([s,i,n],{direction:cleverapps.UI.HORIZONTAL});this.text.setContentSize(o.getContentSize()),o.setPositionRound(this.text.width/2,this.text.height/2),this.text.addChild(o)}},textFitTo:function(){var e=this.width-this.styles.iconBlockWidth;(this.helpButton||this.plusButtonOnBg)&&(e-=this.styles.plusBlockWidth),this.text.width>e?(this.text.baseScale=e/this.text.width,this.text.setScale(this.text.baseScale)):this.text.baseScale=1},addText:function(){var e=new cc.Node
;e.setAnchorPoint2(),this.addChild(e),this.text=e,this.updateText(),e.setPositionRound(this.getTextPosition()),this.textFitTo()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MENUBAR_TIMER_TEXT:{name:"default",size:32,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.MenuBarItem=cleverapps.overrideStyles(cleverapps.styles.MenuBarItem,{timer:{icon:{x:{align:"left",dx:31},y:{align:"center",dy:1}},text:{x:{align:"left",dx:73},y:{align:"center",dy:4},width:125},ttfText:{x:{align:"left",dx:68},y:{align:"center",dy:0}},position:{x:{align:"center",dx:16},y:{align:"bottom",dy:-49}},padding:{x:40},height:59}});var MenuBarGameLevelView=MenuBarItemView.extend({ctor:function(e){this._super(e),e.onChangeLevelNo=this.createListener(this.onChangeLevelNo.bind(this)),e.onChangeExpProgress=this.createListener(this.onChangeExpProgress.bind(this))},reset:function(){var e=cleverapps.styles.MenuBarGameLevelView;this.removeAllChildren(),
this.setContentSize2(e.width,e.height);var t=this.level=this.createLevel(),s=this.progress=this.createProgress(t);this.addChild(s),this.addChild(t),this.onChangeLevelNo(),this.updateProgress(!0),this.addAction()},updateToSmallSize:function(){},createLevel:function(){var e=cleverapps.styles.MenuBarGameLevelView,t=new cc.Scale9Sprite(bundles.menubar.frames.menubar_round_bg_png);t.setAnchorPoint2(),t.setPositionRound(t.width/2,this.height/2);var s=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.MENUBAR_LEVEL_TEXT);s.setAnchorPoint2(),s.setPositionRound(t.width/2+e.value.offset.x,t.height/2+e.value.offset.y);var i=this.crown=new cleverapps.Spine(bundles.menubar.jsons.crown_json);return i.setAnchorPoint2(),i.setPositionRound(e.crown.offset.x,t.height+e.crown.offset.y),i.setAnimation(0,"idle",!0),t.value=s,t.crown=i,t.addChild(s),t.addChild(i),t},createProgress:function(e){var t=cleverapps.styles.MenuBarGameLevelView,s=new ScaledProgressBar({
background:bundles.menubar.frames.menubar_progress_bg_png||bundles.menubar.frames.menubar_bg_png,progress:bundles.menubar.frames.menubar_progress_png,padding:t.bar.padding});s.setAnchorPoint(0,.5),s.setDimension(this.width-e.width-t.margin,cleverapps.styles.MenuBarItem.bg.height),s.setPositionRound(e.width+t.margin,this.height/2);var i=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.MENUBAR_TEXT);return i.setAnchorPoint2(),i.setPositionRound(s.width/2+t.exp.offset.x,s.height/2+t.exp.offset.y),s.exp=i,s.addChild(i),s},updateProgress:function(e){var t=cleverapps.styles.MenuBarGameLevelView,s=this.progress,i=this.item.getCurrentValue(),n=i.currentExp,o=i.thresholdExp,r=Math.floor(t.bar.zeroPercentage+n/o*(100-t.bar.zeroPercentage));e?s.setPercentage(r):s.animatedChange(r-s.getPercentage()),s.exp.setString(n+"/"+o),s.exp.fitTo(s.width-t.exp.padding.x,s.height-t.exp.padding.y),s.exp.baseScale=s.exp.scale},onChangeExpProgress:function(){this.updateProgress(),
this.progress.exp.stopAllActions(),this.progress.exp.runAction(new cc.Sequence(new cc.PlaySound(bundles.collectible.urls.exp_fly_finish_effect),new cc.ScaleTo(.2,1.4*this.progress.exp.baseScale),new cc.ScaleTo(.2,this.progress.exp.baseScale))),this.animateCrowns()},onChangeLevelNo:function(){var e=cleverapps.styles.MenuBarGameLevelView,t=this.level;t.value.setString(this.item.getCurrentValue().level),t.value.fitTo(t.width-2*e.value.padding.x,t.height-2*e.value.padding.y),t.value.baseScale=t.value.scale},animateCrowns:function(){this.crown.setAnimationAndIdleAfter("animation","idle")},addAction:function(){cleverapps.config.debugMode&&cleverapps.UI.onClick(this,this.item.debugAction)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MENUBAR_LEVEL_TEXT:{name:"default",size:86}}),cleverapps.styles.MenuBarGameLevelView={width:455,height:65,margin:-52,bar:{zeroPercentage:16,padding:{left:9,right:9,top:7,bottom:10},offset:{x:-1,y:3}},exp:{offset:{x:16,y:3},padding:{x:130,y:13}},value:{
padding:{x:16,y:13},offset:{x:1,y:1}},crown:{offset:{x:9,y:-13}}};var MenuBarView=cc.Node.extend({ctor:function(e,t){this._super();var s=cleverapps.menuBar.getSceneItems().map(function(e){return new(e.getViewClass())(e)}),i=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.MenuBar.margin,padding:cleverapps.styles.MenuBar.padding});if(i.width<e&&2===s.length&&s[1].centerAlign){var n=cleverapps.UI.getSceneSize();s[1].x<n.width/2&&n.width/2+s[1].width/2+cleverapps.styles.MenuBar.padding.x<=e&&(s[1].x=n.width/2,i.width=s[1].x+s[1].width/2+cleverapps.styles.MenuBar.padding.x)}if(i.width>e){var o=(i.width-e-(s.length-1)*(cleverapps.styles.MenuBar.margin-cleverapps.styles.MenuBar.smallMargin))/s.length;s.forEach(function(e){e.updateToSmallSize(o)}),i.options={direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.MenuBar.smallMargin,padding:cleverapps.styles.MenuBar.padding},i.reshape()}i.width>e&&i.setScale(e/i.width),this.setLocalZOrder(2),
this.addChild(i),this.setContentSize(i.width*i.scale,i.height*i.scale),i.setPositionRound(this.width/2,this.height/2),this.setPositionRound(cleverapps.styles.MenuBar.position),this.deltaY=cleverapps.UI.getSceneOffsetY()-cleverapps.styles.MenuBar.minOffest,this.deltaY<0&&(this.deltaY=0),this.alignment=cleverapps.clone(this.alignment,!0),this.alignment.y.dy+=this.deltaY,t.addChild(this,22),s.forEach(function(e){e.makeHideable()})}});cleverapps.styles.MenuBar={minOffest:50,margin:16,smallMargin:12,padding:{x:20,y:0},position:{x:{align:"left",dx:0},y:{align:"top",dy:-15}}},cleverapps.UI.ImageFont=cc.Node.extend({ctor:function(e,t,s){this._super(),this.params=s||{},this.setFont(t),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0),this.setString(e),this.setCascadeColorEnabled(!0)},setHorizontalAlignment:function(){},setVerticalAlignment:function(){},setDimensions:function(){},fitTo:function(e,t){for(var s=0;s<10;){var i=this.width*this.scale,n=this.height*this.scale,
o=this.canAttachLastLine();if(!(e&&e<i||t&&t<n||o))break;s++;var r=.9;if(e&&e<i&&r<e/i&&(r=e/i),t&&t<n&&r<t/n&&(r=t/n),1<=r&&o&&(r=.9),this.setFontSize(Math.floor(this.getFontSize()*r)),this.getFontSize()<cleverapps.UI.ImageFont.getFontSizeThreshold())return void this.setFontSize(cleverapps.UI.ImageFont.getFontSizeThreshold())}},canAttachLastLine:function(){return!1},setFont:function(e){for(var t,s=e.name?e.name:"default",i=0;i<cleverapps.config.fonts.length&&!(cleverapps.config.fonts[i].name===s&&(t=cleverapps.config.fonts[i]).size*cleverapps.UI.ImageFont.MAX_MAGNITUDE>=e.size);i++);if(void 0===t)throw console.log(e),"No image font";if(this.font=e,this.baseFont=t,this.bundle=t.bundle,this.prefix=t.name+t.originalSize+"pt_",this.setScale(e.size/t.size),!this.baseFont.zeroLetterWidth){var n=new cc.Sprite(bundles[this.bundle].frames[this.prefix+"0"]).width;this.baseFont.zeroLetterWidth=2*Math.round(n/2)}this.setColor(e.color||cleverapps.styles.COLORS.WHITE)},setString:function(e){if(
!this.stopListeners){e=""+e,this.string=e,this.removeAllChildren(!0);var t=e?(""+e).split(""):[],s=cc.size();t.forEach(function(e){this.createLetter(e,s)},this),this.setContentSize2(s),this.setAnchorPoint2(this.anchorX,this.anchorY)}},createLetter:function(e,t){cleverapps.UI.ImageFont.LETTERS_MAP[e]&&(e=cleverapps.UI.ImageFont.LETTERS_MAP[e]);var s=bundles[this.bundle].frames[this.prefix+e];s||(console.log(this),console.log("No image for letter: ",e),cleverapps.throwAsync("No image for letter: "+e+", bundle - "+this.bundle+", prefix - "+this.prefix));var i=new cc.Sprite(s),n=new cc.Node;n.setCascadeColorEnabled(!0),n.setCascadeOpacityEnabled(!0),n.setAnchorPoint2();var o=2*Math.round(i.width/2),r=2*Math.round(i.height/2);this.params.fixedNumberWidth&&"0"<=e&&e<="9"&&(o=this.baseFont.zeroLetterWidth),n.setContentSize2(o,r),n.addChild(i),i.setPositionRound(n.width/2,n.height/2),t.height<r&&(t.height=r),n.setPositionRound(t.width+o/2,r/2),t.width+=o,this.addChild(n)},
setAnchorPoint2:function(e,t){this.anchorX=e,this.anchorY=t,this._super(e,t)},getString:function(){return this.string},getFontSize:function(){return Math.floor(this.baseFont.size*this.scale)},setFontSize:function(e){this.setScale(e/this.baseFont.size)}}),cleverapps.UI.ImageFont.MAX_MAGNITUDE=1.25,cleverapps.UI.ImageFont.LETTERS_MAP={"/":"slash","+":"plus","-":"minus",":":"colon","#":"sharp",".":"point"," ":"space","[":"left_square_bracket","]":"right_square_bracket","*":"asterisk"},cleverapps.UI.ImageFont.getFontSizeThreshold=function(){var e=8;return cc.sys.isMobile||(e=5),e*resolutionScale},cleverapps.UI.ImageFont.IsApplicable=function(e,t){if(!t)return!0;for(var s,i,n=e.name?e.name:"default",o=0;o<cleverapps.config.fonts.length;o++){var r=cleverapps.config.fonts[o];r.name===n&&(s=r.bundle,i=r.name+r.originalSize+"pt_")}var a=bundles[s].injectTo||[s];if(0===cleverapps.bundleLoader.countLoaded(a))return!1;for(o=0;o<t.length;o++){var c=cleverapps.UI.ImageFont.LETTERS_MAP[t[o]]||t[o]
;if(!bundles[s].frames[i+c])return!1}return!0},cleverapps.UI.ImageFont.intertypeSetString=function(e){e.textObj instanceof cleverapps.UI.ImageFont===cleverapps.UI.ImageFont.IsApplicable(e.font,e.string)?e.textObj.setString(e.string):e.recreateFunc(e.string)};var ScaledProgressBar=cc.Node.extend({ctor:function(e){this._super(),("string"==typeof e||e instanceof cc.SpriteFrame)&&(e={progress:e}),e.cascadeColor&&this.setCascadeColorEnabled(!0),this.minProgressWidth=e.minProgressWidth||0,this.minProgressHeight=e.minProgressHeight||0;var t=e.padding||{};this.padding={left:t.left||t.x||0,right:t.right||t.x||0,top:t.top||t.y||0,bottom:t.bottom||t.y||0},this.layout=e.layout||ScaledProgressBar.HORIZONTAL,this.sizeDirty=!0,e.background&&(this.background=cleverapps.UI.createScale9Sprite(e.background),this.background.setAnchorPoint(0,0),this.addChild(this.background)),this.progress=cleverapps.UI.createScale9Sprite(e.progress),this.progress.setAnchorPoint(0,0),this.addChild(this.progress),
this.layout===ScaledProgressBar.HORIZONTAL?this.progress.setCapInsets(cc.rect(this.progress.width/2-1,0,2,this.progress.height)):this.progress.setCapInsets(cc.rect(0,this.progress.height/2-1,this.progress.width,2)),e.foreground&&(this.foreground=cleverapps.UI.createScale9Sprite(e.foreground),this.foreground.setAnchorPoint(0,0),this.addChild(this.foreground));var s=e.background?cc.size(this.background.width,this.background.height):cc.size(this.progress.width,this.progress.height);this.percentage=0,this.setContentSize2(s.width,s.height),this.onChange()},onChange:function(){this.background&&this.sizeDirty&&this.background.setContentSize2(this.width,this.height),this.foreground&&this.sizeDirty&&this.foreground.setContentSize2(this.width,this.height);var e=this.padding,t=cc.size(this.width-e.left-e.right,this.height-e.top-e.bottom);this.layout===ScaledProgressBar.HORIZONTAL?t.width=0===this.percentage?0:Math.min(Math.max(this.minProgressWidth,t.width*this.percentage/100),t.width
):t.height=0===this.percentage?0:Math.min(Math.max(this.minProgressHeight,t.height*this.percentage/100),t.height);var s=this.progress;s.setPositionRound(e.left,e.bottom),s.setContentSize2(t.width,t.height),this.sizeDirty=!1},animatedChange:function(e,t){if(0!==e){this.stopAnimatedChangeData();var s=[];s.push(new ScaledProgressBar.ProgressTo(.8,this.percentage+e).easing(cc.easeCubicActionOut())),t&&s.push(new cc.CallFunc(t)),this.animatedChangeAction=this.runAction(new cc.Sequence(s))}},setDimension:function(e,t){void 0===t&&(t=e.height,e=e.width),this.setContentSize2(e,t),this.sizeDirty=!0,this.onChange()},setLayout:function(e){this.layout=e,this.onChange()},setMinProgressWidth:function(e){this.minProgressWidth=e,this.onChange()},setMinProgressHeight:function(e){this.minProgressHeight=e,this.onChange()},stopAnimatedChangeData:function(){this.animatedChangeAction&&!this.animatedChangeAction.isDone()&&(this.stopAction(this.animatedChangeAction),delete this.animatedChangeAction)},
setPercentage:function(e){this.stopAnimatedChangeData(),e=Math.max(Math.min(e,100),0),this.percentage!==e&&(this.percentage=e,this.onChange())},getPercentage:function(){return this.percentage}});ScaledProgressBar.ProgressTo=cc.ProgressTo.extend({update:function(e){this.target instanceof ScaledProgressBar&&(e=this._computeEaseTime(e),this.target.percentage=Math.max(Math.min(this._from+(this._to-this._from)*e,100),0),this.target.onChange())}}),ScaledProgressBar.HORIZONTAL=0,ScaledProgressBar.VERTICAL=1,cleverapps.Chest=function(e){this.locked=!1,this.onceUnlocked=function(){},this.changeLockedListener=function(){},this.storage=e.storage,this.serverTaskName=e.serverTaskName,e.isNewUser?(this.initializeForNewUser(),this.save()):this.load()},cleverapps.Chest.prototype._receiveReward=function(e,t){cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect);var s=0;if(e.gold&&(cleverapps.user.setGold(cleverapps.user.gold+e.gold),t||(s=e.gold)),e.exp&&levels.user.expAvailable(
)&&cleverapps.user.setExp(cleverapps.user.exp+e.exp),e.boosters)for(var i in e.boosters)0<e.boosters[i]&&(cleverapps.boostersCounter.add(i,e.boosters[i]),t||(s+=cleverapps.config.prices.boosters[i][1]*(e.boosters[i]||1)));if(e.unlimitedLives&&(cleverapps.tempGoods.buyGood(cleverapps.TempGoods.UNLIMITED_LIVES,cleverapps.parseInterval(e.unlimitedLives.interval)),cleverapps.lives.onBuyUnlimitedLivesListener()),e.stars&&cleverapps.starChest.addStars(e.stars),e.gun&&cleverapps.gun.addAmount(e.gun),cleverapps.lives&&(e.lives||e.energy)&&cleverapps.lives.setAmount(cleverapps.lives.amount+(e.lives||e.energy)),e.herolevels&&Array.isArray(e.herolevels)&&0<e.herolevels.length)for(var n=0;n<e.herolevels.length;n++)match3.heroes.setLevel(e.herolevels[n][0],Math.max(0,Math.min(Heroes.HEROES_MAX_LEVEL,e.herolevels[n][1])));if(e.wardrobe){var o=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_WARDROBE);if(o){var r=o.logic.getProgressForStage(e.wardrobe);o.result<r&&(o.update(
r-o.result),o.logic.stageToShow=e.wardrobe)}}t||cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:s})},cleverapps.Chest.prototype.fromJSON=function(e){this.locked=e},cleverapps.Chest.prototype.toJSON=function(){return this.locked},cleverapps.Chest.prototype.load=function(){var e=cleverapps.DataLoader.load(this.storage);void 0===e?(this.initializeForNewUser(),this.save()):this.fromJSON(e)},cleverapps.Chest.prototype.save=function(e){cleverapps.DataLoader.save(this.storage,this.toJSON()),this.serverTaskName&&!1!==e&&cleverapps.synchronizer.addUpdateTask(this.serverTaskName)},cleverapps.Chest.prototype.initializeForNewUser=function(){this.locked=!1},cleverapps.Chest.prototype.unlock=function(){this.locked=!1,this.onceUnlocked(),this.changeLockedListener()},cleverapps.Chest.prototype.open=function(){this.locked=!0,this.changeLockedListener()},cleverapps.DailyChest=function(e){cleverapps.config.debugMode&&(cleverapps.DailyChest.TIMEOUT="10 minutes"),
e=cleverapps.extend({storage:cleverapps.DataLoaderTypes.DAILY_CHEST,interval:cleverapps.parseInterval(cleverapps.DailyChest.TIMEOUT)},e),this.onUnlockingStarted=function(){},this.interval=e.interval,cleverapps.Chest.call(this,e)},cleverapps.DailyChest.prototype=Object.create(cleverapps.Chest.prototype),cleverapps.DailyChest.prototype.constructor=cleverapps.DailyChest,cleverapps.DailyChest.prototype.initializeForNewUser=function(){this.locked=!0,this.startUnlockFromScratch()},cleverapps.DailyChest.prototype.fromJSON=function(e){this.locked=!0,this.setWhenUnlock(e.nextTime)},cleverapps.DailyChest.prototype.toJSON=function(){return{nextTime:this.when}},cleverapps.DailyChest.prototype.startUnlockFromScratch=function(){this.setWhenUnlock(Date.now()+this.interval)},cleverapps.DailyChest.prototype.open=function(){this.locked=!0,this.startUnlockFromScratch(),this.changeLockedListener()},cleverapps.DailyChest.prototype.resetUnlockCountdown=function(){
void 0!==this.countdown?this.countdown.resetTimeLeft(this.when-Date.now()):this.countdown=new cleverapps.CountDown(this.when-Date.now(),{onFinish:this.unlock.bind(this),permanent:!0}),this.onUnlockingStarted()},cleverapps.DailyChest.prototype.setWhenUnlock=function(e){e||(e=Date.now()),this.when=Math.min(e,Date.now()+this.interval),this.save(),this.resetUnlockCountdown()},cleverapps.DailyChest.TIMEOUT="3 hours";var StoryTeller=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.StoryTeller;this.setContentSize2(e.width,e.height),this.setAnchorPoint2();var t=new cleverapps.Spine(e.json);t.setAnimation(0,e.animation,!0),t.setScale(e.scale),this.addChild(t),t.setPositionRound(this.width/2,this.height/2+e.offsetY)}});StoryTeller.listBundles=function(){return cleverapps.Spine.listBundles(cleverapps.styles.StoryTeller.json)},cleverapps.styles.StoryTeller={width:310,height:310,offsetY:0,json:bundles.dialogues?bundles.dialogues.jsons.default_json:void 0,animation:"animation",
scale:1};var SideBar=function(){var e=[MethaIcon,DailyLevelIcon,PackIcon,PiggyBankIcon,SubscriptionIcon,DailyCupIcon];"undefined"!=typeof match3&&match3.heroes&&e.push(HeroesIcon),cleverapps.cardSkins&&e.push(CardSkinsIcon),cleverapps.starChest&&e.push(StarChestIcon),"merge"===cleverapps.config.type&&((e=[]).push(QuestsSideBarIcon),e.push(OrdersIcon),e.push(UnitsLibraryIcon),e.push(UnitsShopIcon),e.push(PackIcon),cleverapps.config.debugMode&&(e.push(SubscriptionIcon),e.push(RegionsSideBarIcon))),e=e.concat(this.getLockedIcons()),this.defaultIcons=e.map(function(e){return new e}),this.icons=[],this.onAddIcon=function(){},this.onMoveIcon=function(){},this.onRemoveIcon=function(e){},this.onForceIcon=function(e){}};SideBar.prototype.getLockedIcons=function(){var e=[BonusWorldLockedIcon];return void 0!==EnergyFeastMissionWindow&&e.push(EnergyFeastLockedIcon),e},SideBar.prototype.reset=function(){this.icons=[]},SideBar.prototype.getDefaultIconByClassName=function(e){for(
var t=0;t<this.defaultIcons.length;t++)if(this.defaultIcons[t]instanceof e)return this.defaultIcons[t]},SideBar.prototype.getIconsByClassName=function(e){for(var t=[],s=0;s<this.icons.length;s++)this.icons[s]instanceof e&&t.push(this.icons[s]);return t},SideBar.prototype.resetByClassName=function(e){this.getIconsByClassName(e).forEach(function(e){e.resetState()})},SideBar.prototype.refreshAllIcons=function(){this.defaultIcons.forEach(function(e){e.resetState(),e.available?-1===this.icons.indexOf(e)&&this.addIcon(e):-1!==this.icons.indexOf(e)&&this.removeIcon(e)},this),this.icons.forEach(function(e){-1===this.defaultIcons.indexOf(e)&&e.resetState()},this)},SideBar.prototype.anyIconWithForceIndex=function(){for(var e=0;e<this.icons.length;e++){var t=this.icons[e];if(!t.locked){var s=t.getForce();if(s&&!cleverapps.forces.isShown(s.id))return e}}},SideBar.prototype.showAnyForce=function(){var t=this.anyIconWithForceIndex();void 0!==t&&cleverapps.metha.display({focus:"sidebarIconForce",
control:"sidebar",actions:[function(e){setTimeout(e,1100)},function(e){this.onForceIcon(t),cleverapps.forces.onceForceClosed=e}.bind(this)]})},SideBar.prototype.getIconsWithProgress=function(){return this.icons.filter(function(e){return 0<e.progress})},SideBar.prototype.showProgress=function(){var e=this.getIconsWithProgress()[0];e&&e.showProgress()},SideBar.prototype.addIcon=function(e){if(this.icons.length===SideBar.SLOTS.length){var t=this.icons.map(function(e){return e.mission&&e.mission.name||""});cleverapps.throwAsync("No vacant slot exists! icons - "+t.join(", "))}else{var s,i=this.icons.length;for(s=this.icons.length-1;0<=s&&!(this.icons[s].priority>=e.priority);s--)i--;for(this.icons.push(!1),s=this.icons.length-2;i<=s;s--)this.icons[s+1]=this.icons[s],this.onMoveIcon(s+1,s);this.icons[i]=e,this.onAddIcon(i)}},SideBar.prototype.findMissionIcon=function(e){for(var t=0;t<this.icons.length;t++){var s=this.icons[t];if(s instanceof MissionIcon&&s.mission.type===e)return s}},
SideBar.prototype.removeIcon=function(e){var t=this.icons.indexOf(e);if(-1!==t){for(this.onRemoveIcon(t);t<this.icons.length-1;t++)this.icons[t]=this.icons[t+1],this.onMoveIcon(t,t+1);this.icons.pop()}},SideBar.LEFT_COLUMN=0,SideBar.RIGHT_COLUMN=1,SideBar.SLOTS=[{row:0,col:SideBar.LEFT_COLUMN},{row:1,col:SideBar.LEFT_COLUMN},{row:2,col:SideBar.LEFT_COLUMN},{row:0,col:SideBar.RIGHT_COLUMN},{row:1,col:SideBar.RIGHT_COLUMN},{row:2,col:SideBar.RIGHT_COLUMN},{row:3,col:SideBar.LEFT_COLUMN},{row:3,col:SideBar.RIGHT_COLUMN},{row:4,col:SideBar.LEFT_COLUMN},{row:4,col:SideBar.RIGHT_COLUMN}],SideBar.ICONS=[];var SideBarIcon=function(e){this.available=!1,this.animation=void 0,this.locked=!1,this.lottery=!1,this.attention=!1,this.smallIcon=!1,this.title=void 0,this.leftTime=void 0,this.priority=SideBarIcon.PRIORITY_NORMAL,this.progress=0,cleverapps.extend(this,e),this.onShowIconListener=function(){},this.onUnlockListener=function(){},this.onAddLotteryListener=function(){},
this.onRemoveLotteryListener=function(){},this.onAttentionOnListener=function(){},this.onAttentionOffListener=function(){},this.onChangeTitleListener=function(){},this.onStartTimerListener=function(){},this.onRemoveTimerListener=function(){},this.onShowProgressListener=function(){},this.onAddSmallIcon=function(){},this.onRemoveSmallIcon=function(){}};SideBarIcon.prototype.addProgress=function(e){this.progress+=e},SideBarIcon.prototype.showProgress=function(){this.onShowProgressListener(),this.progress=0},SideBarIcon.prototype.setAnimation=function(e){this.animation!==e&&(this.animation=e,this.onShowIconListener())},SideBarIcon.prototype.setIcon=function(e){this.icon!==e&&(this.icon=e,this.onShowIconListener())},SideBarIcon.prototype.setLocked=function(e){e=!!e,this.locked!==e&&(this.locked=e,this.locked||this.onUnlockListener())},SideBarIcon.prototype.setLottery=function(e){e=!!e,this.lottery!==e&&((this.lottery=e)?this.onAddLotteryListener():this.onRemoveLotteryListener())},
SideBarIcon.prototype.setAttention=function(e){e=!!e,this.attention!==e&&((this.attention=e)?this.onAttentionOnListener():this.onAttentionOffListener())},SideBarIcon.prototype.setSmallIcon=function(e){this.smallIcon!==e&&((this.smallIcon=e)?this.onAddSmallIcon(e):this.onRemoveSmallIcon())},SideBarIcon.prototype.setTitle=function(e){this.title!==e&&(this.title=e,this.onChangeTitleListener())},SideBarIcon.prototype.setLeftTime=function(e){this.leftTime!==e&&(this.leftTime=e),0<this.leftTime?this.onStartTimerListener():this.onRemoveTimerListener()},SideBarIcon.prototype.resetState=function(){},SideBarIcon.prototype.getLockedTip=function(){return Messages.get("IconLocked.TipDefault",{level:this.getTipData()})},SideBarIcon.prototype.getTipData=function(){},SideBarIcon.prototype.onPressed=function(){},SideBarIcon.prototype.getForce=function(){},SideBarIcon.prototype.removeFromSideBar=function(){cleverapps.sideBar.removeIcon(this)},SideBarIcon.prototype.getTitle=function(){
return this.locked?this.locked.lockedEvent?Messages.get("Soon"):Messages.get("IconLocked.TextDefault",{levelNo:cleverapps.humanReadableNumber(this.locked.episode,this.locked.level)}):this.title},SideBarIcon.PRIORITY_LOW=0,SideBarIcon.PRIORITY_NORMAL=1,SideBarIcon.PRIORITY_HIGH=2;var SideBarIconView=cc.Node.extend({ctor:function(e){this.model=e,this._super(),this.setAnchorPoint2(),this.show(),this.model.target&&this.registerTarget(cleverapps.styles.SideBarIconView,this.model.target),e.onShowIconListener=this.createListener(this.showIcon.bind(this)),e.onUnlockListener=this.createListener(this.unlock.bind(this)),e.onAttentionOnListener=this.createListener(this.turnOnAttention.bind(this)),e.onAttentionOffListener=this.createListener(this.turnOffAttention.bind(this)),e.onChangeTitleListener=this.createListener(this.addTitle.bind(this)),e.onAddLotteryListener=this.createListener(this.addLotteryIcon.bind(this)),e.onRemoveLotteryListener=this.createListener(this.removeLotteryIcon.bind(this)),
e.onStartTimerListener=this.createListener(this.runTimer.bind(this)),e.onRemoveTimerListener=this.createListener(this.hideTimer.bind(this)),e.onShowProgressListener=this.createListener(this.showProgress.bind(this)),e.onAddSmallIcon=this.createListener(this.addSmallIcon.bind(this)),e.onRemoveSmallIcon=this.createListener(this.removeSmallIcon.bind(this)),(this.model.animation||this.model.icon)&&this.showIcon(),this.model.locked&&this.setLocked(),this.model.lottery&&this.addLotteryIcon(),this.model.attention&&this.turnOnAttention(),this.model.title&&this.addTitle(),this.model.smallIcon&&this.addSmallIcon(),0<this.model.leftTime&&this.runTimer(),this.assignPressAction(),cleverapps.UI.applyHover(this)},showProgress:function(){var e=cleverapps.styles.SideBarIconView,t=this.parent.col===SideBar.RIGHT_COLUMN,s=cleverapps.UI.generateImageText("+"+this.model.progress,cleverapps.styles.FONTS.SIDEBAR_ICON_PROGRESS_TEXT);this.addChild(s),s.setPositionRound(
t?this.width/2-e.progress.text.offsetX:this.width/2+e.progress.text.offsetX,this.height/2),s.setLocalZOrder(-1),s.setOpacity(0);var i=new cleverapps.Spine(this.model.progressIconJson);this.addChild(i),i.setPositionRound(t?this.width/2-e.progress.animation.offsetX:this.width/2+e.progress.animation.offsetX,this.height/2),i.setLocalZOrder(-1);var n=s.scale;s.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.Spawn(new cc.FadeIn(.25),new cc.ScaleTo(.25,1.15*n)),new cc.ScaleTo(.1,n),new cc.DelayTime(.3),new cc.SkewTo(.2,10,0).easing(cc.easeIn(1)),new cc.Spawn(new cc.SkewTo(.2,-10,0).easing(cc.easeIn(2)),new cc.MoveTo(.2,cc.p(this.width/2,this.height/2)).easing(cc.easeIn(2))),new cc.RemoveSelf)),i.runAction(new cc.Sequence(new cc.DelayTime(1.2),new cc.CallFunc(function(){i.setAnimation(0,"animation",!1)}),new cc.DelayTime(.9),new cc.SkewTo(.2,10,0).easing(cc.easeIn(1)),new cc.Spawn(new cc.SkewTo(.22,-10,0).easing(cc.easeIn(2)),new cc.MoveTo(.3,cc.p(this.width/2,this.height/2)).easing(
cc.easeIn(2))),new cc.RemoveSelf));var o=this.scale;this.runAction(new cc.Sequence(new cc.DelayTime(2.5),new cc.ScaleTo(.2,1.1*o),new cc.ScaleTo(.2,o)))},addLotteryIcon:function(){this.removeLotteryIcon(),Lottery.addIcon(this,"icon")},removeLotteryIcon:function(){this.lotteryIcon&&this.lotteryIcon.removeFromParent()},assignPressAction:function(){this.touchListener&&(cc.eventManager.removeListener(this.touchListener),delete this.touchListener),this.model.locked?cleverapps.tooltipManager.create(this,{position:cleverapps.styles.UI.Tooltip.LOCATION.below,text:this.model.getLockedTip()}):(this.touchListener=cleverapps.UI.onClick(this,this.onPressed.bind(this),{useInteractiveScale:!0}),cleverapps.tooltipManager.remove(this))},onPressed:function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),cleverapps.audio.playSound(bundles.main.urls.click_effect),this.model.onPressed()},showForce:function(){cleverapps.forces.create(this,this.model.getForce())},setSize:function(
e){this.setContentSize2(e),this.setContentSize2(e),this.setPositionRound(this.width/2,this.height/2)},showIcon:function(){if(this.icon&&this.icon.removeFromParent(),this.model.icon){var e=this.model.icon,t=this.icon=e();cleverapps.UI.fitToBox(t,{width:.7*this.width,height:.7*this.height,maxScale:1.2}),t.setPositionRound(this.iconNode.width/2,this.iconNode.height/2),this.iconNode.addChild(t)}else if(this.model.animation){var s=this.icon=new cleverapps.Spine(this.model.animation);s.setPositionRound(this.iconNode.width/2,this.iconNode.height/2),this.iconNode.addChild(s);s.setAnimation(0,"animation",!1),this.model.locked||s.setCompleteListener(function(){s.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.Random.mathChoose(SideBarIconView.RANDOM_ANIMATION_INTERVALS)),new cc.CallFunc(function(){s.setAnimation(0,"animation",!1)})))})}},show:function(){var e=this.bg=cleverapps.UI.createScale9Sprite(cleverapps.skins.getSlot("iconBg",{image:bundles.sidebar.frames.icon_bg})),
t=cleverapps.styles.SideBarIconView;t.bg&&t.bg.width&&e.setContentSize(t.bg),this.addChild(e),e.setPositionRound(e.width/2,e.height/2),this.setSize(e.getContentSize());var s=this.iconNode=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(this.getContentSize());var i=cleverapps.styles.SideBarIconView.icon;s.setPositionRound(this.width/2+i.x,this.height/2+i.y),this.addChild(s)},setLocked:function(){var e=cleverapps.styles.SideBarIconView;e.lock.color?(this.bg.setColor(e.lock.color),this.icon&&this.icon.spine&&this.icon.spine.setColor(e.lock.color)):e.lock.greyscale&&this.icon&&this.icon.spine&&cleverapps.UI.convertToGrayScale(this.icon.spine);var t=this.lock=new cc.Sprite(bundles.sidebar.frames.lock);this.addChild(t,1),t.setPositionRound(e.lock)},unlock:function(){this.lock.removeFromParent(),this.bg.setColor(cleverapps.styles.COLORS.WHITE),this.icon&&this.icon.spine&&(this.icon.spine.setColor(cleverapps.styles.COLORS.WHITE),cleverapps.UI.convertToGrayScale(this.icon.spine,!0)),
this.assignPressAction()},addTitle:function(){if(this.text&&(this.text.removeFromParent(),delete this.text),this.textBg&&(this.textBg.removeFromParent(),delete this.textBg),void 0!==this.model.title){var e=cleverapps.styles.SideBarIconView.text;this.text=cleverapps.UI.generateTTFText(this.model.title,cleverapps.styles.FONTS.SIDEBAR_ICON_TEXT);var t=this.textBg=this.getTextBg();t?(t.setPositionRound(e),this.addChild(t),t.addChild(this.text),this.text.setPositionRound(t.width/2,t.height/2)):(this.addChild(this.text),this.text.setPositionRound(e)),this.text.y+=this.text instanceof cleverapps.UI.LabelTTF?e.regularFont.offsetY:e.offsetY,e.textWidth&&this.text.fitTo(e.textWidth),this.text.baseScale=this.text.scale}},runTimer:function(){this.hideTimer();var e=this.timer=new cleverapps.CountDown(this.model.leftTime,{onFinish:function(){this.model.resetState()}.bind(this)}),t=cleverapps.styles.SideBarIconView.text,s={font:cleverapps.styles.FONTS.SIDEBAR_ICON_TEXT,timerPosition:{x:0,y:t.offsetY
},regularFontTimerPosition:{x:0,y:t.regularFont.offsetY}},i=this.getTextBg();i&&(s.background_content=i);var n=this.timerView=new cleverapps.CountDownView(e,s);this.addChild(n),t.textWidth&&n.text.fitTo(t.textWidth),n.setPositionRound(t),n.baseScale=n.scale},getTextBg:function(){var e=cleverapps.styles.SideBarIconView.text.bg;if(e){var t=new cc.Sprite(bundles.sidebar.frames.icon_text_bg);if(e.scale9&&((t=cleverapps.UI.createScale9Sprite(bundles.sidebar.frames.icon_text_bg,cleverapps.UI.Scale9Rect.TwoPixelXY)).setContentSize2(e.width,e.height),e.arrow)){var s=new cc.Sprite(bundles.sidebar.frames.icon_text_arrow_bg);t.addChild(s),s.setPositionRound(e.arrow)}return t}},hideTimer:function(){this.timer&&(this.timer.remove(),delete this.timer),this.timerView&&(this.timerView.removeFromParent(),delete this.timerView)},turnOnAttention:function(){var e=this.mark=new cc.Sprite(bundles.sidebar.frames.attention_png);e.setLocalZOrder(2),this.addChild(e),e.setPositionRound(
cleverapps.styles.SideBarIconView.mark),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1))))},turnOffAttention:function(){this.mark.stopAllActions(),this.mark.removeFromParent(!0),delete this.mark},addSmallIcon:function(){this.smallIcon||(this.smallIcon=new cc.Sprite(this.model.smallIcon),this.addChild(this.smallIcon),this.smallIcon.setPositionRound(cleverapps.styles.SideBarIconView.smallIcon),this.smallIcon.setScale(.3),this.smallIcon.runAction(new cc.ScaleTo(.2,1)))},removeSmallIcon:function(){this.smallIcon&&(this.smallIcon.runAction(new cc.Sequence(new cc.ScaleTo(.2,.2),new cc.RemoveSelf)),delete this.smallIcon)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{SIDEBAR_ICON_TEXT:{name:"default",size:40},SIDEBAR_ICON_PROGRESS_TEXT:{name:"default",size:65,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE,color:cleverapps.styles.COLORS.YELLOW}}),cleverapps.styles.SideBarIconView={icon:{x:0,y:0},lock:{color:new cc.Color(130,130,130,255
),x:{align:"right",dx:0},y:{align:"bottom",dy:0}},text:{offsetY:0,regularFont:{offsetY:0},x:{align:"center",dx:0},y:{align:"bottom",dy:0}},mark:{x:{align:"right",dx:-5},y:{align:"top",dy:-5}},smallIcon:{x:{align:"left",dx:-40},y:{align:"top",dy:30}},progress:{text:{offsetX:250},animation:{offsetX:150}}},SideBarIconView.RANDOM_ANIMATION_INTERVALS=[5,7,9,11,12];var SideBarView=cc.Node.extend({ctor:function(e){this._super();var t=(e=e||{}).size||cleverapps.UI.getSceneSize();this.setAnchorPoint2(),this.setContentSize2(t.width,t.height),this.slots=SideBar.SLOTS.map(function(e){var t=new SideBarSlotView(e,this);return this.addChild(t),t},this),cleverapps.sideBar.onAddIcon=this.createListener(this.insert.bind(this)),cleverapps.sideBar.onMoveIcon=this.createListener(this.move.bind(this)),cleverapps.sideBar.onRemoveIcon=this.createListener(this.eject.bind(this)),cleverapps.sideBar.onToggle=this.createListener(this.toggle.bind(this)),cleverapps.sideBar.onForceIcon=this.createListener(
this.onForce.bind(this)),cleverapps.metha.registerControl("sidebar",this);for(var s=0;s<cleverapps.sideBar.icons.length;s++)this.insert(s,e)}});SideBarView.prototype.onForce=function(e){this.slots[e].showForce()},SideBarView.prototype.insert=function(e,t){var s=cleverapps.sideBar.icons[e],i=new SideBarIconView(s);this.slots[e].insert(i,cleverapps.extend({},t,{visible:cleverapps.metha.lastControlsVisible.sidebar}))},SideBarView.prototype.eject=function(e,t){return this.slots[e]&&this.slots[e].eject(t)},SideBarView.prototype.move=function(e,t){var s=this.eject(t,!0);this.slots[e].insert(s)},SideBarView.prototype.toggle=function(t){this.slots.forEach(function(e){t?e.show():e.hide()})};var SideBarSlotView=cc.Node.extend({ctor:function(e,t){this._super();var s=cleverapps.styles.SideBarSlot;this.setAnchorPoint2(),this.setContentSize2(s.width,s.height),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&s.mobileScale&&this.setScale(s.mobileScale),s.wideModeScales&&this.setScale(
s.wideModeScales[cleverapps.wideMode.mode]),this.row=e.row,this.col=e.col;var i=this.width/2*this.scale,n=(this.width+s.padding.horizontal)*this.scale,o=t.height-s.padding.top-this.row*(s.margin+this.height*this.scale);this.col===SideBar.LEFT_COLUMN?(this.hidePosition={x:-i,y:o},this.showPosition={x:this.hidePosition.x+n,y:o}):(this.hidePosition={x:t.width+i,y:o},this.showPosition={x:this.hidePosition.x-n,y:o}),this.visible=!1,this.setPositionRound(this.hidePosition)},insert:function(e,t){t=t||{},this.iconView=e,this.addChild(e),e.setPositionRound(this.width/2,this.height/2),void 0!==t.visible&&(this.hide(!0),t.visible&&this.show(t.silent))},eject:function(e){var t=this.iconView;return t.removeFromParent(!e),this.iconView=void 0,t},showForce:function(){this.show(!0),this.iconView.showForce()},show:function(e){this.iconView&&(this.stopAllActions(),e?(this.visible=!0,this.setPositionRound(this.showPosition)):this.runAction(new cc.Sequence(new cc.DelayTime(.3+.1*this.row),new cc.Show,
new cc.MoveTo(.5,this.showPosition).easing(cc.easeBackOut()))))},hide:function(e){this.iconView&&(this.stopAllActions(),e?(this.visible=!1,this.setPositionRound(this.hidePosition)):this.runAction(new cc.Sequence(new cc.MoveTo(.15,this.hidePosition),new cc.Hide)))}});cleverapps.styles.SideBarSlot={width:200,height:200,margin:20,padding:{top:220,horizontal:15}};var MethaIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.metha_icon_json})};MethaIcon.prototype=Object.create(SideBarIcon.prototype),(MethaIcon.prototype.constructor=MethaIcon).prototype.resetState=function(){this.available=cleverapps.metha.withSimpleMain();var e=!1;switch(cleverapps.metha.getType()){case Metha.FARM:!cleverapps.farm.isCompleted()&&cleverapps.farm.getBuilding().getQuest().isCompleted()&&(e=!0);break;case Metha.HOMEFIX:!cleverapps.home.isCompleted()&&cleverapps.home.getFurnitureToUpgrade()&&(e=!0)}this.setAttention(e)},MethaIcon.prototype.onPressed=function(){cleverapps.metha.display({
focus:"gotoMetha",action:function(e){cleverapps.scenes.replaceScene(new NoMainMethaScene,e)}})};var DailyLevelIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.daily_level_json})};DailyLevelIcon.prototype=Object.create(SideBarIcon.prototype),(DailyLevelIcon.prototype.constructor=DailyLevelIcon).prototype.resetState=function(){this.available=cleverapps.dailyLevel.isActive(),this.setAttention(!0)},DailyLevelIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"DailyLevel",action:function(e){cleverapps.dailyLevel.start(e)}})};var PackIcon=function(){SideBarIcon.call(this,{lottery:!0})};PackIcon.prototype=Object.create(SideBarIcon.prototype),(PackIcon.prototype.constructor=PackIcon).prototype.resetState=function(){if(this.available=cleverapps.packManager.isAvailable(),this.available){var e=cleverapps.packManager.get(),t={0:bundles.sidebar.jsons.pack_icon_json,1:bundles.sidebar.jsons.pack1_icon_json,2:bundles.sidebar.jsons.pack2_icon_json}
;this.setAnimation(t[e.stage])}},PackIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"PackWindow",control:["MenuBarGoldItem","MenuBarLivesItem","MenuBarCoinsItem","MenuBarWandsItem","MenuBarWorkersItem"],action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})};var PiggyBankIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.piggybank_icon_json})};PiggyBankIcon.prototype=Object.create(SideBarIcon.prototype),(PiggyBankIcon.prototype.constructor=PiggyBankIcon).prototype.resetState=function(){this.available=cleverapps.piggyBank.isActive(),this.setAttention(cleverapps.piggyBank.isFull()),this.setLeftTime(cleverapps.piggyBank.getLeftTime())},PiggyBankIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"PiggyBankWindow",control:"MenuBarGoldItem",action:function(e){new PiggyBankWindow,cleverapps.metha.onceNoWindowsListener=e}})};var SubscriptionIcon=function(){
var e=cleverapps.subscription&&!cleverapps.subscription.isActive();SideBarIcon.call(this,{lottery:e,animation:bundles.sidebar.jsons.premium_icon_json})};SubscriptionIcon.prototype=Object.create(SideBarIcon.prototype),(SubscriptionIcon.prototype.constructor=SubscriptionIcon).prototype.resetState=function(){this.available=Subscription.IsAvailable();var e=!1,t=!1,s=void 0;cleverapps.subscription&&cleverapps.subscription.isActive()&&(e=!(0<(s=cleverapps.subscription.getLeftTime()))&&(t=!0)),this.setLottery(e),this.setAttention(t),this.setLeftTime(s)},SubscriptionIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){cleverapps.subscription.reload(),new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})};var DailyCupIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.dailycup_icon_json})};DailyCupIcon.prototype=Object.create(SideBarIcon.prototype),(DailyCupIcon.prototype.constructor=DailyCupIcon
).prototype.getForce=function(){return Forces.DAILY_CUP},DailyCupIcon.prototype.resetState=function(){this.available=cleverapps.dailyCup&&DailyCup.IsAvailable(DailyCup.TYPE_DAILY,{future:!0});var e=this.available&&!DailyCup.IsAvailable(DailyCup.TYPE_DAILY);if(this.available&&!e&&(this.available=cleverapps.dailyCup.isActive()),e)this.setLocked(!0),this.setAttention(!1),this.setTitle(Messages.get("IconLocked.TextDefault",{levelNo:this.getTipData()}));else{this.setLocked(!1),this.setAttention(!this.locked&&cleverapps.dailyCup.isFinished());var t=cleverapps.dailyCup.getTimeLeft();0<t?(this.setLeftTime(t),this.setTitle(void 0)):(this.setLeftTime(0),this.setTitle("messages:Finished"))}},DailyCupIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"DailyCupSceneFromIcon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)}})},DailyCupIcon.prototype.getTipData=function(){var e=DailyCupsConfig[DailyCup.TYPE_DAILY].available
;return cleverapps.humanReadableNumber(e.episode,e.level)};var HeroesIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.heroes_icon_json})};HeroesIcon.prototype=Object.create(SideBarIcon.prototype),(HeroesIcon.prototype.constructor=HeroesIcon).prototype.resetState=function(){this.available="undefined"!=typeof match3&&match3.heroes&&match3.heroes.available({future:!0}),this.available&&!match3.heroes.available()?(this.setLocked(!0),this.setAttention(!1),this.setTitle(Messages.get("IconLocked.TextDefault",{levelNo:this.getTipData()}))):(this.setLocked(!1),this.setAttention(match3.heroes.canUpgradeSomebody()),this.setTitle(void 0))},HeroesIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"HeroesSceneFromIcon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new HeroesScene,e)}})},HeroesIcon.prototype.getForce=function(){return Forces.HEROES_AVAILABLE},HeroesIcon.prototype.getTipData=function(){
return cleverapps.humanReadableNumber(Heroes.AVAILABLE.episode,Heroes.AVAILABLE.level)};var CardSkinsIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.card_skin_icon_json})};CardSkinsIcon.prototype=Object.create(SideBarIcon.prototype),(CardSkinsIcon.prototype.constructor=CardSkinsIcon).prototype.onPressed=function(){cleverapps.metha.display({focus:"CardSkinsSceneFromIcon",control:["toolbar","sidebar"],action:function(e){cleverapps.scenes.replaceScene(new CardSkinsScene,e)}})},CardSkinsIcon.prototype.resetState=function(){this.available=cleverapps.cardSkins&&cleverapps.cardSkins.available()};var QuestsSideBarIcon=function(){SideBarIcon.call(this,{}),this.quest=void 0};QuestsSideBarIcon.prototype=Object.create(SideBarIcon.prototype),(QuestsSideBarIcon.prototype.constructor=QuestsSideBarIcon).prototype.setQuest=function(e){return this.quest!==e&&(this.quest=e,!0)},QuestsSideBarIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"QuestsIconClicked",
action:function(e){new QuestsWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},QuestsSideBarIcon.GenerateIcon=function(e){if(e)return QuestIcon.getIconImage(e)},QuestsSideBarIcon.prototype.resetState=function(){if(this.available=Game.currentGame&&Game.currentGame.quests&&Game.currentGame.quests.getSelectedQuest()&&!cleverapps.config.editorMode,this.available){var e=Game.currentGame.quests.getSelectedQuest();this.setQuest(e)&&this.setIcon(function(){return QuestsSideBarIcon.GenerateIcon(this.quest)}.bind(this)),this.setTitle(e.progress+"/"+e.goal)}};var OrdersIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.orders_json,target:"orders"})};OrdersIcon.prototype=Object.create(SideBarIcon.prototype),(OrdersIcon.prototype.constructor=OrdersIcon).prototype.onPressed=function(){cleverapps.metha.display({focus:"OrdersIconClicked",action:function(e){new OrdersWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},OrdersIcon.prototype.resetState=function(
){this.available=Game.currentGame&&2<=Game.currentGame.gameLevel.getLevel()&&!cleverapps.config.editorMode,this.available&&this.setAttention(Game.currentGame.orders.findCanCook()||Game.currentGame.orders.findReady())};var UnitsShopIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.units_shop_json})};UnitsShopIcon.prototype=Object.create(SideBarIcon.prototype),(UnitsShopIcon.prototype.constructor=UnitsShopIcon).prototype.onPressed=function(){var e=["MenuBarGoldItem","MenuBarCoinsItem"];this.isEnergyTime()&&e.push("MenuBarLivesItem"),cleverapps.metha.display({focus:"UnitsShopIconClicked",control:e,action:function(e){new UnitsShopWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},UnitsShopIcon.prototype.getForce=function(){return Forces.UNITS_SHOP_ICON},UnitsShopIcon.prototype.resetState=function(){this.available=Game.currentGame&&5<=Game.currentGame.gameLevel.getLevel()&&Game.currentGame.unitsShop&&!cleverapps.config.editorMode,this.available&&(
this.setAttention(Game.currentGame.unitsShop.canTakeFreeChest()),this.setSmallIcon(!!this.isEnergyTime()&&bundles.mergeui.frames.energy_time_icon1))},UnitsShopIcon.prototype.isEnergyTime=function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_ENERGY_TIME);return e&&e.isRunning()};var UnitsLibraryIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.units_library_json})};UnitsLibraryIcon.prototype=Object.create(SideBarIcon.prototype),(UnitsLibraryIcon.prototype.constructor=UnitsLibraryIcon).prototype.onPressed=function(){cleverapps.metha.display({control:["MenuBarCoinsItem"],focus:"UnitsLibraryIconClicked",action:function(e){new UnitsLibraryWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},UnitsLibraryIcon.prototype.resetState=function(){this.available=Game.currentGame&&3<=Game.currentGame.gameLevel.getLevel()&&!cleverapps.config.editorMode,this.available&&this.setAttention(Game.currentGame.unitsLibrary.hasAnyFresh())}
;var RegionsSideBarIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.units_library_json})};RegionsSideBarIcon.prototype=Object.create(SideBarIcon.prototype),(RegionsSideBarIcon.prototype.constructor=RegionsSideBarIcon).prototype.onPressed=function(){cleverapps.metha.display({focus:"RegionsIconClicked",action:function(e){new RegionsWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},RegionsSideBarIcon.prototype.resetState=function(){this.available=Game.currentGame&&cleverapps.environment.isEditorScene()};var StarChestIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.star_chest_icon_json})};StarChestIcon.prototype=Object.create(SideBarIcon.prototype),(StarChestIcon.prototype.constructor=StarChestIcon).prototype.resetState=function(){this.available=void 0!==cleverapps.starChest;var e=cleverapps.starChest.stars+"/"+cleverapps.StarChest.GOAL_AMOUNT;this.setTitle(e),this.setAttention(
cleverapps.starChest.stars>=cleverapps.StarChest.GOAL_AMOUNT)},StarChestIcon.prototype.onPressed=function(){cleverapps.metha.display({focus:"StarChestWindow",action:function(e){cleverapps.starChest.locked?new StarChestLockedWindow:new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})};var AutoScrollText=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.styles=cleverapps.overrideStyles(cleverapps.styles.AutoScrollText,t.styles||{},!0),this.setAnchorPoint2(),this.styles.bg?this.bg=new cc.Scale9Sprite(this.styles.bg.image):this.bg=new cc.Node,this.addChild(this.bg),this.bg.setAnchorPoint2(),this.createTexts(e),this.createArrow(),this.currentTextIndex=0,this.texts[this.currentTextIndex].setVisible(!0)},createTexts:function(e){this.texts=[];var s=0;e.forEach(function(e){var t=cleverapps.UI.generateTTFText(e,this.styles.font);t.setDimensions(this.styles.width,0),t.setHorizontalAlignment(this.styles.horizontalAlignment),t.fitTo(void 0,this.styles.height),
t.setVisible(!1),this.texts.push(t),this.bg.addChild(t),s=Math.max(s,t.height)}.bind(this)),this.bg.setContentSize2(this.styles.width+2*this.styles.padding.x,s+2*this.styles.padding.y),this.setContentSize2(this.bg.getContentSize()),this.bg.setPositionRound(this.width/2,this.height/2),this.texts.forEach(function(e){e.setPositionRound(this.bg.width/2,this.bg.height/2)}.bind(this))},createArrow:function(){var e=cleverapps.UI.generateTTFText("▼",this.styles.font),t=new cc.Node;t.setContentSize2(3*e.width,3*e.height),t.setAnchorPoint2(),this.bg.addChild(t),t.setPositionRound(this.styles.arrow),t.addChild(e),e.setPositionRound(t.width/2,t.height/2),cleverapps.UI.onClick(t,function(){this.next(),this.reinitTimer()}.bind(this))},next:function(){this.texts[this.currentTextIndex].setVisible(!1),this.currentTextIndex=(this.currentTextIndex+1)%this.texts.length,this.texts[this.currentTextIndex].setVisible(!0)},reinitTimer:function(){this.stopAllActions(),this.runAction(new cc.Sequence(
new cc.DelayTime(5),new cc.CallFunc(this.next.bind(this))).repeatForever())},setTextByIndex:function(e){this.texts[this.currentTextIndex]&&this.texts[this.currentTextIndex].setVisible(!1),this.currentTextIndex=e,this.texts[this.currentTextIndex].setVisible(!0)}});cleverapps.styles.AutoScrollText={font:cleverapps.styles.FONTS.WINDOW_TEXT,horizontalAlignment:cc.TEXT_ALIGNMENT_CENTER,padding:{x:30,y:60},arrow:{x:{align:"right",dx:0},y:{align:"bottom",dy:-30}}};var FbButton=cleverapps.UI.Button.extend({ctor:function(e){this.options=e||{},this.login=e.login||!cleverapps.social.isLoggedIn()&&!cleverapps.social.nativeInviteFriends,this.options.hasOwnProperty("showIcon")||(this.options.showIcon=!0),this.options.hasOwnProperty("showText")||(this.options.showText=!0),this.options.onSuccess=this.options.onSuccess||function(){},this.options.onFailure=this.options.onFailure||function(){},this.source=this.options.source||cleverapps.User.calcSource();var t=this.generateContent(),
s=cleverapps.styles.FbButton,i={button_png:this.options.button_png||s.button_png,button_on_png:this.options.button_on_png||s.button_on_png,width:this.options.width||t.width,height:this.options.height||s.height,onClicked:this.onClicked.bind(this),content:t,contentOffset:s.iconOffset,scale:!1,fitTo:!1};this.options.multiSocials&&(i.button_png=s.multiSocials[this.source+"_button_png"]||s.multiSocials.button_png,i.button_on_png=s.multiSocials[this.source+"_button_on_png"]||s.multiSocials.button_on_png,i.width=1.1*i.height),this._super(i),this.onSuccess=e.onSuccess||function(){},cleverapps.social.isInitialized()||(this.connecting=!0,this.onMouseOver=function(){},this.onMouseOut=function(){})},generateContent:function(){var e=cleverapps.styles.FbButton;this.text=this.login?"messages:SignIn":"messages:FBLoginOrInvite.Button.Invite",this.connecting&&(this.text="messages:FBLoginOrInvite.Button.Connecting");var t,s=[],i=e.icon;if(
this.login||this.options.showIcon&&!cleverapps.social.nativeInviteFriends?(t=e.icon.image[this.source]||bundles.main.frames.fb_icon_png,this.options.multiSocials&&e.multiSocials.icons[this.source]&&(t=e.multiSocials.icons[this.source])):this.options.showIcon&&cleverapps.social.nativeInviteFriends&&(t=bundles.main.frames.native_invite_icon_png,i=e.inviteIcon||i),t){var n=new cc.Sprite(t);n.setScale(this.options.iconScale||i.scale),n.setPositionY(i.offsetY),s.push(n)}if(this.options.showText){var o=cleverapps.UI.generateTTFText(this.text,this.options.font||e.font);s.push(o)}var r=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,padding:{x:e.padding,y:0}});return r.setCascadeOpacityEnabled(!0),r},onClicked:function(){if(cleverapps.social.isInitialized())if(this.login){var e=function(){var e=function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOGIN,{method:this.options.source}),this.options.onSuccess()}.bind(this);cleverapps.social.login(e,
this.options.onFailure,{source:this.options.source})}.bind(this);this.options.multiSocials&&cc.sys.isNative?(this.stopAllActions(),this.setScale(.95),this.runAction(new cc.Sequence(new cc.DelayTime(.05),new cc.CallFunc(e),new cc.ScaleTo(.15,1).easing(cc.easeBackInOut())))):e()}else{cleverapps.history.add("invt",1);var t={message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this};e=function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.INVITE_FRIENDS),this.options.onSuccess()):this.options.onFailure()}.bind(this);cleverapps.social.inviteFriends(t,e)}else cleverapps.Notification.create("messages:SocialManager.Initialization")}});cleverapps.styles.FbButton={height:110,padding:70,margin:15,font:cleverapps.styles.FONTS.BUTTON_TEXT,multiSocials:{button_png:bundles.main.frames.white_outline_button_png,button_on_png:bundles.main.frames.white_outline_button_on_png,
androidsocial_button_png:bundles.main.frames.white_shadow_button_png,androidsocial_button_on_png:bundles.main.frames.white_shadow_button_on_png,facebook_button_png:bundles.main.frames.blue_outline_button_png,facebook_button_on_png:bundles.main.frames.blue_outline_button_on_png,icons:{}},icon:{image:{mobile_ok:bundles.main.frames.ok_icon_png,web_ok:bundles.main.frames.ok_icon_png,xsolla:bundles.main.frames.xsolla_icon_png,facebook:bundles.main.frames.fb_icon_png,mobile_vk:bundles.main.frames.vk_icon_png,web_vk:bundles.main.frames.vk_icon_png,mbga:bundles.main.frames.mobage_icon_png,sp_mbga:bundles.main.frames.mobage_icon_png,nk:bundles.main.frames.nk_icon_png,draugiem:bundles.main.frames.draugiem_icon_png,web_mm:bundles.main.frames.mm_icon_png,mobile_mm:bundles.main.frames.mm_icon_png,fotostrana:bundles.main.frames.fs_icon_png,androidsocial:bundles.main.frames.google_icon_png,applesocial:bundles.main.frames.apple_icon_png},scale:.9,offsetY:0},inviteIcon:{scale:1,offsetY:-3}}
;var BandButton=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.BandButton;this.setAnchorPoint2(),this.setContentSize2(t);var s=cleverapps.clone(t.position,!0);this.setPositionRound(s);var i=cleverapps.UI.createScale9Sprite(bundles.buttons_main.frames.scene_exit_button,cleverapps.UI.Scale9Rect.TwoPixelXY);i.setContentSize2(t),this.addChild(i),i.setPositionRound(this.width/2,this.height/2);var n=new cc.Sprite(bundles.buttons_main.frames.exit_button_icon);this.addChild(n),n.setPositionRound(t.icon),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),e.onClicked()}.bind(this),{useInteractiveScale:!0})},hide:function(e){if(e)return this.setPositionRound(this.hideHandler.hidePosition),void this.setVisible(!1);this._animate("close",function(){this.setVisible(!1)}.bind(this))},show:function(){this.setVisible(!0),this._animate("open")},
_animate:function(e,t){this.stopAllActions();var s="open"===e?cc.easeBackOut(10):cc.easeBackIn(10),i="open"===e?this.hideHandler.originalPosition:this.hideHandler.hidePosition;this.runAction(new cc.Sequence(new cc.MoveTo(.3,i).easing(s),new cc.CallFunc(function(){t&&t()})))}});cleverapps.styles.BandButton={width:85,height:190,position:{x:{align:"right",dx:-40},y:{align:"top",dy:10}},icon:{x:{align:"center"},y:{align:"bottom",dy:25}}},cleverapps.Path=cc.Node.extend({ctor:function(e,t){this._super(),this.baseColor=e,this.pathColor=cc.color(this.baseColor),this.lineWidth=t||cleverapps.styles.Path.lineWidth,this.segments=[];for(var s=0;s<cleverapps.Path.MAX_SEGMENTS;++s)this.segments.push(cleverapps.UI.createScale9Sprite(cleverapps.styles.Path.image)),this.segments[s].setAnchorPoint2(0,.5),this.segments[s].visible=!1,this.addChild(this.segments[s]);this.path=[],this.animatingInterval=void 0,this.drawTrailing=!0,this.setCascadeOpacityEnabled(!0),this.setLocalZOrder(-1)},clear:function(){
this.segments.forEach(function(e){e.visible=!1})},reset:function(){this.animatingInterval&&(clearInterval(this.animatingInterval),this.animatingInterval=void 0),this.clearFadeInInterval(),this.path=[],this.pathColor=cc.color(this.baseColor),this.opacity=255,this.draw()},clearFadeInInterval:function(){void 0!==this.animateFadeInInterval&&(clearInterval(this.animateFadeInInterval),this.animateFadeInInterval=void 0)},push:function(e){this.path.push(e),this.draw()},pop:function(){this.path.pop(),this.draw()},setPath:function(e){this.path=e.map(function(e){return e})},listPath:function(){return this.path},onExitTransitionDidStart:function(){this.reset(),this._super()},drawSegment:function(e,t,s){var i=15*resolutionScale/2*.9,n=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))+2*i,o=this.segments[s];o.setColor(this.pathColor),o.setContentSize2(n,this.lineWidth);var r=Math.round(100*Math.atan2(t.y-e.y,t.x-e.x))/100;o.setPositionRound(e.x-i*Math.cos(r),e.y-i*Math.sin(r)),
o.rotation=180*-r/Math.PI,o.visible=!0},draw:function(e){if(this.clear(),0<this.path.length)for(var t=this.drawTrailing&&e?this.path.concat(e):this.path,s=0;s<t.length-1;s++)this.drawSegment(t[s],t[s+1],s)},stopAnimation:function(){this.animatingInterval&&this.reset()},animateFadeIn:function(e){e=e||300;var t=0,s=this.createListener(function(){this.opacity=Math.min(255,Math.floor(255*(1-(e-t)/e))),this.draw(),e<=(t+=16)&&this.clearFadeInInterval()});this.animateFadeInInterval=setInterval(s,16),s()},animateFadeOut:function(e){e=e||300;var t=0,s=this.createListener(function(){e<=t?this.reset():(this.opacity=Math.floor(Math.min(155,this.baseColor.a)*(e-t)/e),this.draw(),t+=16)});this.stopAnimation(),this.animatingInterval=setInterval(s,16),s()}}),cleverapps.Path.MAX_SEGMENTS=10,cleverapps.styles.Path={lineWidth:17,image:bundles.game.frames.line_png};var Product=function(e){if(cleverapps.extend(this,e),this.title=Messages.getLocalized(this.title),this.description=Messages.getLocalized(
this.description),this.onChangeDescription=function(){},this.id){var t="res/fbproducts/"+(cleverapps.settings.language+"/"+(0===cleverapps.config.debugMode?"production/":""))+this.id.facebook;this.id.facebook=cleverapps.config.deployment+"/"+t}};Product.SearchProductId=function(e){if(-1!==e.indexOf(".html"))for(var t in cleverapps.config.products){var s=cleverapps.config.products[t];if(s.id&&s.id.facebook===e)return t}return e},Product.FormatUnlimitedLives=function(e,t){if("object"==typeof e)return e;var s=Math.round(cleverapps.parseInterval(e)/1e3/60),i={15:"15 minutes",10:"10 minutes",30:"30 minutes",45:"45 minutes",60:"OneHour",120:"TwoHours",180:"ThreeHours",360:"6 hours",720:"12 hours"};return{title:(t?"messages:UnlimitedLivesShort.":"messages:UnlimitedLives.")+({1:"1 day",2:"2 day",3:"3 day",5:"5 day",9:"9 day",10:"10 day"}[Math.floor(s/60/24)]||i[s]),interval:e}},Product.AddUpRewards=function(e,t){for(var s in t=t||{},e){var i=e[s];if("unlimitedLives"===s
)t[s]=t[s]?t[s]+cleverapps.parseInterval(i):cleverapps.parseInterval(i);else if("boosters"===s)for(var n in t.boosters||(t.boosters={}),i)t.boosters[n]=t.boosters[n]?t.boosters[n]+parseInt(i[n]):parseInt(i[n]);else t[s]=t[s]?t[s]+parseInt(i):parseInt(i)}return t},Product.UnlimitedToHours=function(e){if(e.unlimitedLives){var t=Math.round(e.unlimitedLives/1e3/60/60);e.unlimitedLives={title:Messages.get("AMOUNT_HOURS",{amount:t}),interval:t+" hours"}}return e},Product.prototype.getCurrentPrice=function(){return this.loadedPrice?this.loadedPrice:Product.CURRENCY+" "+this.price},Product.prototype.validate=function(t,e){var s={itemId:this.itemId,price:this.price,textPrice:this.getCurrentPrice()};this.loadedPriceAmount&&this.loadedCurrencyCode&&(s.textPrice=this.loadedPriceAmount+" "+this.loadedCurrencyCode),s.price=Math.round(s.price*cleverapps.User.calcPriceCoef()*100)/100;var i=function(){if("subscription"===this.type?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_BOUGHT,s
):(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT,s),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT_LANGUAGE,{amount:s.price}),t&&cleverapps.payments.logPurchase(t),cleverapps.paymentsHistory.addPayment(this),this.favoriteId=Favorite.CalcFavorite(),this.favoriteId===s.itemId&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAVORITE_REGULAR,{amount:s.price}),cleverapps.history.add("paid",s.price),cleverapps.history.add("pmnt",1)),this.favorite)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAVORITE_PRODUCT_BOUGHT,{amount:s.price});else if("gunShot"===this.itemId)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GUN_SHOT);else if("battlepass"===this.itemId)cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BATTLE_PASS_BOUGHT);else if(-1!==["starterPack0","starterPack","starterPack2"].indexOf(this.itemId)){var e=["starterPack0","starterPack","starterPack2"].indexOf(this.itemId);cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.PACK_BOUGHT_WITH_PAYMENT),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACK_BOUGHT+"_starterPack"+(0===e?"":"_"+e))}else-1!==["piggybank500","piggybank1800","piggybank6000","piggybank25000"].indexOf(this.itemId)?(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK_LEVEL+this.piggyBankLevel)):-1!==["addMoves1","addMoves2","addMoves3","addMoves5"].indexOf(this.itemId)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BUY_MOVES+this.itemId);"string"==typeof cleverapps.environment.episodeNo&&0===cleverapps.environment.episodeNo.indexOf("bonus_world_")&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT_BONUS_WORLD),cleverapps.metha.getType()===Metha.FARM&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PRODUCT_BOUGHT_BUILDING+"_"+cleverapps.farm.currentBuildingId)}.bind(this);e?cleverapps.payments.compensateValidate?cleverapps.payments.compensateValidate(i):i(
):cleverapps.payments.validate(t,i)},Product.prototype.showBoughtMessage=function(e){var s=this.boughtMessage||"messages:Product.YouBought",i=this.boughtMessageParams||{};i.moves=this.moves,e&&(e.gold||e.coins)&&(i.coins=e.gold||e.coins);var n=cleverapps.isLocalhost()||cleverapps.isInstant()?this.image.substr(1):cleverapps.config.deployment+this.image;cc.loader.load(n,function(e){var t=void 0;e||(t=new cc.Sprite(n)).setScale(.6*resolutionScale);cleverapps.Notification.create(s,{toReplace:i,image:t,leaveOnResize:!0})}.bind(this))},Product.prototype.compensate=function(t){var s=this.compensateReward||this.reward;if(s){this.validate(void 0,!0),this.showBoughtMessage(s);var e=[];s.gold&&e.push("MenuBarGoldItem"),(s.lives||s.energy)&&e.push("MenuBarLivesItem"),cleverapps.metha.display({focus:"purchaseRewardWindow",control:e,action:function(e){new PurchaseRewardWindow({reward:s,callback:function(){var e=cleverapps.packManager.get();e&&e.product===this.key&&cleverapps.packManager.onBuyPack(),
cleverapps.piggyBank.getProduct().itemId===this.key&&cleverapps.piggyBank.onBuy(),t&&t()}.bind(this)}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)}),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect)}},Product.prototype.onBuyed=function(e,t,s){var i=this.key;cleverapps.payments.addClientCompensateProduct(i);var n=e;e=function(){cleverapps.payments.onPaymentFinished(),n&&n(),cleverapps.payments.processClientCompensateProduct(i)},this.showBoughtMessage(this.reward),cleverapps.user.incProgressCompare(500);var o=this.reward;if(s&&(o=this.videoReward),o){var r={reward:o,callback:e};cleverapps.metha.isFocused()?new PurchaseRewardWindow(r):cleverapps.metha.display({focus:"purchaseRewardWindow",control:t,action:function(e){new PurchaseRewardWindow(r),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}else e();cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect)},Product.prototype.buy=function(i,n){var o=function(e,t,s){if(e){cleverapps.Notification.create(
"messages:Product.PurchaseCancelled"),cleverapps.payments.onPaymentFinished(),s&&cleverapps.metha.display({focus:"ErrorWindow",action:function(e){new ErrorWindow(s),cleverapps.metha.onceNoWindowsListener=e}})}else this.validate(t),this.onBuyed(i,n)}.bind(this),r=cleverapps.metha.focus,e=function(){var i=this.waitWindow();cleverapps.payments.open(this,function(e,t,s){i&&i(),r!==cleverapps.metha.focus&&cleverapps.metha.isFocused()?cleverapps.metha.whenFreeFocus(function(){o(e,t,s)}):o(e,t,s)}.bind(this))}.bind(this);cc.sys.isNative||!cleverapps.payments.needSocialCheckConnection()?e():cleverapps.social.checkConnection(e)},Product.prototype.waitWindow=function(){var t;return cleverapps.metha.isFocused()?t=new WaitWindow:cleverapps.metha.display({focus:"WaitWindow",action:function(e){t=new WaitWindow,e()}}),cleverapps.waitNoMore(4e3,function(){t.close()})},Product.Create=function(e){e=Product.SearchProductId(e);var t=cleverapps.clone(cleverapps.config.products[e]||VirtualProducts[e],!0)
;return t.itemId=e,new Product(t)},Product.CURRENCY="$",Product.CURRENCY_CODE="USD";var CoinsProductTile=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.tileModel=e,this.small=!0,"bestSeller"!==e.badge&&"merge"!==cleverapps.config.type||(this.small=!1),e.refreshButton=this.refreshButton.bind(this);var s=this.createTile();this.addChild(s),this.setAnchorPoint2(),this.setContentSize2(s.width*s.scaleX,s.height*s.scaleY),s.setPositionRound(this.width/2,this.height/2),this.options.onClicked&&cleverapps.UI.onClick(this,function(){this.options.onClicked(this.tileModel)}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0})},refreshButton:function(e){if(this.button){var t=this.button.getPosition();if(this.button.removeFromParent(),this.button=new TileButton(this.tileModel,this.small,{onClicked:this.options.onClicked}),this.button.setPosition(t),this.content.addChild(this.button),e){var s=this.button.button.content.text.scale
;this.button.button.content.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5*s),new cc.ScaleTo(.2,s)))}}},createTile:function(){var e=this.options.styles?this.options.styles:this.small?cleverapps.styles.CoinsProductSmallTile:cleverapps.styles.CoinsProductLargeTile,t=[];this.options.noButton||(this.button=new TileButton(this.tileModel,this.small,{onClicked:this.options.onClicked}),t.push(this.button));var s=new TileRewardsBlock(this.tileModel,this.small,{noBg:this.options.rewardsBlockNoBg}),i=new TileIcon(this.tileModel,this.small);e.order===CoinsProductTile.ORDER.REWARD_CENTER?t.push(s,i):t.push(i,s);var n=this.content=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),o=cleverapps.UI.createScale9Sprite(this.small?bundles.tile_shop.frames.shop_tile_bg_png:bundles.tile_shop.frames.feature_tile_bg_png,e.adjustBackgroundCapInsets?cleverapps.UI.Scale9Rect.TwoPixelXY:cleverapps.UI.Scale9Rect.Default);if(o.setContentSize2(e),e.stitches&&new StitchesComponent(o,
e.stitches),e.innerBg){var r=new cc.Scale9Sprite(e.innerBg.image);r.setContentSize2(o.width-2*e.innerBg.padding.x,o.height-2*e.innerBg.padding.y),o.addChild(r),r.setPositionRound(e.innerBg)}return o.addChild(n),n.setPositionRound(o.width/2,o.height/2+e.offset.y),this.tileModel.badge&&(this.tileBadge=new TileBadge(this.tileModel.badge,this.small),o.addChild(this.tileBadge)),o.setScale(e.scale[cleverapps.wideMode.mode]),o},isSmall:function(){return this.small}});CoinsProductTile.ORDER={REWARD_CENTER:0,REWARD_TOP:1},cleverapps.styles.CoinsProductSmallTile={width:240,height:350,margin:15,order:CoinsProductTile.ORDER.REWARD_CENTER,offset:{y:0},scale:[1,1,1],ok_lottery:{icon:{x:{align:"right",dx:50},y:{align:"top",dy:50}}}},cleverapps.styles.CoinsProductLargeTile={width:444,height:747,order:CoinsProductTile.ORDER.REWARD_CENTER,offset:{y:0},scale:[1,1,1],ok_lottery:{icon:{x:{align:"right",dx:50},y:{align:"top",dy:50}}}};var PackProductTile=cc.Node.extend({ctor:function(e,t){this._super(),
this.options=t||{},this.tileModel=e,this.small=!1;var s=this.createTile();this.addChild(s),this.setAnchorPoint2(),this.setContentSize2(s.width*s.scaleX,s.height*s.scaleY),s.setPositionRound(this.width/2,this.height/2),e.refreshButton=this.refreshButton.bind(this),this.options.onClicked&&cleverapps.UI.onClick(this,function(){this.options.onClicked(this.tileModel)}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0})},refreshButton:function(e){if(this.button){var t=this.button.getPosition();if(this.button.removeFromParent(),this.button=new TileButton(this.tileModel,this.small,{onClicked:this.options.onClicked}),this.button.setPosition(t),this.content.addChild(this.button),e){var s=this.button.button.content.text.scale;this.button.button.content.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5*s),new cc.ScaleTo(.2,s)))}}},createTile:function(){var e=cleverapps.styles.PackProductTile,t=[];this.options.noButton||(this.button=new TileButton(this.tileModel,
this.small,{onClicked:this.options.onClicked}),t.push(this.button)),t.push(new TileRewardsBlock(this.tileModel,this.small)),e.title&&!this.options.noTitle&&t.push(this.createTitle()),t.push(new TileIcon(this.tileModel,this.small));var s=this.content=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),i=new cc.Scale9Sprite(e.tileBg||bundles.tile_shop.frames.shop_tile_bg_png);if(i.setContentSize2(this.options.size||e),e.stitches&&new StitchesComponent(i,e.stitches),e.innerBg){var n=new cc.Scale9Sprite(e.innerBg.image);n.setContentSize2(i.width-2*e.innerBg.padding.x,i.height-2*e.innerBg.padding.y),i.addChild(n),n.setPositionRound(e.innerBg)}return i.addChild(s),s.setPositionRound(i.width/2,i.height/2+e.offset.y),this.tileModel.badge&&(this.tileBadge=new TileBadge(this.tileModel.badge,this.small),i.addChild(this.tileBadge)),i.setScale(e.scale[cleverapps.wideMode.mode]),i},createTitle:function(){var e=cleverapps.styles.PackProductTile.title,
t=cleverapps.UI.generateOnlyText(this.tileModel.getTitle(),cleverapps.styles.FONTS.TILE_SHOP_WINDOW_PACK_TITLE||cleverapps.styles.FONTS.SMALL_WHITE_TEXT),s=new cc.Scale9Sprite(this.tileModel.product.titleBg||bundles.tile_shop.frames.red_stripe_png);return e.size&&s.setContentSize2(e.size),s.addChild(t),t.setPositionRound(s.width/2+e.x,s.height/2+e.y),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),s.setLocalZOrder(1),t.fitTo(s.width-(e.paddingX||0)),s},isSmall:function(){return!1}});cleverapps.styles.PackProductTile={offset:{y:-20},scale:[1,1.2,1.2],width:340,height:600,margin:10,title:{x:0,y:0}};var LivesProductTile=cc.Node.extend({ctor:function(e,t){this._super();var s=cleverapps.styles.LivesProductTile;this.options=t||{},this.tileModel=e,void 0!==s.isSmall?this.small=s.isSmall:this.small=!0,this.createTile(),this.updateTileState(),"buyEnergy350"===e.product.key&&0===e.product.price&&(
cleverapps.lives.onShowShopForceListener=this.createListener(function(e){cleverapps.forces.create(this,e)}.bind(this)))},isSmall:function(){return this.small},updateAttention:function(){this.tileModel.isAttention()&&this.tileModel.isAvailable()?this.attention||(this.attention=new cc.Sprite(bundles.windows.frames.tab_attention),this.attention.setPositionRound(cleverapps.styles.LivesProductTile.attention),this.addChild(this.attention),this.attention.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1))))):this.attention&&this.attention.removeFromParent()},createTile:function(){var e=cleverapps.styles.LivesProductTile,t={onClicked:this.options.onClicked};"merge"===cleverapps.config.type&&(t.button_png=bundles.tile_shop.frames.small_shop_button,t.button_on_png=bundles.tile_shop.frames.small_shop_button_on);var s=[];this.button=new TileButton(this.tileModel,this.small,t),s.push(this.button),this.tileModel.getProductDescription()&&(s.push(
this.createDescriptionContainer()),this.tileModel.onChangeDescription=this.createListener(this.updateTileState.bind(this))),s.push(this.createTitle());var i=this.tileModel.product.animation?{json:bundles.tile_shop.jsons.shop_lives_animations_json,delay:0}:{};this.icon=new TileIcon(this.tileModel,this.small,i,!0),s.push(this.icon);var n=new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),o=this.tile=cleverapps.UI.createScale9Sprite(e.tileBg||bundles.tile_shop.frames.shop_tile_bg_png,e.adjustBackgroundCapInsets?cleverapps.UI.Scale9Rect.TwoPixelXY:cleverapps.UI.Scale9Rect.Default);if(o.setContentSize2(e),e.innerBg){var r=new cc.Scale9Sprite(e.innerBg.image);r.setContentSize2(o.width-2*e.innerBg.padding.x,o.height-2*e.innerBg.padding.y),o.addChild(r),r.setPositionRound(e.innerBg)}o.addChild(n),n.setPositionRound(o.width/2,o.height/2+e.offset.y),o.setScale(e.scale[cleverapps.wideMode.mode]),this.tileModel.getDiscount()&&(this.tileBadge=new TileBadge({
image:bundles.tile_shop.frames.shop_discount_png,imageOff:bundles.tile_shop.frames.shop_discount_png_off,text:"messages:Badge.discount",amount:this.tileModel.getDiscount(),x:e.discount.x,y:e.discount.y,margin:e.discount.margin,padding:e.discount.padding}),o.addChild(this.tileBadge)),this.addChild(o),this.setAnchorPoint2(),this.setContentSize2(o.width*o.scaleX,o.height*o.scaleY),o.setPositionRound(this.width/2,this.height/2)},createTitle:function(){var e,t=cleverapps.styles.LivesProductTile.title,s=this.title=new cc.Scale9Sprite(t.bg||bundles.tile_shop.frames.red_stripe_png);if(s.setAnchorPoint2(),s.setLocalZOrder(t.zOrder||1),t.size&&s.setContentSize2(t.size),this.tileModel.getRewardsIcon()){var i=cleverapps.UI.generateImageText(this.tileModel.getTitle(),cleverapps.styles.FONTS.SHOP_LIVES_PRODUCT_TILE_TITLE||cleverapps.styles.FONTS.SMALL_WHITE_TEXT);i.setAnchorPoint2();var n=new cc.Sprite(this.tileModel.getRewardsIcon());n.setAnchorPoint2(),e=new cleverapps.Layout([n,i],{
direction:cleverapps.UI.HORIZONTAL,margin:t.margin}),cleverapps.UI.fitToBox(e,{width:s.width-(t.paddingX||0),height:e.height}),n.y+=t.iconOffsetY}else(e=cleverapps.UI.generateOnlyText(this.tileModel.getTitle(),cleverapps.styles.FONTS.SHOP_LIVES_PRODUCT_TILE_TITLE||cleverapps.styles.FONTS.SMALL_WHITE_TEXT)).setPositionRound(s.width/2+t.x,s.height/2+t.y),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),e.fitTo(s.width-(t.paddingX||0));return e.setPositionRound(s.width/2+t.x,s.height/2+t.y),s.addChild(e),s.enable=function(){this.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(t.bg||bundles.tile_shop.frames.red_stripe_png))},s.disable=function(){this.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(t.bg_off||t.bg||bundles.tile_shop.frames.red_stripe_png))},s},getDescriptionInnerContent:function(){var e=cleverapps.styles.LivesProductTile.description,t=this.tileModel.getProductDescription();if(t){"string"==typeof t&&(t={title:t})
;var s=[];if(t.title){var i=cleverapps.UI.generateOnlyText(t.title,cleverapps.styles.FONTS.SHOP_LIVES_PRODUCT_TILE_DESCRIPTION_TEXT||cleverapps.styles.FONTS.SMALL_WHITE_TEXT);s.push(i)}if(t.countdown&&t.countdown>Date.now()){var n=new cleverapps.CountDown(t.countdown-Date.now(),{onFinish:function(){this.tileModel.onChangeDescription()}.bind(this)}),o=new cleverapps.CountDownView(n,{font:cleverapps.styles.FONTS.SHOP_LIVES_PRODUCT_TILE_DESCRIPTION_TEXT||cleverapps.styles.FONTS.SMALL_WHITE_TEXT});if(bundles.tile_shop.frames.shop_timer_icon_png){var r=new cc.Sprite(bundles.tile_shop.frames.shop_timer_icon_png);o=new cleverapps.Layout([r,o],{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.LivesProductTile.description.timer.margin})}s.push(o)}var a=new cleverapps.Layout(s,{direction:cleverapps.UI.TOP_TO_BOTTOM});return a.setPositionRound({align:"center"},{align:"center"}),cleverapps.UI.fitToBox(a,e),a}},createDescriptionContainer:function(){
var e=cleverapps.styles.LivesProductTile.description,t=this.descriptionContainer=new cc.Node;return t.setAnchorPoint2(),t.setContentSize2(e.width,e.height),t},updateTileState:function(){this.descriptionContainer&&(this.descriptionContainer.removeAllChildren(),this.descriptionContainer.addChild(this.getDescriptionInnerContent())),this.tileModel.isAvailable()?(this.icon.enable(),this.button.enable(),this.tileBadge&&this.tileBadge.enable(),this.title.enable()):(this.icon.disable(),this.button.disable(),this.tileBadge&&this.tileBadge.disable(),this.title.disable()),this.updateAttention()}});cleverapps.styles.LivesProductTile={width:340,height:400,margin:10,colMargin:30,scale:[1,1,1],button:{width:225,height:75},offset:{y:0},icon:{wrap:{height:150,dy:-15}},attention:{x:{align:"center",dx:115},y:{align:"bottom",dy:95}},title:{x:0,y:5,margin:5,iconOffsetY:-4},description:{width:340,height:70,timer:{margin:6}},discount:{x:{align:"right",dx:-5},y:{align:"top",dy:-58},margin:-13,padding:{
left:40,right:20,top:10,bottom:25}}};var TileModel=function(e){this.product=e,this.isVideoProduct=this.constructor===TileModel&&cleverapps.flags.nopayments,this.refreshButton=function(){}};TileModel.prototype.videoPrice=function(){return this.product.videoPrice?this.product.videoPrice:Math.ceil(10*this.product.price)},TileModel.prototype.currentVideoProgress=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PRODUCT_VIDEO_PROGRESS+this.product.itemId)||0},TileModel.prototype.getCurrentPrice=function(){return this.isVideoProduct?this.currentVideoProgress()+"/"+this.videoPrice():this.product.getCurrentPrice()},TileModel.prototype.getDisabledPrice=function(){return"messages:Claimed"},TileModel.prototype.isAttention=function(){return!1},TileModel.prototype.getTitle=function(){return this.product.title},TileModel.prototype.getDescription=function(){return this.product.description},TileModel.prototype.getPrice=function(){return this.product.price},
TileModel.prototype.getItemId=function(){return this.product.itemId},TileModel.prototype.getIcon=function(){return this.product.icon},TileModel.prototype.getViewClassName=function(){return this.product.ViewClassName||CoinsProductTile},TileModel.prototype.getPriceIcon=function(){return this.isVideoProduct?bundles.shared.frames.adicon_png:this.product.priceIcon},TileModel.prototype.getProductDescription=function(){},TileModel.prototype.getRewardsIcon=function(){return this.product.rewardsIcon},TileModel.prototype.getReward=function(){return this.isVideoProduct&&this.product.videoReward?this.product.videoReward:this.product.reward},TileModel.prototype.getDiscount=function(){return this.product.discount},TileModel.prototype.isEnabled=function(){return"unlimitedLives"!==this.product.key||!cleverapps.flags.nopayments},TileModel.prototype.checkDisabledProducts=function(){if(this.product.disableProductIds)for(var e in this.product.disableProductIds){var t=TileModel.Create(Product.Create(
this.product.disableProductIds[e]));if(t.isEnabled()&&t.isAvailable())return!1}return!0},TileModel.prototype.buy=function(t,s){if(!this.isVideoProduct)return this.product.buy(t,s);cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){var e=this.currentVideoProgress();e++,cleverapps.eventLogger.logEvent("video_product_watchad"),e>=this.videoPrice()&&(e=0,cleverapps.eventLogger.logEvent("video_product_buy"),this.product.onBuyed(t,s,!0)),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PRODUCT_VIDEO_PROGRESS+this.product.itemId,e),this.refreshButton(0<e)}.bind(this),!0)},TileModel.prototype.isAvailable=function(){return!0},TileModel.Create=function(e){var t=TileModel;return e.TileModelClass&&(t=e.TileModelClass),new t(e)};var AskLivesTileModel=function(e){TileModel.call(this,e)};AskLivesTileModel.prototype=Object.create(TileModel.prototype),(AskLivesTileModel.prototype.constructor=AskLivesTileModel).prototype.getCurrentPrice=function(){return"messages:FREE"},
AskLivesTileModel.prototype.isEnabled=function(){return-1===["huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())},AskLivesTileModel.prototype.buy=function(s){cleverapps.social.checkConnection(function(){new SelectFriendWindow("askLives",function(e,t){cleverapps.social.sendRequest(e,"askLiveRequest",function(){e.forEach(function(e){cleverapps.friends.inApp(e)&&levels.friendRequests.sendServerRequest(e,levels.FriendRequest.TYPE_ASK_LIVE)}),t(),s()})})}.bind(this))};var RefillLivesTileModel=function(e){TileModel.call(this,e)};RefillLivesTileModel.prototype=Object.create(TileModel.prototype),(RefillLivesTileModel.prototype.constructor=RefillLivesTileModel).prototype.getReward=function(){return cleverapps.Lives.MAX_REGEN_AMOUNT},RefillLivesTileModel.prototype.getCurrentPrice=function(){return RefillLivesTileModel.PRICE},RefillLivesTileModel.prototype.buy=function(e){return!!levels.user.takeGold(RefillLivesTileModel.PRICE)&&(cleverapps.history.add("refill",1),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LIVES_BOUGHT),cleverapps.lives.give(this.getReward()),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),e(),!0)},RefillLivesTileModel.PRICE=100;var SoftCurrencyTileModel=function(e){cleverapps.flags.softCurrencyRealProduct&&(e=Product.Create(e.realProductId),this.realProduct=!0),TileModel.call(this,e)};SoftCurrencyTileModel.prototype=Object.create(TileModel.prototype),(SoftCurrencyTileModel.prototype.constructor=SoftCurrencyTileModel).prototype.getTitle=function(){return this.realProduct?this.product.title:Messages.getLocalized(this.product.title,{amount:this.getReward()})},SoftCurrencyTileModel.prototype.getCurrentPrice=function(){return this.realProduct?this.product.getCurrentPrice():this.getPrice()},SoftCurrencyTileModel.prototype.buy=function(e,t){if(this.realProduct)return this.product.buy(e,t);if(levels.user.takeGold(this.getPrice())){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SOFT_CURRENCY_BUY,{
amount:this.getReward()}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SOFT_CURRENCY_COST,{amount:this.getPrice()});var s=Game.currentGame;return s.setCoins(s.coins+this.getReward()),e(),!0}return!1};var BuyEnergyTileModel=function(e){TileModel.call(this,e),this.timeout=this.product.timeout||0,cleverapps.config.debugMode&&this.timeout&&(this.timeout=cleverapps.parseInterval("5 minutes"))};BuyEnergyTileModel.prototype=Object.create(TileModel.prototype),(BuyEnergyTileModel.prototype.constructor=BuyEnergyTileModel).prototype.getTitle=function(){return Messages.getLocalized(this.product.title,{restoreAmount:this.getRestoreAmount()})},BuyEnergyTileModel.prototype.isEnabled=function(){return!this.isAvailable()||this.checkDisabledProducts()},BuyEnergyTileModel.prototype.getRestoreAmount=function(){return this.product.reward},BuyEnergyTileModel.prototype.getCurrentPrice=function(){return this.product.price},BuyEnergyTileModel.prototype.getDiscount=function(){
return 0===this.product.price?0:this.product.discount},BuyEnergyTileModel.prototype.isAvailable=function(){return 0===this.product.price||Date.now()>=this.getNextBuyTime()},BuyEnergyTileModel.prototype.getProductDescription=function(){return this.isAvailable()?"messages:BuyEnergyProduct.description":{title:"messages:BuyEnergyProduct.waiting",countdown:this.getNextBuyTime()}},BuyEnergyTileModel.prototype.getNextBuyTime=function(){return this.timeout+Game.currentGame.energyProducts.getBuyTime(this.product.key)},BuyEnergyTileModel.prototype.buy=function(e){return!!this.isAvailable()&&(!!Game.currentGame.takeCoins(this.getCurrentPrice())&&(0!==this.product.price&&(Game.currentGame.energyProducts.buyProduct(this.product.key),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LIVES_BOUGHT)),cleverapps.lives.give(this.getRestoreAmount()),e(),!0))};var EnergyForVideoTileModel=function(e){TileModel.call(this,e),this.timeout=this.product.timeout||cleverapps.parseInterval("5 seconds"),
this.onChangeDescription=function(){}};EnergyForVideoTileModel.prototype=Object.create(TileModel.prototype),(EnergyForVideoTileModel.prototype.constructor=EnergyForVideoTileModel).prototype.getTitle=function(){return Messages.getLocalized(this.product.title,{restoreAmount:this.getRestoreAmount()})},EnergyForVideoTileModel.prototype.getRestoreAmount=function(){return this.product.reward},EnergyForVideoTileModel.prototype.isEnabled=function(){if(RewardedAdsManager.IsEnabled()&&!cleverapps.flags.almostNoAds)return this.checkDisabledProducts()},EnergyForVideoTileModel.prototype.getPriceIcon=function(){return bundles.shared.frames.adicon_png},EnergyForVideoTileModel.prototype.getCurrentPrice=function(){return"messages:Watch"},EnergyForVideoTileModel.prototype.isAvailable=function(){return Date.now()>=this.getNextBuyTime()},EnergyForVideoTileModel.prototype.getProductDescription=function(){return this.isAvailable()?"messages:EnergyForVideoProduct.description":{
title:"messages:EnergyForVideoProduct.waiting",countdown:this.getNextBuyTime()}},EnergyForVideoTileModel.prototype.getNextBuyTime=function(){return Game.currentGame.energyProducts.getBuyTime(this.product.key)+this.timeout},EnergyForVideoTileModel.prototype.buy=function(e){var t=cleverapps.metha.focus;cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){Game.currentGame.energyProducts.buyProduct(this.product.key),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LIVES_FOR_VIDEO_SHOP),cleverapps.lives.give(this.getRestoreAmount()),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),this.product.timeout?(t===cleverapps.metha.focus&&new LivesShopWindow,e()):this.onChangeDescription()}.bind(this),!0)};var EnergyLotteryTileModel=function(e){TileModel.call(this,e),this.lottery=Game.currentGame.energyLottery,this.onChangeDescription=function(){}};EnergyLotteryTileModel.prototype=Object.create(TileModel.prototype),(
EnergyLotteryTileModel.prototype.constructor=EnergyLotteryTileModel).prototype.getTitle=function(){return Messages.getLocalized(this.product.title,{restoreAmount:EnergyLottery.maxValue()})},EnergyLotteryTileModel.prototype.isAttention=function(){return this.isAvailable()},EnergyLotteryTileModel.prototype.getCurrentPrice=function(){return"messages:Claim"},EnergyLotteryTileModel.prototype.getDisabledPrice=function(){return this.lottery.isAvailable()?"messages:Claimed":Messages.get("EnergyLotteryProduct.level",{level:cleverapps.humanReadableNumber(EnergyLottery.AVAILABLE.episode,EnergyLottery.AVAILABLE.level)})},EnergyLotteryTileModel.prototype.isAvailable=function(){return this.lottery.isAvailable()&&this.lottery.isReady()},EnergyLotteryTileModel.prototype.getProductDescription=function(){return this.lottery.isAvailable()&&!this.lottery.isReady()?{title:"messages:EnergyLotteryProduct.waiting",countdown:Date.now()+this.lottery.getTimeLeft()}:"messages:EnergyLotteryProduct.description"},
EnergyLotteryTileModel.prototype.buy=function(){return!!this.isAvailable()&&(new EnergyLotteryWindow(this.onChangeDescription.bind(this)),!0)};var VirtualProducts={askLives:{icon:"askLives_png",title:"messages:LivesShopWindow.products.askLives",TileModelClass:AskLivesTileModel,ViewClassName:LivesProductTile},refillLives:{icon:"refillLives_5_png",title:"messages:LivesShopWindow.products.refillLives",priceIcon:bundles.reward_icons.frames.gold_small_png,TileModelClass:RefillLivesTileModel,ViewClassName:LivesProductTile},buyEnergy350:{icon:"energy_for_coins_png",title:"messages:LivesShopWindow.products.buyEnergy",priceIcon:bundles.reward_icons.frames.shop_coin_png,rewardsIcon:bundles.reward_icons.frames.shop_energy_png,price:350,reward:90,discount:"66%",timeout:cleverapps.parseInterval("24 hour"),TileModelClass:BuyEnergyTileModel,ViewClassName:LivesProductTile},buyEnergy700:{icon:"energy_for_coins_png",title:"messages:LivesShopWindow.products.buyEnergy",
priceIcon:bundles.reward_icons.frames.shop_coin_png,rewardsIcon:bundles.reward_icons.frames.shop_energy_png,price:700,reward:90,discount:"33%",disableProductIds:["buyEnergy350"],timeout:cleverapps.parseInterval("24 hour"),TileModelClass:BuyEnergyTileModel,ViewClassName:LivesProductTile},buyEnergy:{icon:"energy_for_coins_png",title:"messages:LivesShopWindow.products.buyEnergy",priceIcon:bundles.reward_icons.frames.shop_coin_png,rewardsIcon:bundles.reward_icons.frames.shop_energy_png,price:1050,reward:90,disableProductIds:["buyEnergy350","buyEnergy700"],TileModelClass:BuyEnergyTileModel,ViewClassName:LivesProductTile},energyForVideo:{icon:"energy_for_video_png",title:"messages:LivesShopWindow.products.energyForVideo",rewardsIcon:bundles.reward_icons.frames.shop_energy_png,reward:30,timeout:cleverapps.parseInterval(cleverapps.config.debugMode?"1 minute":"1 hour"),TileModelClass:EnergyForVideoTileModel,ViewClassName:LivesProductTile},energyForVideoShort:{icon:"energy_for_video_png",
title:"messages:LivesShopWindow.products.energyForVideoShort",reward:5,rewardsIcon:bundles.reward_icons.frames.shop_energy_png,disableProductIds:["energyForVideo"],TileModelClass:EnergyForVideoTileModel,ViewClassName:LivesProductTile},energyLottery:{icon:"energy_lottery_png",title:"messages:LivesShopWindow.products.energyLottery",TileModelClass:EnergyLotteryTileModel,ViewClassName:LivesProductTile},softCurrencySmall:{icon:"soft_currency_small_png",title:"messages:LivesShopWindow.products.softCurrencySmall",priceIcon:bundles.reward_icons.frames.gold_small_png,rewardsIcon:bundles.reward_icons.frames.shop_coin_png,realProductId:"coins150",price:35,reward:150,TileModelClass:SoftCurrencyTileModel,ViewClassName:LivesProductTile},softCurrencyMedium:{icon:"soft_currency_medium_png",title:"messages:LivesShopWindow.products.softCurrencyMedium",priceIcon:bundles.reward_icons.frames.gold_small_png,rewardsIcon:bundles.reward_icons.frames.shop_coin_png,realProductId:"coins1000",price:225,reward:1e3,
TileModelClass:SoftCurrencyTileModel,ViewClassName:LivesProductTile},softCurrencyLarge:{icon:"soft_currency_large_png",title:"messages:LivesShopWindow.products.softCurrencyLarge",priceIcon:bundles.reward_icons.frames.gold_small_png,rewardsIcon:bundles.reward_icons.frames.shop_coin_png,realProductId:"coins2500",price:545,reward:2500,TileModelClass:SoftCurrencyTileModel,ViewClassName:LivesProductTile}};!function(){for(var e in VirtualProducts)VirtualProducts[e].key=e}();var Terms=cc.Node.extend({ctor:function(){this._super();var e=new cc.Node;e.addChild(cleverapps.UI.generateTTFText("messages:Terms.TermsOfService",cleverapps.styles.FONTS.TERMS_LINK_TEXT)),cleverapps.UI.wrap(e),this.addChild(e);var t=cleverapps.UI.generateTTFText(" "+Messages.get("Terms.and")+" ",cleverapps.styles.FONTS.TERMS_TEXT);this.addChild(t);var s=new cc.Node;s.addChild(cleverapps.UI.generateTTFText("messages:Terms.PrivacyPolicy",cleverapps.styles.FONTS.TERMS_LINK_TEXT)),cleverapps.UI.wrap(s),this.addChild(s),
cleverapps.UI.arrangeWithMargins(this.children,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.Terms.margin}),cleverapps.UI.wrap(this),cleverapps.UI.applyHover(e),cleverapps.UI.applyHover(s),cleverapps.UI.onClick(e,function(){cc.sys.openURL(projects.default.terms)}),cleverapps.UI.onClick(s,function(){cc.sys.openURL(projects.default.privacy)})}});cleverapps.overrideColors(cleverapps.styles.COLORS,{TERMS_LINK_COLOR:new cc.Color(97,167,221,255),TERMS_TEXT_COLOR:new cc.Color(55,80,58,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TERMS_TEXT:{size:25,color:cleverapps.styles.COLORS.TERMS_TEXT_COLOR},TERMS_LINK_TEXT:{size:25,color:cleverapps.styles.COLORS.TERMS_LINK_COLOR}}),cleverapps.styles.Terms={margin:6};var Restore=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.UI.generateTTFText("messages:RestorePurchases",cleverapps.styles.FONTS.TERMS_LINK_TEXT);this.addChild(e),cleverapps.UI.wrap(this),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,
function(){cleverapps.payments.restore();var e=new WaitWindow;this.stopWait=cleverapps.waitNoMore(5e3,cleverapps.once(function(){e.close(),this.recreateWindow(),delete this.stopWait}.bind(this))),cleverapps.subscription.onChangeStateListeners.restore=this.createListener(this.onChangeSubscription.bind(this))}.bind(this))},recreateWindow:function(){var e=cleverapps.windows.currentWindow();new SubscriptionWindow,e instanceof SubscriptionWindow&&e.close()},onChangeSubscription:function(){cleverapps.subscription.isActive()&&(this.stopWait?this.stopWait():this.recreateWindow())}}),BonusButton=cleverapps.UI.Button.extend({ctor:function(e){var t=cleverapps.styles.BonusButton;this.onClick=e.onClick;var s,i=new cc.Node;i.setContentSize(t.width,t.height),i.setAnchorPoint(.5,.5),this.withBonus=e.reward||e.price,e.text?(s=cleverapps.UI.generateOnlyText(e.text,cleverapps.styles.FONTS.BONUS_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT)).fitTo(.8*i.width):s=e.content;var n=[s];if(this.withBonus){
var o,r=[cleverapps.UI.generateOnlyText(e.reward?"+"+e.reward:e.price,cleverapps.styles.FONTS.SHARE_BUTTON_REWARD_TEXT)];!1!==e.rewardIcon&&((o=new cc.Sprite(e.rewardIcon?e.rewardIcon:bundles.menubar.frames.coin_png)).setScale(t.RewardCoins.scale),this.coin=o,r.push(o)),n.push(new cleverapps.Layout(r,{direction:cleverapps.UI.HORIZONTAL,margin:t.RewardCoins.margin})),o&&(o.y+=t.RewardCoins.offsetY)}var a=new cleverapps.Layout(n.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.margin});a.setPositionRound(i.width/2+t.content.offset.x,i.height/2+t.content.offset.y),i.addChild(a),this._super({content:i,width:i.width,height:i.height,fitTo:!1,onClicked:this.doAction.bind(this)})},doAction:function(){this.onClick()},animateCollectCoin:function(e){if(this.withBonus){cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect);var t=function(){e&&e()};cleverapps.styles.MenuBar.GoldItem.target&&this.coin?WindowHelper.animateCollect(this.coin,{scale:1,
target:cleverapps.styles.MenuBar.GoldItem.target},t):t()}else e&&e()}});cleverapps.styles.BonusButton={width:300,height:110,RewardCoins:{scale:.5,margin:10,offsetY:0},margin:-10,content:{offset:{x:0,y:0}}};var CoinsPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.styles=this.options.styles||cleverapps.styles.CoinsPriceView,this.price=e,this.setAnchorPoint2(),this.createContent(),this.createBg(),this.setCascadeOpacityEnabled(!0)},createContent:function(){this.content&&(this.content.removeFromParent(!0),delete this.content);var e=this.styles.icon&&this.styles.icon.image,t=new cc.Sprite(e||bundles.menubar.frames.coin_png);t.setScale(this.styles.icon.scale),e&&this.styles.icon.offsetY&&(t.y+=this.styles.icon.offsetY);var s=this.options.font||cleverapps.styles.FONTS.COINS_PRICE_TEXT||cleverapps.styles.FONTS.TEXT,i=this.label=cleverapps.UI.generateImageText(this.price,s),n=this.styles.isLabelFirst?[i,t]:[t,i];this.content=new cleverapps.Layout(n,{
margin:this.styles.margin,direction:cleverapps.UI.HORIZONTAL}),this.label.y+=this.styles.label.offsetY,this.addChild(this.content),this.setContentSize2(this.content.getContentSize()),this.content.setPositionRound(this.width/2,this.height/2),this.content.setCascadeOpacityEnabled(!0)},createBg:function(){this.styles.bg&&(this.bg&&(this.bg.removeFromParent(),delete this.bg),this.bg=new cc.Scale9Sprite(this.options.bg||this.styles.bg.image),this.addChild(this.bg),this.bg.setLocalZOrder(-1),this.bg.setContentSize2(this.width+2*this.styles.bg.padding.x,this.height+2*this.styles.bg.padding.y),this.bg.setPositionRound(this.width/2+this.styles.bg.dx,this.height/2+this.styles.bg.dy))},setPrice:function(e){this.price!==e&&(this.label.setString(e),this.price=e,this.createContent(),this.createBg())}});cleverapps.styles.CoinsPriceView={icon:{scale:.7},label:{offsetY:0},bg:{image:bundles.game.frames.ruby_substrate_png,padding:{x:2,y:-3},dx:4,dy:0},margin:0};var CoinsRewardView=cc.Node.extend({
ctor:function(e){this._super(),this.setAnchorPoint2(),this.options=cleverapps.extend({},cleverapps.styles.CoinsRewardView,e)},collectCoins:function(e){var t=[];if((this.options.coins||cleverapps.styles.CoinsRewardView.coins).forEach(function(e){t=t.concat(this.drawCoinsInCircle(e))}.bind(this)),e){var s=cleverapps.UI.generateTTFText("+"+e,cleverapps.styles.FONTS.COINS_REWARD_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setPositionRound(this.width/2,this.height/2),s.setScale(this.options.text.scale/2),s.setLocalZOrder(1000001),this.addChild(s),s.replaceParentSamePlace(cc.director.getRunningScene().scene),s.opacity=0,s.runAction(new cc.Sequence(new cc.FadeIn(.2),new cc.ScaleTo(this.options.showTextTime||CoinsRewardView.SHOW_TEXT_TIME,this.options.text.scale),new cc.FadeOut(.2),new cc.RemoveSelf))}var i=cc.director.getRunningScene().scene,n=this.options.target||cleverapps.styles.UI.RewardElementView.rewardGoldViewTarget||cleverapps.styles.MenuBar.GoldItem.target,
o=i.convertToNodeSpace(n.getParent().convertToWorldSpace(n.getPosition()));if(t.sort(function(e,t){return e.getPositionX()-t.getPositionX()}).forEach(function(e,t){e.replaceParentSamePlace(i),e.runAction(new cc.Sequence(new cc.DelayTime(CoinsRewardView.APPEAR_TIME+.01*t),new cc.Spawn(new cc.MoveTo(CoinsRewardView.COLLECT_COIN_TIME,o),new cc.RotateBy(CoinsRewardView.COLLECT_COIN_TIME,180)),new cc.RemoveSelf))}.bind(this)),this.options.sparkAnimation){var r=new cleverapps.Spine(bundles.game.jsons.coins_reward_json);r.setAnimation(0,"animation",!1),r.setPositionRound(this.width/2,this.height/2),this.addChild(r)}this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.RemoveSelf))},drawCoinsInCircle:function(e){for(var t=[],s=0;s<e.count;s++){var i=new cc.Sprite(bundles.menubar.frames.coin_png);i.setRotation(120*(Math.random()-.5)),i.setScale(0),i.setLocalZOrder(1e6);var n=2*Math.PI*s/e.count,o=(e.baseAngle||0)*Math.PI/180,r=e.radiusX*Math.cos(n+o),a=e.radiusY*Math.sin(n+o)
;this.options.randomOffset&&(r+=.5*(Math.random()-.5)*r,a+=.5*(Math.random()-.5)*a),i.setPosition(this.width/2+r,this.height/2+a),i.runAction(new cc.Spawn(new cc.MoveBy(CoinsRewardView.APPEAR_TIME,new cc.p(.2*r,.2*a)),new cc.ScaleTo(CoinsRewardView.APPEAR_TIME,e.scale))),this.addChild(i),t.push(i)}return t}});cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{COINS_TEXT_STROKE:{size:3,color:cleverapps.styles.COLORS.COINS_REWARD_STROKE_COLOR}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{COINS_REWARD_TEXT:{size:120,color:cleverapps.styles.COLORS.COINS_REWARD_YELLOW,stroke:cleverapps.styles.DECORATORS.COINS_TEXT_STROKE}}),CoinsRewardView.APPEAR_TIME=.4,CoinsRewardView.SHOW_TEXT_TIME=1.2,CoinsRewardView.COLLECT_COIN_TIME=.5,cleverapps.styles.CoinsRewardView={sparkAnimation:!0,randomOffset:!0,text:{scale:1},coins:[{radiusX:80,radiusY:80,count:6,scale:1}]};var ReloadWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.ReloadWindow,s=new cc.Node,i=function(e){
e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cc.sizeRound(t.width,0)),s.addChild(e)};i(cleverapps.UI.generateTTFText("messages:ReloadWindow.YouHaveSavedGame",cleverapps.styles.FONTS.WINDOW_TEXT)),i(cleverapps.UI.generateTTFText("messages:ReloadWindow.WeStoreGames",cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)})),cleverapps.UI.arrangeWithMargins(s.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(s),s.setAnchorPoint2(),s=cleverapps.UI.wrapWithPadding(s,t.padding),this.content=s,this._super({content:s,title:"messages:ReloadWindow.Title",name:"reloadwindow",button:{width:t.Button.width,height:t.Button.height,text:Messages.get("ReloadWindow.UpdateNow")},onClose:e,closeButton:!1,notCloseByTouchInShadow:!0}),cleverapps.audio.playSound(bundles.main.urls.window_effect),cleverapps.windows.list=[this]}});cleverapps.styles.ReloadWindow={width:600,margin:20,paddingY:10,padding:{x:0,y:10},
Button:{}},"horizontal"===cleverapps.config.orientation&&cleverapps.increaseStylesByKoef(cleverapps.styles.ReloadWindow,1.5);var LocalStorageDisabledWindow=Window.extend({onWindowLoaded:function(){var t=cleverapps.styles.LocalStorageDisabledWindow,s=new cc.Node,e=function(e){e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cc.sizeRound(t.width,0)),s.addChild(e)};e(cleverapps.UI.generateTTFText("messages:LocalStorageDisabledWindow.text2",cleverapps.styles.FONTS.WINDOW_TEXT)),e(cleverapps.UI.generateTTFText("messages:LocalStorageDisabledWindow.text1",cleverapps.styles.FONTS.WINDOW_TEXT)),cleverapps.UI.arrangeWithMargins(s.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(s),s.setAnchorPoint2(),s=cleverapps.UI.wrapWithPadding(s,t.padding),this.content=s,this._super({content:s,title:"messages:LocalStorageDisabledWindow.title",name:"localstoragedisabledwindow",button:{text:Messages.get("OK"),width:t.button.width},closeButton:!1}),
cleverapps.audio.playSound(bundles.main.urls.window_effect)}});cleverapps.styles.LocalStorageDisabledWindow={width:600,margin:20,paddingY:20,padding:{x:0,y:35},button:{width:200}};var ErrorWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.WINDOW_TEXT);t.setDimensions(cleverapps.styles.ErrorWindow.dimensions),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this._super({content:t,title:{text:Messages.get("RestartWindow.Title"),localized:!0},name:"errorwindow",button:{text:Messages.get("OK")}}),cleverapps.audio.playSound(bundles.main.urls.window_effect)}});cleverapps.styles.ErrorWindow={dimensions:{width:500,height:0}};var RestartWindow=Window.extend({ctor:function(e){if(!RestartWindow.showed&&!cleverapps.environment.isSceneWithPreview()&&cc.director.getRunningScene()){RestartWindow.showed=!0,this.options=e=e||{},cleverapps.versionChecker.isNewClientVersionAvailable()&&(e.title=e.title||"RestartWindow.NewVersionTitle",
e.contentMessage=e.contentMessage||"RestartWindow.NewVersionAvailable");var t=e&&e.contentMessage?Messages.get(e.contentMessage):Messages.get("RestartWindow.AnErrorOccured")||"An error occurred";this.text=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.WINDOW_TEXT,!1),this.text.setDimensions(cleverapps.styles.RestartWindow.width,cleverapps.styles.RestartWindow.height),this.text.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.text.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this._super({parentScene:!0}),this.setLocalZOrder(1001)}},onWindowLoaded:function(){var e=this.options&&this.options.title?Messages.get(this.options.title):Messages.get("RestartWindow.Title")||"Try again";this._super({content:this.text,notCloseByTouchInShadow:!0,name:"RestartWindow",title:e,button:{text:Messages.get("RestartWindow.ButtonMessage")||"Reload",width:cleverapps.styles.RestartWindow.button.width,height:cleverapps.styles.RestartWindow.button.height,onPressed:function(){
window.location.reload()}},closeButton:!1}),this.window&&0===this.window.height&&(this.text.removeFromParent(),this.window.titleText.removeFromParent()),cleverapps.settings&&cleverapps.audio.playSound(bundles.main.urls.window_effect)}});cleverapps.styles.RestartWindow={width:570,height:460,button:{}},"horizontal"===cleverapps.config.orientation&&cleverapps.increaseStylesByKoef(cleverapps.styles.RestartWindow,1.4),
cc._loadingImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu4AAAU2CAMAAAD9CcM0AAADAFBMVEUCAgEDAwIEBAMFBQQGBgUHBwYICAcJCQgKCgkLCwoMDAsNDQwODg0PDw4QEA8RERASEhETExIUFBMVFRQWFhUXFxYYGBcZGRgaGhkbGxocHBsdHRweHh0fHx4gIB8hISAiIiEjIyIkJCMlJSQmJiUnJyYoKCcpKSgqKikrKyosLCstLSwuLi0vLy4wMC8xMTAyMjEzMzI0NDM1NTQ2NjU3NzY4ODc5OTg6Ojk7Ozo8PDs9PTw+Pj0/Pz5AQD9BQUBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYCCgoGDg4KEhIOFhYSGhoWHh4aIiIeJiYiKiomLi4qMjIuNjYyOjo2Pj46QkI+RkZCSkpGTk5KUlJOVlZSWlpWXl5aYmJeZmZiampmbm5qcnJudnZyenp2fn56goJ+hoaCioqGjo6KkpKOlpaSmpqWnp6aoqKepqaiqqqmrq6qsrKutrayurq2vr66wsK+xsbCysrGzs7K0tLO1tbS2trW3t7a4uLe5ubi6urm7u7q8vLu9vby+vr2/v77AwL/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///+xGNHLAABQFUlEQVR4AezSP2vVBxQA0JumCaUpdGpLW1oaCk3JkCUdSraEfoGGDoV2bad2URwE0clVlIc4OIkuDlE3CWRwcVHQVU0IakRDJGAkSv7EdzW+32/U3fvO+QwnEvpGJOgOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76I7uoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvo/g7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76I7uoDvoDrqD7qA76A66g+6gO+iO7qA76A66g+6gO+gOuoPuoDvoju6gO+gOuoPuoDvoDrqD7qA76A66ozvoDrqD7qA76A66g+6gO+gOuqM76A66g+6gO+gOuoPuoDvoDrqjO+gOuoPuoDvoDrqD7qA76A66ozvoDrqD7qA76A66g+6gO+gOuqM76A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76M7La2cvLmU/0J2l2c8ixs7sZnm683Qm9n1yLsvTnU70TK5mcbqzNRs9g/NZnO7cH4/GqSxOd258EY0DWZzuzH8ajT93szbdufxxNKY3sjbdmRuMxsRa1qY7V4ai8cNK1qY78yPR+Ope1qY717+Mxuc3szbduTMWjaG5rE131qaidTxr052d36P1dzdr053/ozW1nrXpzolofXsra9OdqyPR+Oh81qY7y6PROpi16c7Wb9GaeZ616c6xaH29mLXpzsJQNAYXsjbdefZrtDpZnO50ovVvN2vTnccT0Zh5kcXpzumB6BlfzeJ0Z/2X6Bl9kNXpzqXheOv75axOd7pHBnrdH2Z5urP5X+z7cTXr053Nw8MR8fN69gHd2bvwU8TkRvYF3Vk89N0/29kndOfJo1dZn+6gO+gOuoPu7HSzP+jO7aN//HVyJevTne3ON/HG9N1E9/fY28sP32v27sM9qmp9+/i9p6QHEgLSe0ERsABKQbEoFrEAHjlKEdCDRbGIooiooFgURfmJBVCxewRROYigIiAIIohKAQHphBJIQnrJZO73nZk9mT2TMnt6Qp7PlT/he032XnutZ+U9YoDdWAsrIST34ytnPvnU7LUnWbNZphjh0PckheResZ9ubRdrMMS1/c9K1mjz46G6PJdCcq9Iydx2UDX/v2LWXHvPgcrwIiskJPdvWqJM9JQi1lgT4XTpMVZESO67r4RG9IusqTY1hKrDH6yQkNzn1oNWnW9YQz0JVZ15rJCQ3IvvNsBNx02skbLPg2psKYXkXqGM6+BhYD5rok2N4ND1IIXkXrHjV8GDYTprouWJsDN+QiG5VyJvGDylrGEN9Etd2I3Mp5DcKzM1Cp7O2sGa58TZsLlmN4XkXqlV7VDOJYdZ88xpAESPPEghuVcu/3EjyhmWyxrHsvThh/+XSyG5V2XfNShHebyEQnI/Ff3TH+UYX6OQ3E9J+283wVPihwyTkiILheQePvmftIOn0xYwlApTN//24+fTn5n85INjbh1117inZ3yydMPujPyiUgrJPcR2jUmAh+Y/MiSKj/+xYPrd1/VtFacYDdBSohud0feG2x/7vwUbj5QwRAQoCub1gIcz1jPo9i+bMaxPi2gFVTI16T1m5o97Chkikrs48mg83J2zkcGUs2X2bd3rKNAp7szb399ZzNCQ3MXS8+GuxyYGy4mfJl91mhE+ajr0g51WhoLkLo6OVeCmzzYGQ/HqFy9vAL8Yu47/IYehILmLD1rAzUV7GLADn9zYGAFIHvJRBkNAchcbLoKbKw8yILkr7j3dgAAZL5qVThH83MXR+4zQunof/Zf5xY3JCAbjBW+doAh67qJkdlNoXbybfkr76MoYBIv5oo9OUgQ9d/FzX2j13UJ/ZH92SVWxR6c0PuPSm0ffef+kl2dMe/bR+0YOuujsVilxRlQqcfDKUopg5y5S7zRD45y19FnevCuiKy29Yc8xz7y7+p+0zHyWsRYXZB3c/PPX70wec1mbeFSo/oQDFMHOXRTOag6Ndsvom+LlN8WiQjGtB0784s+jxayCZd+iyTd0qYMKdPmwmCLYuYu1l0Cj1Y/0xbax9VGR2PPv/3BHHvUo2j//rjOjUE7s7X9SBDt3cWxcLFzO2UHdMmedgQok9Zq08hB9kTZ/cFOU0/GdXIog5y5KPmoPl+et1GnZNRX9KPd4cuUJ+qx43aNd4Cl+2HaKYOcudvxbgdNN2dRl5yN1UU6z2z87Sj/9/dw58HTuVxTBzl3kT2sA1agc6nDy7a4op8vjv5cwAP9M6wwPSc/lUQQ7d7HkfNhFzbHSu403xcCDqceMfQzUjgeT4M74n0MUwc5dHJ+YAsBwxzF6lftme3gw9HrnKINh9b/NcHfFVoqg5y5WPzx4xHsn6NXOW2PhofurBxkkJ2d0grtzv6cIfu6i0ELvFp4DD82n7GMQbR1hhptWX1BEIneR+lgy3CXdtoHBVfhma7g57Z1ihp3kLn68EO6UixYXMejW9oGbxOmlDC/JXeS/0gTuOrySzlA4dKcZWgmvh7d3yV3sGW2Gm8Q7tjBEil9Nhlbi6xaGj+QuVveFuz7/LWbIWD9oBa06cxgukrso/bg13CSHek/6D2dCq8GnDA/JXWQ/kwQ33b4uZYj9fDa0Wv7IcJDcxb7hcBNz2y6G3m/dodV9C4XkHnrr+sBNu9n5DIdN3aB11WEKyT3U5rWCm+v/ZJis7wqt/+RQSO4hVfB8ErTqTT3JsPm5HTQM06wUknsIZT4UDa1u34Y1uW8bQaPREgrJPXRO3K5A6+a/GV6zE6Fx4SEKyT1UDtwErTqTTzLMip8yQeOxYgrJPTQ2XwmtFh+WMuwyboZG8jcUkntI/NoDWt1XMBJ2dofGhWkUknsILOsErRu2MzIWpcDFMKWUQnIPum/bQCPq4QxGiHUyNJpvoJDcg21+M2ikzLQwYjKvhMbwHArJPbg+agiNlvMYSUtPg0v8JxSSe1B91AAanb9nZE2ExkVpFJJ7EH1yGjR6rmeE7e8GF+MbVgrJPWg+awKNy7Yz4mYb4dIjlUJyD5a59aHxrwOMvPSL4WJ8m0JyD5J3k6Ex/Birg89i4XLRcQrJPSjm1IXGmAxWCycHwCX6YwrJPRg+S4GL8f4sVhPz4uEyMJ9Ccg/c/MZwMT2Uw+oi60q4NFhJIbkHbElLbe1PFLL6mBsDl3ElFJJ7gH7tBJfoCQWsRo5dAJdOf1NI7oHZ0hMuhnF5rFamG1DGNINCcg/I333hYhyXw+plZyu4XJVJIbkHYM+lcDE+nMtqpnAUXFJ+ppDc/XfsWmg8UMhq53MjXJ6hkNz9ljECGqOzWP3s7gqXq3IoJHc/5d0PjZtOsBoqHQOX5usoJHc/vRQFl8GprJa+iEMZwwwKyd0/81Pg0v8Aq6ddXeEyMJtCcvfH8pZw6b2V1VTJCLh03EIhufthVze4nPs7q63XDSgTP5++k9xF9o1wab+G1dfqRLhMttJXkrsoegguDZewGkvtDpfrcukryV28EYsyiXNZnRXcCpf2/9BHkrtY2QxlTC9YWa09A5fk7+gbyV3sPB9llAeKWb19k4wyynT6RHIXhXfAZcARVnPb2sLlwRL6QnIXHyWizLl/sbo73g8u12bSB5K72NIBZZotY7VXPBIuZxygkNz1KxiKMjEzWQOMh0vjPygkd/1mm1Hm3kLWANMVlKm7lEJy1217e5S5+DhrgvnxKGOaSyG561U8FmWar2GNsCIZLtMoam/uWWu+/Pyr5ZuPFFCfhQlwiprOmuH3JnB5uJRVKDyeeqxIcj9VLb+mHqDUaXbuZTcOGz3mnvvGPfrEKx+t2ptVwoplXIMyg7JZM2w7Ey7DClmJg/974Y4repzV/cq7pq/KldxPQUtboTxDfINW3YdM/XZHAct5LxZOLdawhjjY2/t51YwVd7Uywyn+wjfTJPdTTUZ/VKHJNZMXH6WbtPPhZJ7GmiLrMrj0O8ryNj7bHe6ilkjup5oN9VG12LPHL8+hy/+Z4XRxOmuKoqvg0n0vPVjX3NoQngYeltxPNavqwquLd7FMahc4xS1kjVFyPVxO30U3Jd/fEINyrjn1apfc93aCN5ctL2GZN41wuq+YNUbhELi0cs9966gElDcolZL7Kcc6FVVr/WI6XU5cDKcWm1lz5A2DS7Nt1FjQGuVFP5xJyf0UlP1EfVQq+YrXD1Dry7pQKZNKWXPk3gqXJr/TZW4dlNf1Cysl91OS5YdHLm+ZoMCTqf4lz67IoZviUXDqtJU1SOFouDRayTK/1Ec5zZ7cQ0rup6zCI5u//b9xQ6+7vF+f3j179ep1Qf+hT3y0/lAhPW3rBJUygTVJ6Ri4NPiOTiVD4anNhF2k5C7I2VFQtV3PGuUOuCQtotOe9nATffEru2knuYuRcBpezBrldrjELabTlmbQaPvQz9l0kNzF3s5QJSxgzTIcLjHf0ymtD5zqXDvnOAWoEgtjoep+gjVK6WC4xC2jk3WmEXbN711upZDcNabA6QHWLLnXwiVhGctkP9vcqCRdPOsg3UjuonQ4VIlfsmZJvwIuSUvpUrj+g/fX5NKD5C7SL4HqzF2sWY5cDJf6Sygkd282tYfqhmLWLPt6wqXh9xSSuzf/S4bqIdYwO7rCpclyCsndm5lmqKazhvmrLeDLISzJXUyESvkva5i1DeHSbhOF5K77y2T8SoZE4a51f6QzFJYmwuWMPRSSuxeFA6Fqso0Byd/09SdLd+TQ3YmvR56e0nDAKobA5zFwOS+NQnL3Iv1yqE7fxwBkfXpDq4To+Bb9J6/KYpld0/pGwabt9wy+t81wuTSDQnL3IrUPVN2P0H8bB8dClXLhhE9/3JqRl73j67HtAaBhlwZA28V0Z2XAXlDgcn02heTuxT/nQHVJBv2V9mJTIO6ysY/de20LADAktuh8zlktogGYuj+zNXtpW6DFrAw6pc2fOGb4yCdXMyCWR6ExooBCcvdi65lQDcihn5ZdAuCCeVkkCze+dk19lEm84aNDJPlVU8B8+VsbDxaQ2X+92jceNvXv3ccAFP4HGmMtFJK7FxvbQXVzMf1yYsppQKOpR6jK2/zp2CvPP/uss7pd9uSqHDp8dwYAQ8Nzrx16y0VNUKbT11b6LWcgNJ6gkNy92dACqv/QL8v6A8Yb11DLWlxYUFBQWEKXP0YlwaXeoAcGRQNA7CMZ9Fd6P7gor1BI7t5sOC2gPQRHJyYDbWbm0av8pQ92STQBQFSbB1bks3h2fdgM3kc/7e8MF9MHFJK7N5tSoJpEn2V/2BtIvH0L9Tmxad7LT0+a9u0h2n3TADbnr6d/1jeGS8J3FJK7N9vqQfUCfXVylBHGy78ppp8+T4FNp5/ol2/j4dJoDYXk7s3mZKim0lfrEoBJGfTfG2bYNPuG/nhbgUvHzRSSuzcb60P1qJU++i0JeJkBsEyAXdN5VvpuAjR67qOQ3L35oy1UtxXSRxtPAy7MZABy74Ddad/SZ6W3QOPqNArJ3Zt9PaC6voA+2nMWYP6CgcgYDruWvvee0Rcao/MoJHdvci+Aqn8ufZQzCMDAwsB6HwK7tpvoo7/bQmOChUJy96o/VH2O0Ff3A2iwmgFJvQ52Vx2nb36qC403KCR3726Gqs02+uptE4DHShmQg1fA7nn6Zq4CF/PXFJK7D+sb8b/QV7/UBdD5EAOz9TzYdD1In0yFRoPfKCR372ZCZfoffXWgIwDDFwzQr45dwwvoi6I7odHpAIXk7t38aDgYnqOv8gcCwFALA/RhPAC8WHSghLplXguNS3MoJHfv1reCagR99igAtN3OAFmeB4DJX/W5der3+dRnX3dojLBSSO7eHQvkONOn8QCMsxiovFsBvDwAwEV7qc+GptCYSB0kd1E4CKomf9JXG5sDwJASBiq1H+pNSwEwNIv6zIuGi+FN6iG5iyegMiykr470A4B22xiw39oPeQoAnqROk6CR+D/qIbmLj01QPUpfWcYCgHEOA7d26aUAzHOpT9710GjxB/WQ3MX6RlD1L6KvZpgA4LYCBm7daQAaLKM+f58OjfMOUw/JXaT3DOC76up6ANB2DwM33QzgrB3U55s4aNxSQD0kd1E6Dio/djemtgeA6C8ZsLzBAHBjOvV5HlrPUh/JXXyiQPUYfZX/L9jcz4DtbAMAEwupS84t0Ij5kvpI7mJLB6j6ZdFXk2HTJ42B+i4GgHmOlbps7wKNlhupj+Quiq4uy2YDffVZPAAk/8xAvQgAsd9Rn2/qQOPio9RJchdToFLm0Feb2wGA4QUGqOBaADhtsz+r7riniDpJ7uLHOKhuyaePMi+FzcBAg9vWGAA6H6UumVdA6y3qJbmLfV2garKTPrKOh027rQzMwigA6F9AXX5tBo3ktdRLchfWW+E0i776wASbLxmYVxRf5lTOMECj1wnqJrmLuWaobi6gjzY2gc1DVgaiYLQvk8wKhkNrjIW6Se5iRxuoWu+gj052g02vkwzE/u4AEPcFddnSBRrmt6mf5C5KxkBleos+stwBm8a/MhAr6gJAqw3U5b0YyHhIyd1v/42D6vo8+uhN2CizGYh3YNPzCPUouR1afY/QB5K7ONEVqobr6aOlSbC5zcIAjIfNoCLqsaMLtMaV0BeSu3gATlPpo4M9YHPuMfovfzBs7qYuH0ZDwziPQnL3ycJYqLodp28sQwBdO9W9/15PoR5FI6HVejeF5O6To92giplPH70Ku1fov68TAMA4m3ps6QStmy0UkrtvJrnyKaJvfkiAza0F9NtLsEn4hnq8HwUN05sUkruPfk2CKmUdfbO3C2zapNJvd8LmtLXUoWg0tBr/TiG5+yj/RjhNoG8Kr4dNwgr6q2AAbNrupA7bukKrfwb9J7nL0nvX/X4d8VBeor+Od4dN7zTq8HEMNJSnrRSSu6/SesHp/3wsaLEjwOFF9NPWprAZUeT7N6Y631NI7r57Ef7e47GtHWy67A5sYcbwPHXY2Qla5xyikNx9t6MdVHW+pU8KBsEm+Xv6aYoCAAlfUod3jdC6x0IhufvOOgZONxbSJ+PtuRqepX/yh8Cm2W/0Lv8maJnmUUju/vjeDFXdNfTJguiAhhsdOV//w9DaRtDquJdCcvdHzpVwustKX2xvCJtOe+iXra1hc1EavbI+Cze3Wigkd7+8FQ1V4zX0RfqlsDGvoF9W1oPNjbn06tDF0Ip7n0Jy909qNz/fAK13we41+mWeGTZ3ltCrbxKh1XE7heTupzdMUDX/g754Kwo2N1sDuQ3tSXpluRtu7iygkNz9tK8rnO4vpQ/WNIRNj4P0x0TYvenrmGuY51FI7n57Hk6NfqcPDnaHTd2f6If8EbCJ+opevQ03XQ9RSO5+S+0Epwet1K/4P7AxzKAf9veDTf1V9Obk1XDzOIXkHoApcGqxlT6YZoDNsBL67te2sGm/jd78lACtuj9TSO4B2NIKTg9Yqd/KurC5II2+m58Imz6H6UXRQ3BzeRaF5B6A0glwavoX9UttAZvGv9F36gS8wV7j3dQRWoYXrRSSeyB2tILTQ9Qv71rYzaPvHobduGJ6Md0ErUbrKCT3wDyuQNVkA3WzToTd0/RZ6c2wMb9FL473g5sbMykk98BsaQune4qp22wzbK610FdZjooTv6MX8+Lg5h0rheQeoKkKVI1/oW7rWsDmrAP01f7OsGm6iVUrugZu2uygkNwDtbcznO62UK9jPWCTuJS++qs1bLoeZNW+i4ObsRYKyT1gz8Ip+RfqVTgKdu/QV8sbwuaiE6xS3hC4SVpGIbkHbl87OA0tpl7TYHdHMX20oA5sBueySssbw8312QwCyV28oECV/BP1WpTg57UGs6Jgc1sRq1L6oAFa5ncoJPcgP70PKaBOe5rDpuUmP5+dHrOyKn93hptuuxkUkrt4UYEq/gvqlH0BbKLmU+Xj0ZBprNJLJrh5msEhuYvU7nDqd4L6WB6G3cv0TcYA2H3Aqhw+D25a/s4gkdzFXBNUxlnU6W0f325VW8+CTdRSVuU1A9zcaWGQSO4i8xI4nX+Y+nyfApvzTtAnPzWBTf3fWYX9Z8FN0ncMGsldfBULp+eoT2oX2LT4jT75NBY27f5hFabC3TVZDBrJXRQMgVOrTdSl8ArYGD+mT6YrsOlxlJXb0hFuYucyiCR3saYOnMZRF+t42L1InzwGuyuyWamSyXDX8wiDSHIXltFwaryJusyG3ZBC+sA6EnbDilipPzvATfQMBpXkLtY0htNIfQEvTYZNl3T6IP8q2D1sZWVKxxngpncqg0pyF9YJcKq7iHrsPhM2Tf+gD9K7wUZ5mZVa3xoh3j8guYsDXeHU/yR1yLoUNlGf0ge7W8Am/jNWpuQuuOubxmCT3MX/maCKmksdisf5ce/2umTYNFvJyvzUCG6M7zPoJHeReQGczkmlDu/A7t951G9xPGzO2sZKpN8IdxemMfgkd7EgFk4TS+ndD/Vg0y2V+n0cBZv+h1mJ9+LhJuY9hoDkLoqHwanRWnqXeiZsWq7zfcjMiCxW7J/ecHfZEYaC5C5+S4HTkBJ6VXwRbMwf+n45/fgiVsjyBNzFzGVISO6i5CE4xX1Jr6wPwO556ma9G3YvlbJCy5vCXf9jFD4DhW+XmPZMpVdvwe526lZ0E2wM77JCJ6+Fu/gPGCqSu3g3Gk6T6NXXMbDplUe9stVbnf7HCr1mhrvrMhkqkrvI/xecmq6lN5vPgE373dTrcHfY1FnLivzZEu7qLmToSO7il4ZwuimXXmT21r3pQLXtDNg0384K5AyEhzFFDCHJXTwGlY5T10VDYTeTeq1pUcUIselmuOuwmaEkuYv9Z8Pp/KP04gXYPWqhTl/Xh80FJ1jeymZwF/UqQ0tyF5+Y4PQEvfjUCJv+WdTpnTjY3JDDcv65GB4GpDG0JHdRPAROTTayamsawaZDKnV6xgib0cX0lHMHPDRdylCT3MW6RnC6pYBVSu0Imwa/Up/ie2H3YCk9vRQDd8rkEoac5C6eUKCK+y+rlNMfNqaPqc/JQbB7hp4W1oeHaw4z9CR3kdoXTudV3ZxlPOxeYpWyDh7at/LD9//kob6we5se/uoED81WMhwkd7E4EU7jrazKW/B8Fi/KzSu2FmWlpaYe3vrz0qUL35pw13+uP6tRSnKsocuGPZ1hY/qK7vZcCA+G1xgWkruwPgyn5GWsykL1jtRM8thfi2c888zjdw4ddP3g6/tf0K1z5w6NYuDmtjVtYVN3Od0cGQhPg/IYHpK7OHIunK5IZxW2t4NNl9STb/RvkohyTFFxdVv3GjBw1KT3Pr0UTR9vDpumG6l14jZ46riV4SK5i//GQmWczipk94BNs2nXGwC0P+e8vr3O633pNTcOGTx45CMvvz7j/cUbN28+YKHN/2KUNvVgc/pOamTdbYSHOh8zbCR3UTgcTm13sXKWobCJTknomNBi8rb9abnZaalH0ovIooISusu5DgYjbM5LpUvuo1HwoIwvZPhI7mJbWzjdWcrKTYFDhw5XbaQXq5rC4bIMlimaGAVP16YxnCR3MSsWqjqLWbl3DbCLu0NHom8lwm5ALp1yJ8TAU5eNDCvJXeQPh1OfE16vjYyaVEDvcvrB7tyjtLPmrB1ohKd63zDMJHex8ww4TShlZf45EwCazKcemRfDLvq/JHP3LJx0SQLKiXuTYSe5i89joUpZxsqc6Aeg3SrqsqcLHK7+e/Fz/zo93oDyYp4uZNhJ7sJ6D5wuTGdlHgLabqA+21vDxqCYmsQZUCHD+AIKyT0CNNffPZmenlXKCuSMREt9tecf3T6nHrww35tFIblHxI9JUNUddMOND763Zv/JwlJqlK4bYWi5hlUpyfzn168/enPSkJ5tG0ShagbTvZkUknuETDNAK6FJh3P7XD5w5LhJz736+pxPFyxd0AVdluSWWOmp5PjahfPeffbeof1PPy0xxqhAl4Qp2RSSe6Tkj0IlFIPRFB2fFJ9y3nW3j5/62pvvzJ4z543pr097/M6hA3q1a1I/McpoUKCfYlQMxhtyKCT3yDncF05RqIICKAiEIdZojrkqj0Jyj6DNvZPNgKHxxfc8fE40QkeJNZujOh+mkNwjaeedBuC0+XuyCw/OvLyhWUGIGE1mU9NdFJJ7JB24RgHaHqNNxs8zx3RPMikIIkVx9h5lTPmDQnKPpI3tAHRMp5V2RYd+nHFn3yYxioLAKYbo+t2uNMNOMRsT11JI7pH0UwqA07OoUXh0/fwXhp6dYoICfynG+Kbn3vTUvA3HVjUoyz12GYXkHknfxwNok0N31uLsPasXTBvVq2mcCT5RDOaE5j2HTHx36e97M4tJbu0MB5MxagmF5B5J38YCaJLDClgt+ambVn418+F/9WzXqG5clNloUP4/lKPAYDBFxyU3Pf2S4U+8PX/5X4fySum0qz8cjEbzNxSSeyQtiQGQdIBelKT+tmThgi8+nfv+7JkvTbrr31dd1LfPBf36XzP436Pvf/rltz/4/MtFS39ev+N4ET3tGQEHg9E8n0Jyj6QVdQDEzGPI7L/XlfunFJJ7JG1pBUC5toChcnAcHBSjeRaF5B5J6QMAIHZBKUPk0IPO3A1Rr1FI7pFU8pYJAJp8V8zQ2H+XUpb7ixSSe0Qd6AKbuuP+tjAUDgyHyhA9tZRCco8k60exsFHO3hmS3vcPcuU+2UIhuUdU7v1m2BhHZzIE9vWHyhD1RAmF5B5ZJ4YpsGm+myGw5wLXr/vjxRSSe2RZPjbDpv4uhsDubnBQjFETiigk98jKGAa7NkcYAjs7luUePaGQQnKPrPVNYHdVPkNgW0tn7qaox4soJPeIKpljgo3hCYbClnrO3KOinyqhkNwjKn0M7MyfMBT+iivLPeq5UgrJPaL+OQ928csZAqW/msrWIaPfpJDcI2t9Y9glr2cIFH1rKMs95nMKyT2yfk6AXb0NDIHcWYoz9+g6iykk98haFgO7xBUMgcznnbkr0U3XUUjukbU8Fnamjy0MvpNlucNw7n4KyT2y1iTB4ZZ0Bl/+XDOczk6nkNwja1s72CmJ/yti0JVsbAenultKKST3iDo2RFF777nDwmCzZk00QWV4oYhCco+ogvejnDnen1Ya/N53XQSnnpkUkntEWf85H6ro6ekMuqJvjFAlbqaQ3CMr/9NYqOrOzbEyyKy7k6EyfGClkNwjynp8GJza/FnEYDvRBU73llBI7pFV+ldrON2XxmDLuR5O/bIpJPcIy3svHqpmvzPYiu+CU+sMCsk90o5NMsMh+isGm+URBaqkNArJPdJK918KB+O7DLaSsXCKTqWQ3CMu8244KHMYbEVD4GTcSSG5R9yhy+Bg+ozBlt8XToYNFJJ7xG1rBYfohQy2zLZwUlZRSO4R93sCHOJXMNh2JsJJWW6lkNwjba0ZDnXWMdgWGuFkWC25S+6R94sBDskbGWSWUShj2sjqQ3KX3Ov/wSDb1xRlYndRSO4Rt9KZe72g5z7XhDKNj7P6kNwl98TfGFwnL4dL71wKyT3i1hjhELXUyqD6PgZllHuLKCT3iPs9ylnklAIGU87VcDF+YqWQ3CNuRz2oOmy3MIg+i4NLgx0UknvkHekNlWHksRIGTWpfaAzKo5DcIy/vSQNUxtt2FzNISt4ww8U0x0ohuUeeZU1dOCkXbMwNUpc720Gj5d+sDiR3kXkzXFKeOVDMIMgfBQ3lgWJWB5K7sKypDxel++LsUgbs43ho1NvE6kFyF1kvmqGR8srxQHsv2XQWNJRheaweJHdhOXqzARrRD52wBJD64e+mDGoErZQfWF1I7qJk1wAFGlET00vpl4Lfp1/b0KzAjXJ7LqsNyV0U7RtugkbcB9n0mfX46indEw0KPDXbxGpEchclaS/UUeDSYYuFPsnb8f6/20QrqIDp1VJWJ5K7KMlc1FUTqzL2uJU6Fadvmj3yzAQFlei/n9WL5C6sBTvGJqCMecSSQ0Xeiy9K/WHqdW1jFVSu+U8WVjeSu7BkftUILtFnP7p4d26lqRZmHFwxbUiXeiZFQVUS3ypm9SO5C2v+uubQUKJaDXlj+fb9R45n5+YVFBWVlJK05GUdP7Dukwcva1fXqMCrmCmFrJYkd1G8qgXcKab45udePXLsoxMefeS+0Tdd1a9bh0Z1o9XQvYurvrVL7qL4l7NREUWx/fks5XULqy3JXRRtGmxEkJh6L7OyGpPchTX19aTgxH7G9GMUknv1Zs2dEYWAGS76aG++lUJyr+5SbzHAL67ne/MjBawJJHdRevQ2I3xniG3fUs3d8K8jrCEkd3H430b4QjHEnTFs5pKbFDicvZU1huQuDgwy6n5+iWp84dgPt+RZD440wqHpj6w5JHdh3XJlrAIbY4Mks1Jx54opofUV4+ZuOF5CkpmTTXBImFXCGkRyF4U/3xALO0OvN+dOGtK7Q5OUhNgos8lsjoqJS2rcrvdNT3++Zm+OhaqiL+vCIWpyPmsWyV3sfFTtXen4xcn8nIy048ePHTty9MiRtKPHMzJPFtJN0dq2cDAOzWBNI7mLI3cZ1d6TJ6eyatadVyuwU/rvZI0juYvS7QMMcEgYf8DCqmQ8YYRD502sgSR3Ufh7VzgosQ/uL2XlihclwqHFt6yRJHdRvKIRVDH3Hayi952d4JD0WQlrJsldZL4aC1XM2EOshPXg1XBImFFja5fchXX/KCNUxm4/ZlhYkROjFdhFP5fLGktyF5Yt3RSolJT+t97/xMtvfzR/4eJlK9es+6eAJI9+fU9LOEQ9WaNrl9xF8U8pcKdAMZqi4+vWa9CoYePGDRNNUJkfreG1S+4i61kzdDE+mMeaTXIXpfv+ZYAO5kdqfu2Suyje1EOBV8nvFrHmk9xF0S8t4WA0m4yKggp0+KGYQnI/FeQubIAqGfqsKqSQ3E8J1qyZdVCFmJG7Sikk91PF8VmnKaiQYojv9dERCsn91GHN+vb600wK3NhOM7W7esKioxYKyf2UUnxk9dyX7rn63A7NG9avl5zUoHGHnv966PVvDxVRSO6nsNKM339YsnTt4WIKyV0IyV0IyV0IyV0IyV3YSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CSO5CgDWUWP9Iz/qIanbZMzsoJPdT28a+cFIGbKWobrkfX/Ts7QMuu2LUq7+WMjDC+pIJGtGvUFSn3DPfusQIp0bjDzAAwno3PNxtpaguuWc+mgg3sU8W02/iMZTzGEU1yX1RE5Rz/lH6ScyD6swBCpzmUlSH3AvvQEU6ptEvIrUe7JQnrXwKTnF/U0Q+92N9UbHeFvpBWPvD4X6SBY3g1MtCEencD7WHS5dnFy15Kh6qqfSD+AQOZxaR5DiUeZMiwrkf6YgyyR9bSfKXKDjEpdJnIq85HBbR5ieUSTlJEdHc87qjTNOtdHgIqrHUJ3XGTT3atOly998UZU/r59CuMBZlJlJENPehKJO4iarDMXBIyKYOhQ9FwSH6c9Z6aQlweJcOl6FM3UyKCOY+Cy7vssxwnxbPrkeZGPl9fwwOyfl0eB4uL1NELvc9iShzCV0WQXUDvdsMjRGs5XKS4HAXVT/CpVUpRcRyvwRlDH/QJd8MhzoWevU3NOpYWLvNgGoVVRnQWEIRqdy/gMsganWDajO9i4PGdtZq1tPh0MxKp9ZwuYUiQrnnt4DL79S6E6qP6R20vmetthKq+1hmEFwSCigik/urcOlNN29A9RS9yoHWl6zVRkO1lGWegcZCiojknt8ILp/SzWKobqNXxyX3MoWJcEgoZJl50BhFEZHcZ8AlpZBu/vZhaWY/tBaxNvsGqmvosgkaDUopIpB7aTu43Et3J6C6kl5tgdbPrM1GQDWNLgUGaPxBEYHcv4PGGrqzGuHQl15tgNavrMWKkqDaSI2W0HiJIgK5D4RLEys91IXDFfRqFbQ2sRZbClVyKTUuh8ZVFOHPPTMaLmPoqQEcBtKrRdDaw1rsgYqbvgcaCRaKsOc+q+r3y7pwGE2v5kNrP2uxTlBNptZL0PqLIuy594NLbH6luU+iVx9L7qr9cFpGrc+gNYci3LkfMMBlAD0V+3AA503JXTUHKkM2tVZD63aKcOf+MqrclnrEhz0Br0DrAGuvYVCdTjcHoNWNIty5XwCNdfS0FqpUejUVWidZe7WCajjdlBihEVtKEd7cT5rhklhCT3PhUE//eQbJ/RCcXqO75tDaRRHe3BdA4wqWc58Pi8T3Se4O/4XTSro7H1rfUIQ39zHQmMJyzoXDq/TuP5K7w/1wSqe7gdB6jiK8ubeAxmJ6Ombw4XTHLZK7x/tQU3oYI0szkcx9O7SO0dNsOLSjDjdAq4C1VWlipfvqnoJWP4qw5j4bGi0qL3gqdbgGWqy1dsDpEXqYCa3mFGHN/VZoDKSn7DjYJR73eU0T8qYKfEgPX0JLKaQIZ+5tq35TfR8Ok6lHL8nd7rHKt7SvhpsdFGHM/bCX43aXwK5zIfXoAg2FtdZ1UBkL6WEX3PxAEcbc50FrOz1YO8Om4S7q0gEadVlrtYOqIz2dQOQ2iUnuj0AjuoSeMiacriSOOOzLoqbknm+A6jp6shqg9SRFGHO/EBpdWJFC6pYCjaasrTbC6RGW0wBaoynCl7slARr/ZoDqQKMFa6tP4fQOy+kIrSsowpf7n9CayABBqz1rq8lwWuFt9aorRfhyfxda7zEwOdDqwtpqKJwOsZzroNWAIny5j4XWCgbmqJxdsDsPqgSWNxJuiijClnufoB4/+gdafVlbJUF1ttdN0jhMEa7cSxOgEV3KwPwlb2HuS+tDWN4kuPmDIly574BWBwZoFbQGsJbaUOW7/8vyWTVSuc+D1sVBGb4n4/q/gNMsljcLbj6jCFfuT0NrGAM0H1ojWUu9WOWFDp/DzUyKcOV+I7TGM0AfQOsu1lJ3welvr/8CMZUiXLl3gtZrDNAb0HqEtdSAKnez/wI34ynClHuRCVrzGaDnoPU0a6mzoWrECmyCmzEUYcp9K9ysCcqpBrkntz5UPVmB3XBzE0WYcv8KwZ3xcxe03mTtVFB1yofhpj9FmHJ/AW6yGKBh0PqEtdM/VT+Xn4Sb8yjClPtt0IphoK6D1lesnVbD6Q1WwAo3HSjClPsF0GrJQF0stwi7zRpYwIrEQKsZRZhybwatHgxUN2j9wtrpLTj9xookQ444RiL3IgO0rmKgOshNZG6fqg95P9ALI0V4ct8BNyMYqEY+30RWcHh3aiHDK3P37kyG0J1QGUtYkZZwU0gRltyXwM0DDFQ8tI6xajkf3twSAAxtRnxdzPD4Y2KvOgBQ58Ipexkig6Bqwgp1gQyOjUTu78DNMwyQBW5yWZXMCXXh0uoLhsGynnAx3HqMIdEHqh66cj9KEZbcJ8HN2wxQBtywKosaw93IYoZY5jC4a/gLQ6E9VDfomSyI/RRhyX0U3MxjgPZDqw6rMFWBpxssDKl/ToenuF8ZAnW8bAntK1MiI5J7f7j5kQHaBK3GrNwEVOBphtKuZiiv4XEGXSGcJrNCl0PfAlbWn8t+SWfA9q39YUsxKbl3gpsNDNBqaLVjpabDydj5dANU5i0MnbR2cKrfLQlOwxh0R+A0S88QfGxkhf64wghAOf9TKwNgmdkCABJH7pDck4O8Q2wxtM5iZX40QnXJXvKvhlBdx5CxXApV3LulLLoXKmUjg20bnL7WlfsqVmR5NFTDA+l9OFQJS2t77oVwl8YAfaxv7saRsr7PzyPJGVApOxmI1PceGHrbi3+xIk9CZVxCksVNymJisP0Cp3W6cv+ZFSg5HWW+pN++R5mmJbU89wNwVxTcw0xXshLXQhV/gDbpBqgeZwAWxVR+Gm6dEar7PcZJRecwyBbCaZ+u3Bd56RQ302+D4PIzg8O6d+2i+Ss2F9W03NfDTRwD9Sy0BnudfvCY5ztEJ1asdPuCWZ/t1blhp46FnkrOgirhhOdtMvMYZB94+146WEfuD8Pl3ABvRFPNZuBK1zzRPwl25i5DZ26vSbl/BzeNGahxevYknGwClekQHW6o+nkq+6EkAFCuOsAqWKKgSq9iNMDd5UZS38sgew2qJF23ceJzVuBquLSmv/ZB4/+xd+7xNpdZ/F97n8s5jsPJhUI4CCNOY6RM0qU0/Qq5dElF1CiXDBGhlEwTSiZTNEYNokEuaU4kF5LQxeUkXdwvJ4xcOIdzHOey916/1w/7u/azv+tZz7MP83v5zsz7/zGyP9/nWc9an7XWWLxQjo2sBSp1B232jNzfA4VfXUT7vJB1HgBhHsDz9OLWuhJ3w3mqrpd/Wl2XysEUCPOja5plCxQ4vvuXIApkz35jxOxczSbJBlIwR8w0VV6vQI5TXy2e+8mXe82pMjktum/lR/NWZJ1CM3nDywLD9TMD3pD7eFD4LcaOdEsPRY49ieotrt7cfxZbP+EywXX2mb6a+wd361Au/ZmoIzCqGgCktBihEUP2iHT4f5T7Cz8DsiXy3G2xrqa2XK9b/0xDH5ylSttpeWKqTPg9zky/Lw3O4m/c50uUWVsHNDSY7wm5j4CLPNKxNei2+BG/hzAVitwd3QMNVchWIdRAw7nKup7kSernpModclDDA85BEOBaTnvEQ5hVGEE3OE8HtKqq/tVoEnYlKVtCJKnDdIfzIum2LRhVGSLJWIgCUxNAT7tfPCD3/he7Jb4ZEJqTOjuRGTJGcn+UXw5ATEMdQ52QhzfkqrmSXHO5YZWY1Ph7eXBorNRm25v20LQA83SfWnqv3YG2EM2VqyW582+pD6tBNA+cRB1TfBCBv1nHdo0ggivWXfpyfxQUnsQLpS5EMsmQcZjNyL2DyZZ/+Wn5LGbKW0fLAGV+GLlvMTuK3nLF9OH42wcAKWp+/RbTWKkMUHhFkDvzgP+gArhJmGCW+/1KIN4VGH6lq72ujgMivv/ZId17+8WDQ/KiS17u7UBhIF4oFY1PsNNUvvfTkTgEwrRFjlv1dwbRVNeUNQoc+sci91r6ToDvwruXay7dteCLHFT4tWnOTn1Q6GuUezY6BAYDzx+Ncm+LxK4mwFKV93Hk1gAizQndvr4SHFI2XOpybwkKL+CF4odIMtHNDNZj0Ic9gYi5QFQrQh5nUn0PVAjVAaZV+ohR7keBuBcVFqeGLyMu7k83rf6pbTF542pe7kUPgUPFOx5oWQYcxqCbzzVy30xtZ75GHdo3BIcqO/hAkYhfiQ6HIiR0TfASl3sjUBiDF0gOKCyXz+leXNjQBTlKrjBPrzkAYV7ShuBwiN4QRr/5eiBuVL++xPNKGR4SV3cssAtmfJw1L4OVe3EH+istCSDiCXp/+T6S5u0rct/s/BWTn9l79phuDGEa5aKLokpA9FNyO/eAw6eXuNyrXeTJy3uNI/gO+cFhCjp0AirxszzDS48/yP6mfaimo8MmcDgudDZy5s7MBDiLfxKyOI+6lchzO6hU/8Ig95/CF5Wz4ixxYii6qAVpe2S53+xYoZ3Nrk3CZYjc5lLG4lP9YvWSrhQpXuJyTwaFaRfcB2r0cU8A4jsuVTHW4k/eaWhEXKImzy9nYxL6BZOEJB6X+V6ZJCQQlVfBBnQoOLhtw/IF0yeOGdqna4eqEIWv7ScBSe5bop/0KUvQ4UEavyfLvZXLCn1jLlWbygmOtJHCbujgk3Ceey5tuRfARV4jsQoUmILfLeCQUIwO9SDMLOS5xpTJwEGaz2EF/zqZBmEa2uSsg5QmCnfYjjZWd7cjhnbMGdG1Zc0UMFFrlSx3ZTmxPxOJg2WZOE+Qe+A252zPRWIMXTb5SFAlQVeEDvWlw+RSlvtRkK1KMfORyU982M8uXQ0mGfdyjQCisZxmilM7d54CYhbnZmtvI/cTTgYyfDT2Nq9jyxx9Z3kQ0cvoBrfcf0rl276o47husXQr3hjVSFZeORfOUJZltOR6uB2jCQ2iCYGXsNz3wUXu3ZsKCqdFk87DnBE5rsBmx9kuZGhIAbrCVUBs5l7Hw2W5q4/FUPiral6EGlZDqaghVF7Xnn0vOgnOlgFdXWGyrpuSDphVfk3w+jqlfHI5x7JgMXo9AQCaFV/act8CcldNzLxhGkTwEBAjlFemyaVWlALEm+im2Klxt1YtOkD4C9DhZggzB3k+gQi2RVkry++S7e6xcyMvd/plhjvZlG3aetjVIZPcTzlp0jaokpOsrao9DERNZNg55O6eOZd43v1LUNl84R4cefZhqCoQ/0CHdyHM46jjdoO55wfNNoxJQNRlp2P+LF8oSvScFf6oZsg+09hJXM7KncLMLc73/KLwZlolyL2W4kdNduVxHtR+NQOA8OehzKUq92UgZlJkCrcfN3hwqnOSJL7m/jWnoI4hQJQplCpRY7W71tpxE3FqoyR3dbZpYfgBeQfqCIxNhdhJ7fKjZCObhRhq5RyvriAxWJ31HJHcyfqZFacvKi6Iip6INyGCzz0q949AZR/aM7sKQN2RzAOeqO92VWlmZ1HtaYfdAtjPpTGkC7VTK5/iDsSuVnJfo1xfSTtQdu7ERtvMfLnBbyLiFClf3B3ClCvUD/7xl2DwesctcAqjyU3QlT9WQAQjPCr3f0Cpp1ll+riJ1u0Ngwh6AJEYYgYi1LMsYb2ELh7kpxTthAhGc1b/9+zlviOJwgl5cYdCfMM7Hn321Tcnz/14+fqNGzdu270YVP5k8jO9iCcqORWvEnQxCxyWCt3I/8K/QZjX+Gn//A+RFwdEY4/K/a+gsh9tyS7Lji+/2TCI4Nd8Q9oeq7pceSB+hy4cy1NCiXZl7wzmPPQfRg3fAEQVyO/Un4z0ealc0XXqpjN8jxExwNTg1wMHiz7T/eAwTNiLszHvciewyUU3z4NDthBarfem3F8D8yRa8cZOK3ZLTpgWnx8HxE3c2bQc9fwWiAohfWLman337GdMevJmu8TVosjWoPHSP6ofHNKHfyffG4JRqAtEcEd2svP9FCBDTc0hcxIi+XAk91UQi7TGpHHq7n9Pyv2l0so9y0epLP0ukPsFz5WSdu/rxJMB23mW2/QbMzvp59NRmHNYNdgIcqefvyRsUqx5BgVWOUXOd0JimET8zrTDsE53KXJWetuT1CMIIhnkGAXiDiDDIa0p+Zd4IPybPSn3YSDMp5bopllvnioPIpiu2ajdlHsgyXfR+/qX7HMYSQ2+7rXAUcdxO7lPi3hov2W50iFLfhXIgzWeUqJ/vyO1vcgxUpdf8ynJTnocmzyDraROoLs9KfcBoIKWZMfzjr8SkAcRDOM7+3LiyDQmMAdUE6rKcP4aPqmZSDxQOwuH2AYRjMczNcNhb56l8e4AatgMKjWEs0i6CIh5ujAkDVRka3JrbdFke5wa2nlQ7n0s5C7138XliR6cYeIWymnuPXW3osRXYkdEO/502wh8lamJhXEiW80FvQ3nGWy7Q/iMbTk7yTgi2WSh+16XJ7wMOKoUI8FfKYekjblXnvKg3H8v/KML5IYjwKaosgPkQQRN+FanPjRAVOIgRJBcons2JBRrr4RrKUj1hTtwQpYOuv4lYdemf5/l/N9yUpikwqhnDHCUyTOaW7sJW8+o8MzzZ3D4ClWyU9Sb23tyfwQU0mLNX/aTnqIUrvAnzTpXkqRBECWCiRDBj6hwTDGGEK/xgcD7cmcUk8Tr9gFQQVVkK1dmk715sNO4z9zksa0KfKqpNnAsRZ75ght8NETgW+M9ud9fOrk31wWAy+TVN6chkq2ue3g6ytQWBs2thDCd9Q++zq7xT42kLywEEdzzG3oly3xBni/hAlD5WjhUFGYZfxRooLPNE5WKUe5X5JKthUpDecMznpN7W5PcZTu3/xh3NhAzxa2Wh6PToY0CKKM4wIfrbuFXtP+JlFzLTxHMkEQcEClOiJKPMvOEk5hCD5WPtauIVeJz0TiYrLKuLYboalG6ftEwUfQ5z8n9zlLJvT+FDVFMAYVMFIwXUBzdcr8wpsuovS5Plqn/tV+MtpPdEEKJNAupCP2JvVFLIhjH5s0EFSU9KLlmfHw5VDqIuAv4KTa5TyR86zW5tyqN3AsraZOB4+VukffYpOBG61zuANAPxc3QVL+rqslE9cyPM/xilwPDXGsX9EjUUhVURgo2GGZWhNy7nsfbYAj/cdRRRhrntq+s8vAv+W+Q+xw6R4XZdtzb/hVWro/BWcrtRRNjIQLfKeVUiuev8hI/EI4ZbJffrnO+PhD2yw+eYN8u8p/cSyjoy8uzmEROrhCwUhaXJ110Cqjn2ViPyb2FUe6SUy/hFHPCSPb53lxSMDtRkaLETP1Uj7WaZvx/AUHhUk84S+MCq/UIKm3QREeLvOp1oNJe6qUi0gI2dr9c9udSC9o6MkS5BxTFlNnpLblnlELuh+P13qonZPv8vUows1FJhj4U85yDSXzX4HNC+bJ78Jy9Jv7cr/UdGrgN3ExAE9fTYiYtHUCluWQ0INpYmblzhWSz6ZXUSpB7uKPK4baQl+V+ZUybKWAUbzknjorDhCpmRXhXmp1GMzv0FgXqgZ3vHrVE9AghYtE5PfqoeVAWpcoPaKKORftALzDuTVknhO7y1VfCFkMJ/wnUcrNhPu4LEMk7XpZ7LbSgmeB6vksuFTYDhcprEVeknPvQ9se+J7AVP21gt9qFAiqPFeLpjoJ0pOYs2qMhU8ZisdtIUPEXC5VXYrVVZ5poFDG0Z9xlqJsWKovH0w7+h8uduk2rBk1PX34aNpH4SKe4c2rfjjJcpiSNralWYAewEk1615U2i/A7P2Rnugo1wVZBPX+DKPbId5m5Kfp9TUw6EFx0Rz038o4nYo3y+O/wHy73oXRQmv68JGGEs0K6eiLLUTGRzU1zbC2UJqXuP/nmJiba7xDOQD2Z5nP7IDN83SrIrG/6b3gT9dDh/Qby9IVI5ntI7o1jlnuQGjg+4rNYwsu3ErC0PVY608MiLgP6vJXcU6bHurrKvm9tuY23ZjNE4X5I5AoVLvEmus3kNFsnLy801BfylFOrZp535F4rZrmvEPPPlWUTdxowVHs7hLY8o3u3tdFV4/8MHHftQCveh2iSi+yXqnZDPacgitF6xw7xKuq5SROrvA0uTqKWH7U2HmIhRDLkP1nu3Zj8NpGkxihmufubv1WA9rwJfMdksKJuLOU4cFHpsW/QkmV8gUZmjJUQqoBKb6nASd+yltNJmjhtGqjICbiJ7FwUKaGcsM0zcq8dq9zzU6V++GJQyBA32WSsXTBvXe6FzMXJYN7PV4m2wgmL5y7cGkJrNkE0T8bwvh2PYp85u/RQjv12oZYF4DCPL4ILBxXX2Ss8tPcrPZqdvPpUrR/D7R5/BF0cB4Wm4mXS2Pzme7Z9z5lK8JAFDkofxzsU3Ypyn4cGgjO63P/yD9w4C1bCclF1jn2rAX2n0ss+KSD9vzrsNXgR+qGWA36rdtRREMlar8i9KXMci9wptkxmG9x7dZQ3jrGeleB6d53UmBS6aS320yGSKShz6Hp19dAZiGZZDN0Aq2JJ+iQGdINziIaoZW+87h/2C4jmL6hluPSYIM6kK8unQ560iJnlftAvLnreIstd/bqSQijyKte1VJW3saZrh7pmxuJpOpgevaylHIiDp+TiwPZYBrhBtuxoUgMeKTv4hBSQyVaek5eBwyYUmKsmIz0i91tFuUv9ZImchTQLFO6WNxIdRIk5Pq7N7EZ2Bz3dKuUDovGkH0oUtHB9p41ApQwaKfYL/aeCCj83O3Z6oY5didohAVtBgY4EuRu8dggFQjcpgVixB7uZzHIP1ZeraWtAoa1sqVmHAjvKsc+zx9jTbob+C/sJImmHEr3dBbQ7QaVRDCsiyqFEng9UJsu/juyfbwcO1UuECJPayDh2JFuX4Tb4IYK3vCH3TrHJ/TNw+ETO2/ETXAZKHTUKRc1J0vo0+uWugQpjxFqNrNZ/Ok76DeqoBukLFpxdDVGkJmvKFb2Mb9tERmNN1Sp/AHkCN4NDmSMo011JbRZ5Qu7dBLmL2YTaQe2EQeIRuUg53GKQDcRvFdr/4BApR3djlGdyOSwHKjHZnZdAXm8thbWtUeR3oNJeslPLiaWt5QC0k06LgZAzjMPVyeAyexQn8HQvThFrjiL/SmQHNBOzDHKfL/++xBIfVV+kuU2fRnV8pxYb0hs/oo6g87BI+lmZR68wOoZ9PY+iSD9j2qU/RLEIQ8v/2PWWjhMKkKC1kZpfJgFc1ZXjf3+m/S09V0ddET5wKJsd21HZ0hNy/5Nwuku5s/gDyDHDIPctlkWtI1c40tuPKjUY9b0t5Yo7iWMriDHsCb4UVKagkUGSo1Ao7ieUGKfmfREOBzOOIHHsWiDqFxr7y5vg8erngraRSiyXKPvq5bf2Di/I/Z1Y5F5AjpiHrMbF/x6jKIqHSE4gT6idPni4DyJ5MOpJN9aU334GNax3fuzk/fyUSHqyyHS2fL+thCi2GceIrXHuqtso/t7dGAjfcnO1KgO/YCYnvRsPRJMiNNNQcfN4Qe4LQaGO5XHky7Lau9eHdZcSS4xdl2UPaYe60czH/DLSTtZZYHPp5lE8MNg9NJ7YEEMt40MUOWAcUvqWW+5Pu1oUMysJUznZZGoGFoZj/XLh4C6/J0SQ+iPaWcGJW7wg929j8MwU1TSWO8aY5N5FPzGV+ClFGGX+NSgcUYw0l4eQYEc5JeSb8gwVTkha2YtG6siOQqK8sLCGfTjAknBlw+k83NkZIukYkPrL6YxwxH3V2ago9IHSeJOQiTzF+p8i6QwSHtmaXRkFJgOYquPPm+Q+EZTiM3IUNpW81EWqTTBT2XLQ1Ww9XIwcs5UUspCqPY5GEml9pcz1oNLZOGhmUUQ+J+659WsntYlTH/9FojOYDrVtzv+u3txNi4fXg0gS5yFD3ht3V4O6g/ehQ1B5FHzjAblHFcnjUE9huvkZPoSRu9DUEM/6rp+WBxjdAZEMRCy8TM7kdzC7s/fQD9c0IE6dLkEThyO23Mk8CoaX0yKm+r85AXT4hgaEWiJxBbk2OWqskZr64nvl8D/FZC/I/TqQH4/EOPPhjn1Mcg9ebjRvZPpko+qr0bv9MulrZc/eCcbXeBGds751YrIpBY1kkaoMjDGlZlZxo+7+opWp7hn9ILjHq5xuBho6HDG0o1Tfz3byPusFuXeTkwPEiYpyZZGrQQ7WDdgS2n120EGbtM3Ca7IPHzbMT/zZZ9qU3Af0O7vXxzqIZ7FUxJDbVbegygYgaPLUq35gSH0uz/SrKL6fIy2Ao/GnyFPMvDGUL6+zF+Q+FhRWWBSk4r63XaA7zDQZK60Ao8hvbKq6hqqr/vPjyfw4eeJaw19qKjhUch1tZxJjHMQzRa6iSQtYZ0ivbJrotKalu2V7bI5YS2QisqLRlSGKxHuWhlAHFTwSN3F9Urd7Qe6rQWESatgUpz8AiTuNci+uKv7AgfbgcE2RzTCMa+iI8WXr+9EEp9/KRHCYY/hYasVQueuNBoIpAGJR4JCun/XLXvTNJ2U8PnmbeUIrE7Kefvf/JFKW4rZhH+ciIYVEDfOdBiqimRfkrh5eMBB5AhTqlT8oN6TJcsdnhc5PJaxI3Gz3hVYB0/KA3LJSbmZLGojVs6dilHs/3aYec4awtbj9QR2Ns++TKeMnTp6zemcAGeR2XcquFG6aM3ns5CkLvzmGJmYD0Z0plGV4Qe7YEmyKBaPsvJ6NzHLPVjMLn2l7wv6KGkL1gOct2djLT7bcWQMcGuQafma4Go3cJ/kN5NRMJYwiXva7x1o6F4pxZorSXV6K5d6T+8s2YyXWxFGuXDpNapjljj3U4z3ERx3ShNTXgSXuEGrITtIe74evAoeUb41rZVqgkZZyzVhcvnRAaGUnz0SsfABRrEIZcwNT4lJamEiniAfk/q1FK+YRknGZ7SiQZiH3n5N1Wyve8EXo6jRqySkHHLfbzr5rQH/2rgi1+z409/M+jkbqKnkWkUVgcOSkCytV7VksuhXs6QhE0sLoo7KLB+Tumqvfg7vGWinLxQSSZblzKw/KhlVx6nEgav+CKlLx1my5PlZJHYsavlI+rmo0Aapn2LwY5qEeRRN7gKCtUsJapeuwNKyFKKZiqTheD4iEkbk5DZQUmTfkrnqAL3MXOgP3KSGGBNjIvejXao3v7L2YP6k6ENV2osSJSuCmQoH9ff7I2XpUVke7Msm4sIJ9jwTRxOkYdtSGyhp6pVqBSj20R5gkPA5jhV71hD9O7STwgNypZyPM6y61dwWHjHyUKJTkTmwtDwrX9nn0JsUJU/V7u72uCoNQogcolLu39z3qi7d/CLXkfvrqgJ49h767C83sld2l8gqPiobyf0W0RG5WHY6l5Js00HGrBxyRTEdklROocLoDOFTZhyK5otyJzDiQqL0VDQRugGgSZUNW0e0g8gJeJDbEEnh0hyh2o8LDoOILYSnIAeICF15nVQce31dekfv3fvVCVVIvu68Fh7SNKHPC9hSZnwh6Wh5EI9tcx8wTKHPyVtCT9M5FrNvJJmnZ0P4RypsIjmEpCPnsEzwmDrYElkHoFbnjY6DQlt5YBeNSwSFlFRooApXXUceyVNDg61eEFvzTBwqph9BAQXvQUecimlfXq34gme8Mw+Ofl1bJ21PBPsFjpGQEd1TdG/CO3A9XBoWKQ1flI+Kp1YOrAFF2FRqpZt3YuTUDWNJXoB0vMQP6ZYIvxwOHr8+pi99BYHfeBWvLq5del4bL21NXXnsWI9+77kn/4AB6R+44D1yUvTIFFCp/FXssukF61o66DFykvVKAloTeSwGiUwgt2MgF8LduwItKE6fRzoKx8un+rrudqTQ0c7czXRBL1IaRZusRvSR3HAAm6m+30lOcYjAJypH+i3VAodbLMYWmuzqHT+vEfrZfybJ26lWc0GElXmRmy0O4VM6ozbsp2dKgEmqljpHWoFIBL5RNf7gifEJ1+TyEHpN74H6QaZODVkzwxVST2fCn+xuc1V/cVe1HZ4UwRg5N7dv2jnuHzj2G9uTM6HtT5XM/VIsn5+bixWdiOYCGH6Idu+sBkboQVVZIsb0990EUQbxgQpunvDj0tanf0R/lHblj0UMgkDzeWolLr3as4bYnUeHR3UcD+P+XnJ9/zsN/F6ezdqM1eS9UDB/t3fe4bktQkV2W5qIDFXy9AuC/heDzPtBx11a0J7h8yF3X3dBm8IJCtOJ/FK947emeQ8YtyWfOfiBEg7bMYIhix3+r3Ill6cByy1L0KN7nOETxGJaGVyCKb/4ndzwz3i34Sn3Xo2fxPiGfMDZVRPZcfPpfLHciuPLp3ySQd+uul9aWoJfxPpVBpdWFONWJmf+T+3mKt30+b+7c+St/+L/s3c+Lr2MYx/HLbzqnbJ2zkTjEUqNkyAZLk5rJjvxomB02o1lMGguGklIskKSMjcxSU2NnNQtkhQ2hsaCZiYn0nW4baq57eXvKVV6vv+G9eXquPvdB4z93U2S3tBG70XlN7gVxZ2TnprkA3pA7BT0Q2RVtxH50npJ7QTweneM24M/oPCz3gliLzg+TnETeL/eCeCU6X7QRFyKbl3tBvDvNZsbtkd0s94L4eJrNjIXIrpF7QexF56024tHILpd7QexH5+U2Yj06v8m9HmaXRrbWRrwRne/lXhDnI1tuI7aj85ncC+K2yJam+QT4RO4FsRDZPW3Ej9H5UO4FsRLZrW3E7JLI3pR7QTwf2XXTfAK8JPeCeDuyq9uQucielXtB7ERnNskh8bLcC+Kr6Pw8yW7WktwL4o+LJhlFfTWye+VeEecj25vkP9Oc3Cvirsh224gvI7tR7lT0WGTbbcTvF0dyTu5U9GJk77Uh10ZyVu5U9FFkr7ch90Umdyr6Zprcnwm5U9/JmUg225B3IjuSOxXd0b/eNOTzyA7lTkVPR/JcGzI7E8lPcqeiD6Y57ro7ku/kTkW/nu1f1Jxg4/2yY7lT0kaccuGgjTm+Pk5Zb3KnpJP1q+JvV64ctlHfzsc/bthqcqeqo53NJx9cfGh165f2b3z9/uoji0tPvPDprMkd5A5yB7mD3EHuIHeQO3IHuYPcQe4gd5A7yB3kDnIHuYPckTvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHeIBnIHuYPcQe4gd5A7yB3kDnIHuYPckTvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHfkDnIHuYPcQe4gd5A7yB3kDnIHuSN3kDvIHeQOcge5g9xB7iB3kDvIHeSO3EHuIHeQO8gd5A5yB7mD3EHuIHfkDnIHuYPcQe4gd5A7yB3kDnIHuSN3kDvIHeQOcge5g9xB7iB3kDvIHbmD3EHuIHeQO8gd5A5yB7mD3EHuyP3/7q926VgAAAAAYJC/9Sx2FUPoDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7ugOuoPuoDvoDrqD7qA76A66g+7oDrqD7qA76A66g+6gO+gOuoPu6A66g+6gO+gOuoPuoDvoDrqD7qA7uoPuoDvoDrqD7qA76A66g+6gO7qD7qA76A66g+6gO+gOuoPuoDu6g+6gO+gOuoPuoDus3UF30B10B91Bd9AddAfdQXfQHd1Bd9AddAfdQXfQHXQH3UF30B3dQXfQHXQH3UF30B10B91Bd9Ad3UF30B10B91Bd9AddAfdQXfQHd1Bd9AddAfdQXfQHXQH3UF30B10R3fQHXQH3UF30B10B91Bd9AddEd30B10B91Bd9AddAfdQXfQHXRHd9AddAfdQXfQHXQH3UF30B10R3fQHXQH3UF30B10B91Bd9AddEd30B10B91Bd9AddAfdQXfQHXQH3dEddAfdQXfQHXQH3UF30B10B93RHXQH3UF30B10B91Bd9AddAfd0R10B91Bd9AddAfdQXfQHXQH3dEddAfdQXfQHXQH3UF30B10B90hcCKiPodek2oAAAAASUVORK5CYII="
;var LoaderScene=cc.LoaderScene.extend({ctor:function(){this._super(),this.bgContainer=new cc.Node,this.bgContainer.setAnchorPoint2(),this.bgContainer.setContentSize(this.getContentSize()),this.bgContainer.setPositionRound(this.width/2,this.height/2),this.addChild(this.bgContainer,10),this.contentContainer=new cc.Node,this.contentContainer.setAnchorPoint2(),this.contentContainer.setContentSize(this.getContentSize()),this.contentContainer.setPositionRound(this.width/2,this.height/2),this.addChild(this.contentContainer,11),this.sceneName="loaderScene";var e=LoaderScene.getLoadingText();this.message=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.LOADING_TEXT||cleverapps.styles.FONTS.TEXT),cleverapps.styles.LoadingScene.showMessageOnRewrite||(this.message.setPosition(cc.visibleRect.center.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x,cleverapps.styles.LoadingScene.barBg.y+cleverapps.styles.LoadingScene.message.y),this.bgContainer.addChild(
this.message)),this.hints=[e]},rewrite:function(){var e=this.message.getString();this.message.removeFromParent(),this.message=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.LOADING_TEXT||cleverapps.styles.FONTS.TEXT),this.message.setPosition(cc.visibleRect.center.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x,cleverapps.styles.LoadingScene.barBg.y+cleverapps.styles.LoadingScene.message.y),this.bgContainer.addChild(this.message),this.onChangeSize()},onLoadError:function(e,t){this.message.setString("Error loading! Retry number: "+t)},createAnimations:function(){this.animations=cleverapps.styles.LoadingScene.animations.map(this.createAnimation.bind(this)),this.updateAnimations()},createAnimation:function(e){var t=new cleverapps.Spine(e.json);e.onBg?this._logo.addChild(t):this.contentContainer.addChild(t);var s=e.name&&e.name.idle&&(e.name.idle[cleverapps.settings.language]||e.name.idle.en)||"idle",i=e.name&&e.name.start&&(
e.name.start[cleverapps.settings.language]||e.name.start.en)||"start";return i&&s&&t.setAnimationAndIdleAfter(i,s),i?t.setAnimation(0,i,!1):t.setAnimation(0,s,!0),t.setLocalZOrder(e.zOrder),t.setScale(resolutionScale),t.style=e,t},beforeTransitionAnimations:function(e){cleverapps.isInstant()?e():(this.bgContainer.runAction(new cc.ScaleTo(1,1/1.1)),this.contentContainer.runAction(new cc.ScaleTo(1.3,.7)),setTimeout(e,500))},finishAnimations:function(){this.animations.forEach(function(e){if(e.style.name&&e.style.name.finish){e.setCompleteListener(function(){});var t=e.style.name.finish[cleverapps.settings.language]||e.style.name.finish.en;e.setAnimation(0,t,!1)}})},onTransitionAnimationDidStart:function(){this.finishAnimations()},init:function(){var e=bundles.loading_scene_backgrounds.urls,t=e["background_"+cleverapps.settings.language]||e.background_en||e.background;cc.sys.isMobile&&(t=e["background_mobile_"+cleverapps.settings.language]||e.background_mobile_en||t),cc._loaderImage=t
;var i=function(){};this.animations=[],bundles.loading_scene&&cleverapps.bundleLoader.loadBundle("loading_scene",{onSuccess:function(){this._logo?this.createAnimations():i=this.createAnimations.bind(this)}.bind(this)});var n=function(s){cc.loader.loadImg(cc._loaderImage,function(e,t){s<=1||!e?(this._initStage(t,cc.visibleRect.center),i()):n(s-1)}.bind(this))}.bind(this);n(3);var o=null,r=null,s=cleverapps.once(function(){if(this.drawPercent=0,this.needPercent=0,this.percentInterval=setInterval(function(){if(this.drawPercent!==this.needPercent){var e=(this.needPercent-this.drawPercent)/20;.01<e?this.drawPercent+=e:this.drawPercent=this.needPercent,this._bar&&this._bar.setPercentage(this.drawPercent),"undefined"!=typeof FBInstant&&FBInstant.setLoadingProgress(this.drawPercent)}}.bind(this),.2),!cleverapps.isInstant()){var e=cleverapps.styles.LoadingScene,t=new cc.Sprite(o);if(e.barBg.scale9)(t=new cc.Scale9Sprite(t.getSpriteFrame())).setContentSize(Math.min(
this.width-2*e.barBg.scale9.padding,e.barBg.scale9.width),e.barBg.scale9.height);this._background=t,resolutionScale&&t.setScale(resolutionScale);var s=this._bar=new ScaledProgressBar(new cc.Sprite(r).getSpriteFrame());s.setDimension(Math.min(this.width-2*e.bar.scale9.padding,e.bar.scale9.width),e.bar.scale9.height),s.setMinProgressWidth(e.bar.scale9.minWidth),s.x=e.bar.x/resolutionScale,e.bar.initialX&&(s.x=e.bar.initialX/resolutionScale,setTimeout(function(){s.x=e.bar.x/resolutionScale},400)),s.y=e.bar.y/resolutionScale,t.addChild(s),t.x=cc.visibleRect.center.x,t.y=e.barBg.y,this.bgContainer.addChild(t),this.progressBar=t}}.bind(this)),a=function(){o&&r&&s()};return cc.loader.loadImg(document.getElementById("loadingA").src,function(e,t){o=t,a()}),cc.loader.loadImg(document.getElementById("loadingB").src,function(e,t){r=t,a()}),!0},_updateLogoPosAndScale:function(e){if(this._logo){this._logo.x=e.x,this._logo.y=e.y;var t=cc.director.getWinSize(),s=Math.max(1,t.height/this._logo.height,
t.width/this._logo.width);this._logo.setScale(cc.contentScaleFactor()*s*1.1)}},updateAnimations:function(){var s=cc.visibleRect.center;this.animations.forEach(function(e){e.setPositionRound(e.style.pos||cc.p(s.x,s.y));var t=1;e.style.width&&(t=Math.min(this.width/e.style.width*.9,1)),e.setScale(t)}.bind(this))},_initStage:function(e,t){cleverapps.styles.LoadingScene.pattern?this._logo=cleverapps.UI.createPatternSprite(e||null,cc.director.getWinSize()):this._logo=new cc.Sprite(e||null),this._updateLogoPosAndScale(t),this.bgContainer.addChild(this._logo,-1),LoaderScene.showCanvas()},onChangeSize:function(){var e=cc.visibleRect.center;this.setContentSize(cc.director.getWinSize()),this.contentContainer.setContentSize(this.getContentSize()),this.contentContainer.setPositionRound(this.width/2,this.height/2),this.bgContainer.setContentSize(this.getContentSize()),this.bgContainer.setPositionRound(this.width/2,this.height/2),this._updateLogoPosAndScale(e),this.updateAnimations(),
this.progressBar&&(this.progressBar.x=e.x),this.message&&(this.message.x=e.x+cleverapps.styles.LoadingScene.bar.x+cleverapps.styles.LoadingScene.message.x)},onExit:function(){clearInterval(this.percentInterval),cc.Node.prototype.onExit.call(this),cc.eventManager.removeCustomListeners(cc.Director.EVENT_PROJECTION_CHANGED),cleverapps.bundleLoader.deleteBundle("loading_scene")},_startLoading:function(){this.unschedule(this._startLoading);var e=this.resources,s=function(t){cc.loader.load(e,function(e,t,s){var i=s/t*100|0;i=Math.min(Math.round(i),100),this.needPercent=i,this.rewrite()}.bind(this),function(e){e?(t++,this.onLoadError&&this.onLoadError(e,t),t<10&&s(t)):(this.needPercent=100,this.cb&&this.cb.call(this.target))}.bind(this))}.bind(this);s(0)},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._logo&&this._logo._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),this._bar&&this._bar._renderCmd.setDirtyFlag(
cc.Node._dirtyFlags.transformDirty),this._background&&this._background._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},closeAction:function(){}});LoaderScene.showCanvas=function(){document.getElementById("gameCanvas").style.left="0",document.getElementById("gameCanvas").style.top="0",void 0!==cleverapps&&cleverapps.canvasTop&&(document.getElementById("Cocos2dGameContainer").style["margin-top"]=cleverapps.canvasTop),document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading"))},LoaderScene.getLoadingText=function(){if(cleverapps.isInstant())return"";var e={en:"Loading",ru:"Загрузка",ja:"読み込み中",zh:"载入中",es:"cargando",de:"Wird geladen",pt:"Carregando",it:"Caricamento in corso",ar:"جار التحميل",ko:"로드 중",tr:"Yükleniyor",nl:"bezig met laden",fr:"chargement"};return(e[cleverapps.settings.language]||e.en)+"..."},cleverapps.styles.LoadingScene={barBg:{y:80,scale9:{width:400,height:19,padding:0}},bar:{x:0,y:0,scale9:{width:400,
height:19,minWidth:30,padding:0}},message:{x:0,y:30},animations:[]};var VictoryWindowBase=Window.extend({createAddbutton:function(e,t,s){var i=[];switch(e){case GameBase.REWARD_CLOVER:i=["x2@100","x2@200","x2@300","x3@300","+10[=]"];break;case GameBase.REWARD_PIGGY_BANK:break;case GameBase.REWARD_EXP:i=["x2@100","x2@200","x2@300","+1[=]"];break;case GameBase.REWARD_GOLD:i=["+50[=]"],cleverapps.flags.reduceAds&&(i=["+10[=]"]);break;case GameBase.REWARD_BOOSTER:i="match3"===cleverapps.config.type?["x3@200","x2@100"]:["x3@300","x3@400","x2@100","x2@150"]}var n=cleverapps.Random.choose(i.filter(function(e){return!(-1!==e.indexOf("[=]")&&!cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED))&&(-1===e.indexOf("x2")&&-1===e.indexOf("x3")||0!==t)}));if(n){var o=new RewardBuyButton({window:this,game:this.game,type:e,config:n,onRemove:s});return o&&(o.setPositionRound(cleverapps.styles.VictoryWindowBase.rewards.button),this.rewardBuyButtons.push(o)),o}},listChanges:function(){
return[new VictoryChestChange({level:this.level,stars:this.starChestChange,oldChestStars:this.oldChestStars}),new LanternChange({level:this.level,lantern:Lantern.Get()}),new TournamentBookChange({game:this.game})].filter(function(e){return e.isActive()})},runChanges:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.VictoryWindowBase.changes.delay),new cc.CallFunc(function(){e.forEach(function(e){e.createView(this).animateChange(e.calculateDelta())},this)}.bind(this))))},createRewardsBlock:function(){var c=cleverapps.styles.VictoryWindowBase.rewards;this.rewardViews={},this.rewardBuyButtons=[],this.game.collectedBoosterCell&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_CELL_RECEIVED),void 0!==this.game.rewards[GameBase.REWARD_CLOVER]&&(!this.game.gameMission||this.game.gameMission&&!this.game.gameMission.isRunning())&&delete this.game.rewards[GameBase.REWARD_CLOVER];var l=function(e,t){t&&t.showUp&&(e.visible=!1,e.runAction(new cc.Sequence(
new cc.DelayTime(t.showUp.delay),new cc.CallFunc(function(){e.scale=0,e.visible=!0}),new cc.ScaleTo(t.showUp.duration,e.baseScale||e.baseScaleX,e.baseScale||e.baseScaleY).easing(t.easing||cc.easeBackOut()))))},e=Object.keys(this.game.rewards).filter(function(e){return e!==GameBase.REWARD_BACKGROUND_CLOVER});3<e.length&&(e=e.filter(function(e){return e!==GameBase.REWARD_PIGGY_BANK}));var t=e.map(function(e){var t,s,i=this.game.rewards[e],n=this.rewardViews[e]=this.getRewardBackground(e),o=n.button=this.createAddbutton(e,i,function(){c.twoLinePrize.icon&&t.setPositionRound(c.twoLinePrize.icon),c.twoLinePrize.amount&&s.setPositionRound(c.twoLinePrize.amount)});t=n.icon=this.getRewardIcon(e),n.addChild(t),t.setPositionRound(c.icon),e===GameBase.REWARD_EXP&&c.Exp&&c.Exp.position&&t.setPositionRound(c.Exp.position.x,c.Exp.position.y),!o&&c.twoLinePrize.icon&&t.setPositionRound(c.twoLinePrize.icon),e===GameBase.REWARD_PIGGY_BANK&&c.Piggy&&t.setPositionRound(c.Piggy),
t.show&&"function"==typeof t.show&&t.show(),n.baseScale=n.scale,l(n,c.bg),t.baseScaleX=t.scaleX,t.baseScaleY=t.scaleY,l(t,c.icon);var r,a=i;return e===GameBase.REWARD_PIGGY_BANK&&cleverapps.piggyBank.isFull()&&(a="messages:VictoryWindowBase.piggyBankFull"),s=n.amount=cleverapps.UI.generateTTFText(a,cleverapps.styles.FONTS.REWARDS_TEXT),n.addChild(s),s.setPositionRound(c.amount),!o&&c.twoLinePrize.amount&&s.setPositionRound(c.twoLinePrize.amount),s.baseScale=s.scale,l(s,c.amount),o&&(n.addChild(o),cleverapps.UI.onClick(n,o.createListener(function(){o.action()})),o.baseScale=o.scale,l(o,c.button)),c.container?((r=new cc.Node).setAnchorPoint2(),r.setContentSize2(c.container),n.setPositionRound(c.container),r.addChild(n)):r=n,r}.bind(this));if(0!==t.length){this.existRewards=!0;var s=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:c.prizesMargin,padding:c.prizesPadding});if(s.setLocalZOrder(2),!1===c.title)return s;var i=[cleverapps.UI.generateTTFText(
"messages:VictoryWindowBase.rewards",cleverapps.styles.FONTS.VICTORY_REWARDS_TITLE_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT)];bundles.victorywindow.frames.level_victory_reward_line&&(i.unshift(new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_line)),i.push(new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_line)));var n=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:c.margin});return new cleverapps.Layout([s,n],{direction:cleverapps.UI.VERTICAL,margin:c.margin,padding:c.padding})}if(c.noRewards){var o=cleverapps.UI.generateTTFText("messages:VictoryWindow.rewardsAhead",cleverapps.styles.FONTS.VICTORY_NO_REWARDS_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(c.noRewards.width,0),o}},getRewardBackground:function(e){var t,s=cleverapps.styles.VictoryWindowBase.rewards;if(bundles.victorywindow.jsons.level_victory_reward_bg_json)return(t=new cleverapps.Spine(
bundles.victorywindow.jsons.level_victory_reward_bg_json)).setAnchorPoint2(),t.setContentSize2(cleverapps.styles.VictoryWindowBase.rewards.bg),t.setVisible(!1),s.bg&&s.bg.animation&&t.setAnimation(0,s.bg.animation,!0),t;if(bundles.victorywindow.frames.level_victory_reward_bg)return s.bg.scale9?((t=new cc.Scale9Sprite(bundles.victorywindow.frames.level_victory_reward_bg)).setContentSize2(s.bg),t):new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg);switch(e){case GameBase.REWARD_CLOVER:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg1);case GameBase.REWARD_PIGGY_BANK:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg2);case GameBase.REWARD_EXP:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg3);case GameBase.REWARD_GOLD:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg1);case GameBase.REWARD_BOOSTER:return new cc.Sprite(bundles.victorywindow.frames.level_victory_reward_bg2)}},
getCloverVictoryAnimation:function(){var e=this.mission.getIcon(),t=new cc.Sprite(e);return t.setScale(cleverapps.styles.VictoryWindowBase.rewards.Clover.scale),t},getGoldVictoryAnimation:function(){var e=new cc.Sprite(bundles.menubar.frames.coin_png);return e.setScale(cleverapps.styles.VictoryWindowBase.rewards.Coin.scale),e},getRewardIcon:function(e){var t=cleverapps.styles.VictoryWindowBase.rewards;switch(e){case GameBase.REWARD_CLOVER:return this.getCloverVictoryAnimation();case GameBase.REWARD_PIGGY_BANK:return new PiggyBankVictoryAnimation;case GameBase.REWARD_EXP:var s=new cc.Sprite(bundles.menubar.frames.exp_png);return s.setScale(t.Exp.scale),s;case GameBase.REWARD_GOLD:return this.getGoldVictoryAnimation();case GameBase.REWARD_BOOSTER:var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t.Booster);var n=BoosterCellView.prototype.getImage(this.game.collectedBoosterCell);return i.addChild(n),n.setPosition(i.width/2,i.height/2),void 0!==t.Booster.scaleX?i.setScale(
t.Booster.scaleX,t.Booster.scaleY):i.setScale(t.Booster.scale),t.Booster.animationName&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_LOW&&n.setAnimation(0,t.Booster.animationName,!0),i}},addButtons:function(){var e=[],t=new VictoryWindowButton({level:this.level,oldStars:this.oldStars,oldStoryStage:this.oldStoryStage,boatswain:this.boatswain,onPressed:this.close.bind(this)});if(e.push(t),this.level.isRegular()||this.level.episode.isDailyCup()){var s=this.getShareBonus(),i={window:this,shareBonus:s,toReplace:{}};this.game.level.episode.isDailyCup()?i.toReplace.stars=this.game.getDailyCupStars():(i.score=void 0!==this.score?this.score:cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,this.level.levelNo),i.level=this.level);var n=ShareBonusButton.create(i);n&&e.push(n)}return e},getShareBonus:function(){return this.game.level.episode.isDailyCup()?cleverapps.ShareBonus.SHARES.dailyCup:cleverapps.ShareBonus.SHARES.victory},getShareOptions:function(){
var e=this.getShareBonus(),t={levelNo:this.level.episodeNo*Episode.LEVELS_PER_EPISODE+this.level.levelNo+1};if(void 0!==this.score?t.score=this.score:t.score=cleverapps.userresult.getScoresForLevel(this.level.episode.episodeNo,this.level.levelNo),this.game.level.episode.isDailyCup()){var s=this.game.getDailyCupStars(),i=s;"match3"===cleverapps.config.type&&(i=Messages.get("Share.DailyCup.stars"+s)),t={stars:i}}return{shareId:e.id,toReplace:t}},animateReward:function(e,t){var s=this.rewardViews[e];if(s){var i=s.icon;s.amount.setString(this.game.rewards[e]);var n=s.amount.scale;s.amount.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2*n),new cc.Sequence(new cc.ScaleTo(.2,n)))),cleverapps.UI.animateDelta(t,{x:s.amount.x,y:s.amount.y+cleverapps.styles.VictoryWindowBase.rewards.button.animation.dy,parent:s,font:cleverapps.styles.FONTS.VICTORY_WINDOW_REWARD_DELTA});var o=this.convertToNodeSpace(i.getParent().convertToWorldSpace(i.getPosition()))
;e===GameBase.REWARD_CLOVER&&MissionAnimationView.show(this.game.getMissionType(),this,{amount:Math.min(t,15),beginPos:o,victory:!0})}},listBundles:function(e){var t=["victorywindow","starchest_window"];return Lantern.IsActive(e.level)&&t.push("lantern"),e.game.rewards[GameBase.REWARD_PIGGY_BANK]&&t.push("piggybank_window"),t}});cleverapps.styles.VictoryWindowBase={rewards:{margin:30,prizesMargin:0,prizesPadding:{x:0,y:0},padding:{x:0,y:0},icon:{x:{align:"center"},y:{align:"center",dy:54}},amount:{x:{align:"center"},y:{align:"center",dy:-6}},button:{x:{align:"center"},y:{align:"bottom",dy:4},animation:{dy:-30}},Exp:{scale:1},twoLinePrize:{},Coin:{scale:1},Booster:{width:100,height:100,scale:1},Clover:{scale:.9},bg:{scale9:!1}},changes:{delay:0},share:{margin:{x:20}}};var VictoryFriendView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint(.5,.5),this.place=t;var s=new cleverapps.UI.Avatar(e);this.addChild(s),this.avatar=s,this.setContentSize(s.width*s.scale,
s.height*s.scale),s.setPositionRound(this.width/2,s.height/2)},showAnimation:function(){var e=1*(.5+this.place/4);this.scale=0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(e+.25),new cc.ScaleTo(.25,1)))}}),VictoryWindow=VictoryWindowBase.extend({onWindowLoaded:function(e){this.game=e.game,this.boatswain=e.boatswain,this.rewarded=this.game.rewards[GameBase.REWARD_GOLD],this.game.gameMission&&(this.mission=this.game.gameMission),this.level=e.level;var t=cleverapps.styles.VictoryWindow;this.createContent(),this.addRewardBlock(),cleverapps.isRumble()&&!cleverapps.config.adminMode&&(this.addRoundResults(),this.addRoundCountDown()),this.level.episode.isBonusRound()&&t.bonusRound&&this.addBonusRoundAnimation(),this.level.episode.isDailyCup()&&t.dailyCup&&this.addDailyCupAnimation(),t.confetti&&this.addConfettiAnimation(),cleverapps.isRumble()&&!cleverapps.config.adminMode&&this.addHero();var s={};this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]&&(-1!==["solitaire"
,"differences"].indexOf(cleverapps.config.type)||0<=["scramble","wordsoup","crocword","magicwords"].indexOf(cleverapps.config.name))&&(this.game.backgroundMission.type===Mission.TYPE_SLOT_MACHINE?s.slot_machine_tickets=this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]:s.shovels=this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]),cleverapps.metha.getType()===Metha.SIMPLE&&this.level.isRegular()&&"magicwords"!==cleverapps.config.name&&(s.stars=cleverapps.simple.amountLevelStars(this.level)),0<Object.keys(s).length&&this.addChild(new MedallionComponent(s)),this.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]&&TreasureSearchRewardComponent.IsAvailable()&&new TreasureSearchRewardComponent(this.content);var i,n,o=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.VictoryWindow.window,!0);cleverapps.isRumble()||(i=this.addButtons(),n=this.getShareOptions()),this._super({name:"victorywindow",content:this.content,noBackground:t.noBackground,buttons:i,shareCheckBox:n,
title:this.getTextTitle(),styles:o,windowBg:e.windowBg,closeButton:!this.game.round,notCloseByTouchInShadow:this.game.round,onClose:function(){VictoryWindowHero.hero&&(VictoryWindowHero.hero.hide(),delete VictoryWindowHero.hero)}}),cleverapps.metha.getType()===Metha.FARM?this.addProvidedKey():cleverapps.isKnockoutGame()&&!this.level.episode.isDailyLevel()||this.addAnimatedTitle();var r=cleverapps.styles.VictoryWindow.rewardBlock.padding||0;this.rewardBlock&&this.rewardBlock.width*this.rewardBlock.scale+r>this.window.width&&this.rewardBlock.setScale(this.window.width/(this.rewardBlock.width+r)),this.addInviteBlock(),this.runChanges(this.listChanges()),cleverapps.metha.getType()!==Metha.HOMEFIX&&"magicwords"!==cleverapps.config.name||!this.level.isRegular()||this.window.addChild(this.flyStarAnimation()),this.game.round?cleverapps.audio.playSound(bundles.game.urls.round_win_effect):(setTimeout(function(){cleverapps.audio.playSound(bundles.game.urls.win_effect),cleverapps.audio.playSound(
bundles.game.urls.win_effect_2)},t.soundDelay?t.soundDelay:0),bundles.game.urls.victory_looped_effect&&this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.victory_looped_effect)}),new cc.DelayTime(4))))}.bind(this)))))},getTextTitle:function(){if("tripeaks"===cleverapps.config.name)return"messages:VICTORY"},createContent:function(){var e=cleverapps.styles.VictoryWindow,t=cc.size(e.width,e.height);this.level.episode.isDailyCup()&&e.dailyCup&&(t=e.dailyCup),this.content=new cc.Node,this.content.setAnchorPoint2(),this.content.setContentSize(t)},flyStarAnimation:function(){var e=cleverapps.styles.VictoryWindow.flyStar,t=new cc.Node;t.setAnchorPoint2(),t.setPositionRound(e.position),t.setContentSize2(e);var s=this.level.isHard()&&e.animation_hard?e.animation_hard:"animation",i=this.level.isHard()&&e.idle_hard?e.idle_hard:"idle",
n=new cleverapps.Spine(bundles.victorywindow.jsons.victory_star);if(n.setAnimation(0,s,!1),n.addAnimation(0,i,!0),n.setPosition(t.width/2,t.height/2),t.addChild(n),t.setLocalZOrder(10),this.level.isHard()&&e.text){var o=cleverapps.UI.generateTTFText("x3",cleverapps.styles.FONTS.VICTORY_STAR_AMOUNT_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);t.addChild(o),o.setPositionRound(e.text),o.setScale(0),o.runAction(new cc.Sequence(new cc.DelayTime(2.4),new cc.ScaleTo(.4,1).easing(new cc.easeBackOut)))}return t},addRoundResults:function(){var e=new RoundResultsComponent(this.game);e.setPositionRound(cleverapps.styles.VictoryWindow.roundResultsComponent),this.content.addChild(e)},addRoundCountDown:function(){this.roundCountdown=new RoundCountdownComponent(function(){this.hero.hide(),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(this.close.bind(this))))}.bind(this)),this.roundCountdown.setPositionRound(cleverapps.styles.VictoryWindow.roundCountdownComponent),
this.content.addChild(this.roundCountdown)},addHero:function(){this.hero=new VictoryWindowHero,this.addChild(this.hero),this.hero.show()},addBonusRoundAnimation:function(){var e=cleverapps.styles.VictoryWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.bonusRound),this.content.addChild(t),t.setPositionRound(e.bonusRound);var s=new cleverapps.Spine(bundles.hero.jsons.hero_json);t.addChild(s),s.setAnimation(0,"bonus",!0),s.setPositionRound(t.width/2,t.height/2)},addDailyCupAnimation:function(){var e=cleverapps.styles.VictoryWindow,t=new cc.Sprite(bundles.sidebar.frames.daily_cup_icon);this.content.addChild(t),t.setPositionRound(e.dailyCup)},addProvidedKey:function(){if(cleverapps.farm&&cleverapps.farm.providedKey){var e=ProvidesComponent({key:cleverapps.farm.providedKey,victory:!0,noLabel:cleverapps.styles.VictoryWindow.providesComponent.noLabel});e.setPositionRound(cleverapps.styles.VictoryWindow.providesComponent),this.content.addChild(e)}},addAnimatedTitle:function(){if(
bundles.victorywindow.jsons.victory_json){var e=cleverapps.styles.VictoryWindow.title,t=new cleverapps.Spine(bundles.victorywindow.jsons.victory_json),s=t.data.animations["open_"+cleverapps.settings.language]&&"open_"+cleverapps.settings.language||"open",i=t.data.animations["idle_"+cleverapps.settings.language]&&"idle_"+cleverapps.settings.language||"idle";if(t.setAnimationAndIdleAfter(s,i),t.setPositionRound(this.content.width/2,e.y),this.content.addChild(t),e.text){var n=this.titleText=cleverapps.UI.generateTTFText(e.text.message,e.text.font);n.setPositionRound(0,e.text.y),t.addChild(n)}return t}},addRewardBlock:function(){var e=cleverapps.styles.VictoryWindow;this.rewardBlock=this.createRewardsBlock(),this.rewardBlock&&(this.content.addChild(this.rewardBlock),e.rewardBlock.scale&&this.rewardBlock.setScale(e.rewardBlock.scale),this.rewardBlock.setPositionRound(this.content.width/2,e.rewardBlock.y))},addConfettiAnimation:function(){var e=cleverapps.styles.VictoryWindow.confetti;if(e){
var t=new cleverapps.Spine(e.spine_json);t.setAnimation(0,e.animation,!1),t.setPositionRound(e.position),this.content.addChild(t)}},onShow:function(){this.buttons&&this.buttons.onShow(),this.placeText&&(this.placeText.scale=0,this.placeText.stopAllActions(),this.placeText.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.3,1).easing(cc.easeBackOut()))),this.rewardBlock&&(this.rewardBlock.opacity=0,this.rewardBlock.stopAllActions(),this.rewardBlock.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.FadeIn(.2))))),this.roundCountdown&&this.roundCountdown.resumeCountdown()},addReward:function(e){if(this.rewardViews[GameBase.REWARD_GOLD]){var t=this.rewardViews[GameBase.REWARD_GOLD].amount,s=parseInt(t.getString())+e,i=cleverapps.styles.VictoryWindow.rewardBlock.text.format.replace("%{amount}",s);t.setString(i);var n=this.rewardViews[GameBase.REWARD_GOLD].scale;return this.rewardViews[GameBase.REWARD_GOLD].runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2*n),new cc.Sequence(
new cc.ScaleTo(.2,n)))),!0}},addInviteBlock:function(){InviteComponent({parent:this})}});cleverapps.styles.VictoryWindow={width:400,height:200,noBackground:!1,providesComponent:{noLabel:!1,x:{align:"center"},y:{align:"top",dy:0}},title:{y:520},rewardBlock:{y:400,x:0,margin:0,text:{y:8,format:"+%{amount}"},coin:{scale:1}},share:{margin:10},window:{decors:{}}};var LoseWindow=Window.extend({onWindowLoaded:function(e,t){this.replayCallback=e||function(){},this.level=t.level;var s=cleverapps.styles.LoseWindow,i=this.createContent(),n=s.button.tryAgain,o=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.LoseWindow),r=cleverapps.once(function(){this.replayCallback(),this.close()}.bind(this));this._super({name:"losewindow",content:i,title:s.title,noBackground:s.noBackground,styles:o,button:{text:n?Messages.get("TryAgain"):Messages.get("OK"),width:s.button.width,height:s.button.height,onPressed:function(){if(n&&cleverapps.lives.isEmpty()){
var e=new LivesShopWindow;cleverapps.lives.onChangeAmountListeners["losewindow.TryAgain"]=e.createListener(r)}else r()}.bind(this)}}),cleverapps.lives.onChangeAmountListeners.losewindow=this.createListener(this.updateWindow.bind(this)),cleverapps.audio.playSound(bundles.main.urls.window_effect);new HardLevelDecorationComponent({parent:this});this.runAction(new cc.Sequence(new cc.DelayTime(.45),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.lose_window_effect)})))},createAnimationNode:function(){var e=cleverapps.styles.LoseWindow,t=new cc.Node;t.setAnchorPoint2();var s=this.animation=cleverapps.UI.createAnimation(this.getAnimationStyles());return t.setContentSize2(e.animation.width,e.animation.height),s.setPositionRound(t.width/2+e.animation.x,t.height/2+e.animation.y),t.addChild(s),t},getAnimationStyles:function(){return cleverapps.styles.LoseWindow.animation},createLivesLeftBlock:function(){var e,t=cleverapps.styles.LoseWindow,s=[],
i=cleverapps.styles.FONTS.LOSE_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT;if(cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES))e=cleverapps.UI.generateTTFText("messages:LoseWindow.livesLeftUnlimited",i);else{e=cleverapps.UI.generateTTFText("messages:LoseWindow.livesLeft",i);for(var n=[],o=0;o<cleverapps.Lives.MAX_REGEN_AMOUNT;o++)if(o===cleverapps.lives.amount){var r=new cc.Sprite(t.lives.icon).getContentSize(),a=new cc.Node;a.setAnchorPoint2(),a.setContentSize2(r);var c=cleverapps.UI.createAnimation(t.lives.animation);a.addChild(c),c.setPositionRound(a.width/2,a.height/2),n.push(a)}else{var l=o<cleverapps.lives.amount?t.lives.icon:t.lives.icon_empty,p=new cc.Sprite(l);n.push(p)}var d=this.heartsNode=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:t.heartsMargin});s.push(d)}return e.setAnchorPoint2(),s.push(e),new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:t.lifesLeftMargin})},createContent:function(){
var e=cleverapps.styles.LoseWindow,t=[],s=this.createAnimationNode();return t.push(s),this.livesLeftBlock=this.createLivesLeftBlock(),this.livesLeftBlock&&t.push(this.livesLeftBlock),new cleverapps.Layout(t.reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.content.margin,y:e.content.y,padding:{x:e.content.padding.x,y:e.content.padding.y}})},updateWindow:function(){if(this.heartsNode){for(var e=[],t=cleverapps.styles.LoseWindow,s=0;s<cleverapps.Lives.MAX_REGEN_AMOUNT;s++){var i=s<cleverapps.lives.amount?t.lives.icon:t.lives.icon_empty,n=new cc.Sprite(i);e.push(n)}var o=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:t.heartsMargin});this.livesLeftBlock.addChild(o),o.setPositionRound(this.heartsNode.getPosition()),this.heartsNode.removeFromParent(),this.heartsNode=o}}});LoseWindow.prototype.listBundles=function(){return["lose_window"]},cleverapps.styles.LoseWindow={width:650,height:550,title:"messages:LoseWindow.title",heartsMargin:5,lifesLeftMargin:15,content:{
margin:40,y:25,padding:{x:0,y:10}},animation:{width:650,height:320,x:0,y:0,spine:{json:bundles.lose_window.jsons.lose_json,openAnimation:"open",idleAnimation:"idle"}},lives:{animation:{spine:{json:bundles.main.jsons.level_failed_small_hearts_json,openAnimation:"animation"}},icon:bundles.main.frames.level_failed_heart_png,icon_empty:bundles.main.frames.level_failed_heart_empty_png},button:{width:300,height:100,offset:{x:170},tryAgain:!0},adsButton:{width:350,icon:{scale:.8,x:30,y:40},text:{x:185,y:40}},decors:{}};var LevelStartWindow=Window.extend({onWindowLoaded:function(e){this.level=e.level,this.stars=this.level.stars,BoostersBefore.isAvailable()&&(this.boostersBefore=new BoostersBefore(e),cleverapps.metha.showControlsWhileFocused("MenuBarGoldItem")),this.isHardLevel=this.level.isHard()&&!this.level.episode.isDailyLevel();var t=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.LevelStartWindow,!0);e.styles&&(t=cleverapps.overrideStyles(t,e.styles)),
this.isHardLevel&&(t=cleverapps.overrideStyles(t,cleverapps.styles.HardLevelStartWindow)),this.level.isTricky()&&(t=cleverapps.overrideStyles(t,cleverapps.styles.TrickyLevelStartWindow));var s=new cleverapps.Layout(this.listContent(),{direction:cleverapps.UI.VERTICAL,margin:t.margin}),i=cleverapps.UI.wrapWithPadding(s,{x:0,y:t.padding});e.replay&&(this.onClose=function(){cleverapps.metha.distract({focus:"LevelReplayFromLevelStartWindow",action:function(e){this.level.play(e,{boostersBefore:this.boostersBefore})}.bind(this)})}.bind(this)),this._super({title:this.getTitle(),name:"levelstartwindow",content:i,button:this.getButton(),styles:t,level:this.level}),"board"!==cleverapps.config.type&&"tripeaks"!==cleverapps.config.name&&HighScoresComponent({parent:this,level:this.level}),new HardLevelDecorationComponent({parent:this}),cleverapps.audio.playSound(bundles.main.urls.window_effect),this.boostersBefore&&this.boostersBefore.showTutorialStep()},showBetForce:function(){if(
!cleverapps.forces.isShown(Forces.METHA_PLAY_BUTTON.id)){var e=cleverapps.forces.create(this.button,Forces.METHA_PLAY_BUTTON);this.registerCleanupCallback(function(){cleverapps.forces.isRunningForce(e)&&cleverapps.forces.closeRunningForce()})}},getTitle:function(){var e=cleverapps.styles.FONTS.LEVEL_WINDOW_TITLE;!this.level.episode.isDailyCup()&&this.isHardLevel&&cleverapps.styles.FONTS.HARD_LEVEL_TITLE&&(e=cleverapps.styles.FONTS.HARD_LEVEL_TITLE),this.isHardLevel&&cleverapps.styles.FONTS.BOOSTER_BEFORE_HARD_LEVEL_TITLE&&(e=cleverapps.styles.FONTS.BOOSTER_BEFORE_HARD_LEVEL_TITLE);var t="";return this.level.isRegular()&&(t=cleverapps.metha.getType()!==Metha.HOSE||this.level.isCurrentLevel()?cleverapps.user.getVirtualDisplayLevel():this.level.getHumanReadableNumber()),{text:this.getTitleText(),font:e,toReplace:{levelNo:t}}},getTitleText:function(){return this.level.episode.isDailyCup()?"messages:DailyCup.title":this.isHardLevel?"messages:message.hardLevel":this.level.isTricky(
)?"messages:message.trickyLevel":this.level.episode.isDailyLevel()?"messages:DailyLevelWindow.title":cleverapps.user.isPassedAll()&&cleverapps.metha.getType()===Metha.HOSE&&this.level.isCurrentLevel()?"messages:LevelStartWindow.ComingSoonTitle":"messages:LevelStartWindow.title"},getButton:function(){var e=bundles.buttons_main.frames.play_button_png,t=bundles.buttons_main.frames.play_button_on_png;this.isHardLevel&&(e=bundles.buttons_main.frames.play_button_hard_png,t=bundles.buttons_main.frames.play_button_hard_on_png),this.level.isTricky()&&(e=bundles.buttons_main.frames.play_button_tricky_png,t=bundles.buttons_main.frames.play_button_tricky_on_png);var s=cleverapps.once(function(){cleverapps.metha.distract({focus:"LevelStartFromLevelStartWindow",action:function(e){this.onClose=function(){},this.close(),this.level.play(e,{boostersBefore:this.boostersBefore})}.bind(this)})}.bind(this)),i={width:cleverapps.styles.LevelStartWindow.Button.width,
height:cleverapps.styles.LevelStartWindow.Button.height,button_png:e,button_on_png:t,padding:cleverapps.styles.LevelStartWindow.Button.padding,onPressed:function(){cleverapps.lives&&cleverapps.lives.isEmpty()?new LivesShopWindow:s()}.bind(this)};return i.text=Messages.get("Play").toUpperCase(),i.font=cleverapps.styles.FONTS.LEVEL_START_PLAY_BUTTON_TEXT,i},listContent:function(){var e=[];if(this.boostersBefore){var t=new BoostersBeforeComponent(this.boostersBefore,this.level);e.push(t)}if(cleverapps.styles.ScoreComponent.enabled&&this.level.isRegular()){var s=ScoreComponent({level:this.level,victory:!1});s&&e.push(s)}if(this.showStarsComponent()){var i=StarsComponent({level:this.level,stars:this.stars,victory:!1});e.push(i)}return e},showStarsComponent:function(){return cleverapps.config.results&&this.level.isRegular()}});LevelStartWindow.isAvailable=function(e,t){return("board"!==cleverapps.config.type||"stacks"===cleverapps.config.subtype)&&"differences"!==cleverapps.config.name&&((
0!==e||0!==t)&&("stacks"===cleverapps.config.subtype?!cleverapps.GameSaver.load(GameBase.getStoreKey(e,t))&&BoostersBefore.isAvailable():"solitaire"!==cleverapps.config.type||BoostersBefore.isAvailable()))},LevelStartWindow.prototype.listBundles=function(e){var t=[];return BoostersBefore.isAvailable()&&0<Lantern.GetStreak(e.level)&&t.push("lantern"),t},cleverapps.styles.LevelStartWindow={padding:50,Button:{width:300,height:100},margin:0,betPrice:{text:{font:cleverapps.styles.FONTS.BIG_BUTTON_TEXT},label:{offsetY:3},icon:{scale:1,image:bundles.menubar.frames.coin_png,offsetY:13}}},cleverapps.styles.HardLevelStartWindow={},cleverapps.styles.TrickyLevelStartWindow={};var ProductPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.options=t||{},this.setCascadeOpacityEnabled(!0),this.setAnchorPoint2(),this.createContent(e)},createContent:function(e){var t,s=cleverapps.styles.ProductPriceView,i=this.options,n=i.text||e.getCurrentPrice(),o=this.options.icon,r=!1;if(
"string"==typeof n){var a=n.indexOf(" OK");-1!==a&&(n=n.substr(0,a),o=bundles.main.frames.ok_icon_png,r=!0)}if(t=cleverapps.UI.ImageFont.IsApplicable(this.options.font,n)?this.createImageText(n):this.createRegularText(n),this.content=this.text=t,o){var c=new cc.Sprite(o);c.setScale(i.iconScale||s.icon.scale);var l=[c,t];r&&l.reverse(),this.content=new cleverapps.Layout(l,{direction:cleverapps.UI.HORIZONTAL,margin:s.icon.margin}),this.content.setCascadeOpacityEnabled(!0)}if(this.setContentSize2(this.content.width,this.content.height),o&&cleverapps.UI.fitToBox(this,{width:i.fitTo&&i.fitTo.width||this.width,height:i.fitTo&&i.fitTo.height||this.height}),this.content.setAnchorPoint2(),this.content.setPositionRound(this.width/2,this.height/2),this.addChild(this.content),i.bg){var p=new cc.Scale9Sprite(i.bg.image);p.setLocalZOrder(-1),p.setContentSize2(this.width+2*i.bg.padding.x,this.height+2*i.bg.padding.y),p.setPositionRound(i.bg),this.content.addChild(p)}},createRegularText:function(e){
var t=cleverapps.styles.ProductPriceView,s=cleverapps.UI.generateOnlyText(e,this.options.font);this.options.fitTo&&s.fitTo(this.options.fitTo.width,this.options.fitTo.height);var i=new cc.Node;return i.setContentSize2(s.getContentSize()),i.setAnchorPoint2(),i.addChild(s),i.setCascadeOpacityEnabled(!0),s.setPositionRound(i.width/2,i.height/2+t.regularFontOffsetY),i},createImageText:function(e){return cleverapps.UI.generateImageText(e,this.options.font)},setString:function(e){this.content&&(this.content.removeFromParent(!0),delete this.content),this.createContent(e)}});cleverapps.styles.ProductPriceView={regularFontOffsetY:0,icon:{margin:14,scale:.8}};var ShopUserGoldView=cc.Node.extend({ctor:function(e){this._super(),this.settings=e||{},this.setLocalZOrder(22),this.setAnchorPoint2(),cc.director.getRunningScene().scene.addChild(this)},updateContent:function(){this.content&&this.content.removeFromParent(),this.createContent();var e=cleverapps.UI.getSceneSize(),
t=cleverapps.styles.ShopUserGoldView.position[cleverapps.wideMode.mode].y;for(this.setPosition(e.width/2,this.height/2+t);this.width*this.scale>=e.width;)this.setScale(.95*this.getScale())},createContent:function(){var e=cleverapps.styles.ShopUserGoldView,t=[this.createGoldBlock()];"match3"===cleverapps.config.type?t.unshift(this.createBoostersBlock()):BoostersBefore.isAvailable({ignoreProgress:!0})&&t.unshift(this.createBoostersBeforeBlock()),e.direction===cleverapps.UI.HORIZONTAL&&t.reverse();var s=this.textNode=new cleverapps.Layout(t.filter(function(e){return void 0!==e}),{direction:e.direction,margin:e.textNode.margin});s.setCascadeOpacityEnabled(!0);var i=[this.createPerson(),s];this.settings.mirrorPerson&&i.reverse(),this.content=new cleverapps.Layout(i.filter(function(e){return void 0!==e}),{direction:cleverapps.UI.HORIZONTAL,margin:e.margin}),this.createBg(),this.setContentSize(this.content.getContentSize()),this.addChild(this.content),this.content.setPosition(this.width/2,
this.height/2)},createGoldBlock:function(){var e=cleverapps.styles.ShopUserGoldView,t=cleverapps.UI.generateOnlyText("messages:YouHaveAmount",cleverapps.styles.FONTS.SHOP_USER_GOLD_TEXT),s=this.createItem(levels.user.gold,e.items.gold.res,e.items.gold),i=new cleverapps.Layout([t,s],{direction:cleverapps.UI.HORIZONTAL,margin:e.textNode.goldItemsMargin});return s.y+=e.items.gold.blockDy,i.setCascadeOpacityEnabled(!0),i},createBoostersBlock:function(){var s=cleverapps.styles.ShopUserGoldView,i=[];[0,1,2].forEach(function(e){if(levels.user.checkAvailable(BaseBooster.AVAILABLE[e])){var t=this.createItem(cleverapps.boostersCounter.data[e],s.items.boosters.res[e],s.items.boosters);i.push(t)}}.bind(this));var e=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:s.textNode.boostersItemsMargin});return e.setCascadeOpacityEnabled(!0),e},createItem:function(e,t,s){var i=cleverapps.styles.ShopUserGoldView,n=cleverapps.UI.generateImageText(cleverapps.formatAmount(e),
cleverapps.styles.FONTS.SHOP_USER_GOLD_TEXT),o=new cc.Sprite(t);o.setScale(s.scale),o.y+=s.dy||0;var r=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:i.items.margin});return r.setCascadeOpacityEnabled(!0),r},createBoostersBeforeBlock:function(){var t=cleverapps.styles.ShopUserGoldView.items.boostersBefore,e=BoostersBefore.GetAppropriateTypes().map(function(e){return this.createItem(cleverapps.boostersCounter.data[e]||0,BoostersBeforeConfig[e].icon,t)},this),s=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:t.itemsMargin});return s.setCascadeOpacityEnabled(!0),s},createPerson:function(){var e=cleverapps.styles.ShopUserGoldView.person;if(e&&(!e.visibility||!1!==e.visibility[cleverapps.wideMode.mode])){var t=this.person=new cc.Node;t.setAnchorPoint2(),t.setContentSize(e);var s=new cleverapps.Spine(e.json);return s.setAnimation(0,"animation",!0),s.setPosition(t.width/2,t.height/2),t.addChild(s),t.setScale(e.scale||1),t.y+=e.dy,t.setScaleX(
this.settings.mirrorPerson?-t.scaleX:t.scaleX),t}},createBg:function(){var e=cleverapps.styles.ShopUserGoldView.bg;if(e)if(this.bg)this.bg.setContentSize(this.textNode.width+e.padding.x,this.textNode.height+e.padding.y),this.bg.setPositionRound(this.textNode.x+e.dx,this.textNode.y);else{var t=this.bg=cleverapps.UI.createScale9Sprite(e.image);t.setContentSize(this.textNode.width+e.padding.x,e.fixedHeight||this.textNode.height+e.padding.y),this.addChild(t,-1),t.setPositionRound(this.textNode.x+e.dx,this.textNode.y)}},showUp:function(){this.updateContent(),this.setVisible(!0),this.runShowUpAnimation()},runShowUpAnimation:function(){if(this.bg&&this.bg.setOpacity(0),this.textNode.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.bg&&this.bg.runAction(new cc.FadeIn(.6)),this.textNode.runAction(new cc.FadeIn(.6))},this))),this.person){var e=this.person.getPosition();this.person.y=1.2*-this.person.height,this.person.runAction(new cc.Sequence(
new cc.DelayTime(.5),new cc.MoveTo(.5,e).easing(cc.easeBackOut())))}},onHide:function(){this.setVisible(!1)},close:function(){this.person&&this.person.runAction(new cc.ScaleTo(.2,0).easing(cc.easeBackIn())),this.bg&&this.bg.runAction(new cc.FadeOut(.4)),this.textNode.runAction(new cc.FadeOut(.4)),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.RemoveSelf))},listNodeBundles:function(){return["tile_shop"]}});ShopUserGoldView.IsAvailable=function(){return BoostersBefore.isAvailable({ignoreProgress:!0})},cleverapps.overrideFonts(cleverapps.styles.FONTS,{SHOP_USER_GOLD_TEXT:{color:cleverapps.styles.COLORS.WHITE,size:30}}),cleverapps.styles.ShopUserGoldView={margin:60,position:[{y:-20},{y:40},{y:40}],direction:cleverapps.UI.VERTICAL,textNode:{margin:10,goldItemsMargin:10,boostersItemsMargin:15},bg:{image:bundles.tile_shop.frames.shopusergold_bg_png,dx:-20,padding:{x:60,y:25}},person:{json:bundles.tile_shop.jsons.yellow_money_spine_json,scale:.85,width:250,height:250,dy:-10},
items:{margin:5,gold:{res:bundles.reward_icons.frames.gold_small_png,scale:.75,blockDy:0,dy:5},boosters:{res:[bundles.reward_icons.frames.cellbooster_small,bundles.reward_icons.frames.linebooster_small,bundles.reward_icons.frames.colorbooster_small],scale:1,dy:5},boostersBefore:{itemsMargin:15,scale:.45}}};var ShopWindow=Window.extend({ctor:function(e){if(this.options=e=e||{},this.tab=e.tab,this.tab===ShopWindow.TABS.HARD_CURRENCY&&cleverapps.flags.nopayments&&(!RewardedAdsManager.IsEnabled()||cleverapps.flags.almostNoAds))return!1;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TILE_SHOP_OPEN+this.tab),this._super.apply(this,arguments)},customize:function(){if(this._super(),!ShopUserGoldView.IsAvailable()||this.showAll&&this.isVertical()||(this.goldInfo=new ShopUserGoldView(cleverapps.styles.ShopWindow.ShopUserGoldView)),bundles.tile_shop.frames.shop_bg_png){var e=new cc.Scale9Sprite(bundles.tile_shop.frames.shop_bg_png);e.setContentSize2(this.getContentSize()),this.addChild(e),
e.setLocalZOrder(-1),e.setOpacity(180),e.setPositionRound(this.width/2,this.height/2)}Lottery.addText(this)},onWindowLoaded:function(e){this.showAll=this.options.showAll;var t=cleverapps.styles.ShopWindow;if(this._super({notCloseByTouchInShadow:!0,name:"shopwindow_tab"+this.tab,content:this.createContent(this.tab),title:this.getTitle(),noBackground:t.noBackground,styles:t}),this.tab===ShopWindow.TABS.LIVES&&t.Title.livesOffsetY&&(this.window.titleText.y+=t.Title.livesOffsetY,this.titleBg&&(this.titleBg.y+=t.Title.livesOffsetY)),t.repeatablePattern){var s=new RepeatablePattern(this.width,t.repeatablePattern.image);this.addChild(s),s.setLocalZOrder(-1)}cleverapps.eventBus.on("changeSceneSize",this.onChangeSceneSizeShopWindow.bind(this),this),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getTitle:function(){if(!this.showAll||!this.isVertical())return{text:"messages:ShopWindow.title",font:cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TITLE_TEXT}},onHide:function(){
this.goldInfo&&this.goldInfo.onHide(),this.hidden=!0},buyProduct:function(e){this.closingNow||this.hidden||e.buy(this.close.bind(this,!0))},expandShop:function(){this.closingNow||(new ShopWindow({showAll:!0,tab:ShopWindow.TABS.HARD_CURRENCY}),this.close())},isVertical:function(){return cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&"merge"!==cleverapps.config.type},adjustShopWindow:function(){this.content.scale=this.content.baseScale;var e=cleverapps.styles.ShopWindow;!this.isVertical()&&this.showAll||this.content.setScale(Math.min(this.content.scale,cc.director.getWinSize().width/(this.content.width+2*e.wrap.paddingX))),this.isVertical()&&this.showAll||this.content.setScale(Math.min(this.content.scale,cc.director.getWinSize().height/(this.content.height+2*e.wrap.paddingY)));var t=0;this.isVertical()||(t=e.wrap.offsetX),this.contentWrap.setContentSize2(this.content.width*this.content.scale+t,this.content.height*this.content.scale),this.content.setPositionRound(
this.contentWrap.width/2,this.contentWrap.height/2),cleverapps.styles.ShopWindow.contentOffset<0&&(this.contentWrap.height-=cleverapps.styles.ShopWindow.contentOffset,this.content.y-=cleverapps.styles.ShopWindow.contentOffset)},onChangeSceneSizeShopWindow:function(){this.adjustShopWindow(),this.scroll.setContentSize2(cc.director.getWinSize()),this.scroll.setPositionRound(this.contentWrap.width/2,this.contentWrap.height/2),this.scrollWrap.setContentSize2(this.contentWrap.getContentSize())},createContent:function(e){var t=this.isVertical()?TileLayout.Layouts.vertical:TileLayout.Layouts.horizontal,s=(this.showAll?t.expanded:t.compact).map(function(e){return new TileLayout(e)}),i=ShopProductSource.listTileModels(e),n=i.tileModels,o=i.optional,r=this.buyProduct.bind(this),a=this.expandShop.bind(this),c=LayoutAdjuster.createTiles(n,r,a);this.shopLayout=LayoutAdjuster.ChooseLayout(c,s,o);var l=this.content=this.shopLayout.positionTiles();l.baseScale=l.scale;var p=this.contentWrap=new cc.Node
;p.setAnchorPoint2(),p.addChild(l),this.adjustShopWindow();var d=this.scroll=new cleverapps.UI.ScrollView(p,{direction:this.isVertical()?cleverapps.UI.ScrollView.DIR_VERTICAL:cleverapps.UI.ScrollView.DIR_HORIZONTAL,clipping:!1});d.setContentSize2(cc.director.getWinSize()),this.shopLayout.scrollToBadge(this.scroll);var h=this.scrollWrap=new cc.Node;return h.setAnchorPoint2(),h.setContentSize2(Math.min(d.width,p.width),p.height),h.addChild(d),d.setPositionRound({align:"center"},{align:"center"}),h},onShow:function(e){this.goldInfo&&this.goldInfo.showUp(),this.hidden=void 0,this.shopLayout.onShow(e)},onClose:function(){cleverapps.windows.isActive()||(this.tab===ShopWindow.TABS.LIVES&&cleverapps.lives&&cleverapps.lives.isEmpty()?HelpFromFriendsWindow.showIfCan(HelpFromFriendsWindow.TYPES.addlivesvideo,function(e,t){cleverapps.lives.give(t.amount)}.bind(this)):this.tab===ShopWindow.TABS.HARD_CURRENCY&&levels.user.gold<100&&HelpFromFriendsWindow.showIfCan(
HelpFromFriendsWindow.TYPES.addcoinsvideo,function(e,t){levels.user.setGold(levels.user.gold+t.amount)}.bind(this))),this.tab===ShopWindow.TABS.LIVES&&cleverapps.lives&&!cleverapps.lives.canTake(.1*cleverapps.Lives.MAX_REGEN_AMOUNT)&&(cleverapps.lives.needShowSpecialOffer=!0)},close:function(e){if(!this.closingNow){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),this.goldInfo&&this.goldInfo.close(),this.closingNow=!0;var t=this._super;if(!0===e)t.call(this);else{var s=cleverapps.styles.ShopWindow;if(this.closeButton instanceof BandButton&&this.closeButton.hide(),this.scrollBarBG&&this.scrollBarBG.runAction(new cc.FadeOut(.3)),this.window.titleText&&s.noBackground){var i=cc.p(this.window.titleText.x,cc.director.getWinSize().height+this.window.titleText.height/2),n=cc.p(this.window.titleText.x,this.window.titleText.y-s.title.hideAnimation.moveDownY);this.window.titleText.runAction(new cc.Sequence(new cc.MoveTo(.15,n),new cc.MoveTo(.3,i).easing(cc.easeIn(1)))),
this.titleBg&&this.titleBg.runAction(new cc.Sequence(new cc.MoveTo(.15,n),new cc.MoveTo(.3,i).easing(cc.easeIn(1))))}this.shopLayout.onClose(t.bind(this))}}}}),LivesShopWindow=ShopWindow.extend({ctor:function(){this._super({tab:ShopWindow.TABS.LIVES})}}),SoftCurrencyShopWindow=ShopWindow.extend({ctor:function(){this._super({tab:ShopWindow.TABS.SOFT_CURRENCY})}}),HardCurrencyShopWindow=ShopWindow.extend({ctor:function(){this._super({tab:ShopWindow.TABS.HARD_CURRENCY})}});ShopWindow.prototype.listBundles=function(){return["tile_shop"]},ShopWindow.TABS={HARD_CURRENCY:0,LIVES:1,SOFT_CURRENCY:2},cleverapps.styles.ShopWindow=cleverapps.overrideStyles(cleverapps.styles.Window,{noWindowScale:!0,noBackground:!0,contentOffset:-30,contentPadding:30,scroll:{delay:0,offset:{y:-50}},scrollBarBG:{height:24,paddingX:20,y:20},wrap:{paddingX:30,paddingY:110,offsetX:100},title:{hideAnimation:{moveDownY:30}},Title:{offsetY:-20},rowMargin:30,tileMargin:30,rowsPadding:{x:0,y:50},mouseScrollSpeed:400},!0),
cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{TILE_SHOP_BADGE_STROKE:{color:new cc.Color(100,34,22,255),size:2},TILE_BUTTON_SHADOW:{color:new cc.Color(8,82,40,180),direction:cc.size(0,-5),blur:1},TILE_SHOP_SHADOW:{color:new cc.Color(100,34,22,200),direction:cc.size(0,-3),blur:1},TILE_SHOP_STROKE:{color:new cc.Color(100,34,22,255),size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_BADGE_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_SHADOW,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE},SHOP_SMALL_TILE_BUTTON_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_BUTTON_SHADOW},SHOP_LARGE_TILE_BUTTON_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_BUTTON_SHADOW},TILE_SHOP_WINDOW_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.TILE_SHOP_SHADOW,
stroke:cleverapps.styles.DECORATORS.TILE_SHOP_STROKE},TILE_SHOP_WINDOW_TITLE_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,stroke:{color:new cc.color(85,1,91),size:3},shadow:{color:new cc.color(85,1,91),direction:cc.size(0,-5),blur:1}}});var TileBadge=cc.Sprite.extend({ctor:function(e,t){var s=t?cleverapps.styles.SmallTileBadge:cleverapps.styles.LargeTileBadge,i={bestSeller:{image:bundles.tile_shop.frames.shop_badge_bestseller_png,text:"messages:Badge.bestSeller"},save:{image:bundles.tile_shop.frames.shop_badge_save_png||bundles.tile_shop.frames.shop_badge_bestseller_png,text:"messages:Badge.save"}};if(e=this.options="string"==typeof e?i[e]:e,this._super(e.image),this.setPositionRound(e.x||s.x,e.y||s.y),this.setLocalZOrder(2),t&&s.scale&&this.setScale(s.scale),this.baseScale=this.getScale(),e.text&&e.amount){var n=new cleverapps.Layout([cleverapps.UI.generateOnlyText(e.text,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT),cleverapps.UI.generateOnlyText(e.amount,
cleverapps.styles.FONTS.TILE_SHOP_BADGE_AMOUNT_TEXT)],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding});cleverapps.UI.fitToBox(n,{width:this.width,height:this.height}),n.setAnchorPoint2(),n.setPositionRound(this.width/2,this.height/2),this.addChild(n)}else e.text&&((n=cleverapps.UI.generateOnlyText(e.text,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT)).setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.fitTo(s.text.width),n.setRotation(s.text.rotation),this.addChild(n),n.setPositionRound(this.width/2+s.text.x,this.height/2+s.text.y))},enable:function(){this.setSpriteFrame(this.options.image)},disable:function(){this.setSpriteFrame(this.options.imageOff||this.options.image)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_BADGE_TEXT:{size:25,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE},TILE_SHOP_BADGE_AMOUNT_TEXT:{size:34,color:cleverapps.styles.COLORS.WHITE,
stroke:cleverapps.styles.DECORATORS.TILE_SHOP_BADGE_STROKE}}),cleverapps.styles.SmallTileBadge={x:{align:"right",dx:30},y:{align:"top",dy:-10},text:{rotation:30,width:125,x:5,y:10}},cleverapps.styles.LargeTileBadge={x:{align:"left",dx:-30},y:{align:"top",dy:30},text:{rotation:-30,width:125,x:0,y:5}};var TileButton=cc.Node.extend({ctor:function(e,t,s){this._super(),this.forceTarget=!0,this.small=t;var i=this.small?cleverapps.styles.SmallTileButton:cleverapps.styles.LargeTileButton;this.buttonWidth=s.width||i.width;var n=this.button=new cleverapps.UI.Button({content:this.getButtonContent(e,s),contentOff:this.getButtonContent(e,s,!0),contentPadding:i.contentPadding,contentOffset:i.contentOffset,scale9Rect:s.scale9Rect,width:this.buttonWidth,height:s.height||i.height,button_png:s.button_png||(t?bundles.tile_shop.frames.small_shop_button:bundles.tile_shop.frames.feature_button_png),button_on_png:s.button_on_png||(
t?bundles.tile_shop.frames.small_shop_button_on:bundles.tile_shop.frames.feature_button_on_png),button_off_png:s.button_off_png||(t?bundles.tile_shop.frames.small_shop_button_off:bundles.tile_shop.frames.feature_button_off_png),onClicked:s.onClicked.bind(s,e)});e.constructor===TileModel&&Lottery.addIcon(n,void 0,"gold25000"===e.product.itemId),this.setAnchorPoint2(),this.setContentSize2(n.getContentSize()),this.addChild(n),n.setPositionRound(i)},getButtonContent:function(e,t,s){var i,n=this.small?cleverapps.styles.SmallTileButton:cleverapps.styles.LargeTileButton,o=this.buttonWidth+n.text.padding,r=!s&&0===e.getCurrentPrice();return s?i=e.getDisabledPrice():r&&(i="messages:FREE"),new ProductPriceView(e,{font:t.font||(this.small?cleverapps.styles.FONTS.SHOP_SMALL_TILE_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT:cleverapps.styles.FONTS.SHOP_LARGE_TILE_BUTTON_TEXT),fitTo:{width:o},text:i,icon:!r&&!s&&e.getPriceIcon(),iconScale:!r&&!s&&e.getPriceIcon()&&(t.scale||n.icon.scale)})},
enable:function(){this.button.enable()},disable:function(){this.button.disable()}});cleverapps.styles.SmallTileButton={x:{align:"center"},y:{align:"center"},margin:10,width:205,height:70,text:{padding:-25,dy:-6},icon:{scale:.8,dy:0}},cleverapps.styles.LargeTileButton={x:{align:"center"},y:{align:"center",dy:-5},margin:10,width:320,height:110,text:{padding:-25,dy:-6},icon:{scale:.8,dy:0}};var TileIcon=cc.Node.extend({ctor:function(e,t,s,i){this._super();var n=t?cleverapps.styles.SmallTileIcon:cleverapps.styles.LargeTileIcon;this.tileModel=e;var o=this.icon=new cc.Sprite(bundles.tile_shop.frames[e.getIcon()]);if(!i)if(n.scale)o.setScale(n.scale);else if(n.height){var r=n.height/o.height;r<1&&o.setScale(r)}var a=t?{json:bundles.tile_shop.jsons.shop_sparkles_small_json}:{json:bundles.tile_shop.jsons.shop_sparkles_large_json};if(s&&(a=s),a.json){var c=new cleverapps.Spine(a.json);c.setPosition(o.width/2,o.height/2),o.addChild(c),c.visible=!1;var l=void 0!==a.delay?a.delay:Math.random()
;o.runAction(new cc.Sequence(new cc.DelayTime(l),new cc.CallFunc(function(){c.visible=!0,c.setAnimation(0,"animation",!0)})))}var p=n[e.product.itemId]?n[e.product.itemId].wrap.dx||0:n.wrap.dx,d=n[e.product.itemId]?n[e.product.itemId].wrap.dy||0:n.wrap.dy;this.setContentSize2(o.width,n.wrap.height),this.setAnchorPoint2(),o.setAnchorPoint2(.5,0),o.setPositionRound(this.width/2+p,d),this.addChild(o)},enable:function(){this.icon.setSpriteFrame(bundles.tile_shop.frames[this.tileModel.getIcon()])},disable:function(){this.icon.setSpriteFrame(bundles.tile_shop.frames[this.tileModel.getIcon()+"_off"]||bundles.tile_shop.frames[this.tileModel.getIcon()])}});cleverapps.styles.SmallTileIcon={height:120,wrap:{height:110,dx:0,dy:0}},cleverapps.styles.LargeTileIcon={scale:1,wrap:{height:270,dx:0,dy:-24}};var TileRewardsBlock=function(e,t,s){s=s||{};var i=t?cleverapps.styles.SmallTileRewardsBlock:cleverapps.styles.LargeTileRewardsBlock,n=[],o=[],
r="tripeaks"===cleverapps.config.name||"scramble"===cleverapps.config.name,a=t?cleverapps.styles.FONTS.TILE_SHOP_OFFER_TEXT_SMALL:cleverapps.styles.FONTS.TILE_SHOP_OFFER_TEXT_LARGE,c=e.getReward();for(var l in c)if("boosters"===l)for(var p in c.boosters){if(0!==(g=c.boosters[p])){var d=cleverapps.UI.generateImageText("x"+g,a),h=new cleverapps.Layout([new cc.Sprite(i.boosterIcons[p]),d],{direction:cleverapps.UI.HORIZONTAL,margin:i.amountMargin});h.amount=d,o.push(h),n.push(h)}}else{var u=new cc.Sprite(i[l].icon);u.setScale(i[l].scale);var g=cleverapps.UI.generateImageText(c[l],r&&!t?cleverapps.styles.FONTS.TILE_SHOP_HIGHLIGHTED_IMAGE_TEXT:a),v=new cleverapps.Layout(i.reverse?[g,u]:[u,g],{direction:cleverapps.UI.HORIZONTAL,margin:i.amountMargin});v.amount=g,i[l].offsetY&&v.setPositionY(i[l].offsetY),i.iconOffsetY&&(u.y+=i.iconOffsetY),n.push(v)}for(var m=[];0<n.length;){var f=2;(0===m.length&&o.length<=2&&n.length-o.length<2||r)&&(r=!(f=1));var _=n.splice(0,f),y=new cleverapps.Layout(_,{
direction:cleverapps.UI.HORIZONTAL,margin:i.colMargin});m.unshift(y)}var w=new cleverapps.Layout(m,{direction:cleverapps.UI.VERTICAL,margin:i.rowMargin,y:i.offsetY}),T=new cc.Node;T.setAnchorPoint2(),i.noBg||s.noBg||(T=new cc.Scale9Sprite(t?bundles.tile_shop.frames.tile_stripe_png:bundles.tile_shop.frames.tile_best_stripe_png)),T.setContentSize2(i),T.setLocalZOrder(i.zOrder),T.addChild(w),w.setPositionRound(T.width/2,T.height/2);var S=i.height/w.height;return S<1&&2<m.length&&w.setScale(.85*S),T};cleverapps.overrideFonts(cleverapps.styles.FONTS,{TILE_SHOP_OFFER_TEXT_LARGE:{name:"default",size:33,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},TILE_SHOP_OFFER_TEXT_SMALL:{name:"default",size:37,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT}}),cleverapps.styles.SmallTileRewardsBlock={rowMargin:10,colMargin:10,width:210,height:80,amountMargin:5,offsetY:0,zOrder:0,gold:{icon:bundles.reward_icons.frames.gold_small_png,scale:1},unlimitedLives:{scale:.5},stars:{scale:.4}},
cleverapps.styles.LargeTileRewardsBlock={width:486,height:162,rowMargin:10,colMargin:10,amountMargin:5,offsetY:35,zOrder:0,gold:{icon:bundles.reward_icons.frames.gold_small_png,scale:1},coins:{icon:bundles.reward_icons.frames.shop_coin_png,scale:1},unlimitedLives:{scale:.5},stars:{scale:.4}};var MoreTile=cc.Node.extend({ctor:function(e){if(this._super(),this.setAnchorPoint2(),bundles.tile_shop.frames.more_button_png){var t=this.createTile(e);this.addChild(t),this.setContentSize2(t.width,t.height),t.setPositionRound(this.width/2,this.height/2)}},createTile:function(e){var t=cleverapps.styles.MoreTile,s=cleverapps.UI.generateOnlyText("messages:ShopWindow.showMore",cleverapps.styles.FONTS.TILE_SHOP_WINDOW_TEXT);s.setDimensions(t.text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.fitTo(void 0,t.text.height);var i=new cc.Sprite(bundles.tile_shop.frames.more_button_png);cleverapps.UI.applyHover(i);var n=new cleverapps.Layout([i,s],{direction:cleverapps.UI.VERTICAL,
margin:t.margin}),o=new cc.Scale9Sprite(bundles.tile_shop.frames.shop_tile_bg_png);return o.setContentSize2(t),o.addChild(n),n.setPositionRound(o.width/2,o.height/2+t.offset.y),o.setScale(t.scale[cleverapps.wideMode.mode]),t.stitches&&new StitchesComponent(o,t.stitches),cleverapps.UI.onClick(o,e.onClicked,{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0}),o}});cleverapps.styles.MoreTile={offset:{y:0},text:{width:150,height:200},scale:[1,1,1],width:240,height:350,margin:20};var LotteryIcon=cc.Sprite.extend({ctor:function(e,t,s){this._super();var i,n=this.styles=cleverapps.styles.LotteryIcon,o=cleverapps.eventManager.getFeatureEvent("lottery"),r=-1!==["mobile_ok","web_ok"].indexOf(cleverapps.User.calcSource())&&!1!==o.options.okLottery,a=r&&o.options.lottery10k&&s,c=-1!==["mobile_vk","web_vk"].indexOf(cleverapps.User.calcSource())&&o.options.vkSaleDay;r?n=cleverapps.overrideStyles(n,cleverapps.styles.OkLotteryIcon,!0):c&&(n=this.styles=cleverapps.overrideStyles(n,
cleverapps.styles.VkLotteryIcon,!0)),c?(i=bundles.lottery.frames.vk_lottery,n=cleverapps.overrideStyles(n,cleverapps.styles.VkLotteryIcon,!0)):r?(i=a?bundles.lottery.frames.ok_lottery_10k:bundles.lottery.frames.ok_lottery,n=cleverapps.overrideStyles(n,cleverapps.styles.OkLotteryIcon,!0)):i=bundles.lottery.frames["lottery_"+cleverapps.settings.language]||bundles.lottery.frames.lottery_en,this._super(i),e.addChild(this),t=t||"bottom",this.setScale(n.positions[t].scale||n.scale||1),this.baseScale=this.scale,this.setPositionRound(n.positions[t]),n.positions[t].preserveX&&(this.preservedX=this.x)}});cleverapps.styles.VkLotteryIcon={positions:{icon:{x:{align:"center",dx:-65},y:{align:"bottom",dy:-40},preserveX:!0},subscription:{x:{align:"left",dx:-10},y:{align:"bottom",dy:-40}}}},cleverapps.styles.OkLotteryIcon={},cleverapps.styles.LotteryIcon={positions:{bottom:{x:{align:"center",dx:0},y:{align:"bottom",dy:-70}},top:{x:{align:"center",dx:0},y:{align:"top",dy:55}},icon:{x:{align:"center",
dx:0},y:{align:"bottom",dy:-20}},icon_top:{x:{align:"center",dx:0},y:{align:"top",dy:0}},subscription:{x:{align:"right",dx:45},y:{align:"top",dy:40}},bottom_right:{x:{align:"right",dx:30},y:{align:"bottom",dy:-70}}}};var Lottery={isActive:function(){return cleverapps.eventManager.isActive("lottery")&&!cleverapps.flags.nopayments},addIcon:function(e,t,s){this.isActive()&&(e.lotteryIcon=new LotteryIcon(e,t,s)).runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(3),new cc.RotateTo(.2,10),new cc.RotateTo(.2,-10),new cc.RotateTo(.2,10),new cc.RotateTo(.2,-10),new cc.RotateTo(.2,0))))},addText:function(e){if(this.isActive()){var t=cleverapps.styles.Lottery,s="messages:Lottery.info",i=cleverapps.eventManager.getFeatureEvent("lottery");-1!==["mobile_vk","web_vk"].indexOf(cleverapps.User.calcSource())&&i.options.vkSaleDay&&(s="messages:Lottery.infoSaleDay");var n=cleverapps.UI.generateTTFText(s,t.text.font);e.addChild(n),n.setPositionRound(t.text),n.fitTo(e.width)}}}
;cleverapps.styles.Lottery={text:{font:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,x:{align:"center"},y:{align:"bottom",dy:5}}};var ShopProductSource={listTileModels:function(t){var e,s=ShopProductSource.ITEMS[t],i=cleverapps.paymentsHistory.classify();t===ShopWindow.TABS.HARD_CURRENCY&&i>cleverapps.PaymentsHistory.PAYER_WEAK&&(s=ShopProductSource.ITEMS.CoinsPayer);var n=(s=s.filter(function(e){return t!==ShopWindow.TABS.HARD_CURRENCY||cleverapps.config.products[e]})).map(function(e){return TileModel.Create(Product.Create(e))}).filter(function(e){return e.isEnabled()});if(t===ShopWindow.TABS.HARD_CURRENCY){var o=0;for(n.forEach(function(e){e.getPrice&&e.getPrice()>o&&(o=e.getPrice())}),e=0;e<n.length;e++)if(n[e].getPrice()===o){n[e].badge="save";break}}var r=ShopProductSource.ITEMS.bestSellersByPayerClass[i];for(e=0;e<n.length;e++)if(-1!==r.indexOf(n[e].getItemId())){n[e].badge="bestSeller";break}var a=[];return t===ShopWindow.TABS.HARD_CURRENCY&&(
a=ShopProductSource.ITEMS.optionalByPayerClass[i]),{tileModels:n,optional:a}},ITEMS:{CoinsPayer:["jamPack","tastyPack","honeyPack","epicPack","gold500","gold1800","gold3800","gold6000","gold25000"],optionalByPayerClass:[["gold25000","honeyPack","gold6000","tastyPack","gold3800"],["gold25000","honeyPack","gold6000","sweetPack","gold500"],["gold500","epicPack","gold25000","jamPack","gold1800"],["gold500","jamPack","tastyPack","gold1800","gold3800"],["gold500","jamPack","tastyPack","gold1800","gold3800"]],bestSellersByPayerClass:[["sweetPack","gold500"],["jamPack","gold1800"],["tastyPack","gold3800"],["honeyPack","gold6000"],["honeyPack","gold25000"]]}};ShopProductSource.ITEMS[ShopWindow.TABS.HARD_CURRENCY]=["sweetPack","jamPack","tastyPack","honeyPack","gold500","gold1800","gold3800","gold6000","gold25000"],ShopProductSource.ITEMS[ShopWindow.TABS.LIVES]=["refillLives","unlimitedLives","askLives"],ShopProductSource.ITEMS[ShopWindow.TABS.SOFT_CURRENCY]=["softCurrencySmall",
"softCurrencyMedium","softCurrencyLarge"],"merge"===cleverapps.config.type&&(ShopProductSource.ITEMS[ShopWindow.TABS.LIVES]=["energyLottery","buyEnergy350","buyEnergy700","buyEnergy","energyForVideo","energyForVideoShort"]);var LayoutAdjuster={ChooseLayout:function(t,e,s){for(var i=[],n=!1;!(0<(i=e.filter(function(e){return e.isEnough(t)})).length);)if(n=!0,!this.trimOptional(t.large,t.large.length-1,s)){cleverapps.throwAsync("select layout error - large tiles");break}if(0===i.length)throw"select layout error";return n&&t.small.push(t.more),this.trimOptional(t.small,i[0].countOfSmallTiles,s),t.small.length>i[0].countOfSmallTiles&&(console.log(i[0].map),console.log("small",t.small),cleverapps.throwAsync("select layout error - small tiles")),i[0].setTiles(t),i[0]},createTiles:function(e,s,t){var i=e.map(function(e){var t=new(e.getViewClassName())(e,{onClicked:s});return"horizontal"===cleverapps.config.orientation&&cc.sys.isMobile&&(t.setScale(1.4),t.baseScale=1.4),t});return{
small:i.filter(function(e){return e.isSmall()}),large:i.filter(function(e){return!e.isSmall()}),more:new MoreTile({onClicked:t})}},trimOptional:function(e,t,s){for(var i=!1,n=0;n<s.length&&e.length>t;n++)for(var o=0;o<e.length;o++)if(e[o].tileModel&&e[o].tileModel.product.itemId===s[n]){e.splice(o,1),i=!0;break}return i}},TileLayout=function(e){this.largeTiles=0,this.amountInRowForLarge=0,this.amountInRightColumn=0,this.amountOfRightColumns=0,this.amountInBottomRow=0,this.amountOfBottomRows=0,this.countOfSmallTiles=0,(this.map=e).forEach(function(e){for(var t=0,s=0;s<e.length;s++){var i=e[s];if("x"===i)t++;else{var n=i.charCodeAt()-"A".charCodeAt();n+1>this.largeTiles&&(this.largeTiles=n+1)}}"x"===e[0]?(this.amountOfBottomRows++,this.amountInBottomRow=e.length):(this.amountInRowForLarge=e.length-t,0<t&&this.amountInRightColumn++,this.amountOfRightColumns=t),this.countOfSmallTiles+=t},this)};TileLayout.prototype.isEnough=function(e){return this.largeTiles===e.large.length},
TileLayout.prototype.setTiles=function(e){this.tiles=e.large.concat(e.small),this.tileSet=e},TileLayout.prototype.onShow=function(e){for(var t=(e=e||0)+.075*Math.ceil(.5*(this.tiles.length-1))+.5,s=this.tiles.length-1;0<=s;s--){var i=e+.075*Math.ceil(.5*s),n=this.tiles[s].tileBadge;n&&(n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.PlaySound(bundles.tile_shop.urls.badge_appear_effect),new cc.ScaleTo(.4,n.baseScale).easing(cc.easeBackOut())))),this.tiles[s].setVisible(!1),this.tiles[s].runAction(new cc.Sequence(new cc.ScaleTo(0,0),new cc.Show,new cc.DelayTime(i),new cc.ScaleTo(.4,this.tiles[s].scale).easing(cc.easeBackOut())))}},TileLayout.prototype.onClose=function(e){for(var t=cleverapps.wait(this.tiles.length,e),s=this.tiles.length-1;0<=s;s--)this.tiles[s].runAction(new cc.Sequence(new cc.DelayTime(.075*Math.ceil(.5*s)),new cc.ScaleTo(.3,0).easing(cc.easeBackIn()),new cc.CallFunc(t.bind(this,s))))},TileLayout.prototype.scrollToBadge=function(e){
var t=this.tiles.filter(function(e){return!(e instanceof MoreTile)&&e.tileModel.badge})[0];t&&e.scrollTo(t)},TileLayout.prototype.positionTiles=function(){for(var e=cleverapps.styles.ShopWindow,t=[],s=Math.ceil(this.tileSet.small.length/this.amountInRightColumn),i=Math.min(s,this.amountOfRightColumns),n=this.tileSet.small.splice(0,i*this.amountInRightColumn),o=0;o<i;o++){for(var r=[],a=0;a<this.amountInRightColumn;a++)r.push(n[o+a*i]);t.push(new cleverapps.Layout(r,{direction:cleverapps.UI.TOP_TO_BOTTOM,margin:e.tileMargin}))}var c=[],l=this.tileSet.large.length/this.amountInRowForLarge;for(o=0;o<l;o++){var p=this.tileSet.large.splice(0,this.amountInRowForLarge);0===o&&0<t.length&&(p=p.concat(t)),c.push(new cleverapps.Layout(p,{direction:cleverapps.UI.HORIZONTAL,margin:e.tileMargin}))}var d=[];for(o=0;o<this.amountOfBottomRows;o++){r=this.tileSet.small.splice(0,this.amountInBottomRow);d.push(new cleverapps.Layout(r,{direction:cleverapps.UI.HORIZONTAL,margin:e.tileMargin}))}
var h=c.concat(d);return new cleverapps.Layout(h,{direction:cleverapps.UI.TOP_TO_BOTTOM,margin:e.rowMargin,padding:e.rowsPadding})},TileLayout.Layouts={vertical:{compact:[["xx","xx"],["Ax","Ax","xx"],["AB","AB","xxx"]],expanded:[["AB","AB","CD","CD","xx","xx"]]},horizontal:{compact:[["xx","xx"],["Axx","Axx"],["ABxx","ABxx"]],expanded:[["ABCDxx","ABCDxx"]]}},"merge"===cleverapps.config.type&&TileLayout.Layouts.horizontal.compact.push(["ABCx","ABCx"],["ABCD","ABCD"],["ABCDE","ABCDE"],["ABCDEF","ABCDEF"]);var Tabs=cleverapps.Layout.extend({ctor:function(s,i){this.buttons={};var e=cleverapps.styles.Tabs,t=Object.keys(s).map(function(e,t){return this.createButton(e,s[e],-(t+1),i)},this);this._super(t,{direction:void 0===i.direction?e.direction:i.direction,margin:void 0===i.margin?e.margin:i.margin,attention:i.attention})},createButton:function(e,t,s,i){var n,o=cleverapps.styles.Tabs.buttons,r=i.width||o.width,a=i.height||o.height;t.text&&(
i.direction===cleverapps.UI.HORIZONTAL?n=cleverapps.UI.generateOnlyText(t.text,t.font||cleverapps.styles.FONTS.TABS_TEXT):(n=cleverapps.UI.generateOnlyText(Messages.get(t.text).split("").join("\n"),t.font||cleverapps.styles.FONTS.TABS_TEXT)).fitTo(.9*r,.9*a)),t.icon&&(n=new cc.Sprite(t.icon)).setScale(t.scale||1);var c=this.buttons[e]=new cleverapps.UI.Button({button_png:bundles.main.frames.shop_tab_off,button_on_png:bundles.main.frames.shop_tab_off,button_off_png:bundles.main.frames.shop_tab_on,scale9Rect:i.scale9Rect,width:r,height:a,content:n,click_effect:bundles.main.urls.tab_click_effect,mirrorX:t.mirrorX,onClicked:this.activateTab.bind(this,e),useInteractiveScale:!0});return c.selectedScale=1.03,c.baseZOrder=s,c.info=t,c.setLocalZOrder(s),n.setPositionRound(o),c},getActive:function(){return this.selectedId},activateTab:function(t,s){t=t.toString(),this.selectedId!==t&&Object.keys(this.buttons).forEach(function(e){e===t?this.onSelectTab(e,s):this.onUnSelectTab(e)},this)},
listIds:function(){return Object.keys(this.buttons)},onSelectTab:function(e,t){var s=this.buttons[e],i=s.info;s.disable(),s.setLocalZOrder(1),s.selected=!0,s.applyInteractiveScale(),i.updateTitle&&i.updateTitle(),i.text&&s.content.setColor(cleverapps.styles.COLORS.TAB_TEXT_COLOR),i.icon&&s.content.setOpacity(255),void 0===i.content&&(i.content=i.generator()),i.content.setVisible(!0),i.content.onSelectTab&&i.content.onSelectTab(t),this.selectedId=e},onUnSelectTab:function(e){var t=this.buttons[e],s=t.info;t.enable(),t.setLocalZOrder(t.baseZOrder),t.selected=!1,t.applyInteractiveScale(),s.text&&t.content.setColor(cleverapps.styles.COLORS.DISABLED_TAB_TEXT_COLOR),s.icon&&t.content.setOpacity(127),void 0!==s.content&&(s.content.setVisible(!1),s.content.stopAllActions(),s.content.onUnSelectTab&&s.content.onUnSelectTab())},setAttention:function(e,t){var s=cleverapps.styles.Tabs.attention,i=this.buttons[e];i.attention&&(i.attention.removeFromParent(),delete i.attention),t&&(
i.attention=new cc.Sprite(bundles.windows.frames.tab_attention),i.attention.setAnchorPoint2(),i.attention.setPositionRound(this.options.attention||s),i.addChild(i.attention),i.attention.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1)))))}});cleverapps.overrideColors(cleverapps.styles.COLORS,{TAB_TEXT_COLOR:new cc.Color(255,255,255,255),DISABLED_TAB_TEXT_COLOR:new cc.Color(200,200,200,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{TABS_TEXT:{size:40}}),cleverapps.styles.Tabs={margin:0,direction:cleverapps.UI.HORIZONTAL,buttons:{x:{align:"center",dx:0},y:{align:"center",dy:0}},attention:{x:0,y:0}};var Buttons=cc.Node.extend({ctor:function(e){this._super(),0!==(e=Buttons.filter(e)).length&&(this.buttons={},e.forEach(function(e){this.buttons[e.__instanceId]=e,this.addChild(e)},this),this.arrange())},onEnterTransitionDidFinish:function(){this._super(),this.arrange()},arrange:function(){var e=cleverapps.styles.Buttons,t=e.margin.x,s=0;if(
1<this.children.length&&this.parent){var i=this.parent.width-2*e.padding.x,n=0;this.children.forEach(function(e){n+=e.width,s=Math.max(s,e.height/2)});var o=Math.round((i-n)/(this.children.length-1));t=Math.max(t,o)}this.margin=t,cleverapps.UI.arrangeWithMargins(this.children,{direction:cleverapps.UI.HORIZONTAL,margin:t,y:s}),cleverapps.UI.wrap(this),this.setAnchorPoint2()},add:function(e){0!==Buttons.filter([e]).length&&(this.buttons[e.__instanceId]=e,this.addChild(e),this.arrange())},remove:function(t){cleverapps.styles.Buttons;(t=this.buttons[t.__instanceId])&&(t.stopAllActions(),t.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf)),this.children.forEach(function(e){e.x>t.x&&(e.stopAllActions(),e.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveBy(.3,-t.width-this.margin,0))))}),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveBy(.3,(t.width+this.margin)/2,0))))},onShow:function(){this.children.forEach(function(e){
e.stopAllActions();var t=e.scale;e.setScale(0),e.runAction(new cc.ScaleTo(.7,t).easing(new cc.easeBackOut))})}});Buttons.filter=function(e){return e.filter(function(e){return e&&e.onMouseOver})},Buttons.choose=function(e){if(0!==(e=Buttons.filter(e)).length)return e[Math.floor(Math.random()*e.length)]},Buttons.remove=function(e){if(e.parent instanceof Buttons&&e.parent.buttons[e.__instanceId]){var t=e.parent;1<t.children.length&&t.remove(e)}else e.removeFromParent()},cleverapps.styles.Buttons={margin:{x:20},padding:{x:70}};var RewardBuyButton=cleverapps.UI.Button.extend({ctor:function(e){var t=e.type,s=e.game,i=e.config,n=e.window,o=parseInt(i);-1!==i.indexOf("x2")?o="x2":-1!==i.indexOf("x3")&&(o="x3");var r=this.type=-1!==i.indexOf(RewardBuyButton.VIDEO)?RewardBuyButton.VIDEO:RewardBuyButton.COINS,a=RewardBuyButton.VIDEO===r,c="";r===RewardBuyButton.COINS&&(c=this.price=parseInt(i.substr(i.indexOf(RewardBuyButton.COINS)+RewardBuyButton.COINS.length)));var l=o;"x2"===o&&(l=s.rewards[t]
),"x3"===o&&(l=2*s.rewards[t]);var p=cleverapps.styles.RewardBuyButton,d=o;"number"==typeof o&&(d="+"+o);var h=[];if(d){var u=this.text=cleverapps.UI.generateImageText(d,cleverapps.styles.FONTS.GAME_REWARD_BUTTON_TEXT);h.push(u)}var g=new cc.Sprite(a?bundles.shared.frames.adicon_png:bundles.menubar.frames.coin_png);if(g.setScale(p.icon.scale),h.push(g),c){var v=cleverapps.UI.generateImageText(c,cleverapps.styles.FONTS.GAME_REWARD_BUTTON_TEXT);h.push(v)}var m=new cleverapps.Layout(h,{direction:p.direction,margin:p.margin});g.y+=p.icon.offsetY;var f=this.createListener(function(){s.rewards[t]+=l,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_BUY+"_"+t+"_"+(a?"video":"buy")),e.window&&e.window.animateReward&&e.window.animateReward(t,l),Buttons.remove(this),e.onRemove&&e.onRemove(),cleverapps.isRumble()&&n.roundCountdown.resumeCountdown()}.bind(this));this._super({width:p.width,height:p.height,button_png:p.button_png,button_on_png:p.button_on_png,content:m,
contentOffset:p.contentOffset,contentPadding:0,onClicked:this.createListener(function(){a?(cleverapps.isRumble()&&n.roundCountdown.pauseCountdown(),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,f)):s.canPayReward(t)&&(levels.user.takeGold(c)?(cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),f()):cleverapps.isRumble()&&n.roundCountdown.pauseCountdown())}.bind(this))})}});RewardBuyButton.VIDEO="[=]",RewardBuyButton.COINS="@",cleverapps.styles.RewardBuyButton={width:144,height:54,margin:4,direction:cleverapps.UI.HORIZONTAL,button_png:bundles.buttons_main.frames.small_green_button,button_on_png:bundles.buttons_main.frames.small_green_button_on,icon:{scale:.5,offsetY:0}};var VictoryWindowButton=cleverapps.UI.Button.extend({ctor:function(e){var t=e.level,s=e.boatswain,i="OK",n=void 0;if(t.episode.isDailyLevel()&&!cleverapps.dailyLevel.isStartFromPortlet())n=s.DAILY_LEVEL_BACK_TO_MAIN;else{var o=cleverapps.Plot.decideNext(t);o===Boatswain.NEXT_INTENT?(i="Next",
n=s.PLAY_NEXT):o===Boatswain.REPLAY_INTENT&&(i="Replay",n=s.REPLAY)}var r=cleverapps.styles.VictoryWindowButton;this._super({width:r.width,height:r.height,text:Messages.get(i).toUpperCase(),font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:this.createListener(function(){n&&(s.intent=n),e.onPressed()})});var a=this.width*this.getScaleX(),c=cleverapps.styles.VictoryWindowButton.titleOffset;a<c+this.text.width&&this.text.setScale(a/(c+this.text.width))}});cleverapps.styles.VictoryWindowButton={width:220,height:110,titleOffset:40};var SettingsWindow=Window.extend({onWindowLoaded:function(){var e=[];e.push({label:void 0,view:this.addSoundIcons()});var t=cleverapps.User.calcSource();"undefined"!=typeof match3&&cc.sys.os!==cc.sys.OS_IOS&&e.push({label:"messages:SettingsWindow.Effects",view:this.addEffectButton()});var s="tripeaks"===cleverapps.config.name;if(1<cleverapps.Settings.getAvailableLanguages().length&&("merge"===cleverapps.config.type||!cleverapps.environment.isGameScene()
)&&e.push({label:s?"messages:Language":void 0,view:this.addLanguages()}),!cleverapps.social.isLoggedIn()&&-1===["mobile_vk","web_vk","plinga","huzcom","pliega"].indexOf(t)){var i=cleverapps.social.isInitialized()?"messages:SignIn":"messages:FBLoginOrInvite.Button.Connecting";e.push({label:s?i:void 0,view:this.createLoginButtons()})}(cleverapps.social.nativeInviteFriends||cleverapps.social.isLoggedIn()&&!cleverapps.flags.noviral)&&e.push({label:s?"messages:FBLoginOrInvite.Button.Invite":void 0,view:this.createInviteButton()}),-1===["mbga","sp_mbga","plinga","huzcom","instant","amazon","pliega"].indexOf(t)&&e.push({label:s?"messages:Help":void 0,view:this.addHelpButton()}),"merge"!==cleverapps.config.type&&Game.currentGame||!Chat.IsAvailable()||-1!==["plinga","huzcom","pliega"].indexOf(t)||e.push({label:s?"messages:SupportButton":void 0,view:this.addSupportButton()}),Game.currentGame&&void 0===Game.currentGame.outcome&&cleverapps.environment.isGameScene(
)&&"match3"===cleverapps.config.type&&e.push({label:void 0,view:this.addGiveUpButton()}),e.reverse();var n=cleverapps.styles.SettingsWindow,o=e.map(function(e){var t=e.view;if(e.label){if(n.Substrate)return this.singleLineWithSubstrate(t,e.label);var s=new cleverapps.UI.generateTTFText(e.label,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return new cleverapps.Layout([t,s],{direction:cleverapps.UI.VERTICAL,margin:n.Button.topPadding})}return t},this),r=new cleverapps.Layout(o,{direction:cleverapps.UI.VERTICAL,margin:n.Button.topPadding}),a=new cleverapps.Layout([this.createUserId(),r],{margin:n.Button.topPadding,direction:cleverapps.UI.VERTICAL}),c=n.Title.empty?void 0:"messages:SettingsWindow.title";this._super({title:c,name:"settingswindow",content:a,styles:cleverapps.overrideStyles(cleverapps.styles.Window,n.window,!0)}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(e,t,i){if(void 0!==e&&"object"==typeof e){var s=cleverapps.User.calcSource()
;e=i.icon.image[s]}i=i||{};var n=cleverapps.styles.SettingsWindow,o=i.font||cleverapps.styles.FONTS.BUTTON_TEXT,r=function(e){if(e){var t=new cc.Sprite(e),s=i.Icon||{};return t.setScale(s.scale||1),t}};if(t){var a=cleverapps.UI.generateTTFText(t,o),c=new cleverapps.Layout([r(e),a].filter(function(e){return void 0!==e}),{direction:cleverapps.UI.HORIZONTAL,margin:n.Button.margin});return c.text=a,c}return r(e)},singleLineWithSubstrate:function(e,t){var s=cleverapps.styles.SettingsWindow.Substrate,i=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.BUTTON_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(s.width-e.width,0),i.fitTo(0,e.height);var n=new cleverapps.Layout([i,e],{direction:cleverapps.UI.HORIZONTAL}),o=cleverapps.UI.createScale9Sprite(s.image);return o.setLocalZOrder(-1),o.setContentSize2(s.width,s.height),o.setPosition(n.width/2-s.marginX,n.height/2-s.marginY),n.addChild(o),n},
addGiveUpButton:function(){var e=cleverapps.styles.SettingsWindow,t=this.createContent(e.GiveUpButton.icon,"messages:GiveUp",e.GiveUpButton);return new cleverapps.UI.Button({button_png:bundles.buttons_main.frames.red_button,button_on_png:bundles.buttons_main.frames.red_button_on,content:t,onClicked:function(){this.close(),cleverapps.metha.whenFreeFocus(function(){cc.director.getRunningScene().closeAction()})}.bind(this),width:e.Button.width,height:e.Button.height})},addHelpButton:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.HelpButton.icon,!0===e.Button.noCaption?"":"messages:Help",{font:e.Button.font}),onClicked:function(){cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL))},width:e.Button.width,height:e.Button.height,button_png:e.HelpButton.button_png||bundles.buttons_main.frames.blue_button_png,button_on_png:e.HelpButton.button_on_png||bundles.buttons_main.frames.blue_button_on_png,
contentOffset:e.HelpButton.iconOffset})},addSupportButton:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.SupportButton.icon,!0===e.Button.noCaption?"":"messages:SupportButton",{font:e.Button.font}),onClicked:function(){cleverapps.metha.distract({focus:"ChatScene",action:function(e){Game.currentGame&&(Game.currentGame.stop(),Game.currentGame=void 0),cleverapps.scenes.replaceScene(new ChatScene(cleverapps.chat),e)}})}.bind(this),width:e.Button.width,height:e.Button.height,button_png:e.SupportButton.button_png||bundles.buttons_main.frames.blue_button_png,button_on_png:e.SupportButton.button_on_png||bundles.buttons_main.frames.blue_button_on_png,contentOffset:e.SupportButton.iconOffset,mark:cleverapps.chat.hasUnread})},addEffectButton:function(){var e=new cleverapps.UI.StateButton({on:"messages:on",off:"messages:off",onClick:function(e){0===e?cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_LOW
):cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_HIGH)}});return cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_HIGH&&cleverapps.settings.fpsMode!==cleverapps.Settings.FPS_MODE_AUTO||e.setState(1),e},addLanguages:function(){var e=cleverapps.styles.SettingsWindow;return new cleverapps.UI.Button({content:this.createContent(e.LanguageButton.icon,!0===e.Button.noCaption?"":"messages:Language",e.LanguageButton),onClicked:function(){new LanguagesWindow,this.close()}.bind(this),width:e.Button.width,height:e.Button.height,contentOffset:e.LanguageButton.iconOffset,button_png:e.LanguageButton.button_png,button_on_png:e.LanguageButton.button_on_png,button_off_png:e.LanguageButton.button_off_png})},addSoundIcons:function(){var e=[{on:bundles.buttons_main.frames.sound_on_png,off:bundles.buttons_main.frames.sound_off_png,toggle:cleverapps.settings.toggleSound.bind(cleverapps.settings),settings:"sound",listener:"onChangeSoundListener"},{
on:bundles.buttons_main.frames.music_on_png,off:bundles.buttons_main.frames.music_off_png,toggle:cleverapps.settings.toggleMusic.bind(cleverapps.settings),settings:"music",listener:"onChangeMusicListener"}];"undefined"!=typeof match3&&(cc.sys.isNative||cc.sys.isMobile||"ios"===cleverapps.User.calcSource())&&e.push({on:bundles.buttons_main.frames.vibro_on_png,off:bundles.buttons_main.frames.vibro_off_png,toggle:cleverapps.settings.toggleVibro.bind(cleverapps.settings),settings:"vibro",listener:"onChangeVibroListener"});var i=cleverapps.styles.SettingsWindow.IconButton;return this.arrangeButtons(e,cleverapps.styles.SettingsWindow.Button,function(e,t){var s=new cleverapps.UI.Button({content:new cc.Sprite(e.on),contentOff:new cc.Sprite(e.off),width:t.width,height:i.height||t.height,contentOffset:i.contentOffset,onClicked:e.toggle});return s.setBright(cleverapps.settings[e.settings]),cleverapps.settings[e.listener]=s.createListener(function(){s.setBright(cleverapps.settings[e.settings])}),s
})},arrangeButtons:function(e,t,s){var i=3===e.length?t.width3:2===e.length?t.width2:t.width,n=t.height2||t.height,o=e.map(function(e){return s(e,{width:i,height:n})},this);return new cleverapps.Layout(o,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:{x:t.padding||0,y:0}})},createLoginButtons:function(){var i=cleverapps.social.getCodes(),s=function(e,t){var s=cleverapps.styles.SettingsWindow;return new FbButton({multiSocials:1<i.length,width:1===i.length?t.width:void 0,height:t.height,button_png:bundles.main.frames.facebook_small_png,button_on_png:bundles.main.frames.facebook_small_connected_png,login:!0,showText:!(!0===s.Button.noCaption)&&1===i.length,source:e,onSuccess:this.close.bind(this)})}.bind(this),e=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.SettingsWindow.Button,!0),cleverapps.styles.SettingsWindow.LoginButton);1<i.length&&(e=cleverapps.overrideStyles(cleverapps.clone(e,!0),e.multiSocials));var t=this.arrangeButtons(i,e,function(e,t){return s(e
,t)});if(!cleverapps.styles.SettingsWindow.Substrate&&1<i.length){var n=new cleverapps.UI.generateTTFText("messages:SignIn",cleverapps.styles.FONTS.SETTINGS_WINDOW_ID_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return new cleverapps.Layout([t,n],{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.SettingsWindow.Button.topPadding})}return t},createInviteButton:function(){var e=cleverapps.styles.SettingsWindow.Button;return new FbButton({width:e.width,height:e.height,button_png:bundles.main.frames.facebook_small_png,button_on_png:bundles.main.frames.facebook_small_connected_png,showText:!(!0===cleverapps.styles.SettingsWindow.Button.noCaption),onSuccess:this.close.bind(this)})},createUserId:function(){if("merge"!==cleverapps.config.type){var e=cleverapps.user.id;e=e.replace("android_","").replace("apple_","");var t=cleverapps.UI.generateTTFText("messages:SettingsWindow.UserID.text",cleverapps.styles.FONTS.SETTINGS_WINDOW_ID_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{
id:e});if(30<e.length&&t.setString("ID: "+e),t.fitTo(cleverapps.styles.SettingsWindow.UserId.maxWidth),!cc.sys.isNative){cleverapps.UI.onClick(t,function(){var e=document.createElement("textArea");e.value=cleverapps.user.id,e.style.hidden=!0,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),cleverapps.Notification.create("messages:SettingsWindow.UserID.copied")})}return t}},createResolutionId:function(){return new cleverapps.UI.generateTTFText("messages:SettingsWindow.ResolutionId",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{resolution:100*resolutionScale})}});cleverapps.styles.SettingsWindow={HelpButton:{},SupportButton:{},IconButton:{},LoginButton:{margin:40,padding:0},Button:{width:450,height:110,topPadding:20,leftPadding:0,margin:15,width2:215,width3:140},LanguageButton:{icon:bundles.buttons_main.frames.language_icon_png},GiveUpButton:{enabled:!1},ModesSlider:{margin:0},UserId:{maxWidth:500},window:{contentOffset:-50,Border:{y:100}},
Title:{empty:!1},topPadding:40,width:400,height:430},"horizontal"===cleverapps.config.orientation&&cleverapps.increaseStylesByKoef(cleverapps.styles.SettingsWindow,1.25);var LanguageButton=cc.Node.extend({ctor:function(e,t){this._super(),this.callback=t,this.language=e,this.setContentSize2(cleverapps.styles.LanguagesWindow.Button),this.setAnchorPoint2(),this.addContent(),cleverapps.UI.onClick(this,this.onClicked.bind(this)),cleverapps.UI.applyHover(this)},onClicked:function(){this.isCurrentLanguage()||this.callback(this.language)},isCurrentLanguage:function(){return cleverapps.settings.language===this.language},onTouchBegan:function(){this.isCurrentLanguage()||(this.isPressed=!0,this.updateContent())},onTouchEnded:function(){this.isCurrentLanguage()||(this.isPressed=!1,this.updateContent())},addContent:function(){this.content=this.createButtonContent(),this.addChild(this.content),this.content.setPositionRound(this.width/2,this.height/2)},onMouseOver:function(){this.isCurrentLanguage(
)||this.setScale(1.05)},updateContent:function(){this.content.removeFromParent(!0),this.addContent()},createButtonContent:function(){var e=cleverapps.styles.LanguagesWindow.Button,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=this.bg=cleverapps.UI.createScale9Sprite(this.isPressed||this.isCurrentLanguage()?bundles.languageswindow.frames.buttonbg_on_png:bundles.languageswindow.frames.buttonbg_png);s.setContentSize2(t.getContentSize()),s.setPosition(t.width/2,t.height/2),t.addChild(s);var i=cleverapps.styles.FONTS.LANGUAGE_TEXT;this.isCurrentLanguage()&&cleverapps.styles.FONTS.LANGUAGE_SELECTED_TEXT&&(i=cleverapps.styles.FONTS.LANGUAGE_SELECTED_TEXT);var n=cleverapps.UI.generateTTFText("messages:"+this.language,i);if(n.fitTo(t.width-2*e.padding.x),t.addChild(n),n.setPositionRound(t.width/2+e.text.offset.x,t.height/2+e.text.offset.y),this.isCurrentLanguage()){var o=new cc.Sprite(bundles.languageswindow.frames.buttoncheck_png);for(o.setPositionRound(e.check),t.addChild(o
);cc.rectIntersectsRect(o.getBoundingBox(),n.getBoundingBox());)n.fitTo(.95*n.width)}return t}}),LanguagesWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.LanguagesWindow,t=cleverapps.overrideStyles(cleverapps.styles.Window,e.window,!0);this._super({title:"messages:Language",name:"languageswindow",minHeight:e.minHeight,content:this.createContent(),styles:t}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.LanguagesWindow,t=cleverapps.clone(cleverapps.Settings.getAvailableLanguages()),s=e.amountInRow[cleverapps.wideMode.mode];this.buttonsPerLanguage={};for(var i=[];0<t.length;){var n=t.splice(0,s),o=[];n.forEach(function(e){var t=new LanguageButton(e,this.buttonClicked.bind(this));o.push(t),this.buttonsPerLanguage[e]=t}.bind(this));var r=new cleverapps.Layout(o,{direction:cleverapps.UI.HORIZONTAL,margin:e.columnMargin});i.unshift(r)}var a=new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,
margin:e.rowMargin,padding:e.padding});if(e.bg){var c=new cc.Scale9Sprite(bundles.languageswindow.frames.bg_png);return c.setContentSize2(a.width+2*e.bg.padding.x,a.height+2*e.bg.padding.y),c.addChild(a),a.setPositionRound(c.width/2,c.height/2),c}return a},buttonClicked:function(t){var s=cleverapps.settings.language;t!==s&&cleverapps.metha.distract({focus:"LanguageChanged",action:function(e){cleverapps.settings.setLanguage(t),t===cc.sys.LANGUAGE_RUSSIAN&&(cleverapps.dailyLevel.currentEvent||cleverapps.dailyLevel.load()),"board"===cleverapps.config.type&&levels.episodes.reset(),this.buttonsPerLanguage[s].updateContent(),this.buttonsPerLanguage[t].updateContent(),Messages.preload(t,function(){this.setTitle("messages:Language"),cleverapps.environment.isGameScene()&&"merge"!==cleverapps.config.type?cleverapps.lives?(e(),this.close()):cleverapps.metha.wantsToPlay(e):(this.close(),Game.currentGame&&Game.currentGame.stop(),cleverapps.metha.gotoMainScene(e))}.bind(this))}.bind(this)})},
listBundles:function(){return["languageswindow"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{LANGUAGE_TEXT:{size:35,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.LanguagesWindow={Button:{width:260,height:100,padding:{x:10},text:{offset:{x:0,y:0}},check:{margin:3,x:{align:"left",dx:6},y:{align:"center",dy:0}}},window:{contentOffset:-40},columnMargin:20,rowMargin:20,padding:{x:0,y:10},amountInRow:[2,3,3]};var TutorialFinishWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.TutorialFinishWindow,t=new cc.Node;t.setAnchorPoint(.5,.5);var s=e.paddingBottom;t.setContentSize(e.width,e.height?e.height:e.paddingBottom);var i=cleverapps.UI.generateTTFText("messages:TutorialFinishWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)});i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var n=t.width+50;if(i.setDimensions(cc.size(n,0)),i.setPosition(t.width/2+e.text.x,t.height+i.height/2+e.text.y),t.addChild(i),
s+=i.height+e.paddingTop,e.character){var o=new cc.Sprite(e.character.image);o.setPosition(t.width/2+e.character.x,e.character.y),t.addChild(o),s+=o.height}e.height&&(s=e.height),t.setContentSize(t.width,s),this._super({content:t,title:"messages:TutorialFinishWindow.title",name:"tutorialfinishwindow",button:{text:Messages.get("OK")},closeButton:!1}),cleverapps.audio.playSound(bundles.main.urls.window_effect)}});cleverapps.styles.TutorialFinishWindow={width:550,paddingBottom:50,paddingTop:20,text:{x:0,y:0}};var RateWindow=Window.extend({onWindowLoaded:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RATE_WINDOW);for(var s=cleverapps.styles.RateWindow,i=[],e=[],t=0;t<5;t++)e.push(t);var n=-1,o=function(e){if(e!==n){n=e;for(var t=0;t<5;t++)t<=e?i[t].turnOn():i[t].turnOff()}},r=function(e){if(4===e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.RATE_SEND);var t=cleverapps.bySource(cleverapps.config.rate.urls);void 0===t&&(t=cleverapps.config[cleverapps.User.calcSource(
)]&&cleverapps.config[cleverapps.User.calcSource()].url);var s=function(){t&&cc.sys.openURL(t)};NativeReview.isAvailable()?NativeReview.requestReview(function(e){cleverapps.eventLogger.logEvent("native_review_"+e),"ok"!==e&&s()}):s()}if(cleverapps.eventLogger.logEvent(cleverapps.EVENTS["RATE_"+(e+1)]),e+1<=3){var i=cleverapps.bySource(cleverapps.config.dontLikeGameUrl);i&&cc.sys.openURL(i)}this.close()}.bind(this),a=function(e){var t=this.convertToNodeSpace(e.getLocation()),s=cc.rect(0,0,this.width,this.height);cc.rectContainsPoint(s,t)?o(this.order):function(e){if(e===n){n=-1;for(var t=0;t<5;t++)i[t].turnOff()}}(this.order)};i=this.stars=e.map(function(e){var t=new cc.Sprite(s.starImage);return t.turnOn=function(){cleverapps.UI.convertToGrayScale(t,!0)},t.turnOff=function(){cleverapps.UI.convertToGrayScale(t)},t.turnOff(),t.order=e,cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e)
;return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)}.bind(t),onTouchEnded:function(e){var t=this.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)&&(o(this.order),r(this.order),!0)}.bind(t)},t),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:a.bind(t)},t),t});var c=cleverapps.UI.generateTTFText("messages:RateWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{gameTitle:Messages.get(cleverapps.config.title)});c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),c.setDimensions(s.width,0);var l=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL}),p=new cleverapps.Layout([l,c],{direction:cleverapps.UI.VERTICAL,margin:s.margin,padding:s.padding});this._super({content:p,title:"messages:RateWindow.title",name:"ratewindow",button:{width:s.button.width,height:s.button.height,text:Messages.get("Later").toUpperCase(),onPressed:function(){this.close()}.bind(this)}}),cleverapps.audio.playSound(
bundles.main.urls.window_effect),this.addFingerTip(i[i.length-1])},addFingerTip:function(e){var t,s=function(){this.runAction(new cc.Sequence(new cc.DelayTime(2.2),new cc.CallFunc(function(){this.stars.forEach(function(e,t){e.runAction(new cc.Sequence(new cc.DelayTime(.25*t),new cc.CallFunc(function(){e.turnOn()})))})}.bind(this))))}.bind(this);cc.sys.isNative&&(s(),t=function(){this.stars.forEach(function(e){e.turnOff()}),s()}.bind(this)),this.fingerTip=new FingerView,this.fingerTip.setPosition(e.getPosition()),e.parent.addChild(this.fingerTip),this.fingerTip.standardLoop({delay:2,delayOnBegin:!0,onIterationFinish:t})},onClose:function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.RATED,!0,{raw:!0}),this.fingerTip&&this.fingerTip.removeFromParent(!0)}});RateWindow.hadRated=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.RATED,{raw:!0})},cleverapps.styles.RateWindow={width:650,margin:40,padding:{x:15,y:70},text:{height:180},button:{width:300,height:100
},starImage:bundles.game.frames.ratewindow_on},RateWindow.prototype.listBundles=function(){return["game"]},RateWindow.AVAILABLE={level:3,episode:1},"merge"===cleverapps.config.type&&(RateWindow.AVAILABLE={level:6,episode:0});var WindowHelper={animateCollect:function(s,t,e){if(e=cleverapps.once(e||function(){}),s&&s.parent&&t.target&&t.target.parent){s.replaceParentSamePlace(cc.director.getRunningScene());var i=function(){var e=t.target.parent.convertToWorldSpace(t.target);return t.targetDelta&&(e.x+=t.targetDelta.x,e.y+=t.targetDelta.y),e},n=i(),o=t.height||cleverapps.styles.WindowHelper.second.y,r=cc.p((s.x+2*n.x)/3,(s.y+2*n.y)/3+o),a=cc.p((s.x+r.x)/2,(s.y+r.y)/2);s.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.7,[a,r,n]).easing(cc.easeInOut(1)),new cc.ScaleTo(.7,t.scale)),new cc.CallFunc(function(){e(),t.noSound||cleverapps.audio.playSound(bundles.main.urls.collect_coins_effect),!1!==t.remove&&s.parent&&s.removeFromParent(!0)}))),[.175,.35,.7*.75].forEach(function(t){
s.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){var e=i();s.runAction(new cc.MoveBy(.7-t,e.x-n.x,e.y-n.y)),n=e})))})}else e()}};cleverapps.styles.WindowHelper={second:{y:400}};var ConfirmExitWindow=Window.extend({onWindowLoaded:function(e){this.returnOnClose=e.onClose||function(){},this.onAction=e.onAction||function(){};var t=cleverapps.styles.ConfirmExitWindow,s=new cc.Node;s.setAnchorPoint(.5,.5),s.setContentSize2(t.width,t.height);var i=cleverapps.styles.FONTS.CONFIRM_AND_EXIT_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT,n=e.text||"messages:AreYouSure";cleverapps.environment.isGameScene()&&"merge"!==cleverapps.config.type&&(cleverapps.lives&&(n="messages:ConfirmExitWindow.message"),e.game.level.episode.isBonusRound()&&(n="messages:ConfirmExitWindow.BonusRound.message"));var o=cleverapps.UI.generateOnlyText(n,i);if(o.setAnchorPoint2(),o.setDimensions(t.text.width,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.text.height&&o.fitTo(0,t.text.height),
e.reward){var r=new RewardsListComponent(e.reward,{font:i,margin:t.reward.margin});r.setAnchorPoint2()}var a,c=new cleverapps.Layout([r,o],{direction:cleverapps.UI.VERTICAL,margin:t.margin});c.setPositionRound(s.width/2+t.text.x,t.text.y),s.addChild(c),!1===t.breakView.upAnimation&&"undefined"!=typeof BreakView&&Game.currentGame&&cleverapps.environment.isGameScene()&&BreakView.AddBreakViews(s,[o],t.breakView.y),this._super({closeByBackButton:!0,title:"messages:ConfirmExitWindow.title",name:"confirmexitwindow",content:s,buttons:this.getButtons(),closeButton:!1});var l=bundles.confirmexit_window.jsons.confirmexit_window_json;"tripeaks"===cleverapps.config.name&&(l=bundles.hero.jsons.hero_json),l&&((a=new cleverapps.Spine(l,t.animation.scale)).setAnimation(0,t.animation.onScene?"lose":"sad",!0),t.animation.onScene?(a.setPositionRound(t.animation.x,cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?t.animation.y-t.animation.verticalOffset:t.animation.y),this.addChild(a)):(
a.setPositionRound(s.width/2+t.animation.x,s.height/2+t.animation.y),s.addChild(a))),!0===t.breakView.upAnimation&&"undefined"!=typeof BreakView&&Game.currentGame&&cleverapps.environment.isGameScene()&&BreakView.AddBreakViews(s,[a],t.breakView.y),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getButtons:function(){var e=cleverapps.styles.ConfirmExitWindow,t=new cleverapps.UI.Button({button_png:e.playButton.image,button_on_png:e.playButton.imageOn,text:Messages.get("PlayOn"),onClicked:function(){this.close()}.bind(this),width:e.button.width,height:e.button.height}),s=new cleverapps.UI.Button({button_png:e.exitButton.image?e.exitButton.image:bundles.buttons_main.frames.red_button,button_on_png:e.exitButton.image?e.exitButton.imageOn:bundles.buttons_main.frames.red_button_on,text:Messages.get("Exit"),font:e.exitButton.font||cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){this.closeAnimationCallbacks.push(this.onAction),this.close()}.bind(this),width:e.button.width,
height:e.button.height});return e.exitButton.scale&&(s.setScale(e.exitButton.scale),s.baseScale=s.scale),[s,t]},onClose:function(){this.returnOnClose&&this.returnOnClose()},listBundles:function(){return["confirmexit_window"]}});cleverapps.styles.ConfirmExitWindow={width:650,height:550,margin:20,animation:{x:0,y:-10,scale:1},text:{x:0,y:60,width:500},exitButton:{scale:.9},playButton:{},button:{width:300,height:100},breakView:{upAnimation:!0,y:0},reward:{margin:100}};var NewLeagueWindow=Window.extend({onWindowLoaded:function(e){this.level=e,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.NEW_LEAGUE);var t=cleverapps.styles.NewLeagueWindow;if(this.content=new cc.Node,this.content.setAnchorPoint(.5,.5),this.content.setContentSize(t.width,t.height),this.addLeague(),this._super({title:"messages:NewLeagueWindow.Title",name:"newleaguewindow",content:this.content,closeButton:!1,buttons:this.getButtons(),shareCheckBox:this.getShareOptions()}),this.addChild(new Fireworks),
cleverapps.audio.playSound(bundles.main.urls.window_effect),t.hero){var s=new HeroView(t.hero);this.addChild(s)}},addLeague:function(){var e=cleverapps.styles.NewLeagueWindow,t=levels.user.league,s=cleverapps.UI.generateTTFText("messages:NewLeagueWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{league:Messages.get("League"+t)});s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setPositionRound(this.content.width/2,e.text.y),s.setDimensions(this.content.width,0),this.content.addChild(s)},getButtons:function(){var e=cleverapps.styles.NewLeagueWindow.button,t=[],s=new cleverapps.UI.Button({width:e.width,height:e.height,text:Messages.get("OK"),font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:this.close.bind(this)});if(t.push(s),this.level.isRegular())var i=ShareBonusButton.create({window:this,shareBonus:cleverapps.ShareBonus.SHARES.newLeague,toReplace:{leagueId:levels.user.league,leagueName:Messages.get("League"+levels.user.league)}});return i&&t.push(i),t},getShareOptions:function(
){return{shareId:cleverapps.ShareBonus.SHARES.newLeague.id,toReplace:{leagueId:levels.user.league,leagueName:Messages.get("League"+levels.user.league)}}}});cleverapps.styles.NewLeagueWindow={width:550,height:500,button:{width:280,height:110,y:-50},text:{y:170},buttonsMargin:25,share:{width:280,height:110,Text:{offsetX:0,offsetY:25},RewardText:{offsetX:-15,offsetY:-15},RewardCoins:{scale:.5,offsetX:40,offsetY:-18}}};var LeadersLoading=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.WaitWindow,t=this.loading=new cleverapps.Spine(bundles.main.jsons.wait_json,1.5);if(t.setAnimation(0,"idle",!0),this.addChild(t),e.text){var s=this.loadingText=cleverapps.UI.generateTTFText(Messages.get("Loading")||"Loading",cleverapps.styles.FONTS.WINDOW_TEXT);s.setPosition(0,e.text.y),this.addChild(s)}},remove:function(){this.loading.runAction(new cc.RemoveSelf),this.loadingText&&this.loadingText.removeFromParent()}}),LeadersWindow=Window.extend({onWindowLoaded:function(){
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEADERS_WINDOW_OPEN),this.content=new cc.Node,this.content.setAnchorPoint2(),this.content.setContentSize(cleverapps.styles.LeadersWindow.width,cleverapps.styles.LeadersWindow.height);var e=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.LeadersWindow.window);this._super.call(this,{name:"leaderswindow",content:this.content,title:{text:"messages:LeadersWindowTitle"},styles:e}),this.addButtons(),this.tabs.activateTab(LeadersWindow.TABS.GLOBAL),cleverapps.audio.playSound(bundles.main.urls.window_effect)},addButtons:function(){var e=cleverapps.styles.LeadersWindow.tabs,t={};t[LeadersWindow.TABS.GLOBAL]={icon:bundles.main.frames.global_icon,generator:this.generateWorldContent.bind(this),scale:e.scale},cleverapps.flags.nologin||(t[LeadersWindow.TABS.FRIENDS]={icon:bundles.main.frames.friends_icon,generator:this.generateFriendsContent.bind(this),scale:e.scale,mirrorX:e.mirrorX}),this.tabs=new Tabs(t,e),
this.tabs.setPositionRound(e),this.tabs.setLocalZOrder(e.zOrder),this.window.addChild(this.tabs)},addTableHead:function(e){var t=cleverapps.styles.LeadersWindow.table,s=new cc.Node;s.setContentSize2(cleverapps.styles.LeadersWindow.player.width,t.head.height),s.setAnchorPoint2(),s.setPositionRound(e.width/2,t.head.y),e.addChild(s);var i=cleverapps.UI.generateTTFText("messages:LeadersWindow.rank",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);i.setPositionRound(t.rank.x,s.height/2),s.addChild(i);var n=cleverapps.UI.generateTTFText("messages:LeadersWindow.player",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);n.setPositionRound(t.player.x,s.height/2),s.addChild(n);var o=cleverapps.UI.generateTTFText("messages:LeadersWindow.rating",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);o.setPositionRound(t.rating.x,s.height/2),s.addChild(o)},generateWorldContent:function(){var e=cleverapps.styles.LeadersWindow.worldContent;this.worldContent=new cc.Node,this.worldContent.setAnchorPoint2(),
this.worldContent.setContentSize(e.width,e.height),this.worldContent.setPosition(this.content.width/2+e.left,this.content.height/2+e.top),this.content.addChild(this.worldContent),this.addTableHead(this.worldContent);var i=new LeadersLoading;i.setPosition(this.worldContent.width/2,this.worldContent.height/2),this.worldContent.addChild(i),i.setVisible(!1),i.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){i.setVisible(!0)}))),1<this.getAmountLeagues()&&(this.decLeagueButton=new cleverapps.UI.Button({button_png:e.arrow.image,button_on_png:e.arrow.image,onClicked:this.decLeague.bind(this),clickThrottle:1,onMouseOver:function(){this.decLeagueButton.setScale(-1.05,1.05)}.bind(this),onMouseOut:function(){this.decLeagueButton.setScale(-1,1)}.bind(this)}),this.decLeagueButton.setPosition(this.worldContent.width/2-e.arrow.x,this.worldContent.height+e.arrow.y),this.decLeagueButton.setScaleX(-1),this.decLeagueButton.setLocalZOrder(1),this.worldContent.addChild(
this.decLeagueButton),this.incLeagueButton=new cleverapps.UI.Button({button_png:e.arrow.image,button_on_png:e.arrow.image,onClicked:this.incLeague.bind(this),clickThrottle:1}),this.incLeagueButton.setPosition(this.worldContent.width/2+e.arrow.x,this.worldContent.height+e.arrow.y),this.incLeagueButton.setLocalZOrder(1),this.worldContent.addChild(this.incLeagueButton)),this.currentLeague=levels.user.league,this.generateWorldHead(levels.user.league);var t=this.createListener(cleverapps.timeredThrottle(300,function(t){i.remove(),this.leaguesLeaders={};for(var s=0;s<t.length;s++)this.leaguesLeaders[t[s].leagueId]=JSON.parse(t[s].data),this.leaguesLeaders[t[s].leagueId].forEach(function(e){e.league=t[s].leagueId});for(s=0;s<this.getAmountLeagues();s++)this.leaguesLeaders[s]||(this.leaguesLeaders[s]=[]);this.generateWorldHead(levels.user.league),this.generateWorldLeague(levels.user.league)}.bind(this),Date.now())),s="/leaders/"+cleverapps.settings.language+"/"
;return cleverapps.config.debugMode&&(s="https://wordsoup.labsystech.ru/wordsoup-rest"+s),cleverapps.RestClient.get(s,{},t,function(){cleverapps.Notification.create("messages:LeadersLoadFailed")}),this.worldContent.onSelectTab=function(){this.updateTitle()}.bind(this),this.worldContent},decLeague:function(){0<this.currentLeague&&(this.currentLeague--,this.generateWorldHead(),this.generateWorldLeague(),this.updateTitle())},incLeague:function(){this.currentLeague<this.getAmountLeagues()-1&&(this.currentLeague++,this.generateWorldHead(),this.generateWorldLeague(),this.updateTitle())},getAmountLeagues:function(){var e=1;return cleverapps.config.leagues&&(e=cleverapps.config.leagues.length),e},generateWorldHead:function(){this.decLeagueButton&&(this.decLeagueButton.visible=this.leaguesLeaders&&0<this.currentLeague),this.incLeagueButton&&(this.incLeagueButton.visible=this.leaguesLeaders&&this.currentLeague<this.getAmountLeagues()-1)},updateTitle:function(){this.window&&this.setTitle(
"messages:League"+this.currentLeague)},generateWorldLeague:function(){var e=this.currentLeague,t=this.leaguesLeaders[e];for(this.removePlayerFromTop(t),levels.user.league===e&&this.addPlayerToTop(t);t.length>LeadersWindow.TOP_LIMIT&&t[t.length-1].id!==levels.user.id;)t.pop();var s=function(){this.leagueTop&&(this.leagueTop.removeFromParent(),delete this.leagueTop)}.bind(this);s(),this.runAction(new cc.Sequence(new cc.DelayTime(.01),new cc.CallFunc(function(){e===this.currentLeague&&(s(),this.leagueTop=this.generateTop(t,this.worldContent),this.worldContent.addChild(this.leagueTop))}.bind(this))))},removePlayerFromTop:function(e){for(var t=0;t<e.length;t++)if(e[t].id===levels.user.id){e.splice(t,1);break}},addPlayerToTop:function(e){e.push({id:levels.user.id,rating:levels.user.getVirtualLevel(),name:cleverapps.friends.getPlayer().name,avatar:cleverapps.friends.getPlayer().avatar,you:!0,league:levels.user.league}),e.sort(function(e,t){
return e.rating===t.rating?e.id===levels.user.id?-1:t.id===levels.user.id?1:0:t.rating-e.rating})},generateTop:function(e,t){for(var s=[],i=0;i<e.length;i++){var n={text:e[i].name,place:i+1,id:e[i].id,avatar:{id:e[i].id,avatar:e[i].avatar},player:e[i].id===levels.user.id,amount:e[i].rating};s.push(n)}cleverapps.leadersWindowTable.resetResults("leadersWindow");var o=cleverapps.leadersWindowTable.createTableView({id:"leadersWindow",data:s,rowConstructor:cleverapps.LeadersRow,options:{styles:{width:cleverapps.styles.LeadersRow.size.width}}}),r=cleverapps.styles.LeadersWindow;return o.setPositionRound(r.table.x,r.table.y,t),o},generateFriendsContent:function(){var e=cleverapps.styles.LeadersWindow.friendsContent;this.friendsContent=new cc.Node,this.friendsContent.setAnchorPoint2(),this.friendsContent.setContentSize(e.width,e.height),this.friendsContent.setPosition(this.content.width/2+e.left,this.content.height/2+e.top);var t=levels.progress.getLeaders();if(0<t.length){this.addPlayerToTop(
t),this.addTableHead(this.friendsContent);var s=this.generateTop(t,this.friendsContent);this.friendsContent.addChild(s)}else{e=e.noFriends;var i=cleverapps.UI.generateTTFText("messages:noFriendsInLeadersText",cleverapps.styles.FONTS.WINDOW_TEXT);i.setPositionRound(this.friendsContent.width/2,this.friendsContent.height/2+e.Text.y),i.setDimensions(e.Text.width,e.Text.height),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.friendsContent.addChild(i);var n=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,padding:e.Button.padding,onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){}.bind(this))}.bind(this)});n.setPositionRound(this.friendsContent.width/2,this.friendsContent.height/2+e.Button.y),this.friendsContent.addChild(n)}return this.content.addChild(this.friendsContent),this.friendsContent.onSelectTab=function(){this.setTitle(
"messages:FriendsTopName")}.bind(this),this.friendsContent}});LeadersWindow.TABS={},LeadersWindow.TABS.GLOBAL=0,LeadersWindow.TABS.FRIENDS=1,LeadersWindow.prototype.listBundles=function(){return"match3"===cleverapps.config.type?["game"]:[]},cleverapps.styles.LeadersWindow={width:524,height:770,player:{height:78,width:660,margin:20,name:{width:200,height:70},avatar:{scale:.8},place:{dy:0},rating:{dy:0}},head:{y:924},table:{x:{align:"center"},y:{align:"center"},head:{y:805,height:40},rank:{x:80},player:{x:300},rating:{x:550}},friendsContent:{width:600,height:782,left:0,top:-100,noFriends:{Text:{y:100,width:400,height:200},Button:{width:300,height:100,padding:{x:0},y:0}}},worldContent:{width:600,height:782,left:0,top:-100,arrow:{image:bundles.main.frames.league_arrow_png,x:286,y:0}},window:{decors:{}},tabs:{x:{align:"right",dx:0},y:{align:"bottom",dy:0},scale:.8,zOrder:0}},LeadersWindow.TOP_LIMIT=100,cleverapps.Promotion=function(){cleverapps.config.debugMode&&(
cleverapps.Promotion.SINCE_START="10 seconds");var e=this.load();this.createdTime=Date.now(),e?this.processed=e.processed:this.reset()},cleverapps.Promotion.prototype.reset=function(){this.processed=[],this.save()},cleverapps.Promotion.prototype.getFirstAvailable=function(){var s=cleverapps.User.calcSource(),i=void 0;return this.getPromotions().forEach(function(e,t){!i&&-1===this.processed.indexOf(e.id)&&e.sources[s]&&(i=e)},this),void 0!==i?i:0<this.processed.length?(this.processed=[],this.save(),this.getFirstAvailable()):void 0},cleverapps.Promotion.prototype.listAvailablePromotions=function(){return["mergecraft","magicwords","scramble","tripeaks","olympics","crocword","wordsoup","riddles","heroes","adventure","differences","runes"].filter(function(e){return e!==cleverapps.config.name&&cleverapps.projectLinks[e]})},cleverapps.Promotion.prototype.getPromotions=function(){var o={gameName:cleverapps.config.name};return this.listAvailablePromotions().map(function(e){
var t="promotion_"+e+"_"+cleverapps.settings.language,s="promotion_"+e+"_"+cc.sys.LANGUAGE_ENGLISH,i={id:e,title:"messages:"+e+"PromoTitle",description:"messages:"+e+"Promo",bundleName:bundles[t]?t:s,sources:{}};for(var n in cleverapps.projectLinks[e])i.sources[n]=cleverapps.projectLinks[e][n],"facebook"===n&&(i.sources[n]+=Messages.replace("?channel=%{gameName}",o)),"android"===n&&(i.sources[n]+=Messages.replace("&utm_source=%{gameName}",o));return i})},cleverapps.Promotion.prototype.isReady=function(){return!!cleverapps.user.checkAvailable(cleverapps.Promotion.AVAILABLE)&&(!(this.createdTime+cleverapps.parseInterval(cleverapps.Promotion.SINCE_START)>=Date.now())&&void 0!==this.getFirstAvailable())},cleverapps.Promotion.prototype.setProcessed=function(e){this.processed.push(e.id),this.save()},cleverapps.Promotion.prototype.load=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PROMOTION)},cleverapps.Promotion.prototype.save=function(){cleverapps.DataLoader.save(
cleverapps.DataLoaderTypes.PROMOTION,{processed:this.processed})},cleverapps.Promotion.ShowFirstAvailable=function(){var e=cleverapps.promotion.getFirstAvailable();new PromotionWindow(e)},cleverapps.Promotion.BONUS=10,cleverapps.Promotion.SINCE_START="10 seconds",cleverapps.Promotion.AVAILABLE={episode:1,level:10};var PromotionWindow=Window.extend({onWindowLoaded:function(e){this.promotion=e,cleverapps.eventLogger.logEvent("promo_show_"+this.promotion.id),cleverapps.promotion.setProcessed(this.promotion);var t=cleverapps.styles.PromotionWindow,s=new cc.Node;s.setAnchorPoint(.5,.5);var i=cleverapps.UI.generateOnlyText(e.description,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);i.setDimensions(t.text.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(i);var n=new cc.Sprite(bundles[e.bundleName].urls.image);s.addChild(n),cleverapps.UI.onClick(n,this.onPressed.bind(this)),cleverapps.UI.arrangeWithMargins(s.children,{margin:t.text.margin}),cleverapps.UI.wrap(s)
;var o=cleverapps.UI.wrapWithPadding(s,{x:0,y:t.margin});this._super({title:e.title,name:"promotionwindow",content:o,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.PromotionWindow,!0),button:{width:t.Button.width,height:t.Button.height,content:this.getButtonContent(),contentOffset:t.Button.contentOffset,onPressed:this.onPressed.bind(this)}}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},isRewardAvailable:function(){return!cleverapps.MobileVk.isAppropriate()},onPressed:function(){var e=cleverapps.User.calcSource(),t=this.promotion.sources[e];"instant"!==e?cc.sys.openURL(t):FBInstant.switchGameAsync(t,{channel:cleverapps.config.name}).catch(function(e){console.log("FBInstant.switchGameAsync error",e);var t="USER_INPUT"===e.code?"cancel":"error";cleverapps.eventLogger.logEvent("promo_"+t+"_"+this.promotion.id),"error"===t&&cleverapps.eventLogger.logEvent("promo_error_"+cleverapps.config.platform)}.bind(this)),cleverapps.eventLogger.logEvent(
"promo_"+this.promotion.id),this.isRewardAvailable()&&(levels.user.setGold(levels.user.gold+cleverapps.Promotion.BONUS),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:cleverapps.Promotion.BONUS})),this.close()},getButtonContent:function(){var e=cleverapps.styles.PromotionWindow.Button,t=new cc.Sprite(bundles.menubar.frames.coin_png);t.setScale(e.scale),e.coinsOffsetY&&t.setPositionY(e.coinsOffsetY);var s=[];if(this.isRewardAvailable()){var i=cleverapps.UI.generateImageText("+"+cleverapps.Promotion.BONUS,cleverapps.styles.FONTS.PROMOTION_BUTTON_TEXT),n=new cleverapps.Layout([i,t],{direction:cleverapps.UI.HORIZONTAL,margin:e.bottom.margin});s.push(n)}var o=cleverapps.UI.generateOnlyText("messages:Play",cleverapps.styles.FONTS.PROMOTION_BUTTON_TEXT);s.push(o);var r=new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:e.margin});return r.coin=t,r},listBundles:function(e){return[e.bundleName]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{
PROMOTION_BUTTON_TEXT:{name:"default",size:55,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.PromotionWindow={margin:100,text:{width:620,margin:20},Button:{width:300,height:160,scale:.9,margin:0,contentOffset:{y:0},bottom:{margin:10}}};var Decors=function(s,i){if(i=i||{},this.styles=i,this.decors={},this.parent=s,cleverapps.styles.Decorators){var e=Object.keys(i).filter(function(e){if(!0!==i[e])return!1;var t=cleverapps.styles.Decorators[e];if(!t)return!1;if(t.lovesBackground&&!s.withBg)return!1;if(t.lovesBackgroundAndForeground&&!s.withBg&&!s.foreground)return!1;if(t.fearHigh&&s.window&&.8<s.window.height*s.window.scale/cleverapps.styles.SCENE_HEIGHT)return!1;return!t.titleDecorator});this.init(e)}};Decors.prototype.add=function(e){var t=cleverapps.styles.Decorators[e];if(t){var s;switch(t.type){case Decors.TYPE_IMAGE:s=this.addImage(t);break;case Decors.TYPE_ANIMATION:s=this.addAnimation(t);break
;case Decors.TYPE_SCALE9:s=this.addScale9(t);break;case Decors.TYPE_REPEATABLE:s=this.addPattern(t)}if(s){var i=this.getPos(t);return this.getParent(t).addChild(s),s.setPositionRound(i.x,i.y),this.decors[e]=s}}},Decors.prototype.init=function(e){e.forEach(this.add,this)},Decors.prototype.initTitleDecorators=function(){var e=Object.keys(this.styles).filter(function(e){return!0===this.styles[e]&&cleverapps.styles.Decorators[e]&&cleverapps.styles.Decorators[e].titleDecorator}.bind(this));this.init(e)},Decors.prototype.getDecorById=function(e){if(this.decors[e])return this.decors[e]},Decors.prototype.setVisible=function(e,t){var s=this.getDecorById(e);return!!s&&(t||s.stopAllActions(),s.setVisible(t),!0)},Decors.prototype.getParent=function(e){return e.titleDecorator?this.parent.titleBg:e.lovesBackgroundAndForeground&&(this.parent.foreground||this.parent.bg)?this.parent.foreground||this.parent.bg:this.parent.window},Decors.prototype.addScale9=function(e){
var t=cleverapps.UI.createScale9Sprite(bundles.main.frames[e.image]||e.image);return t.setContentSize2(e.width,e.height),Array.isArray(e.scale)?t.setScale(e.scale[cleverapps.wideMode.mode]):t.setScale(e.scale),t.baseScale=t.scale,t.setLocalZOrder(e.zOrder),void 0!==e.rotation&&t.setRotation(e.rotation),t},Decors.prototype.addImage=function(e){var t=new cc.Sprite(bundles.main.frames[e.image]||e.image),s=e.scale;return Array.isArray(s)&&(s=s[cleverapps.wideMode.mode]),"number"==typeof s?t.scale=s:(t.scaleX=s.x,t.scaleY=s.y),t.baseScale=Math.abs(t.scaleX),t.baseScaleX=t.scaleX,t.baseScaleY=t.scaleY,t.setLocalZOrder(e.zOrder),void 0!==e.rotation&&t.setRotation(e.rotation),t},Decors.prototype.addAnimation=function(e){var t=bundles.main.jsons[e.json]||e.json,s=new cleverapps.Spine(t);e.scale&&(e.scale.x?s.setScale(e.scale.x,e.scale.y):s.setScale(e.scale));var i=void 0===e.looped||e.looped;return s.setLocalZOrder(e.zOrder),s.setVisible(!0),void 0!==e.delay?s.runAction(new cc.Sequence(
new cc.DelayTime(e.delay),new cc.CallFunc(function(){s.setAnimation(0,e.animation,i)}))):s.setAnimation(0,e.animation,i),s},Decors.prototype.addPattern=function(e){var t,s,i,n=bundles.main.frames[e.image]||e.image,o=this.getParent(e);e.direction===cleverapps.UI.HORIZONTAL?(t=Math.ceil(o.width/e.step)-1,s=e.step,i=0):(t=Math.ceil(o.height/e.step)-1,s=0,i=e.step);var r=new cc.Node;r.setAnchorPoint2(),r.setLocalZOrder(e.zOrder||0);for(var a=0;a<t;++a){var c=new cc.Sprite(n);c.setAnchorPoint2(),c.setPositionRound(a*s,-a*i),r.addChild(c)}return r},Decors.prototype.getPos=function(e){return e.position&&Array.isArray(e.position)?e.position[cleverapps.wideMode.mode]:cc.p(e.x,e.y)},Decors.prototype.updateAll=function(){for(var e in this.decors){var t=this.decors[e],s=cleverapps.styles.Decorators[e],i=this.getPos(s);t.setPositionRound(i.x,i.y)}},Decors.TYPE_IMAGE=0,Decors.TYPE_ANIMATION=1,Decors.TYPE_SCALE9=2,Decors.TYPE_REPEATABLE=3;var RulesWindow=Window.extend({onWindowLoaded:function(e){
var t=cleverapps.overrideStyles(cleverapps.styles.RulesWindow,e.styles,!0),s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t.animation.width,t.animation.height);var i=new cleverapps.Spine(t.animation.json);i.setAnimation(0,t.animation.name,!0),i.setScale(t.animation.scale),i.setPositionRound(s.width/2+t.animation.x,s.height/2+t.animation.y),s.addChild(i);var n=t.font||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,o=cleverapps.UI.generateTTFText(t.prefix+"text3",n);o.setDimensions(t.subText.width,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(o),o.setPositionRound(t.subText.left.x,t.subText.left.y);var r=cleverapps.UI.generateTTFText(t.prefix+"text4",n);r.setDimensions(t.subText.width,0),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(r),r.setPositionRound(t.subText.right.x,t.subText.right.y);var a=cleverapps.UI.generateTTFText(t.prefix+"text1",n);a.setDimensions(t.text.width,0),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.addChild(a),
a.setPositionRound(t.subText.bottom.x,t.subText.bottom.y);var c=cleverapps.UI.generateTTFText(t.prefix+"text2",cleverapps.styles.FONTS.RULES_WINDOW_TEXT||t.text.font);c.setDimensions(t.text.width,0),c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),c.fitTo(void 0,t.text.height),c.setAnchorPoint2();var l=this.content=new cc.Node;l.addChild(c),l.addChild(s),cleverapps.UI.arrangeWithMargins(l.children,{margin:t.margin,y:t.paddingY}),cleverapps.UI.wrap(l),l.setAnchorPoint2(),this._super({title:t.prefix+"Title",name:e.name,content:l,bgOffset:t.bgOffset,button:{width:t.button.width,height:t.button.height,text:e.buttonText||Messages.get("OK"),onPressed:this.onPressed.bind(this)}})},onPressed:function(){this.close()},listBundles:function(e){return e&&e.bundles||[]}});cleverapps.styles.RulesWindow={width:600,height:800,margin:30,textMargin:30,paddingY:40,animation:{scale:.95,width:600,height:670,y:-85,x:0,name:"animation"},subText:{width:190,left:{x:{align:"left",dx:20},y:{align:"right",
dy:-180}},right:{x:{align:"right",dx:55},y:{align:"right",dy:-220}},bottom:{x:{align:"center",dx:0},y:{align:"left",dy:0}}},text:{width:640,height:300,font:cleverapps.styles.FONTS.WINDOW_TEXT},button:{width:250,height:100}};var BoostersSaleWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.mission.logic.onRewardListener=this.createListener(this.giveReward.bind(this)),this._super({content:this.getContent(),title:{text:"messages:BoostersSaleWindow.title",font:cleverapps.styles.FONTS.BOOSTERS_SALE_WINDOW_TITLE_TEXT},name:"boosterssalewindow",windowBg:bundles.boosters_sale.frames.window_bg_png,styles:cleverapps.overrideStyles(cleverapps.styles.Window,this.getStyles().window,!0)}),this.addBadge(),this.addBalloons(),this.addRibbonTitle(),this.addProgressBar(),this.addRepeatablePattern(),this.addDescriptionText(),this.addHeroAnimation(),this.text.width>this.window.width&&this.text.setScale(this.window.width/this.text.width),cleverapps.audio.playSound(
bundles.main.urls.sale_window_effect)},getStyles:function(){return cleverapps.styles.BoostersSaleWindow},createWinStreakBar:function(){var e=cleverapps.styles.BoostersSaleWindow.progressBar,t=cleverapps.UI.createScale9Sprite(bundles.boosters_sale.frames.boosterssale_streak_bar_bg);t.setLocalZOrder(1),e.width&&t.setContentSize2(e.width,t.height);var s=this.winStreakBar=new ScaledProgressBar(bundles.boosters_sale.frames.boosterssale_streak_bar);if(s.setDimension(e.bar.width||t.width,e.bar.height||t.height),s.setPosition(e.bar.x,e.bar.y),t.addChild(s),s.setLocalZOrder(e.bar.zOrder),e.bar.lines){var i=new cc.Sprite(bundles.boosters_sale.frames.boosterssale_streak_bar_line);i.setAnchorPoint2(),i.setPosition(t.width/2,t.height/2),t.addChild(i)}return t},updateBoughtAmountText:function(){this.boughtAmountText&&this.boughtAmountText.setString(this.mission.result+"/5")},addProgressBar:function(){var e=this.getStyles();this.progressBarText=cleverapps.UI.generateTTFText(
"messages:BoostersSaleWindow.progressBarText",cleverapps.styles.FONTS.BOOSTERS_SALE_PROGRESS_BAR_TEXT||cleverapps.styles.FONTS.WHITE_TEXT),this.progressBarText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.progressBarText.setDimensions(e.progressBar.text.width,0),this.progressBarText.fitTo(0,e.progressBar.text.height);var t=this.createWinStreakBar();this.winStreakBar.setPercentage(20*this.mission.result);var s=this.prizeNode=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.progressBar.prize),s.setScale(e.progressBar.prize.scale);var i=this.prizeAnimation=new cleverapps.Spine(e.progressBar.prize.animation.json);i.setAnimation(0,"green_idle_closed",!0),s.addChild(i),i.setPositionRound(e.progressBar.prize),cleverapps.tooltipManager.create(s,{rewards:this.mission.prize,text:Messages.get("TreasureSearch.prizeTooltip"),size:e.tooltip.size,position:e.tooltip});var n=new cleverapps.Layout([t,this.progressBarText],{direction:cleverapps.UI.VERTICAL,margin:e.progressBar.textMargin})
;if(e.progressBar.amount){var o=this.boughtAmountText=cleverapps.UI.generateTTFText(this.mission.result+"/5",cleverapps.styles.FONTS.BOOSTERS_SALE_PROGRESS_BAR_AMOUNT_TEXT||cleverapps.styles.FONTS.WHITE_TEXT);t.addChild(o),o.setPositionRound(e.progressBar.amount)}var r=new cleverapps.Layout([n,s],{direction:cleverapps.UI.HORIZONTAL,margin:e.progressBar.prizeMargin});this.progressBarLayout=r,this.window.addChild(r);var a=e.progressBar.insideWindow?1:-1;r.setPositionRound({x:{align:"center",dx:e.progressBar.dx},y:{align:"bottom",dy:a*(r.height/2+e.progressBar.marginY)}}),e.progressBar.scale&&r.setScale(e.progressBar.scale[cleverapps.wideMode.mode])},addRibbonTitle:function(){var e=this.getStyles().title;if(e.ribbonTitle){var t=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);this.window.addChild(t),t.setAnchorPoint2();var s=e.ribbonTitle.width;this.window.titleText.width+2*e.ribbonTitle.offsetX>s&&(
s=this.window.titleText.width+2*e.ribbonTitle.offsetX),t.setContentSize2(s,e.ribbonTitle.height),t.setPositionRound(this.window.titleText.x,this.window.titleText.y+e.ribbonTitle.y),t.setLocalZOrder(this.window.titleText.getLocalZOrder()-1)}},addBadge:function(){var e=this.getStyles().badge;if(e){var t=new cc.Sprite(bundles.boosters_sale.frames.badge_png),s=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.badge.text",cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT),i=cleverapps.UI.generateTTFText("90%",cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);t.setScale(e.scale),i.setScale(1.2);var n=new cleverapps.Layout([i,s],{direction:cleverapps.UI.VERTICAL,margin:e.margin});n.setRotation(e.rotation),t.addChild(n),n.setPositionRound(t.width/2,t.height/2),this.window.addChild(t),t.setPositionRound(e),t.setLocalZOrder(10)}},addBalloons:function(){this.getStyles().balloons.forEach(function(e){var t=new cleverapps.Spine(bundles.boosters_sale.jsons.balloon_json);t.setScaleX(e.scale),
t.setAnimation(0,"animation",!0),this.window.addChild(t),t.setPositionRound(this.window.width/2+e.x,this.window.height+e.y),t.setLocalZOrder(-1)}.bind(this))},addRepeatablePattern:function(){},addDescriptionText:function(){var e=cleverapps.styles.BoostersSaleWindow,t=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.descriptionText",cleverapps.styles.FONTS.BOOSTERS_SALE_DESCRIPTION_TEXT||cleverapps.styles.FONTS.WHITE_TEXT,{purchasesCount:BoostersSaleWindow.PURCHASES_TO_PRIZE});t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(e.progressBar.descriptionText.width[cleverapps.wideMode.mode]*resolutionScale,0),t.fitTo(void 0,e.progressBar.descriptionText.height),e.progressBar.insideWindow?this.window.addChild(t):this.progressBarLayout.addChild(t),t.setPositionRound({x:{align:"center"},y:{align:"bottom",dy:-t.height/2-e.progressBar.descriptionText.marginY}})},addHeroAnimation:function(){var e=cleverapps.styles.BoostersSaleWindow;if(e.heroAnimation){var t="idle"
;"tripeaks"===cleverapps.config.name&&(t="starterpack_800");var s=new cleverapps.Spine(bundles.hero.jsons.hero_json);s.setAnimation(0,t,!0),s.setPositionRound(e.heroAnimation.position[cleverapps.wideMode.mode]),s.setScale(e.heroAnimation.scale[cleverapps.wideMode.mode]),this.addChild(s)}},calcOldPrice:function(e){return cleverapps.payments.calcLoadedPrice?cleverapps.payments.calcLoadedPrice(e):Product.CURRENCY+" "+e},createIconsLayout:function(e){for(var t=bundles.boosters_sale.frames[e.icon]||bundles.reward_icons.frames[e.icon]||bundles.tile_shop.frames[e.icon]||bundles.main.frames[e.icon],s=this.getStyles(),i=[],n=0;n<5;n++){var o=new cc.Node;o.setAnchorPoint2(),o.setContentSize2(s.icons);var r=new cc.Sprite(t);o.addChild(r),r.setRotation(s.icons.rotation),r.setScale(s.icons.scale||Math.min(o.width/r.width,o.height/r.height)),r.setLocalZOrder(-n),r.setPositionRound(o.width/2,o.height/2),i.push(o)}return new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,
margin:s.icons.margins[cleverapps.wideMode.mode].margin})},getContent:function(){var w=this.getStyles(),T=[];this.mission.logic.listProducts(this.mission).forEach(function(e){var t,s=Product.Create(e),i=this.createIconsLayout(s);if(-1!==["cellPack2","linePack3","colorPack4"].indexOf(e)){var n;(n=new cc.Node).setAnchorPoint2();var o=i.width/10,r=i.height/3;n.setContentSize2(i.width+o,i.height+r/3);var a=this.createIconsLayout(s);i.setPositionRound(n.width/2+o/2,n.height/2+r/2),a.setPositionRound(n.width/2-o/2,n.height/2-r/2),n.addChild(i),n.addChild(a)}else n=i;w.icons.bg?(t=new cc.Scale9Sprite(w.icons.bg),w.icons.bgColor&&t.setColor(w.icons.bgColor)):(t=new cc.Node).setAnchorPoint2(),t.setContentSize2(n.width+2*w.icons.padding.x,n.height+2*w.icons.padding.y),t.addChild(n);var c=w.icons.offset;w.icons.offsetByType[this.mission.type]&&(c=w.icons.offsetByType[this.mission.type]),n.setPositionRound(t.width/2+c.x,t.height/2+c.y);var l=cleverapps.UI.generateOnlyText(s.label,
cleverapps.styles.FONTS.BOOSTERS_SALE_AMOUNT_TEXT);if(w.labelBg){var p=new cc.Scale9Sprite(bundles.boosters_sale.frames.label_bg_png);p.setContentSize2(l.width+2*w.labelBg.padding.x,l.height+2*w.labelBg.padding.y),p.addChild(l),t.addChild(p),l.setPositionRound(p.width/2,p.height/2+w.labelBg.text.dy),p.setPositionRound(w.label)}else t.addChild(l),l.setPositionRound(w.label);var d=cleverapps.UI.generateTTFText(Messages.get("BoostersSaleWindow.oldPrice"),cleverapps.styles.FONTS.BOOSTERS_SALE_PRICE_TEXT);d.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.fitTo(w.oldPriceText.width);var h=cleverapps.UI.generateTTFText(this.calcOldPrice(s.oldPrice),cleverapps.styles.FONTS.BOOSTERS_SALE_TEXT);h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),h.fitTo(w.oldPriceText.price.width);var u=new cleverapps.Layout([d,h],{direction:cleverapps.UI.HORIZONTAL,margin:w.oldPriceText.margin});d.setPositionRound({y:{align:"bottom"},x:d.x});var g=new cc.Node;g.setAnchorPoint2(),g.setContentSize2(
w.oldPriceText.width+w.oldPriceText.price.width,w.oldPriceText.height),g.addChild(u),u.setPositionRound(g.width/2,g.height/2);var v=new cleverapps.UI.Button({content:new ProductPriceView(s,{font:cleverapps.styles.FONTS.BOOSTERS_SALE_WINDOW_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT}),onClicked:function(){this.mission.completed||s.buy(function(){this.mission.update(1),this.winStreakBar.setPercentage(20*this.mission.result),this.updateBoughtAmountText()}.bind(this))}.bind(this),width:w.button.width,height:w.button.height,button_on_png:bundles.buttons_main.frames.small_green_button_on,button_png:bundles.buttons_main.frames.small_green_button});Lottery.addIcon(v);var m=new cleverapps.Layout([v,g],{direction:cleverapps.UI.VERTICAL,margin:w.button.margin,y:w.button.y}),f=new cleverapps.Layout([t,m],{direction:cleverapps.UI.HORIZONTAL,margin:w.colMargin,padding:w.row.padding[cleverapps.wideMode.mode]}),_=new cc.Scale9Sprite(bundles.boosters_sale.frames.row_bg_png||w.row.bg);if(
_.setContentSize2(f.getContentSize()),w.row.innerBg){var y=new cc.Scale9Sprite(w.row.innerBg.image);y.setContentSize2(_.width-2*w.row.innerBg.padding.x,_.height-2*w.row.innerBg.padding.y),_.addChild(y),y.setPositionRound(_.width/2,_.height/2)}_.addChild(f),f.setPositionRound(_.width/2,_.height/2),T.push(_)}.bind(this));var t=0;T.forEach(function(e){t=Math.max(t,e.getContentSize().width)}),T.forEach(function(e){e.setContentSize2(t,e.getContentSize().height)});var e=this.createText(),s=new cleverapps.Layout(T,{direction:cleverapps.UI.VERTICAL,margin:w.rowMargin});return new cleverapps.Layout([s,e],{direction:cleverapps.UI.VERTICAL,margin:w.margin})},openRewardWindow:function(){new RewardWindow({reward:this.mission.logic.reward})},giveReward:function(){this.winStreakBar.animatedChange(20),this.updateBoughtAmountText(),this.prizeAnimation.setCompleteListener(this.close.bind(this)),this.prizeAnimation.setAnimation(0,"green_open",!1),this.prizeNode.setLocalZOrder(20),
this.prizeNode.replaceParentSamePlace(this);var e=this.prizeNode.getPosition(),t=cc.p(this.width/2,this.height/2),s=cc.p((e.x+t.x)/2,2*(t.y-e.y));this.prizeNode.runAction(new cc.BezierTo(.5,[e,s,t]))},onClose:function(){this.mission.logic.reward&&this.openRewardWindow()},createText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textTop",cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);t.setDimensions(e.textTop.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var s=[];if(Messages.has("messages:BoostersSaleWindow.textLeft."+this.mission.type)){var i=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textLeft."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);s.push(i)}var n=cleverapps.UI.generateTTFText("messages:BoostersSaleWindow.textMiddle."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_RED_TEXT);s.push(n);var o=cleverapps.UI.generateTTFText(
"messages:BoostersSaleWindow.textRight."+this.mission.type,cleverapps.styles.FONTS.BOOSTERS_SALE_TOP_TEXT);s.push(o);var r=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:e.text.bottomMargin});return this.text=new cleverapps.Layout([r,t],{direction:cleverapps.UI.VERTICAL,margin:e.text.margin})}});BoostersSaleWindow.prototype.listBundles=function(){return["boosters_sale","reward_icons","tile_shop"]},BoostersSaleWindow.PURCHASES_TO_PRIZE=5,cleverapps.overrideFonts(cleverapps.styles.FONTS,{BOOSTERS_SALE_TEXT:{size:45,color:cleverapps.styles.COLORS.BOOSTERS_SALE_TEXT_COLOR},BOOSTERS_SALE_TOP_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE},BOOSTERS_SALE_TOP_RED_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_RED},BOOSTERS_SALE_PRICE_TEXT:{size:45,color:cleverapps.styles.COLORS.BOOSTERS_SALE_TEXT_COLOR},BOOSTERS_SALE_AMOUNT_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.BoostersSaleWindow={progressBar:{bar:{x:0,y:0,zOrder:0,interval:67,
lines:!0},dx:0,marginY:-21,prizeMargin:-40,textMargin:30,text:{width:400,height:50},prize:{width:100,height:100,x:50,y:30,scale:1.5,animation:{json:bundles.boosters_sale.jsons.prize_json}},descriptionText:{width:[390,600,600],height:90,marginY:50}},tooltip:{rewards:{x:{align:"center",dx:-20},y:{align:"top",dy:60}},size:{width:220,height:100}},button:{width:240,height:90,margin:10,y:0},title:{ribbonTitle:{width:620,height:120,y:-10,offsetX:40,scaleY:1.3}},icons:{x:-15,width:120,height:120,rotation:0,bg:bundles.boosters_sale.frames.product_bg_png,bgColor:cleverapps.styles.COLORS.COLOR_VERYLIGHTBROWN,margins:[{margin:-80},{margin:-50},{margin:-50}],offset:{x:0,y:0},offsetByType:{12:{x:0,y:20}},padding:{x:5,y:25}},label:{x:{align:"right",dx:-5},y:{align:"bottom",dy:5}},amount:{margin:-30},text:{margin:10,bottomMargin:8},textTop:{width:700},oldPriceText:{width:200,height:70,margin:8,price:{width:135}},badge:{x:{align:"left",dx:5},y:{align:"top",dy:100},rotation:-20,margin:-10,scale:1},row:{
bg:bundles.boosters_sale.frames.row_bg_png,padding:[{x:20,y:30},{x:30,y:30},{x:30,y:30}]},rowMargin:20,colMargin:20,margin:10,balloons:[{y:-165,x:-250,scale:-1},{y:-165,x:250,scale:1}],window:{contentOffset:-30,noBackground:{keepSize:!0},bgOffset:{y:20,x:0}}};var FavoriteSaleWindow=Window.extend({onWindowLoaded:function(e){this.mission=e;var t=this.getStyles();this._super({content:this.getContent(),title:this.getTitle(),name:"favoritesalewindow",button:{width:t.button.width,height:t.button.height,button_png:t.button.button_png,button_on_png:t.button.button_on_png,content:new ProductPriceView(this.mission.logic.product,{font:cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_TEXT}),onPressed:this.buyProduct.bind(this)},styles:cleverapps.overrideStyles(cleverapps.styles.Window,this.getStyles().window,!0)}),this.addBottomAnimation();var s=this.window.scaleX*this.window.width/(this.content.scaleX*this.content.width+t.content.paddingX);s<1&&(
this.content.setScaleX(this.content.getScaleX()*s),this.content.setScaleY(this.content.getScaleY()*s)),this.addRibbonTitle(),this.addHeroAnimation(),Lottery.addIcon(this.button),cleverapps.audio.playSound(bundles.main.urls.sale_window_effect)},addHeroAnimation:function(){var e=cleverapps.styles.FavoriteSaleWindow;if(e.heroAnimation){var t=new cleverapps.Spine(bundles.hero.jsons.hero_json);t.setAnimation(0,"idle",!0),t.setPositionRound(e.heroAnimation.position[cleverapps.wideMode.mode]),t.setScale(e.heroAnimation.scale[cleverapps.wideMode.mode]),this.addChild(t)}},addRibbonTitle:function(){var e=this.getStyles();if(e.title.ribbonTitle){var t=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);this.window.addChild(t),t.setAnchorPoint2(),t.setContentSize2(e.title.ribbonTitle),t.setPositionRound(this.window.titleText.x,this.window.titleText.y+e.title.ribbonTitle.y),t.setLocalZOrder(this.window.titleText.getLocalZOrder()-1)}},getStyles:function(
){return cleverapps.styles.FavoriteSaleWindow},getTitle:function(){return{text:"messages:FavoriteSaleWindow.title",font:cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_TITLE_TEXT}},buyProduct:function(){this.mission.logic.product.buy(function(){new RewardWindow({reward:this.mission.logic.getReward()}),this.close()}.bind(this))},createRewardsList:function(){var o=this.getStyles(),r=[],e=this.mission.logic.getReward(),t=function(e,t){var s=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_REWARDS_TEXT),i=new cc.Sprite(o.rewards.icons[e]);i.setScale(o.rewards.iconHeight/i.height);var n=[s,i];o.rewards.reverse&&n.reverse(),r.unshift(new cleverapps.Layout(n,{margin:o.rewards.textMargin,direction:o.rewards.direction}))};for(var s in e)if("unlimitedLives"===s)t(s,Product.FormatUnlimitedLives(e[s]).title);else if("boosters"===s)for(var i in e[s])t(i,"x"+e[s][i]);else t(s,e[s]);return new cleverapps.Layout(r,{margin:o.rewards.margin,direction:cleverapps.UI.VERTICAL})},
addBottomAnimation:function(){var e=this.getStyles();if(e.bottom){var t=new cleverapps.Spine(e.bottom.json);t.setAnimation(0,e.bottom.animation,!0);var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.bottom),s.addChild(t),t.setPositionRound(s.width/2+e.bottom.x,s.height/2+e.bottom.y),s.setScale(e.bottom.scale);var i=this.createInfoText(),n=new cc.Scale9Sprite(e.bottom.image);n.setContentSize(i.width+2*e.bottom.text.padding.x,i.height+2*e.bottom.text.padding.y),n.addChild(i),i.setPositionRound(n.width/2+e.bubble.offset.x,n.height/2+e.bubble.offset.y);var o=new cleverapps.Layout([s,n],{direction:cleverapps.UI.HORIZONTAL,margin:e.bottom.margin});this.window.addChild(o),o.setPositionRound(this.window.width/2+e.bottom.offset.x,-o.height/2+e.bottom.offset.y)}},createInfoText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:FavoriteSaleWindow.text",cleverapps.styles.FONTS.FAVORITE_SALE_WINDOW_BOTTOM_TEXT);return t.setDimensions(e.bottom.text.width,0),t.fitTo(
void 0,e.bottom.text.height),t},addBadge:function(){var e=this.getStyles().badge;if(e){var t=new cc.Sprite(bundles.tile_shop.frames.shop_badge_bestseller_png),s=Messages.get("messages:FavoriteSaleWindow.badge1")+"\n"+Messages.get("messages:FavoriteSaleWindow.badge2");this.content.addChild(t),t.setPositionRound(e),t.setScale(e.scale[cleverapps.wideMode.mode]),t.setRotation(e.rotation),cc.sys.isMobile&&e.mobile&&(t.setRotation(e.mobile.rotation),t.setPositionRound(t.getPositionX()+e.mobile.dx,t.getPositionY()+e.mobile.dy));var i=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.TILE_SHOP_BADGE_TEXT);t.addChild(i),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setPositionRound(e.text),i.fitTo(e.text.width),e.text.rotation&&i.setRotation(e.text.rotation),cc.sys.isMobile&&e.mobile&&e.mobile.text&&(i.setRotation(e.mobile.text.rotation),i.setScale(e.mobile.text.scale))}},getContent:function(){var e,t=this.getStyles();this.mission.logic.isPackProduct()?(e=new PackProductTile(
TileModel.Create(this.mission.logic.product),{noButton:!0,noTitle:!0,size:t.packTile.size})).setScale(t.packTile.scale):e=new CoinsProductTile(TileModel.Create(this.mission.logic.product),{noButton:!0,rewardsBlockNoBg:t.rewardsBlockNoBg,styles:cleverapps.overrideStyles(cleverapps.styles.CoinsProductSmallTile,{offset:{y:void 0===t.tile.offsetY?cleverapps.styles.CoinsProductSmallTile.offset.y:t.tile.offsetY}},!0)}),this.tile=e;var s=this.rewardsList=this.createRewardsList(),i=new cc.Sprite(bundles.favorite_sale.frames.plus_png);i.setScale(t.plus.scale);var n,o=this.content=new cleverapps.Layout([e,i,s],{margin:t.tilesMargin,direction:cleverapps.UI.HORIZONTAL});t.icon.light&&(t.icon.light.image?(n=new cc.Sprite(t.icon.light.image)).setScale(t.icon.light.scale):(n=new cleverapps.Spine(t.icon.light.json,t.icon.light.scale)).setAnimation(0,t.icon.light.animationName,"true"),this.content.addChild(n),n.setPositionRound(s.x+t.icon.light.offset.x,s.y+t.icon.light.offset.y),n.setLocalZOrder(-1))
;return this.timerLayout=this.createTimer(),o=new cleverapps.Layout([o,this.timerLayout],{direction:cleverapps.UI.VERTICAL,margin:t.margin}),this.addBadge(),o},createTimer:function(){var e=this.mission.finishTime()-Date.now();this.finished&&(e=0);var t=this.getStyles().timer,s={background_content:!1,font:cleverapps.styles.FONTS.FAVORITE_SALE_TIMER_TEXT||cleverapps.styles.FONTS.WHITE_TEXT},i=new cleverapps.CountDownView(new cleverapps.CountDown(e,{onFinish:function(){this.finished||(this.finished=!0,cleverapps.missionManager.remove(this.mission),this.runAsync(this.addLastChance.bind(this)))}.bind(this)}),s),n=[cleverapps.UI.generateTTFText(this.finished?"messages:FavoriteSaleWindow.lastChance":"messages:FavoriteSaleWindow.Expires",cleverapps.styles.FONTS.FAVORITE_SALE_TIMER_TEXT||cleverapps.styles.FONTS.WHITE_TEXT),i],o=new cleverapps.Layout(n,{margin:t.margin,direction:cleverapps.UI.HORIZONTAL}),r=this.timerBg=new cc.Scale9Sprite(
bundles.favorite_sale.frames.timer_bg_png||bundles.main.frames.timer_bg_png);return r.setContentSize2(o.width+2*t.padding.x,o.height+2*t.padding.y),o.addChild(r),r.setLocalZOrder(-1),r.setPositionRound(o.width/2,o.height/2),o},addLastChance:function(){var e=this.timerLayout.getPosition(),t=this.timerLayout.getParent();this.timerLayout.removeFromParent(!0),this.timerLayout=this.createTimer(),t.addChild(this.timerLayout),this.timerLayout.setPositionRound(e)},listBundles:function(){return["reward_icons","tile_shop","favorite_sale","dialogues"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{FAVORITE_SALE_WINDOW_BOTTOM_TEXT:{size:40,color:new cc.Color(130,70,40,255)},FAVORITE_SALE_WINDOW_REWARDS_TEXT:{size:40,color:new cc.Color(130,70,40,255)}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{FAVORITE_SALE_WINDOW_TITLE_TEXT:cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}),cleverapps.styles.FavoriteSaleWindow={plus:{scale:1},tilesMargin:3,margin:20,button:{width:280,height:100},timer:{
margin:15,scaleWithRewards:!0,padding:{x:10,y:5}},packTile:{scale:.9},icon:{scale:1.3,light:{json:bundles.favorite_sale.jsons.story_light_animation_json,animationName:"animation",scale:3.2,offset:{x:0,y:-20}}},bottom:{image:bundles.main.frames.tutorial_text_bg_png,margin:20,width:300,height:260,offset:{x:-50,y:0},x:0,y:0,scale:1,json:bundles.dialogues.jsons.default_json,animation:"animation",text:{padding:{x:30,y:15},width:350,height:250}},bubble:{offset:{x:20,y:0}},rewards:{margin:40,textMargin:2,iconHeight:90,icons:{unlimitedLives:bundles.reward_icons.frames.life_unlim,exp:bundles.reward_icons.frames.reward_exp_png,stars:bundles.reward_icons.frames.stars_png,gold:bundles.tile_shop.frames.shop_gold4_png,0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.coin_png,4:bundles.reward_icons.frames.joker_png,5:bundles.reward_icons.frames.coin_png,6:bundles.reward_icons.frames.coin_png,
7:bundles.reward_icons.frames.coin_png,8:bundles.reward_icons.frames.hat,9:bundles.reward_icons.frames.pot,10:bundles.reward_icons.frames.magnet_small_png,11:bundles.reward_icons.frames.dice_small_png,12:bundles.reward_icons.frames.joker_small_png,13:bundles.reward_icons.frames.highlight,14:bundles.reward_icons.frames.eye,15:bundles.reward_icons.frames.hint},direction:cleverapps.UI.HORIZONTAL},badge:{text:{width:120,height:120,x:{align:"center",dx:0},y:{align:"center",dy:0}},x:{align:"right",dx:60},y:{align:"center",dy:-220},scale:[.9,1.2,1.2],rotation:15},content:{paddingX:80},title:{},window:{bgOffset:{y:90,x:0},Border:{y:170},contentOffset:0},tile:{offsetY:void 0}},cleverapps.FBLike={prepareCode:function(e){var t=cleverapps.config.facebook.url,s=cleverapps.config.helpURL.default,i=cleverapps.config.title,
n='<div id=\'social\'>  <div class="fb-page" data-href="%{GROUP_LINK}" data-width="%{WIDTH}" data-small-header="false" data-adapt-container-width="true" data-hide-cover="false" data-show-facepile="true"><blockquote cite="%{GROUP_LINK}" class="fb-xfbml-parse-ignore"><a href="%{GROUP_LINK}">%{TITLE} Community</a></blockquote></div>  <br/>\n  <div class="fb-like" \n    data-href="%{LINK}" \n    data-layout="standard" \n    data-action="like" \n    data-show-faces="true">\n  </div></div>'.replace("%{LINK}",t);return n=(n=(n=(n=(n=n.replace("%{TITLE}",i)).replace("%{GROUP_LINK}",s)).replace("%{GROUP_LINK}",s)).replace("%{GROUP_LINK}",s)).replace("%{WIDTH}",e)},prepareCodeOK:function(){return'<div id=\'social\'>  <div class="fb-page" id="groupWidget"></div>  <br/>\n  <div id="likeWidget"></div></div>'},processCode:function(){"undefined"!=typeof FB&&FB.XFBML.parse(document.getElementById("social"))},onResize:function(){var e=document.getElementById("RightBg"),t="block";parseInt(e.style.width
)<260&&(t="none"),document.getElementById("social").style.display=t},processCodeOK:function(s){cleverapps.loadSdk("//connect.ok.ru/connect.js",{onSuccess:function(){var e=cleverapps.config.web_ok.url,t=cleverapps.config.helpURL.web_ok.match(/group\/(.*)/)[1];OK.CONNECT.insertGroupWidget("groupWidget",t,"{width:"+s+", height:335}"),OK.CONNECT.insertShareWidget("likeWidget",e,"{width:"+s+",height:100,st:'oval',sz:30,ck:1}")},onFailure:function(){console.log("Can't load ok sdk for widget!")}})},isAppropriate:function(){return-1!==["facebook","web_ok"].indexOf(cleverapps.User.calcSource())},createLikeButtons:function(){if(cleverapps.FBLike.isAppropriate()&&"undefined"!=typeof document){var e=document.getElementById("RightBg");if(!e)return;var t=parseInt(e.style.width),s=t<260;t=260,(cleverapps.isLocalhost()||"web_ok"===cleverapps.User.calcSource())&&cleverapps.config.web_ok&&cleverapps.config.web_ok.url&&cleverapps.config.helpURL&&cleverapps.config.helpURL.web_ok&&(
cleverapps.FBLike.prepareCode=cleverapps.FBLike.prepareCodeOK,cleverapps.FBLike.processCode=cleverapps.FBLike.processCodeOK),e.insertAdjacentHTML("afterbegin",cleverapps.FBLike.prepareCode(t)),cleverapps.FBLike.processCode(t),s&&(document.getElementById("social").style.display="none"),cleverapps.afterResolutionChanged(cleverapps.FBLike.onResize)}}},cleverapps.NativeLinks={onResize:function(){var e=document.getElementById("LeftBg"),t="block";parseInt(e.style.width)<250&&(t="none"),document.getElementsByClassName("store-links")[0].style.display=t},createLinks:function(){if(cleverapps.NativeLinks.isAppropriate()){var i=bundles.store_links,e=["amazon","android","ios"].map(function(e){var t={android:i.urls.android_png,ios:i.urls.ios_png,amazon:i.urls.amazon_png}[e],s=cleverapps.config[e]&&cleverapps.config[e].url;if(s&&t)return{link:s,image:t}}).filter(function(e){return void 0!==e}),t=document.getElementById("LeftBg"),s=0;t&&t.style&&t.style.width&&(s=parseInt(t.style.width)),
0<document.getElementsByClassName("store-links").length||(t.insertAdjacentHTML("afterbegin",'<div class="store-links" />'),p=document.getElementsByClassName("store-links")[0],e.forEach(function(e){var t='<a target="_blank" href="%{LINK}">   <img src="%{IMAGE}"/ width=\'246px\' height=\'72px\'></a>'.replace("%{LINK}",e.link);t=t.replace("%{IMAGE}",e.image),p.insertAdjacentHTML("afterbegin",t)}),s<250&&(document.getElementsByClassName("store-links")[0].style.display="none"),cleverapps.afterResolutionChanged(cleverapps.NativeLinks.onResize))}},isAppropriate:function(){return!cc.sys.isMobile&&!cleverapps.screenshotsMode&&-1===["web_mm","mobile_mm","web_ok","mobile_ok","web_vk","mobile_vk","huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())}};var FriendView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint(.5,.5),"invite"===e.type&&(e.avatar=bundles.main.frames.avatar_invite_friend);var s=cleverapps.styles.FriendView;this.setContentSize2(s.width,s.height)
;var i,n=new cleverapps.UI.Avatar(e);n.setPositionRound(this.width/2,this.height-n.height/2-s.avatar.y),n.setScale(s.avatar.scale),n.baseScale=n.scale,n.setAnchorPoint2(),this.addChild(n),"invite"===e.type?((i=this.score=new cleverapps.UI.Button({button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,text:Messages.get("LevelStartWindow.Button.Invite"),font:cleverapps.styles.FONTS.HIGHSCORE_INVITE_TEXT,width:s.invite.button.width,height:s.invite.button.height,onClicked:this.inviteFriend.bind(this)})).setCascadeOpacityEnabled(!0),cleverapps.UI.applyHover(n),cleverapps.UI.onClick(n,this.inviteFriend.bind(this))):(i=this.score=cleverapps.UI.generateTTFText(e.score,cleverapps.styles.FONTS.HIGH_SCORE_FONT)).setAnchorPoint2(.5,.5),i.setPositionRound(this.width/2,s.score.y),this.addChild(i),t<3&&"invite"!==e.type&&(this.cup=new cc.Sprite(bundles.main.frames["levelstart_cup_"+(t+1)]),this.cup.setLocalZOrder(1),n.addChild(this.cup)
,this.cup.setPositionRound(s.cup.x,s.cup.y)),setTimeout(function(){this.showAnimation(t)}.bind(this),0)},inviteFriend:function(){cleverapps.history.add("invt",1),cleverapps.social.inviteFriends({message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this},function(e){e===cleverapps.Social.CODE_SUCCEED&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HIGHSCORE_INVITE)}.bind(this))},showAnimation:function(e){var t=.5-.1*e,s=function(e){e.baseScale=e.scale,e.scale=0,e.opacity=0,e.runAction(new cc.Sequence(new cc.DelayTime(t+6*.1),new cc.Spawn(new cc.ScaleTo(.2,e.baseScale).easing(cc.easeBackOut()),new cc.FadeIn(.2))))};this.cup&&s(this.cup),s(this.score),this.scale=0,this.runAction(new cc.Sequence(new cc.DelayTime(t+.2),new cc.ScaleTo(.2,1)))}});cleverapps.styles.FriendView={avatar:{margin:{x:10},scale:.8,y:4},score:{margin:{x:120},y:150},cup:{x:{align:"right",dx:34},y:{align:"bottom",dy:-6}},invite:{button:{
width:100,height:46}},width:100,height:290};var HeroView=cleverapps.Spine.extend({ctor:function(e){var t=(e=e&&0<Object.keys(e).length?cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.HeroView,!0),e):cleverapps.styles.HeroView).vertical||{},s=e.scale||1;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(s=t.scale||s),this._super(e.json,s);var i=e;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&void 0!==t.x&&void 0!==t.y&&(i=t),this.setPositionRound(i);var n=e.start||e.name||e.animation,o=e.idle;n&&o?this.setAnimationAndIdleAfter(n,o):n?this.setAnimation(0,n,!1):o&&this.setAnimation(0,o,!0)},onEnter:function(){this._super(),this.visible=!1,this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){var e=this.getPosition();this.y=.5*-this.height,this.visible=!0,this.runAction(new cc.MoveTo(.5,e).easing(cc.easeBackOut()))}.bind(this))))}});cleverapps.styles.HeroView={json:bundles.hero.jsons.hero_json,idle:"starterpack_800",x:600,y:410,
scale:.7,vertical:{scale:.55,x:420,y:310}};var HighScoresComponent=function(e){var t=e.level,s=e.parent,i=cleverapps.styles.HighScoresComponent;if(i&&i.active&&t.isRegular()){var n=t.episode.friendsResults&&t.episode.friendsResults.listFriendResults(t.levelNo);if(!n||0===n.length)return InviteComponent({level:t,parent:s});var o=new cc.Node;if(i.useRibbonTitle){var r=1.2*i.width,a=i.height/2.2,c=cleverapps.UI.createScale9Sprite(bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);c.setContentSize2(r,a),c.setPositionRound(i.width/2,i.height-.45*a);var l=cleverapps.UI.createScale9Sprite(bundles.main.frames.window_bg_light_png);l.setContentSize2(i.width,i.height),l.setAnchorPoint(0,0),l.setLocalZOrder(-1),o.addChild(l),o.addChild(c)}if(o.setAnchorPoint(.5,.5),o.setContentSize2(i.width,i.height),o.setPositionRound(s.width/2,o.height/2+cleverapps.UI.getSceneOffsetY()),s.window.y+=(o.height/2+o.y)/2+i.windowY,s.addChild(o),i.Title){var p=cleverapps.UI.generateTTFText(
"messages:LevelStartWindow.HighScoresTitle",cleverapps.styles.FONTS.HIGHSCORE_TITLE_TEXT);p.setPositionRound(o.width/2,o.height-p.height/2+i.Title.y),p.setAnchorPoint2(),o.addChild(p)}o.visible=!1;var d=o.getPosition();o.setPositionRound(o.x,-2*o.height),o.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ToggleVisibility,new cc.MoveTo(.2,d)));for(var h=t.episode.friendsResults.listTop4(t.levelNo,!0);h.length<5;)h.push({type:"invite"});var u=h.map(function(e,t){var s=new FriendView(e,t);return s.setLocalZOrder(5-t),o.addChild(s),s});cleverapps.UI.arrangeWithMargins(u,{direction:cleverapps.UI.HORIZONTAL,x:i.Friend.x,y:i.Friend.y,margin:i.Friend.margin})}};cleverapps.overrideFonts(cleverapps.styles.FONTS,{HIGHSCORE_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.HighScoresComponent={active:!0,useRibbonTitle:!0,position:{x:{align:"center"},y:{align:"bottom"}},windowY:-30,width:670,height:270,Friend:{x:48,y:40,margin:20},Title:{y:-12}}
;var HardLevelDecorationComponent=function(e){var t=e.parent,s=t.decors,i=cleverapps.styles.HardLevelDecorationComponent;if(i.active&&s&&t.level.isHard()){Object.keys(i.off).forEach(function(e){s.setVisible(e,!1)}),Object.keys(i.on).forEach(function(e){s.add(e)});var n=s.getDecorById("hard_level_title_bg");if(n){var o=cleverapps.styles.Decorators.hard_level_title_bg;n.setContentSize2(t.window.width-o.offsetWidth,o.height)}var r=s.getDecorById("hardLevelSign");r&&(t instanceof VictoryWindow?s.setVisible("hardLevelSign",!1):(s.setVisible("hardLevelSignVictoryWindow",!1),this.runHardLevelAnimation(r)))}};HardLevelDecorationComponent.prototype.runHardLevelAnimation=function(e){var t=e.baseScale;e.setScale(.1*t),e.setVisible(!1),e.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(function(){e.setVisible(!0)}),new cc.ScaleTo(.5,1.1*t).easing(cc.easeBackOut()),new cc.CallFunc(function(){e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,.9*t).easing(cc.easeIn(1)),
new cc.ScaleTo(.5,1.1*t))))})))},cleverapps.styles.HardLevelDecorationComponent={active:!0,on:{},off:{}};var ScoreComponent=function(e){var t=e.level,s=e.score;if(void 0!==s||!t.isRegular()||(s=cleverapps.userresult.getScoresForLevel(t.episode.episodeNo,t.levelNo))){var i=[],n=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.VERY_BIG_TEXT);if(i.push(n),!e.victory){var o=cleverapps.UI.generateTTFText("messages:LevelStartWindow.YourScore",cleverapps.styles.FONTS.WINDOW_BIG_TEXT);i.push(o)}var r=new cleverapps.Spine(bundles.windows.jsons.score_animation_json||bundles.main.jsons.score_animation_json);r.setLocalZOrder(-1),r.setScale(.3),r.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.ScoreComponent.bg.delay),new cc.ScaleTo(.3,1).easing(new cc.easeBackOut),new cc.CallFunc(function(){r.setAnimation(0,"animation",!0)})));var a=new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,padding:cleverapps.styles.ScoreComponent.padding});if(a.addChild(r),r.setPosition(n.x,n.y
),e.victory){var c=0;n.updateTweenAction=function(e,t){++c%3==0&&n.setString(Math.round(e))},n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.Spawn(new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.show_score_effect)}),new cc.CallFunc(function(){cc.sys.isNative||n.runAction(new cc.Sequence(new cc.ActionTween(1.7,"score",0,s).easing(cc.easeCubicActionOut()),new cc.CallFunc(function(){n.setString(s),n.setAnchorPoint2()})))}))))}return a}};cleverapps.styles.ScoreComponent={enabled:!0,padding:{x:0,y:0},bg:{delay:0}};var StarsComponent=function(e){var t=cleverapps.styles.StarsComponent,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t);var i=new cleverapps.Spine(t.animation.json),n=e.stars;if(i.setAnimation(0,""+n,!1),i.setPositionRound({x:{align:"center"},y:{align:"center"}}),s.addChild(i),!e.victory)for(var o=function(e){s.runAction(new cc.Sequence(new cc.DelayTime(t.sound.duration*e),
new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls["star_"+e+"_effect"])})))},r=1;r<=e.stars;r++)o(r);return s};cleverapps.styles.StarsComponent={sound:{duration:.7},animation:{json:bundles.main.jsons.levelstart_stars_json},width:560,height:220};var VictoryAnimationComponent=cc.Node.extend({ctor:function(e){var t=e.victory?cleverapps.styles.VictoryAnimationComponent.victory:cleverapps.styles.VictoryAnimationComponent.levelstart;this._super(),this.setLocalZOrder(t.zOrder||0),this.setContentSize2(t.width,t.height),this.setAnchorPoint2();var s=this.animation=new cleverapps.Spine(t.json);if(s.setPositionRound(this.width/2,this.height/2+(t.y||0)),this.addChild(s),t.idle?(cleverapps.audio.playSound(t.sound),s.setAnimation(0,t.animation,!1),s.setCompleteListener(function(){s.setAnimation(0,t.idle,!0)})):s.setAnimation(0,t.animation,!0),e.victory&&cleverapps.styles.VictoryWindow.victoryText){var i=cleverapps.UI.generateTTFText("messages:VICTORY",
cleverapps.styles.FONTS.VICTORY_TEXT);i.setPositionRound(this.width/2,this.height/2+cleverapps.styles.VictoryWindow.victoryText.y),i.setScale(.3),i.runAction(new cc.ScaleTo(.2,1)),this.addChild(i)}}});VictoryAnimationComponent.prototype.onClose=function(e){this.animation.setCompleteListener(e),this.animation.setAnimation(0,"finish",!1)},cleverapps.styles.VictoryAnimationComponent={levelstart:{animation:"animation",json:bundles.main.jsons.victory_animation_json,width:456,height:370},victory:{json:bundles.game.jsons.victory2_spine_json,animation:"victory_start",idle:"idle",sound:bundles.game.urls.rocket_effect,zOrder:1,width:400,height:240}};var RewardsListComponent=cc.Node.extend({ctor:function(e,t){this._super(),this.reward=e,this.options=t||{},this.targets={},this.createContent()},createContent:function(){var e=cleverapps.styles.RewardsListComponent,t=this.list=this.createList();t.forEach(function(e){cleverapps.UI.wrap(e)});var s=[];if(this.options.title){
var i=cleverapps.UI.generateOnlyText(this.options.title.text||this.options.title,this.options.font);this.options.title.direction===cleverapps.UI.HORIZONTAL?t.unshift(i):s.push(i)}for(var n=0,o=this.options.amountInRow||3;n<t.length;){var r=new cleverapps.Layout(t.slice(n,n+o),{direction:this.options.direction||cleverapps.UI.HORIZONTAL,align:this.options.align||cleverapps.UI.ALIGN_CENTER,margin:this.options.margin||e.margin});s.unshift(r),n+=o}this.content=new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:e.margin}),this.addChild(this.content),this.setContentSize2(this.content),this.setAnchorPoint2(),this.content.setPositionRound(this.width/2,this.height/2)},createOneReward:function(e,t,s,i,n){if(void 0===i)return s.icon=s,this.targets[e]=s;var o=cleverapps.styles.RewardsListComponent,r=this.options.font||cleverapps.styles.FONTS.REWARDS_LIST_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT;i=this.options.onlyText?cleverapps.UI.generateOnlyText(i,r,n
):cleverapps.UI.generateTTFText(i,r,n),this.options.iconScale&&s.setScale(this.options.iconScale);var a=[i,s],c=cleverapps.UI.VERTICAL;this.options.reward&&this.options.reward.direction===cleverapps.UI.HORIZONTAL&&(c=cleverapps.UI.HORIZONTAL,a=a.reverse());var l=this.targets[e]=new cleverapps.Layout(a,{direction:c,margin:o.box.margin});return l.icon=s,l.text=i,l.reward=t,l},createList:function(){var e=cleverapps.styles.RewardsListComponent,t=this.reward,s=[],i="x";if(this.options.reward&&void 0!==this.options.reward.amountPrefix&&(i=this.options.reward.amountPrefix),void 0!==t.boosters)for(var n in t.boosters)t.boosters[n]&&s.push(this.createOneReward("boosters_"+n,t.boosters[n],new cc.Sprite(e.boosters.icons[n]),i+t.boosters[n]));if(void 0!==t.gold&&s.push(this.createOneReward("gold",t.gold,new cc.Sprite(bundles.reward_icons.frames.reward_gold_png),i+t.gold)),void 0!==t.exp&&levels.user.expAvailable()&&s.push(this.createOneReward("exp",t.exp,new cc.Sprite(
bundles.reward_icons.frames.reward_exp_png),i+t.exp)),void 0!==t.unlimitedLives&&(t.unlimitedLives=Product.FormatUnlimitedLives(t.unlimitedLives),s.push(this.createOneReward("unlimitedLives",t.unlimitedLives,new cc.Sprite(bundles.reward_icons.frames.life_unlim),t.unlimitedLives.title,{amount:t.unlimitedLives.amount}))),void 0!==t.battlePass){var o=new cleverapps.Spine(bundles.battle_pass.jsons.ticket_json);o.setAnimation(0,"animation",!0),s.push(this.createOneReward("battlePass",t.battlePass,o,"messages:BattlePassProduct.Title"))}if(void 0!==t.coins&&s.push(this.createOneReward("coins",t.coins,new cc.Sprite(bundles.reward_icons.frames.reward_coin_png),i+t.coins)),void 0!==t.rubies&&s.push(this.createOneReward("rubies",t.rubies,new cc.Sprite(bundles.reward_icons.frames.reward_gold_png),i+t.rubies)),void 0!==t.energy&&s.push(this.createOneReward("energy",t.energy,new cc.Sprite(bundles.reward_icons.frames.reward_energy_png),i+t.energy)),void 0!==t.wands&&s.push(this.createOneReward(
"wands",t.wands,new cc.Sprite(bundles.reward_icons.frames.reward_wand_png),i+t.wands)),void 0!==t.worker&&(t.worker=Product.FormatUnlimitedLives(t.worker),s.push(this.createOneReward("worker",t.worker,new cc.Sprite(bundles.reward_icons.frames.reward_worker_png),t.worker.title,{amount:t.worker.amount}))),void 0!==t.unit)for(var r=0,a=cleverapps.toArray(t.unit);r<a.length;++r){var c=a[r];if(this.options.noImage){var l=Messages.get("messages:Units."+c.code+".stage"+(c.stage+1)+".name");c.amount&&1<c.amount&&(l+=" "+i+c.amount),s.push(cleverapps.UI.generateOnlyText(l,this.options.font))}else{var p=UnitView.getUnitImage(c);p&&s.push(this.createOneReward("unit_"+Unit.GetKey(c),c,p,i+c.amount))}}if(void 0!==t.lives&&s.push(this.createOneReward("lives",t.lives,new cc.Sprite(bundles.main.frames.life_reward_png||bundles.main.frames.level_failed_heart_png||bundles.reward_icons.frames.reward_energy_png),i+t.lives)),void 0!==t.stars&&s.push(this.createOneReward("stars",t.stars,new cc.Sprite(
bundles.reward_icons.frames.stars_png),i+t.stars)),void 0!==t.gun){if((h=new cc.Node).setAnchorPoint2(),h.setContentSize2(e.gun.width,e.gun.height),e.gun.animation){(v=new cleverapps.Spine(e.gun.animation.json,e.gun.scale)).setContentSize2(h.getContentSize()),v.spine.setPositionRound(v.width/2+e.gun.x,v.height/2+e.gun.y),v.setAnimation(0,e.gun.animation.name,!0),h.addChild(v)}else{var d=new cc.Sprite(bundles.game.frames.gun_icon);h.addChild(d),d.setPositionRound(h.width/2,h.height/2)}s.push(this.createOneReward("gun",t.gun,h))}if(t.wardrobe&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_WARDROBE)){var h,u=cleverapps.styles.WardrobeWindow.person;(h=new cc.Node).setAnchorPoint2(),h.setContentSize2(e.wardrobe.width,e.wardrobe.height);var g=new cleverapps.Spine(u.json,u.scale);g.setAnimation(0,"idle",!0),h.addChild(g),s.push(this.createOneReward("wardrobe",t.wardrobe,h))}if(void 0!==t.herolevels&&Array.isArray(t.herolevels)&&0<t.herolevels.length)for(
r=0;r<t.herolevels.length;r++){var v,m=t.herolevels[r][0].toUpperCase(),f=new cc.Node;f.setAnchorPoint2(),f.setContentSize2(e.herolevel.heroBuilding.width,e.herolevel.heroBuilding.height),(v=new cleverapps.Spine(bundles.heroes.jsons[m+"_hero_spine_json"],e.herolevel.heroBuilding.scale)).setSkin(match3.heroes.getCurrentSkin()),v.setAnimation(0,"idle",!0),f.addChild(v);var _=new cleverapps.Layout([f],{direction:cleverapps.UI.VERTICAL}),y=new cc.Node;y.setContentSize2(e.herolevel.animation.width,e.herolevel.animation.height),v.setPositionRound(f.width/2,f.height/2+e.herolevel.animation.offsetY),y.addChild(_),_.setPositionRound(y.width/2,y.height/2),y.setPositionRound({x:{align:"center"},y:{align:"center"}});var w=cleverapps.UI.createScale9Sprite(e.herolevel.levelBlock.bg);w.setContentSize2(e.herolevel.levelBlock.width,e.herolevel.levelBlock.height),w.setPositionRound(e.herolevel.levelBlock.x,e.herolevel.levelBlock.y),f.addChild(w);var T=cleverapps.UI.generateImageText(Math.max(0,Math.min(
Heroes.HEROES_MAX_LEVEL,t.herolevels[r][1])),cleverapps.styles.FONTS.WINDOW_WHITE_TEXT);T.setPositionRound(w.width/2,w.height/2),w.addChild(T),s.push(y)}return s},iterateRewards:function(e){for(var t in this.targets){var s=this.targets[t];s&&(0===t.indexOf("boosters")?e(s,t,this.reward.boosters[t.split("_")[1]]):e(s,t,s.reward))}}});cleverapps.styles.RewardsListComponent={margin:30,box:{margin:10},boosters:{icons:{0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.hint_icon_png}},gun:{width:100,height:100,y:0,x:0,animation:{json:bundles.game.jsons.gun_animation_json,name:"idle"}},wardrobe:{width:150,height:150},herolevel:{levelBlock:{bg:bundles.heroes&&bundles.heroes.frames.heroes_level_bg||bundles.main.frames.heroes_level_bg,width:70,height:50,x:120,y:-40},animation:{width:200,height:250,offsetY:-40},heroBuilding:{width:120,height:120,scale:1.5},additionalText:{x:0,y:0}}}
;var MinigameRewardsComponent=cleverapps.Layout.extend({ctor:function(e){var t=RewardsHelper.getDisplayData(e,{itemsPrefix:"x",short:!0});if(1===cleverapps.values(t).length){var s=new RewardsListComponent(e,{direction:cleverapps.UI.VERTICAL,font:cleverapps.styles.FONTS.MINIGAME_REWARD});s.setScale(cleverapps.styles.MinigameRewardsComponent.itemSize.width/s.width),this.items=[s]}else this.items=cleverapps.values(t).map(function(e,t){return this.createReward(e.img,e.txt,0==t)}.bind(this));this._super(this.items,{direction:cleverapps.UI.VERTICAL}),e.unlimitedLives&&(e.unlimitedLives=Product.FormatUnlimitedLives(e.unlimitedLives))},createReward:function(e,t,s){var i=cleverapps.styles.MinigameRewardsComponent,n=new cc.Node;if(n.setAnchorPoint2(),n.setContentSize2(i.itemSize),!s&&i.separator){var o=new cc.Sprite(i.separator.image);o.setAnchorPoint2(),o.setPositionRound({align:"center"},{align:"bottom"}),n.addChild(o),n.setContentSize2(i.itemSize.width,i.itemSize.height+o.height)}
var r=new cc.Sprite(e);r.setAnchorPoint2(),r.setPositionRound({align:"left"},{align:"center",dy:o?o.height/2:0}),r.setScale(.8*i.iconHeight/r.height),n.addChild(r);var a=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.MINIGAME_REWARD),c=i.itemSize.width-r.width*r.scaleX-i.iconTextSpacing;return a.width>c&&a.fitTo(c),a.setAnchorPoint2(),a.setPositionRound({align:"right"},{align:"center",dy:(o?o.height/2:0)+i.textOffsetY}),n.addChild(a),n}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MINIGAME_REWARD:{name:"nostroke",size:40,color:cleverapps.styles.COLORS.MINIGAME_REWARD_TEXT}}),cleverapps.styles.MinigameRewardsComponent={separator:{image:bundles.windows.frames.lottery_items_dots_png},itemSize:{width:160,height:60},iconHeight:60,iconTextSpacing:20,textOffsetY:0};var InviteComponent=function(e){var t=cleverapps.FBLoginOrInvite();if(t){var s=cleverapps.styles.InviteComponent;e.parent.addChild(t),e.parent.window.y+=(t.height/2+t.y)/2+s.y}};cleverapps.styles.InviteComponent={
y:-10};var RoundResultsComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2();var a=cleverapps.styles.RoundResultsComponent,t=e.competition.getResults().sort(function(e,t){return e.player?-1:1}),c=!1;this.perWordTime=.05,this.maxWords=Math.max(t[0].amount,t[1].amount),this.views=t.map(function(e){var t,s=new cleverapps.UI.Avatar(e),i=e.amount,n=0;0<i&&(n=this.perWordTime*(this.maxWords/i)),.2<n&&(n=.2);var o=new AnimatedCounterComponent({from:0,to:i,font:cleverapps.styles.FONTS.ROUND_WORDS_TEXT,time:n,onFinish:function(){cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isWinner(e.id)?this.runWinAnimation(t):this.runLoseAnimation(t)}.bind(this)});cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isWinner(e.id)||(s.setCascadeColorEnabled(!0),s.runAction(new cc.TintTo(this.perWordTime*this.maxWords,120,120,120)));var r=(t=new cleverapps.Layout([o,s],{direction:cleverapps.UI.VERTICAL,margin:a.margin})
).name=cleverapps.UI.generateTTFText(GridPlayerNameView.FormatName(e.name),cleverapps.styles.FONTS.ROUND_NAME_TEXT);return r.width>a.name.width&&(c=!0),t.addChild(r),r.setPositionRound(t.width/2,t.height+a.margin+r.height/2),t.avatar=s,t.words=o,t.name=r,t.player=e,t},this),this.user=this.views[0],this.opponent=this.views[1],c&&this.views.forEach(function(e){e.name.setFont(cleverapps.styles.FONTS.ROUND_NAME_SMALL_TEXT),e.name.setPositionRound(e.width/2,e.height+a.margin+e.name.height/2)}),this.content=new cleverapps.Layout(this.views,{direction:cleverapps.UI.HORIZONTAL,margin:a.playersMargin}),this.setContentSize2(this.content.getContentSize()),this.addChild(this.content),this.content.setPositionRound(this.width/2,this.height/2),this.runAnimation()},runAnimation:function(){this.views.forEach(function(e){e.words.runAnimation()},this)},runWinAnimation:function(e){var t=cleverapps.styles.RoundResultsComponent.animation.user;e.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.Spawn(
new cc.ScaleTo(.4,1.3).easing(cc.easeOut(2)),new cc.MoveTo(.6,cc.p(this.content.width/2,e.y+t.dy)))))},runLoseAnimation:function(e){var t=cc.director.getRunningScene().scene,s=0;0===e.player.amount&&(s=this.perWordTime*this.maxWords),e.runAction(new cc.Sequence(new cc.DelayTime(s),new cc.CallFunc(function(){e.name.setVisible(!1),e.words.setVisible(!1),e.avatar.replaceParentSamePlace(t),e.avatar.setLocalZOrder(100),e.avatar.runAction(new cc.RepeatForever(new cc.RotateBy(1,180))),e.avatar.runAction(new cc.Sequence(new cc.MoveTo(1.2,cc.p(e.avatar.x,-e.avatar.height/2)).easing(cc.easeIn(2)),new cc.RemoveSelf)),cleverapps.audio.playSound(bundles.game.urls.tournament_player_lose_effect)}.bind(this))))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{ROUND_WORDS_TEXT:{name:"nostroke",size:60,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_NAME_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_NAME_SMALL_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN}}),
cleverapps.styles.RoundResultsComponent={animation:{user:{dy:-30},opponent:{}},name:{width:180},margin:10,playersMargin:90};var VictoryWindowHero=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.VictoryWindowHero;this.setContentSize2(e.size),this.setAnchorPoint2();var t=e;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(t=e.mobile),this.setPositionRound(t),this.setLocalZOrder(1),this.hero=new cleverapps.Spine(bundles.hero.jsons.hero_json,e.animation.scale),this.addChild(this.hero),this.hero.setPositionRound(this.width/2,this.height/2),this.hero.setAnimation(0,e.animation.idle,!0)},hide:function(){var e=cleverapps.styles.VictoryWindowHero;this.runAction(new cc.Sequence(new cc.MoveTo(.15,cc.p(this.x,this.y+e.moveUp.dy)).easing(cc.easeOut(2)),new cc.MoveTo(.3,cc.p(this.x,-this.height/2)).easing(cc.easeIn(3))))},show:function(){var e=cleverapps.styles.VictoryWindowHero,t=this.getPosition();this.setPositionRound(this.x,-this.height/2),this.runAction(
new cc.Sequence(new cc.MoveTo(.5,t),new cc.CallFunc(function(){e.animation.name&&this.hero.setAnimationAndIdleAfter(e.animation.name,e.animation.idle),"tripeaks"===cleverapps.config.name&&this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.hero.setAnimationAndIdleAfter("victory_window",e.animation.idle)}.bind(this))))}.bind(this))))}});cleverapps.styles.VictoryWindowHero={x:300,y:200,mobile:{x:140,y:200},size:{width:200,height:500},animation:{scale:1,name:"victory_open",idle:"victory_idle"},moveUp:{dy:40}};var AnimatedCounterComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.options=e,this.options.scale=this.options.scale||1.3,this.options.onFinish=this.options.onFinish||function(){},this.options.time=this.options.time||.3;var t=this.options.to-this.options.from;this.increment=0<t?1:0===t?0:-1,this.text=cleverapps.UI.generateTTFText(this.options.from,this.options.font),this.addChild(this.text),this.setContentSize2(
this.text.getContentSize()),this.text.setPositionRound(this.width/2,this.height/2),this.current=this.options.from,this.paused=!1,this.started=!1},runAnimation:function(){this.started=!0,this.current=this.options.from,this.paused||this._animateStep()},_animateStep:function(){!this.paused&&this.started&&(this.current!==this.options.to+this.increment?this.text.runAction(new cc.Sequence(new cc.ScaleTo(this.options.time,this.options.scale),new cc.CallFunc(function(){this.text.setString(this.current),this.options.sfx&&cleverapps.audio.playSound(bundles.main.urls["countdown_effect_"+this.current])}.bind(this)),new cc.ScaleTo(this.options.time,1),new cc.DelayTime(this.options.time),new cc.CallFunc(function(){this.current+=this.increment,this._animateStep()}.bind(this)))):this.options.onFinish())},pauseCountdown:function(){this.paused||(this.paused=!0)},resumeCountdown:function(){this.paused&&(this.paused=!1,this._animateStep())}});cleverapps.styles.AnimatedCounterComponent={}
;var RoundCountdownComponent=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.text=cleverapps.UI.generateTTFText("messages:RoundCountdownComponent.text",cleverapps.styles.FONTS.ROUND_COUNTDOWN_TEXT),this.addChild(this.text),this.setContentSize2(this.text.getContentSize()),this.text.setPositionRound(this.width/2,this.height/2),this.text.setVisible(!1),this.countdown=new AnimatedCounterComponent({from:3,to:1,font:cleverapps.styles.FONTS.ROUND_COUNTDOWN_TIMER_TEXT,scale:1.5,sfx:!0,onFinish:function(){e()}}),this.addChild(this.countdown),this.countdown.setPositionRound(this.width/2,this.height/2),this.countdown.setVisible(!1),this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.text.setVisible(!0)}.bind(this)),new cc.DelayTime(1.5),new cc.CallFunc(function(){this.text.setVisible(!1),this.countdown.setVisible(!0),this.countdown.runAnimation()}.bind(this))))},pauseCountdown:function(){this.countdown.pauseCountdown()},
resumeCountdown:function(){this.countdown.resumeCountdown()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{ROUND_COUNTDOWN_TEXT:{size:25,color:cleverapps.styles.COLORS.COLOR_BROWN},ROUND_COUNTDOWN_TIMER_TEXT:{name:"nostroke",size:50,color:cleverapps.styles.COLORS.COLOR_BROWN}});var TreasureSearchRewardComponent=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.TreasureSearchRewardComponent;this.setAnchorPoint2(),e.addChild(this),this.setPositionRound(t);var s=new cleverapps.Spine(bundles.game.jsons.shovel_json,1);this.addChild(s),s.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){s.setAnimationAndIdleAfter("open","idle")})))}});TreasureSearchRewardComponent.IsAvailable=function(){return-1!==["olympics"].indexOf(cleverapps.config.name)},cleverapps.styles.TreasureSearchRewardComponent={x:{align:"center",dx:140},y:{align:"center",dy:150}};var WordsListComponent=cc.Node.extend({ctor:function(e){this._super(),this.options=e,
this.setAnchorPoint2();var r=cleverapps.styles.WordsListComponent,t=this.options.words.map(function(e){var t=this.options.width-2*r.word.padding.x,s=r.word.height,i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t,s);var n=this.createWordBg(t,s);i.addChild(n),n.setPositionRound(i.width/2,i.height/2);var o=cleverapps.UI.generateTTFText(e.toUpperCase(),cleverapps.styles.FONTS.EXTRA_WINDOW_LETTER_TEXT);return i.addChild(o),o.setPositionRound(r.word.text),i}.bind(this)),s=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:r.words.margin,padding:r.words.padding}),i=new cleverapps.UI.ScrollView(s,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR});i.setContentSize2(this.options.width,Math.min(this.options.height,s.height));var n=new cc.Node;if(n.setAnchorPoint2(),n.setContentSize2(i.width,this.options.height),n.addChild(i),i.setPositionRound(n.width/2,n.height-i.height/2),this.setContentSize2(n.width,n.height+2*r.topPadding),this.addChild(n),
n.setPositionRound(this.width/2,this.height/2),r.bg){var o=new cc.Scale9Sprite(bundles.main.frames.light_bg_png);o.setContentSize2(this.getContentSize()),this.addChild(o),o.setLocalZOrder(-1),o.setPositionRound(this.width/2,this.height/2)}},createWordBg:function(e,t){var s=new cc.Scale9Sprite(this.getWordBgImage());if(cleverapps.styles.WordsListComponent.word.scaleYOnly){var i=t/s.height;s.width=e/i,s.setScale(i)}else s.setContentSize2(e,t);return s},getWordBgImage:function(){return"stacks"===cleverapps.config.subtype?Game.currentGame.board.level.isTricky()?bundles.game.frames.found_word_bg_tricky_png:Game.currentGame.board.level.isHard()?bundles.game.frames.found_word_bg_bonus_png:Game.currentGame.board.level.episode.isBonusRound()?bundles.game.frames.found_word_bg_bonus_png:bundles.game.frames.found_word_bg_png:bundles.main.frames.row_player_png}});cleverapps.styles.WordsListComponent={mouseScrollSpeed:200,word:{height:70,padding:{x:12},text:{x:{align:"center"},y:{align:"center",
dy:-5}}},words:{margin:5,padding:{x:0,y:5}},topPadding:4,bg:!0};var MedallionComponent=cc.Node.extend({ctor:function(e){this.options=e,this._super();var t=cleverapps.styles.MedallionComponent;this.setAnchorPoint2(),this.setContentSize2(t),this.setPositionRound(t.positions[cleverapps.wideMode.mode]),this.setLocalZOrder(1e6),t.backgroundAnimation&&(this.backgroundAnimation=new cleverapps.Spine(t.backgroundAnimation),this.backgroundAnimation.setAnimation(0,"idle",!0),this.backgroundAnimation.setPosition(this.width/2,this.height/2),this.addChild(this.backgroundAnimation)),this.createContent(),0!==this.content.length&&(this.visible=!1,setTimeout(this.showUp.bind(this),500))},showUp:function(){this.backgroundAnimation?this.runAction(new cc.Sequence(new cc.CallFunc(function(){this.visible=!0,this.backgroundAnimation.setAnimationAndIdleAfter("animation","idle")}.bind(this)),new cc.MoveBy(1.1,0,-cleverapps.styles.MedallionComponent.distance).easing(cc.easeBackOut()))):(this.visible=!0,
this.y-=cleverapps.styles.MedallionComponent.distance);var s=function(){var e=this.content[this.contentIndex];if(this.contentView=e.spine,this.contentView.setVisible(!0),this.contentView.setPositionRound(this.width/2,this.height/2),1<e.amount&&!cleverapps.styles.MedallionComponent.noAmountText){var t=cleverapps.UI.generateTTFText("x"+e.amount,cleverapps.styles.FONTS.MEDALLION_TEXT);this.contentView.addChild(t),t.setPositionRound(cleverapps.styles.MedallionComponent.textPosition)}this.addChild(this.contentView),e.openAnimation?this.contentView.setAnimationAndIdleAfter(e.openAnimation,e.idleAnimation):this.contentView.setAnimation(0,e.idleAnimation,!0),1!==this.content.length?this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.contentView.setVisible(!1),this.contentView.removeFromParent(),this.contentIndex++,this.contentIndex===this.content.length&&(this.contentIndex=0,this.options.showOnce)?this.hide():s()}.bind(this)))):this.options.showOnce&&setTimeout(
this.hide.bind(this),3e3)}.bind(this);s()},createContent:function(){this.content=[],this.contentIndex=0,Object.keys(this.options).forEach(function(e){if("shovels"===e){var t=cleverapps.styles.MedallionComponent.animation&&cleverapps.styles.MedallionComponent.animation.shovels;this.content.push({spine:new cleverapps.Spine(bundles.game.jsons.shovel_json),openAnimation:t&&t["open"+this.options[e]]||"open",idleAnimation:t&&t["idle"+this.options[e]]||"idle",amount:this.options[e]})}else"clovers"===e?this.content.push({spine:new cleverapps.Spine(bundles.card.jsons.marks_json),idleAnimation:"gem_idle_counter"}):"stars"===e?this.content.push({spine:new cleverapps.Spine(bundles.game.jsons.star_json),openAnimation:"open",idleAnimation:"idle",amount:this.options[e]}):"slot_machine_tickets"===e&&this.content.push({spine:new cleverapps.Spine(bundles.game.jsons.slot_machine_ticket_json),openAnimation:"open",idleAnimation:"idle",amount:this.options[e]})}.bind(this))},hide:function(){
this.contentView&&(this.contentView.setVisible(!1),this.contentView.removeFromParent(),this.contentView=void 0),this.backgroundAnimation&&(this.backgroundAnimation.removeFromParent(),this.backgroundAnimation=void 0,this.removeFromParent())}});MedallionComponent.IsAvailable=function(){return-1!==["riddles","heroes","wordsoup","crocword","tripeaks","differences","magicwords"].indexOf(cleverapps.config.name)},cleverapps.overrideFonts(cleverapps.styles.FONTS,{MEDALLION_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.MedallionComponent={backgroundAnimation:bundles.game.jsons.medallion_json,width:200,height:200,distance:400,positions:[{x:{align:"left",dx:20},y:{align:"top",dy:300}},{x:{align:"left",dx:160},y:{align:"top",dy:200}},{x:{align:"left",dx:200},y:{align:"top",dy:200}}],textPosition:{x:{align:"center",dx:30},y:{align:"center",dy:-45}}};var RepeatablePattern=cleverapps.Layout.extend({ctor:function(e,t){for(var s=cleverapps.styles.RepeatablePattern,i=Math.ceil(
e/new cc.Sprite(t).width),n=[],o=0;o<i;o++){var r=new cc.Sprite(t);n.push(r)}this._super(n,{direction:cleverapps.UI.HORIZONTAL,margin:s.margin}),this.setScale(e/this.width),this.setPositionRound(s)}});cleverapps.styles.RepeatablePattern={margin:0,x:{align:"center"},y:{align:"top",dy:5}};var Change=function(e){this.options=e};Change.prototype.isActive=function(){return!0},Change.prototype.calculateDelta=function(){return 0},Change.prototype.createView=function(){};var ChangeView=cc.Node.extend({ctor:function(e){this.options=e,this._super(),this.setVisible(!1),this.showUp()},showUp:function(){this.runAction(new cc.Sequence(new cc.DelayTime(2),new cc.CallFunc(function(){this.setScale(0),this.setVisible(!0)}.bind(this)),new cc.ScaleTo(.6,1).easing(cc.easeBackOut())))},animateChange:function(e){}}),LanternChange=function(e){Change.call(this,e),this.lantern=e.lantern};LanternChange.prototype=Object.create(Change.prototype),(LanternChange.prototype.constructor=LanternChange
).prototype.isActive=function(){return this.lantern&&this.lantern.isActive(this.options.level)},LanternChange.prototype.calculateDelta=function(){return 1},LanternChange.prototype.createView=function(e){this.lantern.beforeShownProgress||(this.lantern.beforeShownProgress=Math.max(0,this.lantern.getCurrentStreak()-1));var t=new LanternChangeView({before:this.lantern.beforeShownProgress,after:this.lantern.getCurrentStreak()});return e.window.addChild(t),this.lantern.beforeShownProgress=this.lantern.getCurrentStreak(),t};var LanternChangeView=ChangeView.extend({ctor:function(e){this._super(e);var t=cleverapps.styles.LanternChangeView,s=this.lantern=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json);s.setAnimation(0,"idle_"+this.options.before,!0),this.setLocalZOrder(t.zOrder),this.setAnchorPoint2(),this.setContentSize2(t),this.setScale(t.isInitialScaleZero?0:t.scale),this.addChild(s),s.setPositionRound(this.width/2,this.height/2),this.setPositionRound(cleverapps.clone(
t.wideModePositions[cleverapps.wideMode.mode],!0)),this.setVisible(!0)},showUp:function(){},animateChange:function(e){var t=cleverapps.styles.LanternChangeView;this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.3,1.1*t.scale),new cc.ScaleTo(.1,t.scale),new cc.CallFunc(function(){this.options.before!==this.options.after&&this.lantern.setAnimationAndIdleAfter("charge_"+this.options.after,"idle_"+this.options.after)}.bind(this))))}});cleverapps.styles.LanternChangeView={wideModePositions:[{x:{align:"right",dx:-10},y:{align:"bottom",dy:120}},{x:{align:"right",dx:-10},y:{align:"bottom",dy:120}},{x:{align:"right",dx:-10},y:{align:"bottom",dy:120}}],zOrder:0,width:250,height:250,scale:.5};var VictoryChestChange=function(e){Change.call(this,e)};VictoryChestChange.prototype=Object.create(Change.prototype),(VictoryChestChange.prototype.constructor=VictoryChestChange).prototype.isActive=function(){return cleverapps.styles.VictoryChestChangeView.ChestBlock&&0<this.options.stars},
VictoryChestChange.prototype.calculateDelta=function(){return this.options.stars},VictoryChestChange.prototype.createView=function(e){var t=new VictoryChestChangeView({oldChestStars:this.options.oldChestStars});return e.addChild(t),t};var VictoryChestChangeView=ChangeView.extend({ctor:function(e){var t=cleverapps.styles.VictoryChestChangeView;this._super(e),this.setPositionRound(t.ChestBlock);var s=cleverapps.UI.createScale9Sprite(bundles.menubar.frames.menubar_bg_png);s.setAnchorPoint2(),s.setContentSize2(t.ChestBoard.width,t.ChestBoard.height),s.setPosition(t.ChestBoard.x,t.ChestBoard.y),this.addChild(s),this.chestBoard=s;var i=new cleverapps.Spine(bundles.starchest_window.jsons.star_chest_spine_json,t.Chest.scale);i.setPosition(t.Chest.x,t.Chest.y),i.setAnimation(0,"ready_to_open",!0),this.addChild(i),this.chest=i;var n=cleverapps.UI.generateImageText(this.options.oldChestStars+"/"+cleverapps.StarChest.GOAL_AMOUNT,cleverapps.styles.FONTS.VICTORY_CHEST_TEXT);n.setAnchorPoint(1,.5),
n.setPosition(s.width+t.ChestBoard.text.x,s.height/2+t.ChestBoard.text.y),s.addChild(n),this.chestBoardText=n},animateChange:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.3),new cc.CallFunc(function(){cleverapps.UI.animateDelta(e,{x:this.chestBoardText.x-this.chestBoardText.width/2,y:this.chestBoardText.y,dy:cleverapps.styles.VictoryChestChangeView.ChestBoard.dy,parent:this.chestBoard}),this.chestBoardText.setString(cleverapps.starChest.stars+"/"+cleverapps.StarChest.GOAL_AMOUNT)}.bind(this)),new cc.ScaleTo(.3,1)))}.bind(this)),new cc.DelayTime(.5),new cc.CallFunc(function(){cleverapps.starChest.locked?this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.4,0),new cc.RemoveSelf)):(this.chest.setAnimation(0,"opening",!1),this.chest.setCompleteListener(function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.5,0),new cc.RemoveSelf))}.bind(this)))}.bind(this))))}})
;cleverapps.styles.VictoryChestChangeView={ChestBlock:{x:{align:"center",dx:0},y:{align:"top",dy:-100}},ChestBoard:{x:80,y:5,dy:30,width:270,height:55,text:{x:-25,y:1}},Chest:{x:-55,y:0,scale:.5}};var TournamentBookChange=function(e){Change.call(this,e),this.mission=void 0};TournamentBookChange.prototype=Object.create(Change.prototype),(TournamentBookChange.prototype.constructor=TournamentBookChange).prototype.isActive=function(){return!("board"!==cleverapps.config.type||cleverapps.isKnockoutGame()||void 0===this.mission||!this.options.game.canPayReward(GameBase.REWARD_BACKGROUND_CLOVER)||MedallionComponent.IsAvailable())},TournamentBookChange.prototype.calculateDelta=function(){return this.options.game.rewards[GameBase.REWARD_BACKGROUND_CLOVER]},TournamentBookChange.prototype.createView=function(e){var t=new TournamentBookChangeView({place:this.options.game.tournament&&this.options.game.competition&&this.options.game.competition.calcPlace()+1,
isFinished:this.mission.result+this.mission.currency>=TreasureSearch.GEMS});return e.addChild(t),t};var TournamentBookChangeView=ChangeView.extend({ctor:function(e){this._super(e);var t=cleverapps.styles.TournamentBookChangeView;this.setAnchorPoint2(),this.setContentSize2(t);var s=this.animation=new cleverapps.Spine(bundles.main.jsons.tournament_book_json,1);s.setPosition(this.width/2,this.height/2),this.addChild(s),this.setPositionRound(t)},showUp:function(){},animateChange:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(1.5),new cc.CallFunc(function(){this.setVisible(!0),this.animation.setAnimation(0,"animation",!1)}.bind(this))))}});cleverapps.styles.TournamentBookChangeView={width:300,height:400,x:{align:"center"},y:{align:"center",dy:190}},cleverapps.ConsoleStream=function(){this.messages=[],this.enabled=!1,cleverapps.config.debugMode&&(cleverapps.ConsoleStream.CONSOLE_STREAM_MAX_DURATION=cleverapps.parseInterval("2 minutes")),this.sendMessages=cleverapps.accumulate(
cleverapps.parseInterval("10 seconds"),this.sendMessages.bind(this))},cleverapps.ConsoleStream.prototype.enable=function(e){var t=cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.CONSOLE_STREAM_START_TIME);if(t||cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.CONSOLE_STREAM_START_TIME,Date.now()),!t||parseInt(t)+cleverapps.ConsoleStream.CONSOLE_STREAM_MAX_DURATION>Date.now()){if(this.enabled)return;this.enabled=!0,this.overrideConsole()}else e&&e()},cleverapps.ConsoleStream.prototype.disable=function(){cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.CONSOLE_STREAM_START_TIME),this.enabled&&(this.enabled=!1,this.baseConsoleLog&&(console.log=this.baseConsoleLog,this.baseConsoleLog=void 0),this.baseConsoleError&&(console.error=this.baseConsoleError,this.baseConsoleError=void 0))},cleverapps.ConsoleStream.prototype.sendMessages=function(){var e=new cleverapps.ReportStream("");e.data=["CONSOLE OUTPUT REDIRECT"].concat(this.messages),e.send(!0),this.messages=[]},
cleverapps.ConsoleStream.prototype.overrideConsole=function(){this.baseConsoleLog=console.log,this.baseConsoleError=console.error,console.error=console.log=function(){if(cc.sys.os===cc.sys.OS_IOS)for(var e=0;e<arguments.length;e++)if(isNodeOrElement(arguments[e]))return;var t=Array.from(arguments).map(function(e){return JSON.stringify(e,cleverapps.ConsoleStream.serializer())}).join("\n");this.messages.push(t),this.sendMessages()}.bind(this)},cleverapps.ConsoleStream.serializer=function(i,n){var o=[],r=[];return null==n&&(n=function(e,t){return o[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,o.indexOf(t)).join(".")+"]"}),function(e,t){if(0<o.length){var s=o.indexOf(this);~s?o.splice(s+1):o.push(this),~s?r.splice(s,1/0,e):r.push(e),~o.indexOf(t)&&(t=n.call(this,e,t))}else o.push(t);return null==i?t:i.call(this,e,t)}},cleverapps.ConsoleStream.CONSOLE_STREAM_MAX_DURATION=cleverapps.parseInterval("1 day"),cleverapps.Reports={streams:{},get:function(e){
return void 0===cleverapps.Reports.streams[e]&&(cleverapps.Reports.streams[e]=new cleverapps.ReportStream(e)),cleverapps.Reports.streams[e]},push:function(e,t){cleverapps.Reports.get(e).push(t)}},cleverapps.ReportStream=function(e){this.data=["REPORT: "+e.toUpperCase()]},cleverapps.ReportStream.prototype.push=function(e){this.data.push(e)},cleverapps.ReportStream.prototype.send=function(e){var t=[new Date+""];this.data.forEach(function(e){t.push(e)}),cleverapps.environment&&t.push("Screen: "+cleverapps.environment.getScreen()),levels&&levels.user&&(t.push("Episode: "+cleverapps.environment.episodeNo),t.push("Level: "+cleverapps.environment.levelNo),t.push("User id: "+levels.user.id)),t.push("Version: "+cleverapps.config.version),t.push("Source: "+cleverapps.User.calcSource()),cleverapps.config&&cleverapps.config.name&&t.push("Name: "+cleverapps.config.name),t.push(window&&window.navigator?window.navigator.userAgent:"???"),t=(t=t.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",
e||console.log(t),cleverapps.isLocalhost()||cleverapps.RestClient.sendRaw(cleverapps.RestClient.METHODS.POST,cleverapps.LOG_ERROR_URL,t)},cleverapps.ReportStream.send=function(e,t){var s=new cleverapps.ReportStream(e);s.push(t),s.send()},cleverapps.ReportStream.debug=cleverapps.throttle(100,function(e){var t=new cleverapps.ReportStream("DebugMessage");Array.isArray(e)||(e=[e]),e.forEach(function(e){t.push(e)}),t.send()}),cleverapps.ErrorHandler={SEND_INTERVAL:"1 hour",lastSend:0,getBaseMessage:function(){var e=[new Date+""];return cleverapps.environment&&e.push("Screen: "+cleverapps.environment.getScreen()),cleverapps.User.calcSource&&e.push("Source: "+cleverapps.User.calcSource()),cleverapps.config&&cleverapps.config.name&&e.push("Name: "+cleverapps.config.name),cleverapps.config&&cleverapps.config.title&&e.push("Title: "+cleverapps.config.title),cleverapps.config&&cleverapps.config.version&&e.push("Version: "+cleverapps.config.version),levels&&levels.user&&(e.push(
"Episode: "+cleverapps.environment.episodeNo),e.push("Level: "+cleverapps.environment.levelNo),e.push("User id: "+levels.user.id)),cleverapps&&cleverapps.settings&&e.push("Language: "+cleverapps.settings.language),e.push(window&&window.navigator?window.navigator.userAgent:"???"),e},onerror:function(e,t,s,i,n){var o=cleverapps.ErrorHandler.getBaseMessage();return n&&n.arguments&&o.push("Arguments: "+n.arguments),cleverapps.newSceneStack&&n.stack&&(n.stack+=cleverapps.newSceneStack),n&&n.stack?(o.push("Message: "+e),o.push("Line: "+s),o.push("Column: "+i),o.push(n.stack)):(o.push("Message: "+e),o.push("URL: "+t),o.push("Line: "+s),o.push("Column: "+i),o.push("Error: "+JSON.stringify(n))),o=(o=o.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",window&&window.assetsFolder&&(o=o.replace(new RegExp(window.assetsFolder,"g"),"")),cleverapps.config.workerTaskId&&cleverapps.RestClient.post("http://localhost:3201/tasks/finish/"+cleverapps.config.workerTaskId,{result:o}),
cleverapps.ErrorHandler._onerror(o),!1},logError:function(e,t){var s=this.getBaseMessage();s.push("Message: "+e),t&&t.arguments&&s.push("Arguments: "+t.arguments),t&&t.stack&&s.push(t.stack),s=(s=s.join(" - ")).replace(/(?:\r\n|\r|\n)/g," - ")+" ",cleverapps.ErrorHandler._onerror(s)},_onerror:function(e){if(Date.now()-cleverapps.ErrorHandler.lastSend>=cleverapps.parseInterval(this.SEND_INTERVAL)&&(this.send(e),cleverapps.ErrorHandler.lastSend=Date.now()),cc.sys.isWebView){var t=cc.director.getTotalFrames(),s=function(){if(t===cc.director.getTotalFrames()||!cleverapps.metha)return cleverapps.eventLogger&&cleverapps.eventLogger.logEvent("webview_onerror_reload_silent"),cleverapps.throwAsync&&cleverapps.throwAsync("WebView error location reload silent"),void window.location.reload();var e={focus:"OnErrorRestartWindow",action:function(e){cleverapps.eventLogger&&cleverapps.eventLogger.logEvent("webview_onerror_reload_window"),cleverapps.throwAsync&&cleverapps.throwAsync(
"WebView error location reload window"),new RestartWindow({contentMessage:"RestartWindow.OnError"}),cleverapps.metha.onceNoWindowsListener=e}};cleverapps.metha.isFocused()?cleverapps.metha.distract(e):cleverapps.metha.display(e)};setTimeout(function(){t===cc.director.getTotalFrames()&&(cc.game.pause(),cc.game.resume(),setTimeout(s,500))},500)}},send:function(e,t){console.log(e),cleverapps.RestClient.sendRaw(cleverapps.RestClient.METHODS.POST,cleverapps.LOG_ERROR_URL,e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ERROR_AMOUNT)}},window.onerror=cleverapps.ErrorHandler.onerror,cleverapps.LOG_ERROR_URL="/log/",cleverapps.DataLoader={enabled:!0,corrupted:!1,_onSavedCallbacks:[],data:{},_queue:{},haveSavedData:function(){return void 0!==cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.ID)},save:function(e,t,s){this._queue[e]={data:t,options:s},this._runSaveTimeout()},onSaved:function(e){void 0===this._saveTimeout?e():this._onSavedCallbacks.push(e)},processSaveQueue:function(){for(
var e in this._queue)this._queue[e].data===cleverapps.DataLoader.REMOVE?this._removeProcess(e,this._queue[e].options):this._saveProcess(e,this._queue[e].data,this._queue[e].options);this._queue={},this._saveTimeout=void 0;for(var t=0;t<this._onSavedCallbacks.length;t++)this._onSavedCallbacks[t]();this._onSavedCallbacks=[]},_runSaveTimeout:function(){void 0===this._saveTimeout&&(this._saveTimeout=setTimeout(this.processSaveQueue.bind(this),1e3))},_saveProcess:function(e,t,s){var i=(s=s||{}).limit||cleverapps.DataLoader.FIFO_LIMIT,n=s.fifoKey,o=s.raw;if(n&&!this.hasKey(e)){for(var r=this.load(n)||[];r.length>=i;)this.remove(r[0],n),r=this.load(n);r.push(e),this._saveProcess(n,r),this._saveProcess(e,t)}else{var a=o?t+"":JSON.stringify(t);if(this.data[e]=a,!this.enabled||this.corrupted)return;if(e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&(this.checkClientSession(),this.corrupted))return;try{if(
void 0!==cleverapps.DataLoader.CLIENT_SESSION&&e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&!cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.CLIENT_SESSION))throw cleverapps.eventLogger&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOCALSTORAGE_CLEARED),1;if(a&&a.length>cleverapps.DataLoader.VALUE_LENGTH_LIMIT&&cleverapps.ErrorHandler.logError("Attempt to save huge value ("+a.length+") to localstorage key - "+e),cc.sys.localStorage.setItem(e,a),!cc.sys.isNative&&cc.sys.localStorage.getItem(e)!==a)throw e!==cleverapps.DataLoaderTypes.CLIENT_SESSION&&cleverapps.eventLogger&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LOCALSTORAGE_ERROR_SET_ITEM),2}catch(e){cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY),this.corrupted=!0}}},getCharValues:function(e){for(var t,s=[],i=0;i<e.str.length;i++)t=e.str.charCodeAt(i),e.encode?s.push(t<=65517?t+18:t):s.push(t<=65535?t-18:t);return s},hasKey:function(e){var t
;return this._queue[e]?t=this._queue[e].data:(this.data.hasOwnProperty(e)||(this.data[e]=cc.sys.localStorage.getItem(e)),t=this.data[e]),null!=t},checkClientSession:function(){if(void 0!==cleverapps.DataLoader.CLIENT_SESSION){var e=cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.CLIENT_SESSION);if(e!==cleverapps.DataLoader.CLIENT_SESSION&&e)return this.corrupted=!0,cleverapps.synchronizer&&cleverapps.synchronizer.clientSessionExpired(),!1}return!0},load:function(e,t){if(this._queue[e]){if((i=this._queue[e].data)===cleverapps.DataLoader.REMOVE)return;return i=this._queue[e].options&&this._queue[e].options.raw?i+"":i,t&&t.raw?JSON.stringify(i):i}!this.data.hasOwnProperty(e)&&this.enabled&&(this.data[e]=cc.sys.localStorage.getItem(e));var s=this.data[e];if(null!=s){if(t&&t.raw)return s;var i;if((i=JSON.parse(s)).dataCodes){var n=this.getCharValues({str:i.dataCodes});i=JSON.parse(String.fromCharCode.apply(null,n))}return i}},remove:function(e,t){this._queue[e]={
data:cleverapps.DataLoader.REMOVE,options:t},this._runSaveTimeout()},_removeProcess:function(e,t){if(this._queue[e]&&delete this._queue[e],delete this.data[e],this.enabled&&!this.corrupted&&cc.sys.localStorage.removeItem(e),t){var s=this.load(t);if(s){var i=s.indexOf(e);0<=i&&(s.splice(i,1),this.save(t,s))}}},cleanAll:function(){if(window.localStorage)for(var e in console.log("Clearing by prefix: "+cleverapps.config.prefix),this._queue={},this.data={},cc.sys.localStorage.setItem=function(){},window.localStorage)0===e.indexOf(cleverapps.config.prefix)&&-1===e.indexOf("_editor_episode_")&&-1===e.indexOf("_constant")&&(console.log("Clearing LOCALSTORAGE:"+e),cc.sys.localStorage.removeItem(e))},isEnabled:function(){if(!cc.sys.isNative)try{return window.localStorage.setItem("test","testValue"),"testValue"!==window.localStorage.getItem("test")?!1:(window.localStorage.removeItem("test"),!0)}catch(e){return!1}return!0}},cleverapps.DataLoader.REMOVE=-12345,cleverapps.DataLoader.FIFO_LIMIT=10,
cleverapps.DataLoader.VALUE_LENGTH_LIMIT=1e7,cleverapps.DataLoader.resetClientSession=function(){cleverapps.DataLoader.CLIENT_SESSION=void 0,cleverapps.DataLoader.enabled=!0,cleverapps.DataLoader.corrupted=!1,cc.sys.isNative||(cleverapps.DataLoader.CLIENT_SESSION=Math.floor(1e9*Math.random())+1+"",cleverapps.DataLoader._saveProcess(cleverapps.DataLoaderTypes.CLIENT_SESSION,cleverapps.DataLoader.CLIENT_SESSION,{raw:!0}),cleverapps.DataLoader.corrupted&&(cleverapps.DataLoader.enabled=!1,cleverapps.DataLoader.corrupted=!1,cleverapps.DataLoader.CLIENT_SESSION=void 0))},cleverapps.DataLoader.init=function(){var t=cleverapps.config.name+cleverapps.social.getLocalStoragePreffix();if(cleverapps.DataLoaderTypes={ID:t,HISTORY:t+"_history",CLIENT_SESSION:t+"_client_session",SETTINGS:t+"_settings",DAILY_CHEST:t+"_periodicBonus",FRIENDS:t+"_friends",INVITABLE_FRIENDS:t+"_invitable_friends",BONUS_GAME_CHEST:t+"_bonus_game_chest",TUTORIAL:t+"_tutorial",LEVEL_HINTS:t+"_level_hints",
PRODUCT_VIDEO_PROGRESS:t+"_v_p_",GAME_SAVE_FIFO:t+"_game_save_fifo",PAYMENTS_HISTORY:t+"_my_payments",PAYMENTS_HISTORY_5_PRICE:t+"_my_payments_5_price",SALE_MANAGER:t+"_sale_manager",SALE:t+"_sale",SERVER_VERSION:t+"_server_version",SESSION_SAVE_KEY:t+"_session",FAKE_FACEBOOK_LOGGING_TIME:t+"_fake_facebook_logging_time",PROMOTION:t+"_promotion",LOCALIZATION_MANAGER:t+"_localization_manager",CLIENT_COMPENSATE_PRODUCTS:t+"_client_compensate_products",RESULT_FIFO:t+"_result_fifo",RESULTS_FIFO:t+"_results_fifo",LIVES:t+"_lives",BOOSTERS_COUNTER:t+"_boosters_counter",STAR_CHEST:t+"_star_chest",XSOLLA_ACCESS_TOKEN:t+"_xsolla_access_token",BONUS_EPISODES_PROGRESS:t+"_bonus_episodes_progress",SERVER_FLAGS:t+"_server_flags",HELP_FROM_FRIENDS:t+"_help_from_friends",FORCES:t+"_forces",FREE_BOMB_MOVES:t+"_free_bomb_moves",TEMP_GOODS:t+"_temp_goods",SORTER:t+"_sorter",FRIEND_REQUESTS:t+"_friend_requests",FAKE_REQUESTS:t+"_fake_request_time",ASKED_LIVES:t+"_asked_lives",ASKED_STARS:t+"_asked_stars",
BOUNTY:t+"_bounty",PACK:t+"_pack",DAILY_TASKS:t+"_daily_tasks",BATTLE_PASS:t+"_battle_pass",WIN_STREAK:t+"_win_seria",LOCAL_PUSHES:t+"_local_pushes",TOURNAMENT_COMPETITORS:t+"_tournament_competitors",TOURNAMENT_PLAYERS:t+"_tournament_players",TOURNAMENT_RECORD:t+"_tournament_record",PLAY_SESSION:t+"_play_session",REWARDED_ADS_MANAGER:t+"_rewarded_ads",AD_ICON:t+"_adicon",REWARDED_TOOLBAR:t+"_rewarded_toolbar",SPECIAL_OFFER_LAST_TIME:t+"_special_offer_last_time",LEVEL_ATTEMPTS:t+"_level_attempts",LAST_VIEWED_FRIEND_REQUEST:t+"_last_viewed_friend_request",MISSIONS:t+"_missions",COMPETITION:t+"_competition",COMPETITION_PLAYERS:t+"_competition_players",COMPETITION_STATISTICS:t+"_competition_statistics",PLACEMENTS:t+"_placements",PIGGY_BANK:t+"_piggy_bank",SUBSCRIPTION:t+"_subscription",GUN:t+"_gun",INSTANT_SHORTCUT_CREATED:t+"_instant_shortcut_created",INSTANT_BOT_CREATED:t+"_instant_bot_created",INSTANT_PAYMENTS:t+"_instant_payments",WEBVIEW_PAYMENTS:t+"_webview_payments",
HEROES:t+"_heroes",DAILY_CUP:t+"_daily_cup",DAILY_CUP_RULES:t+"_daily_cup_rules",MINI_GAME_RECORD:t+"_mini_game_record",INFORMATION:t+"_info",SYNC:t+"_sync",FRIDAY_SALE:t+"_friday_sale",LANTERN:t+"_lantern",FARM:t+"_clockmaker_a",HOMEFIX:t+"_home",DRAUGIEM_AUTH_DATA:t+"_draugiem_auth_data",DAILY_LEVEL:t+"_daily_level",KNOCKOUT:t+"_knockout",WEEKLY_CUP:t+"_weekly_cup",WEEKLY_CUP_TOP:t+"_weekly_cup_top",COOKIE_JAR:t+"_cookie_jar",RATED:t+"_rated",APPLE_SOCIAL:t+"_apple_social",SIMPLE:t+"_simple",JACKPOT_LAST_APPEAR_TIME:t+"_jackpot_last_appear_time",CARD_SKINS:t+"_card_skins",ADMIN_CHART:t+"_admin_chart",ZOOM:t+"_zoom",UNIT_SAVER_KICKOUTS:t+"_unit_saver_kickouts",CHAT:t+"_chat",CONSOLE_STREAM_START_TIME:t+"_console_stream_start_time"},cleverapps.DataLoader.resetClientSession(),"function"==typeof cc.sys.localStorage.getData)console.log("DataLoader.getData read single batch"),cleverapps.DataLoader.data=cc.sys.localStorage.getData();else if(cc.sys.isNative)console.log(
"DataLoader.getData cant read all data");else try{void 0!==window.localStorage&&window.localStorage&&Object.keys(window.localStorage).forEach(function(e){0===e.indexOf(t)&&(this.data[e]=cc.sys.localStorage.getItem(e))}.bind(this))}catch(e){console.warn("DataLoader.getData cant read all data",e)}},cleverapps.WebViewData=function(){},cleverapps.WebViewData.prototype.init=function(e){webkitMessage("localStorage",{action:"init"}),this.initCallback=e},cleverapps.WebViewData.prototype.onInit=function(e,t){var s=JSON.parse(e);Object.keys(s).forEach(function(t){try{s[t]=decodeURIComponent(s[t])}catch(e){console.log("LocalStorage key - "+t+" decode error.")}}),this.localStorageData=s,t=JSON.parse(decodeWebViewData(t)),console.log("WebViewData.init data - "+JSON.stringify(t)),this.sourceApplicationUrl=t.sourceApplicationUrl,this.deviceVersion=t.deviceVersion,this.deviceName=t.deviceName,this.advertisingId=t.advertisingId,this.langCode=t.langCode,this.appleSocialAvailable=t.appleSocial,
console.log("device version "+this.deviceVersion+" device name "+this.deviceName),console.log("advertisingId "+this.advertisingId),console.log("langCode "+this.langCode),console.log("appleSocialAvailable "+this.appleSocialAvailable),this.initCallback&&(this.initCallback(),delete this.initCallback)},cleverapps.Availables={PERIODIC_BONUS:{episode:0,level:4},LEADER_BOARD:{episode:1,level:3},FRIEND_REQUESTS:{episode:0,level:6},BONUS_ROUND:{episode:0,level:10},DAILY_TASKS:{episode:2,level:13},MOVES:{episode:0,level:4},CREATE_SHORTCUT:{episode:0,level:5}},cleverapps.Settings=function(e){this.onChangeSoundListener=function(){},this.onChangeMusicListener=function(){},this.onChangeVibroListener=function(){},this.onChangeLanguageListener=function(){},this.load(),this.updateFrameRateByFpsMode()},cleverapps.Settings.getAvailableLanguages=function(){return cleverapps.config.languages?cleverapps.config.languages:projects.default.languages},cleverapps.Settings.getDefaultLanguage=function(){
var e=cleverapps.Settings.getAvailableLanguages(),t=cc.sys.language;if(t===cc.sys.LANGUAGE_DUTCH&&(t="nl"),-1===e.indexOf(t)||t===cc.sys.LANGUAGE_ENGLISH){for(var s=cleverapps.social.getDefaultLanguages(),i=0;i<s.length;i++){var n=s[i];if(-1!==e.indexOf(n))return n}return cc.sys.LANGUAGE_ENGLISH}return t},cleverapps.Settings.prototype.getSaveInfo=function(e){var t={sound:this.sound,music:this.music,vibro:this.vibro,language:this.language,fpsMode:this.fpsMode};return e&&(t.height=this.height),t},cleverapps.Settings.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SETTINGS,this.getSaveInfo(!0)),cleverapps.synchronizer.addUpdateTask("settings")},cleverapps.Settings.prototype.loadData=function(e){void 0===e?(this.sound=!0,this.music=!0,this.vibro=!0,this.language=cleverapps.Settings.getDefaultLanguage(),this.fpsMode=cleverapps.Settings.FPS_MODE_AUTO,this.save()):(this.sound=e.sound,this.music=e.music,this.vibro=void 0===e.vibro||e.vibro,
this.language=e.language,this.height=e.height,this.manualResolution=e.manualResolution,this.manualResolution&&(this.resolution=this.manualResolution),this.fpsMode=void 0===e.fpsMode?cleverapps.Settings.FPS_MODE_AUTO:e.fpsMode),void 0===this.language&&(this.language=cleverapps.Settings.getDefaultLanguage())},cleverapps.Settings.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SETTINGS);this.loadData(e)},cleverapps.Settings.prototype.toggleSound=function(){this.sound=!this.sound,this.save(),this.onChangeSoundListener()},cleverapps.Settings.prototype.toggleMusic=function(){this.music=!this.music,cleverapps.audio.onChangeMusic(),this.save(),this.onChangeMusicListener()},cleverapps.Settings.prototype.toggleVibro=function(){this.vibro=!this.vibro,this.save(),this.onChangeVibroListener()},cleverapps.Settings.prototype.setLanguage=function(e){this.language=e,this.save(),this.onChangeLanguageListener()},cleverapps.Settings.prototype.calcHeight=function(){
var e=cc.view.getFrameSize().height;return cleverapps.isInstant()||"undefined"!=typeof window&&window.screen&&window.screen.height&&(e=Math.max(e,window.screen.height)),cleverapps.Mobage.isAppropriate()&&(e=cleverapps.Mobage.HEIGHT),this.height!==e&&(this.height=e,this.save()),e},cleverapps.Settings.prototype.calcResolution=function(){if(void 0!==this.resolution&&resolutions[this.resolution])return this.resolution;var e=this.calcHeight(),t=1;cc.sys.isNative||(t=Math.min(2,window.devicePixelRatio||1));var s=e*t,i=Object.keys(resolutions),n=i.filter(function(e){return resolutions[e].mobile});0<n.length&&(cc.sys.isMobile?i=n:n.length<i.length&&(i=cleverapps.substract(i,n))),i=i.sort(function(e,t){return resolutions[e].scale-resolutions[t].scale});for(var o=function(e){var t=e.scale*cleverapps.styles.SCENE_HEIGHT;return s<=t?t-s:100*(s-t)},r=0,a=o(resolutions[i[r]]),c=1;c<i.length;c++){var l=o(resolutions[i[c]]);l<a&&(a=l,r=c)}return this.resolution=i[r]},
cleverapps.Settings.prototype.setManualResolution=function(e){this.manualResolution=e;var t=this.getSaveInfo();t.manualResolution=this.manualResolution,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SETTINGS,t),cleverapps.DataLoader.processSaveQueue(),window.location.reload()},cleverapps.Settings.prototype.updateFrameRateByFpsMode=function(){},cleverapps.Settings.prototype.setFpsMode=function(e){this.fpsMode=e,this.updateFrameRateByFpsMode(),this.save()},cleverapps.Settings.SOURCE_LOAD_LOW_THRESHOLD=3e4,cleverapps.Settings.FPS_MODE_AUTO=-1,cleverapps.Settings.FPS_MODE_LOW=0,cleverapps.Settings.FPS_MODE_HIGH=1;var Event=function(e){this.features=e.features||[],this.options=e.options||{},this.projects=e.projects,this.networks=e.networks,this.start=this.convertTimezone(e.start),this.finish=this.convertTimezone(e.finish),this.debug=e.debug,this.toolApplicable=e.toolApplicable};Event.prototype.convertTimezone=function(e){var t=new Date(e);return new Date(t.getTime(
)+t.getTimezoneOffset()*cleverapps.parseInterval("1 minute"))},Event.prototype.isRunning=function(){return this.start.getTime()<=Date.now()&&Date.now()<=this.finish.getTime()},Event.prototype.getTimeBeforeStart=function(){return this.start>new Date?this.start-new Date:0},Event.prototype.getTimeLeft=function(){return this.finish.getTime()-Date.now()},Event.prototype.activate=function(){};var EventManager=function(){this.currentFeatures={},this.events=cc.loader.getRes(bundles.main.jsons.friday_schedule),this.setCurrentFeatures()};EventManager.prototype.isActive=function(e){return this.currentFeatures[e]&&this.currentFeatures[e].isRunning()},EventManager.prototype.listCurrentFeatures=function(){return Object.keys(this.currentFeatures).filter(function(e){return this.currentFeatures[e].isRunning()},this)},EventManager.prototype.getFeatureEvent=function(e){return this.currentFeatures[e]},EventManager.prototype.isEventApplicable=function(e){
return cleverapps.config.debugMode&&void 0!==e.toolApplicable?e.toolApplicable:!!e.isRunning()&&((!e.networks||-1!==e.networks.indexOf(cleverapps.User.calcSource()))&&((!e.projects||-1!==e.projects.indexOf(cleverapps.config.name))&&!(e.debug&&!cleverapps.config.debugMode)))},EventManager.prototype.setCurrentFeatures=function(){var e=this.events.map(function(e){return new Event(e)}).filter(this.isEventApplicable.bind(this));this.currentFeatures={},e.forEach(function(t){t.features.forEach(function(e){this.currentFeatures[e]=t}.bind(this)),t.activate()},this)},EventManager.prototype.getNextFeatureEvent=function(t){return this.events.map(function(e){return new Event(e)}).filter(function(e){return-1!==e.features.indexOf(t)&&((!e.networks||-1!==e.networks.indexOf(cleverapps.User.calcSource()))&&((!e.projects||-1!==e.projects.indexOf(cleverapps.config.name))&&(!(e.debug&&!cleverapps.config.debugMode)&&0<e.getTimeBeforeStart())))}).sort(function(e,t){return e.start>t.start?1:-1})[0]}
;var CommunityManager=function(){var e=cleverapps.User.calcChannel("promo");e&&this.update(e)};CommunityManager.prototype.update=function(e){var t=function(e){this.reward=e}.bind(this);cleverapps.RestClient.post("/community/"+cleverapps.user.id+"/"+e,{},t,function(e){console.log("failed updating community",e)})},CommunityManager.prototype.isRewardAvailable=function(){return this.reward},CommunityManager.prototype.receiveReward=function(){cleverapps.metha.display({focus:"RewardedCommunityManagerReward",action:function(e){new RewardWindow({reward:this.reward}),this.reward=void 0,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})};var Placements=function(){this.data=this.initialize(),this.sortKeys(),this.load(),cleverapps.whenAllInitialized(function(){this.run(Placements.STARTUP)}.bind(this)),cleverapps.metha.onFocusLostListenerPlacements=function(){cleverapps.environment.isMainScene()?this.run(Placements.FREE_FOCUS_MAIN):cleverapps.environment.isGameScene()?this.run(
Placements.FREE_FOCUS_GAME):this.run(Placements.FREE_FOCUS_OTHER),cleverapps.metha.isFocused()||cleverapps.environment.isMethaScene()&&this.run(Placements.FREE_FOCUS_METHA)}.bind(this),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.throttle(1e3,function(){this.run(Placements.ONSHOW_NO_FOCUS_CHECK),setTimeout(this.runWhenFreeFocus.bind(this,Placements.ONSHOW),300)}.bind(this)))};Placements.prototype.runWhenFreeFocus=function(e){cleverapps.metha.whenFreeFocus(this.run.bind(this,e))},Placements.prototype.sortKeys=function(){this.sortedKeys=Object.keys(this.data),this.sortedKeys.sort(function(e,t){return e=this.data[e],((t=this.data[t]).priority||0)-(e.priority||0)}.bind(this)),this.keysByType={}},Placements.prototype.listKeys=function(t){return this.keysByType[t]?this.keysByType[t]:this.keysByType[t]=this.sortedKeys.filter(function(e){return 0!=(this.data[e].type&t)},this)},Placements.prototype.initialize=function(){var s="merge"===cleverapps.config.type;return{
dailyCupReward:{type:Placements.FREE_FOCUS,filter:function(){return DailyCup.IsAvailable(DailyCup.TYPE_DAILY)&&void 0!==cleverapps.dailyCup.calcRewardPlace()&&cleverapps.environment.isDailyCupScene()},action:function(){cleverapps.dailyCup.giveReward()}},weeklyCupReward:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return DailyCup.IsAvailable(DailyCup.TYPE_WEEKLY)&&void 0!==cleverapps.weeklyCup.calcRewardPlace()},action:function(){cleverapps.weeklyCup.giveReward()}},xsollaLoginWindow:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return"xsolla"===cleverapps.User.calcSource()&&!cleverapps.social.isLoggedIn()},action:function(){cleverapps.metha.display({focus:"xsollaLogin",action:function(e){new FbConnectWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},interval:"3 day"},recalculateFlags:{type:Placements.ONSHOW_OR_STARTUP|Placements.INTERMEDIATE_OR_AFTER_FINISH,action:function(){cleverapps.flags.update()}},versionCheck:{type:Placements.ONSHOW_OR_STARTUP,
action:function(){cleverapps.versionChecker.check()},interval:"1 hour"},versionCheckAlert:{type:Placements.FREE_FOCUS,priority:10,filter:function(){return cleverapps.versionChecker.needUpdate()},action:function(){cleverapps.metha.display({focus:"VersionChecker.Alert",action:function(e){new NewVersionWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}},stuckwindow:{type:Placements.FREE_FOCUS_MAIN,action:StuckWindow.displayIfNeeded,priority:0,interval:"3 day"},communityManagerReward:{type:Placements.FREE_FOCUS_MAIN,priority:9,interval:"10 minutes",filter:function(){return cleverapps.communityManager.isRewardAvailable()},action:function(){cleverapps.communityManager.receiveReward()}},displaySceneIntro:{type:Placements.FREE_FOCUS,priority:-1e3,filter:function(){return cc.director.getRunningScene().needDisplayIntro&&!cleverapps.flags.introDisabled},action:function(){cc.director.getRunningScene()._playIntro()}},packManagerLowBalance:{type:Placements.FREE_FOCUS_MAIN,priority:3,
filter:function(){return cleverapps.packManager.isAvailable()&&cleverapps.user.gold<100},action:function(){cleverapps.metha.display({focus:"showPackWindow",action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:s?"3 day":"5 minute"},packManager:{type:Placements.FREE_FOCUS_MAIN,priority:3,filter:function(){return cleverapps.packManager.isAvailable()&&100<=cleverapps.user.gold},action:function(){cleverapps.metha.display({focus:"showPackWindow",action:function(e){new PackWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"3 day"},interstitialMerge:{type:Placements.FREE_FOCUS,priority:0,filter:function(){return s},action:function(){cleverapps.rewardedAdsManager.showInterstitial()},interval:PlingaAds.isAppropriate()?"5 minutes":"30 minutes"},subscribeBot:{type:Placements.STARTUP,filter:function(){return cleverapps.social.createBot},action:function(){cleverapps.social.createBot()}},createShortcut:{type:Placements.FREE_FOCUS,filter:function(){
return Placements.needCreateShortcut},action:function(){Placements.needCreateShortcut=!1,cleverapps.social.createShortcut()},interval:"10 minutes"},addShortcut:{type:Placements.VICTORY,filter:function(){return cleverapps.social.createShortcut&&levels.user.checkAvailable(cleverapps.Availables.CREATE_SHORTCUT)},action:function(){Placements.needCreateShortcut=!0},interval:"10 minutes"},canUpgradeHeroes:{type:Placements.FREE_FOCUS_MAIN,priority:-1,filter:function(){return"undefined"!=typeof match3&&void 0!==match3.heroes&&(match3.heroes.available()&&cleverapps.forces.isShown(Forces.HEROES_AVAILABLE.id)&&match3.heroes.canUpgradeSomebody())},action:function(){cleverapps.metha.display({focus:"CanUpgradeHeroWindow",action:function(e){new CanUpgradeHeroWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"10 minutes"},piggyBankFull:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.piggyBank.isActive()&&cleverapps.piggyBank.isFull()},action:function(){
cleverapps.metha.display({focus:"PiggyBankWindow",control:"MenuBarGoldItem",action:function(e){new PiggyBankWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"1 hour"},VKPromo:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.social instanceof cleverapps.VK},action:function(){cleverapps.social.isPromoAvailable("2021-02-15","2021-02-28",["heroes"])&&cleverapps.social.processPromo(9)}},checkCompensatePayments:{type:Placements.INTERMEDIATE,filter:function(){return cleverapps.payments.canCompensate()},action:function(){cleverapps.payments.compensate()},interval:"1 second"},checkCompensatePaymentsCounter:{type:Placements.EMPTY_COUNTER,filter:function(){return cleverapps.payments.canCompensate()},action:function(){cleverapps.payments.compensate()},interval:"5 minutes"},showCompensation:{type:Placements.FREE_FOCUS|Placements.EMPTY_COUNTER,filter:function(){return void 0!==cleverapps.payments.compensateProductCode},action:function(){var e=Product.Create(
cleverapps.payments.compensateProductCode);e.compensate(function(){cleverapps.eventLogger.logEvent("product_compensate",{amount:e.price}),cleverapps.payments.compensateProductCode=void 0})},interval:"1 second"},showClientCompensation:{type:Placements.FREE_FOCUS|Placements.EMPTY_COUNTER,filter:function(){return cleverapps.payments.existClientCompensateProduct()},action:function(){var e=cleverapps.payments.getClientCompensateProduct(),t=Product.Create(e);t.compensate(function(){cleverapps.eventLogger.logEvent("product_compensate_client",{amount:t.price}),cleverapps.payments.processClientCompensateProduct(e)})},interval:"1 second"},subscription:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.subscription&&cleverapps.subscription.isRewardReady()},action:function(){cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"10 minute"},subscriptionOffer:{
type:Placements.FREE_FOCUS_MAIN,filter:function(){return Subscription.IsAvailable()&&!cleverapps.subscription.isActive()&&cleverapps.subscription.canBuyTrial()},action:function(){cleverapps.metha.display({focus:"SubscriptionWindow",action:function(e){new SubscriptionWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:-1!==["mobile_ok","web_ok"].indexOf(cleverapps.User.calcSource())?"30 minutes":"3 day"},dailyCup:{type:Placements.INTERMEDIATE_OR_AFTER_FINISH|Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.dailyCup&&DailyCup.IsAvailable(DailyCup.TYPE_DAILY)},action:function(){cleverapps.dailyCup.reload()}},weeklyCup:{type:Placements.INTERMEDIATE_OR_AFTER_FINISH|Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.weeklyCup&&DailyCup.IsAvailable(DailyCup.TYPE_WEEKLY)},action:function(){cleverapps.weeklyCup.reload()}},promotion:{type:Placements.FREE_FOCUS_MAIN,priority:-1,filter:function(){return cleverapps.promotion.isReady()},action:function(){
cleverapps.metha.display({focus:"PromotionWindow",action:function(e){cleverapps.Promotion.ShowFirstAvailable(),cleverapps.metha.onceNoWindowsListener=e}})},interval:"3 days"},starChest:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.starChest&&!cleverapps.starChest.locked},action:function(){cleverapps.metha.display({focus:"StarChestWindow",action:function(e){new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})}},unlimitedLivesStart:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.lives},action:function(){s||0!==levels.user.episode||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)||(cleverapps.tempGoods.buyGood(cleverapps.TempGoods.UNLIMITED_LIVES,cleverapps.parseInterval("3 hours")),cleverapps.lives.onBuyUnlimitedLivesListener())}},unlimitedLivesWindow:{type:Placements.FREE_FOCUS,priority:0,filter:function(){return cleverapps.lives&&(cleverapps.environment.isMainScene(
)||cleverapps.environment.isDailyCupScene())},action:function(){cleverapps.tempGoods.displayPromotionOnFinish()}},nativeInstall:{type:Placements.FREE_FOCUS_MAIN,priority:3,filter:function(){return"match3"===cleverapps.config.type},action:function(){cc.sys.isMobile&&!cc.sys.isNative&&-1===["mobile_ok","mobile_vk","mobile_mm","instant","sp_mbga","huzcom","plinga","pliega"].indexOf(cleverapps.User.calcSource())&&cleverapps.metha.display({focus:"NativeInstallWindow",action:function(e){new NativeInstallWindow,cleverapps.metha.onceNoWindowsListener=e}})},interval:"5 day"},minigameNudge:{type:Placements.FREE_FOCUS_MAIN,priority:4,filter:function(){return 0<cleverapps.missionManager.getPlayableMissions().length},action:function(){for(var e=cleverapps.missionManager.getPlayableMissions(),t=0;t<e.length;t++){var s=e[t];if(s.nudgeWindow&&s.started&&(void 0===s.needShowStartWindow||s.needShowStartWindow))return void cleverapps.metha.display({focus:"NudgeWindow",action:function(e){
new s.nudgeWindow(s),cleverapps.metha.onceNoWindowsListener=e}})}},interval:"10 minutes"},localstorageDisabled:{type:Placements.FREE_FOCUS_MAIN,priority:6,filter:function(){return!cleverapps.DataLoader.enabled&&!cleverapps.DataLoader.alerted},action:function(){cleverapps.DataLoader.alerted=!0,cleverapps.metha.display({focus:"LocalStorageDisabledWindow",action:function(e){new LocalStorageDisabledWindow,cleverapps.metha.onceNoWindowsListener=e}})}},sideBarRefresh:{priority:6,type:Placements.FREE_FOCUS,filter:function(){return cleverapps.environment.isMainScene()||cleverapps.environment.isEditorScene()},action:function(){cleverapps.sideBar.refreshAllIcons()}},sideBarProgress:{priority:-3,type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.sideBar.getIconsWithProgress().length},action:function(){cleverapps.sideBar.showProgress()}},sideBarForce:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return void 0!==cleverapps.sideBar.anyIconWithForceIndex()},action:function(){
cleverapps.sideBar.showAnyForce()}},cryptexForce:{type:Placements.FREE_FOCUS_GAME,priority:-1001,filter:function(){return Game.currentGame&&Game.currentGame.cryptex&&Game.currentGame.cryptex.canShowForce()},action:function(){Game.currentGame.cryptex.showForce()}},playChangeOutcome:{type:Placements.FREE_FOCUS_GAME,priority:0,filter:function(){return cc.director.getRunningScene().wantAnimateChangeOutcome},action:function(){cc.director.getRunningScene().playChangeOutcome()}},gunForce:{type:Placements.FREE_FOCUS_GAME,priority:5,filter:function(){return Game.currentGame&&cleverapps.gun.isForceAvailable()},action:function(){cleverapps.gun.showForce()}},heroesUnlockTutorial:{type:Placements.FREE_FOCUS_OTHER,filter:function(){return cleverapps.environment.isHeroesScene()&&"undefined"!=typeof match3&&match3.heroes.canUnlockTutorial()},action:function(){match3.heroes.unlockTutorial()}},heroesUpgradeTutorial:{type:Placements.FREE_FOCUS_OTHER,filter:function(){
return cleverapps.environment.isHeroesScene()&&"undefined"!=typeof match3&&match3.heroes.canUpgradeTutorial()&&!match3.heroes.canUnlockTutorial()},action:function(){match3.heroes.upgradeTutorial()}},homefixNewTask:{type:Placements.FREE_FOCUS_METHA,filter:function(){return cleverapps.metha.getType()==Metha.HOMEFIX&&cleverapps.home.needNewTask()},action:function(){var e=cleverapps.home.furniture.filter(function(e){return e.readyToOpen()});cleverapps.metha.display({focus:"homefixNewTask",actions:e.map(function(t){return function(e){cleverapps.home.giveNewTask(e,t)}})})}},toolbarForce:{type:Placements.FREE_FOCUS_MAIN,filter:function(){return cleverapps.toolbar.anyItemWithForce()},action:function(){cleverapps.toolbar.showAnyForce()}},keypadForce:{priority:-1001,type:Placements.FREE_FOCUS_GAME,filter:function(){return Game.currentGame&&Game.currentGame.keypad&&Game.currentGame.keypad.isForceAvailable()},action:function(){Game.currentGame.keypad.showForce()}},keypadTrickyForce:{
priority:-1001,type:Placements.FREE_FOCUS_GAME,filter:function(){return Game.currentGame&&Game.currentGame.keypad&&Game.currentGame.keypad.isTrickyForceAvailable&&Game.currentGame.keypad.isTrickyForceAvailable()},action:function(){cleverapps.metha.display({focus:"TrickyForce",action:function(e){Game.currentGame.keypad.showTrickyForce(e)}})}},knockoutTutorial:{priority:-1001,type:Placements.FREE_FOCUS,filter:function(){return cleverapps.isKnockoutGame()&&cleverapps.knockoutTutorial.isAvailable()},action:function(){cleverapps.metha.display({focus:"KnockoutTutorialStep"+cleverapps.knockoutTutorial.step,control:cleverapps.knockoutTutorial.control,action:function(e){cleverapps.knockoutTutorial.run(e)}})}},missionFinished:{type:Placements.FREE_FOCUS_MAIN,priority:5,filter:function(){return cleverapps.missionManager.removeSilents(),cleverapps.missionManager.anyCompleted()},action:function(){var e=cleverapps.missionManager.anyCompleted();e&&cleverapps.missionManager.displayCompleted(e)}},
missionManagerProcess:{type:Placements.FREE_FOCUS_MAIN,priority:5,action:function(){cleverapps.missionManager.run()}},missionStarted:{type:Placements.FREE_FOCUS_MAIN,priority:5,filter:function(){return cleverapps.missionManager.pendingStartWindow()},action:function(){cleverapps.missionManager.showStartWindow()}},displayBattlePassWindow:{type:Placements.FREE_FOCUS_MAIN|Placements.EMPTY_COUNTER,filter:function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_BATTLEPASS);return e&&e.logic.needDisplayWindow()},action:function(){var t=cleverapps.missionManager.findByType(Mission.TYPE_BATTLEPASS);t.isRunning()?cleverapps.metha.display({focus:"BattlePassWindow",actions:[function(e){var t=cleverapps.sideBar.getIconsWithProgress().filter(function(e){return e instanceof MissionIcon&&e.mission.type===Mission.TYPE_BATTLEPASS})[0];t?(cleverapps.metha.showControlsWhileFocused("sidebar"),t.showProgress(),setTimeout(e,3e3)):e()},function(e){cleverapps.metha.hideControlsWhileFocused("sidebar")
,new t.view(t),cleverapps.metha.onceNoWindowsListener=e}]}):cleverapps.missionManager.displayCompleted(t)}},sceneChangeSize:{type:Placements.FREE_FOCUS,filter:function(){return cleverapps.FixedWidthScene.changedSize},action:function(){delete cleverapps.FixedWidthScene.changedSize;var e=cc.director.getRunningScene();e&&e.onChangeSize&&e.onChangeSize()}},friendsCache:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cc.sys.isNative},action:function(){cleverapps.friends.reload(),cleverapps.invitalbleFriends.reload()}},parallax:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.Parallax.refresh()}},localPushes:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.localPushes.onShow()}},syncClientSessionExpiredWindow:{type:Placements.FREE_FOCUS,priority:1e4,filter:function(){return cleverapps.synchronizer.needClientSessionExpiredWindow()},action:function(){cleverapps.synchronizer.showClientSessionExpiredWindow()}},syncReloadWindow:{
type:Placements.FREE_FOCUS,priority:10001,filter:function(){return cleverapps.synchronizer._syncIn.needShowReloadWindow()},action:function(){cleverapps.synchronizer._syncIn.showReloadWindow()}},syncSocialConnectWindow:{type:Placements.FREE_FOCUS,priority:10,filter:function(){return cleverapps.synchronizer.wantsSocialConnectWindow},action:function(){cleverapps.synchronizer.displaySocialConnectWindow()}},sync:{type:Placements.ONSHOW_NO_FOCUS_CHECK,action:function(){cleverapps.synchronizer.syncWhenReady()},interval:"30 seconds"},nativeCheckConnection:{type:Placements.FREE_FOCUS_MAIN,filter:function(){var e={episode:1,level:2};return s&&(e={episode:0,level:5}),cc.sys.isNative&&!cleverapps.social.isLoggedIn()&&cleverapps.user.checkAvailable(e)},action:function(){cleverapps.metha.display({focus:"nativeCheckConnection",action:function(e){cleverapps.social.checkConnection(e,e)}})},interval:"7 days"},mergeRateWindow:{type:Placements.FREE_FOCUS,filter:function(){
return s&&cc.sys.isNative&&!cleverapps.flags.norest&&levels.user.checkAvailable(RateWindow.AVAILABLE)&&!RateWindow.hadRated()},action:function(){cleverapps.metha.display({focus:"nativePlacementRate",action:function(e){new RateWindow,cleverapps.metha.onceNoWindowsListener=e}})}},loginPlacementCheckConnection:{type:Placements.FREE_FOCUS,filter:function(){return cleverapps.social.loginPlacement&&!cleverapps.social.isLoggedIn()&&!cleverapps.social.placementConnectionChecked},action:function(){cleverapps.social.placementConnectionChecked=!0,cleverapps.social.checkConnection()}},bounty:{type:Placements.ONSHOW_OR_STARTUP|Placements.INTERMEDIATE,action:function(){cleverapps.bountyManager.sendIfNeed()}},subscriptionReload:{type:Placements.ONSHOW_OR_STARTUP,filter:function(){return cleverapps.subscription},action:function(){cleverapps.subscription.reload()}},userDAU:{type:Placements.ONSHOW_OR_STARTUP,action:function(){cleverapps.user.calcIdfa(),cleverapps.user.visited<Date.now(
)-cleverapps.parseInterval(cleverapps.User.ON_SHOW_CHANGE_VISITED)&&(cleverapps.user.updateVisited(),cleverapps.user.reportDAU(!0))}},wardrobeItemReceived:{type:Placements.FREE_FOCUS_MAIN,priority:8,filter:function(){var e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_WARDROBE);return e&&e.logic.stageToShow},action:function(){var t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_WARDROBE),s=t.logic.stageToShow;cleverapps.metha.display({focus:"WardrobeWindow",actions:[function(e){new WardrobeReceiveWindow(t,WardrobeWindow.prizes[s]),cleverapps.metha.onceNoWindowsListener=e,cleverapps.eventLogger.logEvent("receive_"+cleverapps.styles.WardrobeWindow.eventName+"_"+s),t.logic.stageToShow=void 0},function(e){t.logic.runReceiveDialogue(e)},function(e){t.logic.givePrize(s,e)},function(e){new WardrobeWindow(t),cleverapps.metha.onceNoWindowsListener=e}]})}},appleRestore:{type:Placements.FREE_FOCUS_MAIN,filter:function(){
return cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.subscription&&!cleverapps.subscription.isActive()},action:function(){cleverapps.payments.restore()},interval:"1 month"},appleBuyStoreProduct:{type:Placements.FREE_FOCUS,filter:function(){return cc.sys.os===cc.sys.OS_IOS&&cc.sys.isNative&&cc.sys.isWebView&&cleverapps.payments.storeProductName},action:function(){cleverapps.payments.buyStoreProduct()}},animatePassLevel:{type:Placements.FREE_FOCUS_MAIN,priority:-2,filter:function(){return PlayButton.IsAvailable()&&cleverapps.playButton.passedLevel},action:function(){cleverapps.playButton.animatePassLevel()}},simpleForce:{type:Placements.FREE_FOCUS_MAIN,priority:9,filter:function(){return cleverapps.metha.getType()===Metha.SIMPLE&&cleverapps.simple.isForceAvailable()},action:function(){cleverapps.metha.display({focus:"simpleForce",control:["play_button","progress_view"],actions:[function(e){PlayButton.IsAvailable(
)&&cleverapps.playButton.passedLevel&&cleverapps.playButton.animatePassLevel(),0<cleverapps.simple.pendingsStars?cleverapps.simple.updateProgress(e):e()},function(e){cleverapps.simple.showForce(e)}]})}},simpleUpdateProgress:{type:Placements.FREE_FOCUS_MAIN,priority:-2,filter:function(){return cleverapps.metha.getType()===Metha.SIMPLE&&0<cleverapps.simple.pendingsStars&&!cleverapps.simple.canMoveNext()},action:function(){cleverapps.simple.updateProgress()}},simpleMoveNext:{type:Placements.FREE_FOCUS_MAIN,priority:9,filter:function(){return cleverapps.metha.getType()===Metha.SIMPLE&&cleverapps.simple.canMoveNext()},action:function(){cleverapps.metha.display({focus:"simpleMoveNext",control:["play_button","progress_view"],actions:[function(e){PlayButton.IsAvailable()&&cleverapps.playButton.passedLevel&&cleverapps.playButton.animatePassLevel(),0<cleverapps.simple.pendingsStars?cleverapps.simple.updateProgress(e):e()},function(e){cleverapps.simple.moveNext(e)}]})}},bonusWorldFinished:{
type:Placements.FREE_FOCUS,filter:function(){return cleverapps.environment.isBonusWorldScene()&&cc.director.getRunningScene().bonusWorld.isFinished()},action:function(){var t=cc.director.getRunningScene().bonusWorld;cleverapps.metha.display({focus:"bonusWorldFinished",action:function(e){t.finish(e)}})}},bonusWorldReward:{type:Placements.FREE_FOCUS,priority:2,filter:function(){return cleverapps.environment.isBonusWorldScene()&&cc.director.getRunningScene().bonusWorld.getAvailableReward()},action:function(){var t=cc.director.getRunningScene().bonusWorld;cleverapps.metha.display({focus:"bonusWorldReward",actions:[function(e){t.levelPassed?(t.animateChangeProgress(),setTimeout(e,2e3)):e()},function(e){t.giveReward(e)}]})}},bonusWorldProgress:{type:Placements.FREE_FOCUS,priority:1,filter:function(){return cleverapps.environment.isBonusWorldScene()&&cc.director.getRunningScene().bonusWorld.levelPassed},action:function(){cc.director.getRunningScene().bonusWorld.animateChangeProgress()}},
runCounterStages:{type:Placements.FREE_FOCUS,priority:1,action:function(){s&&Game.currentGame&&!Game.currentGame.counter.isActive()&&Game.currentGame.counter.setTimeout(function(){},0)}},repeatedQuests:{type:Placements.ONSHOW_NO_FOCUS_CHECK|Placements.AFTER_GAME_START,priority:1,filter:function(){return s&&cleverapps.environment.isGameScene()&&Game.currentGame&&Game.currentGame.quests.isRepeatedQuestsAvailable()},action:function(){Game.currentGame.quests.runRepeatedQuests()},interval:cleverapps.config.debugMode?"10 seconds":"1 hour"},slotMachineForce:{type:Placements.FREE_FOCUS_OTHER,filter:function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_SLOT_MACHINE);return cleverapps.environment.isSlotMachineScene()&&e&&e.slotMachine.isForceAvailable()},action:function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_SLOT_MACHINE);e&&e.slotMachine.showForce()}},runSpecialEnergyOffer:{type:Placements.FREE_FOCUS_MAIN|Placements.EMPTY_COUNTER,
interval:cleverapps.config.debugMode?"1 minute":"24 hours",filter:function(){return void 0!==SpecialEnergyOfferWindow&&cleverapps.lives&&cleverapps.lives.needShowSpecialOffer},action:function(){cleverapps.metha.display({focus:"SpecialEnergyOfferWindow",action:function(e){delete cleverapps.lives.needShowSpecialOffer,new SpecialEnergyOfferWindow,cleverapps.metha.onceNoWindowsListener=e}})}},showChatPresents:{priority:1,type:Placements.FREE_FOCUS,filter:function(){return void 0!==cleverapps.chatPresents&&(cleverapps.environment.isMainScene()||cleverapps.environment.isGameScene())},action:function(){if(s&&cleverapps.chatPresents.reward.unit){var e=cleverapps.chatPresents.reward.unit,t=e.amount-Game.currentGame.map.countEmptySlots();if(0<t)return delete cleverapps.chatPresents,void Game.currentGame.onHintMessage("messages:Spawn.nospace",!1,{left:t});if(!Game.currentGame.unitsLibrary.isOpened(e))return delete cleverapps.chatPresents,void Game.currentGame.onHintMessage(
"messages:RestartWindow.OnError")}cleverapps.metha.display({focus:"chatPresentsWindow",control:["MenuBarGoldItem","MenuBarLivesItem","MenuBarCoinsItem","MenuBarWandsItem","MenuBarWorkersItem","MenuBarExpItem"],action:function(e){new RewardWindow({reward:cleverapps.chatPresents.reward,callback:cleverapps.chatPresents.callback}),cleverapps.metha.onceNoWindowsListener=function(){delete cleverapps.chatPresents,e()}}})}}}},Placements.prototype.resetAllPlacements=function(){this.lastStarts={},this.save()},Placements.prototype.run=function(e){for(var t=this.listKeys(e),s=0;s<t.length;s++){var i=t[s],n=this.data[i];if(n.interval){var o=cleverapps.parseInterval(n.interval);if((this.lastStarts[i]||0)+o>Date.now())continue}if(!n.filter||n.filter()){var r=0!=(n.type&Placements.FREE_FOCUS);if(r){if(cleverapps.metha.isFocused())continue;if(-1===n.priority&&this.lastFreeFocusStart+cleverapps.parseInterval("1 minute")>Date.now())continue}if(n.action(),this.lastStarts[i]=Date.now(),
r&&cleverapps.metha.isFocused()){this.lastFreeFocusStart=Date.now();break}}}this.save()},Placements.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PLACEMENTS);this.lastStarts={},e&&e.lastStarts&&(this.lastStarts=e.lastStarts)},Placements.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PLACEMENTS,{lastStarts:this.lastStarts})},Placements.STARTUP=1,Placements.INTERMEDIATE=2,Placements.VICTORY=4,Placements.LOSE=16,Placements.AFTER_GAME_FINISH=32,Placements.ONSHOW=128,Placements.FREE_FOCUS_MAIN=256,Placements.FREE_FOCUS_GAME=512,Placements.FREE_FOCUS_METHA=1024,Placements.FREE_FOCUS_OTHER=2048,Placements.ONSHOW_NO_FOCUS_CHECK=4096,Placements.EMPTY_COUNTER=8192,Placements.AFTER_GAME_START=16384,Placements.FREE_FOCUS=Placements.FREE_FOCUS_MAIN|Placements.FREE_FOCUS_GAME|Placements.FREE_FOCUS_OTHER,Placements.ONSHOW_OR_STARTUP=Placements.ONSHOW|Placements.STARTUP,
Placements.INTERMEDIATE_OR_AFTER_FINISH=Placements.INTERMEDIATE|Placements.AFTER_GAME_FINISH;var PlaySession=function(){this.load(),this.onEndSessionListeners=[PlaySession.ViralSentReporter,PlaySession.RewardedReporter,PlaySession.DailyTasksReporter,PlaySession.HelpByAttemptsReporter,PlaySession.SettingsReporter,PlaySession.DailyCupReporter,PlaySession.MiniGameReporter,PlaySession.MissionReporter,PlaySession.PaymentReporter,PlaySession.BonusWorldReporter,PlaySession.SlotMachineReporter]};PlaySession.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PLAY_SESSION);e||(e={}),this.data=e},PlaySession.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PLAY_SESSION,this.data)},PlaySession.prototype.endSession=function(){this.onEndSessionListeners.forEach(function(e){e(this.data)},this),this.data={},this.save()},PlaySession.prototype.inc=function(e,t){void 0===t&&(t=1);var s=this.data[e];void 0===s&&(s=0),this.set(e,s+t)},
PlaySession.prototype.set=function(e,t){this.data[e]=t,this.save()},PlaySession.prototype.notifyActive=function(){var e=this.nextSendActive||0;if(Date.now()>=e){this.nextSendActive=Date.now()+cleverapps.parseInterval(PlaySession.ACTIVE_TIME_INTERVAL);var t=cleverapps.user.getDaysSinceRegistration(),s="RETENTION_"+t;cleverapps.EVENTS[s]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ACTIVE_TIME+"_"+t)}},PlaySession.SettingsReporter=function(e){cleverapps.eventLogger.logEvent("resolution_"+cleverapps.settings.calcResolution()),cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_LOW?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_LOW):cleverapps.settings.fpsMode===cleverapps.Settings.FPS_MODE_HIGH?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_HIGH):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FPS_AUTO)},PlaySession.ViralSentReporter=function(e){void 0===e.viral||0===e.viral?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_NONE
):e.viral<=3?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_3):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.VIRAL_SENT_REST)},PlaySession.RewardedReporter=function(e){cleverapps.whenAllInitialized(function(){RewardedAdsManager.IsEnabled()&&!cleverapps.flags.almostNoAds&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&e[cleverapps.EVENTS.AD_READY+"_"+RewardedAdsManager.REWARDED]&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_AVAILABLE),e[cleverapps.EVENTS.REWARDED_WATCHED]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_WATCHED))})},PlaySession.HelpByAttemptsReporter=function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_DAU);var t=e[cleverapps.EVENTS.HELP_BY_FIVE_ATTEMPTS];1<=t&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_ONE_AND_MORE),3<=t&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HELP_BY_ATTEMPTS_THREE_AND_MORE),5<=t&&cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.HELP_BY_ATTEMPTS_FIVE_AND_MORE)},PlaySession.DailyTasksReporter=function(e){if(levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_AVAILABLE),e[cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW);var t=e[cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH];t&&(3<t&&(t=3),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH+"_"+t));var s=e[cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD];s&&(3<s&&(s=3),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD+"_"+s))}},PlaySession.DailyCupReporter=function(e){e[cleverapps.EVENTS.DAILY_CUP_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_DAU),e[cleverapps.EVENTS.DAILY_CUP_PLAYERS]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_PLAYERS)},PlaySession.MiniGameReporter=function(t){Object.keys(t).forEach(
function(e){0===e.indexOf(cleverapps.EVENTS.MINIGAME_FINISH)&&t[e]&&cleverapps.eventLogger.logEvent(e+"_dau")})},PlaySession.MissionReporter=function(t){Object.keys(t).forEach(function(e){0===e.indexOf(cleverapps.EVENTS.MISSION_DAU)&&t[e]?cleverapps.eventLogger.logEvent(e):0===e.indexOf(cleverapps.EVENTS.MISSION_START_DAU)&&t[e]&&cleverapps.eventLogger.logEvent(e)})},PlaySession.PaymentReporter=function(t){[cleverapps.EVENTS.PAYMENT_OPEN,cleverapps.EVENTS.PAYMENT_FAILURE,cleverapps.EVENTS.PAYMENT_CANCEL,cleverapps.EVENTS.PAYMENT_NOT_REFRESHED,cleverapps.EVENTS.PAYMENT_NOT_INITIALIZED,cleverapps.EVENTS.PAYMENT_SUCCESS].forEach(function(e){t[e]&&cleverapps.eventLogger.logEvent(e)})},PlaySession.BonusWorldReporter=function(e){e[cleverapps.EVENTS.BONUS_WORLD_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BONUS_WORLD_DAU),e[cleverapps.EVENTS.BONUS_WORLD_LEVEL_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BONUS_WORLD_LEVEL_DAU)},PlaySession.SlotMachineReporter=function(e){
e[cleverapps.EVENTS.SLOT_MACHINE_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SLOT_MACHINE_DAU),e[cleverapps.EVENTS.SLOT_MACHINE_SPIN_DAU]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SLOT_MACHINE_SPIN_DAU)},PlaySession.ACTIVE_TIME_INTERVAL="1 minute";var ExecutorPool=function(e){e=e||{},this.amount=e.amount||1e3,this.interval=e.interval||"1 second",this.events=new cleverapps.EventsQueue(this.interval),this.delay=cleverapps.parseInterval(e.delay||"0 second"),this.tasks=[],this.timeout=void 0};ExecutorPool.prototype.execute=function(e){this.tasks.push({callback:e,event:Date.now()}),this.processFirst()},ExecutorPool.prototype.processFirst=function(){if(void 0!==this.timeout&&(clearTimeout(this.timeout),delete this.timeout),0!==this.tasks.length){var e=this.tasks[0],t=Date.now();if(e.event+100<t&&t<e.event+this.delay)this.timeout=setTimeout(this.processFirst.bind(this),t-e-this.delay);else{if(this.events.size()>=this.amount){var s=this.events.getShrinkLeftTime();if(
s&&0<s&&this.events.size()>=this.amount)return void(this.timeout=setTimeout(this.processFirst.bind(this),s))}this.tasks.shift(),e.callback()!==cleverapps.NO_ACTION&&this.events.add(t),this.processFirst()}}},cleverapps.Flags=function(){this.init(),cleverapps.whenAllInitialized(function(){cleverapps.paymentsHistory.onAddPaymentListeners.flags=this.update.bind(this),cleverapps.payments.onAvailableListeners.flags=this.update.bind(this),this.initAbTestFlags()}.bind(this))},cleverapps.Flags.prototype.initAbTestFlags=function(){},cleverapps.Flags.prototype.init=function(){var e=cleverapps.User.calcSource();this.norest=-1!==["huzcom","pliega"].indexOf(e),this.noLogEvents=-1!==["huzcom","pliega"].indexOf(e),this.noviral=-1!==["huzcom","plinga","pliega","ayodo1","iyodo1","xsolla"].indexOf(e),this.noshares=-1!==["android","amazon","ios","pliega","sp_mbga","ayodo1","iyodo1"].indexOf(e),this.nologin=-1!==["huzcom","plinga","pliega","ayodo1","iyodo1"].indexOf(e)||cleverapps.config.nologin,
this.nocommunity=-1!==["huzcom","plinga","pliega"].indexOf(e),this.doubleRewards=-1!==["huzcom","plinga","pliega"].indexOf(e),this.reduceAds=-1!==["web_ok","mobile_ok","web_vk","mobile_vk","web_mm","mobile_mm"].indexOf(e),this.videoAdsMainMonetization=-1!==["plinga","ayodo1","iyodo1"].indexOf(e),this.nofirebase=-1!==["pliega","ayodo1","iyodo1"].indexOf(e),this.noadjust=-1!==["pliega","ayodo1","iyodo1"].indexOf(e),this.nofacebookevents=-1!==["pliega","ayodo1","iyodo1"].indexOf(e),this.nosocial=-1!==["pliega","huzcom","ayodo1","iyodo1"].indexOf(e),this.softCurrencyRealProduct=-1!==["mbga","sp_mbga"].indexOf(e),cleverapps.config.wysiwygMode&&(this.wysiwyg={skipSpecialOffer:!1,skipBuildingStage:!1,skipOpenChestWindow:!1,skipQuests:!0,mergeAnimation2:!1,automerge:!1,customMergeAnimation:!1,customCollectAnimation:!1,hidePrizeView:!1,hideGuideAndProgress:!1,hideFruitParticlesAnimation:!1,hideUnitPointAnimation:!1,customHighlight:!1,collectionWithSwipe:!1,customFog:!1,fastSpawnPrizes:!1,
pickingStrawberriesIntoBasket:!1},"match3"===cleverapps.config.type&&(this.adsField={}))},cleverapps.Flags.prototype.reset=function(){this.init(),this.update()},cleverapps.Flags.prototype.update=function(){this.nopayments=!cleverapps.payments.isAvailable(),this.almostNoAds=!1;var e=cleverapps.user.getProgress();(cleverapps.paymentsHistory.classify("1 month")!==cleverapps.PaymentsHistory.PAYER_NONE||e<cleverapps.Flags.MIN_PROGRESS_VIRAL_ADS)&&(this.videoAdsMainMonetization||(this.almostNoAds=!0),this.noviral=!0,levels.friendRequests.deleteFakeRequests());var t=cleverapps.User.calcSource();this.noviral||"instant"!==t||cleverapps.config.platform!==cleverapps.Instant.PLATFORM_WEB||(this.noviral=!0,levels.friendRequests.deleteFakeRequests())},cleverapps.Flags.MIN_PROGRESS_VIRAL_ADS="merge"===cleverapps.config.type?3:20;var SuccessWait=function(e,t){this.task=e,this.callback=cleverapps.once(t),this.active=!0,this.timeout=void 0,this.run()};SuccessWait.prototype.run=function(){this.active&&(
this.timeout=clearTimeout(this.timeout),this.task({onSuccess:this.onSuccess.bind(this),onFailure:this.onFailure.bind(this)}))},SuccessWait.prototype.onSuccess=function(){this.callback(),this.clear()},SuccessWait.prototype.onFailure=function(e){if(cleverapps.checkStatus(e,404))return console.log("receive 404"),void this.clear();this.timeout=clearTimeout(this.timeout),this.timeout=setTimeout(this.run.bind(this),cleverapps.parseInterval("30 seconds"))},SuccessWait.prototype.cancel=SuccessWait.prototype.clear=function(){this.active=!1,this.timeout=clearTimeout(this.timeout)},cleverapps.Information=function(){this.data=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INFORMATION),void 0===this.data&&(this.data={}),this.diff={}},cleverapps.Information.prototype.onChangeUserId=function(){this.diff=this.data,this.update()},cleverapps.Information.prototype.reportMaxTextureSize=function(){if("undefined"!=typeof gl){var e=gl.getParameter(gl.MAX_TEXTURE_SIZE);this.setKeyValue("maxTextureSize"
,e)}},cleverapps.Information.prototype.reportPhone=function(){var e={};if(e[cc.sys.OS_ANDROID]={avatar:"#avatars/android_avatar.png",name:"Android"},e[cc.sys.OS_IOS]={avatar:"#avatars/ios_avatar.png",name:"iOS"},e[cc.sys.os]&&cc.sys.isNative){var t=cleverapps.social.isLoggedIn()&&"applesocial"!==cleverapps.social.getCode();this.data.avatar||t||cleverapps.info.setKeyValue("avatar",e[cc.sys.os].avatar),this.data.name||cleverapps.social.isLoggedIn()||cleverapps.info.setKeyValue("name",e[cc.sys.os].name+"_"+cleverapps.user.id.substr(-3))}"plinga"===cleverapps.User.calcSource()&&cleverapps.info.setKeyValue("avatar","#avatars/game_distribution.png")},cleverapps.Information.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INFORMATION,this.data)},cleverapps.Information.prototype.setKeyValue=function(e,t){this.data[e]&&"resolution"===e||JSON.stringify(this.data[e])!==JSON.stringify(t)&&(this.data[e]=t,this.diff[e]=t,this.update())},
cleverapps.Information.prototype.update=function(){this.save(),this._updateInner()},cleverapps.Information.prototype._updateInner=cleverapps.accumulate(5e3,function(){console.log("Sending information: "+JSON.stringify(this.diff)),cleverapps.RestClient.post("/info/"+levels.user.id,this.diff,function(e){},function(){}),this.diff={}}),cleverapps.Information.prototype.reportUserAgent=function(){var e,t;if("object"==typeof DeviceInfoPlugin)e=DeviceInfoPlugin.getDeviceName(),t=DeviceInfoPlugin.getAndroidVersion();else if(cc.sys.os===cc.sys.OS_IOS&&cc.sys.isWebView)e=cleverapps.webViewData.deviceName,t=cleverapps.webViewData.deviceVersion;else if(cc.sys.isNative)e=cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getDeviceName","()Ljava/lang/String;"):jsb.reflection.callStaticMethod("AppController","getDeviceName"),t=cc.sys.os===cc.sys.OS_ANDROID?jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getAndroidVersion",
"()Ljava/lang/String;"):jsb.reflection.callStaticMethod("AppController","getDeviceVersion");else{var s=(new UAParser).getResult(navigator.userAgent);e=s.browser.name,t=s.browser.major}this.setKeyValue("useragent",{browser:e,version:t})},cleverapps.Information.prototype.reportAppVersion=function(){this.setKeyValue("appversion",{version:cleverapps.config.version,source:cleverapps.User.calcSource()})},cleverapps.Information.prototype.reportSysLanguage=function(){this.setKeyValue("syslanguage",cc.sys.language)};var ActionPlayer=function(e){this.actions=[],this.add(e)};ActionPlayer.prototype.add=function(e){Array.isArray(e)?e.forEach(function(e){this.add(e)}.bind(this)):e&&this.actions.push(e)},ActionPlayer.prototype._playNext=function(){this.index===this.actions.length||this._stopped||this.actions[this.index++](this._playNext.bind(this))},ActionPlayer.prototype.play=function(e){this.index=0,e&&this.actions.push(e),this._playNext()},ActionPlayer.prototype.stop=function(){this._stopped=!0},
ActionPlayer.delay=function(t){return function(e){setTimeout(e,t)}};var NoMetha={gamePlayed:function(){}},Metha=function(){this.enabled=!0,this.focus="initialize",this.controls=[],this.onceNoWindowsListener=void 0,this.controlsVisible=!0,this.lastControlsVisible={},this.onControlsListeners={},this.pendingListeners=[]};Metha.prototype.registerControl=function(e,t){if(!cleverapps.flags.controlsHideDisabled){if("object"==typeof t){var s=t;t=s.createListener(s.toggle.bind(s))}(this.onControlsListeners[e]=t)(!1,!0),this.lastControlsVisible[e]=!1,(this.controlsVisible||-1!==this.controls.indexOf(e))&&(t(!0),this.lastControlsVisible[e]=!0)}},Metha.prototype.updateControlsVisibility=function(){for(var e in this.onControlsListeners){var t=this.controlsVisible||-1!==this.controls.indexOf(e);this.lastControlsVisible[e]!==t&&(this.onControlsListeners[e](t),this.lastControlsVisible[e]=t)}},Metha.prototype.setControlsVisible=function(e){this.controlsVisible=e,this.updateTimeout&&clearTimeout(
this.updateTimeout),this.updateTimeout=setTimeout(this.updateControlsVisibility.bind(this),100)},Metha.prototype.debugMessage=function(e){if(cleverapps.config.debugMode)throw cc.sys.isNative&&!cc.sys.isWebView&&console.log((new Error).stack),e;var t=(new Error).stack;setTimeout(function(){throw e+" .. "+t},0)},Metha.prototype.displayWhenFreeFocus=function(e){this.isFocused()?this.whenFreeFocus(this.display.bind(this,e)):this.display(e)},Metha.prototype.whenFreeFocus=function(e){this.isFocused()?this.pendingListeners.push(e):e()},Metha.prototype.distract=function(e){this.isFocused()||this.debugMessage("Distract without focus! "+e.focus),this.focus!==e.focus?(this.focus=!1,this.display(e)):this.debugMessage("Distract same focus!"+e.focus)},Metha.prototype.display=function(e){if(!this.isFocused()&&(!e.filter||e.filter())){var t=e.focus;this.grabFocus(t,e);var s=e.actions||[e.action];if(
cleverapps.info&&cleverapps.info.data&&cleverapps.info.data.useragent&&"Safari"===cleverapps.info.data.useragent.browser)this.compound(this.freeFocus.bind(this,t),s);else try{this.compound(this.freeFocus.bind(this,t),s)}catch(e){if(e instanceof RangeError||e.message&&-1!==e.message.indexOf("stack")){var i=e.message+" indexes - "+(e.indexes||[]).slice(-20)+" focuses - "+(e.focuses||[]).slice(-20)+" lengths - "+(e.actionsLength||[]).slice(-20)+" stack - "+JSON.stringify(e.stack);throw new Error(i)}throw e}}},Metha.prototype.compound=function(e,t,s,i){s=s||0,i=i||this.focus;if(this.focus===i)if(t.length!==s)if(cleverapps.info&&cleverapps.info.data&&cleverapps.info.data.useragent&&"Safari"===cleverapps.info.data.useragent.browser)t[s](this.compound.bind(this,e,t,s+1,i));else try{t[s](this.compound.bind(this,e,t,s+1,i))}catch(e){throw e.indexes=(e.indexes||[]).concat([s]),e.focuses=(e.focuses||[]).concat([i]),e.actionsLength=(e.actionsLength||[]).concat([t.length]),e}else e()},
Metha.prototype.showControlsWhileFocused=function(e,t){cleverapps.toArray(e).forEach(function(e){this.isFocused()&&this.controls.indexOf(e)<0?(this.controls.push(e),!0!==this.lastControlsVisible[e]&&(this.onControlsListeners[e]&&this.onControlsListeners[e](!0,t),this.lastControlsVisible[e]=!0)):t&&this.onControlsListeners[e]&&this.onControlsListeners[e](!0,t)},this)},Metha.prototype.controlIsHidden=function(e){return!!this.isFocused()&&this.controls.indexOf(e)<0},Metha.prototype.hideAllControls=function(){this.isFocused()&&this.controls.forEach(function(e){!1!==this.lastControlsVisible[e]&&(this.onControlsListeners[e]&&this.onControlsListeners[e](!1),this.lastControlsVisible[e]=!1)},this),this.controls=[]},Metha.prototype.hideControlsWhileFocused=function(e){Array.isArray(e)||(e=[e]),e.forEach(function(e){this.isFocused()&&0<=this.controls.indexOf(e)&&(this.controls.splice(this.controls.indexOf(e),1),!1!==this.lastControlsVisible[e]&&(
this.onControlsListeners[e]&&this.onControlsListeners[e](!1),this.lastControlsVisible[e]=!1))},this)},Metha.prototype.trigger=function(){if(!this.isFocused()){for(;0<this.pendingListeners.length;){if(this.pendingListeners.shift()(),this.isFocused())return}this.onFocusLostListenerPlacements()}},Metha.prototype.grabFocus=function(e,t){!1!==this.focus&&this.debugMessage("Want to grab focus: "+e+" focus is already given: "+this.focus),console.log("Grab focus: "+e),this.triggerTimeout&&(clearTimeout(this.triggerTimeout),this.triggerTimeout=void 0),this.focus=e,this.controls=[],t&&t.control&&(Array.isArray(t.control)?this.controls=t.control:this.controls=[t.control]),this.setControlsVisible(!1)},Metha.prototype.freeFocus=function(e){!1===this.focus&&this.debugMessage("Want to free focus: "+e+" focus is already free!"),this.focus===e?(console.log("Focus freed: "+this.focus),this.focus=!1,this.setControlsVisible(!0),this.triggerTimeout=setTimeout(this.trigger.bind(this),0)):console.log(
"Wrong focus clearing: "+this.focus+" > "+e)},Metha.prototype.isFocused=function(){return!1!==this.focus},Metha.prototype.getType=function(){switch(cleverapps.config.metha){case"farm":return Metha.FARM;case"homefix":return Metha.HOMEFIX;case"knockout":return Metha.KNOCKOUT;case"simple":return Metha.SIMPLE;case"none":return Metha.NONE}return Metha.HOSE},Metha.prototype.withSimpleMain=function(){if(-1!==["wordsoup"].indexOf(cleverapps.config.name)){var e=cleverapps.User.calcSource();if(-1!==["mobile_ok","mobile_vk","mobile_mm"].indexOf(e)||cleverapps.isLocalhost())return!0}return!1},Metha.prototype.gotoMainScene=function(e){var t=this.getMainScene();cleverapps.scenes.replaceScene(new t,e)},Metha.prototype.getMainScene=function(){switch(this.getType()){case Metha.FARM:case Metha.HOMEFIX:return this.withSimpleMain()?MethaSimpleMainScene:MethaScene;case Metha.KNOCKOUT:return KnockoutScene;case Metha.SIMPLE:return SimpleMainScene;case Metha.NONE:return MergeScene;default:
return levels.EpisodesScene}},Metha.prototype.getMainObject=function(){switch(this.getType()){case Metha.FARM:return cleverapps.farm;case Metha.HOMEFIX:return cleverapps.home;case Metha.KNOCKOUT:return cleverapps.knockout;case Metha.SIMPLE:return cleverapps.simple;case Metha.NONE:return NoMetha;default:return levels.episodes}},Metha.prototype.wantsToPlay=function(e,t){if(cleverapps.lives&&cleverapps.lives.isEmpty())return new LivesShopWindow,void(cleverapps.metha.onceNoWindowsListener=e);this.getMainObject().wantsToPlay(e,t)},Metha.prototype.wantsToReplay=function(e,t){var s=t.level;BoostersBefore.isAvailable()?this.getMainObject().wantsToReplay&&s.building?this.getMainObject().wantsToReplay(e,t):(new LevelStartWindow(t),cleverapps.metha.onceNoWindowsListener=e):s.play(e,t)},Metha.prototype.isControlEnabled=function(e){return!this.isFocused()||0<=this.controls.indexOf(e)},Metha.HOSE=0,Metha.FARM=1,Metha.HOMEFIX=2,Metha.KNOCKOUT=3,Metha.SIMPLE=4,Metha.NONE=5,cleverapps.User=function(s){
if(cleverapps.EventEmitter.call(this),this.onCantTakeGold=function(){!cleverapps.flags.nopayments||RewardedAdsManager.IsEnabled()&&!cleverapps.flags.almostNoAds?cleverapps.metha.isFocused()?new HardCurrencyShopWindow:cleverapps.metha.display({focus:"ShopWindow",control:"MenuBarGoldItem",action:function(e){new HardCurrencyShopWindow,cleverapps.metha.onceNoWindowsListener=e}}):cleverapps.Notification.create("messages:NotEnoughCoins")},this.onCantTakeExp=function(){},this.onLeagueChangeListener=function(){},this.onChangeExpListeners={},this.onChangeGold=function(){},s)this.initializeNewPlayer();else{var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.ID);this.loadData(e),this.lastReportDAU=this.getDaysSinceRegistration(e.visited)}var i=cleverapps.User.calcChannel();if(i&&(-1!==["web_ok","mobile_ok"].indexOf(this.source)||cleverapps.isLocalhost())){var t=(s?"user_channel_new_":"user_channel_old_")+i;cleverapps.eventLogger.logEvent(t),this.reportChannel=cleverapps.once(function(){
var e=cleverapps.getRequestParameters(location.search);e.custom_args&&(e=decodeURIComponent(e.custom_args));var t={source:this.source,channel:i,isnewuser:s,parameters:JSON.stringify(e)};cleverapps.RestClient.post("/users/playsession/"+this.id,t)}.bind(this)),s||(setTimeout(this.reportChannel.bind(this),0),this.channel=i,e.visited+cleverapps.parseInterval("7 days")<Date.now()&&(this.registered=Date.now()))}this.save(),this.reportDAU(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){this.calcIdfa(),this.visited<Date.now()-cleverapps.parseInterval(cleverapps.User.ON_SHOW_CHANGE_VISITED)&&(this.updateVisited(),this.reportDAU(!0))}.bind(this))},cleverapps.User.prototype=Object.create(cleverapps.EventEmitter.prototype),cleverapps.User.prototype.constructor=cleverapps.User,cleverapps.User.prototype.updateVisited=function(){this.visited=Date.now(),this.save()},cleverapps.User.prototype.incProgressCompare=function(e,t){e=e||1,this.progressCompare+=e,t||this.save()},
cleverapps.User.prototype.reportDAU=function(e){void 0!==this.lastReportDAU&&this.lastReportDAU===this.getDaysSinceRegistration()||(this.lastReportDAU=this.getDaysSinceRegistration(),cleverapps.User.reportAmountFriendsDau=function(){if(cleverapps.friends){var e=cleverapps.friends.listIds().length;5<e&&(e=5),cleverapps.eventLogger.logEvent(cleverapps.EVENTS["DAU_WFRIENDS_"+e]),cleverapps.User.reportAmountFriendsDau=void 0}},e&&cleverapps.User.reportAmountFriendsDau(),setTimeout(function(){if(cleverapps.playSession.endSession(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAU),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAU_LANGUAGE),this.gold<=1e6&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.USER_GOLD_DAU,{amount:this.gold}),cc.sys.isNative&&cleverapps.social.isLoggedIn()){var e=cleverapps.social.getCode();cleverapps.eventLogger.logEvent(e+"_loggedin_dau")}void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent(
"abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.DAU);var t=this.getDaysSinceRegistration(),s=function(){var e="RETENTION_"+t;cleverapps.EVENTS[e]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS[e])};0<t?s():(cleverapps.User.reportRetention=function(){cleverapps.user.checkAvailable(cleverapps.User.RETENTION_0_AVAILABLE)&&(s(),cleverapps.User.reportRetention=void 0)},cleverapps.User.reportRetention())}.bind(this),0))},cleverapps.User.prototype.getDaysSinceRegistration=function(e){return Math.floor(((e||Date.now())-this.registered)/1e3/24/60/60)},cleverapps.User.prototype.loadData=function(e){this.id=e.id,this.id||(this.id=this.generateTmpId()),this.gold=e.gold,this.registered=e.registered,this.source=e.source,this.source||(this.source=cleverapps.User.calcSource()),this.channel=e.channel,this.visited=Date.now(),this.exp=e.exp,this.league=this.calcLeague(),e.idfa1&&(this.idfa=e.idfa1),this.abtest=e.abtest,this.progressCompare=e.progressCompare||0},
cleverapps.User.prototype.isBeginner=function(){return this.episode<=1},cleverapps.User.prototype.isNovice=function(){return this.episode<=3&&1<this.episode},cleverapps.User.prototype.checkAvailable=function(e){return!0},cleverapps.User.prototype.generateTmpId=function(){return"__"+Math.floor(1e15*Math.random())},cleverapps.User.prototype.haveTmpId=function(){return 2<=this.id.length&&"__"===this.id.substr(0,2)},cleverapps.User.prototype.setGold=function(e,t){var s=e-this.gold;0<s&&cleverapps.history.add("gold",s),0!==s&&(this.gold=e,this.incProgressCompare(30,!0),this.save(),t||this.onChangeGold())},cleverapps.User.prototype.canTakeGold=function(e){return this.gold>=e},cleverapps.User.prototype.expAvailable=function(){return"undefined"!=typeof match3&&match3.heroes&&match3.heroes.available()||"merge"===cleverapps.config.type},cleverapps.User.prototype.canTakeExp=function(e){return this.exp>=e},cleverapps.User.prototype.takeGold=function(e){return 0===e||(cleverapps.history.add("spent"
,e),this.canTakeGold(e)?(cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.SPEND_GOLD,e),cleverapps.playSession.inc(cleverapps.EVENTS.SPEND_COINS,e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SPEND_COINS,{amount:e}),this.setGold(this.gold-e),!0):(this.onCantTakeGold(e-this.gold),!1))},cleverapps.User.prototype.takeExp=function(e){return 0===e||(this.canTakeExp(e)?(this.setExp(this.exp-e),!0):(this.onCantTakeExp(e-this.exp),!1))},cleverapps.User.prototype.getSaveInfo=function(){return{id:this.id,gold:this.gold,registered:this.registered,visited:this.visited,source:this.source,channel:this.channel,exp:this.exp,idfa1:this.idfa,abtest:this.abtest,progressCompare:this.progressCompare}},cleverapps.User.prototype.afterSync=function(){this.league=this.calcLeague()},cleverapps.User.prototype.save=function(e){!1===e&&this.afterSync(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo()),!1!==e&&(this.incProgressCompare(3,!0),
cleverapps.synchronizer.addUpdateTask("users"))},cleverapps.User.prototype.prepareSmallGoldReward=function(e){var t=cleverapps.paymentsHistory.getLastPayment();if(t&&t.time>Date.now()-cleverapps.parseInterval("3 day"))return e;var s=1;return 1e3<=this.gold?s=.2:500<=this.gold&&(s=.5),Math.ceil(e*s)},cleverapps.User.prototype.setRandomBoostersReward=function(e){if(!e.randomBoosters)return e;e.boosters={};for(var t=0;t<e.randomBoosters.amount;t++){var s=cleverapps.Random.choose(e.randomBoosters.types);e.boosters[s]=e.boosters[s]?e.boosters[s]+1:1}return delete e.randomBoosters,e},cleverapps.User.prototype.prepareRewardByRich=function(e,t){if(!e.gold&&!e.boosters&&!e.randomBoosters)return e;e=cleverapps.clone(e,!0),e=this.setRandomBoostersReward(e);var s=cleverapps.paymentsHistory.getLastPayment();if(s&&s.time>Date.now()-cleverapps.parseInterval("1 day"))return e;var i=!1;if(e.gold){var n=!0;s&&s.time>Date.now()-cleverapps.parseInterval("3 day")&&(n=!1);var o=1;1e3<=this.gold&&n?(o=.1,
i=!0):600<=this.gold?(i=!0,o=.25):300<=this.gold&&(o=.5),e.gold=Math.max(5*Math.ceil(e.gold*o/5),t||0)}if(i){var r=[];if("match3"===cleverapps.config.type&&(r=[{stars:3,exp:1},{stars:3},{stars:2,exp:1},{exp:2}]),!e.unlimitedLives&&cleverapps.lives&&(r=r.concat([{unlimitedLives:"10 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"30 minutes"}])),0<r.length){var a=cleverapps.Random.choose(r);for(var c in a)e[c]?e[c]+=a[c]:e[c]=a[c]}}return e},cleverapps.User.calcPriceCoef=function(){var e=cleverapps.User.calcSource();return"mobile_vk"===e||"web_vk"===e?.2625:"mobile_ok"===e||"web_ok"===e?.25:"web_mm"===e||"mobile_mm"===e?.25:"nk"===e?.125:"fotostrana"===e?.375:1},cleverapps.User.calcSource=function(){if(cleverapps.config.source)return cleverapps.config.source;if(cc.sys.isNative){if(cc.sys.os===cc.sys.OS_ANDROID)return"android";if(cc.sys.os===cc.sys.OS_IOS)return"ios"}var e=function(e){return-1!==window.location.href.indexOf(e)};return e("dr_auth_code")?"draugiem":e(
"logged_user_id")?e("mob=true")?"mobile_ok":"web_ok":e("api.vk.com")?e("vkmobile=true")?"mobile_vk":"web_vk":e("nk.pl")?"nk":e("fotostrana.ru")?"fotostrana":cleverapps.config.myMailRu&&e("app_id="+cleverapps.config.myMailRu.appId)?e("view=app_mobile")?"mobile_mm":"web_mm":e("source=spmobage")?"sp_mbga":e("mbga-platform.jp")?"mbga":e("xsolla.html")||e("xsolla-nocdn.html")?"xsolla":"facebook"},cleverapps.User.calcChannel=function(e,t){if(!cc.sys.isNative){if(void 0===e){if(e="channel",cleverapps.VK.isAppropriate())return cleverapps.User.calcChannel("hash")||cleverapps.User.calcChannel("referrer")||"";if(cleverapps.MyMailRu.isAppropriate()&&document.referrer){var s=document.createElement("a");return s.href=document.referrer,cleverapps.User.calcChannel("channel",location.search)||cleverapps.User.calcChannel("channel",s.search)||""}}var i=cleverapps.getRequestParameters(t||location.search);if(i.custom_args){var n=decodeURIComponent(i.custom_args);0<=n.indexOf(e)&&(
i=cleverapps.getRequestParameters("?"+n))}if(i[e])return i[e]}return""},cleverapps.User.prototype.setChannel=function(e){this.channel!==e&&(this.channel=e,this.save())},cleverapps.User.prototype.calcIdfa=function(){if(this.idfa)cc.sys.isNative&&console.log("idfa - "+this.idfa);else{var t=cleverapps.Adversting.getIdfa();t&&(this.idfa=t,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo()),cleverapps.RestClient.post("/users/idfa/"+levels.user.id,{idfa:this.idfa},function(e){e.campaign&&(this.setChannel(e.campaign),cleverapps.Adversting.postbackUnity(t))}.bind(this),function(){console.log("Failed updating idfa: "+this.idfa),delete this.idfa,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ID,this.getSaveInfo())}.bind(this)))}},cleverapps.User.prototype.initializeNewPlayerGold=function(){this.gold=100,"merge"===cleverapps.config.type&&(this.gold=15)},cleverapps.User.prototype.initializeNewPlayer=function(){this.initializeNewPlayerGold(),
this.id=this.generateTmpId(),this.registered=Date.now(),this.visited=Date.now(),this.source=cleverapps.User.calcSource(),this.channel=cleverapps.User.calcChannel(),this.exp=0,this.league=this.calcLeague(),this.progressCompare=0},cleverapps.User.prototype.calcLeague=function(){var e=0;if(!cleverapps.config.leagues)return e;for(;e<cleverapps.config.leagues.length&&cleverapps.config.leagues[e]&&this.getHumanReadableNumber()+(this.progress||0)>cleverapps.config.leagues[e];)e++;return e},cleverapps.User.prototype.setExp=function(e){if(this.exp!==e){var t=e-this.exp;this.exp=e,this.save(),cleverapps.values(this.onChangeExpListeners).forEach(function(e){e(t)})}},cleverapps.User.ON_SHOW_CHANGE_VISITED="1 hour",cleverapps.User.RETENTION_0_AVAILABLE={level:1},cleverapps.Scenes=function(){},cleverapps.Scenes.prototype.isLoaderScene=function(){var e=cc.director.getRunningScene();return e instanceof LoaderScene||!e},cleverapps.Scenes.prototype.runScene=function(e,t){cc.director.runScene(e),t()},
cleverapps.Scenes.prototype.replaceScene=function(t,e,s){cleverapps.metha.isFocused()||cleverapps.metha.debugMessage("Trying to replace scene without user focus! "+t.sceneName),e=e||function(){};var i=cc.director.getRunningScene();i&&(i.onReplace&&i.onReplace(),i.replacing=!0),cleverapps.Notification.remove(),t.isWide&&!this.sceneMaxWidthToRestore&&(this.sceneMaxWidthToRestore=cleverapps.styles.SCENE_MAX_WIDTH,cleverapps.setupDesignResolution({sceneMaxWidthOverride:5e3})),!t.isWide&&this.sceneMaxWidthToRestore&&(cleverapps.setupDesignResolution({sceneMaxWidthOverride:this.sceneMaxWidthToRestore}),this.sceneMaxWidthToRestore=void 0,i&&(i.scene.resizeScale=1,i.scene.width=i.width)),cleverapps.metha.compound(e,[function(e){cleverapps.FixedWidthScene.canDistractChangeSize=!1,t.isWide||cleverapps.flags.noTransitionAnimation?e():TransitionAnimation.createTransitionAnimation(e,cleverapps.metha.isFocused()&&0===cleverapps.metha.focus.indexOf("refreshSceneOnChangeSize"),s)},function(e){
t instanceof SceneProxy?t.whenLoaded(e):e()},function(e){t instanceof SceneProxy&&(t=t.instance),cleverapps.scenes.runScene(t,e)},function(e){t.isWide||cleverapps.flags.noTransitionAnimation?e():TransitionAnimation.removeTransitionAnimation(t,function(){e(),"undefined"!=typeof ToolMenu&&(t.toolMenu=new ToolMenu,t.toolMenu.setLocalZOrder(1),t.addChild(t.toolMenu))})},function(e){delete cleverapps.newSceneStack,cleverapps.FixedWidthScene.canDistractChangeSize=!0;var t=cleverapps.FixedWidthScene.changedOrientation;if(cleverapps.FixedWidthScene.changedOrientation||cleverapps.FixedWidthScene.changedSize){delete cleverapps.FixedWidthScene.changedOrientation,delete cleverapps.FixedWidthScene.changedSize;var s=cc.director.getRunningScene();s&&s.onChangeSize&&s.onChangeSize(t)}e()}])},cleverapps.Scenes.prototype.reset=function(){TransitionAnimation.reset()};var TransitionAnimation=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.setLocalZOrder(100),
this.animation=new cleverapps.Spine(e.styling.json),this.addChild(this.animation),e.styling.skin&&this.animation.setSkin(e.styling.skin)},animate:function(e,t,s,i){t=cleverapps.once(t||function(){}),this.animation.setCompleteListener(function(){this.runAction(new cc.Sequence(new cc.CallFunc(t),new cc.CallFunc(function(){s||this.runAction(new cc.RemoveSelf)}.bind(this))))}.bind(this));var n=function(){i?this.animation.setTimeScale(1e3):(this.animation.setTimeScale(1),cleverapps.config.debugMode&&cleverapps.keyboardController.isPressed(cc.KEY.d)&&this.animation.setTimeScale(.1)),this.animation.setAnimation(0,e,!1),this.background&&("open"===e?this.background.runAction(new cc.FadeOut(1)):(this.background.setOpacity(0),this.background.runAction(new cc.FadeIn(1)))),"open"===e?cleverapps.audio.playSound(bundles.main.urls.transition_open_effect):cleverapps.audio.playSound(bundles.main.urls.transition_close_effect)}.bind(this),o=cleverapps.styles.TransitionAnimation
;"open"===e?this.animation.runAction(new cc.Sequence(new cc.DelayTime(o.beforeOpen.delay),new cc.CallFunc(n),new cc.DelayTime(o.open.delay),new cc.CallFunc(t))):n()}});TransitionAnimation.animate=function(e,t){(t=t||{}).parent||(t.parent=cc.director.getRunningScene());var s=t.spine?t.spine:new TransitionAnimation({styling:t.styling});return s.setPositionRound(t.parent.width/2,t.parent.height/2),s.removeFromParent(),t.parent.addChild(s,1e3),s.animate(e,t.callback,t.notRemove,t.silent),s},TransitionAnimation.hideLoading=function(){var e=TransitionAnimation.closeCurtains;if(e&&e.loading){var t=.3*(1-e.loading.scale);e.loading.runAction(new cc.Sequence(new cc.ScaleTo(t,1),new cc.DelayTime(Math.max(cleverapps.styles.TransitionAnimation.loading.hideDelay-t,0)),new cc.ScaleTo(.3,.1),new cc.RemoveSelf)),delete e.loading}},TransitionAnimation.clearCloseCurtains=function(){TransitionAnimation.closeCurtains&&(TransitionAnimation.hideLoading(),delete TransitionAnimation.closeCurtains)},
TransitionAnimation.removeCloseCurtains=function(){TransitionAnimation.closeCurtains&&(TransitionAnimation.closeCurtains.removeFromParent(),delete TransitionAnimation.closeCurtains)},TransitionAnimation.reset=function(){this.removeCloseCurtains()},TransitionAnimation.closeCurtainsAnimation=function(e,t,s){var i=TransitionAnimation.animate("close",{styling:s,notRemove:!0,silent:t,callback:function(){cc.eventManager.removeListeners(i),e()}});return i},TransitionAnimation.chooseStyling=function(){var e,t=bundles.transition.jsons.transition_json,s=cleverapps.Spine.getSkins(t);return 0<s.length&&(e=s[levels.user.getVirtualLevel()%s.length]),{json:t,skin:e}},TransitionAnimation.createTransitionAnimation=function(i,n,o){var e=function(){var e=cc.director.getRunningScene();if(e){(o=o||{}).level=o.level||e.level;var t=TransitionAnimation.chooseStyling(),s=TransitionAnimation.closeCurtainsAnimation(i,n,t);e.onTransitionAnimationDidStart(),TransitionAnimation.removeCloseCurtains(),
TransitionAnimation.closeCurtains=s,TransitionAnimation.swallowTouches(s),TransitionAnimation.createLoadingAnimation(s,e)}else i()}.bind(this);cleverapps.bundleLoader.loadBundle("transition",{onSuccess:e})},TransitionAnimation.createLoadingAnimation=function(e,t){var s=bundles.main.jsons.wait_transition_json,i=cleverapps.styles.TransitionAnimation.loading;if(i&&cleverapps.bundleLoader.isLoaded(cleverapps.Spine.listBundles(s))&&!(t instanceof LoaderScene)){var n=e.loading=new cc.Node;if(n.setAnchorPoint2(),bundles.main.jsons.wait_transition_json){var o=new cleverapps.Spine(s);n.addChild(o),o.setAnimation(0,"idle",!0)}var r=cleverapps.UI.generateOnlyText(Messages.get("Loading")||"Loading",cleverapps.styles.FONTS.TRANSITION_LOADING_TEXT);n.addChild(r),r.setPositionRound(i.textPos),cleverapps.UI.wrap(n),e.runAction(new cc.Sequence(new cc.DelayTime(i.delay),new cc.CallFunc(function(){e.addChild(n),n.setPositionRound(i),n.setScale(0),n.runAction(new cc.ScaleTo(.3,1))})))}},
TransitionAnimation.removeTransitionAnimation=function(e,t){var s=TransitionAnimation.animate("open",{callback:function(){cc.eventManager.removeListeners(s),t()},parent:e,spine:TransitionAnimation.closeCurtains});TransitionAnimation.clearCloseCurtains(),TransitionAnimation.swallowTouches(s)},TransitionAnimation.swallowTouches=function(e){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0},onTouchEnded:function(){return!0}},e),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0},onMouseScroll:function(e){return e&&e.stopPropagation&&e.stopPropagation(),!0}},e)},cleverapps.overrideFonts(cleverapps.styles.FONTS,{TRANSITION_LOADING_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.TransitionAnimation={loading:{delay:.5,hideDelay:.3,x:{align:"center"},y:{
align:"center",dy:-400},textPos:{x:{align:"center"},y:{align:"center",dy:60}}},open:{delay:.5},beforeOpen:{delay:.2}},cleverapps.RestClient={getBase:function(){return cc.sys.isNative||cleverapps.isInstant()||-1!==["mbga","nk","android","plinga","huzcom","pliega"].indexOf(cleverapps.User.calcSource())?cleverapps.config.deployment:""},sendRaw:function(e,t,s){var i=cc.sys.isNative?cc.loader.getXMLHttpRequest():new XMLHttpRequest,n=cleverapps.RestClient.getBase()+t;i.open(e,n),i.timeout=1e4,i.send(s)},createQueryString:function(e){var t=[];for(var s in e)t.push(s+"="+("string"==typeof e[s]?e[s]:JSON.stringify(e[s])));return t.join("&")},get:function(e,t,s,i,n){this.send(cleverapps.RestClient.METHODS.GET,e,t,s,i,n)},post:function(e,t,s,i,n){this.send(cleverapps.RestClient.METHODS.POST,e,t,s,i,n)},send:function(e,t,s,i,n,o){if(!cleverapps.flags.norest){o=o||{},timeout=o.timeout||1e4;var r=cc.sys.isNative?cc.loader.getXMLHttpRequest():new XMLHttpRequest,a=setTimeout(function(){c.call({
status:-1,statusText:"our timeout"})},timeout+1e3),c=function(){if(void 0!==a&&(clearTimeout(a),a=void 0),200<=this.status&&this.status<300){if(i){var e;try{e=this.responseText&&JSON.parse(this.responseText)}catch(e){throw"parse json error: path - "+t+", message - "+e.message}i(e)}}else console.log("XMLHttpRequest FAILED"),this.status&&console.log(this.status),this.statusText&&console.log(this.statusText),this.responseText&&(this.errorMessage=(this.responseText.split("\n")[0]||"").trim(),this.errorMessage&&console.log(this.errorMessage)),n&&n(this);i=function(){},n=function(){}}.bind(r);r.ontimeout=c,r.onload=c,r.onerror=c,r.onabort=c;var l=t;"http"!==l.substr(0,4)&&(l=cleverapps.RestClient.getBase()+cleverapps.config.restApiURL+t),r.open(e,l),r.timeout=timeout,r.setRequestHeader("Content-Type","application/json"),o.authorization?r.setRequestHeader("authorization",o.authorization):r.setRequestHeader("Cache-Control","no-cache"),r.send(JSON.stringify(s))}},METHODS:{GET:"GET",POST:"POST"}
},cleverapps.Tutorial=function(){this.tutorialSteps=new cleverapps.TutorialSteps,this.steps=this.tutorialSteps.list(this.nextStep.bind(this)),this.onStartedListener=function(){},this.onFinishedListener=function(){}},cleverapps.Tutorial.prototype.setGame=function(e){this.game=e,this.tutorialSteps.setGame(this.game)},cleverapps.Tutorial.prototype.stop=function(){this.running=!1,this.step=this.steps.length},cleverapps.Tutorial.prototype.start=function(){this.running=!0,this.setStep(0),this.onStartedListener()},cleverapps.Tutorial.prototype.remindStep=function(){this.isRunning()&&this.steps[this.step].call(this,this.game)},cleverapps.Tutorial.prototype.setStep=function(e){this.step=e,this.step>=this.steps.length&&(this.running=!1);var t={step:e};if(this.isRunning()){var s="tutorial_step_"+(e+1);cleverapps.eventLogger.logEvent(s,t),0===e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_BEGIN)}else this.onFinishedListener(),cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.TUTORIAL_COMPLETED,t),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_COMPLETE);this.remindStep()},cleverapps.Tutorial.prototype.nextStep=function(){this.isRunning()&&this.setStep(this.step+1)},cleverapps.Tutorial.prototype.isRunning=function(){return this.running},cleverapps.EventsLogger=function(){this.pool={names:[],data:[]}},cleverapps.EventsLogger.prototype.logEvent=function(e,t){if(!cleverapps.flags||!cleverapps.flags.noLogEvents){40<e.length&&console.log("WARN: Invalid event name: "+e+"!. It must be between 1 and 40 characters, and must be contain only alphanumerics, , - or spaces, starting with alphanumeric or _.");var s=this.getBaseParameters();if(void 0!==t&&(s=cleverapps.extend(s,t)),cleverapps.firebase){var i=cleverapps.EventsLogger.FIREBASE_RENAMES[e]||e;-1!==["earn_virtual_currency","spend_virtual_currency"].indexOf(i)&&(s.virtual_currency_name="coins",s.value=s.amount||1),cleverapps.firebase.logEvent(i,s)}
cleverapps.adjust&&cleverapps.adjust.logEvent(e);var n=cleverapps.EventsLogger.FACEBOOK_RENAMES[e]||e;cleverapps.social&&cleverapps.social.logEvent?cleverapps.social.logEvent(n,s):cleverapps.facebookEventsLogger.logEvent(n,s),-1===cleverapps.EventsLogger.IGNORED_EVENTS.indexOf(e)&&this.addEvent(e,t)}},cleverapps.EventsLogger.prototype.addEvent=function(e,t){void 0===t&&(t={}),e===cleverapps.EVENTS.PRODUCT_BOUGHT_LANGUAGE?e=cleverapps.EVENTS.PRODUCT_BOUGHT+"_"+cleverapps.settings.language:e===cleverapps.EVENTS.DAU_LANGUAGE?e=cleverapps.EVENTS.DAU+"_"+cleverapps.settings.language:e===cleverapps.EVENTS.BOOSTERS_BOUGHT_ITEM?e=cleverapps.EVENTS.BOOSTERS_BOUGHT+"_"+t.id:e===cleverapps.EVENTS.STAR_CHEST_OPEN_ITEM?e=cleverapps.EVENTS.STAR_CHEST_OPEN+"_"+t.id:e===cleverapps.EVENTS.SHARE_ITEM&&(e=cleverapps.EVENTS.SHARE+"_"+t.id),this.pool.names.push(e),this.pool.data.push(t);var s=this.getBaseParameters();setTimeout(this.sendEvents.bind(this,s),0)},
cleverapps.EventsLogger.prototype.sendEvents=function(e){if(0<this.pool.names.length){var t=this.pool.names.join(",");console.log("Sending events - "+t),(e=cleverapps.extend(e,this.getBaseParameters())).events=t,e.params=this.pool.data,cleverapps.RestClient.post("/events/",e,function(){},function(){console.log("Failure event - "+t)}),this.pool.names=[],this.pool.data=[]}},cleverapps.EventsLogger.prototype.getBaseParameters=function(){var e={};cleverapps.user&&cleverapps.user.id&&(e.id=cleverapps.user.id),cleverapps.environment&&(cleverapps.environment.getScreen()&&(e.screen=cleverapps.environment.getScreen()),void 0!==cleverapps.environment.levelNo&&(e.level=cleverapps.environment.levelNo),void 0!==cleverapps.environment.episodeNo&&(e.episode=cleverapps.environment.episodeNo));var t=Game.currentGame&&Game.currentGame.level;return t&&(t.content&&(e.version=t.content.version),t.hash&&(e.hash=t.hash)),cleverapps.settings&&cleverapps.settings.language&&(
e.language=cleverapps.settings.language),e.source=cleverapps.User.calcSource(),levels.episodes&&(e.amountEpisodes=levels.episodes.getAmountEpisodes()),e},cleverapps.EventsLogger.FIREBASE_RENAMES={},cleverapps.EventsLogger.FIREBASE_RENAMES[cleverapps.EVENTS.REWARD_RECEIVED]="earn_virtual_currency",cleverapps.EventsLogger.FIREBASE_RENAMES[cleverapps.EVENTS.SPEND_COINS]="spend_virtual_currency",cleverapps.EventsLogger.FACEBOOK_RENAMES={},cleverapps.EventsLogger.FACEBOOK_RENAMES[cleverapps.EVENTS.SPEND_COINS]=cleverapps.EVENTS.FB_SPEND_COINS,cleverapps.EventsLogger.IGNORED_EVENTS=[cleverapps.EVENTS.ACHIEVED_LEVEL,cleverapps.EVENTS.LEVEL_UP],cleverapps.FacebookEventsLogger=function(){this.batch=[];var e=cleverapps.User.calcSource();(-1===["android","ios"].indexOf(e)||cleverapps.flags.nofacebookevents)&&cleverapps.override(this,cleverapps.FakeFacebookEventsLogger)},cleverapps.FacebookEventsLogger.prototype.logEvent=function(e,t){var s={name:e};t&&(s.params=t),this.batch.push(s),
this.logEventsBatch()},cleverapps.FacebookEventsLogger.prototype.logEventsBatch=cleverapps.accumulate(1e3,function(){cc.sys.os===cc.sys.OS_ANDROID?FacebookPlugin.logEventsBatch(JSON.stringify(this.batch)):cc.sys.os===cc.sys.OS_IOS&&(console.log("FacebookEventsLogger logEventsBatch"),webkitMessage("facebook",{action:"logEventsBatch",events:this.batch})),this.batch=[]}),cleverapps.FakeFacebookEventsLogger={logEvent:function(){},logEventsBatch:function(){}};var History=function(){this.enabled=!0,this.data={},this.dirty={},this.sent={},this.load(),this.hasDirty()&&this.schedulePush()};if(History.prototype.hasDirty=function(){return 0<Object.keys(this.dirty).length},History.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.HISTORY);e?(this.data=e.data,this.dirty=e.dirty,cleverapps.extend(this.dirty,e.sent),this.sent={}):cleverapps.user.registered<Date.now()-6e5&&(this.enabled=!1)},History.prototype.save=function(){cleverapps.DataLoader.save(
cleverapps.DataLoaderTypes.HISTORY,{data:this.data,dirty:this.dirty,sent:this.sent})},History.prototype.add=function(e,t){var s=cleverapps.user.getDaysSinceRegistration();if(s>History.DAYS&&(this.enabled=!1),this.enabled){var i=this.data[s+"_"+e];this.set(e,(i||0)+t)}},History.prototype.set=function(e,t){var s=cleverapps.user.getDaysSinceRegistration();if(s>History.DAYS&&(this.enabled=!1),this.enabled){var i=s+"_"+e;this.data[i]=t,this.dirty[i]=!0,this.save(),this.schedulePush()}},History.prototype.schedulePush=function(){if(!this.pushScheduled){this.pushScheduled=!0;var e=cleverapps.parseInterval(History.PUSH_INTERVAL)-Date.now()+(this.lastPushTime?this.lastPushTime:0);e<=0&&(e=0),setTimeout(this.push.bind(this),e)}},History.prototype.push=function(){this.lastPushTime=Date.now();var e={};for(var t in this.dirty)e[t]=this.data[t];this.sent=cleverapps.clone(this.dirty),this.dirty={},this.save(),cleverapps.RestClient.post("/history/"+cleverapps.user.id,e,function(){console.log(
"Success pushing history: "+JSON.stringify(Object.keys(this.sent))),this.pushScheduled=!1,this.sent={},this.save(),this.hasDirty()&&this.schedulePush()}.bind(this),function(){console.log("Failure pushing history: "+JSON.stringify(this.sent)),this.pushScheduled=!1,cleverapps.extend(this.dirty,this.sent),this.sent={},this.save(),this.schedulePush()}.bind(this))},History.PUSH_INTERVAL="30 seconds",History.DAYS=14,"undefined"!=typeof module&&void 0===cleverapps)cleverapps={config:{},isLocalhost:function(){}};cleverapps.Random={state:0,m:2147483648,a:1103515245,c:12345,seed:function(e){if("number"!=typeof e)if("string"==typeof e)cleverapps.Random.state=cleverapps.Random.strToInt(e);else{var t="Expecting string as seed";if(cleverapps.config.debugMode&&cleverapps.isLocalhost())throw Error(t);console.log(t)}else cleverapps.Random.state=Math.abs(parseInt(e)||0)%cleverapps.Random.m},randomSeed:function(){cleverapps.Random.state=Math.floor(Math.random()*cleverapps.Random.m);for(
var e=cleverapps.Random.state,t=[],s=0;s<100;s++){if(x=this.nextInt(),0<=t.indexOf(x))return void this.randomSeed();t.push(x)}cleverapps.Random.state=e},shuffle:function(e){for(var t=[],s=[],i=0;i<e.length;i++)s.push(i);for(i=0;i<e.length;i++){var n=cleverapps.Random.random(s.length);t.push(e[s[n]]),s.splice(n,1)}return t},strToInt:function(e){for(var t=0,s=0;s<e.length;s++)t=(1e3*t+e.charCodeAt(s))%cleverapps.Random.m;return t},nextInt:function(){return cleverapps.Random.state=(cleverapps.Random.a*cleverapps.Random.state+cleverapps.Random.c)%cleverapps.Random.m},nextDouble:function(){return cleverapps.Random.nextInt()/cleverapps.Random.m},mathChoose:function(e){if(0!==e.length)return e[Math.floor(Math.random()*e.length)]},choose:function(e,t){if(0!==e.length)return e[cleverapps.Random.random(0,e.length-1,t)]},random:function(e,t,s){var i;void 0!==s&&(i=cleverapps.Random.state,cleverapps.Random.seed(!1!==s?s:Math.floor(1e6*Math.random()))),void 0===t&&(t=e-1,e=0);var n=t-e+1,
o=cleverapps.Random.nextInt()/cleverapps.Random.m,r=e+Math.floor(o*n);return void 0!==i&&cleverapps.Random.seed(i),r}},cleverapps.Random.randomSeed(),"undefined"!=typeof module&&(module.exports=cleverapps.Random),cleverapps.Audio=function(){this.cache={},WebViewAudioEngine.IsApplicable()&&(cc.sys.isWebViewAudio=!0,cc.audioEngine=new WebViewAudioEngine),this.disk=void 0,this.muted=!1,this.volume=1,this.currentFade=void 0,cleverapps.eventBus.on("gamePause",this.onChangeMusic.bind(this)),cleverapps.eventBus.on("gameResume",this.onChangeMusic.bind(this)),cc.sys.isNative||"undefined"==typeof window||window.addEventListener("focus",function(e){cc.Audio._context&&cc.Audio._context.resume&&cc.Audio._context.resume()})},cleverapps.Audio.prototype.insertDisk=function(e){this.stopFadeOut(),this.disk=processVirtualUrl(e),this.onChangeMusic()},cleverapps.Audio.prototype.eject=function(){this.stopFadeOut(),this.disk=void 0,this.onChangeMusic()},cleverapps.Audio.prototype.mute=function(){
this.muted||(this.muted=!0,this.onChangeMusic())},cleverapps.Audio.prototype.unmute=function(){this.muted&&(this.muted=!1,this.onChangeMusic())},cleverapps.Audio.prototype.onChangeMusic=function(){this.disk&&!this.muted&&cleverapps.settings.music&&!cc.game.isPaused()?(this.logSound(this.disk),this.volume!==this.realVolume&&this.setVolume(this.volume),cc.sys.isWebViewAudio||cc.loader.getRes(this.disk)?cc.audioEngine.playMusic(this.disk,!0):cc.loader.load(this.disk,this.onChangeMusic.bind(this))):cc.audioEngine.stopMusic()},cleverapps.Audio.prototype.stopFadeOut=function(){this.setVolume(1),this.currentFade&&(clearInterval(this.currentFade),delete this.currentFade)},cleverapps.Audio.prototype.setVolume=function(e){this.volume=e,cc.audioEngine.canChangeMusicVolume()&&!this.muted&&cleverapps.settings.music&&!cc.game.isPaused()&&(this.realVolume=e,cc.audioEngine.setMusicVolume(e))},cleverapps.Audio.prototype.fadeOut=function(e){if(this.stopFadeOut(),this.disk){var t=(e||400)/20,s=1/t
;this.currentFade=setInterval(function(){0===t?this.eject():(t--,this.setVolume(Math.max(0,this.volume-s)))}.bind(this),20)}},cleverapps.Audio.prototype.playSound=function(e,t){if(cleverapps.settings.sound&&!cc.game.isPaused()&&!this.muted){if(e=processVirtualUrl(e,{useUnusedBundles:!0})){t=t||{},this.logSound(e,t);var s=this.cache[e],i=void 0!==t.throttle?t.throttle:cleverapps.Audio.THROTTLE_AUDIO;if(s){if(!cc.sys.isNative&&s.getPlaying()&&s.startPlaying+i>Date.now())return;cc.sys.isNative&&cc.audioEngine.stopEffect(s)}var n=(cc.audioEngine._audioPool[e]||[]).filter(function(e){return!e.getPlaying()})[0];return n&&cc.audioEngine.stopEffect(n),(s=cc.audioEngine.playEffect(e,t.loop))&&(s.startPlaying=Date.now(),this.cache[e]=s),s}cleverapps.config.debugMode}},cleverapps.Audio.prototype.stopSound=function(e){cc.audioEngine.stopEffect(e)},cleverapps.Audio.THROTTLE_AUDIO=250,cleverapps.Audio.prototype.logSound=function(e,t){
cleverapps.config.debugMode&&cleverapps.keyboardController.isPressed(cc.KEY.s)&&(console.log("--------------------- sound logging ----------------------"),console.log("sound file",e),t&&console.log("sound options",t),console.log("----------------------------------------------------------"))},cc.audioEngine.canChangeMusicVolume=function(){return cc.audioEngine._currMusic&&cc.audioEngine._currMusic.setVolume};var WebViewAudioEngine=function(){this._musicVolume=1,this._audioPool={},this.batch={},this.sendBatch=cleverapps.accumulate(0,this.sendBatch.bind(this))};WebViewAudioEngine.prototype._pausePlaying=function(){},WebViewAudioEngine.prototype._resumePlaying=function(){},WebViewAudioEngine.prototype.setMusicVolume=function(e){e-=0,isNaN(e)&&(e=1),1<e&&(e=1),e<0&&(e=0),this._musicVolume=e,this.batch.setMusicVolume={action:"setMusicVolume",volume:e},this.sendBatch()},WebViewAudioEngine.prototype.sendBatch=function(){var e=cleverapps.values(this.batch);cc.sys.os===cc.sys.OS_ANDROID&&(
e=JSON.stringify(e)),AudioPlugin.sendBatch(e),this.batch={}},WebViewAudioEngine.prototype.getMusicVolume=function(){return this._musicVolume},WebViewAudioEngine.prototype.playMusic=function(e,t){e&&(this.batch.musicAction={action:"playMusic",url:e,loop:Boolean(t)},this.sendBatch())},WebViewAudioEngine.prototype.stopMusic=function(){this.batch.musicAction={action:"stopMusic"},this.sendBatch()},WebViewAudioEngine.prototype.stopEffect=function(e){e&&e.url&&(this.batch["effect_"+e.url]={action:"stopEffect",url:e.url},this.sendBatch())},WebViewAudioEngine.prototype.stopAllEffects=function(){},WebViewAudioEngine.prototype.playEffect=function(e,t){if(e)return this.batch["effect_"+e]={action:"playEffect",url:e,loop:Boolean(t)},this.sendBatch(),new WebViewAudio(e,t)},WebViewAudioEngine.prototype.canChangeMusicVolume=function(){return!0},WebViewAudioEngine.IsApplicable=function(){return cc.sys.isWebView&&"undefined"!=typeof AudioPlugin};var WebViewAudio=function(e,t){this.url=e,this.loop=t,
this.startPlaying=Date.now()};WebViewAudio.prototype.getPlaying=function(){return Date.now()<this.startPlaying+cleverapps.parseInterval(WebViewAudio.FAKE_DURATION)},WebViewAudio.FAKE_DURATION="1 second",cleverapps.ABTest=function(){this.group=void 0,this.setGroup(cleverapps.user.abtest)},cleverapps.ABTest.prototype.isRunning=function(e){return cleverapps.ABTest.ACTIVE_TEST&&cleverapps.ABTest.ACTIVE_TEST.name===e},cleverapps.ABTest.prototype.setGroup=function(e){this.group=void 0,cleverapps.ABTest.ACTIVE_TEST&&(-1===cleverapps.ABTest.ACTIVE_TEST.groups.indexOf(e)?cleverapps.ABTest.wantAssignGroup()&&(this.group=cleverapps.Random.mathChoose(cleverapps.ABTest.ACTIVE_TEST.groups)):this.group=e),cleverapps.user.abtest!==this.group&&(cleverapps.user.abtest=this.group,this.afterGroupChosen&&this.afterGroupChosen(),cleverapps.user.save())},cleverapps.ABTest.prototype.purchaseEvent=function(e){void 0!==this.group&&cleverapps.eventLogger.logEvent("abtest_"+this.group,{amount:e})}
;var Alarm=function(){this.on=!1,this.alarms={},this.priority=0,this.onChangeListeners={}};Alarm.prototype.isOn=function(){return 0<this.priority},Alarm.prototype.start=function(e,t){this.alarms[e]=t||1,this.onChange()},Alarm.prototype.stop=function(e){delete this.alarms[e],this.onChange()},Alarm.prototype.clear=function(){this.alarms={},this.onChange()},Alarm.prototype.onChange=function(){var e=0;for(var t in this.alarms)this.alarms[t]>e&&(e=this.alarms[t]);if(e!==this.priority)for(var t in this.priority=e,this.onChangeListeners)this.onChangeListeners[t](e)};var Mission=function(e,t,s){this.started=void 0,this.type=e,this.state=Mission.STATE_RUNNING,this.details={},this.result=0,this.onChangeResults=function(){},cleverapps.extend(this,Missions[this.type]),this.isMinigameMission()&&(this.currency=this.getStartCurrency()),this.type===Mission.TYPE_LANTERN&&(this.result=1);var i=!t;if(i){if(this.started=Date.now(),this.needShowStartWindow=!0,this.oncePerEvent){
var n=cleverapps.eventManager.getFeatureEvent(this.feature);this.eventFinishTime=n?n.finish.getTime():Date.now()}}else this.load(t);if(this.competition){(i||s)&&Competition.CLEAN_SAVED(this.type);var o=Competition.optionsByMission(this);this.runningCompetition=new Competition(o),this.runningCompetition.onChangeResultsListeners.mission=this.resultsChanged.bind(this),cleverapps.friends.playerInfoChangedListeners.mission=this.userInfoChanged.bind(this),this.runningCompetition.start()}this.logic&&(this.logic=new this.logic(this,i)),this.onUpdateState()};Mission.STATE_RUNNING=0,Mission.STATE_COMPLETED=1,Mission.STATE_SHOWN_FINISHVIEW=2,Mission.prototype.onUpdateState=function(){this.countdown&&(this.countdown.remove(),delete this.countdown),this.isRunning()?this.countdown=new cleverapps.CountDown(this.getTimeLeft(),{onFinish:this.onUpdateState.bind(this),permanent:!0}):(this.complete(),this.runningCompetition&&this.runningCompetition.stop(),this.logic&&this.logic.stop&&this.logic.stop())
;var e=cleverapps.sideBar.findMissionIcon(this.type);e&&e.resetState()},Mission.prototype.userInfoChanged=function(e){this.runningCompetition.onUserInfoChanged(e),cleverapps.missionManager.table.resetResults(this.type),this.resultsChanged()},Mission.prototype.resultsChanged=function(){this.onChangeResults(),this.logic&&this.logic.onChangeResults&&this.logic.onChangeResults()},Mission.prototype.beforeRemove=function(){this.countdown&&(this.countdown.remove(),delete this.countdown),this.runningCompetition&&this.runningCompetition.stop()},Mission.prototype.load=function(e){this.started=e.started,this.result=e.result,this.details=e.details,this.currency=e.currency,this.eventFinishTime=e.eventFinishTime},Mission.prototype.update=function(e,t){if(this.isRunning()&&(this.result+=e,t&&(this.details=t)),this.runningCompetition&&0!==e&&this.runningCompetition.updatePlayerResult(cleverapps.user.id,this.result),this.onUpdateState(),this.onChangeResults(),cleverapps.missionManager.save(),
this.logic&&this.logic.onUpdate)return this.logic.onUpdate(this)},Mission.prototype.canRemoveSilently=function(){return this.logic?!!this.logic.canRemoveSilently&&this.logic.canRemoveSilently():0===this.result||"?"===this.getSummary().place},Mission.prototype.canRemove=function(){return!this.logic||!this.logic.canRemove||this.logic.canRemove()},Mission.prototype.hasLastChance=function(){return!!this.lastChanceView&&(!(!this.logic||!this.logic.hasLastChance)&&this.logic.hasLastChance())},Mission.prototype.receiveReward=function(){var e=this.getPrize(),t="_lost";return e&&(t="_prize"),0===this.place&&this.runningCompetition&&(t="_first"),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MISSION_FINISH+t),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MISSION_FINISH+"_"+this.type+t),e&&cleverapps.history.add("mwin",1),cleverapps.history.add("misn"+this.type,this.result),e},Mission.prototype.skipNext=function(){return this.logic&&this.logic.skipNext&&this.logic.skipNext()},
Mission.prototype.useMissionIntent=function(e){var t=this.getViewClass();cleverapps.scenes.replaceScene(new t(this),e)},Mission.prototype.updateCurrency=function(e,t){0!==e&&void 0!==this.currency&&(this.currency+=e,t&&(this.details=t),this.onUpdateState(),cleverapps.missionManager.save())},Mission.prototype.getSummary=function(){return this.runningCompetition?{place:this.runningCompetition.calcPlace(),points:this.runningCompetition.player.amount}:{place:"?",points:this.result}},Mission.prototype.getResults=function(){if(!this.runningCompetition)return[];var e=this.runningCompetition.getResults().map(function(e,t){return{id:e.id,player:e.player,text:e.name,avatar:{id:e.id,avatar:e.avatar},amount:e.amount}});return e.sort(function(e,t){return t.amount-e.amount}),e.forEach(function(e,t){e.place=t+1}),e},Mission.prototype.save=function(){return{started:this.started,type:this.type,result:this.result,currency:this.currency,eventFinishTime:this.eventFinishTime,details:this.details}},
Mission.prototype.getName=function(){return this.name},Mission.prototype.getWindowBundleName=function(){return this.bundle},Mission.prototype.isMinigameMission=function(){return void 0!==this.minigame},Mission.prototype.isBattlePassMission=function(){return void 0!==this.battlePass},Mission.prototype.isSlotMachineMission=function(){return void 0!==this.slotMachine},Mission.prototype.getViewClass=function(){return this.view},Mission.prototype.complete=function(){this.state===Mission.STATE_RUNNING&&(this.state=Mission.STATE_COMPLETED)},Mission.prototype.getIcon=function(){return cleverapps.skins.getSlot("missionIcon",{type:this.type})},Mission.prototype.finishTime=function(){if(this.feature){if(this.oncePerEvent)return this.eventFinishTime;var e=cleverapps.eventManager.getFeatureEvent(this.feature);return e?e.finish.getTime():Date.now()}return this.started+cleverapps.parseInterval(this.duration)},Mission.prototype.getTimeLeft=function(){return Math.max(0,this.finishTime()-Date.now())},
Mission.prototype.isRunning=function(){return this.state===Mission.STATE_RUNNING&&this.finishTime()>Date.now()},Mission.prototype.isCompleted=function(){return this.state===Mission.STATE_COMPLETED},Mission.prototype.canPlayMinigame=function(){return this.isMinigameMission()&&this.currency&&this.currency>=this.getMinigamePrice()},Mission.prototype.getMinigamePrice=function(){return this.minigame.price},Mission.prototype.isMinigameReadyToFinish=function(){return this.isMinigameMission()&&this.logic&&this.logic.isMinigameReadyToFinish&&this.logic.isMinigameReadyToFinish()},Mission.prototype.getStartCurrency=function(){return void 0!==this.startCurrency?this.startCurrency:this.getMinigamePrice()},Mission.prototype.getMinigameClass=function(){return this.minigame.className},Mission.prototype.getLevelReward=function(){return-1!==[Mission.TYPE_TREASURE_SEARCH,Mission.TYPE_SLOT_MACHINE].indexOf(this.type)?[1,3,2]:-1!==[Mission.TYPE_BATTLEPASS].indexOf(this.type)?[3,6]:[1,1]},
Mission.prototype.getPrize=function(){if(this.prize)return this.minigame?this.prize.prepareByRich?cleverapps.user.prepareRewardByRich(this.prize):this.prize:(this.place=this.getSummary().place,this.place<this.prize.length?RewardsConfig.Tournament.prepareByRich?cleverapps.user.prepareRewardByRich(this.prize[this.place]):this.prize[this.place]:void 0)},Mission.prototype.updateCompetitionResults=function(){this.runningCompetition&&this.runningCompetition.updatePlayerResult(cleverapps.user.id,this.result)},Mission.cooldownInterval=function(e){return Missions[e].cooldown};var MissionManager=function(){this.missions=[],this.lastRemoved={},this.table=new cleverapps.Table,this.load(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.MISSIONS)),this.semaphoresOnHold=0};MissionManager.isObsoleteMissionType=function(e){return-1===[Mission.TYPE_COMBO,Mission.TYPE_COLLECT_MARK,Mission.TYPE_BURN_NEARBY,Mission.TYPE_LETTER,Mission.TYPE_TREASURE_SEARCH,Mission.TYPE_LANTERN,Mission.TYPE_WARDROBE,
Mission.TYPE_FAVORITE_SALE,Mission.TYPE_LIVES_SALE,Mission.TYPE_BOOSTERS_SALE,Mission.TYPE_COINS_SALE,Mission.TYPE_BATTLEPASS,Mission.TYPE_STICKERS_COLLECTION,Mission.TYPE_BONUS_WORLD,Mission.TYPE_ENERGY_FEAST,Mission.TYPE_SLOT_MACHINE,Mission.TYPE_COINS_FEAST,Mission.TYPE_COINS_TIME,Mission.TYPE_ENERGY_TIME].indexOf(e)},MissionManager.prototype.load=function(e,t){if(e){this.missions=[],this.lastRemoved=e.lastRemoved||{};for(var s=this.listAvailableTypes(),i=(Array.isArray(e)?e:e.missions)||[],n=0;n<i.length;n++){var o=i[n];-1===s.indexOf(o.type)||MissionManager.isObsoleteMissionType(o.type)||(void 0===o.lastRemoved?this.add(o.type,o,t):this.lastRemoved[o.type]=o.lastRemoved)}}},MissionManager.prototype.getPlayableMissions=function(){return this.missions.filter(function(e){return e.isRunning()&&e.canPlayMinigame()})},MissionManager.prototype.getRunningMission=function(e){for(var t=0;t<this.missions.length;t++)if(this.missions[t].isRunning()&&this.missions[t].semaphore&e
)return this.missions[t]},MissionManager.prototype.skipNext=function(){return 0<this.missions.filter(function(e){return e.skipNext()}).length},MissionManager.prototype.getMissionWithIntent=function(){for(var e in this.missions){var t=this.missions[e];if(t.logic&&t.logic.hasIntent&&t.logic.hasIntent())return t}},MissionManager.prototype.dispatchEvent=function(e,t){var s=!1;for(var i in this.missions){var n=this.missions[i];n.logic&&n.logic.processEvent&&n.logic.processEvent(e,t||{})&&(s=!0)}return s},MissionManager.prototype.findByType=function(e){for(var t=0;t<this.missions.length;t++)if(this.missions[t].type===e)return this.missions[t]},MissionManager.prototype.reset=function(e){this.missions=[],this.lastRemoved={},this.save()},MissionManager.prototype.encodeLastRemoved=function(){return this.missions.forEach(function(e){delete this.lastRemoved[e.type]},this),Object.keys(this.lastRemoved).forEach(function(e){(!Missions[e]||MissionManager.isObsoleteMissionType(+e
)||this.lastRemoved[e]+cleverapps.parseInterval(Mission.cooldownInterval(e))<Date.now())&&delete this.lastRemoved[e]},this),Object.keys(this.lastRemoved).map(function(e){var t=this.lastRemoved[e];return{type:parseInt(e),lastRemoved:t}},this)},MissionManager.prototype.save=function(e){var t=this.missions.map(function(e){return e.save()});t=t.concat(this.encodeLastRemoved()),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.MISSIONS,t),e||this.addUpdateTask()},MissionManager.prototype.sendUpdateTask=function(){Game.currentGame&&Game.currentGame.onChangeOutcomeListeners.missionsUpdate&&(Game.currentGame.onChangeOutcomeListeners.missionsUpdate=function(){}),MissionManager.sendUpdateTimeout&&(clearTimeout(MissionManager.sendUpdateTimeout),MissionManager.sendUpdateTimeout=void 0),cleverapps.synchronizer.addUpdateTask("missions")},MissionManager.prototype.addUpdateTask=function(){
"merge"!==cleverapps.config.type&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN?MissionManager.sendUpdateTimeout||cleverapps.environment.isSceneWithPreview()||(Game.currentGame.onChangeOutcomeListeners.missionsUpdate=this.addUpdateTask.bind(this),MissionManager.sendUpdateTimeout=setTimeout(this.sendUpdateTask.bind(this),cleverapps.parseInterval("1 minute"))):this.sendUpdateTask()},MissionManager.prototype.getInfo=function(){var e=this.missions.map(function(e){return e.save()});return e=e.concat(this.encodeLastRemoved())},MissionManager.prototype.updateInfo=function(e,t){for(;0<this.missions.length;)this.remove(this.missions[0],t);this.lastRemoved={},this.load(e,t),this.save(t)},MissionManager.prototype.removeSilents=function(){for(;;){for(var e=!1,t=0;t<this.missions.length;t++){var s=this.missions[t];if(s.isCompleted()&&s.canRemoveSilently()){e=!0,this.remove(s);break}}if(!e)break}},MissionManager.prototype.anyCompleted=function(){for(
var e=0;e<this.missions.length;e++){var t=this.missions[e];if(t.isCompleted())return t}},MissionManager.prototype.displayCompleted=function(i){cleverapps.metha.display({focus:"missionCompleted"+i.name,actions:[function(e){i.state=Mission.STATE_SHOWN_FINISHVIEW;var t=i.finishView;if(t){var s=new t(i);s instanceof cleverapps.FixedWidthScene||s instanceof SceneProxy?cleverapps.scenes.replaceScene(s,e):cleverapps.metha.onceNoWindowsListener=e}else e()},function(e){var t=i.receiveReward(),s=t&&t.unit&&cleverapps.toArray(t.unit).length-Game.currentGame.map.countEmptySlots();if(0<s)return Game.currentGame.onHintMessage("messages:Spawn.nospace",!0,{left:s}),void e();cleverapps.metha.compound(e,[function(e){t?(new RewardWindow({reward:t}),cleverapps.metha.onceNoWindowsListener=e):e()},function(e){i.canRemove()&&!i.lastChanceUsed&&i.hasLastChance()?(i.lastChanceUsed=!0,new i.lastChanceView(i),cleverapps.metha.onceNoWindowsListener=e):e()},function(e){i.canRemove(
)&&cleverapps.missionManager.remove(i),e()}])}]})},MissionManager.prototype.pendingStartWindow=function(){for(var e=0;e<this.missions.length;e++)if(this.missions[e].needShowStartWindow&&this.missions[e].startWindow)return this.missions[e]},MissionManager.prototype.showStartWindow=function(){var t=this.pendingStartWindow();t.needShowStartWindow=!1,cleverapps.metha.display({focus:"missionStartWindow_"+t.type,action:function(e){new t.startWindow(t),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},MissionManager.prototype.getProjectAvailableTypes=function(){var e=[Mission.TYPE_FAVORITE_SALE,Mission.TYPE_BOOSTERS_SALE];return"board"===cleverapps.config.type?(e.push(Mission.TYPE_LETTER),e.push(Mission.TYPE_COINS_SALE),e.push(Mission.TYPE_WARDROBE)):"solitaire"===cleverapps.config.type?(e.push(Mission.TYPE_LETTER),cleverapps.config.debugMode&&e.push(Mission.TYPE_COINS_SALE)):"differences"===cleverapps.config.type?e.push(Mission.TYPE_LETTER):(e.push(Mission.TYPE_COMBO),e.push(
Mission.TYPE_COLLECT_MARK),e.push(Mission.TYPE_BURN_NEARBY),cleverapps.config.editorMode||e.push(Mission.TYPE_LANTERN)),cleverapps.lives&&e.push(Mission.TYPE_LIVES_SALE),-1!==["riddles","heroes","olympics","tripeaks","differences","scramble","wordheaps"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_TREASURE_SEARCH),-1!==["wordsoup","crocword","magicwords"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_STICKERS_COLLECTION),-1!==["scramble","wordheaps","riddles","heroes"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_BONUS_WORLD),-1!==["scramble","wordheaps"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_SLOT_MACHINE),-1!==["merge"].indexOf(cleverapps.config.type)&&(e=[Mission.TYPE_ENERGY_FEAST,Mission.TYPE_BATTLEPASS,Mission.TYPE_COINS_FEAST,Mission.TYPE_COINS_TIME],cleverapps.config.debugMode&&e.push(Mission.TYPE_ENERGY_TIME)),-1!==["riddles","heroes"].indexOf(cleverapps.config.name)&&e.push(Mission.TYPE_BATTLEPASS),e},
MissionManager.prototype.listAvailableTypes=function(){return-1!==["spades"].indexOf(cleverapps.config.name)?[]:this.getProjectAvailableTypes().filter(function(e){var t=Missions[e].feature;if(t&&-1===cleverapps.eventManager.listCurrentFeatures().indexOf(t))return!1;if(t){var s=(Missions[e].productsCheap||[]).concat(Missions[e].productsExpensive||[]);if(cleverapps.payments.isProductsExists&&!cleverapps.payments.isProductsExists(s))return!1}var i=Missions[e].logic;return!(i&&i.IsAvailable&&!i.IsAvailable())&&cleverapps.user.checkAvailable(Missions[e].available)}.bind(this))},MissionManager.prototype.getUsedSemaphore=function(){for(var e=0,t=0;t<this.missions.length;t++)e|=this.missions[t].semaphore;return this.semaphoresOnHold&&(e|=this.semaphoresOnHold),e},MissionManager.prototype.canCreateTypes=function(){var e=this.listAvailableTypes(),t=cleverapps.skins.getSlot("removeMissions");if(t&&(e=cleverapps.substract(e,t)),0===e.length)return!1;var n=this.getUsedSemaphore(),
o=cleverapps.competitionPlayers.getAmount();e=e.filter(function(e){var t=this.lastRemoved[e]||0,s=Missions[e].competition&&Missions[e].competition.amount[1]||0,i=!Missions[e].canCreate||Missions[e].canCreate();return 0==(n&Missions[e].semaphore)&&t+cleverapps.parseInterval(Mission.cooldownInterval(e))<=Date.now()&&s<=o&&i}.bind(this));var s=0;return e.forEach(function(e){var t=Missions[e].priority||0;s<t&&(s=t)}),e.filter(function(e){return(Missions[e].priority||0)===s})},MissionManager.prototype.run=function(){this.checkIcons();var e=this.canCreateTypes();if(0<e.length){var t=cleverapps.Random.choose(e);this.add(t),this.save(),cleverapps.playSession.set(cleverapps.EVENTS.MISSION_START_DAU+"_"+Missions[t].name,!0)}},MissionManager.prototype.checkIcons=function(){this.missions.forEach(function(e){if(e.isRunning()&&!cleverapps.sideBar.findMissionIcon(e.type)){var t=new MissionIcon(e);cleverapps.sideBar.addIcon(t)}})},MissionManager.prototype.remove=function(e,t){e.beforeRemove()
;var s=this.missions.indexOf(e);if(-1!==s){this.semaphoresOnHold|=e.semaphore,setTimeout(function(){this.semaphoresOnHold&e.semaphore&&(this.semaphoresOnHold-=e.semaphore)}.bind(this),cleverapps.parseInterval("1 minute")),this.table.resetResults(e.type),this.missions.splice(s,1),this.lastRemoved[e.type]=Date.now(),e.oncePerEvent&&(this.lastRemoved[e.type]=e.eventFinishTime),t||this.save();var i=cleverapps.sideBar.findMissionIcon(e.type);i?i.removeFromSideBar():cleverapps.throwAsync("Removing non-existent icon of type: "+e.type)}},MissionManager.prototype.add=function(e,t,s){var i=new Mission(e,t,s);this.missions.push(i);var n=new MissionIcon(i);cleverapps.sideBar.addIcon(n)},cleverapps.Adversting={idfa:void 0,getIdfa:function(){return this.idfa?(cc.sys.isNative&&console.log("idfa - "+this.idfa),this.idfa):(cc.sys.isNative&&cc.sys.isWebView&&cc.sys.os===cc.sys.OS_ANDROID?"undefined"!=typeof AdverstingPlugin&&"function"==typeof AdverstingPlugin.getIdfa&&(e=AdverstingPlugin.getIdfa(),
console.log("android idfa - "+this.idfa)):cc.sys.isNative&&cc.sys.isWebView&&cc.sys.os===cc.sys.OS_IOS?(e=cleverapps.webViewData.advertisingId,console.log("ios idfa - "+this.idfa)):cleverapps.isLocalhost()&&(e="localhostIDFA"),this.idfa=e);var e},postbackUnity:function(e){var t=cleverapps.User.calcSource();if("amazon"===t||"android"===t){var s=cleverapps.config.android.unityGameId;"ios"===t&&(s=cleverapps.config.ios.unityGameId);var i="https://postback.unityads.unity3d.com/games/"+s+"/install?advertisingTrackingId="+e;cleverapps.RestClient.get(i,{},function(e){})}}},cleverapps.Adjust=function(){this.settings=cleverapps.config.adjust||{},this.settings.events=this.settings.events||{},this.settings&&cc.sys.isNative&&"undefined"!=typeof AdjustPlugin&&!cleverapps.flags.noadjust||cleverapps.override(this,cleverapps.FakeAdjust),this.initialize()},cleverapps.Adjust.prototype.initialize=function(){var e=this.settings.token;AdjustPlugin.init(e,cleverapps.Adjust.ENVIRONMENT,
cleverapps.Adjust.LOG_LEVEL)},cleverapps.Adjust.prototype.logPurchase=function(e,t,s){var i=this.settings.purchaseToken;AdjustPlugin.logPurchase(i,e,t,s)},cleverapps.Adjust.prototype.logEvent=function(e){var t=this.settings.events[e];t&&AdjustPlugin.logEvent(t)},cleverapps.FakeAdjust={initialize:function(){},logPurchase:function(){},logEvent:function(){}},cleverapps.Adjust.SANDBOX="sandbox",cleverapps.Adjust.PRODUCTION="production",cleverapps.Adjust.ENVIRONMENT=cleverapps.Adjust.PRODUCTION,cleverapps.Adjust.LOG_LEVEL="VERBOSE",cleverapps.FirebaseManager={run:function(){return cc.sys.isWebView&&cc.sys.os===cc.sys.OS_IOS?cleverapps.WebViewIosFirebase:cleverapps.flags.nofirebase?cleverapps.FakeFirebase:cc.sys.isNative&&cc.sys.isWebView&&"undefined"!=typeof FirebasePlugin?cleverapps.WebViewAndroidFirebase:"undefined"!=typeof sdkbox&&sdkbox.firebase?sdkbox.firebase.Analytics:(cc.sys.isNative&&console.log("No firebase plugin found!"),cleverapps.FakeFirebase)}},cleverapps.SdkBoxFirebase={
init:function(){console.log("init firebase"),sdkbox.firebase.Analytics.init(),sdkbox.firebase.Analytics.setUserID(cleverapps.user.id)},logEvent:function(e,t){sdkbox.firebase.Analytics.logEvent(e,t)},setScreenName:function(e,t){sdkbox.firebase.Analytics.setScreenName(e,t)}},cleverapps.WebViewAndroidFirebase={batch:[],sendBatch:cleverapps.accumulate(1e3,function(){var e=cleverapps.WebViewAndroidFirebase;0<e.batch.length&&(FirebasePlugin.sendBatch(JSON.stringify(e.batch)),e.batch=[])}),init:function(){this.batch.push({method:"setUserID",id:cleverapps.user.id}),this.sendBatch()},logEvent:function(e,t){this.batch.push({method:"logEvent",name:e,data:JSON.stringify(t)}),this.sendBatch()},setScreenName:function(e,t){this.batch.push({method:"setScreenName",screen:e,scene:t}),this.sendBatch()}},cleverapps.WebViewIosFirebase={init:function(){webkitMessage("firebase",{action:"setUserID",id:cleverapps.user.id})},logEvent:function(e,t){webkitMessage("firebase",{action:"logEvent",name:e,
data:JSON.stringify(t)})},setScreenName:function(e,t){webkitMessage("firebase",{action:"setScreenName",screen:e,scene:t})}},cleverapps.FakeFirebase={init:function(){},logEvent:function(){},setScreenName:function(){}},cleverapps.LocalPushes=function(){this.initSender(),this.load(),this.queue={},Messages.onInitializedListeners.localPushes=this.processQueue.bind(this)},cleverapps.LocalPushes.prototype.getByCode=function(e){for(var t in e=cleverapps.castType(e),cleverapps.LocalPushes.TYPES){var s=cleverapps.LocalPushes.TYPES[t];if(s.code===e)return s}},cleverapps.LocalPushes.prototype.processQueue=function(){var e=this.queue;for(var t in e){var s=e[t],i=this.getByCode(t);i&&this.sendPush(i,s)}this.queue={}},cleverapps.LocalPushes.prototype.init=function(){this.onShow(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,cleverapps.throttle(1e3,this.onShow.bind(this)))},cleverapps.LocalPushes.prototype.onShow=function(){this.cancelSoonPushes(),cleverapps.user.checkAvailable(
cleverapps.LocalPushes.LETS_PLAY_AVAILABLE)?this.sendPush(cleverapps.LocalPushes.TYPES.LETS_PLAY,cleverapps.parseInterval(cleverapps.LocalPushes.LETS_PLAY_TIMEOUT)):this.sendPush(cleverapps.LocalPushes.TYPES.LETS_PLAY,cleverapps.parseInterval(cleverapps.LocalPushes.LETS_PLAY_BEGGINERS_TIMEOUT))},cleverapps.LocalPushes.prototype.initSender=function(){cc.sys.isNative&&cc.sys.os===cc.sys.OS_IOS?this.sender=cleverapps.LocalPushes.IosWebViewSender:"object"==typeof LocalPushesPlugin?this.sender=cleverapps.LocalPushes.AndroidWebViewSender:(levels.user.haveTmpId()||cleverapps.isLocalhost()||(this.sender=cleverapps.LocalPushes.FacebookSender),[cleverapps.FakeInstant,cleverapps.FakeFacebook].forEach(function(e){cleverapps.social instanceof e&&(this.sender=void 0)},this)),this.sender||(this.sender=cleverapps.LocalPushes.FakeSender)},cleverapps.LocalPushes.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LOCAL_PUSHES);this.data=e||{}},
cleverapps.LocalPushes.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LOCAL_PUSHES,this.data)},cleverapps.LocalPushes.prototype.sendPush=function(e,t){var s=e.code;if(t<cleverapps.parseInterval(cleverapps.LocalPushes.TIMEOUT_THRESHOLD))this.cancelPush(e);else if(Messages.isInitialized()){var i=Date.now()+t;this.data[s]&&Math.abs(this.data[s].when-i)<Math.max(.1*t,cleverapps.parseInterval("1 minute"))||(this.data[s]={when:i},this.save(),this.sender.sendPush(e,t))}else this.queue[s]=t},cleverapps.LocalPushes.prototype.cancelPush=function(e){var t=e.code;delete this.queue[t],this.sender.cancelPush(e),this.data[t]&&(delete this.data[t],this.save())},cleverapps.LocalPushes.prototype.cancelSoonPushes=function(){for(var e in this.data){if(this.data[e].when-Date.now()<=cleverapps.parseInterval(cleverapps.LocalPushes.TIMEOUT_THRESHOLD)){var t=this.getByCode(e);t&&this.cancelPush(t)}}},cleverapps.LocalPushes.GetPushData=function(e,t){var s=Messages.get(e.message)
,i=Messages.get(e.title,{gameTitle:Messages.get(cleverapps.config.title)});return Array.isArray(s)||(s=[s]),Array.isArray(i)||(i=[i]),void 0===t&&(t=cleverapps.Random.random(0,s.length-1)),{text:s[t],title:i[t]||cleverapps.Random.mathChoose(i),index:t}},cleverapps.LocalPushes.TYPES={BOUNTY:{code:0,title:"LocalPushes.Bounty.Title",message:"LocalPushes.Bounty"},BONUS_ROUND:{code:2,title:"LocalPushes.BonusRound.Title",message:"LocalPushes.BonusRound"},LIVES:{code:3,title:"LocalPushes.Lives.Title",message:"LocalPushes.Lives"},MINI_GAME:{code:4,title:"LocalPushes.MiniGame.Title",message:"LocalPushes.MiniGame"},LETS_PLAY:{code:5,title:"LocalPushes.LetsPlay.Title",message:"LocalPushes.LetsPlay"},FREE_CHEST:{code:6,title:"LocalPushes.FreeChest.Title",message:"LocalPushes.FreeChest"},ENERGY_LOTTERY:{code:7,title:"LocalPushes.EnergyLottery.Title",message:"LocalPushes.EnergyLottery"},FRUIT_RIPE:{code:8,title:"LocalPushes.FruitRipe.Title",message:"LocalPushes.FruitRipe"},CASTLE_PRIZE:{code:9,
title:"LocalPushes.CastlePrize.Title",message:"LocalPushes.CastlePrize"},ORDER_READY:{code:10,title:"LocalPushes.OrderReady.Title",message:"LocalPushes.OrderReady"},TREE_CHOPPED:{code:11,title:"LocalPushes.TreeChopped.Title",message:"LocalPushes.TreeChopped"},BUILDING_BUILT:{code:12,title:"LocalPushes.BuildingBuilt.Title",message:"LocalPushes.BuildingBuilt"},MAGIC_PLANT_READY:{code:13,title:"LocalPushes.MagicPlantReady.Title",message:"LocalPushes.MagicPlantReady"},MINI_GAME_PRIZE:{code:14,title:"LocalPushes.MineSweeperReady.Title",message:"LocalPushes.MineSweeperReady"}},"merge"===cleverapps.config.type&&(cleverapps.LocalPushes.TYPES.LIVES={code:3,title:"LocalPushes.Energy.Title",message:"LocalPushes.Energy"}),cleverapps.LocalPushes.TIMEOUT_THRESHOLD="1 minute",cleverapps.LocalPushes.LETS_PLAY_TIMEOUT="7 days",cleverapps.LocalPushes.LETS_PLAY_BEGGINERS_TIMEOUT="1 day",cleverapps.LocalPushes.LETS_PLAY_AVAILABLE={episode:1,level:0},"merge"===cleverapps.config.type&&(
cleverapps.LocalPushes.LETS_PLAY_AVAILABLE={episode:0,level:6}),cleverapps.LocalPushes.FakeSender={askPermission:function(){},sendPush:function(e,t){if(cleverapps.config.debugMode){var s=cleverapps.LocalPushes.GetPushData(e),i=e.code;s.text&&s.title?(this.pushes||(this.pushes={}),this.pushes[e.code]=setTimeout(function(){cleverapps.config.wysiwygMode||cleverapps.Notification.create(s.text)},t),console.log("FakeSender: scheduled: "+s.text,cleverapps.intervalToString(t))):cleverapps.throwAsync("empty fake push - "+i)}},cancelPush:function(e){if(cleverapps.config.debugMode){this.pushes&&this.pushes[e.code]&&(clearTimeout(this.pushes[e.code]),this.pushes[e.code]=void 0);var t=cleverapps.LocalPushes.GetPushData(e);cleverapps.config.wysiwygMode||cleverapps.Notification.create("Removed: "+t.text),console.log("FakeSender: removed: "+t.text,e)}}},cleverapps.LocalPushes.AndroidWebViewSender={askPermission:function(){},sendPush:function(e,t){var s=cleverapps.LocalPushes.GetPushData(e),i=e.code,
n=s.title,o=s.text;if(o&&n){var r=LocalPushesPlugin.scheduleNotification(n,o,t,i);r&&cleverapps.throwAsync("Android send push error "+r),cleverapps.LocalPushes.FacebookSender.sendPush(e,t,s.index)}else cleverapps.throwAsync("empty android push - "+i)},cancelPush:function(e){LocalPushesPlugin.cancelNotification(e.code),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.IosWebViewSender={askPermission:function(){webkitMessage("localPushes",{action:"askPermission"})},sendPush:function(e,t){var s=cleverapps.LocalPushes.GetPushData(e),i=s.title,n=s.text,o=e.code;n?(webkitMessage("localPushes",{action:"sendPush",title:i,message:n,timeout:t,code:o}),cleverapps.LocalPushes.FacebookSender.sendPush(e,t,s.index)):cleverapps.throwAsync("empty ios push - "+o)},cancelPush:function(e){webkitMessage("localPushes",{action:"cancelPush",code:e.code}),cleverapps.LocalPushes.FacebookSender.cancelPush(e)}},cleverapps.LocalPushes.FacebookSender={askPermission:function(){},
sendPush:function(e,t,s){if(!levels.user.haveTmpId()&&!cleverapps.isLocalhost()){var i=e.code,n=levels.user.id,o=cleverapps.User.calcSource();"mobile_mm"!==o&&"web_mm"!==o||(n="mw_"+n),"mobile_ok"!==o&&"web_ok"!==o||(n="ok_"+n),"mobile_vk"!==o&&"web_vk"!==o||(n="vk_"+n);var r="/localpushes/send/"+n+"/"+i,a=cleverapps.LocalPushes.GetPushData(e,s),c={message:a.text,timeout:t};cleverapps.isInstant()&&(c.title=a.title),c.message?(console.log("Sending push - "+i,c),cleverapps.RestClient.post(r,c,function(){console.log("Success push - "+i)},function(){console.log("Failure push - "+i)})):cleverapps.throwAsync("empty facebook push - "+i)}},cancelPush:function(e){if(!levels.user.haveTmpId()&&!cleverapps.isLocalhost()){var t=e.code,s="/localpushes/cancel/"+levels.user.id+"/"+t;console.log("Sending cancel push - "+t),cleverapps.RestClient.post(s,{},function(){console.log("Success cancel push - "+t)},function(){console.log("Failure cancel push - "+t)})}}};var NativeInvite={nativeInviteFriends:!0,
inviteFriends:function(e,t){this.onInviteFriendsListener=t;var s={title:e.title,message:e.message,link:cleverapps.config.deployment+"/res/applink.html"};if(e.element&&e.element.parent){var i=e.element.parent.convertToWorldSpace(e.element.getPosition()),n=cc.view.getFrameSize();s.element={x:i.x/n.width,y:1-i.y/n.height}}cc.sys.os===cc.sys.OS_ANDROID?MessagesPlugin.sendMessageAllVariants(JSON.stringify(s)):(s.action="sendMessageAllVariants",webkitMessage("messages",s))},onInviteFriends:function(e){this.onInviteFriendsListener&&(this.onInviteFriendsListener(e),delete this.onInviteFriendsListener)}},NativeReview={isAvailable:function(){return cc.sys.os===cc.sys.OS_ANDROID&&"undefined"!=typeof ReviewPlugin},requestReview:function(e){this.onRequestReviewListener=e,console.log("NativeReview - start"),ReviewPlugin.requestReview()},onRequestReview:function(e){console.log("NativeReview - finish, result - "+e),this.onRequestReviewListener&&(this.onRequestReviewListener(e),
delete this.onRequestReviewListener)}};cleverapps.Social=function(){this.onInitializedListeners={},this.initialized=!1},cleverapps.Social.prototype.initialize=function(e){this.init(function(){this.setInitialized(!0),e()}.bind(this))},cleverapps.Social.prototype.init=function(e){e()},cleverapps.Social.prototype.isLoggedIn=function(){},cleverapps.Social.prototype.isInitialized=function(){return!1!==this.initialized},cleverapps.Social.prototype.setInitialized=function(e){if(this.initialized=e,this.initialized){for(var t in this.onInitializedListeners){(0,this.onInitializedListeners[t])()}this.onInitializedListeners={}}},cleverapps.Social.prototype.whenInitialized=function(e,t){this.isInitialized()?t():this.onInitializedListeners[e]=t},cleverapps.Social.prototype.getLocalStoragePreffix=function(){return""},cleverapps.Social.prototype.getUserID=function(){},cleverapps.Social.prototype.getAccessToken=function(){},cleverapps.Social.prototype.login=function(e,t){},
cleverapps.Social.prototype.inviteFriends=function(e,t){},cleverapps.Social.prototype.inviteFriendsShare=function(e,s){var t=cleverapps.ShareBonus.cycleShareData("share");this.shareDialog({description:e.message?e.message:Messages.get("SettingsWindow.InviteFriends.message"),name:e.title?e.title:Messages.get("SettingsWindow.InviteFriends.title"),picture:t.picture,vk:t.vk},function(e,t){e===cleverapps.Social.CODE_SUCCEED&&cleverapps.history.add("share",1),s&&s(e,t)})},cleverapps.Social.prototype.request=function(e,t){},cleverapps.Social.prototype.shareDialog=function(e,t){},cleverapps.Social.prototype.listFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Social.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Social.prototype.aboutMe=function(e){this.aboutUser("me",e)},cleverapps.Social.prototype.aboutUser=function(e,t,s){},cleverapps.Social.prototype.deleteAllRequests=function(){},
cleverapps.Social.prototype.needWindowForLogin=function(){return!1},cleverapps.Social.prototype.api=function(e,t,s,i){},cleverapps.Social.isAppropriate=function(){},cleverapps.Social.prepareId=function(e){return""+e},cleverapps.Social.prototype.checkConnection=function(e,t,s){if(e=e||function(){},cleverapps.flags.nologin)e();else{if("object"==typeof t&&(s=t,t=function(){}),t=t||function(){},s=s||{},!this.isInitialized())return cleverapps.Notification.create("messages:SocialManager.Initialization"),void t();this.isLoggedIn()?e():cc.sys.isNative||s.withWindow||this.needWindowForLogin()?new FbConnectWindow(e,t,s):this.login(e,t)}},cleverapps.Social.prototype.sendRequest=function(n,o,r){Array.isArray(n)||(n=[n]),this.checkConnection(function(){this.request({to:n,message:Messages.get(o+".message"),title:Messages.get(o+".title")},function(e){if(e===cleverapps.Social.CODE_SUCCEED){cleverapps.history.add("rqst",n.length),levels.friendSorter.markUsed(n),cleverapps.playSession.inc("viral",
n.length);var t=cleverapps.friends.listIds(),s=n.filter(function(e){return-1!==t.indexOf(e)});0<s.length&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_FRIEND,{amount:s.length}),0<n.length-s.length&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_INVITE,{amount:n.length-s.length}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_SENT_PREFIX+o,{amount:n.length}),r&&r()}else if(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MESSAGE_CANCEL_PREFIX+o,{amount:n.length}),-1===cleverapps.Social.CANCEL_CODES.indexOf(e)){var i=cleverapps.EVENTS.MESSAGE_ERROR+"_"+cleverapps.User.calcSource();"number"==typeof e&&(i+="_"+e),cleverapps.eventLogger.logEvent(i)}})}.bind(this))},cleverapps.Social.prototype.inviteFriendsWindow=function(s,e){e||(e="SettingsWindow.InviteFriends"),this.checkConnection(function(){cleverapps.history.add("invt",1),this.inviteFriends({message:Messages.get(e+".message"),title:Messages.get(e+".title")},function(e,t){
s&&e===cleverapps.Social.CODE_SUCCEED&&s()})}.bind(this))},cleverapps.Social.prototype.inviteRandomFriends=function(t,s){this.checkConnection(function(){var e=levels.friendSorter.listInactiveFriends().map(function(e){return e.id});0<e.length?(e.sort(function(){return Math.random()-.5}),e.length>cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS&&(e=e.slice(0,cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS)),this.sendRequest(e,s,t)):this.inviteFriendsWindow(t,s)}.bind(this))},cleverapps.Social.prototype.requestFullScreen=function(e){e()},cleverapps.Social.prototype.getDefaultLanguages=function(){return[]},cleverapps.Social.prototype.getCodes=function(){return this.getCode().split("-").sort()},cleverapps.Social.prototype.getCode=function(){return cleverapps.User.calcSource()},cleverapps.Social.CODE_SUCCEED=0,cleverapps.Social.CODE_FAILED=1,cleverapps.Social.CODE_CANCELLED=2,cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS=10,cleverapps.Social.CANCEL_CODES=[cleverapps.Social.CODE_CANCELLED],
cleverapps.Social.ACTIVITY={LVL_PASSED:0,DAILY_TASK:1,PASSED_FRIEND:2},cleverapps.Social.ACTIVITIES_CONFIG={},cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.LVL_PASSED]={probability:.25,messages:[{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body1"},{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body2"},{title:"messages:Activity.PassLevel.title",body:"messages:Activity.PassLevel.body3"}]},cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.DAILY_TASK]={probability:.5,messages:[{title:"messages:Activity.DailyTask.title",body:"messages:Activity.DailyTask.body1"},{title:"messages:Activity.DailyTask.title",body:"messages:Activity.DailyTask.body2"}]},cleverapps.Social.ACTIVITIES_CONFIG[cleverapps.Social.ACTIVITY.PASSED_FRIEND]={probability:1,messages:[{title:"messages:Activity.BeatFriend.title",body:"messages:Activity.BeatFriend.body1"}]},cleverapps.BaseFB=function(){cleverapps.Social.call(this),
cleverapps.Social.CANCEL_CODES.push(cleverapps.BaseFB.FACEBOOK_CANCEL_DIALOG)},cleverapps.BaseFB.prototype=Object.create(cleverapps.Social.prototype),cleverapps.BaseFB.prototype.constructor=cleverapps.BaseFB,cleverapps.BaseFB.prototype.pagingLoading=function(s,i,n,e,o){o||(o=[]),e||(e=""),n||(n=0),n>=cleverapps.BaseFB.MAX_PAGE?i(cleverapps.Social.CODE_SUCCEED,o):this.api(s+"&limit=100"+e,function(e,t){e===cleverapps.Social.CODE_SUCCEED?(t.data&&(o=o.concat(t.data)),t.paging&&t.paging.cursors&&t.paging.next&&t.paging.cursors.after?this.pagingLoading(s,i,n+1,"&after="+t.paging.cursors.after,o):i(cleverapps.Social.CODE_SUCCEED,o)):o.length?i(cleverapps.Social.CODE_SUCCEED,o):i(e,o)}.bind(this))},cleverapps.BaseFB.prototype.getShareDialogLink=function(e){return cleverapps.config.deployment+cleverapps.config.restApiURL+"/share/?name="+encodeURIComponent(e.name)+"&description="+encodeURIComponent(e.description)+"&picture="+encodeURIComponent(cleverapps.config.deployment+e.picture)},
cleverapps.BaseFB.prototype.listFriends=function(e){this.pagingLoading("/me/friends?fields=first_name,id,picture.type(large)",e)},cleverapps.BaseFB.prototype.listInvitableFriends=function(e){e([])},cleverapps.BaseFB.prototype.aboutMe=function(e){this.aboutUser("me",e)},cleverapps.BaseFB.prototype.aboutUser=function(i,n,o){this.api("/"+i+"/?fields=currency,first_name,name,picture.type(large)",function(e,t){if(e===cleverapps.Social.CODE_SUCCEED)n(t);else if(console.log("Error: "+e),console.log(t),o&&o(e,t),0<=cleverapps.BaseFB.USERS_BLACK_LIST_ERROR_CODES.indexOf(e)){t.error_message;var s={code:e,data:t};cleverapps.RestClient.post("/users/blacklist/add/"+i,s,function(){console.log("Success add to black list:"+i)},function(){console.log("Failure add to black list:"+i)})}})},cleverapps.BaseFB.prototype.deleteAllRequests=function(){this.api("me/apprequests",function(e,t){if(e===cleverapps.Social.CODE_SUCCEED){if(t.data)for(var s=0;s<t.data.length;s++)console.log("START DELETE REQUEST",
t.data[s].id),this.api(t.data[s].id,"delete",function(e,t){console.log("DELETE REQUEST",e,t)})}else console.log("Error: "+e),console.log(t)}.bind(this))},cleverapps.BaseFB.MAX_PAGE=20,cleverapps.BaseFB.USERS_BLACK_LIST_ERROR_CODES=[100],cleverapps.BaseFB.FACEBOOK_CANCEL_DIALOG=4201,cleverapps.BaseFB.PERMISSIONS=["public_profile","user_friends"].join(","),0<=["wordheaps","spades","mergeriddles","mergeheroes","mergecraft"].indexOf(cleverapps.config.name)&&(cleverapps.BaseFB.PERMISSIONS="public_profile"),cleverapps.SelectSocial=function(e){console.log("Choosing Select Social ("+JSON.stringify(Object.keys(e))+")"),this.socials=e,cleverapps.Social.call(this)},cleverapps.SelectSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.SelectSocial.prototype.constructor=cleverapps.SelectSocial,cleverapps.SelectSocial.prototype.onInit=function(e){if(console.log("SelectSocial.onInit - "+this.socialInitializing),this.socialInitializing){var t=this.socials[this.socialInitializing]
;delete this.socialInitializing,t.onInit.apply(t,arguments)}},cleverapps.SelectSocial.prototype.init=function(s){var t=function(){for(var e in this.socials){var t=this.socials[e];if(t.isLoggedIn()){cleverapps.social=t,console.log("Change social to "+e);break}}s()}.bind(this),i=Object.keys(this.socials),n=function(){if(0!==i.length){var e=this.socialInitializing=i.shift();this.socials[e].initialize(n)}else t()}.bind(this);n()},cleverapps.SelectSocial.prototype.onLogin=function(e){if(this.socialLogining){var t=this.socials[this.socialLogining];e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.social=t,console.log("Change social to "+this.socialLogining)),delete this.socialLogining,t.onLogin.apply(t,arguments)}},cleverapps.SelectSocial.prototype.login=function(e,t,s){this.socialLogining=s.source,this.socials[this.socialLogining].login(e,t)},cleverapps.SelectSocial.prototype.getCode=function(){return Object.keys(this.socials).sort().join("-")},cc.sys.isNative&&cleverapps.override(
cleverapps.SelectSocial.prototype,NativeInvite);var FriendsCache=function(e){this.data={},this.player=void 0,this.lastUpdateTime=0,this.isInvitable=e,this.load(),this.onFriendsUpdatedListeners=[],this.onUserUpdatedListener=function(){},this.playerInfoChangedListeners={}};FriendsCache.prototype.getStoreKey=function(){return this.isInvitable?cleverapps.DataLoaderTypes.INVITABLE_FRIENDS:cleverapps.DataLoaderTypes.FRIENDS},FriendsCache.prototype.reset=function(){this.data={},this.player=void 0,this.lastUpdateTime=0,this.save()},FriendsCache.prototype.load=function(){var e=cleverapps.DataLoader.load(this.getStoreKey());e&&(this.data=e.data,this.player=e.player,this.lastUpdateTime=e.when)},FriendsCache.prototype.save=function(){var e={data:this.data,player:this.player,when:this.lastUpdateTime};cleverapps.DataLoader.save(this.getStoreKey(),e)},FriendsCache.prototype.isEmpty=function(){return 0===this.lastUpdateTime||0===this.data.length},FriendsCache.prototype.haveData=function(){
return 0!==this.lastUpdateTime},FriendsCache.prototype.addFriendsUpdatedListener=function(e){this.onFriendsUpdatedListeners.push(e)},FriendsCache.prototype.setData=function(e){var t=Object.keys(this.data).length;this.data={},e.forEach(function(e){this.data[e.id]={id:e.id,name:e.first_name,avatar:e.picture&&e.picture.data&&e.picture.data.url}},this);var s=Object.keys(this.data).length;this.lastUpdateTime=Date.now(),this.save(),t<s&&this.onFriendsUpdatedListeners.forEach(function(e){e()})},FriendsCache.prototype.getPlayer=function(){return void 0!==this.player?this.player:FriendsCache.DEFAULT_PLAYER_INFO()},FriendsCache.prototype.updatePlayerInfo=function(e){var t=this.getPlayer();this.player={id:cleverapps.user.id,self:!0,name:e.first_name,avatar:e.picture&&e.picture.data&&e.picture.data.url},this.save(),t.id===this.player.id&&t.name===this.player.name&&t.avatar===this.player.avatar||(this.onUserUpdatedListener(),cleverapps.values(this.playerInfoChangedListeners).forEach(function(e){e(
t.id)}.bind(this)))},FriendsCache.prototype.getById=function(e){return this.data[e]},FriendsCache.prototype.listIds=function(){return Object.keys(this.data)},FriendsCache.prototype.listFriends=function(){return cleverapps.values(this.data)},FriendsCache.prototype.inApp=function(e){return void 0!==this.data[e]},FriendsCache.prototype.reload=function(){cleverapps.social.isLoggedIn()?this.isInvitable?cleverapps.social.listInvitableFriends(function(e,t){void 0!==t&&this.setData(t)}.bind(this)):cleverapps.social.listFriends(function(e,t){void 0!==t&&(this.setData(t),cleverapps.User.reportAmountFriendsDau&&cleverapps.User.reportAmountFriendsDau())}.bind(this)):cleverapps.User.reportAmountFriendsDau&&cleverapps.User.reportAmountFriendsDau()},FriendsCache.RELOAD_INTERVAL=cleverapps.parseInterval("1 hour"),FriendsCache.DEFAULT_PLAYER_INFO=function(){return{id:cleverapps.user.id,self:!0,name:Messages.get("Friends.You"),avatar:bundles.main.frames.user_avatar}},cleverapps.AndroidSocial=function(){
console.log("Choosing Android Social"),cleverapps.Social.call(this),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.refresh.bind(this)),setInterval(this.refresh.bind(this),cleverapps.parseInterval("30 minutes"))},cleverapps.AndroidSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.AndroidSocial.prototype.constructor=cleverapps.AndroidSocial,cleverapps.AndroidSocial.prototype.refresh=function(){AndroidSocialPlugin.refresh()},cleverapps.AndroidSocial.prototype.isLoggedIn=function(){return AndroidSocialPlugin.isLoggedIn()},cleverapps.AndroidSocial.prototype.getUserID=function(){return"android_"+AndroidSocialPlugin.getUserID()},cleverapps.AndroidSocial.prototype.getAccessToken=function(){return AndroidSocialPlugin.getAccessToken()},cleverapps.AndroidSocial.prototype.onLogin=function(e){this.onLoginListener&&(this.onLoginListener(e),delete this.onLoginListener)},cleverapps.AndroidSocial.prototype.login=function(t,s){this.onLoginListener=function(e){
e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),s&&s())},AndroidSocialPlugin.login()},cleverapps.AndroidSocial.prototype.aboutMe=function(e){var t=AndroidSocialPlugin.aboutMe();t=decodeWebViewData(t),(t=JSON.parse(t))&&t.picture&&t.picture.data&&t.picture.data.url&&(t.picture.data.url=decodeWebViewData(t.picture.data.url)),console.log("AndroidSocial.aboutMe - "+JSON.stringify(t)),e(t)},cleverapps.AndroidSocial.prototype.getCode=function(){return cleverapps.AndroidSocial.CODE},cleverapps.AndroidSocial.isAvailable=function(){return cc.sys.isNative&&"android"===cleverapps.User.calcSource()},cleverapps.override(cleverapps.AndroidSocial.prototype,NativeInvite),cleverapps.AndroidSocial.CODE="androidsocial",cleverapps.AppleSocial=function(){console.log("Choosing Apple Social"),cleverapps.Social.call(this)},cleverapps.AppleSocial.prototype=Object.create(cleverapps.Social.prototype),
cleverapps.AppleSocial.prototype.constructor=cleverapps.AppleSocial,cleverapps.AppleSocial.prototype.updateNameFromServer=function(s){var e=function(e){var t=e.name||"";console.log("AppleSocial.updateNameFromServer success - "+t),this.name=t,this.save(),s()}.bind(this),t=function(e){console.log("AppleSocial.updateNameFromServer failure - "+e),s()}.bind(this);console.log("AppleSocial.updateNameFromServer"),cleverapps.RestClient.get("/info/name/"+this.getUserID(),{},e,t)},cleverapps.AppleSocial.prototype.prepareData=function(e,t){e=decodeWebViewData(e),e=JSON.parse(e),console.log("AppleSocial.prepareData - "+JSON.stringify(e)),this.id=e.id||"",this.token=e.token||"",e.name&&(this.name=e.name),this.save(),this.id&&!this.name?this.updateNameFromServer(t):t()},cleverapps.AppleSocial.prototype.onInit=function(e){var t=function(){this.onInitCallback&&(console.log("AppleSocial.onInit"),this.onInitCallback(),delete this.onInitCallback)}.bind(this);this.prepareData(e,t)},
cleverapps.AppleSocial.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.APPLE_SOCIAL,{id:this.id,token:this.token,name:this.name})},cleverapps.AppleSocial.prototype.init=function(e){var t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.APPLE_SOCIAL);this.onInitCallback=e,webkitMessage("appleSocial",{action:"init",data:t}),console.log("AppleSocial.init - "+JSON.stringify(t))},cleverapps.AppleSocial.prototype.isLoggedIn=function(){return this.getUserID()&&this.getAccessToken()},cleverapps.AppleSocial.prototype.getUserID=function(){if(this.id)return"apple_"+this.id},cleverapps.AppleSocial.prototype.getAccessToken=function(){return this.token},cleverapps.AppleSocial.prototype.onLogin=function(e,t){var s=function(){this.onLoginListener&&(console.log("AppleSocial.onLogin - "+e),this.onLoginListener(e),delete this.onLoginListener)}.bind(this);this.prepareData(t,s)},cleverapps.AppleSocial.prototype.login=function(t,s){this.onLoginListener=function(e){
e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),s&&s())},webkitMessage("appleSocial",{action:"login"}),console.log("AppleSocial.login")},cleverapps.AppleSocial.prototype.aboutMe=function(e){var t={id:this.getUserID(),first_name:this.name,name:this.name};console.log("AppleSocial.aboutMe - "+JSON.stringify(t)),e(t)},cleverapps.AppleSocial.prototype.getCode=function(){return cleverapps.AppleSocial.CODE},cleverapps.AppleSocial.isAvailable=function(){return cc.sys.isNative&&cleverapps.webViewData&&cleverapps.webViewData.appleSocialAvailable&&"ios"===cleverapps.User.calcSource()},cleverapps.override(cleverapps.AppleSocial.prototype,NativeInvite),cleverapps.AppleSocial.CODE="applesocial",cleverapps.StartFacebook=function(){plugin.extend("facebook",{name:"",version:"",_userInfo:null,_isLoggedIn:void 0,HttpMethod:{GET:"get",POST:"post",DELETE:"delete"},CODE_SUCCEED:0,AppEvent:{
ACTIVATED_APP:FB.AppEvents.EventNames.ACTIVATED_APP,COMPLETED_REGISTRATION:FB.AppEvents.EventNames.COMPLETED_REGISTRATION,VIEWED_CONTENT:FB.AppEvents.EventNames.VIEWED_CONTENT,SEARCHED:FB.AppEvents.EventNames.SEARCHED,RATED:FB.AppEvents.EventNames.RATED,COMPLETED_TUTORIAL:FB.AppEvents.EventNames.COMPLETED_TUTORIAL,ADDED_TO_CART:FB.AppEvents.EventNames.ADDED_TO_CART,ADDED_TO_WISHLIST:FB.AppEvents.EventNames.ADDED_TO_WISHLIST,INITIATED_CHECKOUT:FB.AppEvents.EventNames.INITIATED_CHECKOUT,ADDED_PAYMENT_INFO:FB.AppEvents.EventNames.ADDED_PAYMENT_INFO,PURCHASED:FB.AppEvents.EventNames.PURCHASED,ACHIEVED_LEVEL:FB.AppEvents.EventNames.ACHIEVED_LEVEL,UNLOCKED_ACHIEVEMENT:FB.AppEvents.EventNames.UNLOCKED_ACHIEVEMENT,SPENT_CREDITS:FB.AppEvents.EventNames.SPENT_CREDITS},AppEventParam:{CURRENCY:FB.AppEvents.ParameterNames.CURRENCY,REGISTRATION_METHOD:FB.AppEvents.ParameterNames.REGISTRATION_METHOD,CONTENT_TYPE:FB.AppEvents.ParameterNames.CONTENT_TYPE,
CONTENT_ID:FB.AppEvents.ParameterNames.CONTENT_ID,SEARCH_STRING:FB.AppEvents.ParameterNames.SEARCH_STRING,SUCCESS:FB.AppEvents.ParameterNames.SUCCESS,MAX_RATING_VALUE:FB.AppEvents.ParameterNames.MAX_RATING_VALUE,PAYMENT_INFO_AVAILABLE:FB.AppEvents.ParameterNames.PAYMENT_INFO_AVAILABLE,NUM_ITEMS:FB.AppEvents.ParameterNames.NUM_ITEMS,LEVEL:FB.AppEvents.ParameterNames.LEVEL,DESCRIPTION:FB.AppEvents.ParameterNames.DESCRIPTION},AppEventParamValue:{VALUE_YES:"1",VALUE_NO:"0"},_checkLoginStatus:function(e){var t=this;FB.getLoginStatus(function(e){e&&"connected"===e.status?(t._isLoggedIn=!0,t._userInfo=e.authResponse):(t._isLoggedIn=!1,t._userInfo={})})},ctor:function(e){this.name="facebook",this.version="1.0",this._userInfo={},this._isLoggedIn=void 0,FB&&(FB.init(e),this._checkLoginStatus(!0),plugin.FacebookAgent=this)},getInstance:function(){return this},login:function(e,s){var t={scope:e,return_scopes:!0};cleverapps.social.loginPopup&&(t.display="popup"),FB.login(function(e){if(
e.authResponse){this._isLoggedIn=!0,this._userInfo=e.authResponse;var t=e.authResponse.grantedScopes.split(",");"function"==typeof s&&s(0,{accessToken:e.authResponse.accessToken,permissions:t})}else this._isLoggedIn=!1,this._userInfo={},"function"==typeof s&&s(e.error_code||1,{error_message:e.error_message||"Unknown error"})}.bind(this),t)},isLoggedIn:function(){return this._isLoggedIn},logout:function(t){var s=this;FB.logout(function(e){e.authResponse?(s._isLoggedIn=!1,s._userInfo={},"function"==typeof t&&t(0,{isLoggedIn:!1})):"function"==typeof t&&t(e.error_code||1,{error_message:e.error_message||"Unknown error"})})},_requestPermissions:function(e,s){var t=e.join(","),i=this;FB.login(function(e){if(e.authResponse){var t=e.authResponse.grantedScopes.split(",");i._isLoggedIn=!0,i._userInfo=e.authResponse,"function"==typeof s&&s(0,{permissions:t})}else i._isLoggedIn=!1,i._userInfo={},"function"==typeof s&&s(e.error_code||1,{error_message:e.error_message||"Unknown error"})},{scope:t,
return_scopes:!0})},getAccessToken:function(){return this._userInfo?this._userInfo.accessToken:null},getUserID:function(){return this._userInfo?this._userInfo.userID:null},_share:function(e,t){FB.ui({method:"share",caption:e.caption,href:e.link},function(e){e?e.post_id?"function"==typeof t&&t(0,{didComplete:!0,post_id:e.post_id}):"function"==typeof t&&t(e.error_code||1,{error_message:e.error_message||"Unknown error"}):"function"==typeof t&&t(1,{error_message:"Unknown error"})})},dialog:function(e,t){if(e)if(this.canPresentDialog(e)){e.name=e.name||e.site,delete e.site,e.href=e.href||e.link||e.siteUrl,delete e.siteUrl,delete e.link,e.picture=e.picture||e.image||e.photo||e.imageUrl||e.imagePath,delete e.imageUrl,delete e.imagePath,delete e.photo,delete e.image,e.caption=e.title||e.caption,delete e.title,e.description=e.text||e.description,delete e.text;var s=e.dialog;if(delete e.dialog,"shareLink"===s||"feedDialog"==s)e.method="share";else if("messageLink"==s)e.method="send",
e.link=e.href;else if("shareOpenGraph"==s&&(e.method="share_open_graph",e.url)){var i={};for(var n in e.preview_property_name?i[e.preview_property_name]=e.url:i.object=e.url,e)"method"!=n&&"action_type"!=n&&"action_properties"!=n&&(e[n]&&(i[n]=e[n]),delete e[n]);e.action_properties=JSON.stringify(i)}FB.ui(e,function(e){e&&"function"==typeof t?e.post_id||e.success?t(0,{didComplete:!0,post_id:e.post_id||""}):e.error_code?t(e.error_code,{error_message:e.error_message||"Unknown error"}):t(0,e):null==e&&"function"==typeof t&&t(1,{error_message:"Unknown error"})})}else"function"==typeof t&&t(1,{error_message:"The requested dialog: "+e.dialog+" can not be presented on Web"});else"function"==typeof t&&t(1,{error_message:"No info parameter provided"})},canPresentDialog:function(e){return!(!e||!e.dialog||"shareLink"!==e.dialog&&"feedDialog"!==e.dialog&&"shareOpenGraph"!==e.dialog&&"messageLink"!==e.dialog)},api:function(e,t,s,i){"function"==typeof s&&(i=s,s={}),FB.api(e,t,s,function(e){
e.error?"function"==typeof i&&i(e.error.code,{error_message:e.error.message||"Unknown error"}):"function"==typeof i&&i(0,e)})},_getPermissionList:function(i){FB.api("/me/permissions",function(e){if(e.data){for(var t=[],s=0;s<e.data.length;s++)"granted"==e.data[s].status&&t.push(e.data[s].permission);"function"==typeof i&&i(0,{permissions:t})}else e.error||(e.error={}),"function"==typeof i&&i(e.error.code||1,{error_message:e.error.message||"Unknown error"})})},destroyInstance:function(){},canvas:{pay:function(e,t){var s={method:"pay",action:"purchaseitem",product:e.product};"subscription"===e.type&&(s.action="create_subscription"),-1!==["cancel_subscription","reactivate_subscription","change_subscription"].indexOf(e.action)&&(s.action=e.action,s.subscription_id=e.subscription_id),FB.ui(s,function(e){e.error_code?t(e.error_code||1,{error_message:e.error_message||e.error_msg||"Unknown error"}):t(0,e)})}},appRequest:function(e,t){e?(e.method="apprequests",FB.ui(e,function(e){
e?e.error_code?"function"==typeof t&&t(e.error_code,{error_message:e.error_message||"Unknown error"}):"function"==typeof t&&t(0,e):"function"==typeof t&&t(1,{error_message:"Unknown error"})})):"function"==typeof t&&t(1,{error_message:"No info parameter provided"})},logEvent:function(e,t,s){null!=e&&(void 0===t&&void 0===s?FB.AppEvents.logEvent(e,null,null):"number"==typeof t&&void 0===s?FB.AppEvents.logEvent(e,t):"object"==typeof t&&void 0===s?FB.AppEvents.logEvent(e,null,t):FB.AppEvents.logEvent(e,t,s))},activateApp:function(){FB.AppEvents.activateApp()},logPurchase:function(e,t,s){FB.AppEvents.logPurchase(e,t,s)}})},cleverapps.VK=function(){this instanceof cleverapps.MobileVk||console.log("Choosing html5-Vk"),cleverapps.Social.MAX_INVITE_RANDOM_FRIENDS=1,cleverapps.Social.call(this),cleverapps.config.debugMode&&this.debugUsers().indexOf(this.getUserID())<0&&(document.body.innerHTML="приложение не доступно")},cleverapps.VK.prototype=Object.create(cleverapps.Social.prototype),
cleverapps.VK.prototype.constructor=cleverapps.VK,cleverapps.VK.prototype.getLocalStoragePreffix=function(){return"_VK"},cleverapps.VK.prototype.debugUsers=function(){return["8593874","519644122","559432346","74852834","120601236","13506358","662073098","55069957"]},cleverapps.VK.prototype.init=function(e){var t=cleverapps.once(function(){VK.addCallback("onRequestSuccess",function(e){console.log("onRequestSuccess",e),this.listeners.onRequest(cleverapps.Social.CODE_SUCCEED,e)}.bind(this)),VK.addCallback("onRequestCancel",function(e){console.log("onRequestCancel",e),this.listeners.onRequest(cleverapps.Social.CODE_CANCELLED,e)}.bind(this)),VK.addCallback("onRequestFail",function(e){console.log("onRequestFail",e),this.listeners.onRequest(cleverapps.Social.CODE_FAIL,e)}.bind(this)),e()}.bind(this));this.listeners={onRequest:function(){}};var s=function(e){plugin.FacebookAgent=cleverapps.FakeFacebookAgent,t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT
):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//vk.com/js/api/xd_connection.js?2",{onSuccess:function(){VK.init(t,s,cleverapps.VK.API_VERSION)},onFailure:s})},cleverapps.VK.prototype.sendActivity=function(e,t){if(e===cleverapps.Social.ACTIVITY.LVL_PASSED){var s=void 0,i=0,n=levels.user.getHumanReadableNumber();cleverapps.VK.MISSIONS.forEach(function(e){n===e.level&&(s=e.id)}),void 0===s&&(s=1,i=t.levelNo,cleverapps.Random.mathChoose([0,1])&&void 0!==t.score&&(s=2,i=t.score));var o={user_id:this.getUserID(),activity_id:s,value:i,v:cleverapps.VK.API_VERSION},r=[];for(var a in o)r.push(a+"="+o[a]);cleverapps.RestClient.get("/vkappevents?"+r.join("&"),{})}},cleverapps.VK.prototype.createShortcut=function(){VK.api("account.getAppPermissions",{user_id:this.getUserID()},function(e){console.log("getAppPermissions: "+e.response),0==(256&e.response)&&FullscreenControlButton.exitFullscreen(function(){VK.callMethod("showSettingsBox",256
)})})},cleverapps.VK.prototype.isLoggedIn=function(){return!0},cleverapps.VK.prototype.getUserID=function(){return cleverapps.getRequestParameters().viewer_id},cleverapps.VK.prototype.getAccessToken=function(){return"VK_"+cleverapps.getRequestParameters().auth_key},cleverapps.VK.prototype.login=function(e){e()},cleverapps.VK.prototype.inviteFriends=function(e,t){FullscreenControlButton.exitFullscreen(function(){VK.callMethod("showInviteBox"),t(cleverapps.Social.CODE_SUCCEED)})},cleverapps.VK.prototype.requestToOne=function(e,t,s){this.listeners.onRequest=s,FullscreenControlButton.exitFullscreen(function(){VK.callMethod("showRequestBox",parseInt(e),t.message)})},cleverapps.VK.prototype.request=function(e,s){var i=e.to;Array.isArray(i)||(i=[i]);var n=[],o=function(t){t===i.length?s(n.length>Math.floor(i.length/2)?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(i[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(i[t]),o(t+1)})}.bind(this);o(0
)},cleverapps.VK.prototype.shareDialog=function(e,t){if(!e.vk)throw"No vk data to share!";FullscreenControlButton.exitFullscreen(function(){VK.api("wall.post",{message:e.description+"\n"+cleverapps.config.vk.url,attachments:[e.vk,"https://vk.com/app"+cleverapps.config.vk.appId].join(",")},function(e){e.error?t(cleverapps.Social.CODE_CANCELLED,e.error):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.VK.prototype.processPromo=function(t){cleverapps.eventLogger.logEvent("vk_promo_check"),VK.api("apps.promoHasActiveGift",{promo_id:t},function(e){if(cleverapps.eventLogger.logEvent("vk_promo_response"),e&&1===e.response){if(this.givePromoReward(),-1!==["4252816","74852834","559432346","9938687","4615499"].indexOf(cleverapps.user.id))return;VK.api("apps.promoUseGift",{promo_id:t})}}.bind(this))},cleverapps.VK.prototype.isPromoAvailable=function(e,t,s){return this.isInitialized()&&-1!==s.indexOf(cleverapps.config.name)&&(null===e||Date.now()>new Date(e).getTime())&&(null===t||Date.now(
)<new Date(t).getTime())},cleverapps.VK.prototype.givePromoReward=function(){cleverapps.metha.displayWhenFreeFocus({focus:"VKPromoRewardWindow",action:function(e){new RewardWindow({reward:cleverapps.VK.PROMO_REWARD,rewardName:"vkpromo"}),cleverapps.metha.onceNoWindowsListener=e}}),cleverapps.eventLogger.logEvent("vk_promo_reward")},cleverapps.VK.prototype.listFriendsByApp=function(s,i){VK.api("friends.getAppUsers",{},function(e){if(e.error)i(cleverapps.Social.CODE_FAILED,[]);else if(e.response){var t=e.response.map(cleverapps.VK.prepareId);VK.api("friends.get",{extended:1,count:1e3,fields:"photo_200"},function(e){e.error?i(cleverapps.Social.CODE_FAILED,[]):i(cleverapps.Social.CODE_SUCCEED,this.prepareFriendsData(e.response&&e.response.items,t,s))}.bind(this))}else i(cleverapps.Social.CODE_FAILED,[])}.bind(this))},cleverapps.VK.prototype.prepareFriendsData=function(e,t,s){return(e||[]).filter(function(e){return void 0===e.deactivated}).map(cleverapps.VK.formatUserData).filter(function(e
){return s===(-1!==t.indexOf(e.id))})},cleverapps.VK.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.VK.prototype.listInvitableFriends=function(e){this.listFriendsByApp(!1,e)},cleverapps.VK.prepareId=function(e){return""+e},cleverapps.VK.formatUserData=function(e){return{id:cleverapps.VK.prepareId(e.id),name:e.first_name+" "+e.last_name,first_name:e.first_name,picture:{data:{url:e.photo_200&&-1===e.photo_200.indexOf("camera_200.png")?e.photo_200:void 0}}}},cleverapps.VK.prototype.aboutMe=function(s){VK.api("users.get",{fields:"photo_200"},function(e){if(e&&e.response){var t=e.response[0];s(cleverapps.VK.formatUserData(t))}else console.log("Error: "+JSON.stringify(e))})},cleverapps.VK.prototype.logEvent=function(e,t){},cleverapps.VK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.VK.isAppropriate=function(){return!cc.sys.isNative&&"web_vk"===cleverapps.User.calcSource()},cleverapps.VK.PROMO_REWARD={gold:50},
"match3"===cleverapps.config.type&&cleverapps.config.results?cleverapps.VK.PROMO_REWARD={unlimitedLives:"12 hours",stars:10}:"match3"===cleverapps.config.type?cleverapps.VK.PROMO_REWARD={unlimitedLives:"12 hours",gold:20}:"stacks"===cleverapps.config.subtype&&(cleverapps.VK.PROMO_REWARD={gold:100}),cleverapps.VK.DEFAULT_HEIGHT=720,cleverapps.VK.DEFAULT_WIDTH=800,cleverapps.VK.MIN_HEIGHT=480,cleverapps.VK.SCREEN_HEIGHT_RESERVED=230,cleverapps.VK.API_VERSION="5.107",cleverapps.VK.MISSIONS=[{id:3,level:1},{id:4,level:2},{id:5,level:3},{id:6,level:4},{id:7,level:5},{id:8,level:6},{id:9,level:10},{id:10,level:20},{id:11,level:50},{id:12,level:100},{id:13,level:150},{id:14,level:200},{id:15,level:300},{id:16,level:500},{id:17,level:750},{id:18,level:1e3},{id:19,level:1500},{id:20,level:2e3}],cleverapps.MobileVk=function(){console.log("Choosing html5-VkConnect"),cc.sys.openURL=function(e){var t=document.createElement("a");t.setAttribute("target","_blank"),t.setAttribute("href",e),t.click()},
cleverapps.VK.call(this)},cleverapps.MobileVk.prototype=Object.create(cleverapps.VK.prototype),cleverapps.MobileVk.prototype.constructor=cleverapps.MobileVk,cleverapps.MobileVk.getPlatfrom=function(){return cleverapps.getRequestParameters().platform},cleverapps.MobileVk.prototype.init=function(t){var s=function(e){plugin.FacebookAgent=cleverapps.FakeFacebookAgent,"vkConnect"===e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR),t()},i=function(){var e=function(e,t){e===cleverapps.Social.CODE_SUCCEED&&(this.accessToken=t.access_token,this.scope=t.scope)}.bind(this);this.subscribe("VKWebAppAccessTokenReceived","VKWebAppAccessTokenFailed",e),vkConnect.send("VKWebAppGetAuthToken",{app_id:parseInt(cleverapps.config.vk.appId),scope:"friends"})}.bind(this),e=function(){vkConnect.isWebView()&&this.subscribe("VKWebAppInitResult","VKWebAppInitFailed",function(e){e===cleverapps.Social.CODE_SUCCEED?(t(),i()):s()}.bind(this)),vkConnect.send("VKWebAppInit",{}),
vkConnect.isWebView()||(t(),i())}.bind(this);cleverapps.loadSdk(cleverapps.config.staticUrl+"cleverapps/res/vk-connect.js",{onSuccess:e,onFailure:function(){s("vkConnect")}})},cleverapps.MobileVk.prototype.createShortcut=function(){},cleverapps.MobileVk.prototype.aboutMe=function(s){this.subscribe("VKWebAppGetUserInfoResult","VKWebAppGetUserInfoFailed",function(e,t){e===cleverapps.Social.CODE_SUCCEED&&s(cleverapps.VK.formatUserData(t))}),vkConnect.send("VKWebAppGetUserInfo",{})},cleverapps.MobileVk.prototype.subscribe=function(t,s,i){var n=function(e){cleverapps.config.debugMode&&cleverapps.RestClient.post("/applogs/"+cleverapps.user.id,{event:JSON.stringify(e),type:e.detail.type,error_type:e.detail.data.error_type,error_code:e.detail.data.error_data&&e.detail.data.error_data.error_code,error_reason:e.detail.data.error_data&&e.detail.data.error_data.error_reason,detailData:e.detail.data?JSON.stringify(e.detail.data):"none",accessToken:this.accessToken,scope:this.scope}),
e.detail.type===t&&(i(cleverapps.Social.CODE_SUCCEED,e.detail.data),vkConnect.unsubscribe(n)),e.detail.type===s&&(i(cleverapps.Social.CODE_FAILED,e.detail.data),vkConnect.unsubscribe(n))}.bind(this);vkConnect.subscribe(n)},cleverapps.MobileVk.prototype.showLeaderBoardBox=function(e,t){this.subscribe("VKWebAppShowLeaderBoardBoxResult","VKWebAppShowLeaderBoardBoxFailed",t),vkConnect.send("VKWebAppShowLeaderBoardBox",{user_result:e.userResult})},cleverapps.MobileVk.prototype.showOrderBox=function(e,t){this.subscribe("VKWebAppShowOrderBoxResult","VKWebAppShowOrderBoxFailed",t),vkConnect.send("VKWebAppShowOrderBox",{type:e.type,item:e.item})},cleverapps.MobileVk.prototype.inviteFriends=function(e,t){this.subscribe("VKWebAppShowInviteBoxResult","VKWebAppShowInviteBoxFailed",t),vkConnect.send("VKWebAppShowInviteBox",{})},cleverapps.MobileVk.prototype.requestToOne=function(e,t,s){(function(){this.subscribe("VKWebAppShowRequestBoxResult","VKWebAppShowRequestBoxFailed",s),
cleverapps.config.debugMode&&cleverapps.RestClient.post("/applogs/"+cleverapps.user.id,{method:"VKWebAppShowRequestBox",uid:parseInt(e),message:t.message}),vkConnect.send("VKWebAppShowRequestBox",{uid:parseInt(e),message:t.message,requestKey:"key"})}).bind(this)()},cleverapps.MobileVk.prototype.shareDialog=function(e,t){if(!e.vk)throw"No vk data to share!";this.subscribe("VKWebAppShowWallPostBoxResult","VKWebAppShowWallPostBoxFailed",t),vkConnect.send("VKWebAppShowWallPostBox",{message:e.description+"\n"+cleverapps.config.vk.url,attachments:e.vk+",https://vk.com/app"+cleverapps.config.vk.appId})},cleverapps.MobileVk.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.MobileVk.prototype.listFriendsByApp=function(n,o){var e=function(e,t){if(e===cleverapps.Social.CODE_SUCCEED)if(t&&t.response&&t.response.map){var s=t.response.map(cleverapps.VK.prepareId),i=function(e,t){e===cleverapps.Social.CODE_SUCCEED?o(cleverapps.Social.CODE_SUCCEED,
this.prepareFriendsData(t.response&&t.response.items,s,n)):o(cleverapps.Social.CODE_FAILED,[])}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",i),vkConnect.send("VKWebAppCallAPIMethod",{method:"friends.get",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,count:1e3,fields:"photo_200"}})}else o(cleverapps.Social.CODE_FAILED,[]);else o(cleverapps.Social.CODE_FAILED,[])}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",e),vkConnect.send("VKWebAppCallAPIMethod",{method:"friends.getAppUsers",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken}})},cleverapps.MobileVk.prototype.processPromo=function(s){cleverapps.eventLogger.logEvent("vk_promo_check");var e=function(e,t){e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.eventLogger.logEvent("vk_promo_response"),t&&1===t.response&&(this.givePromoReward(),vkConnect.send("VKWebAppCallAPIMethod",{method:"apps.promoUseGift",params:{
v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,promo_id:s}})))}.bind(this);this.subscribe("VKWebAppCallAPIMethodResult","VKWebAppCallAPIMethodFailed",e),vkConnect.send("VKWebAppCallAPIMethod",{method:"apps.promoHasActiveGift",params:{v:cleverapps.MobileVk.API_VERSION,access_token:this.accessToken,promo_id:s}})},cleverapps.MobileVk.isAppropriate=function(){return!cc.sys.isNative&&"mobile_vk"===cleverapps.User.calcSource()},cleverapps.MobileVk.API_VERSION="5.107",cleverapps.OK=function(){this instanceof cleverapps.MobileOK||console.log("Choosing html5-ok"),cleverapps.Social.call(this)},cleverapps.OK.prototype=Object.create(cleverapps.Social.prototype),cleverapps.OK.prototype.constructor=cleverapps.OK,cleverapps.OK.prototype.getLocalStoragePreffix=function(){return"_OK"},cleverapps.OK.prototype.updateSize=function(){this.listeners.getPageInfo=function(e,t){var s;try{s=JSON.parse(t).innerHeight}catch(e){
s=window&&window.innerHeight||document&&document.body&&document.body.clientHeight||800}var i=s-75;i<600&&(i=600),FAPI.UI.setWindowSize(760,i),cc.view.setFrameSize(cc.view.getFrameSize().width,i)}.bind(this),[0,5,10,20,60].forEach(function(e){setTimeout(FAPI.UI.getPageInfo,1e3*e)})},cleverapps.OK.prototype.init=function(e){var t=cleverapps.once(function(){window.API_callback=function(e,t,s){if(console.log("Received "+e,t,s),this.listeners[e]){var i=this.listeners[e];this.listeners[e]=void 0,i.call(this,t,s)}}.bind(this),this.updateSize(),e()}.bind(this));this.listeners={};var s=function(e){"undefined"==typeof FAPI&&(FAPI=cleverapps.FakeFAPI),t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//api.ok.ru/js/fapi5.js",{onSuccess:function(){var e=FAPI.Util.getRequestParameters();FAPI.init(e.api_server,e.apiconnection,t,s)},onFailure:s})},
cleverapps.OK.prototype.isLoggedIn=function(){return FAPI!==cleverapps.FakeFAPI},cleverapps.OK.prototype.setStatus=function(e,n){console.log("setStatus",e,n),FAPI.Client.call({method:"sdk.setStatus",event:e,status:n},function(e,t,s){console.log("sdk.setStatus response",JSON.stringify(arguments));var i="set_status_"+n+"_ok";e!==cleverapps.OK.CODE_SUCCEED&&(cleverapps.throwAsync("sdk.setStatus '"+n+"'error: "+JSON.stringify(s)),i="set_status_"+n+"_error"),cleverapps.eventLogger.logEvent(i)})},cleverapps.OK.prototype.getUserID=function(){return FAPI.Util.getRequestParameters().logged_user_id},cleverapps.OK.prototype.getAccessToken=function(){return"OK_"+FAPI.Util.getRequestParameters().session_key+"_"+FAPI.Util.getRequestParameters().auth_sig},cleverapps.OK.prototype.login=function(e){e()},cleverapps.OK.prototype.inviteFriends=function(e,s){this.listeners.showInvite=function(e,t){"noUsers"===t&&cleverapps.Notification.create("messages:inviteFriends.noUsers"),
e===cleverapps.OK.CODE_SUCCEED?s(cleverapps.Social.CODE_SUCCEED):s(cleverapps.Social.CODE_CANCELLED,t)},FullscreenControlButton.exitFullscreen(function(){FAPI.UI.showInvite(e.message)})},cleverapps.OK.prototype.request=function(e,s){"object"==typeof e.to&&(e.to=e.to.join(";")),this.listeners.showNotification=function(e,t){"error"!==e||"noUsers"!==t?e===cleverapps.OK.CODE_SUCCEED?(t=t.split(","),s(cleverapps.Social.CODE_SUCCEED,t)):s(cleverapps.Social.CODE_CANCELLED,t):s(cleverapps.Social.CODE_SUCCEED,[])},FullscreenControlButton.exitFullscreen(function(){FAPI.UI.showNotification(e.message,"",e.to)})},cleverapps.OK.prototype.shareDialog=function(e,s){var t=cleverapps.config.deployment+e.picture;0<=t.indexOf("?")&&(t=t.substr(0,t.indexOf("?")));var i=[{type:"app",text:e.description,images:[{url:t,title:e.name}],actions:[{text:e.name,mark:e.name}]}];this.listeners.postMediatopic=function(e,t){e===cleverapps.OK.CODE_SUCCEED?s(cleverapps.Social.CODE_SUCCEED):s(
cleverapps.Social.CODE_CANCELLED,t)},FullscreenControlButton.exitFullscreen(function(){FAPI.UI.postMediatopic({media:i},!0)})},cleverapps.OK.prototype.loadFriendsPerPage=function(e,t){e=e.slice(0,1e3);for(var s=[],i=0;i<e.length;i+=100)s.push(e.slice(i,i+100));var n=s.length,o=[],r=function(e){e!==cleverapps.Social.CODE_CANCELLED&&(o=o.concat(e)),0===--n&&t(cleverapps.Social.CODE_SUCCEED,o)};s.forEach(function(e){this.aboutUser(e,r,r)}.bind(this))},cleverapps.OK.prototype.listFriends=function(n){FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,s){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list friends error: "+s),void n(cleverapps.Social.CODE_CANCELLED);var i=t.uids;cleverapps.social.loadFriendsPerPage(i,n)})},cleverapps.OK.prototype.listInvitableFriends=function(o){FAPI.Client.call({method:"friends.get",sort_type:"PRESENT"},function(e,t,s){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list ivitable friends error: "+s),void o(
cleverapps.Social.CODE_CANCELLED);var n=t;FAPI.Client.call({method:"friends.getAppUsers"},function(e,t,s){if(e!==cleverapps.OK.CODE_SUCCEED)return console.log("list friends error: "+s),void o(cleverapps.Social.CODE_CANCELLED);var i=t.uids;cleverapps.social.loadFriendsPerPage(cleverapps.substract(n,i),o)})})},cleverapps.OK.formatUserData=function(e){return-1!==e.pic128x128.indexOf("stub_128x128.gif")&&(e.pic128x128=""),-1!==e.pic128x128.indexOf("stub/user")&&(e.pic128x128=""),{id:e.uid,name:e.first_name+" "+e.last_name,first_name:e.first_name,picture:{data:{url:e.pic128x128}}}},cleverapps.OK.prototype.aboutUser=function(e,n,o){var r=!Array.isArray(e);r||(e=e.join(",")),FAPI.Client.call({uids:e,fields:"first_name,last_name,uid,pic128x128",method:"users.getInfo"},function(e,t,s){if(e===cleverapps.OK.CODE_SUCCEED){var i=t.map(function(e){return cleverapps.OK.formatUserData(e)});n(r?i[0]:i)}else o&&o(cleverapps.Social.CODE_CANCELLED,s)})},cleverapps.OK.prototype.aboutMe=function(e){
this.aboutUser(this.getUserID(),e)},cleverapps.OK.prototype.logEvent=function(e,t){},cleverapps.OK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.OK.isAppropriate=function(){return!cc.sys.isNative&&"web_ok"===cleverapps.User.calcSource()},cleverapps.OK.CODE_SUCCEED="ok",cleverapps.FakeFAPI={UI:{getPageInfo:function(){},showInvite:function(){},showNotification:function(){},postMediatopic:function(){},setWindowSize:function(){},showPayment:function(){}},invokeUIMethod:function(){},Util:{getRequestParameters:function(){return{}}},Client:{call:function(){}}},cleverapps.MobileOK=function(){console.log("Choosing mobile-ok"),cleverapps.OK.call(this),this.isFullScreen=!1,cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){this.isFullScreen=!1}.bind(this)),this.isInApp()&&(cleverapps.Promotion.prototype.isReady=function(){return!1})},cleverapps.MobileOK.prototype=Object.create(cleverapps.OK.prototype),
cleverapps.MobileOK.prototype.constructor=cleverapps.MobileOK,cleverapps.MobileOK.prototype.updateSize=function(){},cleverapps.MobileOK.prototype.createShortcut=function(){"undefined"!=typeof OKApp&&"function"==typeof OKApp.suggestDesktopIcon&&OKApp.suggestDesktopIcon()},cleverapps.MobileOK.prototype.isInApp=function(){var e=window&&window.navigator&&window.navigator.userAgent;return!!(e&&0<=e.indexOf("OkApp"))},cleverapps.MobileOK.isAppropriate=function(){return!cc.sys.isNative&&"mobile_ok"===cleverapps.User.calcSource()},cleverapps.MobileOK.prototype.isFullScreenAvailable=function(){return this.isInitialized()&&!this.isInApp()&&cc.sys.os===cc.sys.OS_ANDROID},cleverapps.MobileOK.prototype.requestFullScreen=function(s){s=s||function(){},this.isFullScreenAvailable()&&!this.isFullScreen?(this.listeners.requestFullscreen=cleverapps.once(function(e,t){"ok"===e?cleverapps.whenResolutionStable(function(){s(),this.isFullScreen=!0}.bind(this)):s()}.bind(this)),FAPI.invokeUIMethod(
"requestFullscreen")):s()},cleverapps.MyMailRu=function(){this instanceof cleverapps.MobileMyMailRu||console.log("Choosing html5-MyMailRu"),cleverapps.UI.SOCIAL_CLICK_THROTTLE=3e3,cleverapps.Social.call(this)},cleverapps.MyMailRu.prototype=Object.create(cleverapps.Social.prototype),cleverapps.MyMailRu.prototype.constructor=cleverapps.MyMailRu,cleverapps.MyMailRu.prototype.getLocalStoragePreffix=function(){return"_MM"},cleverapps.MyMailRu.prototype.init=function(t){this.listeners={friendsInvitation:function(){},friendsRequest:function(){},streamPublish:function(){}};var s=cleverapps.once(function(){if(this instanceof cleverapps.MobileMyMailRu)this.createHeaderAndFooter(t);else{if("undefined"!=typeof window&&window.outerHeight&&window.innerHeight){var e=window.outerHeight-250;mailru.app.utils.setHeight(e),cc.view.setFrameSize(window.innerWidth,e)}mailru.events.listen(mailru.app.events.friendsInvitation,function(e){this.listeners.friendsInvitation(e)}.bind(this)),mailru.events.listen(
mailru.app.events.friendsRequest,function(e){this.listeners.friendsRequest(e)}.bind(this)),mailru.events.listen(mailru.common.events.streamPublish,function(e){this.listeners.streamPublish(e)}.bind(this)),mailru.events.listen(mailru.app.events.readHash,function(e){e&&e.channel&&levels.user.setChannel(e.channel)}),mailru.app.utils.hash.read(),setTimeout(t,300)}}.bind(this)),e=function(e){"undefined"==typeof mailru&&(mailru=cleverapps.FakeMailRU),s(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this);cleverapps.loadSdk("//connect.mail.ru/js/loader.js",{onSuccess:function(){mailru.loader.require("api",function(){mailru.app.init(cleverapps.config.myMailRu.privateKey),s()})},onFailure:e})},cleverapps.MyMailRu.prototype.getRequestParameters=function(){var e={},t=window.location.search;if(t)for(var s=(t=t.substr(1)).split("&"),i=0;i<s.length;i++){var n=s[i].split("="),o=n[0],
r=n[1];r=decodeURIComponent(r.replace(/\+/g," ")),e[o]=r}return e},cleverapps.MyMailRu.prototype.isLoggedIn=function(){return!0},cleverapps.MyMailRu.prototype.getUserID=function(){return this.getRequestParameters().vid},cleverapps.MyMailRu.prototype.getAccessToken=function(){var e=[],t=this.getRequestParameters();for(var s in t)"sig"!==s&&e.push(s);e.sort();for(var i="",n=0;n<e.length;n++)i+=e[n]+"="+t[e[n]];return"MM_"+t.sig+"_"+i},cleverapps.MyMailRu.prototype.login=function(e){e()},cleverapps.MyMailRu.prototype.inviteFriends=function(e,t){this.listeners.friendsInvitation=function(e){"opened"!==e.status&&t(e.data&&e.data.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},FullscreenControlButton.exitFullscreen(function(){mailru.app.friends.invite({text:e.message})})},cleverapps.MyMailRu.prototype.request=function(e,t){this.listeners.friendsRequest=function(e){"opened"!==e.status&&(e.data&&e.data.length?t(cleverapps.Social.CODE_SUCCEED,e.data):t(
cleverapps.Social.CODE_CANCELLED))},FullscreenControlButton.exitFullscreen(function(){mailru.app.friends.request({text:e.message,image_url:cleverapps.config.deployment+cleverapps.ShareBonus.cycleShareData("share").picture,friends:e.to})})},cleverapps.MyMailRu.prototype.shareDialog=function(e,t){this.listeners.streamPublish=function(e){"opened"!==e.status&&("publishSuccess"===e.status?t(cleverapps.Social.CODE_SUCCEED):(console.log(e.status),t(cleverapps.Social.CODE_CANCELLED)))};var s={title:e.name,text:e.description,img_url:cleverapps.config.deployment+e.picture};FullscreenControlButton.exitFullscreen(function(){mailru.common.stream.post(s)})},cleverapps.MyMailRu.prototype.listFriends=function(i){mailru.common.friends.getAppUsers(function(e){for(var t=[],s=0;s<e.length;s++)t.push(cleverapps.MyMailRu.formatUserData(e[s]));i(cleverapps.Social.CODE_SUCCEED,t)},!0)},cleverapps.MyMailRu.prototype.listInvitableFriends=function(i){mailru.common.friends.getExtended(function(e){for(var t=[],
s=0;s<e.length;s++)e[s].app_installed||t.push(cleverapps.MyMailRu.formatUserData(e[s]));i(cleverapps.Social.CODE_SUCCEED,t)})},cleverapps.MyMailRu.formatUserData=function(e){return{id:e.uid,name:e.first_name+" "+e.last_name,first_name:e.first_name,picture:{data:{url:e.pic_128}}}},cleverapps.MyMailRu.prototype.aboutUser=function(e,s,i){var n=!Array.isArray(e);mailru.common.users.getInfo(function(e){if(e.error)i&&i(cleverapps.Social.CODE_FAILED,e.error);else{e&&"function"==typeof e.map||cleverapps.throwAsync("MailRU aboutUser response - "+JSON.stringify(e));var t=e.map(function(e){return cleverapps.MyMailRu.formatUserData(e)});s(n?t[0]:t)}},e)},cleverapps.MyMailRu.prototype.aboutMe=function(e){this.aboutUser(this.getUserID(),e)},cleverapps.MyMailRu.prototype.logEvent=function(e,t){},cleverapps.MyMailRu.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.MyMailRu.isAppropriate=function(){return!cc.sys.isNative&&"web_mm"===cleverapps.User.calcSource()},
cleverapps.FakeMailRU={events:{listen:function(){}},app:{friends:{invite:function(){},request:function(){}},utils:{setHeight:function(){},hash:{read:function(){}}},events:{},init:function(){}},common:{stream:{post:function(){}},friends:{getAppUsers:function(){},getExtended:function(){}},users:{getInfo:function(){}},events:{}},loader:{require:function(){}}},cleverapps.MobileMyMailRu=function(){console.log("Choosing mobile-MyMailRu"),cleverapps.MyMailRu.call(this)},cleverapps.MobileMyMailRu.prototype=Object.create(cleverapps.MyMailRu.prototype),cleverapps.MobileMyMailRu.prototype.constructor=cleverapps.MobileMyMailRu,cleverapps.MobileMyMailRu.prototype.createHeaderAndFooter=function(i){var e=this.getRequestParameters();mailru.callhf=function(e){var t=document.createElement("div");t.innerHTML=e.header,document.body.insertBefore(t,document.body.firstChild);var s=document.createElement("div");s.style.position="absolute",s.style.top=window.innerHeight-27+"px",s.style.left="0px",
s.style.height="27px",s.style.width="100%",s.style.zIndex="-1",s.innerHTML=e.footer,document.body.appendChild(s),cleverapps.canvasTop="43px",cleverapps.decCanvasHeight=70,cleverapps.setupDesignResolution(),i()};var t={method:"mobile.getCanvas",app_id:e.app_id,cb:"mailru.callhf",session_key:e.session_key,mobile_spec:e.mobile_spec};t=mailru.utils.sign(t),mailru.utils.apiOverJSONP(t,"https://appsmail.ru/platform/api")},cleverapps.MobileMyMailRu.prototype.inviteFriends=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.prototype.request=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.prototype.shareDialog=function(e,t){cleverapps.Notification.create("messages:mobileNotAvailable"),t(cleverapps.Social.CODE_CANCELLED)},cleverapps.MobileMyMailRu.isAppropriate=function(){
return!cc.sys.isNative&&"mobile_mm"===cleverapps.User.calcSource()},cleverapps.Mobage=function(){this instanceof cleverapps.SPMobage||console.log("Choosing html5-mobage"),cleverapps.Social.call(this),this.increaseViralBonuses()},cleverapps.Mobage.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Mobage.prototype.constructor=cleverapps.Mobage,cleverapps.Mobage.prototype.increaseViralBonuses=function(){HelpFromFriendsWindow.TYPES.addmoves.amount=5,BountyManager.PRIZES.forEach(function(e){e.amount*=2})},cleverapps.Mobage.prototype.getLocalStoragePreffix=function(){return"_mbga"},cleverapps.Mobage.HEIGHT=860,cleverapps.Mobage.prototype.init=function(i){cleverapps.once(function(){gadgets.window.adjustHeight(cleverapps.Mobage.HEIGHT);var e=opensocial.newDataRequest();e.add(e.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"viewer"),e.send(function(e){if(e.hadError());else{var t=e.get("viewer");if(t.hadError());else{var s=t.getData()
;this.user=cleverapps.Mobage.formatUserData(s),console.log(this.user),i()}}}.bind(this))}.bind(this))()},cleverapps.Mobage.prototype.isLoggedIn=function(){return!0},cleverapps.Mobage.prototype.getUserID=function(){return this.user.id},cleverapps.Mobage.prototype.getAccessToken=function(){return"mbga"},cleverapps.Mobage.prototype.login=function(e){e()},cleverapps.Mobage.prototype.sendActivity=function(e,t){var s=cleverapps.Social.ACTIVITIES_CONFIG[e];if(s.probability>Math.random()){var i=cleverapps.Random.mathChoose(s.messages),n={};n[opensocial.Activity.Field.TITLE]=Messages.get(i.title),n[opensocial.Activity.Field.BODY]=Messages.get(i.body,t);var o=opensocial.newActivity(n);opensocial.requestCreateActivity(o,opensocial.CreateActivityPriority.LOW,function(e){e.hadError()})}},cleverapps.Mobage.prototype.inviteFriends=function(e,t){var s={};s[opensocial.Message.Field.TITLE]=e.title;var i=opensocial.newMessage(e.message,s);FullscreenControlButton.exitFullscreen(function(){
opensocial.requestShareApp("VIEWER_FRIENDS",i,function(e){e.hadError()?t(cleverapps.Social.CODE_CANCELLED,e):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.Mobage.prototype.requestToOne=function(e,t,s){var i={};i[opensocial.Message.Field.TITLE]=t.title;var n=t.message,o=opensocial.newMessage(n,i),r=e;FullscreenControlButton.exitFullscreen(function(){opensocial.requestSendMessage(r,o,function(e){if(e.hadError())s(cleverapps.Social.CODE_CANCELLED);else{var t=e.getData();t.recipientIds&&0<t.recipientIds.length?s(cleverapps.Social.CODE_SUCCEED):s(cleverapps.Social.CODE_CANCELLED)}})})},cleverapps.Mobage.prototype.request=function(e,s){var i=e.to;Array.isArray(i)||(i=[i]);var n=[],o=function(t){t===i.length?s(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(i[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(i[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},cleverapps.Mobage.prototype.shareDialog=function(e,s){
var t=cleverapps.config.deployment+e.picture;0<=t.indexOf("?")&&(t=t.substr(0,t.indexOf("?")));var i=opensocial.newMediaItem("image/jpg",t);i.setField(opensocial.MediaItem.Field.TYPE,opensocial.MediaItem.Type.IMAGE);var n={};n[mbga.Diary.Field.TITLE]=e.name,n[mbga.Diary.Field.CONTENT]=e.description,n[mbga.Diary.Field.MEDIA_ITEMS]=[i];var o=mbga.newCreateDiary(n);FullscreenControlButton.exitFullscreen(function(){mbga.requestCreateDiary(o,function(e){if(e.hadError())s(cleverapps.Social.CODE_FAILED,e);else{var t=e.getData().getEntryURL();console.log(t),s(t?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)}})})},cleverapps.Mobage.prototype.listFriendsByApp=function(s,i){var e={};e[opensocial.DataRequest.PeopleRequestFields.MAX]=1e3,e[opensocial.DataRequest.PeopleRequestFields.PROFILE_DETAILS]=[opensocial.Person.Field.HAS_APP];var t={};t[opensocial.IdSpec.Field.USER_ID]=opensocial.IdSpec.PersonId.VIEWER,t[opensocial.IdSpec.Field.GROUP_ID]=opensocial.IdSpec.GroupId.FRIENDS
;var n=opensocial.newIdSpec(t),o=opensocial.newDataRequest();o.add(o.newFetchPeopleRequest(n,e),"friends"),o.send(function(e){if(e.hadError())i(cleverapps.Social.CODE_FAILED);else{var t=e.get("friends").getData().asArray();t=t.filter(function(e){return e.getField(opensocial.Person.Field.HAS_APP)===s}),i(cleverapps.Social.CODE_SUCCEED,t.map(cleverapps.Mobage.formatUserData))}})},cleverapps.Mobage.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.Mobage.prototype.listInvitableFriends=function(e){this.listFriendsByApp(!1,e)},cleverapps.Mobage.formatUserData=function(e){var t="",s={id:e.getId(),name:e.getDisplayName(),first_name:e.getDisplayName()};try{return t=cleverapps.Mobage.proxyAvatar(e.getField(opensocial.Person.Field.THUMBNAIL_URL)),s.picture={data:{url:t}},s}catch(e){if(e instanceof TypeError||e.message&&-1!==e.message.indexOf("of null")){var i=e.message+" avatarUrl - "+t+" reqUserId - "+s.id+" reqUserName - "+s.name+" stack - "+JSON.stringify(e.stack)
;throw new Error(i)}throw e}},cleverapps.Mobage.proxyAvatar=function(e){return cleverapps.config.deployment.replace("https","http")+"/proxy"+e.match(/.*profile(.*)/)[1]},cleverapps.Mobage.prototype.aboutMe=function(e){e(this.user)},cleverapps.Mobage.prototype.logEvent=function(e,t){},cleverapps.Mobage.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_JAPANESE]},cleverapps.Mobage.isAppropriate=function(){return!cc.sys.isNative&&"mbga"===cleverapps.User.calcSource()},cleverapps.Mobage.CODE_SUCCEED="ok",cleverapps.SPMobage=function(){console.log("Choosing sp-mobage"),cleverapps.Mobage.call(this),this.clientData=cleverapps.SPMobage.CLIEND_DATA;var e=cleverapps.config.deployment.replace("https","http");this.clientData.redirectUrl=e+"/publish/html5"+(cleverapps.config.debugMode?"-staging":"")+"/index.html"},cleverapps.SPMobage.prototype=Object.create(cleverapps.Mobage.prototype),cleverapps.SPMobage.prototype.constructor=cleverapps.SPMobage,
cleverapps.SPMobage.prototype.getLocalStoragePreffix=function(){return"_sp_mbga"},cleverapps.SPMobage.prototype.needTokenRefresh=function(){return!this.clientData.token||!this.clientData.token.expireTime||this.clientData.token.expireTime<=Date.now()},cleverapps.SPMobage.prototype.checkAccessToken=function(i){i=i||function(){};var e=function(e){var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(s+"="+e[s]);cleverapps.RestClient.get(e.path+"?"+t.join("&"),{},function(e){this.clientData.token.accessToken=e.accessToken,this.clientData.token.refreshToken=e.refreshToken,this.clientData.token.expireTime=Date.now()+1e3*e.expiresIn,i()}.bind(this))}.bind(this),t={redirect_uri:this.clientData.redirectUrl};this.clientData.token?this.needTokenRefresh()?(t.path="/spmbgatoken/refresh",t.refresh_token=this.clientData.token.refreshToken,e(t)):i():(this.clientData.token={},t.path="/spmbgatoken/get",t.code=this.clientData.code,e(t))},cleverapps.SPMobage.prototype.init=function(t){this.loggedIn=!1
;var e=function(){AddSPMobageFooter(),this.checkLoginStatus(t),setInterval(this.periodicCheck.bind(this),cleverapps.parseInterval(cleverapps.SPMobage.CHECK_STATUS_INTERVAL))}.bind(this),s=function(e){"undefined"==typeof mobage&&(mobage=cleverapps.FakeSPMobage),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR),t()}.bind(this),i=cleverapps.config.debugMode?cleverapps.SPMobage.MOBAGE_API.SANDBOX:cleverapps.SPMobage.MOBAGE_API.PRODUCTION;cleverapps.loadSdk(i,{onFailure:s}),document.addEventListener("mobageReady",function(){try{mobage.init({clientId:this.clientData.clientId,redirectUri:this.clientData.redirectUrl}),e()}catch(e){console.log("Mobage init fail",e),s()}}.bind(this))},cleverapps.SPMobage.prototype.getPlayerInfo=function(s){mobage.api.people.get({userId:"@me",groupId:"@self",fields:["id","displayName","thumbnailUrl"]},function(e,t){e?console.log("Failed requesting user info"
,e):this.user=cleverapps.SPMobage.formatUserData(t),s()}.bind(this))},cleverapps.SPMobage.prototype.login=function(e,t){e()},cleverapps.SPMobage.prototype.checkLoginStatus=function(t){t=t||function(){};var s=function(){this.loggedIn=!0,this.getPlayerInfo(t)}.bind(this);try{mobage.oauth.getConnectedStatus({state:this.clientData.state},function(e,t){e?(this.clientData.platformLogin=e.login,this.clientData.connected=e.connected,this.processAutoLogin(s)):(this.clientData.platformLogin=!0,this.clientData.connected=!0,this.clientData.code=t.response.code,s())}.bind(this))}catch(e){console.log("Get connect status error",e),t()}},cleverapps.SPMobage.prototype.periodicCheck=function(){if(!this.checkInProcess){this.checkInProcess=!0;try{mobage.oauth.getConnectedStatus({state:this.clientData.state},function(e,t){this.checkInProcess=!1,t&&(this.clientData.code=t.response.code,this.checkAccessToken())}.bind(this))}catch(e){this.checkInProcess=!1,console.log("Get connect status error",e)}}},
cleverapps.SPMobage.prototype.processAutoLogin=function(i){var n=ResourceProcessor.calcProbablyNeed(),o=setInterval(function(){if(cleverapps.bundleLoader.isLoaded(n)){clearInterval(o);var t=this.createAutoLoginScreen(i),e=cc.director.getRunningScene().onChangeSize;if(e){var s=t.createListener(function(){var e=cc.director.getWinSize();t.setContentSize2(e),t.buttonNode.setPositionRound(e.width/2,e.height/2)}.bind(this));cc.director.getRunningScene().onChangeSize=function(){e.apply(cc.director.getRunningScene(),arguments),s()}}}}.bind(this),300)},cleverapps.SPMobage.prototype.createAutoLoginScreen=function(e){var t=cc.director.getWinSize(),s=new cc.LayerColor(cleverapps.styles.COLORS.WHITE,t.width,t.height);cc.director.getRunningScene().addChild(s,9999);var i=s.buttonNode=new SpPlatformButtons(t.width,function(){s.removeFromParent(),e()});return s.addChild(i),i.setPositionRound(t.width/2,t.height/2),s},cleverapps.SPMobage.prototype.isLoggedIn=function(){return this.loggedIn},
cleverapps.SPMobage.formatUserData=function(e){return{id:e.id,name:e.displayName,first_name:e.displayName,picture:{data:{url:cleverapps.SPMobage.proxyAvatar(e.thumbnailUrl)}}}},cleverapps.SPMobage.proxyAvatar=function(e){return cleverapps.config.deployment.replace("https","http")+"/proxy/sp"+e.match(/.*img_u(.*)/)[1]},cleverapps.SPMobage.prototype.listFriendsByApp=function(i,n){mobage.api.people.get({userId:"@me",groupId:"@friends",fields:["id","displayName","thumbnailUrl","hasApp"]},function(e,t){if(e)console.log("Failed fetching friends",e),n(cleverapps.Social.CODE_FAILED);else{var s=t.entry;s=s.filter(function(e){return e.hasApp===i}),n(cleverapps.Social.CODE_SUCCEED,s.map(cleverapps.SPMobage.formatUserData))}})},cleverapps.SPMobage.prototype.inviteFriends=function(e,s){mobage.ui.open("invitation",{},function(e,t){e?s(cleverapps.Social.CODE_CANCELLED,e):"mobage"===t.response.result.channel&&s(cleverapps.Social.CODE_SUCCEED)})},cleverapps.SPMobage.prototype.request=function(e,t){t(
cleverapps.Social.CODE_SUCCEED)},cleverapps.SPMobage.prototype.shareDialog=function(e,t){t(cleverapps.Social.CODE_SUCCEED)},cleverapps.SPMobage.prototype.sendActivity=function(e,t){},cleverapps.SPMobage.isAppropriate=function(){return!cc.sys.isNative&&"sp_mbga"===cleverapps.User.calcSource()},cleverapps.SPMobage.MOBAGE_API={SANDBOX:"https://cdn-sb-connect.mobage.jp/jssdk/mobage-jssdk-client.3.9.1.min.js",PRODUCTION:"https://cdn-connect.mobage.jp/jssdk/mobage-jssdk-client.3.9.1.min.js"},cleverapps.SPMobage.CLIEND_DATA={clientId:cleverapps.config.sp_mbga&&cleverapps.config.sp_mbga.url,state:"mobage-connect_"+Math.random().toString(36).slice(-16),code:null,connected:!1,platformLogin:!1},cleverapps.SPMobage.CHECK_STATUS_INTERVAL="10 minutes",cleverapps.FakeSPMobage={ui:{open:function(){},show:function(){}},event:{subscribe:function(){},unsubscribe:function(){}},oauth:{connect:function(){},getConnectedStatus:function(){}},api:{people:{get:function(){}}}},cleverapps.overrideFonts(
cleverapps.styles.FONTS,{BLUE_LINK_TEXT:{size:30,color:new cc.Color(62,158,254)},BLACK_LINK_TEXT:{size:30,color:cleverapps.styles.COLORS.BLACK}});var AddSPMobageFooter=function(){var e=document.createElement("div");e.style.position="absolute",e.style.zIndex="2",e.style.bottom="0",e.style.height="27px",e.style.width="100%",e.style.background="#e3e3e3",e.style.display="table",e.innerHTML=AddSPMobageFooter.getContentHtml(),document.body.appendChild(e),cleverapps.decCanvasHeight=27,cleverapps.setupDesignResolution()};AddSPMobageFooter.getContentHtml=function(){var e="style='display: table-cell;\nwidth: 25%;\ntext-align: center;\nvertical-align: middle;\nborder-right: 1px solid #5f5f5f;\nfont-size: 80%;\ncolor: #5f5f5f;\nline-height: normal;\nfont-weight: bold;'"
;return"<div "+e+" onclick='mobage.ui.show(\"portal\", {});'>Mobage</div><div "+e+" onclick='mobage.ui.show(\"inquiry\", {});'>お問い合わせ</div><div "+e+" onclick='mobage.ui.open(\"client_configuration\", {}, function() {});'>設定変更</div><div "+e+" onclick='mobage.ui.show(\"commercial_transaction\");'>特定商取引法</div>"};var SpPlatformButtons=cleverapps.Layout.extend({ctor:function(e,t){this.buttonWidth=e,this.callback=t,this._super(this.createItems(),{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.SpPlatformButtons.buttonsMargin})},createItems:function(){return-1===SpPlatformButtons.EASY_REGISTRATION_UNAVAILABLE.indexOf(cleverapps.config.name)?this.createNewFormItems():this.createOldFormItems()},createNewFormItems:function(){var e=[];return cleverapps.social.clientData.platformLogin?e.push(this.createOneButton("ゲームを始める",this.createLink("同意事項等（必読)"))):(e.push(this.createOneButton("モバゲーIDで始める",this.createLink("同意事項等（必読)"))),e.push(this.createOneButton("新規かんたん会員で始める",this.createLink(
"会員規約等（必読)",!0),!0))),e},createOldFormItems:function(){var e=[];cleverapps.social.clientData.platformLogin?e.push(this.createOneButton("インストール")):e.push(this.createOneButton("ログイン"));var t="ゲームをスタートするには"+(cleverapps.social.clientData.platformLogin?"ゲームをインストール":"ログイン")+"してください。",s=cleverapps.UI.generateOnlyText(t,cleverapps.styles.FONTS.BLACK_LINK_TEXT);return s.setDimensions(Math.min(cleverapps.styles.SpPlatformButtons.maxTextWidth,.7*cc.director.getWinSize().width),0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.push(s),e},createOneButton:function(e,t,s){var i=function(e,t){e?console.log("Authorization failed:",e):(cleverapps.social.clientData.platformLogin=!0,cleverapps.social.clientData.connected=!0,cleverapps.social.clientData.code=t.response.code,cleverapps.social.checkAccessToken(),this.callback())}.bind(this),n=[new cleverapps.UI.Button({text:e,maxWidth:.8*this.buttonWidth,onClicked:function(){var e={state:cleverapps.social.clientData.state};s&&(e.easyRegistration=!0,
e.requestType="window"),mobage.oauth.connect(e,i)}}),t].filter(function(e){return e});return new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.SpPlatformButtons.linkMargin})},createLink:function(e,t){var s=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.BLUE_LINK_TEXT),i=cleverapps.UI.generateOnlyText(" に同意して",cleverapps.styles.FONTS.BLACK_LINK_TEXT),n=new cleverapps.Layout([s,i],{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.SpPlatformButtons.textMargin});return cleverapps.UI.applyHover(n),cleverapps.UI.onClick(n,function(){t?mobage.ui.show("client_agreement_menu",{isEasyRegistration:!0}):mobage.ui.show("client_agreement_menu")}),n}});SpPlatformButtons.EASY_REGISTRATION_UNAVAILABLE=["riddles","heroes","tripeaks","crocword","runes"],cleverapps.styles.SpPlatformButtons={buttonsMargin:50,linkMargin:10,textMargin:5,maxTextWidth:600},cleverapps.Xsolla=function(){console.log("Choosing Xsolla"),this.accessToken=void 0,this.user=void 0,
cleverapps.Social.call(this)},cleverapps.Xsolla.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Xsolla.prototype.constructor=cleverapps.Xsolla,cleverapps.Xsolla.prototype.init=function(e){var t,s,i,n,o;cleverapps.config.debugMode||(t=window,s=document,t.fbq||(i=t.fbq=function(){i.callMethod?i.callMethod.apply(i,arguments):i.queue.push(arguments)},t._fbq||(t._fbq=i),(i.push=i).loaded=!0,i.version="2.0",i.queue=[],(n=s.createElement("script")).async=!0,n.src="https://connect.facebook.net/en_US/fbevents.js",(o=s.getElementsByTagName("script")[0]).parentNode.insertBefore(n,o)),fbq("init",cleverapps.config.fbPixelId),fbq("track","PageView"));var r=document.createElement("div");r.id="xsollaLoginLayout",r.style.width="100%",r.style.height="100%",r.style.left="0px",r.style.top="0px",r.style.position="absolute",r.style.backgroundColor="#00000050",r.style.zIndex="1000000000",r.style.visibility="hidden",document.body.appendChild(r),this.accessToken=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.XSOLLA_ACCESS_TOKEN),this.accessToken?this.loadUser(e,function(){this.accessToken=void 0,cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.XSOLLA_ACCESS_TOKEN),e()}):e()},cleverapps.Xsolla.prototype.loadUser=function(t,e){cleverapps.RestClient.get("https://login.xsolla.com/api/users/me",{},function(e){this.user=e,t()}.bind(this),e,{authorization:"Bearer "+this.accessToken})},cleverapps.Xsolla.prototype.needWindowForLogin=function(){return!0},cleverapps.Xsolla.prototype.login=function(t,s){var e,i,n=function(){window.removeEventListener("message",e,!1),document.getElementById("xsollaLoginLayout").style.visibility="hidden",clearInterval(i)};e=function(e){e.origin===location.origin&&(this.accessToken=e.data,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.XSOLLA_ACCESS_TOKEN,this.accessToken),n(),this.loadUser(function(){cleverapps.SocialManager.onLogin(),t()},s))}.bind(this);var o=Math.max(800,.5*screen.width),r=Math.max(600,.6*screen.height),a=(
screen.width-o)/2,c=(screen.height-r)/2,l=location.href;l=l.substr(0,l.lastIndexOf("/")+1)+"xsolla-login.html";var p=window.open(l,"popup","toolbar=no, location=no, directories=no, status=no, menubar=no, copyhistory=no, width="+o+", height="+r+", top="+c+", left="+a);p?(window.addEventListener("message",e,!1),document.getElementById("xsollaLoginLayout").style.visibility="visible",i=setInterval(function(){p.closed&&(n(),s())},100)):s()},cleverapps.Xsolla.prototype.getUserID=function(){return this.user?this.user.id:void 0},cleverapps.Xsolla.prototype.isLoggedIn=function(){return this.user},cleverapps.Xsolla.prototype.getAccessToken=function(){return"XS_"+(this.accessToken||0)},cleverapps.Xsolla.prototype.aboutMe=function(t){cleverapps.RestClient.get("https://login.xsolla.com/api/users/me/social_providers",{},function(e){e&&0<e.length?(e=e[0],t({id:this.getUserID(),name:e.full_name,first_name:e.nickname,picture:{data:{url:e.picture}}})):console.log("Error: "+JSON.stringify(e))}.bind(this)
,function(){console.log("Failed loading aboutMe")},{authorization:"Bearer "+this.accessToken})},cleverapps.Xsolla.prototype.getLocalStoragePreffix=function(){return"_xsolla"},cleverapps.Xsolla.isAppropriate=function(){return"xsolla"===cleverapps.User.calcSource()},cleverapps.Html5=function(){console.log("Choosing html5-facebook"),cleverapps.BaseFB.call(this),this.loginPlacement=!0},cleverapps.Html5.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.Html5.prototype.constructor=cleverapps.Html5,cleverapps.Html5.prototype.init=function(e){var t,s,i=cleverapps.once(function(){setTimeout(e,500),void 0!==s&&(clearInterval(s),s=void 0),void 0!==t&&(clearTimeout(t),t=void 0),cleverapps.social.deleteAllRequests()}),n=function(e){plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()&&void 0!==plugin.FacebookAgent.getInstance()._isLoggedIn?i():(plugin.FacebookAgent=cleverapps.FakeFacebookAgent,i(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT
):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR))}.bind(this);cleverapps.loadSdk("//connect.facebook.net/en_US/sdk.js",{onSuccess:function(){t=setTimeout(function(){n("timeout")},9e4)},onFailure:n}),window.fbAsyncInit=function(){plugin.FacebookAgent||(cleverapps.StartFacebook(),s=setInterval(function(){plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()&&void 0!==plugin.FacebookAgent.getInstance()._isLoggedIn&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FACEBOOK_INITED),i())},50))}},cleverapps.Html5.prototype.isLoggedIn=function(){return this.initialized&&plugin.FacebookAgent.getInstance().isLoggedIn()},cleverapps.Html5.prototype.getUserID=function(){return plugin.FacebookAgent.getInstance().getUserID()},cleverapps.Html5.prototype.getAccessToken=function(){return plugin.FacebookAgent.getInstance().getAccessToken()},cleverapps.Html5.prototype.login=function(t,s){if(!this.isInitialized())return cleverapps.Notification.create(
"messages:SocialManager.Initialization"),void(s&&s());FullscreenControlButton.exitFullscreen(function(){plugin.FacebookAgent.getInstance().login(cleverapps.BaseFB.PERMISSIONS,function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),t()):(cleverapps.SocialManager.onFailedLogin(),s&&s())})})},cleverapps.Html5.prototype.inviteFriends=function(e,t){this.request(e,t)},cleverapps.Html5.prototype.request=function(e,t){delete e.element,"object"==typeof e.to&&(e.to=e.to.join(",")),FullscreenControlButton.exitFullscreen(function(){plugin.FacebookAgent.getInstance().appRequest(e,t)})},cleverapps.Html5.prototype.shareDialog=function(e,t){var s=this.getShareDialogLink(e);console.log("share link",s);var i={dialog:"feedDialog",link:s,caption:Messages.get(cleverapps.config.title)};FullscreenControlButton.exitFullscreen(function(){plugin.FacebookAgent.getInstance().dialog(i,t)})},cleverapps.Html5.prototype.api=function(e,t,s,i){if("function"==typeof(s=s||{})&&(i=s,s={}),
!this.isLoggedIn())return console.log("Not logged in!"),void(i&&i(cleverapps.Social.CODE_CANCELLED));void 0===t?(t=plugin.FacebookAgent.HttpMethod.GET,i=function(){}):"function"==typeof t&&(i=t,t=plugin.FacebookAgent.HttpMethod.GET),plugin.FacebookAgent.getInstance().api(e,t,s,i)},cleverapps.Html5.prototype.logEvent=function(e,t){if(plugin.FacebookAgent&&plugin.FacebookAgent.getInstance()){var s=0;t&&1<t.amount&&(s=t.amount),plugin.FacebookAgent.getInstance().logEvent(e,s,t)}},cleverapps.Html5.isAppropriate=function(){return!cc.sys.isNative},cleverapps.FakeFacebookAgent={getInstance:function(){return this},isLoggedIn:function(){return!1},logEvent:function(){},login:function(e,t){t(cleverapps.Social.CODE_FAILED)},getAccessToken:function(){},dialog:function(e,t){t(cleverapps.Social.CODE_FAILED)},appRequest:function(e,t){t(cleverapps.Social.CODE_FAILED)},api:function(e,t,s,i){"function"==typeof s&&(i=s,s={}),i(cleverapps.Social.CODE_FAILED)},HttpMethod:{GET:"get"}},
cleverapps.Instant=function(){console.log("Choosing Instant-facebook"),cleverapps.Social.call(this),SelectFriendWindow.MAX_SELECTED=1},cleverapps.Instant.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Instant.prototype.constructor=cleverapps.Instant,cleverapps.Instant.Adapt=function(){FBInstant.onPause(function(){cleverapps.eventLogger.logEvent("instant_pause")}),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cleverapps.eventLogger.logEvent("instant_hide")})},cleverapps.Instant.LoadSdk=function(e){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","//connect.facebook.net/en_US/fbinstant.6.3.js"),t.onload=function(){console.log("Loaded FBInstant sdk"),e()},t.onerror=function(){console.log("Failed initialize sdk")},document.body.appendChild(t)},cleverapps.Instant.prototype.createBot=function(){FBInstant.player.canSubscribeBotAsync().then(function(e){e&&(cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.INSTANT_BOT_SHOW),FBInstant.player.subscribeBotAsync().then(function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_BOT)}))}).catch(function(e){-1===["No page associated to the Instant Game.","User already subscribed to this game bot.","Exceed API policy limit."].indexOf(e.message)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_BOT_ERROR),console.log(e.code+" "+e.message)})},cleverapps.Instant.prototype.createShortcut=function(){cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INSTANT_SHORTCUT_CREATED)||FBInstant.canCreateShortcutAsync().then(function(e){e&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_SHORTCUT_SHOW),FBInstant.createShortcutAsync().then(function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_SHORTCUT),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INSTANT_SHORTCUT_CREATED,1)}))})},cleverapps.Instant.prototype._update=function(s,i){var e=s.image||cleverapps.ShareBonus.cycleShareData("share"
).picture;this.getBase64Image(e,function(e,t){e?(console.log(e),i(cleverapps.Social.CODE_FAILED)):(i(cleverapps.Social.CODE_SUCCEED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_UPDATE),FBInstant.updateAsync({action:"CUSTOM",image:t,text:{default:s.message},template:s.template,strategy:"IMMEDIATE",notification:"PUSH"}))})},cleverapps.Instant.prototype.init=function(s){cleverapps.Instant.LoadSdk(function(){FBInstant.initializeAsync().then(function(){cleverapps.Instant.Adapt(),cleverapps.config.platform=FBInstant.getPlatform();var e=FBInstant.getEntryPointData(),t=e&&e.channel;t&&!cleverapps.user.channel&&0===cleverapps.user.getProgress()&&cleverapps.user.setChannel(t),s()}.bind(this))}.bind(this))},cleverapps.Instant.prototype.logEvent=function(e,t){"undefined"!=typeof FBInstant&&FBInstant.logEvent(e,1,t)},cleverapps.Instant.prototype.isLoggedIn=function(){return!0},cleverapps.Instant.prototype.getUserID=function(){return FBInstant.player.getID()},
cleverapps.Instant.prototype.inviteFriends=function(e,t){t=this.waitWindowCallback(t),FBInstant.context.chooseAsync({filters:["NEW_PLAYERS_ONLY"],minSize:2,maxSize:2}).then(function(){this._update({template:"invite",message:e.message},t)}.bind(this)).catch(function(){t(cleverapps.Social.CODE_FAILED)})},cleverapps.Instant.prototype.request=function(t,s){s=this.waitWindowCallback(s),FBInstant.context.createAsync(t.to[0]).then(function(){this._update({template:"request",message:t.message},s)}.bind(this)).catch(function(e){console.log("send request to "+t.to[0]+" failed",e),-1===["SAME_CONTEXT","INVALID_PARAM"].indexOf(e.code)?s(cleverapps.Social.CODE_FAILED):s(cleverapps.Social.CODE_SUCCEED)})},cleverapps.Instant.prototype.shareDialog=function(s,i){i=this.waitWindowCallback(i),this.getBase64Image(s.picture,function(e,t){e?(console.log(e),i(cleverapps.Social.CODE_FAILED)):FBInstant.shareAsync({intent:"SHARE",image:t,text:s.description}).then(function(){i(cleverapps.Social.CODE_SUCCEED)}
).catch(function(){i(cleverapps.Social.CODE_FAILED)})})},cleverapps.Instant.prototype.waitWindowCallback=function(e){var t=new WaitWindow;return cleverapps.metha.display({focus:"waitWindowCallback",action:function(e){cleverapps.metha.onceNoWindowsListener=e}}),function(){t.close(),e.apply(this,arguments)}},cleverapps.Instant.prototype.getBase64Image=function(s,i){0===(s=s.replace(".jpg",".txt").replace(".png","txt")).indexOf("/")&&(s=s.substr(1)),cc.loader.load(s,function(e,t){s=t&&Array.isArray(t)&&0<t.length?t[0]:void 0,i(e,s)})},cleverapps.Instant.prototype.listFriends=function(s){FBInstant.player.getConnectedPlayersAsync().then(function(e){var t=e.map(function(e){return{id:e.getID(),first_name:e.getName(),picture:{data:{url:e.getPhoto()}}}});s(cleverapps.Social.CODE_SUCCEED,t)}).catch(function(){s(cleverapps.Social.CODE_FAILED)})},cleverapps.Instant.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.Instant.prototype.aboutMe=function(e){e({
currency:{user_currency:"USD"},name:FBInstant.player.getName(),first_name:FBInstant.player.getName(),picture:{data:{url:FBInstant.player.getPhoto()}}})},cleverapps.Instant.prototype.getAccessToken=function(){return"instant"},cleverapps.Instant.isAppropriate=function(){return cleverapps.isInstant()},cleverapps.Instant.PLATFORM_WEB="WEB",cleverapps.Instant.PLATFORM_MOBILE_WEB="MOBILE_WEB",cleverapps.Instant.PLATFORM_IOS="IOS",cleverapps.Instant.PLATFORM_ANDROID="ANDROID",cleverapps.FakeInstant=function(){console.log("Choosing FakeInstant-facebook"),this.__mockState={initialized:!1},cleverapps.Instant.call(this)},cleverapps.FakeInstant.prototype=Object.create(cleverapps.Instant.prototype),cleverapps.FakeInstant.prototype.constructor=cleverapps.FakeInstant,cleverapps.FakeInstant.prototype.init=function(e){cleverapps.config.restApiURL=cleverapps.config.fakeRestApiURL,cleverapps.Instant.LoadSdk=function(e){e()},FBInstant={initializeAsync:function(){return new Promise(function(e,t){
var s=document.createElement("link");s.href="cleverapps/res/css/mock.css",s.rel="stylesheet",s.type="text/css",document.head.appendChild(s),Utils.log("initializeAsync"),e()})},startGameAsync:function(){return new Promise(function(e,t){Utils.log("startGameAsync","Showing game start dialog"),Utils.createAlert({message:"Game has finished loading. <br /> Play now?",cta:"Play!"},function(){cleverapps.social.__mockState.initialized=!0,e()})})},setLoadingProgress:function(s){return new Promise(function(e,t){Utils.log("progress",s,"%"),e()})},getSupportedAPIs:function(){var e=[];for(var t in FBInstant)e.push(t);for(var t in FBInstant.player)e.push("player."+t);for(var t in FBInstant.context)e.push("context."+t);return e}},cleverapps.Instant.LoadSdk(function(){FBInstant.initializeAsync().then(function(){console.log("FBInstant.initializeAsync()"),InstantLoaderScene.whenLoaded(function(){FBInstant.startGameAsync().then(e)})}.bind(this))}.bind(this))},
cleverapps.FakeInstant.prototype.logEvent=function(e,t){return Utils.log("logEvent",e,1,t),null},cleverapps.FakeInstant.prototype.isLoggedIn=function(){return!0},cleverapps.FakeInstant.prototype.getUserID=function(){return Utils.returnUserData(123456789)},cleverapps.FakeInstant.prototype.inviteFriends=function(e,t){Utils.shareAsync({intent:"INVITE",image:DEFAULT_INVITE_PICTURE,text:e.message}).then(function(){t(cleverapps.Social.CODE_SUCCEED)})},cleverapps.FakeInstant.prototype.request=function(e,t){Utils.shareAsync({intent:"REQUEST",image:e.picture,text:e.message}).then(function(){t()})},cleverapps.FakeInstant.prototype.shareDialog=function(e,t){Utils.shareAsync({intent:"SHARE",image:e.picture,text:e.description}).then(function(){t()})},cleverapps.FakeInstant.prototype.listFriends=function(t){new Promise(function(e,t){var s=[];cleverapps.social.__mockState.initialized?s=[{getID:function(){return 42},getName:function(){return"Friend 1"},getPhoto:function(){
return"cleverapps/res/img/mock/friend1-f27202440f.png"}},{getID:function(){return 43},getName:function(){return"Friend 2"},getPhoto:function(){return"cleverapps/res/img/mock/friend2-607bb2c069.png"}},{getID:function(){return 44},getName:function(){return"Friend 3"},getPhoto:function(){return"cleverapps/res/img/mock/friend3-5d09776058.png"}}]:Utils.log("getConnectedPlayersAsync","Connected players data is not available before startGameAsync resolves"),Utils.log("getConnectedPlayersAsync","players: ",s),e(s)}).then(function(e){t(cleverapps.Social.CODE_SUCCEED,e.map(function(e){return{id:e.getID(),name:e.getName(),first_name:e.getName(),picture:{data:{url:e.getPhoto()}}}}))})},cleverapps.FakeInstant.prototype.listInvitableFriends=function(e){return[]},cleverapps.FakeInstant.prototype.aboutMe=function(e){e({currency:{user_currency:"USD"},name:Utils.returnUserData("Player 1"),first_name:Utils.returnUserData("Player 1"),picture:{data:{url:Utils.returnUserData(
"cleverapps/res/img/mock/profile-2f8a5e0f94.jpg")}}})};var Utils={shareAsync:function(s){var i="Share Intent: "+s.intent;return i+="<br />",i+="Share text: "+s.text,i+="<br />",i+="Share payload: "+JSON.stringify(s.data),new Promise(function(e,t){Utils.createAlert({title:"Shared content",message:i,image:s.image,cta:"Close"},e)})},createAlert:function(e,t){var s=document.createElement("div");s.className="mockDialog";var i=document.createElement("h3");if(i.innerHTML="(FBFakeInstant Mock)",i.innerHTML+=" "+(e.title||""),s.appendChild(i),e.message){var n=document.createElement("p");n.innerHTML=e.message,s.appendChild(n)}if(e.image){var o=document.createElement("img");o.src=e.image,s.appendChild(o)}var r=document.createElement("input");r.type="button",r.value=e.cta||"Close",s.appendChild(r),r.onclick=function(){document.body.removeChild(s),t()},document.body.appendChild(s)},log:function(){args=[],args.push("[FBFakeInstant Mock]:");for(var e=0;e<arguments.length;e++)args.push(arguments[e])
;console.log.apply(console,args)},getQueryString:function(){var n={};return location.search&&location.search.substr(1).split("&").forEach(function(e){var t=e.split("="),s=t[0],i=t[1]&&decodeURIComponent(t[1]);(n[s]=n[s]||[]).push(i)}),n},returnAndLog:function(e){return caller=Utils.returnAndLog.caller,caller?Utils.log(caller.name,e):Utils.log(e),e},returnUserData:function(e){return cleverapps.social.__mockState.initialized?Utils.returnAndLog(e):(Utils.log("User Data is not available until startGameAsync has resolved"),null)},getFromLocalStorage:function(n,o){return new Promise(function(e,t){var s=localStorage.getItem(n),i={};s&&(s=JSON.parse(s),o.forEach(function(e){"undefined"!==s[e]&&(i[e]=s[e])})),Utils.log(i),e(i)})},writeToLocalStorage:function(s,i){return new Promise(function(e,t){Utils.log(JSON.stringify(i)),localStorage.setItem(s,JSON.stringify(i)),e()})}};cleverapps.FakeInstant.isAppropriate=function(){
return!cc.sys.isNative&&"instant"===cc.game.config.source&&cleverapps.isLocalhost()},cleverapps.FakeFacebook=function(){cleverapps.BaseFB.call(this)},cleverapps.FakeFacebook.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.FakeFacebook.prototype.constructor=cleverapps.FakeFacebook,cleverapps.FakeFacebook.prototype.init=function(e){cleverapps.config.restApiURL=cleverapps.config.fakeRestApiURL,this.DIALOG_CANCELLED=2,this.loggedIn=!1,this.token=void 0,setTimeout(function(){this.isExpired()||(this.token="123",this.loggedIn=!0),e()}.bind(this),1e3)},cleverapps.FakeFacebook.prototype.isExpired=function(){var e=cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME);return null===e||parseInt(e)+cleverapps.FakeFacebook.FAKE_SESSION_TIMEOUT<Date.now()},cleverapps.FakeFacebook.prototype.logEvent=function(e,t){},cleverapps.FakeFacebook.prototype.isLoggedIn=function(){return this.loggedIn&&!this.isExpired()},
cleverapps.FakeFacebook.prototype.getUserID=function(){return"1"},cleverapps.FakeFacebook.prototype.getAccessToken=function(){return this.isExpired()?void 0:this.token},cleverapps.FakeFacebook.prototype.login=function(e,t){confirm("Do you want to log in?")?(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME,Date.now()),this.token="123",this.loggedIn=!0,cleverapps.SocialManager.onLogin(),(e=e||function(){})()):(cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.FAKE_FACEBOOK_LOGGING_TIME),cleverapps.SocialManager.onFailedLogin(),t&&t())},cleverapps.FakeFacebook.prototype.inviteFriends=function(e,t){this.request(e,t)},cleverapps.FakeFacebook.prototype.request=function(e,t){delete e.element,t=t||function(){},confirm("Do you to post "+JSON.stringify(e)+"?")?t(cleverapps.Social.CODE_SUCCEED,{to:["__333"]}):t(cleverapps.Social.DIALOG_CANCELLED,"FakeFB")},cleverapps.FakeFacebook.prototype.shareDialog=function(e,t){confirm("Do you to post "+JSON.stringify(e
)+"?")?t(cleverapps.Social.CODE_SUCCEED,"FakeFB"):t(cleverapps.Social.DIALOG_CANCELLED,"FakeFB")},cleverapps.FakeFacebook.prototype.listFriends=function(e){setTimeout(function(){e(cleverapps.Social.CODE_SUCCEED,[{id:"111",name:"Friend 111",first_name:"Friend1",picture:{data:{url:"https://graph.facebook.com/41803173/picture?height=200&width=200"}}},{id:"222",name:"Friend 222",first_name:"Friend2",picture:{data:{url:"https://graph.facebook.com/692982514/picture?height=200&width=200"}}}])},500)},cleverapps.FakeFacebook.prototype.listInvitableFriends=function(e){setTimeout(function(){e(cleverapps.Social.CODE_SUCCEED,[{id:"__333",name:"Invitable1",first_name:"Invitable1",picture:{data:{url:"https://graph.facebook.com/100028444590540/picture?height=200&width=200"}}},{id:"__444",name:"Invitable2",first_name:"Invitable2",picture:{data:{url:"https://graph.facebook.com/100001008129789/picture?height=200&width=200"}}},{id:"__555",name:"Invitable3",first_name:"Invitable3",picture:{data:{
url:"https://graph.facebook.com/100011706990070/picture?height=200&width=200"}}},{id:"__666",name:"Invitable4",first_name:"Invitable4",picture:{data:{url:"https://graph.facebook.com/100001575006940/picture?height=200&width=200"}}},{id:"__777",name:"Invitable5",first_name:"Invitable5",picture:{data:{url:"https://graph.facebook.com/100000318466656/picture?height=200&width=200"}}}])},500)},cleverapps.FakeFacebook.prototype.api=function(e,t){switch(e){case"/me/?fields=is_eligible_promo":FB={ui:function(e,t){t({status:"completed"})}},t(cleverapps.Social.CODE_SUCCEED,{is_eligible_promo:1})}},cleverapps.FakeFacebook.prototype.aboutMe=function(e){setTimeout(function(){e({currency:{user_currency:"USD"},name:"FakeFB User",first_name:"FakeFB",picture:{data:{url:"https://graph.facebook.com/100001828353521/picture?height=200&width=200"}}})},500)},cleverapps.FakeFacebook.isAppropriate=function(){return!cc.sys.isNative&&cleverapps.isLocalhost()},
cleverapps.FakeFacebook.FAKE_SESSION_TIMEOUT=cleverapps.parseInterval("10 minutes"),cleverapps.MobileFacebook=function(){this.constructor===cleverapps.MobileFacebook&&console.log("Choosing mobile-facebook (sdkbox)"),this.apiJobs=[],this.apiProcessing=!1,cleverapps.BaseFB.call(this)},cleverapps.MobileFacebook.prototype=Object.create(cleverapps.BaseFB.prototype),cleverapps.MobileFacebook.prototype.constructor=cleverapps.MobileFacebook,cleverapps.MobileFacebook.prototype.init=function(e){sdkbox.PluginFacebook.init(),this.listeners={},sdkbox.PluginFacebook.setListener({onLogin:cleverapps.whenShow(this.onLogin.bind(this)),onFetchFriends:cleverapps.whenShow(this.onFetchFriends.bind(this)),onAPI:cleverapps.whenShow(this.onApi.bind(this)),onRequestInvitableFriends:cleverapps.whenShow(this.onRequestInvitableFriends.bind(this)),onInviteFriendsWithInviteIdsResult:cleverapps.whenShow(this.onInviteFriendsWithInviteIdsResult.bind(this)),onInviteFriendsResult:cleverapps.whenShow(
this.onInviteFriendsResult.bind(this)),onSharedSuccess:cleverapps.whenShow(this.onShared.bind(this,cleverapps.Social.CODE_SUCCEED)),onSharedFailed:cleverapps.whenShow(function(e){this.onShared(cleverapps.Social.CODE_FAILED,e)}.bind(this)),onSharedCancel:cleverapps.whenShow(this.onShared.bind(this,cleverapps.Social.CODE_CANCELLED))}),e&&e(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){this.deleteAllRequests()}.bind(this)),this.deleteAllRequests()},cleverapps.MobileFacebook.prototype.onShared=function(e,t){cc.sys.os===cc.sys.OS_IOS&&2===e&&(e=cleverapps.Social.CODE_SUCCEED),e===cleverapps.Social.CODE_FAILED&&cleverapps.Notification.create("messages:ShareError"),this.listeners.onShared&&(this.listeners.onShared(e),delete this.listeners.onShared)},cleverapps.MobileFacebook.prototype.onLogin=function(e){this.listeners.onLogin&&(this.listeners.onLogin(e),delete this.listeners.onLogin)},cleverapps.MobileFacebook.prototype.onApi=function(e,t){this.listeners.onApi&&(
t=decodeWebViewData(t),this.listeners.onApi(cleverapps.Social.CODE_SUCCEED,JSON.parse(t)),delete this.listeners.onApi),this.apiProcessing=!1,this.processApi()},cleverapps.MobileFacebook.prototype.onFetchFriends=function(e,t){if(this.listeners.onFetchFriends){if(e){t=decodeWebViewData(t);var s=JSON.parse(t);cc.sys.os===cc.sys.OS_IOS&&(s=s.data),this.listeners.onFetchFriends(cleverapps.Social.CODE_SUCCEED,s)}else this.listeners.onFetchFriends(cleverapps.Social.CODE_FAILED,t);delete this.listeners.onFetchFriends}},cleverapps.MobileFacebook.prototype.onInviteFriendsWithInviteIdsResult=function(e,t){this.listeners.onInviteFriendsWithInviteIdsResult&&(this.listeners.onInviteFriendsWithInviteIdsResult(e,t),delete this.listeners.onInviteFriendsWithInviteIdsResult)},cleverapps.MobileFacebook.prototype.onRequestInvitableFriends=function(e){if(this.listeners.onRequestInvitableFriends){var t=decodeWebViewData(e.data);this.listeners.onRequestInvitableFriends(t),
delete this.listeners.onRequestInvitableFriends}},cleverapps.MobileFacebook.prototype.onInviteFriendsResult=function(e,t){cleverapps.config.debugMode&&console.log("ON onInviteFriendsResult"),this.listeners.onInviteFriendsResult&&(this.listeners.onInviteFriendsResult(e,t),delete this.listeners.onInviteFriendsResult)},cleverapps.MobileFacebook.prototype.isLoggedIn=function(){return sdkbox.PluginFacebook.isLoggedIn()},cleverapps.MobileFacebook.prototype.getUserID=function(){return sdkbox.PluginFacebook.getUserID()},cleverapps.MobileFacebook.prototype.getAccessToken=function(){return sdkbox.PluginFacebook.getAccessToken()},cleverapps.MobileFacebook.prototype.login=function(t,s){this.listeners.onLogin=function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.SocialManager.onLogin(),cleverapps.history.set("fblog",1),t()):(cleverapps.SocialManager.onFailedLogin(),s&&s())},sdkbox.PluginFacebook.login(cleverapps.BaseFB.PERMISSIONS)},
cleverapps.MobileFacebook.prototype.inviteFriendsShare=function(e,t){cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.MobileFacebook.prototype.request=function(e,t){t&&t(cleverapps.Social.CODE_SUCCEED)},cleverapps.MobileFacebook.prototype.getShareDialogData=function(e){return{type:"link",link:this.getShareDialogLink(e),title:e.name,text:e.description,image:cleverapps.config.deployment+e.picture}},cleverapps.MobileFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(this.getShareDialogData(e))},cleverapps.MobileFacebook.prototype.api=function(e,t,s,i){if("function"==typeof(s=s||{})&&(i=s,s={}),!this.isLoggedIn())return console.log("Not logged in!"),void(i&&i(cleverapps.Social.CODE_CANCELLED));void 0===t?(t="GET",i=function(){}):"function"==typeof t&&(i=t,t="GET"),this.addApiJob(e,t,s,i),this.processApi()},cleverapps.MobileFacebook.prototype.addApiJob=function(e,t,s,i){this.apiJobs.push({apiMethod:e,httpMethod:t,
params:s,callback:i})},cleverapps.MobileFacebook.prototype.processApi=function(){if(!this.apiProcessing&&0!==this.apiJobs.length){this.apiProcessing=!0;var e=this.apiJobs.shift();this.listeners.onApi=e.callback,sdkbox.PluginFacebook.api(e.apiMethod,e.httpMethod,e.params,"api")}},cleverapps.MobileFacebook.prototype.getCode=function(){return"facebook"},cleverapps.MobileFacebook.isAppropriate=function(){return cc.sys.isNative},cleverapps.override(cleverapps.MobileFacebook.prototype,NativeInvite),cleverapps.MobileFacebook.APPINVITES_SDKBOX_ERROR="Unrecognized 'com.facebook.platform.protocol.PROTOCOL_ACTION' extra: 'com.facebook.platform.action.request.APPINVITES_DIALOG'.",cleverapps.AndroidWebViewFacebook=function(){console.log("Choosing android-facebook (webview)"),"undefined"==typeof sdkbox&&(sdkbox={}),sdkbox.PluginFacebook=FacebookPlugin,cleverapps.override(sdkbox.PluginFacebook,{setListener:function(){},init:function(){}}),cleverapps.MobileFacebook.call(this)},
cleverapps.AndroidWebViewFacebook.prototype=Object.create(cleverapps.MobileFacebook.prototype),cleverapps.AndroidWebViewFacebook.prototype.constructor=cleverapps.AndroidWebViewFacebook,cleverapps.AndroidWebViewFacebook.prototype.init=function(e){cleverapps.MobileFacebook.prototype.init.apply(this,arguments)},cleverapps.AndroidWebViewFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(JSON.stringify(this.getShareDialogData(e)))},cleverapps.AndroidWebViewFacebook.prototype.request=function(e,t){this.listeners.onRequest=t,sdkbox.PluginFacebook.inviteFriendsWithInviteIds(e.to?JSON.stringify(e.to):null,e.title,e.message)},cleverapps.AndroidWebViewFacebook.prototype.inviteFriendsShare=function(e,t){cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.AndroidWebViewFacebook.prototype.onRequest=function(e){this.listeners.onRequest&&(this.listeners.onRequest(e),delete this.listeners.onRequest)},
cleverapps.AndroidWebViewFacebook.prototype.addApiJob=function(e,t,s,i){cleverapps.MobileFacebook.prototype.addApiJob.call(this,e,t,JSON.stringify(s),i)},cleverapps.iOSWebViewFacebook=function(){console.log("Choosing ios-facebook (webview)"),"undefined"==typeof sdkbox&&(sdkbox={}),sdkbox.PluginFacebook={},cleverapps.override(sdkbox.PluginFacebook,{init:function(){webkitMessage("facebook",{action:"init"})},logPurchase:function(e,t){console.log("logPurchase success "+e+" "+t),webkitMessage("facebook",{action:"logPurchase",amount:e,currency:t})},dialog:function(e){webkitMessage("facebook",{action:"dialog",jsonInfo:JSON.parse(e)})},login:function(e){webkitMessage("facebook",{action:"login",permissions:e})},logout:function(){webkitMessage("facebook",{action:"logout"})},setListener:function(){},isLoggedIn:function(){return console.log("isLoggedIn check"),void 0!==this.tokenString&&0<this.tokenString.length}.bind(this),getAccessToken:function(){return this.tokenString}.bind(this),
getPermissionList:function(){return this.permissionList}.bind(this),getUserID:function(){return this.userID}.bind(this),getAppId:function(){return this.appId}.bind(this),getSDKVersion:function(){return this.sdkVersion}.bind(this),api:function(e,t,s,i){webkitMessage("facebook",{action:"api",path:e,method:t,paramsJson:JSON.parse(s),tag:i})},inviteFriendsWithInviteIds:function(e,t,s){webkitMessage("facebook",{action:"inviteFriendsWithInviteIds",inviteIdsJson:JSON.parse(e),title:t,text:s})},enableDebug:function(e){webkitMessage("facebook",{action:"enableDebug",enable:e})}}),cleverapps.MobileFacebook.call(this)},cleverapps.iOSWebViewFacebook.prototype=Object.create(cleverapps.MobileFacebook.prototype),cleverapps.iOSWebViewFacebook.prototype.constructor=cleverapps.iOSWebViewFacebook,cleverapps.iOSWebViewFacebook.prototype.init=function(e){this.onInitListener=e,cleverapps.MobileFacebook.prototype.init.apply(this)},cleverapps.iOSWebViewFacebook.prototype.onInit=function(e){console.log(
"Init callback called: "+JSON.stringify(e)),this.tokenString=e.tokenString,this.permissionList=e.permissionList,this.userID=e.userID,this.sdkVersion=e.sdkVersion,this.onInitListener&&(this.onInitListener(),delete this.onInitListener)},cleverapps.iOSWebViewFacebook.prototype.onLogin=function(e,t){console.log("Login callback called: ",t),this.tokenString=t.tokenString,this.permissionList=t.permissionList,this.userID=t.userID,this.sdkVersion=t.sdkVersion,this.tokenString&&cleverapps.MobileFacebook.prototype.onLogin.call(this,cleverapps.Social.CODE_SUCCEED,"success")},cleverapps.iOSWebViewFacebook.prototype.shareDialog=function(e,t){this.listeners.onShared=t,sdkbox.PluginFacebook.dialog(JSON.stringify(this.getShareDialogData(e)))},cleverapps.iOSWebViewFacebook.prototype.request=function(e,t){this.listeners.onRequest=t,sdkbox.PluginFacebook.inviteFriendsWithInviteIds(e.to?JSON.stringify(e.to):null,e.title,e.message)},cleverapps.iOSWebViewFacebook.prototype.inviteFriendsShare=function(e,t){
cleverapps.Social.prototype.inviteFriendsShare.call(this,e,t)},cleverapps.iOSWebViewFacebook.prototype.onRequest=function(e){this.listeners.onRequest&&(this.listeners.onRequest(e),delete this.listeners.onRequest)},cleverapps.iOSWebViewFacebook.prototype.addApiJob=function(e,t,s,i){cleverapps.MobileFacebook.prototype.addApiJob.call(this,e,t,JSON.stringify(s),i)},cleverapps.SocialManager={create:function(){if(cleverapps.flags.nosocial)return new cleverapps.NoSocial;var e=cleverapps.User.calcSource();if(cc.sys.isNative)return cleverapps.AndroidSocial.isAvailable()?new cleverapps.SelectSocial({facebook:new cleverapps.AndroidWebViewFacebook,androidsocial:new cleverapps.AndroidSocial}):cc.sys.os===cc.sys.OS_IOS&&cleverapps.AppleSocial.isAvailable()?new cleverapps.SelectSocial({facebook:new cleverapps.iOSWebViewFacebook,applesocial:new cleverapps.AppleSocial}):cc.sys.os===cc.sys.OS_ANDROID?new cleverapps.AndroidWebViewFacebook:new cleverapps.iOSWebViewFacebook;var t=cleverapps.isLocalhost(
)&&-1!==["instant","facebook"].indexOf(e)?{instant:cleverapps.FakeInstant,default:cleverapps.FakeFacebook}:{plinga:cleverapps.Plinga,instant:cleverapps.Instant,mobile_ok:cleverapps.MobileOK,web_ok:cleverapps.OK,mobile_mm:cleverapps.MobileMyMailRu,web_mm:cleverapps.MyMailRu,mobile_vk:cleverapps.MobileVk,web_vk:cleverapps.VK,sp_mbga:cleverapps.SPMobage,mbga:cleverapps.Mobage,nk:cleverapps.NK,draugiem:cleverapps.Draugiem,fotostrana:cleverapps.FotoStrana,xsolla:cleverapps.Xsolla,default:cleverapps.Html5};return new(t[e]||t.default)},onFailedLogin:function(){cleverapps.Notification.create("messages:SocialManager.FailedLogging")},onLogin:function(){if(levels.user.haveTmpId()){var t=levels.user.id,e=cleverapps.social.getUserID();cleverapps.RestClient.post("/users/off/"+t,{newId:e},function(e){console.log("Success marked off: "+t+", response "+JSON.stringify(e)),e&&e.signUp&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SIGN_UP,{method:cleverapps.social.getCode()})},function(){console.log(
"Failed marking off: "+t)}),levels.user.setId(e),cleverapps.synchronizer.reset(),cleverapps.info.onChangeUserId()}else levels.user.id!==cleverapps.social.getUserID()&&(console.log("second login!"),cc.sys.isNative?levels.user.setId(cleverapps.social.getUserID()):(cleverapps.DataLoader.cleanAll(),window.location.reload()));cleverapps.DataLoader.processSaveQueue(),cleverapps.social.deleteAllRequests(),cleverapps.synchronizer.syncWhenReady(),cleverapps.whenAllInitialized(this.onLoginRefreshes.bind(this))},onLoginRefreshes:function(){-1===["mobile_vk","web_vk","plinga"].indexOf(cleverapps.User.calcSource())&&cleverapps.Notification.create("messages:SocialManager.Connected"),cleverapps.social.aboutMe(this.onLoadUserInfo.bind(this)),cleverapps.localPushes.initSender(),cleverapps.user.calcIdfa(),cleverapps.friends.reload(),cleverapps.invitalbleFriends.reload()},onLoadUserInfo:function(s){if(cleverapps.friends.updatePlayerInfo(s),s.currency&&s.currency.user_currency){
var e=s.currency.user_currency,t={USD:"$",EUR:"€",GBP:"£"};t[e]&&(Product.CURRENCY=t[e],Product.CURRENCY_CODE=e)}if(s.first_name&&!cleverapps.flags.nologin&&setTimeout(function(){var e=void 0,t=cleverapps.friends.getPlayer();t.avatar&&t.avatar!==FriendsCache.DEFAULT_PLAYER_INFO().avatar&&((e=new cleverapps.UI.Avatar(t)).width&&e.height||(e=void 0)),cleverapps.Notification.create("messages:SocialManager.Welcome",{toReplace:{userName:s.first_name},image:e})},1e3),s.name){var i=s.name.substr(0,50);cleverapps.info.setKeyValue("name",i)}s.picture&&s.picture.data&&s.picture.data.url&&cleverapps.info.setKeyValue("avatar",s.picture.data.url),cleverapps.periodicBonus&&cleverapps.periodicBonus.refreshItems()}},cleverapps.NK=function(){console.log("Choosing html5-nk"),cleverapps.Social.call(this)},cleverapps.NK.prototype=Object.create(cleverapps.Social.prototype),cleverapps.NK.prototype.constructor=cleverapps.NK,cleverapps.NK.prototype.getLocalStoragePreffix=function(){return"_NK"},
cleverapps.NK.prototype.init=function(i){cleverapps.once(function(){NKOverrideRest();var e=opensocial.newDataRequest();e.add(e.newFetchPersonRequest(opensocial.IdSpec.PersonId.VIEWER),"request_id"),e.send(function(e){if(e.hadError());else{var t=e.get("request_id");if(t.hadError());else{var s=t.getData();this.user=cleverapps.NK.formatUserData(s),console.log(this.user),i()}}}.bind(this))}.bind(this))()},cleverapps.NK.prototype.isLoggedIn=function(){return!0},cleverapps.NK.prototype.getUserID=function(){return this.user.id},cleverapps.NK.prototype.getAccessToken=function(){return"NK"},cleverapps.NK.prototype.login=function(e){e()},cleverapps.NK.prototype.inviteFriends=function(e,t){FullscreenControlButton.exitFullscreen(function(){nk.requestInviteFriends(e.message,{},function(e){e.hadError()?t(cleverapps.Social.CODE_CANCELLED,e):t(cleverapps.Social.CODE_SUCCEED)})})},cleverapps.NK.prototype.listFriendsByApp=function(e,s){var t=opensocial.newDataRequest();t.add(t.newFetchPersonRequest(
opensocial.IdSpec.PersonId.VIEWER),"request_id");var i=opensocial.newIdSpec({userId:"VIEWER",groupId:"FRIENDS"});t.add(t.newFetchPeopleRequest(i,{max:1e3}),"another_id"),t.send(function(e){if(e.hadError())s(cleverapps.Social.CODE_FAILED);else{var t=e.get("another_id").getData().asArray();s(cleverapps.Social.CODE_SUCCEED,t.map(cleverapps.NK.formatUserData))}})},cleverapps.NK.formatUserData=function(e){return{id:cleverapps.Social.prepareId(e.getId()),name:e.getDisplayName(),first_name:e.getDisplayName(),picture:{data:{url:e.getField(opensocial.Person.Field.THUMBNAIL_URL)}}}},cleverapps.NK.prototype.aboutMe=function(e){e(this.user)},cleverapps.NK.prototype.requestToOne=function(e,t,s){var i={title:t.title,type:"notification"},n=opensocial.newMessage(t.message,i);FullscreenControlButton.exitFullscreen(function(){opensocial.requestSendMessage([e],n,function(e){e.hadError()?(console.log("error",e),s(cleverapps.Social.CODE_FAILED)):(console.log("ok",e),s(cleverapps.Social.CODE_SUCCEED))})})},
cleverapps.NK.prototype.request=function(e,s){var i=e.to;Array.isArray(i)||(i=[i]);var n=[],o=function(t){t===i.length?s(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(i[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(i[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},cleverapps.NK.prototype.shareDialog=function(e,t){var s=cleverapps.config.deployment+e.picture;0<=s.indexOf("?")&&(s=s.substr(0,s.indexOf("?")));var i=opensocial.newMediaItem("image",s);i.setField(opensocial.MediaItem.Field.TYPE,opensocial.MediaItem.Type.IMAGE);var n={};n[opensocial.Activity.Field.TITLE]=e.name,n[opensocial.Activity.Field.MEDIA_ITEMS]=[i];var o=opensocial.newActivity(n);FullscreenControlButton.exitFullscreen(function(){opensocial.requestCreateActivity(o,opensocial.CreateActivityPriority.HIGH,function(e){e.hadError()?(console.log("Share failed",e),t(cleverapps.Social.CODE_FAILED,e)):(console.log("Share ok"),t(
cleverapps.Social.CODE_SUCCEED))})})},cleverapps.NK.prototype.joinGroup=function(s){var t=function(t){var e=opensocial.newDataRequest();e.add(nk.groups.newIsUserInAppGroupRequest(),"isInGroup"),e.send(function(e){e.hadError()?s(cleverapps.Social.CODE_FAILED):e.get("isInGroup").getData()?s(cleverapps.Social.CODE_SUCCEED):t?t():s(cleverapps.Social.CODE_FAILED)})},e=function(){nk.groups.requestAddUserToAppGroup(function(e){e.hadError()&&s(cleverapps.Social.CODE_FAILED),t()})};FullscreenControlButton.exitFullscreen(function(){t(e)})},cleverapps.NK.prototype.listFriends=function(e){this.listFriendsByApp(!0,e)},cleverapps.NK.prototype.listInvitableFriends=function(e){e(cleverapps.Social.CODE_SUCCEED,[])},cleverapps.NK.isAppropriate=function(){return!cc.sys.isNative&&"nk"===cleverapps.User.calcSource()},cleverapps.NK.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_POLISH]},cleverapps.FotoStrana=function(){console.log("Choosing fotostrana"),cleverapps.Social.call(this)},
cleverapps.FotoStrana.prototype=Object.create(cleverapps.Social.prototype),cleverapps.FotoStrana.prototype.constructor=cleverapps.FotoStrana,cleverapps.FotoStrana.prototype.getLocalStoragePreffix=function(){return"_FS"},cleverapps.FotoStrana.prototype.init=function(e){var t=cleverapps.once(function(){e()}.bind(this)),s=function(e){t(),"timeout"===e?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_TIMEOUT):cleverapps.eventLogger.logEvent(cleverapps.EVENTS.FAKEFB_BY_SCRIPT_ERROR)}.bind(this),i=function(){window.FSClient=new fsapi(cleverapps.config.fotostrana.appId,cleverapps.config.fotostrana.privateKey),FSClient.init(function(){console.log("API Error!")}),t()}.bind(this);cleverapps.loadSdk(cleverapps.getRequestParameters().fsapi,{onSuccess:i,onFailure:s})},cleverapps.FotoStrana.prototype.isLoggedIn=function(){return!0},cleverapps.FotoStrana.prototype.fromSocialUserId=function(e){return"FS_"+e},cleverapps.FotoStrana.prototype.toSocialUserId=function(e){return e.substr(3)},
cleverapps.FotoStrana.prototype.getUserID=function(){return this.fromSocialUserId(cleverapps.getRequestParameters().viewerId)},cleverapps.FotoStrana.prototype.getAccessToken=function(){return"FS_"+cleverapps.getRequestParameters().authKey},cleverapps.FotoStrana.prototype.login=function(e){e()},cleverapps.FotoStrana.prototype.inviteFriends=function(e,t){FullscreenControlButton.exitFullscreen(function(){FSClient.event("invite",function(e){t(e.send?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)})})},cleverapps.FotoStrana.prototype.request=function(e,t){"object"!=typeof e.to&&(e.to=[e.to]);var s=[];e.to.forEach(function(e){s.push(this.toSocialUserId(e))}.bind(this)),FullscreenControlButton.exitFullscreen(function(){FSClient.event("sendMessageAndInvite",function(e){t(e.messSent||e.invSent?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{message:e.message,customIds:s.join(",")})})},cleverapps.FotoStrana.prototype.shareDialog=function(e,t){
var s=cleverapps.config.deployment+e.picture;0<=s.indexOf("?")&&(s=s.substr(0,s.indexOf("?"))),FullscreenControlButton.exitFullscreen(function(){FSClient.event("postUserEventOnWall",function(e){t("success"===e.result?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{title:e.title,text:e.description,imgUrl:s})})},cleverapps.FotoStrana.prototype.loadUsersData=function(e,i){e&&e.length?FSClient.api("User.getProfiles",{userIds:e.join(","),fields:"user_name, user_lastname, photo_small"},function(e){var t=[];if(e.response){for(var s in e.response)t.push(this.formatUserData(e.response[s]));i(cleverapps.Social.CODE_SUCCEED,t)}else i(cleverapps.Social.CODE_FAILED,t)}.bind(this)):i(cleverapps.Social.CODE_CANCELLED,[])},cleverapps.FotoStrana.prototype.listFriends=function(t){FSClient.api("User.getAppFriends",{appId:cleverapps.config.fotostrana.appId,limit:500},function(e){this.loadUsersData(e.response,t)}.bind(this))},cleverapps.FotoStrana.prototype.listInvitableFriends=function(
s){FSClient.api("User.getFriends",{limit:200},function(e){if(e.response&&e.response.length){var t=e.response;FSClient.api("User.getAppFriends",{appId:cleverapps.config.fotostrana.appId,limit:500},function(e){e.response&&e.response.length&&(t=cleverapps.substract(t,e.response)),this.loadUsersData(t,s)}.bind(this))}}.bind(this))},cleverapps.FotoStrana.prototype.formatUserData=function(e){return{id:this.fromSocialUserId(e.user_id),name:e.user_name+" "+e.user_lastname,first_name:e.user_name,picture:{data:{url:e.photo_small}}}},cleverapps.FotoStrana.prototype.aboutMe=function(s){this.loadUsersData([this.toSocialUserId(this.getUserID())],function(e,t){e===cleverapps.Social.CODE_SUCCEED&&t.length&&s(t[0])})},cleverapps.FotoStrana.prototype.logEvent=function(e,t){},cleverapps.FotoStrana.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_RUSSIAN]},cleverapps.FotoStrana.isAppropriate=function(){return!cc.sys.isNative&&"fotostrana"===cleverapps.User.calcSource()},
cleverapps.Plinga=function(){console.log("Choosing Plinga"),cleverapps.Social.call(this),this.eventListener=function(){},(cleverapps.isLocalhost()||cleverapps.isStagingHost())&&cleverapps.extend(this,cleverapps.FakePlinga)},cleverapps.Plinga.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Plinga.prototype.constructor=cleverapps.Plinga,cleverapps.Plinga.prototype.init=function(e){window.GD_OPTIONS={gameId:cleverapps.config.plinga.appId,onEvent:function(e){switch(console.log("plinga event",JSON.stringify(e)),e.name){case"SDK_GAME_START":cc.director.resume();break;case"SDK_GAME_PAUSE":cc.director.pause()}this.eventListener(e)}.bind(this)};cleverapps.loadSdk("//html5.api.gamedistribution.com/main.min.js",{onSuccess:e,onFailure:function(){cleverapps.eventLogger.logEvent("plinga_init_error"),e()},crossorigin:!0})},cleverapps.Plinga.isAppropriate=function(){return!cc.sys.isNative&&"plinga"===cleverapps.User.calcSource()},
cleverapps.Plinga.prototype.getLocalStoragePreffix=function(){return"_plinga"},cleverapps.FakePlinga={init:function(e){e()}},cleverapps.NoSocial=function(){console.log("Choosing without Social"),cleverapps.Social.call(this)},cleverapps.NoSocial.prototype=Object.create(cleverapps.Social.prototype),cleverapps.NoSocial.prototype.constructor=cleverapps.NoSocial,cleverapps.NoSocial.prototype.init=function(e){e()},cleverapps.NoSocial.isAppropriate=function(){return cleverapps.flags.nosocial},cleverapps.NoSocial.prototype.getLocalStoragePreffix=function(){return"_nosocial"};var NKOverrideRest=function(){var d=cleverapps.RestClient.send;cleverapps.RestClient.send=function(e,t,s,i,n,o){if(-1!==t.indexOf("newsync"))return r=cleverapps.RestClient.getBase()+cleverapps.config.restApiURL+t,a=s,c=i,l=n,(p={})[gadgets.io.RequestParameters.METHOD]=gadgets.io.MethodType.PUT,p[gadgets.io.RequestParameters.AUTHORIZATION]=gadgets.io.AuthorizationType.SIGNED,
p[gadgets.io.RequestParameters.CONTENT_TYPE]=gadgets.io.ContentType.JSON,p[gadgets.io.RequestParameters.POST_DATA]=JSON.stringify(a),p[gadgets.io.RequestParameters.HEADERS]={"Content-Type":"application/json"},void gadgets.io.makeRequest(r,function(e){if(e.text){var t=gadgets.json.parse(e.text);void 0!==t.error?l(t.error):c(t)}else l(e)},p);var r,a,c,l,p;d(e,t,s,i,n,o)}};if(cleverapps.Draugiem=function(){console.log("Choosing html5-draugiem"),cleverapps.Social.call(this)},cleverapps.Draugiem.prototype=Object.create(cleverapps.Social.prototype),cleverapps.Draugiem.prototype.constructor=cleverapps.Draugiem,cleverapps.Draugiem.prototype.getLocalStoragePreffix=function(){return"_draugiem"},cleverapps.Draugiem.prototype.api=function(e,t,s){t.action=e,this.accessToken&&(t.apikey=this.accessToken),cleverapps.RestClient.post("/draugiem",t,function(e){e.error?(console.log("Error response: ",e),s(cleverapps.Social.CODE_FAILED,e)):(console.log("Success api response: ",e),s(
cleverapps.Social.CODE_SUCCEED,e))})},cleverapps.Draugiem.prototype.init=function(r){var e=function(){draugiem_callback_url=cleverapps.config.deployment+"/cleverapps/res/callback-e75ca99e40-e75ca99e40.html",draugiem_domain="www.draugiem.lv";var n=function(e){this.accessToken=e,cleverapps.setUrlHash({saved_token:e}),this.api("userdata",{},function(e,t){this.user=cleverapps.Draugiem.formatUserData(cleverapps.values(t.users)[0]),r()}.bind(this))}.bind(this),o=cleverapps.getRequestParameters().dr_auth_code,e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DRAUGIEM_AUTH_DATA);e&&e.code===o?n(e.token):this.api("authorize",{code:o},function(e,t){if(t&&!t.error&&t.apikey)this.accessToken=t.apikey,this.user=cleverapps.Draugiem.formatUserData(t.users[t.uid]),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DRAUGIEM_AUTH_DATA,{code:o,token:this.accessToken}),cleverapps.setUrlHash({saved_token:this.accessToken});else{if(t&&t.error&&106===t.error.code){var s=cleverapps.getRequestParameters(
window.location.hash).saved_token;if(s)return void n(s)}var i=JSON.stringify({arguments:arguments,auth_code:o});cleverapps.throwAsync("draugiem authorize empty result "+i),this.user=cleverapps.Draugiem.formatUserData({uid:"1"})}r()}.bind(this))}.bind(this);cleverapps.loadSdk("//draugiem.lv/applications/external/draugiem.js",{onSuccess:e,onFailure:function(){console.log("Failed to load draugiem.js api")}})},cleverapps.Draugiem.prototype.isLoggedIn=function(){return!0},cleverapps.Draugiem.prototype.getUserID=function(){return this.user.id},cleverapps.Draugiem.prototype.getAccessToken=function(){return"DRG_"+this.accessToken},cleverapps.Draugiem.prototype.login=function(e){e()},cleverapps.Draugiem.prototype.sendActivity=function(e,t){if(!(this.lastActivitySent&&Date.now()-this.lastActivitySent<cleverapps.parseInterval("1 day"))){var s=cleverapps.Social.ACTIVITIES_CONFIG[e];if(s.probability>Math.random()){var i=cleverapps.Random.mathChoose(s.messages),n={prefix:Messages.get(i.title),
text:Messages.get(i.body,t),link:cleverapps.config.deployment};cleverapps.social.api("add_activity",n,function(e,t){t&&"OK"===t.status&&(this.lastActivitySent=Date.now())}.bind(this))}}},cleverapps.Draugiem.prototype.inviteFriends=function(e,t){draugiemSendInvite(e.message,"",function(e){t(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)})},cleverapps.Draugiem.prototype.requestToOne=function(s,i,n){FullscreenControlButton.exitFullscreen(function(){var e=cleverapps.config.draugiem.url,t=i.message+"\n"+e;draugiemSendMessage(s,i.title,t,function(e){n(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_FAILED)})})},cleverapps.Draugiem.prototype.request=function(e,s){var i=e.to;Array.isArray(i)||(i=[i]);var n=[],o=function(t){t===i.length?s(0<n.length?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED,n):this.requestToOne(i[t],e,function(e){e===cleverapps.Social.CODE_SUCCEED&&n.push(i[t]),setTimeout(function(){o(t+1)},500)})}.bind(this);o(0)},
cleverapps.Draugiem.prototype.shareDialog=function(t,s){FullscreenControlButton.exitFullscreen(function(){var e=cleverapps.config.draugiem.url;draugiemSay(t.name,e,Messages.get("PlayNow"),t.description,function(e){s(e?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_FAILED)})})},cleverapps.Draugiem.prototype.listFriendsByApp=function(e,t){},cleverapps.Draugiem.prototype.listFriends=function(i){this.api("app_friends",{},function(e,t){if(e===cleverapps.Social.CODE_SUCCEED){var s=[];0<t.total&&(s=cleverapps.values(t.users).map(cleverapps.Draugiem.formatUserData)),i(cleverapps.Social.CODE_SUCCEED,s)}else i(cleverapps.Social.CODE_FAILED)}.bind(this))},cleverapps.Draugiem.prototype.listInvitableFriends=function(e){e()},cleverapps.Draugiem.formatUserData=function(e){return{id:""+e.uid,name:e.surname+" "+e.name,first_name:e.name,picture:{data:{url:e.img}}}},cleverapps.Draugiem.prototype.aboutMe=function(e){e(this.user)},cleverapps.Draugiem.prototype.logEvent=function(e,t){},
cleverapps.Draugiem.prototype.getDefaultLanguages=function(){return[cc.sys.LANGUAGE_LATVIAN,cc.sys.LANGUAGE_RUSSIAN]},cleverapps.Draugiem.isAppropriate=function(){return!cc.sys.isNative&&"draugiem"===cleverapps.User.calcSource()},cc.sys.LANGUAGE_LATVIAN="lv",cleverapps.Payments=function(){this.oncePaymentFinished=void 0,this.clientCompensateProducts=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.CLIENT_COMPENSATE_PRODUCTS)||[]},cleverapps.Payments.prototype.needSocialCheckConnection=function(){return!0},cleverapps.Payments.prototype.onPaymentFinished=function(){if(this.oncePaymentFinished){var e=this.oncePaymentFinished;delete this.oncePaymentFinished,e()}},cleverapps.Payments.prototype.addClientCompensateProduct=function(e){this.clientCompensateProducts.push(e),this._saveClientCompensateProducts()},cleverapps.Payments.prototype.getClientCompensateProduct=function(){if(this.existClientCompensateProduct())return this.clientCompensateProducts[0]},
cleverapps.Payments.prototype._saveClientCompensateProducts=function(){this.clientCompensateProducts.length?cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.CLIENT_COMPENSATE_PRODUCTS,this.clientCompensateProducts):cleverapps.DataLoader.remove(cleverapps.DataLoaderTypes.CLIENT_COMPENSATE_PRODUCTS)},cleverapps.Payments.prototype.processClientCompensateProduct=function(e){for(var t=0;t<this.clientCompensateProducts.length;t++)if(this.clientCompensateProducts[t]===e)return this.clientCompensateProducts.splice(t,1),void this._saveClientCompensateProducts()},cleverapps.Payments.prototype.existClientCompensateProduct=function(){return this.clientCompensateProducts.length},cleverapps.Payments.prototype.isProductsExists=function(e){return e.length===e.filter(function(e){return this.isProductExists(e)}.bind(this)).length},cleverapps.Payments.prototype.isProductExists=function(e){return cleverapps.config.products[e]},cleverapps.CompensatePayments=function(){cleverapps.Payments.call(this),
this.compensateProductCode=void 0},cleverapps.CompensatePayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.CompensatePayments.prototype.constructor=cleverapps.CompensatePayments,cleverapps.CompensatePayments.prototype.getMobile=function(){return 0},cleverapps.CompensatePayments.prototype.getBasePath=function(){return""},cleverapps.CompensatePayments.prototype.canCompensate=function(){return!1},cleverapps.CompensatePayments.prototype.stopCheckPayments=function(){this.checkPaymentTimeout&&(clearTimeout(this.checkPaymentTimeout),this.checkPaymentTimeout=void 0)},cleverapps.CompensatePayments.prototype.runCheckPayments=function(){var e=[].concat(cleverapps.CompensatePayments.CHECK_TIMEOUTS),t=function(){this.stopCheckPayments(),e.length<cleverapps.CompensatePayments.CHECK_TIMEOUTS.length&&this.checkPayment(),0<e.length&&(this.checkPaymentTimeout=setTimeout(t,cleverapps.parseInterval(e.shift())))}.bind(this);t()},
cleverapps.CompensatePayments.prototype.callPaymentCallback=function(e){this.paymentCallback&&(this.paymentCallback(cleverapps.Social.CODE_SUCCEED,e),this.paymentCallback=void 0)},cleverapps.CompensatePayments.prototype.checkPayment=function(){var e="/"+this.getBasePath()+"/check/"+this.getMobile()+"/"+levels.user.id;"subscription"===this.productType&&(e="/"+this.getBasePath()+"/checksubscription/"+levels.user.id);var t=function(e){"ok"===e&&(this.stopCheckPayments(),this.callPaymentCallback())}.bind(this);cleverapps.RestClient.get(e,{},t)},cleverapps.CompensatePayments.prototype.compensate=function(){if(!this.checkPaymentTimeout&&!this.compensateProductCode){var e="/"+this.getBasePath()+"/compensate/"+levels.user.id;cleverapps.RestClient.get(e,{},function(e){"none"!==e&&(this.compensateProductCode=e)}.bind(this))}},cleverapps.CompensatePayments.prototype.validateByPath=function(t,e){if(!cleverapps.config.debugMode||!cleverapps.Tool.compensateCheck){t=cleverapps.once(t||function(){})
;var s=[].concat(cleverapps.CompensatePayments.VALIDATE_TIMEOUTS),i=void 0,n=function(){cleverapps.RestClient.get(e,{},function(e){"ok"===e&&(t(),clearTimeout(i))}),0<s.length&&(i=setTimeout(n,cleverapps.parseInterval(s.shift())))};n()}},cleverapps.CompensatePayments.prototype.open=function(e,t){},cleverapps.CompensatePayments.prototype.isAvailable=function(){return!0},cleverapps.CompensatePayments.prototype.logPurchase=function(e){},cleverapps.CompensatePayments.prototype.compensateValidate=function(e){this.getBasePath()?this.validateByPath(e,"/"+this.getBasePath()+"/compensatevalidate/"+levels.user.id):e()},cleverapps.CompensatePayments.prototype.validate=function(e,t){this.getBasePath()?this.validateByPath(t,"/"+this.getBasePath()+"/validate/"+this.getMobile()+"/"+levels.user.id):t()},cleverapps.CompensatePayments.prototype.setPaymentChecked=function(){this.getBasePath()&&this.validateByPath(function(){},"/"+this.getBasePath()+"/check/"+this.getMobile()+"/"+levels.user.id)},
cleverapps.CompensatePayments.CHECK_TIMEOUTS=["1 second","1 second","3 seconds","5 seconds","5 seconds","5 seconds","10 seconds","10 seconds","20 seconds","20 seconds","20 seconds","20 seconds","1 minute","1 minute","3 minutes","5 minutes","5 minutes"],cleverapps.CompensatePayments.VALIDATE_TIMEOUTS=["5 seconds","10 seconds","15 seconds","30 seconds","30 seconds","30 seconds","1 minute","1 minute","1 minute","5 minutes","5 minutes","5 minutes"],cleverapps.FakePayments=function(){cleverapps.Payments.call(this)},cleverapps.FakePayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.FakePayments.prototype.constructor=cleverapps.FakePayments,cleverapps.FakePayments.prototype.open=function(e,t){setTimeout(function(){confirm(Messages.get("FakePayments.Buying")+" "+e.title+" for "+e.price)?setTimeout(function(){t(cleverapps.Social.CODE_SUCCEED)},cleverapps.FakePayments.PROCESS_TIMEOUT):setTimeout(function(){console.log(Messages.get("FakePayments.Cancelled")),t(
cleverapps.Social.CODE_CANCELLED)},cleverapps.FakePayments.PROCESS_TIMEOUT)},1e3)},cleverapps.FakePayments.prototype.isAvailable=function(){return!0},cleverapps.FakePayments.isAppropriate=function(){return!!cleverapps.isLocalhost()},cleverapps.FakePayments.prototype.validate=function(e,t){t&&t()},cleverapps.FakePayments.prototype.logPurchase=function(e){},cleverapps.FakePayments.prototype.restore=function(e){setTimeout(function(){e&&e(!0)},1e3)},cleverapps.FakePayments.PROCESS_TIMEOUT=0,cleverapps.InstantPayments=function(){cleverapps.Payments.call(this),this.ready=!1,this.consumed={},this.load(),cleverapps.social.whenInitialized("instantpayments",function(){var e=FBInstant.getSupportedAPIs();console.log("Searching payments.purchaseAsync",e),-1!==e.indexOf("payments.purchaseAsync")&&(console.log("Found payments.purchaseAsync support!"),FBInstant.payments.onReady(function(){console.log("Payments ready!"),this.ready=!0,this.loadProducts(),cleverapps.flags.update(),cleverapps.values(
this.onAvailableListeners).forEach(cleverapps.callFunc)}.bind(this)))}.bind(this)),this.onAvailableListeners={}},cleverapps.InstantPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.InstantPayments.prototype.constructor=cleverapps.InstantPayments,cleverapps.InstantPayments.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.INSTANT_PAYMENTS);e&&e.consumed&&(this.consumed=e.consumed)},cleverapps.InstantPayments.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.INSTANT_PAYMENTS,{consumed:this.consumed})},cleverapps.InstantPayments.prototype.open=function(s,i){if(this.isAvailable()){var e=function(e){console.log("success purchase",e),s.signedRequest=e.signedRequest,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_PAYMENT+"ok"),i(cleverapps.Social.CODE_SUCCEED,s),this.consumePurchase(e)}.bind(this),t=function(e){console.log("error purchase",e);var t=cleverapps.Social.CODE_FAILED
;e&&"USER_INPUT"===e.code&&(t=cleverapps.Social.CODE_CANCELLED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_PAYMENT+(t===cleverapps.Social.CODE_CANCELLED?"cancel":"error")),i(t,s)}.bind(this);FBInstant.payments.purchaseAsync({productID:s.id.instant}).then(e).catch(t)}else i(cleverapps.Social.CODE_FAILED,s,"messages:InstantPayments.NotAvailable")},cleverapps.InstantPayments.prototype.logPayment=function(e){var t="ok";e&&(t="error"),e&&"USER_INPUT"===e.code&&(t="canceled"),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_PAYMENT+t)},cleverapps.InstantPayments.prototype.isAvailable=function(){return-1!==["1832499670188919","1887333567973110","1920167364724450","2076714912381045","2585442014807608"].indexOf(cleverapps.user.id)||this.ready},cleverapps.InstantPayments.isAppropriate=function(){return cleverapps.isInstant()},cleverapps.InstantPayments.prototype.getProductByInstantId=function(e){for(var t in cleverapps.config.products){var s=cleverapps.config.products[t]
;if(e===s.id.instant)return s}},cleverapps.InstantPayments.prototype.loadProducts=function(){FBInstant.payments.getCatalogAsync().then(function(e){console.log(e),e.forEach(function(e){var t=this.getProductByInstantId(e.productID);t&&(t.loadedPrice=e.price)},this)}.bind(this))},cleverapps.InstantPayments.prototype.consumePurchase=function(e){var t=this.getProductByInstantId(e.productID),s={userId:cleverapps.user.id,purchase:e,productCode:e.productID,status:""};t&&(s.price=t.price,s.textPrice=t.loadedPrice,s.productCode=t.key),cleverapps.RestClient.post("/instantpayments/addpayment/",s);FBInstant.payments.consumePurchaseAsync(e.purchaseToken).then(function(){console.log("consume success",e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_CONSUME+"ok"),s.status="consumed",cleverapps.RestClient.post("/instantpayments/addpayment/",s)}).catch(function(e){console.log("consume error",e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.INSTANT_CONSUME+"error"),s.error=e,
s.status="consume_error",cleverapps.RestClient.post("/instantpayments/addpayment/",s)}),this.consumed[e.paymentID]=!0,this.save()},cleverapps.InstantPayments.prototype.validate=function(e,t,s){var i={signedRequest:e.signedRequest,userId:cleverapps.user.id};cleverapps.RestClient.post("/instantpayments/validate/",i,function(e){"ok"===e?(t(),console.log("Purchase validation success")):(s&&s(),console.log("Purchase validation error",e))})},cleverapps.InstantPayments.prototype.canCompensate=function(){return!0},cleverapps.InstantPayments.prototype.compensate=function(){if(!this.compensateProductCode&&!this.compensateRunning){this.compensateRunning=!0;var e=function(e){if(0!==(e=e.filter(function(e){var t=!this.consumed[e.paymentID]&&this.getProductByInstantId(e.productID);return t||this.consumePurchase(e),t},this)).length){var t=e[0];console.log("compensate validate purchase",t);var s=function(){console.log("compensate validate purchase success"),this.compensateRunning=!1,
this.compensatePurchase=t,this.compensateProductCode=this.getProductByInstantId(t.productID).key}.bind(this),i=function(){console.log("compensate validate purchase error"),this.compensateRunning=!1,this.consumed[t.paymentID]=!0,this.save()}.bind(this);this.validate(t,s,i)}else this.compensateRunning=!1}.bind(this),t=function(e){this.compensateRunning=!1,console.log("error getPurchasesAsync",e)}.bind(this);FBInstant.payments.getPurchasesAsync().then(e).catch(t)}},cleverapps.InstantPayments.prototype.compensateValidate=function(e){var t=this.compensatePurchase;t&&(delete this.compensatePurchase,e(),this.consumePurchase(t))},cleverapps.InstantPayments.prototype.logPurchase=function(e){},cleverapps.MobagePayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=cleverapps.MobagePayments.calcLoadedPrice(t.price)}},cleverapps.MobagePayments.prototype=Object.create(cleverapps.Payments.prototype),
cleverapps.MobagePayments.prototype.constructor=cleverapps.MobagePayments,cleverapps.MobagePayments.prototype.calcLoadedPrice=function(e){return cleverapps.MobagePayments.calcLoadedPrice(e)},cleverapps.MobagePayments.calcLoadedPrice=function(e){var t=100;return-1!==cleverapps.MobagePayments.TESTER_IDS.indexOf(cleverapps.user.id)&&(t=1),cleverapps.formatAmount(Math.ceil(e*t))+" MC"},cleverapps.MobagePayments.prototype.getSKU=function(e){var t=0;for(var s in cleverapps.PaymentsManager.PRODUCTS)if(t++,s===e.itemId)return t},cleverapps.MobagePayments.prototype.open=function(e,s){var t={};t[opensocial.BillingItem.Field.SKU_ID]=this.getSKU(e),t[opensocial.BillingItem.Field.PRICE]=parseInt(e.loadedPrice.replace(" ","")),t[opensocial.BillingItem.Field.COUNT]=1,t[mbga.BillingItem.Field.NAME]=e.description,t[mbga.BillingItem.Field.IMAGE_URL]=cleverapps.config.deployment.replace("https","http")+e.image;var i=opensocial.newBillingItem(t),n={};n[opensocial.Payment.Field.ITEMS]=[i],
n[opensocial.Payment.Field.AMOUNT]=t[opensocial.BillingItem.Field.PRICE]*t[opensocial.BillingItem.Field.COUNT];var o=opensocial.newPayment(n);FullscreenControlButton.exitFullscreen(function(){opensocial.requestPayment(o,function(e){if(e.hadError())s(cleverapps.Social.CODE_FAILED,e);else{var t=e.getData();s(cleverapps.Social.CODE_SUCCEED,t)}})})},cleverapps.MobagePayments.prototype.isAvailable=function(){return!0},cleverapps.MobagePayments.isAppropriate=function(){return cleverapps.Mobage.isAppropriate()},cleverapps.MobagePayments.prototype.validate=function(e,t){t&&t()},cleverapps.MobagePayments.prototype.logPurchase=function(e){},cleverapps.MobagePayments.TESTER_IDS=["mbga.jp:155776208"],cleverapps.VKPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}this.paymentHandler=function(e){},cleverapps.social.whenInitialized("vkpayments",this.init.bind(this))},
cleverapps.VKPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.VKPayments.prototype.constructor=cleverapps.VKPayments,cleverapps.VKPayments.prototype.calcLoadedPrice=function(e){return Math.round(21*e)+" руб"},cleverapps.VKPayments.prototype.init=function(){VK.addCallback("onOrderSuccess",function(e){this.paymentHandler(cleverapps.Social.CODE_SUCCEED,e)}.bind(this)),VK.addCallback("onOrderCancel",function(){this.paymentHandler(cleverapps.Social.CODE_CANCELLED)}.bind(this)),VK.addCallback("onOrderFail",function(e){this.paymentHandler(cleverapps.Social.CODE_FAILED,e)}.bind(this))},cleverapps.VKPayments.prototype.open=function(e,s){this.paymentHandler=function(e,t){e===cleverapps.Social.CODE_FAILED?(console.log(t),s(cleverapps.Social.CODE_FAILED,t)):e===cleverapps.Social.CODE_SUCCEED&&s(cleverapps.Social.CODE_SUCCEED,t)};var t={type:"item",item:e.itemId};FullscreenControlButton.exitFullscreen(function(){VK.callMethod("showOrderBox",t)})},
cleverapps.VKPayments.prototype.isAvailable=function(){return!0},cleverapps.VKPayments.isAppropriate=function(){return cleverapps.VK.isAppropriate()},cleverapps.VKPayments.prototype.validate=function(e,t){cleverapps.RestClient.post("/vkpayments/check/",{orderId:e},function(e){"ok"===e&&t&&t()})},cleverapps.VKPayments.prototype.logPurchase=function(e){},cleverapps.MobileVkPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.MobileVkPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.MobileVkPayments.prototype.constructor=cleverapps.MobileVkPayments,cleverapps.MobileVkPayments.prototype.calcLoadedPrice=function(e){return Math.round(21*e)+" руб"},cleverapps.MobileVkPayments.prototype.open=function(e,t){this.isAvailable()?cleverapps.social.showOrderBox({type:"item",item:e.itemId},function(e){e===cleverapps.Social.CODE_SUCCEED&&t(
cleverapps.Social.CODE_SUCCEED)}):t(cleverapps.Social.CODE_FAILED,e,"messages:InstantPayments.NotAvailable")},cleverapps.MobileVkPayments.prototype.isAvailable=function(){return"html5_ios"!==cleverapps.MobileVk.getPlatfrom()},cleverapps.MobileVkPayments.isAppropriate=function(){return cleverapps.MobileVk.isAppropriate()},cleverapps.MobileVkPayments.prototype.validate=function(e,t){cleverapps.RestClient.post("/vkpayments/mobile/",{userId:cleverapps.user.id},function(e){"ok"===e&&t&&t()})},cleverapps.MobileVkPayments.prototype.logPurchase=function(e){},cleverapps.MyMailRuPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}cleverapps.social.whenInitialized("mymailrupayments",this.init.bind(this))},cleverapps.MyMailRuPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.MyMailRuPayments.prototype.constructor=cleverapps.MyMailRuPayments,
cleverapps.MyMailRuPayments.prototype.init=function(){this instanceof cleverapps.MobileMyMailRuPayments||(this.listeners={status:function(){},income:function(){}},mailru.events.listen(mailru.app.events.paymentDialogStatus,function(e){this.listeners.status(e)}.bind(this)),mailru.events.listen(mailru.app.events.incomingPayment,function(e){this.listeners.income(e)}.bind(this)))},cleverapps.MyMailRuPayments.prototype.calcLoadedPrice=function(e){return Math.floor(20*e)+" млк"},cleverapps.MyMailRuPayments.prototype.checkPayment=function(t){cleverapps.RestClient.get("/mmrupayments/check/"+levels.user.id,{},function(e){"ok"===e&&t()})},cleverapps.MyMailRuPayments.prototype.processPayment=function(){cleverapps.RestClient.get("/mmrupayments/close/"+levels.user.id,{},function(){})},cleverapps.MyMailRuPayments.prototype.open=function(e,t){this.listeners.status=function(e){console.log("PAYMENT DIALOG",e)},this.listeners.income=function(e){console.log("INCOM",e),"success"===e.status?(t(
cleverapps.Social.CODE_SUCCEED),this.processPayment()):t(cleverapps.Social.CODE_CANCELLED)}.bind(this),FullscreenControlButton.exitFullscreen(function(){mailru.app.payments.showDialog({service_id:e.id.mymailru,service_name:e.title,mailiki_price:parseInt(e.loadedPrice)})})},cleverapps.MyMailRuPayments.prototype.isAvailable=function(){return!0},cleverapps.MyMailRuPayments.isAppropriate=function(){return cleverapps.MyMailRu.isAppropriate()},cleverapps.MyMailRuPayments.prototype.validate=function(e,t){t&&t()},cleverapps.MyMailRuPayments.prototype.logPurchase=function(e){},cleverapps.MobileMyMailRuPayments=function(){cleverapps.MyMailRuPayments.call(this)},cleverapps.MobileMyMailRuPayments.prototype=Object.create(cleverapps.MyMailRuPayments.prototype),cleverapps.MobileMyMailRuPayments.prototype.constructor=cleverapps.MobileMyMailRuPayments,cleverapps.MobileMyMailRuPayments.prototype.runChecker=function(e){var t,s=0,i=function(){
"16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","close popup "+JSON.stringify((new Error).stack)),cleverapps.MobileMyMailRu.widgetWindow&&(cleverapps.MobileMyMailRu.widgetWindow.close(),cleverapps.MobileMyMailRu.widgetWindow=void 0),clearInterval(t)};t=setInterval(function(){3600<++s&&("16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","close popup uid"),i());try{cleverapps.MobileMyMailRu.widgetWindow.location&&cleverapps.MobileMyMailRu.widgetWindow.location.href&&0<=cleverapps.MobileMyMailRu.widgetWindow.location.href.indexOf("vid=")&&("16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","close by href "+cleverapps.MobileMyMailRu.widgetWindow.location.href),i(),s=0)}catch(e){}s%3==0&&this.checkPayment(function(){this.processPayment(),e(cleverapps.Social.CODE_SUCCEED),e=function(){},i()}.bind(this))}.bind(this),500)},cleverapps.MobileMyMailRuPayments.prototype.open=function(e,t){
this.processPayment();var s=cleverapps.social.getRequestParameters(),i={appid:cleverapps.config.myMailRu.appId,session_key:s.session_key,service_id:e.id.mymailru,service_name:e.title,mailiki_price:parseInt(e.loadedPrice),mob:1},n=[];for(var o in i)if(i.hasOwnProperty(o))if("service_name"===o){var r=o+"="+i[o].split("").map(function(e){return e.match(/[а-я]/i)?e:encodeURIComponent(e)}).join("");n.push(r)}else n.push(o+"="+encodeURIComponent(i[o]));n="http://m.my.mail.ru/cgi-bin/app/paymentm?"+n.join("&"),cleverapps.MobileMyMailRu.widgetWindow=window.open(n),this.runChecker(t),"16111471373067017624"===cleverapps.user.id&&(cleverapps.ReportStream.send("mmdebug","open mobile payment "+n),cleverapps.ReportStream.send("mmdebug","is window null - "+!cleverapps.MobileMyMailRu.widgetWindow))},cleverapps.MobileMyMailRuPayments.isAppropriate=function(){return"16111471373067017624"===cleverapps.user.id&&cleverapps.ReportStream.send("mmdebug","source"+cleverapps.User.calcSource()),
cleverapps.MobileMyMailRu.isAppropriate()},cleverapps.OKPayments=function(){for(var e in cleverapps.CompensatePayments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.OKPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.OKPayments.prototype.constructor=cleverapps.OKPayments,cleverapps.OKPayments.prototype.calcLoadedPrice=function(e){var t=-1!==["580731438762","577203420866","585959187481","576593702177","8593874","573573968467","578403383621","573870870859","583443371977"].indexOf(cleverapps.user.id),s=Math.floor(20*e)+" OK";return cleverapps.config.debugMode&&t&&(s=Math.max(1,Math.round(e/3))+" OK"),s},cleverapps.OKPayments.prototype.open=function(e,t){FAPI!==cleverapps.FakeFAPI?"subscription"!==e.type?(this.paymentCallback=t,this.productType=e.type,this.runCheckPayments(),cleverapps.social.listeners.showPayment=function(e){e===cleverapps.OK.CODE_SUCCEED&&(
this.checkPayment(),this.callPaymentCallback())}.bind(this),FullscreenControlButton.exitFullscreen(function(){FAPI.UI.showPayment(e.description,e.title,e.itemId,parseInt(e.loadedPrice),null,JSON.stringify({type:this.getMobile()?"mobile":"social"}),"ok","true")}.bind(this))):this.openSubscription(e,t):t(cleverapps.Social.CODE_CANCELLED)},cleverapps.OKPayments.prototype.getBasePath=function(){return"okpayments"},cleverapps.OKPayments.prototype.canCompensate=function(){return!0},cleverapps.OKPayments.prototype.openSubscription=function(e,t){this.paymentCallback=t,this.productType=e.type,this.runCheckPayments(),FullscreenControlButton.exitFullscreen(function(){FAPI.invokeUIMethod("showPaymentSubscription",e.id.ok,parseInt(e.loadedPrice))})},cleverapps.OKPayments.prototype.isAvailable=function(){return!0},cleverapps.OKPayments.isAppropriate=function(){return cleverapps.OK.isAppropriate()},cleverapps.OKPayments.prototype.logPurchase=function(e){},cleverapps.MobileOKPayments=function(){
cleverapps.OKPayments.call(this)},cleverapps.MobileOKPayments.prototype=Object.create(cleverapps.OKPayments.prototype),cleverapps.MobileOKPayments.prototype.constructor=cleverapps.MobileOKPayments,cleverapps.MobileOKPayments.prototype.getMobile=function(){return 1},cleverapps.MobileOKPayments.isAppropriate=function(){return cleverapps.MobileOK.isAppropriate()},cleverapps.NoPayments=function(){cleverapps.CompensatePayments.call(this)},cleverapps.NoPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.NoPayments.prototype.constructor=cleverapps.NoPayments,cleverapps.NoPayments.isAppropriate=function(){return-1!==["huzcom","plinga","pliega","ayodo1","iyodo1"].indexOf(cleverapps.User.calcSource())},cleverapps.NoPayments.prototype.isAvailable=function(){return!1},cleverapps.SPMobagePayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e]
;t.loadedPrice=cleverapps.MobagePayments.calcLoadedPrice(t.price)}},cleverapps.SPMobagePayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.SPMobagePayments.prototype.constructor=cleverapps.SPMobagePayments,cleverapps.SPMobagePayments.calcLoadedPrice=function(e){return cleverapps.MobagePayments.calcLoadedPrice(e)},cleverapps.SPMobagePayments.prototype.getSKU=function(e){var t=0;for(var s in cleverapps.PaymentsManager.PRODUCTS)if(t++,s===e.itemId)return t},cleverapps.SPMobagePayments.prototype.open=function(e,i){cleverapps.metha.display({focus:"SPMobagePaymentsOpen",action:function(e){var t=new WaitWindow,s=t.createListener(t.close.bind(t,[!0]));setTimeout(s,4e3);var i=mobage.event.subscribe("modal.afterOpen",function(){s(),mobage.event.unsubscribe(i)});cleverapps.metha.onceNoWindowsListener=e}});var t=function(s){mobage.ui.open("payment",{transactionId:s.transactionId,orderId:s.orderId},function(e,t){e?(this.reportPaymentResult(s,e),
mobage.bank.clearPaymentBacklog(s.transactionId),i(cleverapps.Social.CODE_FAILED,t)):(this.reportPaymentResult(s),i(cleverapps.Social.CODE_SUCCEED,t))}.bind(this))}.bind(this);this.createTransaction(e,t)},cleverapps.SPMobagePayments.prototype.createTransaction=function(i,n){var e=function(){var e={userId:levels.user.id.substring(levels.user.id.indexOf(":")+1),id:this.getSKU(i),name:i.title,price:parseInt(i.loadedPrice.replace("MC","").replace(" ","")),description:"ja"===cleverapps.settings.language?i.description:i.description.substring(0,i.description.lastIndexOf("!")),imageUrl:cleverapps.config.deployment.replace("https","http")+i.image,accessToken:cleverapps.social.clientData.token.accessToken},t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(s+"="+e[s]);cleverapps.RestClient.get("/spmbgapayments?"+t.join("&"),{},function(e){n(e)}.bind(this))}.bind(this);cleverapps.social.checkAccessToken(e)},cleverapps.SPMobagePayments.prototype.reportPaymentResult=function(e,t){var s={
orderId:e.orderId,transactionId:e.transactionId};t&&(s.error=!0);var i=[];for(var n in s)s.hasOwnProperty(n)&&i.push(n+"="+s[n]);cleverapps.RestClient.post("/spmbgapayments/old?"+i.join("&"),{},function(e){e&&e.transactionId&&mobage.bank.clearPaymentBacklog(e.transactionId)}.bind(this))},cleverapps.SPMobagePayments.prototype.isAvailable=function(){return!0},cleverapps.SPMobagePayments.isAppropriate=function(){return cleverapps.SPMobage.isAppropriate()},cleverapps.SPMobagePayments.prototype.validate=function(e,t){t&&t()},cleverapps.SPMobagePayments.prototype.logPurchase=function(e){},cleverapps.FacebookPayments=function(){cleverapps.CompensatePayments.call(this),cleverapps.CompensatePayments.CHECK_TIMEOUTS=["5 second","5 second","5 seconds","5 seconds","10 seconds","10 seconds"],cleverapps.CompensatePayments.VALIDATE_TIMEOUTS=["1 second","1 second","1 second","1 second","1 second","3 seconds","5 seconds","5 seconds","5 seconds","10 seconds","15 seconds","30 seconds","30 seconds",
"30 seconds"]},cleverapps.FacebookPayments.prototype=Object.create(cleverapps.CompensatePayments.prototype),cleverapps.FacebookPayments.prototype.constructor=cleverapps.FacebookPayments,cleverapps.FacebookPayments.UserCanceled=1383010,cleverapps.FacebookPayments.SuccessStatuses=["completed","active"],cleverapps.FacebookPayments.prototype.getBasePath=function(){return"fbpayments"},cleverapps.FacebookPayments.prototype.canCompensate=function(){return!0},cleverapps.FacebookPayments.prototype.open=function(s,i){var n=cleverapps.once(i),o=cleverapps.once(i);i=function(e,t){cleverapps.Social.CODE_SUCCEED===e?n(e,t):o(e,t)},this.paymentCallback=i,this.productType=s.type;var e={product:s.id.facebook,type:s.type};"subscription"===s.type?e.action="create_subscription":this.runCheckPayments(),FullscreenControlButton.exitFullscreen(function(){plugin.FacebookAgent.getInstance().canvas.pay(e,function(e,t){e===cleverapps.FacebookPayments.UserCanceled?(console.log(
"Payment "+s.itemId+" error "+t.error_message),i(cleverapps.Social.CODE_CANCELLED,t)):t&&-1===cleverapps.FacebookPayments.SuccessStatuses.indexOf(t.status)?(console.log("Payment "+s.itemId+" status: ",t.status),i(cleverapps.Social.CODE_CANCELLED,t)):(this.setPaymentChecked(),this.stopCheckPayments(),this.callPaymentCallback(t))}.bind(this))}.bind(this))},cleverapps.FacebookPayments.prototype.reactivateSubscription=function(e,t){t=t||function(){},plugin.FacebookAgent.getInstance().canvas.pay({action:"reactivate_subscription",subscription_id:e},function(e){e===cleverapps.FacebookPayments.UserCanceled&&(e=cleverapps.Social.CODE_CANCELLED),t(e)})},cleverapps.FacebookPayments.prototype.cancelSubscription=function(e,t){t=t||function(){},plugin.FacebookAgent.getInstance().canvas.pay({action:"cancel_subscription",subscription_id:e},function(e){e===cleverapps.FacebookPayments.UserCanceled&&(e=cleverapps.Social.CODE_CANCELLED),t(e)})},cleverapps.FacebookPayments.prototype.isAvailable=function(){
return!0},cleverapps.FacebookPayments.isAppropriate=function(){return!cc.sys.isNative},cleverapps.FacebookPayments.prototype.logPurchase=function(e){},cleverapps.FotoStranaPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.FotoStranaPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.FotoStranaPayments.prototype.constructor=cleverapps.FotoStranaPayments,cleverapps.FotoStranaPayments.prototype.calcLoadedPrice=function(e){return(e+" ФМ").replace(".",",")},cleverapps.FotoStranaPayments.prototype.open=function(e,t){var s=["FS_113127743","FS_76785158","FS_113139157","FS_113139202"].indexOf(cleverapps.user.id)?1:0;t=cleverapps.once(t),FSClient.event("buyItemCallback",function(e){t("success"===e.result?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},{itemId:e.id.mymailru,name:e.description,forwardData:e.itemId,
picUrl:cleverapps.config.deployment+e.image.replace("fbproducts","fsproducts"),priceFmCents:Math.floor(100*e.price),isDebug:s})},cleverapps.FotoStranaPayments.prototype.isAvailable=function(){return!0},cleverapps.FotoStranaPayments.prototype.validate=function(e,t){t&&t()},cleverapps.FotoStranaPayments.isAppropriate=function(){return cleverapps.FotoStrana.isAppropriate()},cleverapps.FotoStranaPayments.prototype.logPurchase=function(e){},cleverapps.IAPWebViewPayments=function(){cleverapps.Payments.call(this),cc.sys.os===cc.sys.OS_IOS&&(PurchasesPlugin=cleverapps.IOSWebViewPurchasesPluginAdapter),this.consumed={},this.load(),PurchasesPlugin.init(),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.checkInitialized.bind(this)),setInterval(this.checkInitialized.bind(this),cleverapps.parseInterval("2 minutes")),this.startTime=Date.now(),this.purchaseCallback=function(){}},cleverapps.IAPWebViewPayments.prototype=Object.create(cleverapps.Payments.prototype),
cleverapps.IAPWebViewPayments.prototype.constructor=cleverapps.IAPWebViewPayments,cleverapps.IAPWebViewPayments.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.WEBVIEW_PAYMENTS);e&&e.consumed&&(this.consumed=e.consumed)},cleverapps.IAPWebViewPayments.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.WEBVIEW_PAYMENTS,{consumed:this.consumed})},cleverapps.IAPWebViewPayments.prototype.setConsumed=function(e){this.consumed[e]||(this.consumed[e]=1,this.save())},cleverapps.IAPWebViewPayments.prototype.checkInitialized=cleverapps.timeredThrottle(1e3,function(){this.initialized?this.refreshed?this.refreshedSubscriptions?this.refreshedSubscriptionsTokens?this.requestedStoreProduct||this.requestStoreProduct():this.refreshSubscriptionsTokens():PurchasesPlugin.refresh("subscription"):PurchasesPlugin.refresh("consumable"):PurchasesPlugin.init()}),cleverapps.IAPWebViewPayments.prototype.requestStoreProduct=function(){
PurchasesPlugin.requestStoreProduct&&PurchasesPlugin.requestStoreProduct(),console.log("IAPWebViewPayments.requestStoreProduct"),this.requestedStoreProduct=!0},cleverapps.IAPWebViewPayments.prototype.onRequestStoreProduct=function(e){this.storeProductName=e,console.log("IAPWebViewPayments.onRequestStoreProduct - "+e),this.checkInitialized(),this.buyStoreProduct()},cleverapps.IAPWebViewPayments.prototype.buyStoreProduct=function(){if(this.storeProductName&&!cleverapps.metha.isFocused()){var t=this.findProductByName(this.storeProductName);delete this.storeProductName,t&&cleverapps.metha.display({focus:"buyStoreProduct",action:function(e){cleverapps.payments.oncePaymentFinished=e,(t=Product.Create(t.key)).buy()}})}},cleverapps.IAPWebViewPayments.prototype.refreshSubscriptionsTokens=function(){if(void 0!==PurchasesPlugin.getSubscriptionsTokens&&cleverapps.subscription){var e=decodeWebViewData(PurchasesPlugin.getSubscriptionsTokens());if(e.error)return void console.log(
"IAPWebViewPayments.refreshSubscriptionsTokens error "+e.error);cleverapps.subscription.addPurchaseTokens(e)}this.refreshedSubscriptionsTokens=!0,this.checkInitialized()},cleverapps.IAPWebViewPayments.prototype.addSubscriptionTokens=function(e,t){Array.isArray(e)||(e=[e]);var i=cleverapps.User.calcSource();if(-1!==["android","ios"].indexOf(i)&&cleverapps.subscription){var s=e.map(function(e){var t=this.findProductByName(e.name);if(t&&"subscription"===t.type){var s={name:e.name};return"android"===i?(s.purchaseToken=e.receipt.purchaseToken,s.packageName=e.receipt.packageName,s.productId=e.receipt.productId):(s.purchaseToken=e.receipt,s.packageName=e.packageName,s.productId=e.productId),s}}.bind(this)).filter(function(e){return e});0<s.length&&cleverapps.subscription.addPurchaseTokens(s,t)}},cleverapps.IAPWebViewPayments.prototype.onRestoreSuccess=function(e){e=decodeWebViewData(e),console.log("IAPWebViewPayments.onRestoreSuccess"+e.length,e),e=JSON.parse(e),this.restoreCallback&&(
this.restoreCallback(cleverapps.Social.CODE_SUCCEED),delete this.restoreCallback),this.addSubscriptionTokens(e,!0)},cleverapps.IAPWebViewPayments.prototype.onPurchaseSuccess=function(e){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_SUCCESS,!0),e=decodeWebViewData(e),console.log("IAPWebViewPayments.onPurchaseSuccess",e),e=JSON.parse(e),this.addSubscriptionTokens(e),this.purchaseCallback(cleverapps.Social.CODE_SUCCEED,e)},cleverapps.IAPWebViewPayments.prototype.logError=function(t,s){if(console.log("IAPWebViewPayments."+t,s),s){var e=function(e){cleverapps.throwAsync(t+" "+e+" "+s)};-1!==s.indexOf("client is null or not ready")?e(0):"service timeout"===s?e(1):"feature not support"===s?e(2):"service disconnected"===s?e(3):"user canceled"===s?e(4):"service unavailable"===s?e(5):"billing unavailable"===s?e(6):"item unavailable"===s?e(7):"developer error"===s?e(8):"item already owned"===s?e(9):"item not owned"===s?e(10):-1!==s.indexOf("cant find product:")?e(11):-1!==s.indexOf(
"cant find sku details:")?e(12):e("transaction failed"===s?13:"network unreachable"===s?14:"unknown error"===s?15:"client is not allowed to issue the request"===s?16:"purchase identifier was invalid"===s?17:"this device is not allowed to make the payment"===s?18:19)}},cleverapps.IAPWebViewPayments.prototype.onPurchaseFailure=function(e){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_FAILURE,!0),this.logError("onPurchaseFailure",decodeWebViewData(e)),this.purchaseCallback(cleverapps.Social.CODE_FAILED)},cleverapps.IAPWebViewPayments.prototype.onRestoreFailure=function(e){this.restoreCallback&&(this.restoreCallback(cleverapps.Social.CODE_FAILED),delete this.restoreCallback),console.log("IAPWebViewPayments.onRestoreFailure",decodeWebViewData(e))},cleverapps.IAPWebViewPayments.prototype.onPurchaseCancelled=function(){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_CANCEL,!0),console.log("IAPWebViewPayments.onPurchaseCancelled"),this.purchaseCallback(
cleverapps.Social.CODE_CANCELLED)},cleverapps.IAPWebViewPayments.prototype.onInitialized=function(e,t){e?(this.initialized=!0,this.checkInitialized()):(this.onInitializedError=decodeWebViewData(t),console.log("IAPWebViewPayments.onInitialized",this.onInitializedError),this.initialized=!1)},cleverapps.IAPWebViewPayments.prototype.onProductRequestSuccess=function(e,t){t=decodeWebViewData(t),console.log("IAPWebViewPayments.onProductRequestSuccess "+e,t),t=JSON.parse(t);for(var s=0;s<t.length;s++){var i=this.findProductByName(t[s].name);void 0!==i&&(i.loadedPrice=t[s].price,i.loadedCurrencyCode=t[s].price_currency_code,i.loadedPriceAmount=t[s].price_amount_micros/1e6,this.loadedCurrencyCode||(this.loadedCurrencyCode=i.loadedCurrencyCode),console.log("iapwebviewpayments product "+t[s].productId+" "+i.loadedPrice+" "+i.loadedCurrencyCode+" "+i.loadedPriceAmount))}"consumable"===e?this.refreshed=!0:"subscription"===e&&(this.refreshedSubscriptions=!0),this.checkInitialized()},
cleverapps.IAPWebViewPayments.prototype.isProductExists=function(e){var t=cleverapps.config.products[e];return t&&t.loadedPrice},cleverapps.IAPWebViewPayments.prototype.findProductByName=function(e){for(var t in cleverapps.config.products){var s=cleverapps.config.products[t];if((cc.sys.os===cc.sys.OS_IOS?s.id.ios:s.id.android)===e)return s}},cleverapps.IAPWebViewPayments.prototype.restore=function(e){e=e||function(){},PurchasesPlugin.restore&&this.initialized?(this.restoreCallback=e,PurchasesPlugin.restore()):e(!1)},cleverapps.IAPWebViewPayments.prototype.open=function(e,s){cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_OPEN,!0),s=s||function(){};var t=Math.floor((Date.now()-this.startTime)/1e3);if(!this.initialized)return this.logError("onInitialized "+t+"s",this.onInitializedError),cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_NOT_INITIALIZED,!0),void s(cleverapps.Social.CODE_FAILED);if(!this.refreshed||"subscription"===e.type&&!this.refreshedSubscriptions
)return this.logError("onProductRequestError "+t+"s debugMessage - "+this.onProductRequestErrorMessage,this.onProductRequestError),cleverapps.playSession.set(cleverapps.EVENTS.PAYMENT_NOT_REFRESHED,!0),void s(cleverapps.Social.CODE_FAILED);this.purchaseCallback=function(e,t){s.apply(this,arguments)}.bind(this);var i=cc.sys.os===cc.sys.OS_IOS?e.id.ios:e.id.android;PurchasesPlugin.hasProductByName(i)||cleverapps.throwAsync("Product '"+i+"' not configured correctly (please check sdkbox_config.json)");var n=this.findProductByName(i);void 0===n||n.loadedPrice||cleverapps.throwAsync("Product '"+i+"' has not loaded price"),PurchasesPlugin.purchase(i)},cleverapps.IAPWebViewPayments.prototype.onProductRequestFailure=function(e,t,s){this.onProductRequestError=decodeWebViewData(t),this.onProductRequestErrorMessage=decodeWebViewData(s)||"",console.log("IAPWebViewPayments.onProductRequestFailure "+e,this.onProductRequestError,this.onProductRequestErrorMessage)},
cleverapps.IAPWebViewPayments.prototype.isAvailable=function(){return!0},cleverapps.IAPWebViewPayments.prototype.validate=function(e,t,s){if(t=t||function(){},-1!==["android","ios"].indexOf(cleverapps.User.calcSource())){var i={userid:cleverapps.user.id,compensate:e.compensate};cc.sys.os===cc.sys.OS_IOS?(i.receipt=e.receipt,i.productId=e.productId,i.packageName=e.packageName,i.platform="apple"):cc.sys.os===cc.sys.OS_ANDROID&&(i.receipt=e.receipt.purchaseToken,i.packageName=e.receipt.packageName,i.productId=e.receipt.productId,i.platform="google");var n=this.findProductByName(e.name);i.type=n&&n.type;var o={amount:n&&n.price?Math.round(n.price):1};cleverapps.RestClient.post("/purchasevalidator/validate/",i,function(e){console.log("IAPWebViewPayments.validate - Success purchase validate - "+JSON.stringify(e)),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PURCHASE_VALIDATE_SUCCESS,o),t()},function(){console.log("IAPWebViewPayments.validate - Failure purchase validate"),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PURCHASE_VALIDATE_FAILURE,o),s&&s()})}else t()},cleverapps.IAPWebViewPayments.prototype.logPurchase=function(e){var t=e.orderId||e.receipt.orderId,s=this.findProductByName(e.name),i=s?s.price:0,n="USD";e.price_amount_micros&&e.price_currency_code?(i=e.price_amount_micros/1e6,n=e.price_currency_code):s.loadedPriceAmount&&s.loadedCurrencyCode&&(i=s.loadedPriceAmount,n=s.loadedCurrencyCode),cc.sys.os===cc.sys.OS_IOS||FacebookPlugin.logPurchase(i,n),cleverapps.adjust.logPurchase(t,i,n)},cleverapps.IAPWebViewPayments.prototype.calcLoadedPrice=function(e){var t=cleverapps.EXCHANGE_RATES[this.loadedCurrencyCode];if(t){var s=Product.CURRENCY_CODE===this.loadedCurrencyCode?Product.CURRENCY:this.loadedCurrencyCode;return Math.ceil(e*t)+".00 "+s}return Product.CURRENCY+" "+e},cleverapps.IAPWebViewPayments.isAppropriate=function(){return cc.sys.isNative&&cc.sys.isWebView&&("undefined"!=typeof PurchasesPlugin||cc.sys.os===cc.sys.OS_IOS)},
cleverapps.IAPWebViewPayments.prototype.canCompensate=function(){return void 0!==PurchasesPlugin.compensate&&cc.sys.os===cc.sys.OS_ANDROID},cleverapps.IAPWebViewPayments.prototype.compensate=function(){this.compensateProductCode||this.compensateRunning||(PurchasesPlugin.compensate(JSON.stringify(this.consumed)),this.compensateRunning=!0)},cleverapps.IAPWebViewPayments.prototype.onConsumeError=cleverapps.throttle(cleverapps.parseInterval("1 day"),function(e){cleverapps.throwAsync("IAPWebViewPayments.onConsumeError - "+e)}),cleverapps.IAPWebViewPayments.prototype.onCompensateResult=function(e,t){if(t=decodeWebViewData(t),console.log("IAPWebViewPayments.onCompensateResult - "+e+" - "+t),this.compensateRunning=!1,e)this.onConsumeError(e);else{var s=t&&JSON.parse(t),i=this.findProductByName(s&&s.name),n=s&&s.receipt&&s.receipt.orderId;if(s&&s.name&&n&&i){s.compensate=!0,this.compensateRunning=!0;var o=function(){console.log("IAPWebViewPayments.compensate - validate purchase success"),
this.compensateRunning=!1,this.compensatePurchase=s,this.compensateProductCode=i.key}.bind(this),r=function(){console.log("IAPWebViewPayments.compensate - validate purchase error"),this.compensateRunning=!1,this.setConsumed(n)}.bind(this);this.validate(s,o,r)}}},cleverapps.IAPWebViewPayments.prototype.compensateValidate=function(e){console.log("IAPWebViewPayments.compensateValidate - start");var t=this.compensatePurchase;t&&(console.log("IAPWebViewPayments.compensateValidate - success "+t.receipt.orderId),delete this.compensatePurchase,e())},cleverapps.IOSWebViewPurchasesPluginAdapter={init:function(){console.log("IOSWebViewPurchasesPluginAdapter init"),webkitMessage("purchase",{action:"init"})},refresh:function(e){console.log("IOSWebViewPurchasesPluginAdapter refresh"),webkitMessage("purchase",{action:"refresh",type:e})},hasProductByName:function(e){return!0},purchase:function(e){webkitMessage("purchase",{action:"purchase",productName:e})},restore:function(e){webkitMessage("purchase",
{action:"restore"})},requestStoreProduct:function(){webkitMessage("purchase",{action:"requestStoreProduct"})}},void 0===cleverapps)cleverapps={config:{source:void 0}};if(void 0===config)var config={debugMode:void 0};if(void 0===LivesProductTile)LivesProductTile=void 0;if(void 0===PackProductTile)PackProductTile=void 0;cleverapps.PaymentsManager={init:function(){var t=cleverapps.clone(cleverapps.PaymentsManager.PRODUCTS,!0);cleverapps.override(t,cleverapps.config.products||{}),Object.keys(t).forEach(function(e){!1===t[e]&&delete t[e]}),cleverapps.config.products=t;var e=null;return cleverapps.NoPayments.isAppropriate()?e=new cleverapps.NoPayments:cleverapps.IAPWebViewPayments.isAppropriate()?e=new cleverapps.IAPWebViewPayments:cleverapps.XsollaPayments.isAppropriate()?e=new cleverapps.XsollaPayments:cleverapps.FakePayments.isAppropriate()?e=new cleverapps.FakePayments:cleverapps.InstantPayments.isAppropriate()?e=new cleverapps.InstantPayments:cleverapps.MobileOKPayments.isAppropriate(
)?e=new cleverapps.MobileOKPayments:cleverapps.SPMobagePayments.isAppropriate()?e=new cleverapps.SPMobagePayments:cleverapps.OKPayments.isAppropriate()?e=new cleverapps.OKPayments:cleverapps.MobileMyMailRuPayments.isAppropriate()?e=new cleverapps.MobileMyMailRuPayments:cleverapps.MyMailRuPayments.isAppropriate()?e=new cleverapps.MyMailRuPayments:cleverapps.MobileVkPayments.isAppropriate()?e=new cleverapps.MobileVkPayments:cleverapps.VKPayments.isAppropriate()?e=new cleverapps.VKPayments:cleverapps.MobagePayments.isAppropriate()?e=new cleverapps.MobagePayments:cleverapps.FotoStrana.isAppropriate()?e=new cleverapps.FotoStranaPayments:cleverapps.NK.isAppropriate()?e=new cleverapps.NKPayments:cleverapps.Draugiem.isAppropriate()?e=new cleverapps.DraugiemPayments:cleverapps.FacebookPayments.isAppropriate()&&(e=new cleverapps.FacebookPayments),e.onAvailableListeners=e.onAvailableListeners||{},e.canCompensate=e.canCompensate||function(){},e}},cleverapps.PaymentsManager.PRODUCTS={buyExp10:{id:{
facebook:"buyexp10.html",android:"buyexp10",ios:"buyexp10",instant:"buyexp10",mymailru:1},title:"messages:Shop.BuyExp10.Title",description:"messages:Shop.BuyExp10.Description",boughtMessage:"messages:Shop.BuyExp10.BoughtMessage",image:"/res/fbproducts/buyexp10.png",price:9.99,reward:{exp:10}},buyExp150:{id:{facebook:"buyexp150.html",android:"buyexp150",ios:"buyexp150",instant:"buyexp150",mymailru:2},title:"messages:Shop.BuyExp150.Title",description:"messages:Shop.BuyExp150.Description",boughtMessage:"messages:Shop.BuyExp150.BoughtMessage",image:"/res/fbproducts/buyexp150.png",price:99.99,reward:{exp:150}},addMoves1:{id:{facebook:"addmoves1.html",android:"addmoves1",ios:"addmoves1",instant:"addmoves1",mymailru:8},title:"messages:Shop.AddMoves1.Title",description:"messages:Shop.AddMoves1.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:.99,moves:5,bonus:1,compensateReward:{gold:200}},addMoves2:{id:{facebook:"addmoves2.html",
android:"addmoves2",ios:"addmoves2",instant:"addmoves2",mymailru:9},title:"messages:Shop.AddMoves2.Title",description:"messages:Shop.AddMoves2.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:1.99,moves:10,bonus:1,compensateReward:{gold:400}},addMoves3:{id:{facebook:"addmoves3.html",android:"addmoves3",ios:"addmoves3",instant:"addmoves3",mymailru:10},title:"messages:Shop.AddMoves3.Title",description:"messages:Shop.AddMoves3.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:2.99,moves:15,bonus:1,compensateReward:{gold:600}},addMoves5:{id:{facebook:"addmoves5.html",android:"addmoves5",ios:"addmoves5",instant:"addmoves5",mymailru:11},title:"messages:Shop.AddMoves5.Title",description:"messages:Shop.AddMoves5.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves.png",price:4.99,moves:15,bonus:2,compensateReward:{gold:1e3}},
piggybank500:{id:{facebook:"piggybank500.html",android:"piggybank500",ios:"piggybank500",instant:"piggybank500",mymailru:12},title:"messages:Shop.PiggyBank1.Title",description:"messages:Shop.PiggyBank1.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:2.99,reward:{gold:500}},piggybank1800:{id:{facebook:"piggybank1800.html",android:"piggybank1800",ios:"piggybank1800",instant:"piggybank1800",mymailru:13},title:"messages:Shop.PiggyBank2.Title",description:"messages:Shop.PiggyBank2.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:9.99,reward:{gold:1800}},piggybank6000:{id:{facebook:"piggybank6000.html",android:"piggybank6000",ios:"piggybank6000",instant:"piggybank6000",mymailru:14},title:"messages:Shop.PiggyBank3.Title",description:"messages:Shop.PiggyBank3.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:29.99,reward:{gold:6e3}},piggybank25000:{id:{facebook:"piggybank25000.html",android:"piggybank25000",ios:"piggybank25000",instant:"piggybank25000",
mymailru:15},title:"messages:Shop.PiggyBank4.Title",description:"messages:Shop.PiggyBank4.Description",image:"/res/fbproducts/piggy_bank.png?v=1",price:99.99,reward:{gold:25e3}},gunShot:{id:{facebook:"gunshot.html",android:"gunshot",ios:"gunshot",instant:"gunshot",mymailru:16},title:"messages:Shop.GunShot.Title",description:"messages:Shop.GunShot.Description",boughtMessage:"messages:Shop.GunShot.BoughtMessage",image:"/res/fbproducts/gunshot.png?v=5",price:1.99,reward:{gun:1},compensateReward:{gold:400}},addMoves:{id:{facebook:"addmoves.html",android:"addmoves",ios:"addmoves",instant:"addmoves",mymailru:20},title:"messages:Shop.AddMoves.Title",description:"messages:Shop.AddMoves.Description",boughtMessage:"messages:Shop.AddMoves.BoughtMessage",image:"/res/fbproducts/addmoves0.png",price:.99,compensateReward:{gold:200}},gold500:{id:{facebook:"500gold.html",android:"500gold",ios:"500gold",instant:"500gold",mymailru:21},title:"messages:Shop.Gold500.Title",
description:"messages:Shop.Gold500.Description",image:"/res/fbproducts/gold2_200.png?v=2",price:2.99,videoPrice:10,videoReward:{gold:150},reward:{gold:500},icon:"shop_gold2_png"},gold1800:{id:{facebook:"1800gold.html",android:"1800gold",ios:"1800gold",instant:"1800gold",mymailru:22},title:"messages:Shop.Gold1800.Title",description:"messages:Shop.Gold1800.Description",image:"/res/fbproducts/gold3_200.png?v=1",price:9.99,oldPrice:1.99,videoPrice:30,videoReward:{gold:500},label:1800,reward:{gold:1800},icon:"shop_gold3_png"},gold3800:{id:{facebook:"3800gold.html",android:"3800gold",ios:"3800gold",instant:"3800gold",mymailru:39},title:"messages:Shop.Gold3800.Title",description:"messages:Shop.Gold3800.Description",image:"/res/fbproducts/heap_gold.png?v=1",price:19.99,videoPrice:50,videoReward:{gold:1e3},reward:{gold:3800},icon:"heap_gold_png"},gold6000:{id:{facebook:"6000gold.html",android:"6000gold",ios:"6000gold",instant:"6000gold",mymailru:23},title:"messages:Shop.Gold6000.Title",
description:"messages:Shop.Gold6000.Description",image:"/res/fbproducts/gold4_200.png?v=1",price:29.99,oldPrice:5.99,videoPrice:100,videoReward:{gold:2500},label:6e3,reward:{gold:6e3},icon:"shop_gold4_png"},gold25000:{id:{facebook:"25000gold.html",android:"25000gold",ios:"25000gold",instant:"25000gold",mymailru:24},title:"messages:Shop.Gold25000.Title",description:"messages:Shop.Gold25000.Description",image:"/res/fbproducts/gold5_200.png?v=1",price:99.99,videoPrice:300,videoReward:{gold:1e4},reward:{gold:25e3},icon:"shop_gold5_png"},starterPack0:{id:{facebook:"starterpack0.html",android:"starterpack0",ios:"starterpack0",instant:"starterpack0",mymailru:25},title:"messages:StarterPack0.Title",description:"messages:StarterPack0.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack0.Title"},image:"/res/fbproducts/starter_pack0.png?v=1",price:.99},starterPack:{id:{facebook:"starterpack.html",android:"starterpack",ios:"starterpack",
instant:"starterpack",mymailru:26},title:"messages:StarterPack1.Title",description:"messages:StarterPack1.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack1.Title"},image:"/res/fbproducts/starter_pack.png?v=1",price:4.99},starterPack2:{id:{facebook:"starterpack2.html",android:"starterpack2",ios:"starterpack2",instant:"starterpack2",mymailru:27},title:"messages:StarterPack2.Title",description:"messages:StarterPack2.Description",boughtMessage:"messages:StarterPack.Bought",boughtMessageParams:{title:"messages:StarterPack2.Title"},image:"/res/fbproducts/starter_pack2.png?v=1",price:29.99},subsWeek:{id:{facebook:"subsweek.html",android:"subsweek",ios:"subsweek",ok:"subsweek",mymailru:31},title:"messages:Shop.SubsWeek.Title",description:"messages:Shop.SubsWeek.Description",boughtMessage:"messages:Shop.SubsWeek.BoughtMessage",image:"/res/fbproducts/premium.png",price:9.99,trial:"1 day",period:"2 weeks",type:"subscription",projects:[
"riddles","heroes","wordsoup","crocword","olympics","tripeaks","scramble","magicwords"]},subsMonth:{id:{facebook:"subsmonth.html",android:"subsmonth",ios:"subsmonth",ok:"subsmonth",mymailru:32},title:"messages:Shop.SubsMonth.Title",description:"messages:Shop.SubsMonth.Description",boughtMessage:"messages:Shop.SubsMonth.BoughtMessage",image:"/res/fbproducts/premium.png",price:14.99,period:"1 month",type:"subscription",projects:["riddles","heroes","wordsoup","crocword","olympics","tripeaks","scramble","magicwords"]},subsWeekTest:{id:{facebook:"subsweektest.html",android:"subsweektest",ios:"subsweektest",ok:"subsweektest",mymailru:33},title:"messages:Shop.SubsWeek.Title",description:"messages:Shop.SubsWeek.Description",boughtMessage:"messages:Shop.SubsWeek.BoughtMessage",image:"/res/fbproducts/premium.png",price:.05,trial:"1 day",period:"2 weeks",type:"subscription",projects:["riddles","heroes","wordsoup","crocword"]},subsMonthTest:{id:{facebook:"subsmonthtest.html",
android:"subsmonthtest",ios:"subsmonthtest",ok:"subsmonthtest",mymailru:34},title:"messages:Shop.SubsMonth.Title",description:"messages:Shop.SubsMonth.Description",boughtMessage:"messages:Shop.SubsMonth.BoughtMessage",image:"/res/fbproducts/premium.png",price:.1,period:"1 month",type:"subscription",projects:["riddles","heroes","wordsoup","crocword"]},cellPack05:{id:{facebook:"cellpack05.html",android:"cellpack05",ios:"cellpack05",instant:"cellpack05",mymailru:46},title:"messages:TileShop.cellPack05.Title",description:"messages:TileShop.cellPack05.Description",image:"/res/fbproducts/cell_pack_200.png",boughtMessage:"messages:Shop.cellPack05.boughtMessage",price:.49,oldPrice:4.99,reward:{boosters:{0:5}},icon:"cellbooster_png",label:5},linePack074:{id:{facebook:"linepack074.html",android:"linepack074",ios:"linepack074",instant:"linepack074",mymailru:47},title:"messages:TileShop.linePack074.Title",description:"messages:TileShop.linePack074.Description",
image:"/res/fbproducts/line_pack_200.png",boughtMessage:"messages:Shop.linePack074.boughtMessage",price:.74,oldPrice:7.49,reward:{boosters:{1:5}},icon:"linebooster_png",label:5},colorPack10:{id:{facebook:"colorpack10.html",android:"colorpack10",ios:"colorpack10",instant:"colorpack10",mymailru:48},title:"messages:TileShop.colorPack10.Title",description:"messages:TileShop.colorPack10.Description",image:"/res/fbproducts/color_pack_200.png",boughtMessage:"messages:Shop.colorPack10.boughtMessage",price:.99,oldPrice:9.99,reward:{boosters:{2:5}},icon:"colorbooster_png",label:5},cellPack2:{id:{facebook:"cellpack2.html",android:"cellpack2",ios:"cellpack2",instant:"cellpack2",mymailru:49},title:"messages:TileShop.cellPack10.Title",description:"messages:TileShop.cellPack10.Description",image:"/res/fbproducts/cell_pack_200.png",boughtMessage:"messages:Shop.cellPack10.boughtMessage",price:1.99,oldPrice:19.99,reward:{boosters:{0:10}},icon:"cellbooster_png",label:10},linePack3:{id:{
facebook:"linepack3.html",android:"linepack3",ios:"linepack3",instant:"linepack3",mymailru:50},title:"messages:TileShop.linePack15.Title",description:"messages:TileShop.linePack15.Description",image:"/res/fbproducts/line_pack_200.png",boughtMessage:"messages:Shop.linePack15.boughtMessage",price:2.99,oldPrice:29.99,reward:{boosters:{1:10}},icon:"linebooster_png",label:10},colorPack4:{id:{facebook:"colorpack4.html",android:"colorpack4",ios:"colorpack4",instant:"colorpack4",mymailru:51},title:"messages:TileShop.colorPack20.Title",description:"messages:TileShop.colorPack20.Description",image:"/res/fbproducts/color_pack_200.png",boughtMessage:"messages:Shop.colorPack20.boughtMessage",price:3.99,oldPrice:39.99,reward:{boosters:{2:10}},icon:"colorbooster_png",label:10},unlimitedLives05:{id:{facebook:"unlimitedlives05.html",android:"unlimitedlives05",ios:"unlimitedlives05",instant:"unlimitedlives05",mymailru:52},title:"messages:UnlimitedLives.Title",
description:"messages:TileShop.unlimitedLives05.Description",image:"/res/fbproducts/unlimitedlives.png",boughtMessage:"messages:UnlimitedLivesBought",price:.49,oldPrice:2.99,reward:{unlimitedLives:"3 days"},icon:"life_unlim",label:"messages:UnlimitedLives.3 day"},lives074:{id:{facebook:"lives074.html",android:"lives074",ios:"lives074",instant:"lives074",mymailru:53},title:"messages:TileShop.lives074.Title",description:"messages:TileShop.lives074.Description",image:"/res/fbproducts/lives.png",boughtMessage:"messages:Shop.lives074.boughtMessage",price:.74,oldPrice:7.49,reward:{lives:50},icon:"level_failed_heart_png",label:50},exp1:{id:{facebook:"exp1.html",android:"exp1",ios:"exp1",instant:"exp1",mymailru:54},title:"messages:TileShop.exp1.Title",description:"messages:TileShop.exp1.Description",image:"/res/fbproducts/buyexp150.png",boughtMessage:"messages:Shop.exp1.boughtMessage",price:.99,oldPrice:19.99,reward:{exp:25},icon:"exp_png",label:25},unlimitedLives2:{id:{
facebook:"unlimitedlives2.html",android:"unlimitedlives2",ios:"unlimitedlives2",instant:"unlimitedlives2",mymailru:55},title:"messages:UnlimitedLives.Title",description:"messages:TileShop.unlimitedLives2.Description",image:"/res/fbproducts/unlimitedlives.png",boughtMessage:"messages:UnlimitedLivesBought",price:1.99,oldPrice:4.99,reward:{unlimitedLives:"5 days"},icon:"life_unlim",label:"messages:UnlimitedLives.5 day"},lives3:{id:{facebook:"lives3.html",android:"lives3",ios:"lives3",instant:"lives3",mymailru:56},title:"messages:TileShop.lives3.Title",description:"messages:TileShop.lives3.Description",image:"/res/fbproducts/lives.png",boughtMessage:"messages:Shop.lives3.boughtMessage",price:2.99,oldPrice:29.99,reward:{lives:100},icon:"level_failed_heart_png",label:100},exp4:{id:{facebook:"exp4.html",android:"exp4",ios:"exp4",instant:"exp4",mymailru:57},title:"messages:TileShop.exp4.Title",description:"messages:TileShop.exp4.Description",image:"/res/fbproducts/buyexp150.png",
boughtMessage:"messages:Shop.exp4.boughtMessage",price:3.99,oldPrice:39.99,reward:{exp:50},icon:"exp_png",label:50},gold500sale:{id:{facebook:"500goldsale.html",android:"500goldsale",ios:"500goldsale",instant:"500goldsale",mymailru:65},title:"messages:Shop.Gold500.Title",description:"messages:Shop.Gold500.Description",image:"/res/fbproducts/gold2_200.png",price:.99,oldPrice:2.99,label:500,reward:{gold:500},icon:"shop_gold2_png"},gold1800sale:{id:{facebook:"1800goldsale.html",android:"1800goldsale",ios:"1800goldsale",instant:"1800goldsale",mymailru:59},title:"messages:Shop.Gold1800.Title",description:"messages:Shop.Gold1800.Description",image:"/res/fbproducts/gold3_200.png",price:2.99,oldPrice:9.99,label:1800,reward:{gold:1800},icon:"shop_gold3_png"},gold6000sale:{id:{facebook:"6000goldsale.html",android:"6000goldsale",ios:"6000goldsale",instant:"6000goldsale",mymailru:60},title:"messages:Shop.Gold6000.Title",description:"messages:Shop.Gold6000.Description",
image:"/res/fbproducts/gold4_200.png",price:5.99,oldPrice:29.99,label:6e3,reward:{gold:6e3},icon:"shop_gold4_png"},unlimitedLives:{id:{facebook:"unlimitedlives.html",android:"unlimitedlives",ios:"unlimitedlives",instant:"unlimitedlives",mymailru:64},title:"messages:UnlimitedLives.Title",description:"messages:UnlimitedLives.Description",boughtMessage:"messages:UnlimitedLivesBought",image:"/res/fbproducts/unlimitedlives.png",price:2.99,reward:{unlimitedLives:"3 days"},icon:"unlimitedLives_png",animation:"animation",ViewClassName:LivesProductTile},gold1:{id:{facebook:"gold1.html",android:"gold1",ios:"gold1",instant:"gold1",mymailru:62},title:"messages:TileShop.gold1.Title",description:"messages:TileShop.gold1.Description",image:"/res/fbproducts/gold2_200.png",boughtMessage:"messages:Shop.gold1.boughtMessage",price:.99,oldPrice:9.99,reward:{gold:1e3},icon:"boosters_sale_coin_png",label:"1000"},gold4:{id:{facebook:"gold4.html",android:"gold4",ios:"gold4",instant:"gold4",mymailru:63},
title:"messages:TileShop.gold4.Title",description:"messages:TileShop.gold4.Description",image:"/res/fbproducts/gold4_200.png",boughtMessage:"messages:Shop.gold4.boughtMessage",price:3.99,oldPrice:39.99,reward:{gold:5e3},icon:"boosters_sale_coin_png",label:"5000"},coins150:{id:{facebook:"150coins.html",android:"150coins",ios:"150coins",instant:"150coins",mymailru:69},title:"messages:Shop.Coins150.Title",description:"messages:Shop.Coins150.Description",image:"/res/fbproducts/soft_currency_small_200.png?v=2",price:.99,reward:{coins:150},icon:"soft_currency_small_png",boughtMessage:"messages:Product.SoftCurrencyBought"},coins1000:{id:{facebook:"1000coins.html",android:"1000coins",ios:"1000coins",instant:"1000coins",mymailru:70},title:"messages:Shop.Coins1000.Title",description:"messages:Shop.Coins1000.Description",image:"/res/fbproducts/soft_currency_medium_200.png?v=2",price:4.99,reward:{coins:1e3},icon:"soft_currency_medium_png",boughtMessage:"messages:Product.SoftCurrencyBought"},
coins2500:{id:{facebook:"2500coins.html",android:"2500coins",ios:"2500coins",instant:"2500coins",mymailru:71},title:"messages:Shop.Coins2500.Title",description:"messages:Shop.Coins2500.Description",image:"/res/fbproducts/soft_currency_large_200.png?v=2",price:9.99,reward:{coins:2500},icon:"soft_currency_large_png",boughtMessage:"messages:Product.SoftCurrencyBought"}},cleverapps.PaymentsManager.SCRAMBLE_PRODUCTS={highlightPack1:{id:{facebook:"highlightpack1.html",android:"highlightpack1",ios:"highlightpack1",instant:"highlightpack1",mymailru:66},title:"messages:TileShop.highlightPack1.Title",description:"messages:TileShop.highlightPack1.Description",image:"/res/fbproducts/highlight_booster_200.png",boughtMessage:"messages:Shop.highlightPack1.boughtMessage",price:.99,oldPrice:1.99,reward:{boosters:{13:10}},icon:"highlight",label:"x10",ViewClassName:PackProductTile},eyePack2:{id:{facebook:"eyepack2.html",android:"eyepack2",ios:"eyepack2",instant:"eyepack2",mymailru:67},
title:"messages:TileShop.eyePack2.Title",description:"messages:TileShop.eyePack2.Description",image:"/res/fbproducts/eye_booster_200.png",boughtMessage:"messages:Shop.eyePack2.boughtMessage",price:1.99,oldPrice:4.99,reward:{boosters:{14:10}},icon:"eye",label:"x10",ViewClassName:PackProductTile},hintBoosterBeforePack3:{id:{facebook:"hintboosterbeforepack3.html",android:"hintboosterbeforepack3",ios:"hintboosterbeforepack3",instant:"hintboosterbeforepack3",mymailru:68},title:"messages:TileShop.hintBoosterBeforePack3.Title",description:"messages:TileShop.hintBoosterBeforePack3.Description",image:"/res/fbproducts/hint_booster_before_200.png",boughtMessage:"messages:Shop.hintBoosterBeforePack3.boughtMessage",price:2.99,oldPrice:6.99,reward:{boosters:{15:10}},icon:"bonus_hint_sale_png",label:"x10",ViewClassName:PackProductTile}},cleverapps.PaymentsManager.PACK_PRODUCTS={sweetPack:{id:{facebook:"sweetpack.html",android:"sweetpack",ios:"sweetpack",instant:"sweetpack",mymailru:35},
title:"messages:TileShop.sweetPack.Title",description:"messages:TileShop.sweetPack.Description",image:"/res/fbproducts/sweet_pack_200.png",boughtMessage:"messages:Shop.sweetPack.boughtMessage",price:5.99,reward:{gold:500,boosters:{0:1,1:1}},icon:"sweet_pack_png",ViewClassName:PackProductTile},jamPack:{id:{facebook:"jampack.html",android:"jampack",ios:"jampack",instant:"jampack",mymailru:36},title:"messages:TileShop.jamPack.Title",description:"messages:TileShop.jamPack.Description",image:"/res/fbproducts/jam_pack_200.png",boughtMessage:"messages:Shop.jamPack.boughtMessage",price:12.99,reward:{gold:1800,boosters:{0:1,1:1,2:1}},icon:"jam_pack_png",ViewClassName:PackProductTile},tastyPack:{id:{facebook:"tastypack.html",android:"tastypack",ios:"tastypack",instant:"tastypack",mymailru:40},title:"messages:TileShop.tastyPack.Title",description:"messages:TileShop.tastyPack.Description",image:"/res/fbproducts/tasty_pack_200.png?v=1",boughtMessage:"messages:Shop.tastyPack.boughtMessage",
price:25.99,reward:{gold:3800,boosters:{0:3,1:3,2:3}},icon:"tasty_pack_png",ViewClassName:PackProductTile},honeyPack:{id:{facebook:"honeypack.html",android:"honeypack",ios:"honeypack",instant:"honeypack",mymailru:37},title:"messages:TileShop.honeyPack.Title",description:"messages:TileShop.honeyPack.Description",image:"/res/fbproducts/honey_pack_200.png?v=1",boughtMessage:"messages:Shop.honeyPack.boughtMessage",price:39.99,reward:{gold:6e3,boosters:{0:5,1:5,2:5}},icon:"honey_pack_png",ViewClassName:PackProductTile},epicPack:{id:{facebook:"epicpack.html",android:"epicpack",ios:"epicpack",instant:"epicpack",mymailru:38},title:"messages:TileShop.epicPack.Title",description:"messages:TileShop.epicPack.Description",image:"/res/fbproducts/epic_pack_200.png?v=1",boughtMessage:"messages:Shop.epicPack.boughtMessage",price:129.99,reward:{gold:25e3,boosters:{0:20,1:20,2:20}},icon:"epic_pack_png",ViewClassName:PackProductTile}};var customizeProducts=function(){var e=cleverapps.extend||Object.assign
;for(var t in"match3"!==cleverapps.config.type&&"differences"!==cleverapps.config.type||e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.PACK_PRODUCTS),"merge"===cleverapps.config.type&&(cleverapps.PaymentsManager.PRODUCTS.gold500.reward={gold:200},cleverapps.PaymentsManager.PRODUCTS.gold500.videoReward={gold:50},cleverapps.PaymentsManager.PRODUCTS.gold1800.reward={gold:900},cleverapps.PaymentsManager.PRODUCTS.gold1800.videoReward={gold:200},cleverapps.PaymentsManager.PRODUCTS.gold3800.reward={gold:2100},cleverapps.PaymentsManager.PRODUCTS.gold3800.videoReward={gold:600},cleverapps.PaymentsManager.PRODUCTS.gold6000.reward={gold:3500},cleverapps.PaymentsManager.PRODUCTS.gold6000.videoReward={gold:1e3},cleverapps.PaymentsManager.PRODUCTS.gold25000.reward={gold:14e3},cleverapps.PaymentsManager.PRODUCTS.gold25000.videoReward={gold:4e3}),"differences"===cleverapps.config.type&&(cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={8:2,9:2},
cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={8:3,9:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={8:5,9:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={8:7,9:7},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={8:30,9:30}),"solitaire"===cleverapps.config.type&&"spades"!==cleverapps.config.name&&(e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.PACK_PRODUCTS),cleverapps.PaymentsManager.PRODUCTS.addMoves1.price=1.49,cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={10:2,11:2,12:2},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={10:3,11:3,12:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={10:5,11:5,12:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={10:7,11:7,12:7},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={10:30,11:30,12:30}),"match3"===cleverapps.config.type&&(cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={5:1,
6:1,7:1},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={5:2,6:2,7:2},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={0:3,1:3,5:3,6:3,7:3},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={0:5,1:5,5:5,6:5,7:5},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={0:18,1:18,5:18,6:18,7:18}),"ios"===cleverapps.config.source&&(cleverapps.PaymentsManager.PRODUCTS.gold25000.price=99.99),"ios"===cleverapps.config.source&&cleverapps.PaymentsManager.PRODUCTS.epicPack&&(cleverapps.PaymentsManager.PRODUCTS.epicPack.price=99.99),-1!==["instant","ios"].indexOf(cleverapps.config.source)&&(cleverapps.PaymentsManager.PRODUCTS.cellPack05.price=.99,cleverapps.PaymentsManager.PRODUCTS.cellPack05.oldPrice=9.99,cleverapps.PaymentsManager.PRODUCTS.linePack074.price=1.99,cleverapps.PaymentsManager.PRODUCTS.linePack074.oldPrice=19.99,cleverapps.PaymentsManager.PRODUCTS.colorPack10.price=2.99,cleverapps.PaymentsManager.PRODUCTS.colorPack10.oldPrice=29.99,
cleverapps.PaymentsManager.PRODUCTS.lives074.price=1.99,cleverapps.PaymentsManager.PRODUCTS.lives074.oldPrice=19.99,cleverapps.PaymentsManager.PRODUCTS.unlimitedLives05.price=.99,cleverapps.PaymentsManager.PRODUCTS.unlimitedLives05.oldPrice=9.99),-1!==["android","ios"].indexOf(cleverapps.config.source)&&(cleverapps.PaymentsManager.PRODUCTS.subsWeek.price=4.99,cleverapps.PaymentsManager.PRODUCTS.subsWeek.trial="3 days",cleverapps.PaymentsManager.PRODUCTS.subsWeek.period="1 week",cleverapps.PaymentsManager.PRODUCTS.subsWeek.title="messages:Shop.SubsWeek.ThreeDays.Title",cleverapps.PaymentsManager.PRODUCTS.subsWeek.description="messages:Shop.SubsWeek.ThreeDays.Description"),"olympics"===cleverapps.config.name&&(cleverapps.PaymentsManager.PRODUCTS.lives3.icon="boosters_sale_energy_png",cleverapps.PaymentsManager.PRODUCTS.lives074.icon="boosters_sale_energy_png"),"scramble"!==cleverapps.config.name&&"wordheaps"!==cleverapps.config.name||(e(cleverapps.PaymentsManager.PRODUCTS,
cleverapps.PaymentsManager.PACK_PRODUCTS),e(cleverapps.PaymentsManager.PRODUCTS,cleverapps.PaymentsManager.SCRAMBLE_PRODUCTS),cleverapps.PaymentsManager.PRODUCTS.sweetPack.reward.boosters={13:2,14:2,15:2},cleverapps.PaymentsManager.PRODUCTS.jamPack.reward.boosters={13:3,14:3,15:3},cleverapps.PaymentsManager.PRODUCTS.tastyPack.reward.boosters={13:5,14:5,15:5},cleverapps.PaymentsManager.PRODUCTS.honeyPack.reward.boosters={13:7,14:7,15:7},cleverapps.PaymentsManager.PRODUCTS.epicPack.reward.boosters={13:30,14:30,15:30}),cleverapps.PaymentsManager.PRODUCTS)cleverapps.PaymentsManager.PRODUCTS[t].key=t};"undefined"!=typeof exports?module.exports={getProducts:function(e){return Object.assign(cleverapps.config,e),customizeProducts(),cleverapps.PaymentsManager.PRODUCTS}}:customizeProducts(),cleverapps.PaymentsHistory=function(){this.load(),this.onAddPaymentListeners={}},cleverapps.PaymentsHistory.prototype.addPayment=function(e){var t={price:e.price,productId:e.id,textPrice:e.getCurrentPrice(),
time:Date.now()};if(this.payments.push(t),this.save(),cleverapps.serverFlags.setFlag(cleverapps.ServerFlags.PAYER),cleverapps.abTest){var s=Math.round(e.price*cleverapps.User.calcPriceCoef()*100)/100;cleverapps.abTest.purchaseEvent(s)}var i=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_SECOND);if(i){var n=i.getName();cleverapps.eventLogger.logEvent("mission_"+n,{amount:Math.round(e.price*cleverapps.User.calcPriceCoef()*100)/100})}cleverapps.values(this.onAddPaymentListeners).forEach(cleverapps.callFunc)},cleverapps.PaymentsHistory.prototype.isPayer=function(){return 0<this.payments.length||cleverapps.serverFlags.hasFlag(cleverapps.ServerFlags.PAYER)},cleverapps.PaymentsHistory.prototype.getLastPayment=function(){return 0<this.payments.length?this.payments[this.payments.length-1]:void 0},cleverapps.PaymentsHistory.prototype.calcFavoriteProduct=function(e){var s={},t={},i=e.filter(function(e){return cleverapps.config.products[e]});i.forEach(function(e){
t[cleverapps.config.products[e].price]=e,s[e]=0}),this.payments.forEach(function(e){t[e.price]&&s[t[e.price]]++});var n=void 0,o=0;return i.forEach(function(e){var t=cleverapps.config.products[e].price;2<=s[e]&&o<t&&(n=e,o=t)}),n},cleverapps.PaymentsHistory.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PAYMENTS_HISTORY);e||(e={payments:[]}),Array.isArray(e)&&(e={payments:e}),this.payments=e.payments},cleverapps.PaymentsHistory.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PAYMENTS_HISTORY,{payments:this.payments})},cleverapps.PaymentsHistory.PAYER_NONE=0,cleverapps.PaymentsHistory.PAYER_WEAK=1,cleverapps.PaymentsHistory.PAYER_NORMAL=2,cleverapps.PaymentsHistory.PAYER_WHALE=3,cleverapps.PaymentsHistory.PAYER_BIGWHALE=4,cleverapps.PaymentsHistory.BRACKETS=[2.99,9.99,29.99,99.99],cleverapps.PaymentsHistory.prototype.classify=function(e){void 0===e&&(e="1 month");for(var t=0,s=this.payments.length-1;0<=s;s--){
var i=this.payments[s];if(i.time+cleverapps.parseInterval(e)<Date.now())break;t+=i.price}for(var n=0;n<cleverapps.PaymentsHistory.BRACKETS.length&&!(t<cleverapps.PaymentsHistory.BRACKETS[n]+.001);n++);return n},cleverapps.NKPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}},cleverapps.NKPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.NKPayments.prototype.constructor=cleverapps.NKPayments,cleverapps.NKPayments.prototype.calcLoadedPrice=function(e){return Math.floor(10*e)+"EGB"},cleverapps.NKPayments.prototype.open=function(e,s){var t={};t[opensocial.Payment.Field.AMOUNT]=parseInt(e.loadedPrice),t[opensocial.Payment.Field.MESSAGE]=e.description;var i=opensocial.newPayment(t);FullscreenControlButton.exitFullscreen(function(){opensocial.requestPayment(i,function(e){var t=e.getData();e.hadError()||!t.getField("responseMessage")?s(
cleverapps.Social.CODE_FAILED,e):s(cleverapps.Social.CODE_SUCCEED,t)})})},cleverapps.NKPayments.prototype.isAvailable=function(){return!0},cleverapps.NKPayments.isAppropriate=function(){return cleverapps.NK.isAppropriate()},cleverapps.NKPayments.prototype.validate=function(e,t){t&&t()},cleverapps.NKPayments.prototype.logPurchase=function(e){},cleverapps.DraugiemPayments=function(){for(var e in cleverapps.Payments.call(this),cleverapps.config.products){var t=cleverapps.config.products[e];t.loadedPrice=this.calcLoadedPrice(t.price)}this.paymentTesters=["5531190","5531196","5531268"]},cleverapps.DraugiemPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.DraugiemPayments.prototype.constructor=cleverapps.DraugiemPayments,cleverapps.DraugiemPayments.prototype.calcLoadedPrice=function(e){return e+" €"},cleverapps.DraugiemPayments.prototype.stopCheckPayments=function(){this.checkPaymentInterval&&(clearInterval(this.checkPaymentInterval),this.checkPaymentInterval=void 0)
},cleverapps.DraugiemPayments.prototype.runCheckPayments=function(){this.stopCheckPayments();var e=Date.now();this.checkPaymentInterval=setInterval(function(){this.checkPayment(),Date.now()-e>cleverapps.parseInterval("3 minutes")&&this.onFailedPayment()}.bind(this),1e3)},cleverapps.DraugiemPayments.prototype.onFailedPayment=function(){this.stopCheckPayments(),this.paymentCallback&&(this.paymentCallback=void 0)},cleverapps.DraugiemPayments.prototype.onSuccessPayment=function(){this.stopCheckPayments(),this.paymentCallback&&(this.paymentCallback(cleverapps.Social.CODE_SUCCEED),this.paymentCallback=void 0)},cleverapps.DraugiemPayments.prototype.checkPayment=function(){console.log("ask transaction status: "+this.paymentId),cleverapps.social.api("transactions/check",{id:this.paymentId},function(e,t){void 0!==t&&(console.log("status: ",t.status),"FAILED"===t.status?this.onFailedPayment():"OK"===t.status&&this.onSuccessPayment())}.bind(this))},
cleverapps.DraugiemPayments.prototype.isProductExists=function(e){return cleverapps.config.products[e]&&DraugiemProducts[e]},cleverapps.DraugiemPayments.prototype.open=function(s,i){if(!DraugiemProducts[s.key])return i(cleverapps.Social.CODE_FAILED),void setTimeout(function(){throw console.log(s),"Draugiem payment configuration error for "+s.key},0);var e={price:Math.round(100*parseFloat(s.loadedPrice)),service:DraugiemProducts[s.key]};-1!==this.paymentTesters.indexOf(cleverapps.social.getUserID())&&(e.price=1),cleverapps.social.api("transactions/create",e,function(e,t){console.log(DraugiemProducts[s.key],e,t),e===cleverapps.Social.CODE_SUCCEED?(this.paymentId=t.transaction.id,this.paymentCallback=i,draugiemWindowOpen(t.transaction.link,350,400,function(){this.runCheckPayments()}.bind(this))):(console.log(DraugiemProducts[s.key],s,s.key),i(cleverapps.Social.CODE_FAILED))}.bind(this))},cleverapps.DraugiemPayments.prototype.isAvailable=function(){return!0},
cleverapps.DraugiemPayments.isAppropriate=function(){return cleverapps.Draugiem.isAppropriate()},cleverapps.DraugiemPayments.prototype.validate=function(e,t){t&&t()},cleverapps.DraugiemPayments.prototype.logPurchase=function(e){},cleverapps.XsollaPayments=function(){cleverapps.Payments.call(this)},cleverapps.XsollaPayments.prototype=Object.create(cleverapps.Payments.prototype),cleverapps.XsollaPayments.prototype.constructor=cleverapps.XsollaPayments,cleverapps.XsollaPayments.prototype.needSocialCheckConnection=function(){return!1},cleverapps.XsollaPayments.prototype.open=function(e,t){if(cleverapps.social.isLoggedIn()){t=cleverapps.once(t);var i=!1,n=!1,s=document.getElementById("xsollaPayStationIframe"),o=document.getElementById("xsollaPayStationCloseButton"),r=document.getElementById("xsollaPayStation"),a=document.getElementById("xsollaShadow"),
c="https://store.xsolla.com/pages/buy.php?type=virtual_item&project_id="+cleverapps.config.xsollaProjectId+"&sku="+e.itemId+"&xsolla_login_token="+cleverapps.social.accessToken;cleverapps.config.debugMode&&(c+="&mode=sandbox");var l=function(){s.style.marginTop=(cc.view.getFrameSize().height-s.clientHeight)/2+"px";var e=s.getBoundingClientRect();o.style.top=45+e.top+"px",o.style.right=6+e.left+"px"};cleverapps.afterResolutionChanged(l),o.onclick=r.onclick=function(){if(!n)return setTimeout(function(){r.style.display="none",i&&!cleverapps.config.debugMode&&fbq("track","Purchase",{currency:"USD",value:e.price}),t(i?cleverapps.Social.CODE_SUCCEED:cleverapps.Social.CODE_CANCELLED)},700),a.style.opacity="0",s.onload=void 0,s.src="",!1},s.src=c,s.onload=function(){r.style.display="block",l(),a.style.opacity="0.6";var e=window.addEventListener?"addEventListener":"attachEvent";(0,window[e])("attachEvent"==e?"onmessage":"message",function(e){if(e.data&&"string"==typeof e.data){var t=JSON.parse(
e.data);if(t.data&&t.data.paymentInfo){var s=t.data.paymentInfo.status;cleverapps.config.debugMode&&console.log("Xsolla payment event: "+JSON.stringify(t.data.paymentInfo)),"invoice"===s?n=!0:"done"===s?i=!(n=!1):"troubled"===s&&(i=n=!1)}}},!1)}}else cleverapps.social.login(function(){this.open(e,t)}.bind(this),function(){cleverapps.Notification.create("messages:xsollaLoginNeeded")})},cleverapps.XsollaPayments.prototype.isAvailable=function(){return!0},cleverapps.XsollaPayments.prototype.validate=function(e,t){t&&t()},cleverapps.XsollaPayments.isAppropriate=function(){return cleverapps.Xsolla.isAppropriate()},cleverapps.XsollaPayments.prototype.logPurchase=function(e){};var CustomSyncers={extractors:{users:function(){var e=cleverapps.user;if(e){var t={id:e.id,gold:e.gold,registered:e.registered,visited:e.visited,source:e.source,channel:e.channel,abtest:e.abtest,progressCompare:e.progressCompare,progress:e.progress};return void 0!==e.level&&(t.level=e.level),void 0!==e.episode&&(
t.episode=e.episode),void 0!==e.exp&&(t.exp=e.exp),t}},bonuses:function(){if(cleverapps.periodicBonus)return{event:cleverapps.periodicBonus.when}},bonusgames:function(){if(cleverapps.bonusRoundChest)return{event:cleverapps.bonusRoundChest.when}},games:function(){if(cleverapps.GameSyncer)return cleverapps.GameSyncer.getInfo()},settings:function(){if(cleverapps.settings)return cleverapps.settings.getSaveInfo()},serverflags:function(){if(cleverapps.serverFlags)return cleverapps.serverFlags.getInfo()},tempgoods:function(){if(cleverapps.tempGoods)return cleverapps.tempGoods.getInfo()},lives:function(){if(cleverapps.lives)return cleverapps.lives.getInfo()},boosters:function(){if(cleverapps.boostersCounter)return cleverapps.boostersCounter.data},starchests:function(){if(cleverapps.starChest)return{stars:cleverapps.starChest.stars}},packs:function(){if(cleverapps.packManager)return{used:cleverapps.packManager.used}},dailytasks:function(){if(cleverapps.dailyTasks
)return cleverapps.dailyTasks.getInfo()},missions:function(){if(cleverapps.missionManager)return cleverapps.missionManager.getInfo()},piggybank:function(){if(cleverapps.piggyBank)return cleverapps.piggyBank.getInfo()},gun:function(){if(cleverapps.gun)return cleverapps.gun.getInfo()},heroes:function(){if("undefined"!=typeof match3&&match3&&match3.heroes)return match3.heroes.getInfo()},subscription:function(){if(cleverapps.subscription)return cleverapps.subscription.getInfo()},userdailycup:function(){if(cleverapps.dailyCup)return cleverapps.dailyCup.getInfo()},userweeklycup:function(){if(cleverapps.weeklyCup)return cleverapps.weeklyCup.getInfo()},forces:function(){if(cleverapps.forces)return cleverapps.forces.getInfo()},metha:function(){if(cleverapps.metha.getType()!==Metha.HOSE&&cleverapps.metha.getMainObject().getInfo)return cleverapps.metha.getMainObject().getInfo()},cookiejar:function(){if(levels&&levels.cookieJar)return levels.cookieJar.getCounterValue()},
competitionstatistics:function(){if(cleverapps.competitionStatistics)return cleverapps.competitionStatistics.getInfo()},cardskins:function(){if(cleverapps.cardSkins)return cleverapps.cardSkins.getInfo()}},importerData:{users:function(e){var t=cleverapps.user;if(t){for(var s in e)t[s]=e[s];t.save(!1),cleverapps.abTest&&cleverapps.abTest.setGroup(t.abtest),levels.episodes.reset(),levels.episodes.setCurrentEpisode(cleverapps.user.episode)}},bonuses:function(e){if(cleverapps.periodicBonus){var t=cleverapps.periodicBonus;e.event<t.when||e.event>Date.now()+t.interval||(t.locked=!0,t.setWhenUnlock(e.event),t.save(!1),t.changeLockedListener())}},bonusgames:function(e){if(cleverapps.bonusRoundChest){var t=cleverapps.bonusRoundChest;e.event<t.when||e.event>Date.now()+t.interval||(t.locked=!0,t.setWhenUnlock(e.event),t.save(!1),t.changeLockedListener())}},games:function(e){cleverapps.GameSyncer&&cleverapps.GameSyncer.saveInfo(e)},settings:function(){},boosters:function(e){
cleverapps.boostersCounter&&(cleverapps.boostersCounter.data=e,cleverapps.boostersCounter.addInitAmount(!0),cleverapps.boostersCounter.save(!1))},serverflags:function(e){cleverapps.serverFlags&&cleverapps.serverFlags.updateInfo(e,!0)},tempgoods:function(e){cleverapps.tempGoods&&cleverapps.tempGoods.updateInfo(e,!0)},lives:function(e){cleverapps.lives&&cleverapps.lives.updateInfo(e,!0)},missions:function(e){cleverapps.missionManager&&cleverapps.missionManager.updateInfo(e,!0)},piggybank:function(e){cleverapps.piggyBank&&cleverapps.piggyBank.updateInfo(e,!0)},starchests:function(e){cleverapps.starChest&&(cleverapps.starChest.locked=!0,cleverapps.starChest.setStars(e.stars),cleverapps.starChest.save(!1),cleverapps.starChest.changeLockedListener())},packs:function(e){cleverapps.packManager&&(cleverapps.packManager.used=e.used,cleverapps.packManager.save(!1))},dailytasks:function(e){cleverapps.dailyTasks&&(cleverapps.dailyTasks.load(e),cleverapps.dailyTasks.save(!1))},gun:function(e){
cleverapps.gun&&cleverapps.gun.updateInfo(e,!0)},heroes:function(e){"undefined"!=typeof match3&&match3&&match3.heroes&&match3.heroes.updateInfo(e,!0)},subscription:function(e){cleverapps.subscription&&cleverapps.subscription.updateInfo(e,!0)},userdailycup:function(e){cleverapps.dailyCup&&cleverapps.dailyCup.updateInfo(e,!0)},userweeklycup:function(e){cleverapps.weeklyCup&&cleverapps.weeklyCup.updateInfo(e,!0)},forces:function(e){cleverapps.forces&&cleverapps.forces.updateInfo(e,!0)},metha:function(e){cleverapps.metha.getType()!==Metha.HOSE&&cleverapps.metha.getMainObject().updateInfo&&cleverapps.metha.getMainObject().updateInfo(e)},cookiejar:function(e){levels&&levels.cookieJar&&levels.cookieJar.updateValue(e,!0)},competitionstatistics:function(e){cleverapps.competitionStatistics&&cleverapps.competitionStatistics.updateInfo(e,!0)},cardskins:function(e){cleverapps.cardSkins&&cleverapps.cardSkins.updateInfo(e,!0)},units:function(e){cleverapps.unitSyncer&&cleverapps.unitSyncer.updateInfo(
e,!0)}}};if(cleverapps.Synchronizer=function(){this._session="a";var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY,{raw:!0});null!=e&&(this._session=e),this._syncIn=new cleverapps.SyncIn,this._syncOut=new cleverapps.SyncOut,this._syncInProgress=!1,this._needResync=!1,this._syncId=0,this._clientSessionExpired=!1,this.synced=!1,cleverapps.DataLoader.checkClientSession()||this.clientSessionExpired()},cleverapps.Synchronizer.prototype._startCheckInterval=function(){if(!this._checkIntervalRunned){this._checkIntervalRunned=!0;var e=0;return setInterval(function(){this.synced&&e%15!=0||this.syncWhenReady(),e++}.bind(this),6e4),!0}return!1},cleverapps.Synchronizer.prototype.needClientSessionExpiredWindow=function(){return this._clientSessionExpired},cleverapps.Synchronizer.prototype.showClientSessionExpiredWindow=function(){cleverapps.metha.display({focus:"clientSessionExpired",action:function(){new RestartWindow({title:"ClientSessionExpired.title",
contentMessage:"ClientSessionExpired.message"})}})},cleverapps.Synchronizer.prototype.clientSessionExpired=function(){this._clientSessionExpired||(this.synced=!1,this._clientSessionExpired=!0,cleverapps.allInitialized&&(cleverapps.metha.isFocused()||this.showClientSessionExpiredWindow()))},cleverapps.Synchronizer.prototype.reset=function(){this.synced=!1,this._loadedSession=void 0,this._loadedSync=void 0,this._session="a",this._syncInProgress=!1,this._needResync=!1,cc.sys.localStorage.removeItem(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY),this._syncOut.reset()},cleverapps.Synchronizer.prototype.syncWhenReady=function(){cleverapps.DataLoader.checkClientSession(),this._syncInProgress?this._needResync=!0:this._sync()},cleverapps.Synchronizer.prototype.addUpdateTask=function(e){cleverapps.flags.norest||("users"!==e&&cleverapps.user.incProgressCompare(),this._syncOut.addUpdateTask(e))},cleverapps.Synchronizer.prototype.on=function(){this._clientSessionExpired||(
void 0!==this._loadedSession&&(this._session=this._loadedSession,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SESSION_SAVE_KEY,this._session,{raw:!0}),cleverapps.DataLoader.processSaveQueue()),this._loadedSession=void 0,this._loadedSync=void 0,this.synced=!0,this._syncOut.run(),this._onSyncLoaded(),this.onceSyncCompletedListener&&(this.onceSyncCompletedListener(),this.onceSyncCompletedListener=void 0),this._needResync&&(this._needResync=!1,this.syncWhenReady()))},cleverapps.Synchronizer.prototype._getPath=function(e){return"/"+e+"/"+cleverapps.user.id+"/"+this._session},cleverapps.Synchronizer.prototype._syncCallback=function(e){var t=this._syncId;return function(){this._syncId!==t||this._clientSessionExpired||e.apply(this,arguments)}.bind(this)},cleverapps.Synchronizer.prototype._sync=function(){if(!this._syncInProgress&&!this._clientSessionExpired){var t=this._startCheckInterval();this._syncId++,this._syncInProgress=!0;var s=this.synced;this.synced=!1
;var i=cleverapps.social.getAccessToken()||"undefined",e=this._getPath("newsync")+"/"+i,n={episode:levels.user.episode,level:levels.user.level,progress:levels.user.progress,progressCompare:cleverapps.user.progressCompare,exp:levels.user.exp,localStorageEnabled:cleverapps.DataLoader.enabled,localStorageCorrupted:cleverapps.DataLoader.corrupted,version:cleverapps.config.version};"merge"===cleverapps.config.type&&(n.game=cleverapps.GameSyncer.getInfo());var o=this._syncCallback(function(e){this._syncInProgress=!1,this._loadedSession=e.key,this._loadedSync=e.sync,void 0!==this._loadedSession?this._loadedSync?(console.log("sync in"),this._syncIn.process()):this._syncOut.process():this.on()}).bind(this),r=this._syncCallback(function(e){if(this._syncInProgress=!1,e&&403===e.status){if("undefined"===i&&cleverapps.social.getAccessToken())return void this.syncWhenReady();cleverapps.social.isLoggedIn()||(this.wantsSocialConnectWindow=!0,this.displaySocialConnectWindow())}else(t||s)&&setTimeout(
function(){cleverapps.Notification.create("messages:Synchronizer.ErrorSavingProgress")},t?2500:0);this._onSyncLoaded()}).bind(this);cleverapps.RestClient.post(e,n,o,r)}},cleverapps.Synchronizer.prototype.displaySocialConnectWindow=function(){cleverapps.metha.display({focus:"SynchronizerCheckConnection",actions:[function(e){cleverapps.social.checkConnection(function(){e(),this.syncWhenReady()}.bind(this),e,{withWindow:!0,errorMessage:"messages:FbConnectWindow.TryAgain"})}.bind(this),function(e){this.wantsSocialConnectWindow=!1,e()}.bind(this)]})},cleverapps.Synchronizer.prototype._onSyncLoaded=function(){this._onceFirstSyncCompletedListener&&(this._onceFirstSyncCompletedListener(),this._onceFirstSyncCompletedListener=void 0)},cleverapps.Synchronizer.SESSION_EXPIRED=99,cleverapps.SyncIn=function(){},cleverapps.SyncIn.prototype.executeSync=function(e){for(var t in cleverapps.synchronizer._clientSessionExpired&&(cleverapps.DataLoader.resetClientSession(),
cleverapps.synchronizer._clientSessionExpired=!1),cleverapps.synchronizer._syncOut.reset(),e){var s=e[t],i=CustomSyncers.importerData[t];i?i(s):console.log("No importer for "+t)}cleverapps.DataLoader.processSaveQueue()},cleverapps.SyncIn.prototype.sceneRefresh=function(){cleverapps.flags.reset(),levels&&(levels.reset(),cleverapps.windows.reset(),cleverapps.scenes.reset(),cleverapps.isKnockoutGame()&&cleverapps.metha.getMainObject().knockoutGame.stopRumble(),cleverapps.metha.distract({focus:"afterReloadWindow",action:function(e){cleverapps.metha.gotoMainScene(e)}}))},cleverapps.SyncIn.prototype.needShowReloadWindow=function(){return cleverapps.synchronizer._loadedSync},cleverapps.SyncIn.prototype.showReloadWindow=function(){cleverapps.config.wysiwygMode||cleverapps.metha.display({focus:"ReloadWindow",action:function(e){Game.currentGame&&Game.currentGame.stop(),new ReloadWindow(function(){this.needShowReloadWindow()?(this.executeSync(cleverapps.synchronizer._loadedSync),
cleverapps.synchronizer.on(),this.sceneRefresh()):e()}.bind(this))}.bind(this)})},cleverapps.SyncIn.prototype.process=function(){cleverapps.scenes.isLoaderScene()&&!cleverapps.allInitialized?(this.executeSync(cleverapps.synchronizer._loadedSync),cleverapps.synchronizer.on()):cleverapps.metha.isFocused()||this.showReloadWindow()},cleverapps.SyncOut=function(){this.task={},this.currentTask={},this.onTasksEmptyListener=function(){},this.inProgress=!1,this.sendNextUpdate=cleverapps.accumulate(cleverapps.SyncOut.ACCUMULATE_TIMEOUT,this._sendUpdateInner.bind(this)),(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SYNC)||[]).forEach(function(e){CustomSyncers.extractors[e]&&(this.task[e]=!0)},this)},cleverapps.SyncOut.prototype.run=function(){this.sendNextUpdate()},cleverapps.SyncOut.prototype.save=function(){var e=cleverapps.extend(this.currentTask,this.task);cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SYNC,Object.keys(e))},cleverapps.SyncOut.prototype.reset=function(){
this.task={},this.currentTask={},this.save()},cleverapps.SyncOut.prototype.nextTask=function(){this.currentTask=this.task,this.task={}},cleverapps.SyncOut.prototype.addUpdateTask=function(e){CustomSyncers.extractors[e]&&!this.task[e]&&(this.task[e]=!0,this.save(),cleverapps.synchronizer.synced&&cleverapps.allInitialized&&this.sendNextUpdate())},cleverapps.SyncOut.prototype.onSuccess=function(e){if(this.inProgress=!1,cleverapps.synchronizer.synced){if(e.error&&e.error===cleverapps.Synchronizer.SESSION_EXPIRED)return console.log("onUpdate: session needs renewal"),cleverapps.synchronizer.reset(),void cleverapps.synchronizer.syncWhenReady();0===e&&console.log("error saving object"),this.currentTask={},this.save(),this.sendNextUpdate()}},cleverapps.SyncOut.prototype.onFailure=function(e){this.inProgress=!1,cleverapps.synchronizer.synced&&(console.log("Failure: ",e),this.task=cleverapps.extend(this.currentTask,this.task),this.currentTask={},setTimeout(this.sendNextUpdate.bind(this),
cleverapps.SyncOut.RETRY_TIMEOUT))},cleverapps.SyncOut.prototype._sendUpdateInner=function(){cleverapps.DataLoader.onSaved(function(){if(!this.inProgress&&cleverapps.synchronizer.synced&&(cleverapps.DataLoader.checkClientSession(),!cleverapps.synchronizer._clientSessionExpired))if(this.nextTask(),0!==Object.keys(this.currentTask).length){var e={};for(var t in this.currentTask){var s=CustomSyncers.extractors[t]();e[t]=s}this.inProgress=!0,console.log("Sending update ",e),cleverapps.RestClient.post(cleverapps.synchronizer._getPath("sync"),e,this.onSuccess.bind(this),this.onFailure.bind(this))}else this.onTasksEmptyListener()}.bind(this))},cleverapps.SyncOut.prototype.process=function(){for(var e in CustomSyncers.extractors)CustomSyncers.extractors[e]&&!this.task[e]&&(this.task[e]=!0);cleverapps.synchronizer.on()},cleverapps.SyncOut.RETRY_TIMEOUT=6e4,cleverapps.SyncOut.ACCUMULATE_TIMEOUT=2e3,RewardsConfig={Packs:[],Tournament:{},DailyCup:{}},
"board"!==cleverapps.config.type&&"spades"!==cleverapps.config.name||(RewardsConfig={Tournament:{prepareByRich:!0,places:[{gold:300},{gold:250},{gold:200},{gold:100},{gold:50}]},Sale:{gold:500},TreasureSearch:{prepareByRich:!0,gold:100},StickersCollection:{prepareByRich:!0,gold:100},DailyTask:{prepareByRich:!0,low:[{gold:80}],mid:[{gold:120}],hard:[{gold:160}]},DailyCup:{places:[{gold:400},{gold:250},{gold:150},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50},{gold:50}]},Packs:[{gold:800},{gold:2600},{gold:17e3}],Subscription:{gold:600},MiniGame:[{gold:50},{gold:100}],MiniGameNovice:[{gold:50}],Favorite:{gold1800:{gold:300},gold3800:{gold:600},gold6000:{gold:1200},gold25000:{gold:5e3}}}),"match3"===cleverapps.config.type)var RewardsConfig={MiniGame:[{gold:50},{boosters:{5:1},gold:50},{boosters:{5:1}},{gold:50},{boosters:{6:1}},{boosters:{6:1},gold:50},{gold:50},{boosters:{7:1}},{boosters:{7:1},gold:50}],MiniGameBeginner:[{unlimitedLives:"30 minutes"}],MiniGameNovice:[{
gold:50}],Tournament:{prepareByRich:!0,places:[{boosters:{5:2,6:2,7:2},unlimitedLives:"12 hours"},{boosters:{6:1,7:1},unlimitedLives:"6 hour"},{boosters:{5:1,6:1},unlimitedLives:"1 hour"},{boosters:{6:1},unlimitedLives:"45 minutes",exp:5},{boosters:{5:1},unlimitedLives:"30 minutes",exp:3}]},Sale:{boosters:{0:1,1:1,2:1}},DailyTask:{prepareByRich:!0,low:[{boosters:{5:1}},{gold:50},{stars:3}],mid:[{boosters:{0:1},gold:50,exp:1},{boosters:{1:1},exp:1},{stars:4,gold:50,exp:1}],hard:[{boosters:{2:1},gold:50,exp:3},{boosters:{0:1,1:1},gold:50,exp:3},{boosters:{0:1,1:1,2:1},exp:3}]},TreasureSearch:{prepareByRich:!0,unlimitedLives:"12 hours",stars:10,exp:20},DailyCup:{places:[{unlimitedLives:"1 day",boosters:{5:5,6:5,7:5}},{unlimitedLives:"6 hours",boosters:{5:4,6:4,7:4}},{unlimitedLives:"3 hours",boosters:{5:3,6:3,7:3}},{unlimitedLives:"2 hour",boosters:{5:1,6:1,7:1}},{boosters:{5:1,6:1},unlimitedLives:"2 hour"},{boosters:{5:1,6:1},unlimitedLives:"2 hour"},{boosters:{5:1,6:1},
unlimitedLives:"2 hour"},{boosters:{5:1},unlimitedLives:"1 hour"},{boosters:{5:1},unlimitedLives:"1 hour"},{boosters:{5:1},unlimitedLives:"1 hour"}]},Packs:[{boosters:{0:1,1:1,2:1},gold:300,unlimitedLives:"1 day"},{boosters:{2:3},gold:1800,unlimitedLives:"3 day"},{boosters:{0:9,1:9,2:9},gold:12e3,unlimitedLives:"9 day"}],Subscription:{gold:300,exp:1,unlimitedLives:"2 hours",randomBoosters:{types:[0,1,2],amount:3}},Favorite:{sweetPack:{unlimitedLives:"12 hours",exp:3,stars:2},jamPack:{unlimitedLives:"1 day",exp:5,stars:4},tastyPack:{unlimitedLives:"2 days",exp:15,stars:6},honeyPack:{unlimitedLives:"3 days",exp:20,stars:8},epicPack:{unlimitedLives:"5 days",exp:40,stars:12},gold1800:{unlimitedLives:"1 day",exp:5,stars:4},gold3800:{unlimitedLives:"2 day",exp:15,stars:6},gold6000:{unlimitedLives:"3 day",exp:20,stars:8},gold25000:{unlimitedLives:"5 day",exp:40,stars:10}}};-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(RewardsConfig={Sale:{gold:500},MiniGame:[{gold:50,randomBoosters:{
types:[10,11,12],amount:1}},{gold:50,randomBoosters:{types:[10,11,12],amount:2}},{randomBoosters:{types:[10,11,12],amount:1}},{betGold:500,randomBoosters:{types:[10,11,12],amount:2}}],MiniGameBeginner:[{gold:50},{gold:100}],MiniGameNovice:[{gold:50,randomBoosters:{types:[10,11,12],amount:1}}],TreasureSearch:{unlimitedLives:"12 hours",boosters:{10:1,11:1,12:1}},Tournament:{prepareByRich:!0,places:[{boosters:{10:2,11:2,12:2},unlimitedLives:"3 hours"},{boosters:{11:2,12:2},unlimitedLives:"1 hour"},{boosters:{10:1,11:1,12:1},unlimitedLives:"30 minutes"},{boosters:{11:1,12:1},unlimitedLives:"15 minutes"},{boosters:{10:1,11:1},unlimitedLives:"15 minutes"}]},DailyTask:{low:[{unlimitedLives:"15 minutes"}],mid:[{boosters:{11:1},gold:80}],hard:[{boosters:{12:2},gold:160,unlimitedLives:"15 minutes"}]},DailyCup:{places:[{unlimitedLives:"1 day",betGold:2400,boosters:{10:5,11:5,12:5}},{unlimitedLives:"6 hours",boosters:{10:4,11:4,12:4}},{unlimitedLives:"3 hours",boosters:{10:3,11:3,12:3}},{
unlimitedLives:"1 hour",boosters:{10:2,11:2,12:2}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",betGold:50,boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",betGold:50,boosters:{10:1,11:1,12:1}},{unlimitedLives:"15 minutes",betGold:50,boosters:{10:1,11:1,12:1}}]},Packs:[{boosters:{0:0,1:0,2:0,10:2,11:2,12:2},gold:200,unlimitedLives:void 0},{boosters:{0:0,1:0,2:0,10:6,11:6,12:6},gold:800},{boosters:{0:0,1:0,2:0,10:30,11:30,12:30},gold:8e3}],Subscription:{gold:250,unlimitedLives:"3 hours",boosters:{10:2,11:2,12:2}},Favorite:{gold1800:{unlimitedLives:"1 day",gold:150},gold3800:{unlimitedLives:"2 day",gold:300},gold6000:{unlimitedLives:"3 day",gold:600},gold25000:{unlimitedLives:"5 day",gold:2500},sweetPack:{unlimitedLives:"30 minutes",boosters:{10:1,11:1,12:1}},jamPack:{gold:250,boosters:{10:1,11:1,12:1},unlimitedLives:"2 hours"},
tastyPack:{gold:550,boosters:{10:2,11:2,12:2},unlimitedLives:"6 hours"},honeyPack:{gold:750,boosters:{10:3,11:3,12:3},unlimitedLives:"12 hours"},epicPack:{gold:5e3,boosters:{10:6,11:6,12:6},unlimitedLives:"1 day"}}}),"differences"===cleverapps.config.type&&(RewardsConfig={Tournament:{prepareByRich:!0,places:[{boosters:{8:3,9:3},unlimitedLives:"3 hours"},{boosters:{8:2,9:2},unlimitedLives:"1 hour"},{boosters:{8:1,9:1},unlimitedLives:"30 minutes"},{boosters:{8:1},unlimitedLives:"15 minutes"},{boosters:{9:1},unlimitedLives:"15 minutes"}]},Sale:{boosters:{8:1,9:1}},DailyTask:{low:[{unlimitedLives:"15 minutes"}],mid:[{gold:80,boosters:{8:1}}],hard:[{gold:160,unlimitedLives:"15 minutes",boosters:{8:1,9:1}}]},MiniGame:[{gold:50,randomBoosters:{types:[8,9],amount:1}},{gold:100}],MiniGameBeginner:[{gold:50,randomBoosters:{types:[8,9],amount:1}},{gold:100}],MiniGameNovice:[{gold:50,randomBoosters:{types:[8,9],amount:1}}],TreasureSearch:{unlimitedLives:"12 hours",boosters:{8:1,9:2}},DailyCup:{
places:[{unlimitedLives:"1 day",boosters:{2:1}},{unlimitedLives:"6 hours",boosters:{1:1}},{unlimitedLives:"3 hours",boosters:{0:1}},{unlimitedLives:"1 hour"},{unlimitedLives:"30 minutes"},{unlimitedLives:"30 minutes"},{unlimitedLives:"30 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"15 minutes"},{unlimitedLives:"15 minutes"}]},Packs:[{boosters:{0:0,1:0,2:0,8:2,9:2},gold:200},{boosters:{0:0,1:0,2:0,8:6,9:6},gold:800},{boosters:{0:0,1:0,2:0,8:30,9:30},gold:8e3}],Subscription:{unlimitedLives:"3 hours",gold:250,boosters:{8:3,9:3}},WeeklyCup:{places:[{gold:3e3},{gold:2e3},{gold:1e3},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200}]}}),"olympics"===cleverapps.config.name&&(RewardsConfig.Subscription={gold:600,unlimitedLives:"3 hours"},RewardsConfig.TreasureSearch={unlimitedLives:"12 hours"},RewardsConfig.WeeklyCup={places:[{gold:3e3},{gold:2e3},{gold:1e3},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200},{gold:200}]},
RewardsConfig.Favorite={gold1800:{unlimitedLives:"1 day",gold:150},gold3800:{unlimitedLives:"2 day",gold:300},gold6000:{unlimitedLives:"3 day",gold:600},gold25000:{unlimitedLives:"5 day",gold:2500}}),"scramble"===cleverapps.config.name&&(RewardsConfig.Tournament={prepareByRich:!0,places:[{boosters:{13:2,14:2,15:2}},{boosters:{14:2,15:2}},{boosters:{13:1,14:1,15:1}},{boosters:{14:1,15:1}},{boosters:{13:1,14:1}}]},RewardsConfig.Packs=[{boosters:{13:2,14:2,15:2},gold:200},{boosters:{13:6,14:6,15:6},gold:800},{boosters:{13:30,14:30,15:30},gold:8e3}],RewardsConfig.DailyTask={low:[{boosters:{13:1}}],mid:[{boosters:{14:1},gold:80}],hard:[{boosters:{15:2},gold:160}]},RewardsConfig.DailyCup={places:[{boosters:{13:5,14:5,15:5},gold:300},{boosters:{13:4,14:4,15:4},gold:200},{boosters:{13:3,14:3,15:3},gold:100},{boosters:{13:2,14:2,15:2},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1},gold:50},{boosters:{13:1,14:1,15:1}},{boosters:{13:1,
14:1,15:1}},{boosters:{13:1,14:1,15:1}}]},RewardsConfig.MiniGame=[{gold:50,randomBoosters:{types:[14,15],amount:1}},{gold:50,randomBoosters:{types:[14,15],amount:2}},{randomBoosters:{types:[14,15],amount:1}},{randomBoosters:{types:[14,15],amount:2}}],RewardsConfig.MiniGameBeginner=[{gold:50},{gold:100}],RewardsConfig.MiniGameNovice=[{gold:50,randomBoosters:{types:[13,14,15],amount:1}}],RewardsConfig.Subscription={gold:250,boosters:{13:2,14:2,15:2}},RewardsConfig.Favorite.sweetPack={boosters:{13:1,14:1,15:1}},RewardsConfig.Favorite.jamPack={gold:250,boosters:{13:1,14:1,15:1}},RewardsConfig.Favorite.tastyPack={gold:550,boosters:{13:2,14:2,15:2}},RewardsConfig.Favorite.honeyPack={gold:750,boosters:{13:3,14:3,15:3}},RewardsConfig.Favorite.epicPack={gold:5e3,boosters:{13:6,14:6,15:6}},RewardsConfig.TreasureSearch={gold:100,boosters:{13:1,14:1,15:1}}),-1!==["heroes","runes","riddles","adventure","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(RewardsConfig.Packs=[{boosters:{
5:1,6:1,7:1},gold:500,unlimitedLives:"1 day"},{boosters:{5:2,6:2,7:2},gold:1800,unlimitedLives:"3 day"},{boosters:{5:14,6:14,7:14},gold:12e3,unlimitedLives:"9 day"}]),"merge"===cleverapps.config.type&&(RewardsConfig.Packs=[{gold:50,energy:200},{gold:100,energy:350,wands:250,worker:"3 day"},{gold:1e3,energy:1500,wands:500,coins:3e3,worker:"5 day"}],RewardsConfig.EnergyFeast={places:[{unit:{code:"energyplantchest",stage:2,amount:1}},{unit:{code:"energyplantchest",stage:1,amount:1}},{unit:{code:"energyplantchest",stage:0,amount:1}}]},RewardsConfig.CoinsFeast={places:[{unit:{code:"coinsplantchest",stage:2,amount:1}},{unit:{code:"coinsplantchest",stage:1,amount:1}},{unit:{code:"coinsplantchest",stage:0,amount:1}}]},RewardsConfig.Subscription={energy:100,unit:{code:"treasure",stage:2,amount:1}}),RewardsConfig.BonusWorld=[{level:3,reward:{boosters:{13:1,14:1}}},{level:8,reward:{gold:50,boosters:{13:1,14:1}}},{level:15,reward:{gold:200,boosters:{13:1,14:1,15:1}}}],
"match3"===cleverapps.config.type&&(RewardsConfig.BonusWorld=[{level:3,reward:{unlimitedLives:"1 hour"}},{level:8,reward:{unlimitedLives:"1 hours",exp:5,boosters:{5:1,6:1}}},{level:15,reward:{gold:150,unlimitedLives:"24 hours",boosters:{5:1,6:1,7:1}}}]);var RewardsHelper={iconByRewardName:function(e){return RewardsHelper.ICONS[e]},textByRewardName:function(e,t,s){var i=""+t;return"unlimitedLives"===e?i=Messages.get(Product.FormatUnlimitedLives(t,s.short).title):-1===["stars","exp","gold"].indexOf(e)&&isNaN(parseInt(e))||(i=(s.itemsPrefix||"")+i),i},getDisplayData:function(e,t){t=t||{};var s={};for(var i in e)if("boosters"===i)for(var n in e.boosters)s["booster_"+n]={img:RewardsHelper.iconByRewardName(n),txt:RewardsHelper.textByRewardName(n,e.boosters[n],t)};else s[i]={img:RewardsHelper.iconByRewardName(i),txt:RewardsHelper.textByRewardName(i,e[i],t)};return s}};RewardsHelper.ICONS={unlimitedLives:bundles.reward_icons.frames.life_unlim_small,
gold:bundles.reward_icons.frames.gold_small_png,stars:bundles.reward_icons.frames.stars_small_png,exp:bundles.reward_icons.frames.reward_exp_small_png,0:bundles.reward_icons.frames.cellbooster,1:bundles.reward_icons.frames.linebooster,2:bundles.reward_icons.frames.colorbooster,3:bundles.reward_icons.frames.gold_small_png,4:bundles.reward_icons.frames.joker_png,5:bundles.reward_icons.frames.heroes_png,6:bundles.reward_icons.frames.moves_png,7:bundles.reward_icons.frames.multicolor_png,8:bundles.reward_icons.frames.hat,9:bundles.reward_icons.frames.pot,10:bundles.reward_icons.frames.magnet_small_png,11:bundles.reward_icons.frames.dice_small_png,12:bundles.reward_icons.frames.joker_small_png,13:bundles.reward_icons.frames.highlight,14:bundles.reward_icons.frames.eye,15:bundles.reward_icons.frames.hint};var RewardedAdsManager=function(){RewardedAdsManager.IsEnabled()&&("undefined"==typeof sdkbox&&(sdkbox={}),PlingaAds.isAppropriate(
)?sdkbox.PluginSdkboxAds=new PlingaAds:WebViewAds.isAppropriate()?sdkbox.PluginSdkboxAds=new WebViewAds:OKAppAds.isAppropriate()?sdkbox.PluginSdkboxAds=new OKAppAds:OKAds.isAppropriate()?sdkbox.PluginSdkboxAds=new OKAds:VKAds.isAppropriate()?sdkbox.PluginSdkboxAds=new VKAds:cleverapps.Instant.isAppropriate()?sdkbox.PluginSdkboxAds=new InstantAds:VideoAds.isAppropriate()?sdkbox.PluginSdkboxAds=new VideoAds:Yodo1Ads.isAppropriate()&&(sdkbox.PluginSdkboxAds=new Yodo1Ads),this.onStartPlayListeners={},this.onEndPlayListeners={},this.onRewardListeners={},this.load(),sdkbox.PluginSdkboxAds.setListener({onAdAction:function(e,t,s){switch(console.log("RewardedAdsManager onAdAction "+JSON.stringify(arguments)),s){case RewardedAdsManager.AD_ACTION_TYPE.LOADED:cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_READY+"_"+t),cleverapps.playSession.set(cleverapps.EVENTS.AD_READY+"_"+t,!0);break;case RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED:setTimeout(this.cacheNextAd.bind(this,t),
cleverapps.parseInterval(RewardedAdsManager.NEXT_AD_ERROR_DELAY));break;case RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED:case RewardedAdsManager.AD_ACTION_TYPE.REWARD_STARTED:cleverapps.audio.mute(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_START+"_"+t),t===RewardedAdsManager.INTERSTITIAL&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.WATCH_ADS),this.runListeners(this.onStartPlayListeners,t);break;case RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED:case RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED:case RewardedAdsManager.AD_ACTION_TYPE.REWARD_ENDED:case RewardedAdsManager.AD_ACTION_TYPE.REWARD_CANCELED:cleverapps.audio.unmute(),setTimeout(this.cacheNextAd.bind(this,t),cleverapps.parseInterval(RewardedAdsManager.NEXT_AD_DELAY)),this.runListeners(this.onEndPlayListeners,t)}}.bind(this),onRewardAction:function(e,t,s,i){console.log("RewardedAdsManager onRewardAction "+JSON.stringify(arguments)),cleverapps.history.add("video",1),RewardedAdsManager.rewardTime=Date.now(),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.AD_FINISH+"_"+t),cleverapps.user.channel&&cleverapps.eventLogger.logEvent("ad_r_"+cleverapps.user.channel),cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.WATCH_ADS),setTimeout(function(){this.runListeners(this.onRewardListeners,t)}.bind(this),0),cleverapps.playSession.inc(cleverapps.EVENTS.REWARDED_WATCHED),this.data.reward[t]=Date.now(),this.save()}.bind(this)}),this.cacheQueue={},setInterval(this.checkCacheQueue.bind(this),cleverapps.parseInterval("1 minute")))};RewardedAdsManager.prototype.init=function(){RewardedAdsManager.IsEnabled()&&sdkbox.PluginSdkboxAds&&sdkbox.PluginSdkboxAds.init(function(){RewardedAdsManager.ACTIVE_ADS.forEach(this.cacheNextAd.bind(this))}.bind(this))},RewardedAdsManager.prototype.checkCacheQueue=function(){var e=this.cacheQueue;this.cacheQueue={},Object.keys(e).forEach(function(e){this.cacheNextAd(e)}.bind(this))},RewardedAdsManager.prototype.cacheNextAd=function(e){e=e||RewardedAdsManager.REWARDED
,this.canCache(e)?(console.log("RewardedAdsManager caching "+e),sdkbox.PluginSdkboxAds.cache(RewardedAdsManager.ADMOB,e)):this.cacheQueue[e]=!0},RewardedAdsManager.prototype.isAvailable=function(e,t){return e=e||RewardedAdsManager.REWARDED,RewardedAdsManager.IsEnabled()&&(t||!cleverapps.flags.almostNoAds)&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&sdkbox.PluginSdkboxAds.isAvailable(e)},RewardedAdsManager.prototype.play=function(e,t,s){if(this.isAvailable(e,!0))"function"==typeof t&&(this.onRewardListeners[e]=t),e=e||RewardedAdsManager.REWARDED,sdkbox.PluginSdkboxAds.playAd("AdMob",e);else if(s&&this.canCache(e)){cleverapps.rewardedAdsManager.cacheNextAd(e);var i=new WaitWindow,n=Date.now(),o=setInterval(function(){(this.isAvailable(e,!0)||Date.now()>n+1e4)&&(i.close(!0),clearInterval(o),this.play(e,t))}.bind(this),1e3)}else cleverapps.Notification.create("messages:AdsUnavailable")},RewardedAdsManager.prototype.canCache=function(e){return e=e||RewardedAdsManager.REWARDED
,!(!RewardedAdsManager.IsEnabled()||-1===RewardedAdsManager.ACTIVE_ADS.indexOf(e)||!levels.user.checkAvailable(RewardedAdsManager.AVAILABLE))&&(e===RewardedAdsManager.REWARDED||!!levels.user.checkAvailable(RewardedAdsManager.INTERSTITIAL_AVAILABLE)&&(!cleverapps.paymentsHistory.isPayer()&&(!((this.data.reward[RewardedAdsManager.REWARDED]||0)+cleverapps.parseInterval(RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL)>Date.now())&&(!((this.data.reward[RewardedAdsManager.INTERSTITIAL]||0)+cleverapps.parseInterval(RewardedAdsManager.INTERSTITIAL_INTERVAL)>Date.now())&&0<RewardedAdsManager.INTERSTITIAL_PROB[Math.min(levels.user.episode,RewardedAdsManager.INTERSTITIAL_PROB.length-1)]))))},RewardedAdsManager.prototype.showInterstitial=function(){if(this.isAvailable(RewardedAdsManager.INTERSTITIAL)&&this.canCache(RewardedAdsManager.INTERSTITIAL)){var e=RewardedAdsManager.INTERSTITIAL_PROB[Math.min(levels.user.episode,RewardedAdsManager.INTERSTITIAL_PROB.length-1)];Math.random()<e&&(this.play(
RewardedAdsManager.INTERSTITIAL),this.data.reward[RewardedAdsManager.INTERSTITIAL]=Date.now(),this.save())}},RewardedAdsManager.prototype.runListeners=function(e,t){for(var s in e)0===s.indexOf(t)&&e[s]()},RewardedAdsManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.REWARDED_ADS_MANAGER);e||(e={}),e.reward||(e.reward={}),this.data=e},RewardedAdsManager.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_ADS_MANAGER,this.data)},RewardedAdsManager.ADMOB="AdMob",RewardedAdsManager.REWARDED="rewarded",RewardedAdsManager.INTERSTITIAL="interstitial",RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED],RewardedAdsManager.NEXT_AD_DELAY="10 seconds",RewardedAdsManager.NEXT_AD_ERROR_DELAY="3 minutes",RewardedAdsManager.AVAILABLE={episode:0,level:10},RewardedAdsManager.INTERSTITIAL_PROB=[0,0,.3,.3,.5,.5,.7,1],RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL="3 day",
RewardedAdsManager.INTERSTITIAL_INTERVAL="10 minutes","merge"===cleverapps.config.type&&(RewardedAdsManager.AVAILABLE={episode:0,level:2},RewardedAdsManager.INTERSTITIAL_PROB=[1],RewardedAdsManager.INTERSTITIAL_AVAILABLE={episode:0,level:5}),RewardedAdsManager.AD_ACTION_TYPE={LOADED:0,LOAD_FAILED:1,CLICKED:2,REWARD_STARTED:3,REWARD_ENDED:4,REWARD_CANCELED:5,AD_STARTED:6,AD_CANCELED:7,AD_ENDED:8,ADACTIONTYPE_UNKNOWN:9},RewardedAdsManager.IsEnabled=function(){var e=cleverapps.User.calcSource();if(-1===["huzcom","amazon","pliega"].indexOf(e)&&("mobile_vk"!==e||"html5_mobile"===cleverapps.MobileVk.getPlatfrom()))return cc.sys.isNative||cleverapps.isLocalhost()||-1!==["web_ok","mobile_ok","web_vk","mobile_vk","plinga","instant"].indexOf(e)};var FlyingHint=function(e,t){cleverapps.EventEmitter.call(this),cleverapps.flags.reduceAds&&(FlyingHint.INTERVAL="20 minutes"),cleverapps.flags.videoAdsMainMonetization&&(FlyingHint.INTERVAL="5 minutes"),cleverapps.config.debugMode&&(
FlyingHint.INTERVAL="30 seconds",FlyingHint.START_PLAY_INTERVAL="30 seconds",FlyingHint.CHECK_INTERVAL="1 seconds"),this.game=e,this.onReward=t,this.game.counter.registerStage(1001,function(){this.ready&&this.enable()}.bind(this)),FlyingHint.IsAvailable()&&setTimeout(this.checkIfReady.bind(this),cleverapps.parseInterval(FlyingHint.GAME_START_DELAY)),RewardedAdsManager.IsEnabled()&&(cleverapps.rewardedAdsManager.onStartPlayListeners[RewardedAdsManager.REWARDED+"_adicon"]=this.startPlay.bind(this),"ios"===cleverapps.User.calcSource()&&(cleverapps.rewardedAdsManager.onEndPlayListeners[RewardedAdsManager.REWARDED+"_adicon"]=this.startPlay.bind(this)))};FlyingHint.prototype=Object.create(cleverapps.EventEmitter.prototype),(FlyingHint.prototype.constructor=FlyingHint).prototype.onClick=function(){this.enabled&&(this.trigger("activate"),this.game.counter.setTimeout(function(){this.playAds()}.bind(this),1e3))},FlyingHint.prototype.playAds=function(){RewardedAdsManager.IsEnabled(
)?cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.reward.bind(this)):(this.startPlay(),this.reward())},FlyingHint.prototype.checkIfReady=function(){Game.currentGame===this.game&&(this.isReady()?(this.ready=!0,this.game.counter.isActive()||this.enable()):setTimeout(this.checkIfReady.bind(this),cleverapps.parseInterval(FlyingHint.CHECK_INTERVAL)))},FlyingHint.prototype.isReady=function(){return(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.AD_ICON,{raw:!0})||0)<Date.now()&&(FlyingHint.debugHint||cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED,!0))},FlyingHint.prototype.enable=function(){this.enabled||cleverapps.metha.isFocused()||(this.enabled=!0,this.trigger("enable"))},FlyingHint.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.trigger("disable"))},FlyingHint.prototype.reward=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.AD_ICON,Date.now()+cleverapps.parseInterval(FlyingHint.INTERVAL),{raw:!0}),
this.onReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_HINT)},FlyingHint.prototype.startPlay=function(){this.enabled&&(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.AD_ICON,Date.now()+cleverapps.parseInterval(FlyingHint.START_PLAY_INTERVAL),{raw:!0}),this.ready=!1,this.disable(),this.checkIfReady())},FlyingHint.IsAvailable=function(){return RewardedAdsManager.IsEnabled()&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&cleverapps.paymentsHistory.classify()<=cleverapps.PaymentsHistory.PAYER_NORMAL},FlyingHint.INTERVAL="10 minutes",FlyingHint.START_PLAY_INTERVAL="1 minute",FlyingHint.CHECK_INTERVAL="30 seconds",FlyingHint.GAME_START_DELAY="10 seconds";var FlyingHintView=cc.Node.extend({ctor:function(e){this._super(),cleverapps.config.debugMode&&(FlyingHintView.TIMEOUT=30),this.setAnchorPoint2(),this.flyingHint=e;var t=cleverapps.styles.FlyingHintView;this.setContentSize2(t),this.animation=new cleverapps.Spine(bundles.game.jsons.flying_hint_json),
this.animation.setSkin("normal"),this.addChild(this.animation),this.animation.setPositionRound(t.animation),this.setVisible(!1),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(this.setScale(t.mobile.scale),this.baseScale=this.scale),this.onMouseOver=function(){this.animation.setSkin("hover")}.bind(this),this.onMouseOut=function(){this.animation.setSkin("normal")}.bind(this),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.flyingHint.onClick.bind(this.flyingHint)),this.setLocalZOrder(10),cleverapps.metha.registerControl("flyingHint",function(e){this.enabled&&this.setVisible(e)}.bind(this)),this.enable(),this.flyingHint.on("disable",this.createListener(this.disable.bind(this))),this.flyingHint.on("enable",this.createListener(this.enable.bind(this))),this.flyingHint.on("activate",this.createListener(this.disappear.bind(this)))},disappear:function(){this.stopAllActions(),this.enabled=!1,this.animation.setAnimation(0,"application",!1),
this.animation.setCompleteListener(function(){this.setVisible(!1),this.animation.setCompleteListener(function(){})}.bind(this))},runMoveAnimation:function(){var e=cc.director.getRunningScene().scene,t=cleverapps.styles.FlyingHintView;this.setPositionRound(e.width/2,e.height/2+t.yOffset),this._runMoveAnimation(1,0)},_runMoveAnimation:function(e,t){if(t>FlyingHintView.TOTAL_FLY_TIMEOUT)return this.disappear(),void this.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.Hide,new cc.DelayTime(FlyingHintView.TIMEOUT),new cc.CallFunc(function(){this.enable()}.bind(this))));var s,i=cc.director.getRunningScene().scene,n=cleverapps.styles.FlyingHintView,o=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?n.mobile.xBorderOffset:n.xBorderOffset;0<e?(s=cc.p(i.width-o,this.y),this.animation.setScaleX(1)):(s=cc.p(o,this.y),this.animation.setScaleX(-1));var r=cleverapps.styles.FlyingHintView.speed,a=cc.pDistance(this.getPosition(),s)/r,c=Math.round(a/7),l=new cc.MoveBy(a,cc.p(
s.x-this.getPosition().x,0));if(0<c){for(var p=[],d=a/c/2,h=0;h<c;h++)p.push(new cc.MoveBy(d/2,cc.p(0,cleverapps.styles.FlyingHintView.animation.dy/2))),p.push(new cc.MoveBy(d,cc.p(0,-cleverapps.styles.FlyingHintView.animation.dy))),p.push(new cc.MoveBy(d/2,cc.p(0,cleverapps.styles.FlyingHintView.animation.dy/2)));l=new cc.Spawn(l,new cc.Sequence(p))}this.runAction(new cc.Sequence(l,new cc.CallFunc(function(){this._runMoveAnimation(-e,t+a)}.bind(this))))},enable:function(){this.flyingHint.enabled&&(this.enabled=!0,this.stopAllActions(),this.setVisible(!cleverapps.metha.isFocused()),this.animation.setAnimationAndIdleAfter("appearance","idle"),this.runMoveAnimation())},disable:function(){this.enabled=!1,this.stopAllActions(),this.setVisible(!1)}});FlyingHintView.TOTAL_FLY_TIMEOUT=45,FlyingHintView.TIMEOUT=300,cleverapps.styles.FlyingHintView={width:200,height:200,mobile:{xBorderOffset:160,scale:.8},animation:{x:{align:"center"},y:{align:"center",dy:-30},dy:60},yOffset:375,
xBorderOffset:300,speed:80};var AdsPlugin=function(){};AdsPlugin.prototype.init=function(e){e()};var VideoAds=function(){this.loading={},this.cached={},AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}};VideoAds.prototype=Object.create(AdsPlugin.prototype),(VideoAds.prototype.constructor=VideoAds).isAppropriate=function(){return cleverapps.isLocalhost()},VideoAds.prototype.setListener=function(e){this.listener=e},VideoAds.prototype.cache=function(e,t){this.loading[t]?console.log("Loading in progress, skipping request"):(this.loading[t]=!0,setTimeout(function(){delete this.loading[t],this.cached[t]=!0,this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.LOADED)}.bind(this),3e3))},VideoAds.prototype.isAvailable=function(e){return this.cached[e]},VideoAds.prototype.playAd=function(e,t){if(this.cached[t]){this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);var s=cc.director.getRunningScene(),i=s.width,
n=s.height;this.overlay=new cc.LayerColor(new cc.Color(200,200,255,255),i,n),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){return!0}},this.overlay),s.addChild(this.overlay);var o={font:cleverapps.styles.FONTS.BUTTON_TEXT,width:300*resolutionScale,height:100*resolutionScale,padding:20,onClicked:function(){this.stop(t)}.bind(this),text:"Skip ad"},r=new cleverapps.UI.Button(o);r.setPositionRound(this.overlay.width/2,200),r.disable(),this.waitForReward=setTimeout(function(){t===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(e,t,"gold",1),this.stop(t)}.bind(this),3e3),delete this.cached[t],r.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){r.enable()}))),this.overlay.addChild(r)}else console.log("Show: No video cached!")},VideoAds.prototype.stop=function(e){this.overlay&&(clearTimeout(this.waitForReward),this.listener.onAdAction("AdMob",e,RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED),
delete this.cached[e],this.overlay.isRunningSafe()&&this.overlay.removeFromParent(!0))};var OKAds=function(){this.cached={},this.inited=!1,AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}},RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED,RewardedAdsManager.INTERSTITIAL]};OKAds.prototype=Object.create(AdsPlugin.prototype),(OKAds.prototype.constructor=OKAds).isAppropriate=function(){return cleverapps.OK.isAppropriate()||cleverapps.MobileOK.isAppropriate()},OKAds.prototype.init=function(e){cleverapps.whenAllInitialized(function(){this.isInitialized()&&(this.inited=!0,e())}.bind(this))},OKAds.prototype.setListener=function(e){this.listener=e},OKAds.prototype.log=function(e){console.log(e)},OKAds.prototype.windowApiCallbackRewarded=function(e,t){this.log("window.API_callback "+e+" "+JSON.stringify(t)),"error"===e?this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED,
RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED):"ready"===t||"ad_prepared"===t?(this.cached[RewardedAdsManager.REWARDED]=!0,this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED,RewardedAdsManager.AD_ACTION_TYPE.LOADED)):"complete"!==t&&"ad_shown"!==t||(this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.listener.onRewardAction(RewardedAdsManager.ADMOB,RewardedAdsManager.REWARDED))},OKAds.prototype.windowApiCallbackInterstitial=function(e,t){this.log("window.API_callback "+e+" "+JSON.stringify(t)),"no_ads"===t||"error"===e?this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED):"ad_prepared"===t?(this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL,RewardedAdsManager.AD_ACTION_TYPE.LOADED),cleverapps.social.listeners.showAd=this.windowApiCallbackInterstitial.bind(this)
):"ad_shown"===t&&this.listener.onAdAction(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.cache(RewardedAdsManager.ADMOB,RewardedAdsManager.INTERSTITIAL)},OKAds.prototype.cache=function(e,t){this.inited&&(RewardedAdsManager.REWARDED===t?(FAPI.UI.loadAd(),cleverapps.social.listeners.loadAd=this.windowApiCallbackRewarded.bind(this)):RewardedAdsManager.INTERSTITIAL===t&&(this.cached[RewardedAdsManager.INTERSTITIAL]=!0))},OKAds.prototype.isAvailable=function(e){return this.cached[e]},OKAds.prototype.isInitialized=function(){return"undefined"!=typeof FAPI&&FAPI.UI.showAd&&FAPI.UI.showLoadedAd},OKAds.prototype.playAd=function(e,t){this.inited&&this.cached[t]&&(this.cached[t]=void 0,FullscreenControlButton.exitFullscreen(function(){t===RewardedAdsManager.REWARDED?(FAPI.UI.showLoadedAd(),cleverapps.social.listeners.showLoadedAd=this.windowApiCallbackRewarded.bind(this)):t===RewardedAdsManager.INTERSTITIAL&&(FAPI.UI.showAd(),
cleverapps.social.listeners.showAd=this.windowApiCallbackInterstitial.bind(this)),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)}.bind(this)))};var OKAppAds=function(){OKAds.call(this)};OKAppAds.prototype=Object.create(OKAds.prototype),(OKAppAds.prototype.constructor=OKAppAds).prototype.isInitialized=function(){return"undefined"!=typeof FAPI&&FAPI.UI.showAd&&FAPI.UI.showLoadedAd&&FAPI.UI.isNativeAdSupported&&FAPI.UI.isNativeAdSupported()},OKAppAds.isAppropriate=function(){return cleverapps.MobileOK.isAppropriate()&&cleverapps.isOkApp()};var VKAds=function(){this.inited=!1,this.cached={},AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}};VKAds.prototype=Object.create(AdsPlugin.prototype),(VKAds.prototype.constructor=VKAds).isAppropriate=function(){return cleverapps.VK.isAppropriate()||cleverapps.MobileVk.isAppropriate()&&"html5_mobile"===cleverapps.MobileVk.getPlatfrom()},VKAds.prototype.init=function(e){
var t=["//ad.mail.ru/static/admanhtml/rbadman-html5.min.js","//vk.com/js/api/adman_init.js"],s=function(){"undefined"!=typeof admanInit&&(this.inited=!0,console.log("Adman loaded"),e())}.bind(this),i=t.length,n=function(){0===--i&&s()};t.forEach(function(e){cleverapps.loadSdk(e,{onSuccess:n,onFailure:function(){console.log("Failed loading vk ads dependencies")}})})},VKAds.prototype.setListener=function(e){this.listener=e},VKAds.prototype.cache=function(e,t){this.inited&&(this.cached[t]?console.log("Already have "+t):admanInit({user_id:cleverapps.social.getUserID(),app_id:cleverapps.config.vk.appId,type:t===RewardedAdsManager.REWARDED?"rewarded":"preloader"},function(e){console.log("Vk ads: have ads!"),this.cached[t]=e,console.log(e)}.bind(this),function(){console.log("Vk ads: NO ads!")}))},VKAds.prototype.isAvailable=function(e){return this.inited&&void 0!==this.cached[e]&&RewardedAdsManager.REWARDED===e},VKAds.prototype.playAd=function(e,t){if(this.cached[t]){var s=this.cached[t]
;this.cached[t]=void 0,this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);var i=function(){this.listener.onRewardAction(e,t),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),i=function(){}}.bind(this),n=function(){this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED),n=function(){}}.bind(this);s.onCompleted(i),s.onClicked(i),s.onSkipped(n),s.start("preroll")}else console.log("No ads for: "+t)};var VKAppAds=function(){VKAds.call(this)};VKAppAds.prototype=Object.create(VKAds.prototype),(VKAppAds.prototype.constructor=VKAppAds).prototype.init=function(e){cleverapps.loadSdk("//unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js",{onSuccess:function(){"undefined"!=typeof vkBridge?(vkBridge.send("VKWebAppInit",{}),this.inited=!0,e()):console.log("Loading error: vkBridge is undefined")}.bind(this),onFailure:function(){console.log("Failed loading vk app ads dependencies")}})},VKAppAds.isAppropriate=function(){
return cleverapps.config.debugMode&&cleverapps.MobileVk.isAppropriate()&&"html5_mobile"!==cleverapps.MobileVk.getPlatfrom()},VKAppAds.prototype.cache=function(e,t){this.inited&&(this.cached[t]?console.log("Already have "+t):(vkBridge.send("VKWebAppGetAds",{}),vkBridge.subscribe(function(e){e.detail?console.log(e.detail.type):console.log("wrong VK app event")})))};var PlingaAds=function(){this.inited=!1,RewardedAdsManager.ACTIVE_ADS=[RewardedAdsManager.REWARDED,RewardedAdsManager.INTERSTITIAL],(cleverapps.isLocalhost()||cleverapps.isStagingHost())&&cleverapps.extend(this,FakePlingaAds),AdsPlugin.call(this),this.cached={},this.playing=void 0,this.reward=!1,this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}},RewardedAdsManager.AVAILABLE={episode:0,level:0},RewardedAdsManager.INTERSTITIAL_AVAILABLE={episode:0,level:0},RewardedAdsManager.INTERSTITIAL_PROB=[1],RewardedAdsManager.INTERSTITIAL_REWARD_INTERVAL="0 seconds",
RewardedAdsManager.INTERSTITIAL_INTERVAL="5 minutes"};PlingaAds.prototype=Object.create(AdsPlugin.prototype),(PlingaAds.prototype.constructor=PlingaAds).isAppropriate=function(){return cleverapps.social instanceof cleverapps.Plinga},PlingaAds.prototype.init=function(e){cleverapps.social.whenInitialized("plingaads",function(){cleverapps.social.eventListener=this.onEvent.bind(this),cleverapps.whenAllInitialized(function(){console.log("plinga social inited - cache ads"),this.inited=!0,e()}.bind(this))}.bind(this))},PlingaAds.prototype.onEvent=function(e){if(this.playing)switch(e.name){case"USER_CLOSE":case"SKIPPED":this.listener.onAdAction(RewardedAdsManager.ADMOB,this.playing,this.lastAction=RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED);break;case"STARTED":this.listener.onAdAction(RewardedAdsManager.ADMOB,this.playing,this.lastAction=RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED);break;case"ALL_ADS_COMPLETED":this.playing===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(
RewardedAdsManager.ADMOB,this.lastAction=RewardedAdsManager.REWARDED),this.reward=!1,this.listener.onAdAction(RewardedAdsManager.ADMOB,this.playing,this.lastAction=RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),this.playing=void 0}},PlingaAds.prototype.setListener=function(e){this.listener=e},PlingaAds.prototype.cache=function(e,t){if(this.inited)if(this.cached[t])console.log("Already have "+t);else try{"undefined"!==gdsdk&&"undefined"!==gdsdk.preloadAd&&gdsdk.preloadAd(t).then(function(e){console.log("Plinga ads: have ads!",t,e),this.cached[t]=!0}.bind(this)).catch(function(e){console.log("Plinga ads: NO ads!",e)})}catch(e){console.log("Error gdsdk.preloadAd",e);var s=new Error("Error gdsdk.preloadAd");throw s.stack+=e.stack,s}},PlingaAds.prototype.isAvailable=function(e){return this.inited&&this.cached[e]},PlingaAds.prototype.playAd=function(t,s){if(this.cached[s])try{"undefined"!==gdsdk&&"undefined"!==gdsdk.showAd&&(this.playing=s,delete this.lastAction,gdsdk.showAd(s).then(function(e
){this.cached[s]=!1,this.reward=!1,void 0===this.lastAction&&this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)}.bind(this)).catch(function(e){delete this.playing,console.log("Plinga showAd error:",e)}))}catch(e){console.log("Error gdsdk.showAd",e);var i=new Error("Error gdsdk.showAd");throw i.stack+=e.stack,i}else console.log("No ads for: "+s)};var FakePlingaAds={onEvent:function(e){},cache:function(e,t){},isAvailable:function(e){return!1},playAd:function(e,t){}},AppLixir=function(){this.inited=!1,AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}};AppLixir.prototype=Object.create(AdsPlugin.prototype),(AppLixir.prototype.constructor=AppLixir).isAppropriate=function(){return!cleverapps.isLocalhost()&&cleverapps.Html5.isAppropriate()},AppLixir.prototype.init=function(e){this.inited=!0;var t=document.createElement("div");t.id="applixerLayout",t.style.width="100%",t.style.height="100%",t.style.left="0px",
t.style.top="0px",t.style.position="absolute",t.style.backgroundColor="#00000050",t.style.zIndex="1000000000",t.style.visibility="hidden",document.body.appendChild(t),e()},AppLixir.prototype.setListener=function(e){this.listener=e},AppLixir.prototype.cache=function(e,t){},AppLixir.prototype.isAvailable=function(e){return this.inited&&RewardedAdsManager.REWARDED===e},AppLixir.prototype.playAd=function(t,s){var e,i,n,o=function(e){"ad-watched"===e?(this.listener.onRewardAction(t,s),this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)):"ad-interrupted"===e?this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_CANCELED):"ad-started"===e?this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED):"ads-unavailable"===e?cleverapps.Notification.create("messages:AdsUnavailable"):console.log("Applixir error status: "+e)}.bind(this),r=function(){window.removeEventListener("message",e,!1),document.getElementById("applixerLayout"
).style.visibility="hidden",clearInterval(i)},a="https://cleverappssg.com";e=function(e){if(e.origin===a)if("z2-ready"!=e.data)"ad-interrupted"!=e.data&&"ads-unavailable"!=e.data&&"ad-watched"!=e.data&&"sys-closing"!=e.data||(n.close(),r()),o(e.data);else{var t={zoneId:cleverapps.config.debugMode?2050:cleverapps.config.applixir.zoneId,devId:cleverapps.config.applixir.accountId,gameId:cleverapps.config.applixir.gameId,fallback:0};e.source.postMessage("loadOptions="+JSON.stringify(t),a)}},window.addEventListener("message",e,!1);var c=(screen.width-800)/2,l=(screen.height-600)/2;n=window.open(a+"/applixir/z2index.html","popup","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=800, height=600, top="+l+", left="+c),document.getElementById("applixerLayout").style.visibility="visible",i=setInterval(function(){n.closed&&r()},100)};var InstantAds=function(){this.supported=!0,AdsPlugin.call(this),console.log("Choose InstantAds"),
cleverapps.social.whenInitialized("instantads",function(){-1===FBInstant.getSupportedAPIs().indexOf("getRewardedVideoAsync")?(console.log("FBInstant getRewardedVideoAsync is not supported!"),this.supported=!1):console.log("Found support for FBInstant getRewardedVideoAsync")}.bind(this)),this.cached={},this.loaded={},this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}};InstantAds.prototype=Object.create(AdsPlugin.prototype),(InstantAds.prototype.constructor=InstantAds).prototype.setListener=function(e){this.listener=e},InstantAds.prototype.cache=function(e,t){if(this.supported&&cleverapps.config.instantAds){var s=cleverapps.config.instantAds[t];if(s)this.cached[t]=void 0,(t===RewardedAdsManager.REWARDED?FBInstant.getRewardedVideoAsync:FBInstant.getInterstitialAdAsync).call(FBInstant,s).then(function(e){return this.cached[t]=e,this.loaded[t]=!1,console.log("Loaded instant ad config: "+t),e.loadAsync()}.bind(this)).then(function(){this.loaded[t]=!0,console.log(
"Loaded instant ad video: "+t),this.listener.onAdAction(e,t,RewardedAdsManager.AD_ACTION_TYPE.LOADED)}.bind(this))}},InstantAds.prototype.isAvailable=function(e){return!!this.supported&&this.loaded[e]},InstantAds.prototype.playAd=function(t,s){this.supported&&(this.cached[s]?(this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED),this.loaded[s]=!1,this.cached[s].showAsync().then(function(){this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED),s===RewardedAdsManager.REWARDED&&this.listener.onRewardAction(t,s)}.bind(this)).catch(function(e){console.error(e.message),this.listener.onAdAction(t,s,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)}.bind(this))):console.log("Show: No video cached: "+s))};var WebViewAds=function(){this.available={},cc.sys.os===cc.sys.OS_IOS&&(AdMobPlugin=new cleverapps.IOSWebViewAdMobPluginAdapter,this.inited=!1),AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}}
;WebViewAds.prototype=Object.create(AdsPlugin.prototype),(WebViewAds.prototype.constructor=WebViewAds).prototype.init=function(e){cc.sys.os===cc.sys.OS_IOS?(this.onInitCallback=e,AdMobPlugin.init()):e()},WebViewAds.prototype.onInit=function(){if(this.inited=!0,this.onInitCallback){var e=this.onInitCallback;delete this.onInitCallback,e()}},WebViewAds.prototype.setListener=function(e){this.listener=e},WebViewAds.prototype.cache=function(e,t){!1!==this.inited&&AdMobPlugin.cache(t)},WebViewAds.prototype.onPaidEvent=function(e,t,s){s=s||"admob",t=t||"USD";var i=e/1e6;cleverapps.eventLogger.logEvent("ad_paid_"+s+"_"+t,{amount:i})},WebViewAds.prototype.onAdLoaded=function(e,t){t=t||"admob",cleverapps.eventLogger.logEvent("ad_loaded_"+e+"_"+t),this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOADED)},WebViewAds.prototype.onAdClosed=function(e){this.listener.onAdAction(e,e,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)},
WebViewAds.prototype.onAdFailedToLoad=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED)},WebViewAds.prototype.onAdLeftApplication=function(e){},WebViewAds.prototype.onAdOpened=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)},WebViewAds.prototype.onReward=function(e,t,s,i){i=i||"admob",cleverapps.eventLogger.logEvent("ad_reward_"+i),this.listener.onRewardAction(RewardedAdsManager.ADMOB,e,s,!0)},WebViewAds.prototype.isAvailable=function(e){return this.available[e]},WebViewAds.prototype.playAd=function(e,t){AdMobPlugin.show(t)},WebViewAds.isAppropriate=function(){return cc.sys.isNative&&cc.sys.isWebView&&("undefined"!=typeof AdMobPlugin||cc.sys.os===cc.sys.OS_IOS)},cleverapps.IOSWebViewAdMobPluginAdapter=function(){},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.init=function(){console.log("IOSWebViewAdMobPluginAdapter init"),webkitMessage("adMob",{action:"init"})
},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.cache=function(e){console.log("IOSWebViewAdMobPluginAdapter cache"),webkitMessage("adMob",{action:"cache",name:e})},cleverapps.IOSWebViewAdMobPluginAdapter.prototype.show=function(e){console.log("IOSWebViewAdMobPluginAdapter show"),webkitMessage("adMob",{action:"show",name:e})};var Yodo1Ads=function(){this.available={},cc.sys.os===cc.sys.OS_IOS&&(Yodo1AdsPlugin=new cleverapps.IOSWebViewYodo1AdsPluginAdapter),this.inited=!1,AdsPlugin.call(this),this.listener={onAdAction:function(e,t,s){},onRewardAction:function(e,t,s,i){}}};Yodo1Ads.prototype=Object.create(AdsPlugin.prototype),(Yodo1Ads.prototype.constructor=Yodo1Ads).prototype.init=function(e){this.onInitCallback=e,Yodo1AdsPlugin.init()},Yodo1Ads.prototype.onInit=function(){if(this.inited=!0,this.onInitCallback){var e=this.onInitCallback;delete this.onInitCallback,e()}},Yodo1Ads.prototype.setListener=function(e){this.listener=e},Yodo1Ads.prototype.cache=function(e,t){},
Yodo1Ads.prototype.onAdLoaded=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOADED)},Yodo1Ads.prototype.onAdClosed=function(e){this.listener.onAdAction(e,e,RewardedAdsManager.AD_ACTION_TYPE.AD_ENDED)},Yodo1Ads.prototype.onAdFailedToLoad=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.LOAD_FAILED)},Yodo1Ads.prototype.onAdLeftApplication=function(e){},Yodo1Ads.prototype.onAdOpened=function(e){this.listener.onAdAction(RewardedAdsManager.ADMOB,e,RewardedAdsManager.AD_ACTION_TYPE.AD_STARTED)},Yodo1Ads.prototype.onReward=function(e,t,s){this.listener.onRewardAction(RewardedAdsManager.ADMOB,e,s,!0)},Yodo1Ads.prototype.isAvailable=function(e){return this.available[e]},Yodo1Ads.prototype.playAd=function(e,t){Yodo1AdsPlugin.show(t)},Yodo1Ads.isAppropriate=function(){return cc.sys.isNative&&cc.sys.isWebView&&-1!==["ayodo1","iyodo1"].indexOf(cleverapps.User.calcSource())&&(
"undefined"!=typeof Yodo1AdsPlugin||cc.sys.os===cc.sys.OS_IOS)},cleverapps.IOSWebViewYodo1AdsPluginAdapter=function(){},cleverapps.IOSWebViewYodo1AdsPluginAdapter.prototype.init=function(){console.log("IOSWebViewYodo1AdsPluginAdapter init"),webkitMessage("yodo1AdsPlugin",{action:"init"})},cleverapps.IOSWebViewYodo1AdsPluginAdapter.prototype.cache=function(e){console.log("IOSWebViewYodo1AdsPluginAdapter cache"),webkitMessage("yodo1AdsPlugin",{action:"cache",name:e})},cleverapps.IOSWebViewYodo1AdsPluginAdapter.prototype.show=function(e){console.log("IOSWebViewYodo1AdsPluginAdapter show"),webkitMessage("yodo1AdsPlugin",{action:"show",name:e})};var BountyManager=function(){this.when=void 0,this.prizes=[],cleverapps.config.debugMode&&(BountyManager.POPUP_INTERVAL="10 minutes"),this.load(),cleverapps.friends.addFriendsUpdatedListener(this.onFriendsUpdated.bind(this))};BountyManager.openWindow=function(e){new BountyWindow(e)},BountyManager.prototype.onFriendsUpdated=function(){
cleverapps.social instanceof cleverapps.MobileVk&&(this.prizes=this.prizes.filter(function(e){return e.friends=e.friends.filter(function(e){return cleverapps.friends.inApp(e.id)}),0<e.friends.length&&(void 0===e.minFriendsNo||e.friends.length>=e.minFriendsNo)}),this.save(this.when))},BountyManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.BOUNTY);e?(this.when=e.when,this.prizes=e.prizes||[],this.when>Date.now()&&this.save()):this.save(-1)},BountyManager.prototype.save=function(e){this.when=e||Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.BOUNTY,{when:this.when,prizes:this.prizes})},BountyManager.prototype.collect=function(e,t){if(t&&t.removeAllChildren(),e.type===BountyManager.TYPE_STAR)return cleverapps.starChest.addStars(e.amount),void(cleverapps.starChest.locked||cleverapps.metha.display({focus:"BountyManagerStarChestWindow",action:function(e){new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}}))
;e.type===BountyManager.TYPE_LIFE&&cleverapps.lives?WindowHelper.animateCollect(t,{scale:.8,target:cleverapps.styles.MenuBar.LivesItem.target},function(){cleverapps.lives.setAmount(cleverapps.lives.amount+e.amount)}):WindowHelper.animateCollect(t,{scale:.8,target:cleverapps.styles.MenuBar.GoldItem.target},function(){levels.user.setGold(levels.user.gold+e.amount)})},BountyManager.prototype.isActive=function(){return!cleverapps.flags.noviral&&"merge"!==cleverapps.config.type},BountyManager.prototype.needRefresh=function(){return Date.now()-this.when>=cleverapps.parseInterval(BountyManager.POPUP_INTERVAL)},BountyManager.prototype.refreshPrizes=function(){if(!this.needRefresh())return!1;var e=levels.friendSorter.listActiveFriends();cleverapps.Random.shuffle(e);var t=levels.friendSorter.listInactiveFriends();cleverapps.Random.shuffle(t);var n=e.concat(t).map(function(e){if(e&&e.id)return{id:e.id,avatar:e.avatar}});return this.prizes=[],BountyManager.PRIZES.forEach(function(e,t){(
e=cleverapps.clone(e,!0)).id=t;var s=n;if(!(!e.minFriendsNo&&e.friendsNo>s.length||e.minFriendsNo>s.length||!cleverapps.lives&&e.type===BountyManager.TYPE_LIFE||!cleverapps.config.results&&e.type===BountyManager.TYPE_STAR)&&BountyManager.ACTIVE_TYPES[e.type]){var i=e.friendsNo;i>s.length&&(i=s.length),e.friends=s.splice(0,i),this.prizes.push(e)}}.bind(this)),this.save(),cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.BOUNTY,cleverapps.parseInterval(BountyManager.POPUP_INTERVAL)),!0},BountyManager.prototype.sendIfNeed=function(){if(this.isActive()&&0!==cleverapps.friends.listFriends().length){var e=this.refreshPrizes();if(!(this.prizes.length<1)){var t=levels.friendRequests.notProcessed.filter(function(e){return e.from===levels.FriendRequest.SYSTEM_ID&&e.type===levels.FriendRequest.TYPE_BOUNTY_READY});0<t.length?e&&(t.forEach(function(e){levels.friendRequests.processById(e.id)}),this.createRequest()):this.createRequest()}}},BountyManager.prototype.createRequest=function(){
levels.friendRequests.notProcessed.push(levels.FriendRequest.createFriendRequest({id:"__"+Math.floor(1e15*Math.random()),from:levels.FriendRequest.SYSTEM_ID,type:levels.FriendRequest.TYPE_BOUNTY_READY,fake:!0})),levels.friendRequests.save(),levels.friendRequests.onNewListener()},BountyManager.prototype.listPrizes=function(){return this.prizes},BountyManager.prototype.removePrize=function(e){for(var t=0;t<this.prizes.length;t++)if(this.prizes[t].id===e.id){this.prizes.splice(t,1),this.save();break}},BountyManager.POPUP_INTERVAL="12 hour",BountyManager.TYPE_LIFE=0,BountyManager.TYPE_STAR=1,BountyManager.TYPE_GOLD_1=2,BountyManager.TYPE_GOLD_2=3,BountyManager.ACTIVE_TYPES={},BountyManager.ACTIVE_TYPES[BountyManager.TYPE_LIFE]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_STAR]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_GOLD_1]=!0,BountyManager.ACTIVE_TYPES[BountyManager.TYPE_GOLD_2]=!0,BountyManager.PRIZES=[{type:BountyManager.TYPE_GOLD_1,amount:5,friendsNo:1},{
type:BountyManager.TYPE_STAR,amount:1,friendsNo:2,minFriendsNo:1},{type:BountyManager.TYPE_GOLD_2,amount:10,friendsNo:3,minFriendsNo:1},{type:BountyManager.TYPE_LIFE,amount:1,friendsNo:4,minFriendsNo:1},{type:BountyManager.TYPE_GOLD_2,amount:15,friendsNo:5,minFriendsNo:3},{type:BountyManager.TYPE_STAR,amount:1,friendsNo:10,minFriendsNo:3},{type:BountyManager.TYPE_GOLD_2,amount:15,friendsNo:10,minFriendsNo:4},{type:BountyManager.TYPE_GOLD_2,amount:10,friendsNo:10,minFriendsNo:5}];var BountyItemView=cc.Node.extend({ctor:function(e){this._super(),this.prize=e,this.onAcceptListener=function(){};var n=cleverapps.styles.BountyItemView,t=cleverapps.UI.createScale9Sprite(n.Background.image,cleverapps.UI.Scale9Rect.TwoPixelXY),s=n.Background.width;cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(s+=n.wide.Background.x),t.setContentSize2(s,n.Background.height),this.simpleBg=t,this.setAnchorPoint(.5,.5),this.setContentSize(t.getContentSize()),t.setPosition(this.width/2,this.height/2),
this.addChild(t);var i=this.content=new cc.Node;i.setAnchorPoint2(),i.setPosition(cleverapps.styles.BountyItemView.icon.x,this.height/2),this.addChild(i);var o=cleverapps.styles.BountyItemView.ICONS[e.type],r=new cc.Sprite(o);r.setScale(cleverapps.styles.BountyItemView.icon.scale);var a=r.getContentSize();i.setContentSize(a.width*r.scale,a.height*r.scale),i.addChild(r),r.setPositionRound(i.width/2,i.height/2),this.image=r,e.amount&&this.addAmountToIcon(e.amount);var c=n.avatars.width;cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(c+=n.wide.avatars.width);var l=n.avatar.x,p=e.friends.length;10<p&&(p=10),c<p*l&&(l=c/p),e.friends.forEach(function(e,t){if(!(p<t)){var s=e.id;if("string"==typeof e&&(s=e,e=void 0),e=e||cleverapps.friends.getById(s)||cleverapps.invitalbleFriends.getById(s)){var i=new cleverapps.UI.Avatar(e);i.setPosition(i.width/2+n.avatars.x+t*l,this.height/2+n.avatar.y),this.addChild(i),i.setScale(.8)}}},this);var d=this.getButton(e);this.addChild(d),
cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.onAcceptListener.bind(this))},addAmountToIcon:function(e){var t=cleverapps.styles.BountyItemView,s=cleverapps.UI.generateImageText("+"+e,cleverapps.styles.FONTS.BOUNTY_AMOUNT_TEXT||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);s.setPosition(this.content.width/2+t.amount.x,this.content.height/2+t.amount.y),this.content.addChild(s)},onMouseOver:function(){var e=cleverapps.styles.BountyItemView.Background;e.imageOn?this.simpleBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(e.imageOn)):this.simpleBg.setColor(cleverapps.styles.COLORS.COLOR_VERYLIGHTBROWN)},onMouseOut:function(){var e=cleverapps.styles.BountyItemView.Background;e.imageOn?this.simpleBg.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(e.image)):this.simpleBg.setColor(cleverapps.styles.COLORS.WHITE)},getButton:function(e){var t=cleverapps.styles.BountyItemView.Button,s=new cc.Node;s.setPosition(t.width/2,t.height/2);var i=cleverapps.UI.generateOnlyText(
"messages:Collect",t.font);i.fitTo(.9*t.width),i.setPosition(0,t.text.y),s.addChild(i);var n={onClicked:function(){this.onAcceptListener()}.bind(this),width:t.width,height:t.height,content:s,button_png:t.button_png,button_on_png:t.button_on_png},o=new cleverapps.UI.Button(n);return o.setPositionRound(this.width-o.width/2+cleverapps.styles.BountyItemView.Button.x,this.height/2),o},animateBuy:function(){cleverapps.styles.MenuBar.LivesItem.target&&WindowHelper.animateCollect(this.content,{scale:.3,target:cleverapps.styles.MenuBar.LivesItem.target})}});cleverapps.styles.BountyItemView={ICONS:{},Background:{scale9:!0,width:680,height:100,image:bundles.main.frames.bounty_item_bg},wide:{Background:{x:100},avatars:{width:80}},icon:{scale:1,x:50},amount:{x:60,y:-20},avatars:{x:170,width:240},avatar:{x:100,y:-3},Button:{width:160,height:70,x:-15,button_png:bundles.buttons_main.frames.small_green_button,button_on_png:bundles.buttons_main.frames.small_green_button_on,
font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,text:{y:0}}},cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_GOLD_1]=bundles.main.frames.coin_png,cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_GOLD_2]=bundles.main.frames.coin_png,cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_LIFE]=bundles.request_center.frames.accept_life_icon,cleverapps.styles.BountyItemView.ICONS[BountyManager.TYPE_STAR]=bundles.request_center.frames.accept_star_icon;var BountyWindow=Window.extend({onWindowLoaded:function(n){var e=cleverapps.styles.BountyWindow,t=new cc.Node;t.setAnchorPoint(.5,.5),this.content=t,this.onSocialRequestResponse=this.createListener(function(e,t){t.onAcceptListener=function(){},cleverapps.bountyManager.collect(e,t.image),t.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.RemoveSelf,new cc.CallFunc(function(){this.bountyViews.splice(this.bountyViews.indexOf(t),1),this.moveToPosition()},this)))});var s=cleverapps.throttle(
cleverapps.UI.SOCIAL_CLICK_THROTTLE,function(e,t){var s="bountyGold";e.type===BountyManager.TYPE_STAR&&(s="bountyStar"),e.type===BountyManager.TYPE_LIFE&&(s="bountyLife");var i=e.friends.map(function(e){return e&&e.id?e.id:e});cleverapps.social.sendRequest(i,s,function(){this.onSocialRequestResponse(e,t)}.bind(this)),cleverapps.bountyManager.removePrize(e),n.remove()}.bind(this));cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOUNTY_OPENED),this.bountyViews=cleverapps.bountyManager.listPrizes().map(function(e){var t=new BountyItemView(e);return t.onAcceptListener=function(){s(e,t)},this.content.addChild(t),t}.bind(this));var i=this.bountyViews.map(function(e){return e});i.reverse();var o=cleverapps.UI.arrangeWithMargins(i,{y:e.items.y,margin:e.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(e.width/2)});if(this.total=o,t.setContentSize2(e.width,o+e.height),0===i.length)this.generateNoFriendsContent();else{var r=cleverapps.UI.generateTTFText("messages:BountyWindow.Text",
cleverapps.styles.FONTS.WINDOW_TEXT);r.setPositionRound(t.width/2,o+e.text.y),t.addChild(r)}this._super({name:"bountywindow",title:"messages:BountyWindow.Title",content:t}),cleverapps.audio.playSound(bundles.game.urls.perfect_effect)},moveToPosition:function(){if(0!==this.bountyViews.length){var e=this.bountyViews.map(function(e){return e});e.reverse();var t=cleverapps.styles.BountyWindow,s=cleverapps.UI.arrangeWithMargins(e,{y:t.items.y,margin:t.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(t.width/2),iterator:function(){}});cleverapps.UI.arrangeWithMargins(e,{y:t.items.y+(this.total-s),margin:t.item.y,direction:cleverapps.UI.VERTICAL,x:Math.round(t.width/2),iterator:function(e,t,s){e.stopAllActions(),e.runAction(new cc.MoveTo(.5,t,s))}})}else this.close()},generateNoFriendsContent:function(){var e=cleverapps.styles.BountyWindow.noFriends;this.content.setContentSize(e.width,e.height);var t=cleverapps.UI.generateTTFText("messages:BountyWindow.noFriendsText",
cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2,e.Text.y),t.setDimensions(e.Text.width,e.Text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(t);var s=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){this.close()}.bind(this))}.bind(this)});s.setPositionRound(this.content.width/2,e.Button.y),this.content.addChild(s)}});cleverapps.styles.BountyWindow={width:690,height:150,noFriends:{width:690,height:500,Text:{y:250,width:550,height:200},Button:{width:450,height:120,y:0}},text:{y:60},items:{y:-20},item:{y:10},animation:{x:300,y:200}};var PiggyBank=function(){cleverapps.config.debugMode&&(PiggyBank.LIFETIME="10 minutes",PiggyBank.INTERMISSION="2 day"),this.active=void 0,this.when=void 0,this.level=void 0,this.amount=0,this.load()}
;PiggyBank.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PIGGY_BANK);void 0===e&&(e={active:!1,when:void 0,level:0,amount:0}),this.active=e.active,this.when=e.when,this.level=e.level,this.amount=e.amount,this.updateState()},PiggyBank.prototype.getInfo=function(){return{active:this.active,when:this.when,level:this.level,amount:this.amount}},PiggyBank.prototype.updateInfo=function(e,t){this.active=e.active,this.when=e.when,this.level=e.level,this.amount=e.amount,this.save(t)},PiggyBank.prototype.getLeftTime=function(){return cleverapps.parseInterval(PiggyBank.LIFETIME)-(Date.now()-this.when)},PiggyBank.prototype.getProduct=function(){return Product.Create(["piggybank500","piggybank1800","piggybank6000","piggybank25000"][this.level])},PiggyBank.prototype.buy=function(e){var t=this.getProduct();t.reward.gold=this.amount,t.piggyBankLevel=this.level,t.buy(function(){this.onBuy(),e()}.bind(this))},PiggyBank.prototype.onBuy=function(){
cleverapps.history.add("piggy",1),this.stop()},PiggyBank.prototype.updateState=function(){var e=!1;this.active&&this.when+cleverapps.parseInterval(PiggyBank.LIFETIME)<Date.now()&&(this.active=!1,this.when=this.when+cleverapps.parseInterval(PiggyBank.LIFETIME),e=!0,this.logStop()),this.active||(void 0===this.when||this.when+cleverapps.parseInterval(PiggyBank.INTERMISSION)<Date.now())&&(this.start(),e=!1),e&&this.save(),clearTimeout(this.timer),this.timer=new cleverapps.LongTimeout(function(){cleverapps.sideBar.resetByClassName(PiggyBankIcon)}.bind(this),this.getLeftTime())},PiggyBank.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PIGGY_BANK,{active:this.active,when:this.when,level:this.level,amount:this.amount}),e||cleverapps.synchronizer.addUpdateTask("piggybank")},PiggyBank.prototype.getBaseAmount=function(){return this.getProduct().reward.gold},PiggyBank.prototype.getAddAmount=function(){return(this.getMaxAmount()-this.getBaseAmount()
)/PiggyBank.WINS_TO_FULFILL},PiggyBank.prototype.getMaxAmount=function(){return Math.round(this.getBaseAmount()*PiggyBank.MAX_COEF/PiggyBank.WINS_TO_FULFILL)*PiggyBank.WINS_TO_FULFILL},PiggyBank.prototype.isFull=function(){return this.amount>=this.getMaxAmount()},PiggyBank.prototype.addGold=function(e){this.isFull()||(this.amount+=e,this.save(),this.isFull()&&cleverapps.sideBar.resetByClassName(PiggyBankIcon))},PiggyBank.MAX_COEF=1.4,PiggyBank.prototype.start=function(){this.active=!0,this.when=Date.now(),this.level=cleverapps.paymentsHistory.classify(),this.level===cleverapps.PaymentsHistory.PAYER_BIGWHALE&&(this.level=cleverapps.PaymentsHistory.PAYER_WHALE);var e=this.getProduct();this.amount=e.reward.gold,this.save()},PiggyBank.prototype.logStop=function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK+"_stop"),this.isFull()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PIGGY_BANK+"_stop_full")},PiggyBank.prototype.stop=function(){this.logStop(),this.active=!1,
this.when=Date.now(),this.save(),cleverapps.sideBar.resetByClassName(PiggyBankIcon)},PiggyBank.prototype.isActive=function(){return!!levels.user.checkAvailable(PiggyBank.AVAILABLE)&&(!cleverapps.flags.nopayments&&(this.updateState(),this.active||this.start(),this.active))},PiggyBank.AVAILABLE={episode:1,level:12},PiggyBank.WINS_TO_FULFILL=10,PiggyBank.LIFETIME="3 days",PiggyBank.INTERMISSION="3 days";var PiggyBankVictoryAnimation=cleverapps.Spine.extend({ctor:function(){this._super(bundles.piggybank_window.jsons.piggy_bank_window_json),this.setAnimation(0,"piggy_victory",!0)}}),PiggyBankWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.piggyBank.getLeftTime();if(!(e<=0)){var t=cleverapps.styles.PiggyBankWindow,s=new cc.Node;s.setContentSize2(t.animation.width,t.animation.height),s.setAnchorPoint2();var i=new cleverapps.Spine(t.animation.json);i.setAnimation(0,cleverapps.piggyBank.isFull()?"piggy_full":"piggy_bank",!0),i.setPositionRound(s.width/2,s.height/2+t.animation.y
),s.addChild(i);var n=new cc.Node,o=cleverapps.UI.generateTTFText("messages:Balance",cleverapps.styles.FONTS.WINDOW_TEXT);o.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(0,t.text.height),n.addChild(o);var r=cleverapps.UI.createScale9Sprite(t.timer.bg);r.setContentSize2(t.amount.width,t.amount.height);var a=new cc.Node,c=new cc.Sprite(bundles.menubar.frames.coin_png);c.setFlippedX(t.amount.coin.flip),c.setScale(t.amount.coin.scale),a.addChild(c);var l=cleverapps.UI.generateImageText(cleverapps.formatAmount(cleverapps.piggyBank.amount),cleverapps.styles.FONTS.PIGGY_BANK_AMOUNT_TEXT,{});a.addChild(l),cleverapps.UI.arrangeWithMargins(a.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.amount.margin}),cleverapps.UI.wrap(a),l.y+=t.amount.y,a.setAnchorPoint2(),a.setPositionRound(r.width/2,r.height/2),r.addChild(a),n.addChild(r),cleverapps.UI.arrangeWithMargins(n.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.timer.margin.x}),cleverapps.UI.wrap(n),n.setAnchorPoint2(
);var p=cleverapps.piggyBank.getProduct(),d=cleverapps.UI.generateTTFText("messages:PiggyBankWindow.text2",cleverapps.styles.FONTS.WINDOW_TEXT);d.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.setDimensions(0,t.text.height);var h=cleverapps.UI.createScale9Sprite(t.timer.bg);h.setContentSize2(t.timer.width,t.timer.height);var u={background_content:h,font:cleverapps.styles.FONTS.PIGGY_BANK_WINDOW_TIMER_TEXT||cleverapps.styles.FONTS.WHITE_TEXT,timerPosition:t.timer,regularFontTimerPosition:t.timer.regularFont},g=new cleverapps.CountDownView(new cleverapps.CountDown(e,{onFinish:function(){this.close()}.bind(this)}),u),v=new cc.Node;v.addChild(d),v.addChild(g),cleverapps.UI.arrangeWithMargins(v.children,{direction:cleverapps.UI.HORIZONTAL,margin:t.timer.margin.x}),cleverapps.UI.wrap(v),v.setAnchorPoint2();var m=cleverapps.piggyBank.isFull()?"messages:PiggyBankWindow.text1.Full":"messages:PiggyBankWindow.text1",f=cleverapps.UI.generateTTFText(m,cleverapps.styles.FONTS.WINDOW_TEXT,{
price:p.getCurrentPrice()});f.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),f.setDimensions(t.text.width,0),f.fitTo(void 0,t.text.height);var _=new cc.Node;_.setContentSize2(0,t.amount.margin);var y=new cc.Node;y.addChild(f),y.addChild(_),y.addChild(n),y.addChild(s),s.setLocalZOrder(1),y.addChild(v),cleverapps.UI.arrangeWithMargins(y.children,{direction:cleverapps.UI.VERTICAL,margin:t.margin}),cleverapps.UI.wrap(y),y.setAnchorPoint2(),y=cleverapps.UI.wrapWithPadding(y,{x:0,y:t.padding.y});var w=t.button;w.text=Messages.get("GetIt"),w.font=cleverapps.styles.FONTS.PIGGY_BANK_BUTTON_TEXT,w.onPressed=function(){cleverapps.piggyBank.buy(this.close.bind(this))}.bind(this);var T=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.PiggyBankWindow,!0);this._super({name:"piggybankwindow",title:cleverapps.piggyBank.isFull()?"messages:PiggyBankWindow.Title.Full":"messages:PiggyBankWindow.Title",content:y,button:w,help:function(){new PiggyBankRulesWindow},styles:T}),
cleverapps.audio.playSound(bundles.main.urls.piggybank_window_effect||bundles.main.urls.shop_buy_effect),Lottery.addIcon(this.button),Lottery.addText(this)}}});PiggyBankWindow.prototype.listBundles=function(){return["piggybank_window"]},cleverapps.styles.PiggyBankWindow={margin:20,padding:{y:60},animation:{width:600,height:450,y:-90,json:bundles.piggybank_window.jsons.piggy_bank_window_json},amount:{width:260,height:64,margin:10,y:0,coin:{flip:!0,scale:1}},text:{width:640,height:150},button:{width:300,height:100},timer:{width:220,height:50,bg:bundles.main.frames.timer_bg_png,margin:{x:30},x:0,y:0}};var PiggyBankRulesWindow=RulesWindow.extend({onWindowLoaded:function(){this._super({name:"piggybankwindow",styles:cleverapps.styles.PiggyBankRulesWindow})}});PiggyBankRulesWindow.prototype.listBundles=function(){return["piggybank_window"]},cleverapps.styles.PiggyBankRulesWindow={font:cleverapps.styles.FONTS.PIGGY_BANK_WINDOW_SMALL_TEXT,prefix:"messages:PiggyBankRulesWindow.",animation:{
json:bundles.piggybank_window.jsons.piggy_bank_window_json,name:"piggy_help"}};var PackManager=function(e){cleverapps.config.debugMode&&(PackManager.NEXT_STAGE_INTERVAL="10 seconds"),e?(this.whenBuy=-1,this.used=0,this.save()):this.load()};PackManager.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.PACK);this.whenBuy=e&&e.whenBuy&&e.whenBuy<Date.now()?e.whenBuy:-1,this.used=e&&e.used?e.used:0},PackManager.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.PACK,{whenBuy:this.whenBuy,used:this.used}),!1!==e&&cleverapps.synchronizer.addUpdateTask("packs")},PackManager.prototype.get=function(){var e=PackManager.PACKS[PackManager.PACK_NAME];return e=(e=Array.isArray(e)?e:[e]).filter(function(e){return!1!==e.active}),(e=this.used<e.length?e[this.used]:void 0)&&(e.stage=this.used,e.id=PackManager.PACK_NAME),e},PackManager.prototype.onBuyPack=function(){this.used++;var e=PackManager.PACKS[PackManager.PACK_NAME].length
;this.used>e&&(this.used=e),this.whenBuy=Date.now(),this.save(),cleverapps.history.add("pack",1),cleverapps.sideBar.resetByClassName(PackIcon)},PackManager.prototype.isAvailable=function(){var e=this.get();if(!e)return!1;if(cleverapps.flags.nopayments)return!1;if(!e.active&&!cleverapps.config.debugMode)return!1;if(e.available){var t=e.available;if(!levels.user.checkAvailable(t))return!1}return!(Date.now()<this.whenBuy+cleverapps.parseInterval(PackManager.NEXT_STAGE_INTERVAL))},PackManager.PACK_NAME="starterPack",PackManager.NEXT_STAGE_INTERVAL="1 day",PackManager.PACKS={starterPack:[{product:"starterPack0",title:"messages:StarterPack0.Title",animation:"animation1",bundle:"starter_pack",banner:"starter_pack_banner_png",icon:"starter_pack_0_icon_png",description:"messages:StarterPack0.Description",reward:RewardsConfig.Packs[0],active:!0,available:{episode:1,level:5}},{product:"starterPack",title:"messages:StarterPack1.Title",animation:"animation2",bundle:"starter_pack",
banner:"starter_pack_banner_png",icon:"starter_pack_1_icon_png",description:"messages:StarterPack1.Description",reward:RewardsConfig.Packs[1],active:!0,available:{episode:2,level:5}},{product:"starterPack2",title:"messages:StarterPack2.Title",animation:"animation3",bundle:"starter_pack",banner:"starter_pack_banner_png",icon:"starter_pack_2_icon_png",description:"messages:StarterPack2.Description",reward:RewardsConfig.Packs[2],active:!0,available:{episode:3,level:5}}]},"merge"===cleverapps.config.type&&(PackManager.PACKS.starterPack[0].available={episode:0,level:4},PackManager.PACKS.starterPack[1].available={episode:0,level:6},PackManager.PACKS.starterPack[2].available={episode:0,level:8}),PackManager.PACKS.starterPack.forEach(function(e){cleverapps.PaymentsManager.PRODUCTS[e.product].reward=e.reward});var PackWindow=Window.extend({onWindowLoaded:function(e){e=e||{};var t=cleverapps.packManager.get();this.pack=t;var s=cleverapps.styles.PackWindow,i=s.button;this.setButtonContent(i),
i.onPressed=function(){this.buyPackProduct()}.bind(this);var n=this.generateContent(t),o=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.PackWindow);if(this._super({name:"packwindow",title:s.title?{text:t.title,margin:{x:0,y:s.title.margin.y},font:s.title.font||cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}:"",content:n,button:i,windowBg:e.windowBg,styles:o}),s.heroAnimation){var r=new cleverapps.Spine(s.heroAnimation.json,Array.isArray(s.heroAnimation.scale)?s.heroAnimation.scale[cleverapps.wideMode.mode]:s.heroAnimation.scale);r.setAnimation(0,s.heroAnimation.animation,!0),r.setPositionRound(s.heroAnimation.position),this.addChild(r),r.y-=r.height,r.runAction(new cc.MoveBy(.4,0,r.height).easing(cc.easeBackOut()))}cleverapps.audio.playSound(bundles.main.urls.window_effect),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACKWINDOW_OPENED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.PACKWINDOW_OPENED+"_"+this.pack.id+(
0===this.pack.stage?"":"_"+this.pack.stage)),Lottery.addIcon(this.button),Lottery.addText(this)},setButtonContent:function(e){var t=Product.Create(this.pack.product);e.content=this.generateButtonText(t)},generateButtonText:function(e){return new ProductPriceView(e,{font:cleverapps.styles.PackWindow.button.font,fitTo:{width:cleverapps.styles.PackWindow.BottomButton.width}})},onShow:function(){var t=cleverapps.styles.PackWindow,e=this.content;this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.PlaySound(bundles.starter_pack.urls.starter_pack_effect))),e.rewards&&e.rewards.children.forEach(function(e){e.setOpacity(0),e.runAction(new cc.Sequence(new cc.DelayTime(t.rewards.delay||0),new cc.FadeIn(t.rewards.duration||0)))}),e.discountLabel&&(e.discountLabel.setOpacity(0),e.discountLabel.runAction(new cc.Sequence(new cc.DelayTime(t.discountLabel.delay||0),new cc.FadeIn(t.discountLabel.duration||0)))),e.title&&(e.title.setOpacity(0),e.title.runAction(new cc.Sequence(new cc.DelayTime(
t.Title.delay||0),new cc.FadeIn(t.Title.duration||0))))},generateContent:function(e){var t=cleverapps.styles.PackWindow,s=this.content=new cc.Node;return s.setAnchorPoint2(),s.setPositionRound({align:"center"},{align:"center"}),s.setContentSize2(t),t.animation&&(s.animation=this.generateAnimation(e,t.animation),s.addChild(s.animation)),t.rewards&&(s.rewards=this.generateRewards(e,t.rewards),s.addChild(s.rewards)),t.discountLabel&&(s.discountLabel=this.generateText(t.discountLabel.text,t.discountLabel),s.addChild(s.discountLabel)),t.Title&&(s.title=this.generateText(e.title,t.Title),s.addChild(s.title)),s.setScale(t.scales[cleverapps.wideMode.mode]),s},applyTextStyles:function(e,t){t.split&&(e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setString(e.string.split(/\s+/).join("\n"))),t.fontSize&&e.setFontSize(t.fontSize),t.fitTo&&e.fitTo(t.fitTo.width,t.fitTo.height),t.lineHeight&&e.setLineHeight&&e.setLineHeight(t.lineHeight),t.rotation&&e.setRotation(t.rotation)},
generateAnimation:function(e,t){t=cleverapps.extend({},t.default||{},t[e.product]||{});var s=new cleverapps.Spine(bundles[e.bundle].jsons.pack_json,1);return s.setAnchorPoint2(),s.setPositionRound({align:"center",dx:t.dx||0},{align:"center",dy:t.dy||0}),t.introAnimation?(s.setAnimation(0,t.introAnimation,!1),s.addAnimation(0,t.idleAnimation,!0,t.idleDelay||0)):s.setAnimation(0,t.idleAnimation,!0),s},generateText:function(e,t){var s=cleverapps.UI.generateTTFText(e,t.font);return this.applyTextStyles(s,t),s.setAnchorPoint2(),s.setPositionRound({align:"center",dx:t.dx||0},{align:"center",dy:t.dy||0}),s},generateRewards:function(e,i){i=cleverapps.clone(i);var t=cleverapps.extend({},i.positions.default||{},i.positions[e.product]||{}),n=new cc.Node;n.setAnchorPoint2(),n.setPositionRound({align:"center"},{align:"center"});var s=function(e,t){var s=new cleverapps.UI.generateTTFText(e,i.font);i.split=t.split,i.rotation=t.rotation,this.applyTextStyles(s,i),s.setAnchorPoint2(),s.setPositionRound(
t),n.addChild(s)};for(var o in e.reward){var r=e.reward[o],a=t[o];if(void 0!==a)if("boosters"===o)for(var c in r){var l=r[c],p=a[c];void 0!==p&&s.call(this,"x"+l,p)}else s.call(this,"unlimitedLives"===o||"worker"===o?Product.FormatUnlimitedLives(r).title:"x"+r,a)}return n},buyPackProduct:function(){Product.Create(this.pack.product).buy(function(){this.close(),cleverapps.packManager.onBuyPack()}.bind(this))}});PackWindow.prototype.listBundles=function(){return[cleverapps.packManager.get().bundle]},cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{PACKWINDOW_TITLE_YELLOW:new cc.Color(249,205,23,255),PACKWINDOW_TITLE_SHADOW:new cc.Color(97,47,1,255),PACKWINDOW_PRICE_STROKE:new cc.Color(9,88,3,255)}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{PACKWINDOW_TITLE_STROKE:{size:3,color:cleverapps.styles.COLORS.PACKWINDOW_TITLE_SHADOW},PACKWINDOW_BUTTON_STROKE:{size:3,color:cleverapps.styles.COLORS.PACKWINDOW_PRICE_STROKE},
PACKWINDOW_LABEL_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{PACKWINDOW_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.PACKWINDOW_TITLE_YELLOW,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_TITLE_STROKE},PACKWINDOW_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_BUTTON_STROKE},PACKWINDOW_LABEL_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.PACKWINDOW_LABEL_STROKE},PACK_LABELS:{size:77,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.MESSAGE_RED_STROKE}}),cleverapps.styles.PackWindow={width:440,height:750,noBackground:!0,title:void 0,margin:20,y:60,content:{height:{dy:0}},text:{margin:{width:10}},description:{y:0},BottomButton:{bottomPadding:40,width:260},button:{width:300,height:100,price:{margin:{x:10,y:0}},x:0,y:50,font:cleverapps.styles.FONTS.BUTTON_TEXT},window:{Title:{zIndex:1}},scales:[.85,1,1],
Title:void 0,discountLabel:void 0,animation:void 0,rewards:void 0},cleverapps.ShareBonus=function(e){if(this.id=e.id,this.storageKey=cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e.id,this.bonus=e.bonus,this.interval=cleverapps.parseInterval(e.interval),this.type=e.type,this.initStorageKey(e.startAvailable),e.isRewardedVideo&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)){var t=this.storageKey;this.storageKey+="_video",this.initStorageKey(e.startAvailable),this.isReady()?(this.type=cleverapps.ShareBonus.VIDEO,cleverapps.flags.reduceAds&&(this.bonus=cleverapps.ShareBonus.BONUS_REDUCED)):this.storageKey=t}cleverapps.ShareBonus.IsRewardAvailable()||this.type===cleverapps.ShareBonus.VIDEO||(this.bonus=0),this.takeBonusListener=function(){}},cleverapps.ShareBonus.prototype.initStorageKey=function(e){void 0===cleverapps.DataLoader.load(this.storageKey)&&cleverapps.DataLoader.save(this.storageKey,e?0:Date.now())},
cleverapps.ShareBonus.prototype.markTaken=function(){cleverapps.DataLoader.save(this.storageKey,Date.now())},cleverapps.ShareBonus.prototype.createShareCallback=function(t,s){return function(e){e===cleverapps.Social.CODE_SUCCEED?(s!==cleverapps.ShareBonus.REQUEST&&s!==cleverapps.ShareBonus.DIALOG||(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE_ITEM,{id:this.id})),this.bonus&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARD_RECEIVED,{amount:this.bonus}),this.markTaken(),this.bonus&&(levels.user.setGold(levels.user.gold+this.bonus),this.takeBonusListener()),t()):console.log(Messages.get("ShareBonus.ShareFailed")+e)}.bind(this)},cleverapps.ShareBonus.cycleShareData=function(e,t){t=cleverapps.extend({},t||{},{gameTitle:Messages.get(cleverapps.config.title),gameName:cleverapps.config.name});var s=cc.loader.getRes(bundles.main.jsons.share_json)[e],i=cleverapps.DataLoader.load(
cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e+"ShareId");void 0===i?i=Math.floor(3*Math.random()):i++,cleverapps.DataLoader.save(cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_"+e+"ShareId",i);var n=s[cleverapps.settings.language]||s[cc.sys.LANGUAGE_ENGLISH],o={};n&&(o.picture=n[i%n.length]),s.vk&&(o.vk=s.vk[i%s.vk.length]);var r=s.texts[i%s.texts.length];for(var a in r){var c=r[a];"to"===a?o[a]=Messages.replace(c,t):"string"==typeof c&&0===c.indexOf("messages:")&&(c=Messages.replace(c,t),o[a]=Messages.get(c,t))}return o},cleverapps.ShareBonus.prototype.request=function(t,s){cleverapps.social.checkConnection(function(){var e=cleverapps.ShareBonus.cycleShareData(this.id,s);cleverapps.social.request(e,this.createShareCallback(function(){cleverapps.history.add("rqst",1),t()},cleverapps.ShareBonus.REQUEST))}.bind(this))},cleverapps.ShareBonus.prototype.shareDialog=function(t,s){cleverapps.social.checkConnection(function(){
var e=cleverapps.ShareBonus.cycleShareData(this.id,s);cleverapps.social.shareDialog(e,this.createShareCallback(function(){cleverapps.history.add("share",1),t()},cleverapps.ShareBonus.DIALOG))}.bind(this))},cleverapps.ShareBonus.prototype.rewardedVideo=function(e){if(cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)){var t=this.createShareCallback(e,cleverapps.ShareBonus.VIDEO);cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){t(cleverapps.Social.CODE_SUCCEED),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_SHARE)})}else cleverapps.Notification.create("messages:AdsUnavailable")},cleverapps.ShareBonus.prototype.takeBonus=function(e,t){switch(this.type){case cleverapps.ShareBonus.DIALOG:this.shareDialog(e,t);break;case cleverapps.ShareBonus.VIDEO:this.rewardedVideo(e);break;default:this.request(e,t)}},cleverapps.ShareBonus.prototype.isReady=function(){return parseInt(cc.sys.localStorage.getItem(this.storageKey)
)+this.interval<=Date.now()},cleverapps.ShareBonus.IsRewardAvailable=function(){if(cleverapps.flags.noviral||cleverapps.flags.noshares)return!1;var e=cleverapps.User.calcSource();return-1===["instant","mobile_vk"].indexOf(e)&&("mobile_ok"===e||"web_ok"===e||cleverapps.user.checkAvailable(cleverapps.ShareBonus.REWARD_AVAILABLE))},cleverapps.ShareBonus.DIALOG="dialog",cleverapps.ShareBonus.REQUEST="request",cleverapps.ShareBonus.VIDEO="video",cleverapps.ShareBonus.SHARES={victory:{bonus:20,interval:"20 minutes",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0},finishEpisode:{bonus:30,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0,startAvailable:!0},beatFriend:{bonus:10,interval:"1 minute",type:cleverapps.ShareBonus.REQUEST,startAvailable:!0},champion:{bonus:20,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0},newLeague:{bonus:50,interval:"1 hour",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0,startAvailable:!0},dailyCup:{bonus:20,
interval:"20 minutes",type:cleverapps.ShareBonus.DIALOG,isRewardedVideo:!0}},Object.keys(cleverapps.ShareBonus.SHARES).forEach(function(e){cleverapps.ShareBonus.SHARES[e].id=e}),cleverapps.ShareBonus.BONUS_REDUCED=10,cleverapps.ShareBonus.REWARD_AVAILABLE={episode:2,level:1};var ShareBonusButton=BonusButton.extend({ctor:function(e){var t=this.shareBonus=new cleverapps.ShareBonus(e.shareBonus),s=e.callback||function(){},i=t.type===cleverapps.ShareBonus.VIDEO?"messages:WatchAd":"messages:Share",n={score:e.score};e.level&&(n.levelNo=e.level.getHumanReadableNumber()),e.toReplace&&cleverapps.override(n,e.toReplace),this._super({reward:t.bonus,text:i,onClick:function(){t.takeBonus(this.createListener(function(){Buttons.remove(this),e.window&&e.window.addReward&&e.window.addReward(t.bonus)?s():this.animateCollectCoin(s)}.bind(this)),n)}})}});ShareBonusButton.create=function(e){var t=new cleverapps.ShareBonus(e.shareBonus);if(
!cleverapps.flags.noviral&&!cleverapps.flags.noshares&&cleverapps.social.isLoggedIn()&&t.isReady())return new ShareBonusButton(e)},cleverapps.styles.ShareBonusButton={width:280,height:110};var ShareCheckBox=cleverapps.UI.CheckBox.extend({ctor:function(e,t){this.window=t,this.shareOptions=e,this._super({onChange:this.onChange.bind(this),label:{text:"messages:Share",font:this.window.withBg?cleverapps.styles.FONTS.WINDOW_TEXT:cleverapps.styles.FONTS.WHITE_TEXT,clickable:!0},styles:cleverapps.styles.ShareCheckBox}),this.updateState()},onChange:function(e){ShareCheckBox.UNCHECKED[this.window.name]=!e},shareDialog:function(t){cleverapps.social.checkConnection(function(){var e=cleverapps.ShareBonus.cycleShareData(t.shareId,t.toReplace);cleverapps.social.shareDialog(e,function(e){e===cleverapps.Social.CODE_SUCCEED?(cleverapps.history.add("share",1),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SHARE_ITEM,{id:t.shareId})):console.log(
Messages.get("ShareBonus.ShareFailed")+e)}.bind(this))}.bind(this))},updateState:function(){this.checkBox.setSelected(this.isWindowChecked())},onWindowClose:function(){this.isWindowChecked()&&this.shareDialog(this.shareOptions)},isWindowChecked:function(){return!ShareCheckBox.UNCHECKED[this.window.name]}});ShareCheckBox.UNCHECKED={},cleverapps.styles.ShareCheckBox={margin:15,padding:{x:0,y:0},checkImage:bundles.main.frames.select_friend_checkbox_selected,bgImage:bundles.main.frames.select_friend_checkbox};var Messages={dictionary:void 0,onInitializedListeners:{},isInitialized:function(){return this.dictionary},get:function(e,t){if(!Messages.dictionary)return"";"string"==typeof e&&0===e.indexOf("messages:")&&(e=e.substring("messages:".length));var s=cleverapps.skins.getSlot("localization");s[e]&&(e=s[e]);var i=Messages.dictionary[e];if(void 0===i)return console.log("WARN: langugage_"+cleverapps.settings.language),console.log("Cant find TEXT string by code: "+e),console.log((new Error
).stack),"";if(Array.isArray(i))for(var n=0;n<i.length;n++)i[n]=Messages.replace(i[n],t);else i=Messages.replace(i,t);return i},has:function(e){return!!Messages.dictionary&&("string"==typeof e&&0===e.indexOf("messages:")&&(e=e.substring("messages:".length)),Messages.dictionary[e])},replace:function(e,t){if(void 0===t&&(t={}),"string"==typeof e&&-1!==e.indexOf("%{facebook}")){var s=cleverapps.social.getCode();"mobile_ok"!==s&&"web_ok"!==s||(s="ok"),"mobile_vk"!==s&&"web_vk"!==s||(s="vk"),"mbga"!==s&&"sp_mbga"!==s||(s="mbga"),"nk"===s&&(s="nk"),Messages.dictionary[s]||(s="facebook"),t.facebook=Messages.get(s)}if("string"==typeof e)for(var i in t){var n=t[i];"string"==typeof n&&0===n.indexOf("messages:")&&(n=Messages.get(n)),e=(e=e.replace("%{"+i+"}",n)).replace("%{"+i+"}",n)}return e},getLocalized:function(e,t){if("string"==typeof e)return 0===e.indexOf("messages:")&&(e=Messages.get(e.substring("messages:".length))),e=Messages.replace(e,t);if("object"==typeof e&&0<cleverapps.intersect(
Object.keys(e),cleverapps.Settings.getAvailableLanguages()).length)return e=void 0!==e[cleverapps.settings.language]?e[cleverapps.settings.language]:e[cc.sys.LANGUAGE_ENGLISH],Messages.getLocalized(e,t);if("object"!=typeof e)return e;for(var s in e=cleverapps.clone(e))e[s]=Messages.getLocalized(e[s],t);return e},preload:function(t,s){cleverapps.bundleLoader.loadBundle("language_"+t,{onSuccess:function(e){Messages.dictionary={},[e.jsons.common_json,e.jsons.lang_json,e.jsons.skin_json,e.jsons.project_json,e.jsons.farm_json,e.jsons.solitaire_json,e.jsons.quests_json].forEach(function(e){e&&cleverapps.extend(Messages.dictionary,cc.loader.getRes(e))}),cleverapps.bundleLoader.deleteBundle("language_"+t),cleverapps.values(Messages.onInitializedListeners).forEach(cleverapps.callFunc),s()},blocked:!0})}};cleverapps.LocalizationManager={run:function(){(void 0===cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LOCALIZATION_MANAGER)&&this.hasInconsistentLanguage(
)||this.hasFirstInitLanguageWindow())&&this.displayLanguageWindow()},hasInconsistentLanguage:function(){var e=cleverapps.settings.language,t=cleverapps.Settings.getAvailableLanguages(),s=cleverapps.Settings.getDefaultLanguage();return e!==s&&0<=t.indexOf(s)},hasFirstInitLanguageWindow:function(){return 0===levels.user.episode&&0===levels.user.level&&"plinga"===cleverapps.User.calcSource()&&"riddles"===cleverapps.config.name},displayLanguageWindow:function(){cleverapps.metha.displayWhenFreeFocus({focus:"displayInconsistentLanguage",action:function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LOCALIZATION_MANAGER,1),new LanguagesWindow,cleverapps.metha.onceNoWindowsListener=e}})}},cleverapps.TempGoods=function(){this.load()},cleverapps.TempGoods.prototype.buyGood=function(e,t){this.checkGoodBuyed(e)?this.currentGooods[e].actionTime+=t:this.currentGooods[e]={buyTime:Date.now(),actionTime:t,fpShowed:0},this.save()},cleverapps.TempGoods.prototype.reset=function(){
this.currentGooods={},this.save()},cleverapps.TempGoods.prototype.resetGood=function(e){this.currentGooods[e]&&(delete this.currentGooods[e],this.save())},cleverapps.TempGoods.prototype.goodLeftTime=function(e){if(void 0===this.currentGooods[e])return 0;var t=this.currentGooods[e].buyTime+this.currentGooods[e].actionTime-Date.now();return t<=0?0:t},cleverapps.TempGoods.prototype.checkGoodBuyed=function(e){return 0<this.goodLeftTime(e)},cleverapps.TempGoods.prototype.displayPromotionOnFinish=function(){if(!cleverapps.flags.nopayments)for(var e in this.currentGooods)if(!this.currentGooods[e].fpShowed&&0===this.goodLeftTime(e))return void this.showPromotion(e)},cleverapps.TempGoods.prototype.showPromotion=function(t){cleverapps.metha.display({focus:"TempGoodFinishWindow",action:function(e){this.currentGooods[t].fpShowed=1,this.save(),new TempGoodFinishWindow(t),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},cleverapps.TempGoods.prototype.getInfo=function(){
return this.currentGooods},cleverapps.TempGoods.prototype.updateInfo=function(e,t){this.currentGooods=e,this.save(t)},cleverapps.TempGoods.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.TEMP_GOODS);this.currentGooods=void 0!==e?e:{}},cleverapps.TempGoods.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.TEMP_GOODS,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("tempgoods")},cleverapps.TempGoods.UNLIMITED_LIVES=1;var TempGoodFinishWindow=Window.extend({onWindowLoaded:function(e){this.goodType=parseInt(e);var t=cleverapps.styles.TempGoodFinishWindow,s=new cc.Node;if(s.setContentSize(t.width,t.height),s.setAnchorPoint(.5,.5),bundles.temp_good_finish_window.jsons.lives_json){var i=new cleverapps.Spine(bundles.temp_good_finish_window.jsons.lives_json);s.addChild(i),-1!==["differences","tripeaks"].indexOf(cleverapps.config.name)?i.setAnimationAndIdleAfter("no_life","idle"):i.setAnimation(0,"no_life",!0),
i.setPosition(cleverapps.styles.TempGoodFinishWindow.sad_icon.x,cleverapps.styles.TempGoodFinishWindow.sad_icon.y)}var n=cleverapps.UI.generateTTFText("messages:TempGoodsFinishWindow.unlimitedLivesText",cleverapps.styles.FONTS.WINDOW_TEXT);if(s.addChild(n),n.setDimensions(cleverapps.styles.TempGoodFinishWindow.text.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setPosition(cleverapps.styles.TempGoodFinishWindow.text.x,cleverapps.styles.TempGoodFinishWindow.text.y),t.goodIcon){var o=new cc.Sprite(bundles.reward_icons.frames.life_unlim);s.addChild(o),o.setPosition(cleverapps.styles.TempGoodFinishWindow.good_icon.x,cleverapps.styles.TempGoodFinishWindow.good_icon.y)}var r=cleverapps.overrideStyles(cleverapps.styles.Window,t.window,!0);this._super({content:s,title:"messages:TempGoodsFinishWindow.title",name:"tempgoodsfinishwindow",styles:r,button:{content:this.getButtonContent(),width:cleverapps.styles.TempGoodFinishWindow.button.width,
height:cleverapps.styles.TempGoodFinishWindow.button.height,onPressed:this.onBuy.bind(this)}}),Lottery.addIcon(this.button),t.hero&&(this.hero=new cleverapps.Spine(bundles.hero.jsons.hero_json,1),this.hero.setAnimation(0,"lose",!0),this.hero.setPositionRound(t.hero),this.addChild(this.hero)),cleverapps.audio.playSound(bundles.temp_good_finish_window.urls.lives_effect)},onBuy:function(){if(this.goodType===cleverapps.TempGoods.UNLIMITED_LIVES){var e=Product.Create("unlimitedLives"),t=function(){this.close()}.bind(this);e.buy(t)}},getButtonContent:function(){if(this.goodType===cleverapps.TempGoods.UNLIMITED_LIVES)return new ProductPriceView(Product.Create("unlimitedLives"),{font:cleverapps.styles.FONTS.BUTTON_TEXT});var e=new cc.Node;return e.setAnchorPoint(.5,.5),e},listBundles:function(){return["temp_good_finish_window"]}});cleverapps.styles.TempGoodFinishWindow={width:650,height:400,goodIcon:!0,sad_icon:{x:100,y:190},good_icon:{x:170,y:110},text:{x:450,y:190,width:400},button:{
width:300,height:100},window:{}},function(n,d){"use strict";var h="function",e="undefined",t="model",s="name",i="type",o="vendor",r="version",a="architecture",c="console",l="mobile",p="tablet",u="smarttv",g="wearable",v={extend:function(e,t){var s={};for(var i in e)t[i]&&t[i].length%2==0?s[i]=t[i].concat(e[i]):s[i]=e[i];return s},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:d},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},m={rgx:function(e,t){for(var s,i,n,o,r,a,c=0;c<t.length&&!r;){var l=t[c],p=t[c+1];for(s=i=0;s<l.length&&!r;)if(r=l[s++].exec(e))for(n=0;n<p.length;n++)a=r[++i],"object"==typeof(o=p[n])&&0<o.length?2==o.length?typeof o[1]==h?this[o[0]]=o[1].call(this,a):this[o[0]]=o[1]:3==o.length?typeof o[1]!==h||o[1].exec&&o[1].test?this[o[0]]=a?a.replace(o[1],o[2]
):d:this[o[0]]=a?o[1].call(this,a,o[2]):d:4==o.length&&(this[o[0]]=a?o[3].call(this,a.replace(o[1],o[2])):d):this[o]=a||d;c+=2}},str:function(e,t){for(var s in t)if("object"==typeof t[s]&&0<t[s].length){for(var i=0;i<t[s].length;i++)if(v.has(t[s][i],e))return"?"===s?d:s}else if(v.has(t[s],e))return"?"===s?d:s;return e}},f={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},_={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[s,r],[/(opios)[\/\s]+([\w\.]+)/i],[[s,"Opera Mini"],r],[/\s(opr)\/([\w\.]+)/i],[[s
,"Opera"],r],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[s,r],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[s,"IE"],r],[/(edge)\/((\d+)?[\w\.]+)/i],[s,r],[/(yabrowser)\/([\w\.]+)/i],[[s,"Yandex"],r],[/(puffin)\/([\w\.]+)/i],[[s,"Puffin"],r],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[s,"UCBrowser"],r],[/(comodo_dragon)\/([\w\.]+)/i],[[s,/_/g," "],r],[/(micromessenger)\/([\w\.]+)/i],[[s,"WeChat"],r],[/(QQ)\/([\d\.]+)/i],[s,r],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[s,r],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[r,[s,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[r,[s,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[r,[s,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[s,/(.+)/,"$1 WebView"],r]
,[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[s,/(.+(?:g|us))(.+)/,"$1 $2"],r],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[r,[s,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[s,r],[/(dolfin)\/([\w\.]+)/i],[[s,"Dolphin"],r],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[s,"Chrome"],r],[/(coast)\/([\w\.]+)/i],[[s,"Opera Coast"],r],[/fxios\/([\w\.-]+)/i],[r,[s,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[r,[s,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[r,s],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[s,"GSA"],r],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[s,[r,m.str,f.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[s,r],[/(navigator|netscape)\/([\w\.-]+)/i],[[s,"Netscape"],r],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,
/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[s,r]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[a,"amd64"]],[/(ia32(?=;))/i],[[a,v.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[a,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[a,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[a,/ower/,"",v.lowerize]],[/(sun4\w)[;\)]/i],[[a,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[a,v.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[t,o,[i,p]],[/applecoremedia\/[\w\.]+ \((ipad)/],[t,[o,"Apple"],[i,p]],[/(apple\s{0,1}tv)/i],[[t,"Apple TV"],[o,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,
/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[o,t,[i,p]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[t,[o,"Amazon"],[i,p]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[t,m.str,f.device.amazon.model],[o,"Amazon"],[i,l]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[t,o,[i,l]],[/\((ip[honed|\s\w*]+);/i],[t,[o,"Apple"],[i,l]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[o,t,[i,l]],[/\(bb10;\s(\w+)/i],[t,[o,"BlackBerry"],[i,l]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[t,[o,"Asus"],[i,p]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[o,"Sony"],[t,"Xperia Tablet"],[i,p]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[t,[o,"Sony"],[i,l]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[o,t,[i,c]],[/android.+;\s(shield)\sbuild/i],[t,[o,"Nvidia"],[i,c]],[
/(playstation\s[34portablevi]+)/i],[t,[o,"Sony"],[i,c]],[/(sprint\s(\w+))/i],[[o,m.str,f.device.sprint.vendor],[t,m.str,f.device.sprint.model],[i,l]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[o,t,[i,p]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[o,[t,/_/g," "],[i,l]],[/(nexus\s9)/i],[t,[o,"HTC"],[i,p]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[t,[o,"Huawei"],[i,l]],[/(microsoft);\s(lumia[\s\w]+)/i],[o,t,[i,l]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[t,[o,"Microsoft"],[i,c]],[/(kin\.[onetw]{3})/i],[[t,/\./g," "],[o,"Microsoft"],[i,l]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[t,[o,"Motorola"],[i,l]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[t,[o,"Motorola"],[i,p]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[o,v.trim],[t,v.trim],[i,u]],[/hbbtv.+maple;(\d+)/i],[[t,/^/,
"SmartTV"],[o,"Samsung"],[i,u]],[/\(dtv[\);].+(aquos)/i],[t,[o,"Sharp"],[i,u]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[o,"Samsung"],t,[i,p]],[/smart-tv.+(samsung)/i],[o,[i,u],t],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[o,"Samsung"],t,[i,l]],[/sie-(\w+)*/i],[t,[o,"Siemens"],[i,l]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[o,"Nokia"],t,[i,l]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[t,[o,"Acer"],[i,p]],[/android.+([vl]k\-?\d{3})\s+build/i],[t,[o,"LG"],[i,p]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[o,"LG"],t,[i,p]],[/(lg) netcast\.tv/i],[o,t,[i,u]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[t,[o,"LG"],[i,l]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[t,[o,"Lenovo"],[i,p]],[/linux;.+((jolla));/i],[o,t,[i,l]],[/((pebble))app\/[\d\.]+\s/i],[o,t,[i,g]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[o,t,[i,l]
],[/crkey/i],[[t,"Chromecast"],[o,"Google"]],[/android.+;\s(glass)\s\d/i],[t,[o,"Google"],[i,g]],[/android.+;\s(pixel c)\s/i],[t,[o,"Google"],[i,p]],[/android.+;\s(pixel xl|pixel)\s/i],[t,[o,"Google"],[i,l]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[i,l]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[t,/_/g," "],[o,"Xiaomi"],[i,p]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[t,[o,"Meizu"],[i,p]],[/android.+a000(1)\s+build/i],[t,[o,"OnePlus"],[i,l]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[t,[o,"RCA"],[i,p]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[t,[o,"Dell"],[i,p]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[t,[o,"Verizon"],[i,p]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[o,"Barnes & Noble"],t,[i,p]],[
/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[t,[o,"NuVision"],[i,p]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[o,"ZTE"],t,[i,p]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[t,[o,"Swiss"],[i,l]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[t,[o,"Swiss"],[i,p]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[t,[o,"Zeki"],[i,p]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[o,"Dragon Touch"],t,[i,p]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[t,[o,"Insignia"],[i,p]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[t,[o,"NextBook"],[i,p]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[o,"Voice"],t,[i,l]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[o,"LvTel"],t,[i,l]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[t,[o,"Envizen"],[i,p]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[o,t,[i,p]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[t,[o,"MachSpeed"],[i,
p]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[o,t,[i,p]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[t,[o,"Rotor"],[i,p]],[/android.+(KS(.+))\s+build/i],[t,[o,"Amazon"],[i,p]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[o,t,[i,p]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,v.lowerize],o,t],[/(android.+)[;\/].+build/i],[t,[o,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[r,[s,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[s,r],[/rv\:([\w\.]+).*(gecko)/i],[r,s]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[s,r],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[s,[r,m.str,f.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[s,"Windows"],[r,m.str,f.os.windows.version]],[/\((bb)(10);/i],[[s,"BlackBerry"],r],[
/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[s,r],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[s,"Symbian"],r],[/\((series40);/i],[s],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[s,"Firefox OS"],r],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[s,r],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[s,"Chromium OS"],r],[/(sunos)\s?([\w\.]+\d)*/i],[[s,"Solaris"],r],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[s,r],[/(haiku)\s(\w+)/i],[s,r],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[r,/_/g,"."],[s,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[
[s,"Mac OS"],[r,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[s,r]]},y=function(e,t){if("object"==typeof e&&(t=e,e=d),!(this instanceof y))return new y(e,t).getResult();var s=e||(n&&n.navigator&&n.navigator.userAgent?n.navigator.userAgent:""),i=t?v.extend(_,t):_;return this.getBrowser=function(){var e={name:d,version:d};return m.rgx.call(e,s,i.browser),e.major=v.major(e.version),e},this.getCPU=function(){var e={architecture:d};return m.rgx.call(e,s,i.cpu),e},this.getDevice=function(){var e={vendor:d,model:d,type:d};return m.rgx.call(e,s,i.device),e},this.getEngine=function(){var e={name:d,version:d};return m.rgx.call(e,s,i.engine),e},this.getOS=function(){var e={name:d,version:d};return m.rgx.call(e,s,i.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),
cpu:this.getCPU()}},this.getUA=function(){return s},this.setUA=function(e){return s=e,this},this};y.VERSION="0.7.17",y.BROWSER={NAME:s,MAJOR:"major",VERSION:r},y.CPU={ARCHITECTURE:a},y.DEVICE={MODEL:t,VENDOR:o,TYPE:i,CONSOLE:c,MOBILE:l,SMARTTV:u,TABLET:p,WEARABLE:g,EMBEDDED:"embedded"},y.ENGINE={NAME:s,VERSION:r},y.OS={NAME:s,VERSION:r},typeof exports!==e?(typeof module!==e&&module.exports&&(exports=module.exports=y),exports.UAParser=y):typeof define===h&&define.amd?define(function(){return y}):n&&(n.UAParser=y);var w=n&&(n.jQuery||n.Zepto);if(typeof w!==e){var T=new y;w.ua=T.getResult(),w.ua.get=function(){return T.getUA()},w.ua.set=function(e){T.setUA(e);var t=T.getResult();for(var s in t)w.ua[s]=t[s]}}}("object"==typeof window?window:this),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.SuperGif=t()}(this,function(){var a=function(e){return e.reduce(function(e,t){return 2*e+t},0)},c=function(e){for(var t=[],s=7;0<=s;s--
)t.push(!!(e&1<<s));return t},ie=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return e instanceof Uint8Array?e[this.pos++]:255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],s=0;s<e;s++)t.push(this.readByte());return t},this.read=function(e){for(var t="",s=0;s<e;s++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},ne=function(n,o){o||(o={});var i=function(e){for(var t=[],s=0;s<e;s++)t.push(n.readBytes(3));return t},r=function(){var e,t;for(t="";e=n.readByte(),t+=n.read(e),0!==e;);return t},t=function(e){e.leftPos=n.readUnsigned(),e.topPos=n.readUnsigned(),e.width=n.readUnsigned(),e.height=n.readUnsigned();var t=c(n.readByte());e.lctFlag=t.shift(),e.interlaced=t.shift(),e.sorted=t.shift(),e.reserved=t.splice(0,2),e.lctSize=a(t.splice(0,3)),e.lctFlag&&(e.lct=i(
1<<e.lctSize+1)),e.lzwMinCodeSize=n.readByte();var s=r();e.pixels=function(t,i){for(var e,s,n=0,o=function(e){for(var t=0,s=0;s<e;s++)i.charCodeAt(n>>3)&1<<(7&n)&&(t|=1<<s),n++;return t},r=[],a=1<<t,c=a+1,l=t+1,p=[],d=function(){p=[],l=t+1;for(var e=0;e<a;e++)p[e]=[e];p[a]=[],p[c]=null};;)if(s=e,(e=o(l))!==a){if(e===c)break;if(e<p.length)s!==a&&p.push(p[s].concat(p[e][0]));else{if(e!==p.length)throw new Error("Invalid LZW code.");p.push(p[s].concat(p[s][0]))}r.push.apply(r,p[e]),p.length===1<<l&&l<12&&l++}else d();return r}(e.lzwMinCodeSize,s),e.interlaced&&(e.pixels=function(e,t){for(var s,i,n,o=new Array(e.length),r=e.length/t,a=[0,4,2,1],c=[8,8,4,2],l=0,p=0;p<4;p++)for(var d=a[p];d<r;d+=c[p])s=d,i=l,n=e.slice(i*t,(i+1)*t),o.splice.apply(o,[s*t,t].concat(n)),l++;return o}(e.pixels,e.width)),o.img&&o.img(e)},s=function(){var e={};switch(e.sentinel=n.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",function(e){var t,s;switch(e.label=n.readByte(),e.label){case 249:
e.extType="gce",function(e){n.readByte();var t=c(n.readByte());e.reserved=t.splice(0,3),e.disposalMethod=a(t.splice(0,3)),e.userInput=t.shift(),e.transparencyGiven=t.shift(),e.delayTime=n.readUnsigned(),e.transparencyIndex=n.readByte(),e.terminator=n.readByte(),o.gce&&o.gce(e)}(e);break;case 254:e.extType="com",(s=e).comment=r(),o.com&&o.com(s);break;case 1:e.extType="pte",i=e,n.readByte(),i.ptHeader=n.readBytes(12),i.ptData=r(),o.pte&&o.pte(i);break;case 255:e.extType="app",function(e){var t,s;switch(n.readByte(),e.identifier=n.read(8),e.authCode=n.read(3),e.identifier){case"NETSCAPE":s=e,n.readByte(),s.unknown=n.readByte(),s.iterations=n.readUnsigned(),s.terminator=n.readByte(),o.app&&o.app.NETSCAPE&&o.app.NETSCAPE(s);break;default:(t=e).appData=r(),o.app&&o.app[t.identifier]&&o.app[t.identifier](t)}}(e);break;default:e.extType="unknown",(t=e).data=r(),o.unknown&&o.unknown(t)}var i}(e);break;case",":e.type="img",t(e);break;case";":e.type="eof",o.eof&&o.eof(e);break;default:
throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(s,0)};!function(){var e={};if(e.sig=n.read(3),e.ver=n.read(3),"GIF"!==e.sig)throw new Error("Not a GIF file.");e.width=n.readUnsigned(),e.height=n.readUnsigned();var t=c(n.readByte());e.gctFlag=t.shift(),e.colorRes=a(t.splice(0,3)),e.sorted=t.shift(),e.gctSize=a(t.splice(0,3)),e.bgColor=n.readByte(),e.pixelAspectRatio=n.readByte(),e.gctFlag&&(e.gct=i(1<<e.gctSize+1)),o.hdr&&o.hdr(e)}(),setTimeout(s,0)};return function(e){var i,n,a={vp_l:0,vp_t:0,vp_w:null,vp_h:null,c_w:null,c_h:null};for(var t in e)a[t]=e[t];a.vp_w&&a.vp_h&&(a.is_vp=!0);var s=null,o=!1,r=null,c=null,l=null,p=null,d=null,h=null,u=null,g=!0,v=!1,m=[],f=[],_=[],y=a.gif;if(!y){var w=new Image;w.crossOrigin="Anonymous",w.src="",y=w}void 0===a.auto_play&&(a.auto_play=!y.getAttribute("rel:auto_play")||"1"==y.getAttribute("rel:auto_play"));var T,S,b,E,C,I,A,O,R,L,P,M,k=a.hasOwnProperty("on_end")?a.on_end:null,x=a.hasOwnProperty("loop_delay"
)?a.loop_delay:0,N=a.hasOwnProperty("loop_mode")?a.loop_mode:"auto",B=!a.hasOwnProperty("draw_while_loading")||a.draw_while_loading,D=!!B&&(!a.hasOwnProperty("show_progress_bar")||a.show_progress_bar),F=a.hasOwnProperty("progressbar_height")?a.progressbar_height:25,U=a.hasOwnProperty("progressbar_background_color")?a.progressbar_background_color:"rgba(255,255,255,0.4)",W=a.hasOwnProperty("progressbar_foreground_color")?a.progressbar_foreground_color:"rgba(255,0,22,.8)",G=function(){d=l,h=l=c=r=null},V=function(){try{ne(i,Z)}catch(e){j("parse")}},H=function(e,t){R.width=e*$(),R.height=t*$(),P.style.minWidth=e*$()+"px",M.width=e,M.height=t,M.style.width=e+"px",M.style.height=t+"px",M.getContext("2d").setTransform(1,0,0,1,0,0)},z=function(e,t,s){if(s&&D){var i,n,o,r=F;a.is_vp?v?(n=(a.vp_t+a.vp_h-r)/$(),r/=$(),i=a.vp_l/$()+e/t*(a.vp_w/$()),o=R.width/$()):(n=a.vp_t+a.vp_h-r,r=r,i=a.vp_l+e/t*a.vp_w,o=R.width):(n=(R.height-r)/(v?$():1),i=e/t*R.width/(v?$():1),o=R.width/(v?$():1),r/=v?$():1),
L.fillStyle=U,L.fillRect(i,n,o-i,r),L.fillStyle=W,L.fillRect(0,n,i,r)}},j=function(e){s=e,n={width:y.width,height:y.height},m=[],f=[]},Y=function(){if(h){m.push({data:h.getImageData(0,0,n.width,n.height),delay:c}),_.push({x:0,y:0});var e=new Image;e.addEventListener("load",function(){f.push(e)},!1),e.src=h.canvas.toDataURL()}},X=(E=-1,C=0,I=function(e){E+=e,O()},T=!1,S=function(){null!==k&&k(y),C++,!1!==N||C<0?b():g=T=!1},b=function(){if(T=g){I(1);var e=10*m[E].delay;e||(e=100),0==(E+1+m.length)%m.length?(e+=x,setTimeout(S,e)):setTimeout(b,e)}},O=function(){var e;(E=parseInt(E,10))>m.length-1&&(E=0),E<0&&(E=0),e=_[E],M.getContext("2d").putImageData(m[E].data,e.x,e.y),L.globalCompositeOperation="copy",L.drawImage(M,0,0)},{init:function(){s||(a.c_w&&a.c_h||L.scale($(),$()),a.auto_play?A():(E=0,O()))},step:A=function(){T||setTimeout(b,0)},play:function(){g=!0,A()},pause:function(){g=!1},getFrames:function(){return f},playing:g,move_relative:I,current_frame:function(){return E},
length:function(){return m.length},move_to:function(e){E=e,O()}}),K=function(e){z(i.pos,i.data.length,e)},q=function(){},Q=function(t,s){return function(e){t(e),K(s)}},Z={hdr:Q(function(e){H((n=e).width,n.height)}),gce:Q(function(e){Y(),G(),r=e.transparencyGiven?e.transparencyIndex:null,c=e.delayTime,l=e.disposalMethod}),com:Q(q),app:{NETSCAPE:Q(q)},img:Q(function(e){h||(h=M.getContext("2d"));var t=m.length,s=e.lctFlag?e.lct:n.gct;0<t&&(3===d?null!==p?h.putImageData(m[p].data,0,0):h.clearRect(u.leftPos,u.topPos,u.width,u.height):p=t-1,2===d&&h.clearRect(u.leftPos,u.topPos,u.width,u.height));var i=h.getImageData(e.leftPos,e.topPos,e.width,e.height);e.pixels.forEach(function(e,t){e!==r&&(i.data[4*t+0]=s[e][0],i.data[4*t+1]=s[e][1],i.data[4*t+2]=s[e][2],i.data[4*t+3]=255)}),h.putImageData(i,e.leftPos,e.topPos),v||(L.scale($(),$()),v=!0),B&&(L.drawImage(M,0,0),B=a.auto_play),u=e},!0),eof:function(e){Y(),K(!1),a.c_w&&a.c_h||(R.width=n.width*$(),R.height=n.height*$()),X.init(),o=!1,te&&te(y)
}},J=function(){var e=y.parentNode;e||(e=document.createElement("div")).appendChild(y);var t=document.createElement("div");R=document.createElement("canvas"),L=R.getContext("2d"),P=document.createElement("div"),M=document.createElement("canvas"),t.width=R.width=y.width,t.height=R.height=y.height,P.style.minWidth=y.width+"px",t.className="jsgif",P.className="jsgif_toolbar",t.appendChild(R),t.appendChild(P),e.insertBefore(t,y),e.removeChild(y),a.c_w&&a.c_h&&H(a.c_w,a.c_h),ee=!0},$=function(){return a.max_width&&n&&n.width>a.max_width?a.max_width/n.width:1},ee=!1,te=!1,se=function(e){return!(o||(te=e||!1,o=!0,m=[],f=[],G(),u=h=d=p=null))};return{play:X.play,pause:X.pause,getFrames:X.getFrames,move_relative:X.move_relative,move_to:X.move_to,get_playing:function(){return g},get_canvas:function(){return R},get_canvas_scale:function(){return $()},get_loading:function(){return o},get_auto_play:function(){return a.auto_play},get_length:function(){return X.length()},get_current_frame:function(){
return X.current_frame()},load_url:function(e,t){if(se(t)){var s=new XMLHttpRequest;s.open("GET",e,!0),"overrideMimeType"in s?s.overrideMimeType("text/plain; charset=x-user-defined"):"responseType"in s?s.responseType="arraybuffer":s.setRequestHeader("Accept-Charset","x-user-defined"),s.onloadstart=function(){ee||J()},s.onload=function(e){200!=this.status&&j("xhr - response"),"response"in this||(this.response=new VBArray(this.responseText).toArray().map(String.fromCharCode).join(""));var t=this.response;0<t.toString().indexOf("ArrayBuffer")&&(t=new Uint8Array(t)),i=new ie(t),setTimeout(V,0)},s.onprogress=function(e){e.lengthComputable&&z(e.loaded,e.total,!0)},s.onerror=function(){j("xhr")},s.send()}},load:function(e){this.load_url(y.getAttribute("rel:animated_src")||y.src,e)},load_raw:function(e,t){se(t)&&(ee||J(),i=new ie(e),setTimeout(V,0))},set_frame_offset:function(e,t){_[e]?(void 0!==t.x&&(_[e].x=t.x),void 0!==t.y&&(_[e].y=t.y)):_[e]=t}}}}),function(){function i(e,t){
var s=this instanceof i?this:n;return s.reset(t),"string"==typeof e&&0<e.length&&s.hash(e),s!==this?s:void 0}var n;i.prototype.hash=function(e){var t,s,i,n,o;switch(o=e.length,this.len+=o,s=this.k1,i=0,this.rem){case 0:s^=i<o?65535&e.charCodeAt(i++):0;case 1:s^=i<o?(65535&e.charCodeAt(i++))<<8:0;case 2:s^=i<o?(65535&e.charCodeAt(i++))<<16:0;case 3:s^=i<o?(255&e.charCodeAt(i))<<24:0,s^=i<o?(65280&e.charCodeAt(i++))>>8:0}if(this.rem=3&o+this.rem,0<(o-=this.rem)){for(t=this.h1;t=4294967295&5*(t=(t^=s=4294967295&13715*(s=(s=4294967295&11601*s+3432906752*(65535&s))<<15|s>>>17)+461832192*(65535&s))<<13|t>>>19)+3864292196,!(o<=i);)s=65535&e.charCodeAt(i++)^(65535&e.charCodeAt(i++))<<8^(65535&e.charCodeAt(i++))<<16,s^=(255&(n=e.charCodeAt(i++)))<<24^(65280&n)>>8;switch(s=0,this.rem){case 3:s^=(65535&e.charCodeAt(i+2))<<16;case 2:s^=(65535&e.charCodeAt(i+1))<<8;case 1:s^=65535&e.charCodeAt(i)}this.h1=t}return this.k1=s,this},i.prototype.result=function(){var e,t;return e=this.k1,t=this.h1,
0<e&&(t^=e=4294967295&13715*(e=(e=4294967295&11601*e+3432906752*(65535&e))<<15|e>>>17)+461832192*(65535&e)),t^=this.len,t=4294967295&51819*(t^=t>>>16)+2246770688*(65535&t),t=4294967295&44597*(t^=t>>>13)+3266445312*(65535&t),(t^=t>>>16)>>>0},i.prototype.reset=function(e){return this.h1="number"==typeof e?e:0,this.rem=this.k1=this.len=0,this},n=new i,"undefined"!=typeof module?module.exports=i:this.MurmurHash3=i}();var RecursiveHasher=function(t,s,i){if("object"==typeof t){if(void 0===i&&(i=new MurmurHash3,s=cleverapps.createSet(s)),Array.isArray(t)){i.hash(""+t.length);for(var e=0;e<t.length;e++)RecursiveHasher(t[e],s,i)}else{Object.keys(t).sort().forEach(function(e){!s[e]&&t[e]&&(i.hash(e),RecursiveHasher(t[e],s,i))})}return i.result()}"number"==typeof t?i.hash(""+t):i.hash(t)};cleverapps.BoostersCounter=function(e){e?this.initialize():this.load(),this.onChangeListener=function(){},this.onChangeListeners={}},cleverapps.BoostersCounter.prototype.initialize=function(){this.data={},
this.addInitAmount()},cleverapps.BoostersCounter.prototype.addInitAmount=function(e){var t=["undefined"!=typeof CellBooster?CellBooster.ID:void 0,"undefined"!=typeof LineBooster?LineBooster.ID:void 0,"undefined"!=typeof ColorBooster?ColorBooster.ID:void 0];"match3"===cleverapps.config.type&&(t=t.concat([BoostersBefore.TYPE_COMBO,BoostersBefore.TYPE_MOVES,BoostersBefore.TYPE_MULTICOLOR])),"solitaire"===cleverapps.config.type&&(t=t.concat([BoostersBefore.TYPE_MAGNET,BoostersBefore.TYPE_DICE,BoostersBefore.TYPE_TWO_JOKERS]));var s=!1;t.forEach(function(e){void 0!==e&&void 0===this.data[e]&&(this.data[e]=cleverapps.BoostersCounter.INIT_AMOUNT,s=!0)},this),s&&!e&&this.save()},cleverapps.BoostersCounter.prototype.totalAmount=function(){var e=0;for(var t in this.data)e+=this.data[t];return e},cleverapps.BoostersCounter.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.BOOSTERS_COUNTER);this.data=e||{},this.addInitAmount()},
cleverapps.BoostersCounter.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.BOOSTERS_COUNTER,this.data),!1!==e&&cleverapps.synchronizer.addUpdateTask("boosters")},cleverapps.BoostersCounter.prototype.getAmount=function(e){return this.data[e]?this.data[e]:0},cleverapps.BoostersCounter.prototype.canUse=function(e){return 0<this.getAmount(e)},cleverapps.BoostersCounter.prototype.use=function(e){this.canUse(e)&&(this.data[e]=this.data[e]-1,this.save(),BoostersBeforeConfig[e]||cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.USE_BOOSTER,{booster:e}),("undefined"!=typeof HintBooster&&e===HintBooster.ID||"undefined"!=typeof DiscoverBooster&&e===DiscoverBooster.ID)&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.USE_HINTS),this.runChangeListeners(e))},cleverapps.BoostersCounter.prototype.add=function(e,t){t=t||1,this.setAmount(e,this.getAmount(e)+t)},cleverapps.BoostersCounter.prototype.setAmount=function(e,t){this.getAmount(e)!==t&&(
this.data[e]=t,this.save(),this.runChangeListeners(e))},cleverapps.BoostersCounter.prototype.runChangeListeners=function(e){this.onChangeListener(e),cleverapps.values(this.onChangeListeners).forEach(function(e){e()})},cleverapps.BoostersCounter.INIT_AMOUNT=2;var BoosterAmountView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0);var t=cleverapps.styles.BoosterAmountView;this.bg=bundles.game.frames.booster_amount_bg_png?new cc.Sprite(bundles.game.frames.booster_amount_bg_png):new cc.Sprite,this.bg.setScale(t.background.scale),this.bg.setAnchorPoint2(),this.addChild(this.bg),this.amount=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.BOOSTER_AMOUNT_TEXT),this.addChild(this.amount),this.booster=e,this.setAmount(e.getAmount())},setAmount:function(e){0<e?(this.visible=!0,this.bg.setVisible(!0),this.amount.setVisible(!0),this.amount.setString(e),this.amount.fitTo(this.bg.width*this.bg.scale*.85)):(this.visible=!1,
this.bg.setVisible(!1),this.amount.setVisible(!1)),this.setContentSize2(Math.max(this.bg.width*this.bg.scale,this.amount.width*this.amount.scale),Math.max(this.bg.height*this.bg.scale,this.amount.height*this.amount.scale)),this.amount.setPositionRound(this.width/2,this.height/2+cleverapps.styles.BoosterAmountView.amount.offsetY),this.bg.setPositionRound(this.width/2,this.height/2)}});cleverapps.styles.BoosterAmountView={background:{scale:1},amount:{offsetY:0}};var Gun=function(){this.onShowUpListener=function(){},this.onShowForceListener=function(){},this.onAnimateListener=function(){},this.onAttackListener=function(){},this.onShowListener=function(){},this.onHideListener=function(){},this.onMouseOverListener=function(){},this.onMouseOutListener=function(){},this.load(),this.state=Gun.STATE_CREATE,this.showTime=void 0};Gun.prototype.onClick=function(){cleverapps.forces.isRunningForce()&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GUN_SHOT_FORCE),
cleverapps.forces.closeRunningForce()),-1===[Gun.STATE_BOMBING,Gun.STATE_HIDDEN].indexOf(this.state)&&(!this.showTime||this.showTime<Date.now()-300)&&cleverapps.metha.display({focus:"GunExecute",control:this.getControls(),action:this.execute.bind(this)})},Gun.prototype.showForce=function(){cleverapps.metha.display({focus:"GunForce",control:this.getControls(),actions:[function(e){setTimeout(e,500)},function(e){this.onShowForceListener(),this.setAmount(1),cleverapps.forces.onceForceClosed=e}.bind(this)]})},Gun.prototype.getControls=function(){return["gun"]},Gun.prototype.showUp=function(){this.isAvailable()&&this.state!==Gun.STATE_SHOW_UP&&(this.onShowUpListener(),this.state=Gun.STATE_SHOW_UP)},Gun.prototype.isForceAvailable=function(){return!(!Game.currentGame||this.state!==Gun.STATE_SHOW_UP)&&(!(Game.currentGame.tutorial&&!Game.currentGame.tutorial.finished)&&(Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN&&!cleverapps.forces.isShown(Forces.GUN.id)))},
Gun.prototype.animate=function(e,t){this.onAnimateListener(e,t)},Gun.prototype.onMouseOver=function(){this.state!==Gun.STATE_HIDDEN&&this.onMouseOverListener()},Gun.prototype.onMouseOut=function(){this.state!==Gun.STATE_HIDDEN&&this.onMouseOutListener()},Gun.prototype.attack=function(){this.onAttackListener(),this.state=Gun.STATE_BOMBING},Gun.prototype.hide=function(){this.onHideListener()},Gun.prototype.show=function(){this.onShowListener(),this.showTime=Date.now()},Gun.prototype.resetState=function(){this.state=Gun.STATE_CREATE},Gun.prototype.execute=function(e){if(Game.currentGame&&("board"!==cleverapps.config.type||Game.currentGame.board))if(0<this.amount)this.onExecute(e);else{e();var t=this.getProduct(),s=Game.currentGame;t.buy(cleverapps.once(function(){cleverapps.metha.displayWhenFreeFocus({focus:"GunExecute",control:this.getControls(),action:function(e){Game.currentGame===s&&void 0===Game.currentGame.outcome?this.onExecute(e):e()}.bind(this)})}.bind(this)),this.getControls())
}else e()},Gun.prototype.onExecute=function(e){console.log("Override me!")},Gun.prototype.setAmount=function(e){e<0&&(e=0),this.amount=e},Gun.prototype.getAmount=function(){return this.amount?this.amount:0},Gun.prototype.addAmount=function(e){var t=this.getAmount();this.setAmount(t+e),this.save()},Gun.prototype.getProduct=function(){return Product.Create("gunShot")},Gun.prototype.getInfo=function(){return{amount:this.getAmount()}},Gun.prototype.updateInfo=function(e,t){this.amount=e.amount,this.save(t)},Gun.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.GUN,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("gun")},Gun.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.GUN);this.amount=e&&e.amount?e.amount:0,this.amount<0&&(this.amount=0)},Gun.prototype.reset=function(){this.amount=0,this.save()},Gun.prototype.isAvailable=function(){return!cleverapps.flags.nopayments&&((
!cleverapps.config.debugMode||!cleverapps.screenshotsMode)&&cleverapps.user.checkAvailable(Gun.AVAILABLE))},Gun.AVAILABLE={episode:1,level:8,spades:{disabled:!0}},Gun.STATE_SHOW_UP=0,Gun.STATE_BOMBING=1,Gun.STATE_WIN_ANIMATION=2,Gun.STATE_CREATE=3,Gun.STATE_HIDDEN=4;var GunView=cc.Node.extend({ctor:function(e,t){this._super(),this.gun=e,this.gameScene=t,e.onShowUpListener=this.createListener(this.showUp.bind(this)),e.onShowForceListener=this.createListener(this.showForce.bind(this)),e.onAnimateListener=this.createListener(this.animate.bind(this)),e.onAttackListener=this.createListener(this.attack.bind(this)),e.onHideListener=this.createListener(this.hide.bind(this)),e.onShowListener=this.createListener(this.show.bind(this));var s=cleverapps.styles.GunView,i=s.size[cleverapps.wideMode.mode]||s.size;this.setContentSize(i),this.setPositionRound(s.position),this.basePosition=this.getPosition(),this.setLocalZOrder(19),t.gunView=this,t.scene.addChild(this),s.useSceneDelta&&(
this.y-=cleverapps.UI.getSceneOffsetY(),this.basePosition.y-=cleverapps.UI.getSceneOffsetY()),s.flyHintStartPos&&(this.flyHintStart=new cc.Node,this.flyHintStart.setPositionRound(s.flyHintStartPos),this.addChild(this.flyHintStart)),this.createView(),this.gun.resetState(),this.visible=!1,cleverapps.flags.introDisabled&&"match3"!==cleverapps.config.type&&(this.visible=!0)},createView:function(){var e=cleverapps.styles.GunView,t=e.scale[cleverapps.wideMode.mode];this.animation=new cleverapps.Spine(e.json,t),this.addChild(this.animation),e.animation.wideModePosition?this.animation.setPositionRound(e.animation.wideModePosition[cleverapps.wideMode.mode]):this.animation.setPositionRound(e.animation),cleverapps.flags.introDisabled&&"match3"!==cleverapps.config.type&&this.animation.setAnimation(0,"idle",!0),this.price=new GunPriceView(this.gun,this),this.price.setPositionRound(e.price.position),this.addChild(this.price),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,
this.gun.onClick.bind(this.gun))},showUp:function(){this.amount&&this.amount.showUp(),this.price&&this.price.showUp();var e=cleverapps.styles.GunView.startAnimation;this.animation.setAnimation(0,e,!1),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle",!0)}.bind(this)),setTimeout(function(){cleverapps.audio.playSound(cleverapps.styles.GunView.showUpSound)},1e3*cleverapps.styles.GunView.showUp.delay),this.setVisible(!0)},attack:function(){cleverapps.audio.playSound(bundles.game.urls.game_start_effect||bundles.game.urls.gun_bombing_effect);var e=cleverapps.styles.GunView;this.amount&&this.amount.hide(),this.price&&this.price.hide();var t=e.actionAnimation;"board"!==cleverapps.config.type||cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL||cleverapps.styles.GunView.disableMobileSpecialAnimation||(t=e.mobileActionAnimation);var s=void 0;cleverapps.styles.GunView.animation.actionPosition&&(
s=this.animation.getPosition(),this.animation.setPositionRound(cleverapps.styles.GunView.animation.actionPosition)),this.animation.setAnimation(0,t,!1),this.animation.setCompleteListener(function(){s&&this.animation.setPositionRound(s),this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"idle",!0),"scramble"===cleverapps.config.name&&(this.animation.setPositionRound(this.animation.x,this.animation.positionY-this.height),this.show()),this.amount&&this.amount.showUp(),this.price&&this.price.showUp()}.bind(this))},animate:function(e){console.log("Animating gun for: ",e)},showForce:function(){this.amount&&this.amount.setVisible(!1),this.price&&this.price.setVisible(!1),cleverapps.forces.create(this,Forces.GUN)},hide:function(){this.amount&&this.amount.hide(),this.price&&this.price.hide(),this.setVisible(!1)},show:function(){this.gun.state!==Gun.STATE_BOMBING&&(this.amount&&this.amount.show(),this.price&&this.price.show()),this.visible=!0}})
;cleverapps.styles.GunView={showUpSound:bundles.game.urls.gun_show_up_effect,json:bundles.game.jsons.gun_animation_json,startAnimation:"start",actionAnimation:"bombing",mobileActionAnimation:"bombing_mobile",position:[{x:50,y:{align:"top",dy:-140}},{x:60,y:{align:"top",dy:-140}},{x:60,y:{align:"top",dy:-140}}],scale:[1,1,1],animation:{x:{align:"center",dx:-90},y:{align:"center",dy:-90}},amount:{position:[{x:118,y:76},{x:108,y:86},{x:108,y:86}]},price:{position:[{x:20,y:-16},{x:0,y:-16},{x:0,y:-16}]},size:{width:100,height:150},showUp:{delay:1},touchDy:6};var GunAmountView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0);var t=cleverapps.styles.GunAmountView;t.background&&(t.background.scale9?(this.bg=new cc.Scale9Sprite(bundles.game.frames.booster_amount_bg_png),this.bg.setContentSize2(t.background.scale9)):(this.bg=new cc.Sprite(t.background.image),this.bg.setScale(t.background.scale)),this.addChild(this.bg)),
this.amount=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.TEXT),this.addChild(this.amount),this.gun=e,this.updateAmount(),this.baseScale=t.scale||this.getScale(),this.setScale(this.baseScale),this.setVisible(!1)},updateAmount:function(e){return void 0===e&&(e=this.gun.getAmount()),e&&this.amount.setString(e),e},showUp:function(){this.updateAmount()&&(this.stopAllActions(),this.setScale(0),this.setVisible(!0),this.runAction(new cc.Sequence(new cc.DelayTime(cleverapps.styles.GunAmountView.delay),new cc.ScaleTo(.2,this.baseScale))))},executeAnimation:function(e){this.runAction(new cc.Sequence(new cc.ScaleTo(.25,this.baseScale+.25*this.baseScale),new cc.CallFunc(function(){this.updateAmount(this.gun.getAmount())}.bind(this)),new cc.DelayTime(.25),new cc.ScaleTo(.25,0),new cc.CallFunc(function(){this.setVisible(!1),e()}.bind(this))))},hide:function(){this.isVisible()&&(this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,0),new cc.CallFunc(function(){
this.setVisible(!1)}.bind(this)))))},show:function(){!this.isVisible()&&this.updateAmount()&&(this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.2,this.baseScale),new cc.CallFunc(function(){this.setVisible(!0)}.bind(this)))))}});cleverapps.styles.GunAmountView={delay:1.5,scale:.6,background:{image:bundles.game.frames.gun_amount_bg_png,scale:2}};var GunHoverAnimation=function(e){var t=cleverapps.styles.GunView.hoverAnimation;this.animation=new cleverapps.Spine(t.json,1),this.animation.setPosition(e.width/2+t.offsetX,e.height/2+t.offsetY),e.addChild(this.animation,-1)};GunHoverAnimation.prototype.on=function(){this.isOn||(this.animation.visible=!0,this.isOn=!0,this.animation.setAnimation(0,"on",!1),this.animation.addAnimation(0,"idle",!0),this.animation.setCompleteListener(function(){}))},GunHoverAnimation.prototype.off=function(){this.isOn&&!this.locked&&(this.isOn=!1,this.animation.setAnimation(0,"off",!1),this.animation.setCompleteListener(
function(){this.animation.visible=!1}.bind(this)))},GunHoverAnimation.prototype.lock=function(){this.locked=!0},GunHoverAnimation.prototype.unlock=function(){this.locked=!1},GunHoverAnimation.prototype.forceOff=function(){this.unlock(),this.off()};var GunPriceView=cc.Node.extend({ctor:function(e,t){this._super(),this.gun=e;var s=cleverapps.styles.GunPriceView;this.baseScale=s.scale||this.getScale(),this.setScale(this.baseScale);var i={font:cleverapps.styles.FONTS.GUN_PRICE_TEXT,iconScale:s.icon.scale,offsetY:s.icon.offsetY};if(s.fitTo?i.fitTo=s.fitTo:i.fitTo={width:.9*t.width},this.price=new ProductPriceView(this.gun.getProduct(),i),this.price.setLocalZOrder(1),this.addChild(this.price),this.setContentSize2(this.price.getContentSize()),s.background&&(this.bg=cleverapps.UI.createSprite({image:bundles.game.frames.gun_price_bg_png||bundles.buttons_main.frames.small_green_button,scale9:s.background.scale9,width:this.price.width+2*s.background.padding.x,height:Math.max(
this.price.height+2*s.background.padding.y,s.background.minHeight)}),this.addChild(this.bg)),cleverapps.social instanceof cleverapps.OK&&s.label){var n=cleverapps.UI.generateTTFText(Messages.get("Take"),cleverapps.styles.FONTS.GUN_PRICE_BUY_TEXT||cleverapps.styles.FONTS.GUN_PRICE_TEXT);cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&s.label.mobileScale&&n.setScale(s.label.mobileScale),this.price.addChild(n);var o=s.label.offset.y;Array.isArray(o)&&(o=o[cleverapps.wideMode.mode]*resolutionScale),n.setPositionRound(this.width/2,this.height/2+o)}this.bg&&(this.setContentSize2(this.bg.getContentSize()),this.bg.setPositionRound(this.width/2,this.height/2)),this.price.setPositionRound(s.position),this.setAnchorPoint2(),this.setCascadeOpacityEnabled(!0),this.setVisible(!1),s.hover&&cleverapps.UI.applyHover(this),"wordheaps"!==cleverapps.config.name&&cleverapps.UI.onClick(this,e.onClick.bind(e))},getProduct:function(){return this.gun.getProduct()},updatePriceString:function(){
this.price.setString(this.getProduct())},showUp:function(){if(!this.gun.getAmount()){var e=cleverapps.styles.GunPriceView;this.setScale(0),this.opacity=255,this.setVisible(!0),this.price.setString(this.getProduct()),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(e.showUp.delay),new cc.ScaleTo(.2,this.baseScale)))}},hide:function(){this.isVisible()&&(this.stopAllActions(),this.inHide=!0,this.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.CallFunc(function(){this.inHide=!1,this.opacity=255,this.setVisible(!1)}.bind(this)))))},show:function(){this.gun.getAmount()||(this.inHide&&(this.stopAllActions(),this.opacity=255,this.scale=this.baseScale,this.visible=!0),this.isVisible()||(this.stopAllActions(),this.opacity=0,this.scale=this.baseScale,this.visible=!0,this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeIn(.3)))))}});cleverapps.styles.GunPriceView={showUp:{delay:1.5},scale:.6,background:{padding:{x:32,y:4},minHeight:70,
scale9:cleverapps.UI.Scale9Rect.TwoPixelXY},icon:{scale:.8},amount:{scale:1},position:{x:{align:"center"},y:{align:"center"}}};var TournamentPlayerView=cc.Node.extend({ctor:function(e,t){this._super(),this.player=e,this.competition=t,this.game=Game.currentGame;var s=cleverapps.styles.TournamentPlayerView;this.setContentSize2(s.width,s.height),this.setAnchorPoint2(.5,.5),this.setScale(s.scale[cleverapps.wideMode.mode]),this.baseScale=this.scale,this.colorNode=new cc.Node,this.colorNode.setContentSize2(this.getContentSize()),this.colorNode.setAnchorPoint2(.5,.5),this.colorNode.setCascadeColorEnabled(!0),this.colorNode.setPositionRound(this.width/2,this.height/2),this.addChild(this.colorNode),this.createBackground();var i=this.avatar=new cleverapps.UI.Avatar(e.avatar);i.setCascadeColorEnabled(!1),this.colorNode.addChild(i),i.setScale(s.avatar.scale),i.setLocalZOrder(-1),i.setPositionRound(s.avatar.x,s.avatar.y),this.createName(),this.addAmount(),this.processPlaceAnimation(),
this.prevAmount=this.player.amount,this.setCascadeColorEnabled(!0),cleverapps.config.debugMode&&cleverapps.UI.onClick(this,function(){Game.currentGame&&Game.currentGame.discoverDebug(this.player)}.bind(this)),this.competition.onChangeResultsListeners["player_"+this.player.id]=this.createListener(this.onChangeResults.bind(this)),this.player.id===cleverapps.user.id&&(this.competition.onChangeResultsListeners.processPlaceAnimation=this.createListener(this.processPlaceAnimation.bind(this)))},createName:function(){var e=cleverapps.styles.TournamentPlayerView,t=this.player.name;t||(cleverapps.throwAsync("No player name "+JSON.stringify(this.player)),t="Player_"+this.player.id.substr(-3)),0<t.indexOf(" ")&&(t=t.substring(0,t.indexOf(" ")));var s=cleverapps.UI.createSprite(e.name.bg);this.colorNode.addChild(s),s.setPositionRound(e.name.bg),e.name.bg.playerColor&&this.player.self&&s.setColor(e.name.bg.playerColor),this.name=cleverapps.UI.generateTTFText(t,
cleverapps.styles.FONTS.PLAYER_NAME_TEXT),this.name.fitTo(s.width-2*e.name.padding.x),s.addChild(this.name),this.name.setPositionRound(e.name)},addAmount:function(){var e=cleverapps.styles.TournamentPlayerView.amount,t=new cc.Sprite(this.player.id===cleverapps.user.id?bundles.game.frames.tournament_mark_1_png:bundles.game.frames.tournament_mark_0_png);t.setPosition(t.width/2,t.height/2);var s=this.score=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t.getContentSize()),s.addChild(t),s.setCascadeColorEnabled(!0);var i=this.amountText=cleverapps.UI.generateTTFText(this.player.amount+"",this.player.id===cleverapps.user.id?cleverapps.styles.FONTS.PLAYER_SCORE:cleverapps.styles.FONTS.BOT_SCORE);s.addChild(i),i.setPositionRound(e.text),this.colorNode.addChild(s),s.setPositionRound(e)},createBackground:function(){var e,t=cleverapps.styles.TournamentPlayerView.background;t&&(!1===t.scale9?((e=new cc.Sprite(t.image)).setScaleX(this.width/e.width),e.setScaleY(this.height/e.height)):(
e=cleverapps.UI.createScale9Sprite(t.image,t.scale9)).setContentSize2(this.width,this.height),e.setPosition(this.width/2,this.height/2),this.colorNode.addChild(e),e.setLocalZOrder(-1),this.player.self?e.setColor(cleverapps.styles.COLORS.PLAYER_BG_COLOR):e.setColor(cleverapps.styles.COLORS.COMPETITOR_BG_COLOR||cleverapps.styles.COLORS.WHITE))},onChangeResults:function(e){e===this.player.id&&(this.score.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.4,1.4).easing(cc.easeOut(3)),new cc.Sequence(new cc.RotateTo(.15,15),new cc.RotateTo(.15,-15),new cc.RotateTo(.1,0))),new cc.ScaleTo(.15,1))),this.amountText.setString(this.player.amount+""))},processPlaceAnimation:function(e){if(this.player.id===cleverapps.user.id&&!(this.competition.calcPlace()<3||this.competition.getFinishedOpponents().length===this.competition.results.length-1||this.placeAnimationProcessing)){var t=cleverapps.styles.COLORS.PLAYER_ALARM_COLOR,s=cleverapps.styles.COLORS.WHITE;this.placeAnimationProcessing=!0,
this.colorNode.runAction(new cc.Sequence(new cc.TintTo(.5,t.r,t.g,t.b),new cc.TintTo(.5,s.r,s.g,s.b),new cc.CallFunc(function(){this.placeAnimationProcessing=!1,this.processPlaceAnimation()}.bind(this)))),this.framePulsation||(this.framePulsation=new cc.Sprite(bundles.game.frames.avatar_frame_red_png),this.avatar.addChild(this.framePulsation),this.framePulsation.setPositionRound(this.avatar.width/2,this.avatar.height/2),this.framePulsation.setLocalZOrder(-1),this.framePulsation.setColor(cc.color.RED),this.framePulsation.setContentSize2(this.avatar.width,this.avatar.height)),this.framePulsation.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2),new cc.ScaleTo(.5,1)))}},animateReorder:function(e){if(!(Math.abs(this.y-e.y)<1&&this.player.amount===this.prevAmount)||this.reorderAnimationRunning){var t=e.y>this.y||this.player.amount>this.prevAmount;this.prevAmount=this.player.amount,this.reorderAnimationRunning=!0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.Spawn(
new cc.ScaleTo(.2,this.baseScale*(t?1.2:.9)),new cc.MoveTo(.35,e).easing(cc.easeIn(1)),new cc.Sequence(new cc.CallFunc(function(){this.rotation=0}.bind(this)),new cc.DelayTime(.08),new cc.RotateBy(.108,e.y>this.y?20:0).easing(cc.easeInOut(.5)),new cc.RotateBy(.135,e.y>this.y?-30:0),new cc.RotateBy(.027,e.y>this.y?10:0)),new cc.Sequence(new cc.DelayTime(.3),new cc.ScaleTo(.2,this.baseScale))),new cc.CallFunc(function(){this.reorderAnimationRunning=!1}.bind(this))))}},animateResult:function(e){var t=cleverapps.styles.TournamentPlayerView;cleverapps.UI.animateDelta(e,{parent:this,font:cleverapps.styles.FONTS.PLAYER_VIEW_DELTA_TEXT,x:this.width/2+t.delta.x,y:this.height/2+t.delta.y})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{PLAYER_SCORE:{size:25,color:cleverapps.styles.COLORS.BLACK},BOT_SCORE:{size:25,color:cleverapps.styles.COLORS.BLACK},PLAYER_VIEW_DELTA_TEXT:{size:25,color:cleverapps.styles.COLORS.BLACK}}),cleverapps.styles.TournamentPlayerView={background:{
image:bundles.game.frames.tournament_bg_png,scale9:cleverapps.UI.Scale9Rect.TwoPixelXY},width:145,height:140,scale:[1,1,1],avatar:{x:{align:"center"},y:{align:"center",dy:10},scale:1},amount:{x:{align:"right"},y:{align:"bottom"},text:{x:{align:"center"},y:{align:"center"}}},name:{x:{align:"center"},y:{align:"center"},padding:{x:17},bg:{image:bundles.menubar.frames.menubar_bg_png,width:100,height:40,x:{align:"center"},y:{align:"bottom"}}},delta:{x:55,y:0}};var TournamentPlayersView=cc.Node.extend({ctor:function(t){this._super(),this.competition=t,this.players=t.results,this.competition.calcPlace(),this.views=this.players.map(function(e){return new TournamentPlayerView(e,t)}.bind(this));var e=cleverapps.styles.TournamentPlayersView,s=new cleverapps.Layout(this.views,{direction:cleverapps.UI.VERTICAL,margin:e.margin});this.setContentSize2(s.width,s.height),this.addChild(s),s.setPositionRound(this.width/2+e.content.offset.x,this.height/2+e.content.offset.y),this.setPositionRound(e.x,
e.y[cleverapps.wideMode.mode],cleverapps.UI.getSceneSize()),this.positions={},this.views.forEach(function(e,t){this.positions[t]=e.getPosition()}.bind(this)),this.createBg(),this.setLocalZOrder(1),t.onChangeResultsListeners.tournamentPlayers=cleverapps.whenShow(this.createListener(cleverapps.timeredThrottle(10,this.onChangeResults.bind(this)))),this.onChangeResults(),Game.currentGame.afterOnChangeOutcomeListeners.tournamentPlayerViews=this.createListener(this.afterOnChangeOutcome.bind(this)),this.setVisible(!1),cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl("tournamentPlayersView",this)},afterOnChangeOutcome:function(){var e=-cleverapps.UI.getSceneSize().width/2*.025;this.runAction(new cc.MoveBy(1,e,0).easing(cc.easeInOut(1.5)))},createBg:function(){var e=cleverapps.styles.TournamentPlayersView.bg;if(e){var t=new cc.Scale9Sprite(e.image);this.addChild(t),t.setLocalZOrder(-1);var s=1.3*(this.width+e.padding.x),i=this.height+2*e.padding.y
;e.rotate90?(t.setContentSize2(i,s),t.setRotation(90)):t.setContentSize2(s,i),t.setPositionRound(this.width+e.padding.x-s/2,this.height/2)}},onChangeResults:function(e){this.competition.calcPlace(),this.views.sort(function(e,t){var s=this.competition.results.indexOf(e.player);return this.competition.results.indexOf(t.player)-s}.bind(this)),this.views.forEach(function(e,t){e.setLocalZOrder(t+1),e.animateReorder(this.positions[t])}.bind(this))},animateResults:function(t){this.views.forEach(function(e){e.player.player&&e.animateResult(t)})}});cleverapps.styles.TournamentPlayersView={align:"left",x:130,y:[620,620,620],margin:10,bg:{image:bundles.game.frames.tournament_bg_png,padding:{x:15,y:20}},content:{offset:{x:0,y:0}}};var ExpInfoWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.ExpInfoWindow,t=this.generateContent();this._super({title:"messages:ExpInfoWindow.Title",name:"expinfowindow",content:t}),t.y-=e.topBottom,Lottery.addText(this)},
generateProductOption:function(e,t){var s=cleverapps.styles.ExpInfoWindow,i=Product.Create(e),n=cleverapps.UI.generateTTFText(i.reward.exp,cleverapps.styles.FONTS.BUTTON_TEXT),o=new cc.Sprite(bundles.reward_icons.frames.reward_exp_png);o.setScale(s.button.amountIcon.scale);var r=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:s.button.amountMargin}),a=new cleverapps.UI.Button({content:r,onClicked:function(){i.buy(function(){this.close()}.bind(this))}.bind(this),width:s.button.width,height:s.button.height});Lottery.addIcon(a);var c=new ProductPriceView(i,{font:cleverapps.styles.FONTS.ADDMOVES_PRICE}),l=new cc.Sprite(t);return new cleverapps.Layout([a,c,l],{direction:cleverapps.UI.VERTICAL,margin:s.button.itemsMargin})},generateContent:function(){var e=cleverapps.styles.ExpInfoWindow,t=cleverapps.UI.generateTTFText("messages:ExpInfoWindow.Message",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);t.setDimensions(e.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER
);var s=cleverapps.UI.generateTTFText("messages:ExpInfoWindow.BuyMessage",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);s.setDimensions(e.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var i=new cleverapps.Layout([this.generateProductOption("buyExp10",bundles.exp_window.frames.small_exp_box),this.generateProductOption("buyExp150",bundles.exp_window.frames.exp_box)],{direction:cleverapps.UI.HORIZONTAL,margin:e.buttonsMargin,align:cleverapps.UI.ALIGN_START});return new cleverapps.Layout([i,s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin})},listBundles:function(){return["exp_window"]}});cleverapps.styles.ExpInfoWindow={width:600,margin:30,buttonsMargin:50,topBottom:70,exp:{width:400,height:200},button:{amountMargin:10,itemsMargin:3,width:300,height:100,amountIcon:{scale:.7}}};var Chat=function(){this.messages=[],cleverapps.EventEmitter.call(this),this.editingMode=!1,this.closing=!1,this.hasUnread=!1,this.loadSave(),setInterval(this.reload.bind(this),
cleverapps.parseInterval(Chat.RELOAD_INTERVAL))};Chat.prototype=Object.create(cleverapps.EventEmitter.prototype),(Chat.prototype.constructor=Chat).IsAvailable=function(){if(cleverapps.config.wysiwygMode)return!1;if(cleverapps.chat.hasUnread)return!0;if(-1!==["mbga","sp_mbga"].indexOf(cleverapps.User.calcSource()))return!1;if(0<cleverapps.paymentsHistory.classify())return!0;var e={};if("merge"===cleverapps.config.type){if(Game.currentGame&&Game.currentGame.gameLevel.getLevel()<9)return!1}else e.episode=1,e.level=0;return e.registered="3 days",levels.user.checkAvailable(e)},Chat.prototype.loadSave=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.CHAT)||{};this.processed=e.processed||{}},Chat.prototype.storeSave=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.CHAT,{processed:this.processed})},Chat.prototype.load=function(n,e){cleverapps.RestClient.get("/chat/messages/"+cleverapps.user.id,{},function(e){var t=e.map(ChatMessage.fromData)
;this.messages=[];var s=void 0,i=void 0;this.hasUnread=!1,t.forEach(function(e){var t=new Date(e.postDate).toLocaleDateString(cleverapps.settings.language,{year:"numeric",month:"long",day:"numeric"});t!==s&&(s=t,this.messages.push(ChatMessage.createServiceMessage(t))),(1===e.isResponse&&0===e.readByUser||e.hasGift()&&!e.isGiftTaken()&&e.isApplicable())&&(this.hasUnread=!0),e.hasGift()&&this.processed[e.id]&&(e.isGiftTaken()?(delete this.processed[e.id],this.storeSave()):cleverapps.RestClient.post("/chat/acceptGift",{id:e.id})),e.isTurningOnConsoleStream()?(i=!0,this.messages.push(ChatMessage.createServiceMessage("messages:ChatConsoleStreamSwitchOn",e.id))):e.isTurningOffConsoleStream()?(i=!1,this.messages.push(ChatMessage.createServiceMessage("messages:ChatConsoleStreamSwitchOff",e.id))):this.messages.push(e)}.bind(this)),void 0!==i&&i?cleverapps.consoleStream.enable(this.postMessage.bind(this,"Disable console stream","stream_off",!0)):void 0===i||i||cleverapps.consoleStream.disable(),
0===this.messages.length&&this.messages.push(ChatMessage.createServiceMessage("messages:ChatGreetingMessage")),this.closing||(this.trigger("removeTemporaryMessages"),this.trigger("messagesUpdated")),n&&n()}.bind(this),e||this.printConnectionError.bind(this))},Chat.prototype.postMessage=function(t,e,s){var i=ChatMessage.createTemporaryMessage(t);this.messages.push(i),s||this.trigger("messagesUpdated");var n=cleverapps.friends.getPlayer().name;n===Messages.get("Friends.You")&&(n=Messages.get("LeadersWindow.player"));var o=cleverapps.paymentsHistory.classify();0===o&&cleverapps.paymentsHistory.isPayer()&&(o=1),cleverapps.RestClient.post("/chat/message",{message:t,userid:cleverapps.user.id,isresponse:0,payerlevel:o,name:n,language:cleverapps.settings.language,source:cleverapps.user.source,tag:e},function(){this.load()}.bind(this),function(){var e=this.messages.indexOf(i);-1!==e&&this.messages.splice(e,1),s||(this.trigger("removeTemporaryMessages"),this.trigger("returnMessageBack",t),
this.printConnectionError())}.bind(this))},Chat.prototype.markAsRead=function(){cleverapps.RestClient.post("/chat/markAsRead",{userid:cleverapps.user.id},this.reload.bind(this))},Chat.prototype.acceptGift=function(e,t){if(this.processed[e.id])this.reload();else{var s=!1;if(t){if(e.progress)levels.user.level=parseInt(e.progress.level),levels.user.episode=parseInt(e.progress.episode),levels.user.save(),levels.episodes.reset(),levels.episodes.setCurrentEpisode(levels.user.episode);else if(e.presents)s=!0,cleverapps.chatPresents={reward:e.presents,callback:function(){cleverapps.chat.processed[e.id]=!0,cleverapps.chat.storeSave(),cleverapps.RestClient.post("/chat/acceptGift",{id:e.id})}},this.closing=!0,cc.director.getRunningScene().closeAction();else if(e.metha)if(e.metha.simple)cleverapps.simple.current=e.metha.simple.current,cleverapps.simple.stars=0,cleverapps.simple.save();else if(e.metha.farm){Farm.Reset();var i=Farm.GetBuildingProgress(e.metha.farm.building,e.metha.farm.quest)
;cleverapps.farm.load(i),cleverapps.farm.save()}else e.metha.home&&(cleverapps.home.load(Home.GetFurnitureProgress(e.metha.home.furniture,e.metha.home.stage)),cleverapps.home.save());cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect)}s||(this.processed[e.id]=!0,this.storeSave(),cleverapps.RestClient.post("/chat/acceptGift",{id:e.id},this.reload.bind(this)))}},Chat.prototype.printConnectionError=function(){this.messages.push(ChatMessage.createServiceMessage(Messages.get("RestartWindow.AnErrorOccured"),"error_"+(new Date).toLocaleTimeString())),this.trigger("messagesUpdated")},Chat.prototype.reload=function(){Chat.IsAvailable()&&(cleverapps.environment.isChatScene()||cleverapps.environment.isMainScene())&&this.load()},Chat.RELOAD_INTERVAL="1 minute";var ChatMessage=function(){};ChatMessage.fromData=function(e){var t=new ChatMessage;return t.id=e.id,t.userId=e.userId,t.postDate=e.postDate,t.message=e.message,t.isResponse=e.isResponse,t.readByUser=e.readByUser,t.tag=e.tag,
t.type=ChatMessage.MESSAGE_TYPE.CHAT,t},ChatMessage.createServiceMessage=function(e,t){var s=new ChatMessage;return s.id=t||"service_"+e,s.message=e,s.type=ChatMessage.MESSAGE_TYPE.SERVICE,s},ChatMessage.createTemporaryMessage=function(e){var t=new ChatMessage;return t.id="tmp_"+e,t.message=e,t.type=ChatMessage.MESSAGE_TYPE.TEMPORARY,t.postDate=(new Date).toString(),t},ChatMessage.prototype.hasGift=function(){return"gift"===this.tag||"takengift"===this.tag},ChatMessage.prototype.isGiftTaken=function(){return"takengift"===this.tag},ChatMessage.prototype.isTurningOnConsoleStream=function(){return"stream_on"===this.tag},ChatMessage.prototype.isTurningOffConsoleStream=function(){return"stream_off"===this.tag},ChatMessage.prototype.isApplicable=function(){if(this.parseGift(),this.metha)if(this.metha.farm){var e=parseInt(this.metha.farm.building),t=cleverapps.farm.buildings[e],s=parseInt(this.metha.farm.quest);if(!t||s>=t.quests.length)return!1}else if(this.metha.simple)return parseInt(
this.metha.simple.current)<cleverapps.simple.bgsAmount;return!0},ChatMessage.prototype.parseGift=function(){if(!this.parsed){this.parsed=!0;var e=JSON.parse(this.message);if(e.presents){var i=this.presents={};e.presents.forEach(function(e){if("object"==typeof e&&e.hasOwnProperty("type")&&e.hasOwnProperty("amount")){var t=e.type;if(-1!==["gold","unlimitedLives","stars","exp","gun","wardrobe","lives","coins","wands","worker","unit"].indexOf(t)||0===t.indexOf("booster")||0===t.indexOf("hl")){var s=e.amount;0===t.indexOf("booster")?(void 0===i.boosters&&(i.boosters=[]),i.boosters[parseInt(t.replace("booster",""))]=s):"unlimitedLives"===t?i.unlimitedLives={interval:s+" hour",amount:s,title:"messages:AMOUNT_HOURS"}:"worker"===t?i.worker={interval:s+" hour",amount:s,title:"messages:AMOUNT_HOURS"}:-1!==t.indexOf("hl")?(i.herolevels||(i.herolevels=[]),i.herolevels.push([t.replace("hl",""),e.amount])):"unit"===t?i.unit={code:e.code,stage:e.stage,amount:s||1}:i[t]=s}}})
}else e.progress?this.progress=e.progress:e.metha&&(this.metha=e.metha)}},ChatMessage.MESSAGE_TYPE={CHAT:0,SERVICE:1,TEMPORARY:2};var ChatHeader=cc.Scale9Sprite.extend({ctor:function(e){this._super(bundles.chat.frames.panelup),this.setAnchorPoint2(0,1);var t=cleverapps.styles.ChatHeader,s=cleverapps.UI.generateOnlyText(Messages.get("messages:ChatTitle"),cleverapps.styles.FONTS.CHAT_HEADER_TEXT);e.closing=!1;var i=this.backButton=new cleverapps.UI.Button({noBg:!0,content:new cc.Sprite(bundles.chat.frames.icon_back),onClicked:function(){e.closing=!0,setTimeout(function(){cc.director.getRunningScene().closeAction()}.bind(this),cc.sys.isMobile&&e.editingMode?500:100)}.bind(this),width:t.back.width,height:t.back.height,useInteractiveScale:!0});i.setPosition(0,t.back.offsetY),this.content=new cleverapps.Layout([i,s],{direction:cleverapps.UI.HORIZONTAL,margin:t.back.margin}),this.addChild(this.content),cleverapps.eventBus.on("changeSceneSize",this.onChangeSize.bind(this),this),
this.onChangeSize()},onChangeSize:function(){var e=cleverapps.styles.ChatHeader;this.setContentSize2(cc.director.getWinSize().width,e.height),this.setPosition(0,cc.director.getWinSize().height),this.content.setPositionRound(this.width/2+e.content.offsetX,this.height/2),cleverapps.UI.fitToBox(this.content,{width:.8*cc.director.getWinSize().width,height:e.height}),this.backButton.setScale(1/this.content.scale)}});cleverapps.styles.ChatHeader={height:130,content:{offsetX:-50},back:{width:120,height:120,margin:25,offsetY:5}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_HEADER_TEXT:{size:50,color:cleverapps.styles.COLORS.BLACK}});var ChatInput=cc.Scale9Sprite.extend({ctor:function(e){this._super(bundles.chat.frames.paneldown);var t=cleverapps.styles.ChatInput;this.chat=e,this.isVertical="horizontal"!==cleverapps.config.orientation,this.inputHeight=this.isVertical?t.verticalHeight:t.height,this.setAnchorPoint2(0,0);var s=this.sendButton=new cleverapps.UI.Button({noBg:!0,
content:new cc.Sprite(bundles.chat.frames.panel_on),contentOff:new cc.Sprite(bundles.chat.frames.panel_off),onClicked:this.send.bind(this),width:t.sendButton.width,height:this.inputHeight,fitTo:!1,useInteractiveScale:!0});s.disable(),this.addChild(s),this.charsCountText=cleverapps.UI.generateOnlyText("0/500",cleverapps.styles.FONTS.CHAT_CHARS_COUNT_TEXT),this.charsCountText.setVisible(!1),this.charsCountText.setDimensions(t.charsCount.width,0),this.charsCountText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(this.charsCountText);var i=this.textAreaBg=cleverapps.UI.createScale9Sprite(bundles.chat.frames.textbox);this.addChild(i);var n=this.text=new cc.EditBox(cc.size(i.width-t.textPadding.x,i.height-t.textPadding.y));n.setDelegate(this),n.stayOnTop(!0),n.setTouchEnabled(),n.setMaxLength(500),n.setFontColor(cleverapps.styles.FONTS.CHAT_INPUT_FIELD_TEXT.color),this.textAreaBg.addChild(this.text),this.onChangeSize(),cleverapps.eventBus.on("changeSceneSize",
this.onChangeSize.bind(this),this),this.chat.on("returnMessageBack",this.returnMessageBack.bind(this))},onChangeSize:function(){var e=cleverapps.styles.ChatInput;this.setContentSize2(cc.director.getWinSize().width,this.inputHeight+e.padding),this.setPosition(0,0),this.textAreaBg.setContentSize(this.width-(this.isVertical?e.textArea.vertical.rightMargin:e.textArea.rightMargin),this.inputHeight),this.textAreaBg.setPositionRound(this.isVertical?e.textArea.vertical:e.textArea),this.sendButton.setContentSize(e.sendButton.width,this.inputHeight),this.sendButton.setPositionRound(this.isVertical?e.sendButton.vertical:e.sendButton),this.text.setContentSize(this.textAreaBg.width-e.textPadding.x,this.textAreaBg.height-e.textPadding.y),this.text.setPositionRound(this.textAreaBg.width/2,this.textAreaBg.height/2),this.charsCountText.setPositionRound(this.isVertical?e.charsCount.vertical:e.charsCount)},send:function(){var e=this.getMessageText();0<e.length&&(this.text.setString(""),
this.sendButton.disable(),this.charsCountText.setVisible(!1),this.chat.postMessage(e))},returnMessageBack:function(e){this.text.setString(e),this.editBoxTextChanged(this.text,e)},editBoxTextChanged:function(e,t){0<this.getMessageText(t).length?this.sendButton.enable():this.sendButton.disable(),this.text.setFont("Rubik",cleverapps.styles.FONTS.CHAT_INPUT_FIELD_TEXT.size),400<=this.text.getString().length?(this.charsCountText.setVisible(!0),this.charsCountText.setString(this.text.getString().length+"/500"),this.charsCountText.setFont(450<=this.text.getString().length?cleverapps.styles.FONTS.CHAT_CHARS_COUNT_RED_TEXT:cleverapps.styles.FONTS.CHAT_CHARS_COUNT_TEXT)):this.charsCountText.setVisible(!1)},editBoxReturn:function(){setTimeout(this.send.bind(this),0)},getMessageText:function(e){return(e=e||this.text.getString()).trim().replace(/(?:\r\n|\r|\n)/g,"").replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"�")},
editBoxEditingDidBegin:function(){this.chat.editingMode=!0},editBoxEditingDidEnd:function(){this.chat.editingMode=!1}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_INPUT_FIELD_TEXT:{size:40,color:cleverapps.styles.COLORS.BLACK,font:bundles.chat.urls.strict_font_ttf},CHAT_CHARS_COUNT_TEXT:{size:22,color:cleverapps.styles.COLORS.COLOR_VERY_DARK_GRAY,font:bundles.chat.urls.strict_font_ttf},CHAT_CHARS_COUNT_RED_TEXT:{size:22,color:new cc.Color(243,60,60,255),font:bundles.chat.urls.strict_font_ttf}}),cleverapps.styles.ChatInput={height:150,verticalHeight:200,padding:22,sendButton:{x:{align:"right",dx:-35},y:{align:"center"},vertical:{x:{align:"right"},y:{align:"center"}},width:110},charsCount:{x:{align:"right",dx:-40},y:{align:"bottom",dy:10},vertical:{x:{align:"right",dx:-6},y:{align:"bottom",dy:25}},width:100},textArea:{rightMargin:230,x:{align:"left",dx:50},y:{align:"center",dy:-6},vertical:{rightMargin:130,x:{align:"left",dx:20},y:{align:"center",dy:-6}}},textPadding:{x:40,
y:12}};var ChatMessageView=cc.Node.extend({ctor:function(e){this._super(),this.chatMessage=e,this.setAnchorPoint2(0,.5);var t=new Date(e.postDate).toLocaleTimeString(cleverapps.settings.language,{hour12:!1,hour:"2-digit",minute:"2-digit"}),s=this.messageTimeText=cleverapps.UI.generateOnlyText(t,cleverapps.styles.FONTS.CHAT_MESSAGE_TIME_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_RIGHT);var i=this.bg=cleverapps.UI.createScale9Sprite(this.chatMessage.isResponse?bundles.chat.frames.dialog_box_white:bundles.chat.frames.dialog_box_green);this.addChild(i,-1),this.content=this.createContent(this.chatMessage),i.addChild(this.content),i.addChild(s),this.chatMessage.isResponse||(this.chatMessage.readByUser?this.mark=new cc.Sprite(bundles.chat.frames.checkmark_read):this.chatMessage.type===ChatMessage.MESSAGE_TYPE.TEMPORARY?this.mark=new cc.Sprite(bundles.chat.frames.checkmark_tmp):this.mark=new cc.Sprite(bundles.chat.frames.checkmark_sent),i.addChild(this.mark)),this.onChangeSize()},
createContent:function(e){return e.hasGift()?new GiftContentView(e):(this.messageText=cleverapps.UI.generateOnlyText(e.message,cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT),this.messageText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),this.messageText)},updateContent:function(e){this.content&&this.content.removeFromParent(),this.content=this.createContent(e),this.bg.addChild(this.content),this.onChangeSize()},onChangeSize:function(){var e=cleverapps.styles.ChatMessageView,t=.7*cc.director.getWinSize().width;t>e.maxWidth?t=e.maxWidth:t<e.minWidth&&(t=e.minWidth),this.messageText?(this.messageText.setDimensions(t,0),this.setContentSize2(cc.director.getWinSize().width,this.messageText._getHeight()+2*e.text.padding)):this.setContentSize2(cc.director.getWinSize().width,this.content.height+2*e.text.padding),this.bg.setContentSize(t+2*e.text.padding,this.height),this.chatMessage.isResponse?(this.bg.setAnchorPoint2(0,.5),this.bg.setPosition(
"horizontal"!==cleverapps.config.orientation?e.responseBg.verticalOffsetX:e.responseBg.offsetX,this.height/2)):this.bg.setPositionRound(e.questionBg),this.content.setPositionRound(this.bg.width/2+(this.chatMessage.isResponse?e.text.responceOffsetX:0),this.bg.height/2+e.text.offsetY),this.messageTimeText.setDimensions(e.time.width,e.time.height),this.messageTimeText.setPositionRound(this.chatMessage.isResponse?e.time.response:e.time.question),this.mark&&this.mark.setPositionRound(e.mark)}});cleverapps.styles.ChatMessageView={minWidth:500,maxWidth:900,text:{padding:30,responceOffsetX:5,offsetY:2},time:{width:200,height:24,response:{x:{align:"right",dx:-34},y:{align:"bottom",dy:14}},question:{x:{align:"right",dx:-56},y:{align:"bottom",dy:14}}},mark:{x:{align:"right",dx:-22},y:{align:"bottom",dy:18}},responseBg:{offsetX:32,verticalOffsetX:4},questionBg:{x:{align:"right",dx:-30},y:{align:"center"}}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_MESSAGE_TEXT:{size:40,
color:cleverapps.styles.COLORS.BLACK,font:bundles.chat.urls.strict_font_ttf},CHAT_MESSAGE_TIME_TEXT:{size:26,color:new cc.Color(138,138,138,255),font:bundles.chat.urls.strict_font_ttf}});var ServiceMessageView=cc.Node.extend({ctor:function(e){this._super(),this.chatMessage=e,this.setAnchorPoint2(0,.5),this.messageText=cleverapps.UI.generateOnlyText(e.message,cleverapps.styles.FONTS.SERVICE_MESSAGE_TEXT),this.messageText.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(this.messageText),this.onChangeSize()},onChangeSize:function(){this.messageText.setDimensions(cc.director.getWinSize().width-cleverapps.styles.ServiceMessageView.padding,0),this.setContentSize2(cc.director.getWinSize().width,this.messageText._getHeight()+cleverapps.styles.ServiceMessageView.padding),this.messageText.setPositionRound(this.width/2,this.height/2)}});cleverapps.styles.ServiceMessageView={padding:50},cleverapps.overrideFonts(cleverapps.styles.FONTS,{SERVICE_MESSAGE_TEXT:{size:30,
color:new cc.Color(83,97,106,255),font:bundles.chat.urls.strict_font_ttf}});var GiftContentView=cleverapps.Layout.extend({ctor:function(e){this.chatMessage=e;var t=cleverapps.styles.GiftContentView;this.chatMessage.parseGift();var s=Math.min(.6*cc.director.getWinSize().width,t.width),i=[],n=cleverapps.UI.createScale9Sprite(bundles.chat.frames.gift_bg),o=new cc.Sprite(bundles.chat.frames.checkmark_gift),r=this.chatMessage.isGiftTaken()?o.height:0;if(this.chatMessage.progress||this.chatMessage.metha){if(this.chatMessage.metha){if(this.chatMessage.metha.simple){var a=parseInt(this.chatMessage.metha.simple.current);_=a<cleverapps.simple.bgsAmount?cleverapps.UI.generateOnlyText("messages:AdminSetMethaProgress.Text",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT,{bgIndex:a}):cleverapps.UI.generateOnlyText("messages:AdminSetMethaProgress.Text.Unavailable",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)}else if(this.chatMessage.metha.farm){var c=parseInt(this.chatMessage.metha.farm.building),
l=cleverapps.farm.buildings[c],p=parseInt(this.chatMessage.metha.farm.quest);if(l&&p<l.quests.length){var d=Messages.get("building."+cleverapps.farm.buildings[c].name),h=Messages.get(0<p?"messages:AdminSetFarmProgress.Text.Quest":"messages:AdminSetFarmProgress.Text",{buildingName:d,questName:Messages.get(l.quests[p].title)});_=cleverapps.UI.generateOnlyText(h,cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)}else _=cleverapps.UI.generateOnlyText("messages:AdminSetFarmProgress.Text.Unavailable",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)}else if(this.chatMessage.metha.home){var u=parseInt(this.chatMessage.metha.home.furniture),g=cleverapps.home.furniture[u],v=parseInt(this.chatMessage.metha.home.stage);if(g&&v<g.stages.length){var m=Messages.get("building."+g.name);h=Messages.get(0<v?"messages:AdminSetHomeProgress.Text.Stage":"messages:AdminSetHomeProgress.Text",{furnitureName:m,stageName:Messages.get(g.stages[v].title)});_=cleverapps.UI.generateOnlyText(h,
cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)}else _=cleverapps.UI.generateOnlyText("messages:AdminSetHomeProgress.Text.Unavailable",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)}}else{var f=cleverapps.humanReadableNumber(parseInt(this.chatMessage.progress.episode),parseInt(this.chatMessage.progress.level));_=cleverapps.UI.generateOnlyText("messages:AdminSetProgress.Text",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT,{levelNo:f})}_.setDimensions(s,0),_.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setContentSize(s+t.bg.padding,Math.max(t.minHeight,_.height+t.bg.padding+r)),n.addChild(_),_.setPositionRound(n.width/2,n.height/2+r/2),i.push(n)}else if(this.chatMessage.presents){var _,y=this.chatMessage.presents.herolevels&&0<this.chatMessage.presents.herolevels.length,w=this.chatMessage.presents.unit&&this.chatMessage.presents.unit.code;(_=cleverapps.UI.generateOnlyText(y?"messages:AdminGiftsHeroes":"messages:AdminGiftsText",cleverapps.styles.FONTS.CHAT_MESSAGE_TEXT)).setDimensions(s,0),
_.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.push(_);var T=new RewardsListComponent(this.chatMessage.presents,{amountInRow:y?3:2,noImage:w,font:cleverapps.styles.FONTS.CHAT_REWARD_COUNT_TEXT,onlyText:!0,reward:{direction:cleverapps.UI.HORIZONTAL}}),S=Math.min(.9*s/T.width,1);T.setScale(S),n.setContentSize(s+t.bg.padding,Math.max(t.minHeight,T.height*S+r+t.bg.padding)),n.addChild(T),T.setPositionRound(n.width/2,n.height/2+r/2),i.push(n)}if(this.chatMessage.isGiftTaken())o.setPositionRound(t.checkmark),n.addChild(o);else if(this.chatMessage.isApplicable()){var b=new cleverapps.UI.Button({text:Messages.get("No"),button_png:bundles.chat.frames.no_button,button_on_png:bundles.chat.frames.no_button_on,onClicked:function(){cleverapps.chat.acceptGift(this.chatMessage,!1)}.bind(this),font:cleverapps.styles.FONTS.CHAT_MESSAGE_BUTTON_TEXT,width:t.buttons.width,height:t.buttons.height});b.visible=void 0!==this.chatMessage.progress||void 0!==this.chatMessage.metha
;var E=new cleverapps.UI.Button({text:void 0!==this.chatMessage.progress?Messages.get("Yes"):Messages.get("Accept"),button_png:bundles.chat.frames.accept_button,button_on_png:bundles.chat.frames.accept_button_on,onClicked:function(){cleverapps.chat.acceptGift(this.chatMessage,!0)}.bind(this),font:cleverapps.styles.FONTS.CHAT_MESSAGE_BUTTON_TEXT,width:t.buttons.width,height:t.buttons.height});i.push(new cleverapps.Layout([b,E],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin}))}this._super(i.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.margin,padding:t.padding})}});cleverapps.styles.GiftContentView={width:840,minHeight:220,margin:10,padding:{x:10,y:10},buttons:{width:200,height:60},checkmark:{x:{align:"right",dx:-6},y:{align:"bottom",dy:10}},bg:{padding:20}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{CHAT_MESSAGE_BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,font:bundles.chat.urls.strict_font_ttf},CHAT_REWARD_COUNT_TEXT:{size:60,
color:cleverapps.styles.COLORS.BLACK,font:bundles.chat.urls.strict_font_ttf}});var ChatView=cc.Node.extend({ctor:function(e){this.chat=e,this.messageViews={},this._super(),this.setAnchorPoint2();var t=this.container=new cc.Node;t.setAnchorPoint2(),this.scroll=new cleverapps.UI.ScrollView(t,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK}),this.scroll.setAnchorPoint2(0,0),this.scroll.setPositionRound(0,0),this.addChild(this.scroll),this.onChangeSize(),cleverapps.eventBus.on("changeSceneSize",this.onChangeSize.bind(this),this),this.chat.on("messagesUpdated",this.updateMessages.bind(this)),this.chat.on("removeTemporaryMessages",this.removeTemporaryMessages.bind(this))},updateMessages:function(){this.chat.messages.forEach(function(e){if(this.messageViews[e.id])e.tag!==this.messageViews[e.id].chatMessage.tag&&this.messageViews[e.id].updateContent(e);else{var t=e.type===ChatMessage.MESSAGE_TYPE.SERVICE?new ServiceMessageView(e):new ChatMessageView(e)
;this.container.addChild(t),this.messageViews[e.id]=t}}.bind(this));var e=cleverapps.UI.arrangeWithMargins(this.container.getChildren(),{margin:cleverapps.styles.ChatView.margin,direction:cleverapps.UI.TOP_TO_BOTTOM});e<this.scroll.height&&(e=this.scroll.height),this.container.setContentSize2(cc.director.getWinSize().width,e),this.scroll.updateInnerContent(),this.scroll.scrollToPercent(0)},removeTemporaryMessages:function(){Object.keys(this.messageViews).forEach(function(e){this.messageViews[e]&&this.messageViews[e].chatMessage&&this.messageViews[e].chatMessage.type===ChatMessage.MESSAGE_TYPE.TEMPORARY&&(this.messageViews[e].removeFromParent(),this.messageViews[e]=void 0)}.bind(this)),this.updateMessages()},onChangeSize:function(){var e=cleverapps.styles.ChatView,t="horizontal"!==cleverapps.config.orientation?cleverapps.styles.ChatInput.verticalHeight:cleverapps.styles.ChatInput.height,s=cc.director.getWinSize().height-cleverapps.styles.ChatHeader.height-t-e.extraHeight
;this.scroll.setContentSize2(cc.director.getWinSize().width,s),this.setContentSize2(this.scroll.getContentSize()),this.setPositionRound(e),this.chat.messages.forEach(function(e){this.messageViews[e.id]&&this.messageViews[e.id].onChangeSize()}.bind(this)),this.updateMessages()}});cleverapps.styles.ChatView={x:{align:"center"},y:{align:"top",dy:-128},margin:4,scrollBarPosition:{x:4,y:14},extraHeight:8};var ChatScene=cleverapps.FixedWidthScene.extend({ctor:function(e){this._super(cleverapps.Environment.SCENE_CHAT),this.windowsContainer=!0,this.chat=e;var t=new ChatHeader(this.chat);this.addChild(t);var s=new ChatView(this.chat);this.addChild(s);var i=new ChatInput(this.chat);this.addChild(i),cleverapps.placements.run(Placements.INTERMEDIATE),this.chat.hasUnread&&this.chat.markAsRead()},getBackgroundStyles:function(){return{pattern:bundles.chat.urls.window_bg}}});ChatScene.BUNDLES=function(){var e=["chat","reward_icons"];return"undefined"!=typeof match3&&e.push("heroes"),
"merge"===cleverapps.config.type&&e.push("episode_0"),e};var Toolbar=function(){this.items=[],this.freezed=!1,this.enabled=!1,this.onUpdateItemsListener=function(){},this.onAddItemListener=function(e){},this.onRemoveItemListener=function(e){},this.onEnableListener=function(){},this.addItem(new FriendRequestsToolbarItem),this.addItem(new PeriodicBonusToolbarItem),this.addItem(new DailyTasksToolbarItem),this.addItem(new LeaderBoardToolbarItem),RewardedAdsManager.IsEnabled()&&!cleverapps.flags.almostNoAds&&this.addItem(new RewardedVideoToolbarItem),this.updateItems()};Toolbar.prototype.anyItemWithForce=function(){for(var e=0;e<this.items.length;e++){var t=this.items[e].force;if(t&&this.items[e].isVisible()&&this.items[e].isForceEnabled()&&!cleverapps.forces.isShown(t.id))return this.items[e]}},Toolbar.prototype.showAnyForce=function(){var t=this.anyItemWithForce();cleverapps.metha.display({focus:"toolbarItemForce",control:"toolbar",actions:[function(e){setTimeout(e,500)},function(e){
this.onForceItem(),t.showForce(t.force),cleverapps.forces.onceForceClosed=e}.bind(this)]})},Toolbar.prototype.addItem=function(e){void 0===this.getItem(e.type)&&(this.items.push(e),this.items.sort(function(e,t){return e.type-t.type}),this.onAddItemListener(e),this.update())},Toolbar.prototype.hasVisibleItems=function(){return 0<this.items.filter(function(e){return e.isVisible()}).length},Toolbar.prototype.removeItem=function(e){0<=this.items.indexOf(e)&&(this.items.splice(this.items.indexOf(e),1),this.onRemoveItemListener(e)),this.update()},Toolbar.prototype.getItem=function(e){for(var t=0;t<this.items.length;++t)if(this.items[t].type===e)return this.items[t]},Toolbar.prototype.updateItems=function(e){this.freezed||(this.onUpdateItemsListener(e),this.update())},Toolbar.prototype.freezeUpdates=function(){this.freezed=!0},Toolbar.prototype.unfreezeUpdates=function(){this.freezed=!1,this.updateItems()},Toolbar.prototype.update=function(){this.hasVisibleItems()?this.enable():this.disable()
},Toolbar.prototype.enable=function(){this.enabled||(this.enabled=!0,this.onEnableListener(this.enabled))},Toolbar.prototype.disable=function(){this.enabled&&(this.enabled=!1,this.onEnableListener(this.enabled))};var ToolbarItem=function(e){cleverapps.extend(this,e),this.enabled=!1,this.marked=!1,this.onChangeStateListener=function(){},this.showForce=function(){}};ToolbarItem.prototype.isVisible=function(){return this.enabled},ToolbarItem.prototype.onClick=function(){this.unmark()},ToolbarItem.prototype.enable=function(){this.enabled||(this.enabled=!0,this.onChangeStateListener(),cleverapps.toolbar&&cleverapps.toolbar.updateItems())},ToolbarItem.prototype.isForceEnabled=function(){return!0},ToolbarItem.prototype.disable=function(){this.enabled&&(this.unmark(),this.enabled=!1,this.onChangeStateListener(),cleverapps.toolbar&&cleverapps.toolbar.updateItems())},ToolbarItem.prototype.mark=function(){this.marked||(this.marked=!0,this.onChangeStateListener())},
ToolbarItem.prototype.unmark=function(){this.marked&&(this.marked=!1,this.onChangeStateListener())},ToolbarItem.FRIEND_REQUESTS={type:0,icon:bundles.toolbar.frames.toolbar_mail_icon_png},ToolbarItem.BONUS_GAME={type:1,icon:bundles.toolbar.frames.toolbar_bonusround_icon_png,grayscaleDisabled:!0,force:Forces.BONUS_ROUND_FORCE},ToolbarItem.PERIODIC_BONUS={type:2,icon:bundles.toolbar.frames.toolbar_dailybonus_icon_png,countdown:!0,grayscaleDisabled:!0,force:Forces.PERIODIC_BONUS_FORCE},ToolbarItem.LEADER_BOARD={type:3,icon:bundles.toolbar.frames.toolbar_leader_board_icon_png},ToolbarItem.DAILY_TASKS={type:4,icon:bundles.toolbar.frames.toolbar_daily_tasks_icon_png,countdown:!0,force:Forces.DAILY_TASKS_FORCE},ToolbarItem.REWARDED_VIDEO={type:5,icon:bundles.toolbar.frames.toolbar_rewarded_video_icon_png};var BonusRoundToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.BONUS_GAME),cleverapps.bonusRoundChest.changeLockedListener=this.changeLocked.bind(this),this.changeLocked()}
;BonusRoundToolbarItem.prototype=Object.create(ToolbarItem.prototype),(BonusRoundToolbarItem.prototype.constructor=BonusRoundToolbarItem).prototype.isVisible=function(){return(void 0===typeof match3||!cleverapps.environment.isGameScene())&&(!!cleverapps.bonusRoundChest.isActive()&&this.enabled)},BonusRoundToolbarItem.prototype.changeLocked=function(){cleverapps.bonusRoundChest.locked?this.disable():(this.enable(),this.mark())},BonusRoundToolbarItem.prototype.onClick=function(){cleverapps.bonusRoundChest.locked?cleverapps.Notification.create("messages:BonusRound.ClosedText"):(this.unmark(),cleverapps.metha.display({focus:"BonusRoundWindow",action:function(e){cleverapps.bonusRoundChest.open(e)}}))};var PeriodicBonusToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.PERIODIC_BONUS),this.countdown=cleverapps.periodicBonus.countdown,cleverapps.periodicBonus.changeLockedListener=this.changeLocked.bind(this),this.changeLocked()};PeriodicBonusToolbarItem.prototype=Object.create(
ToolbarItem.prototype),(PeriodicBonusToolbarItem.prototype.constructor=PeriodicBonusToolbarItem).prototype.isVisible=function(){return levels.user.checkAvailable(cleverapps.MiniGame.AVAILABLE)},PeriodicBonusToolbarItem.prototype.unlock=function(){this.mark()},PeriodicBonusToolbarItem.prototype.changeLocked=function(){cleverapps.periodicBonus.locked?this.disable():(this.enable(),this.mark())},PeriodicBonusToolbarItem.prototype.onClick=function(){cleverapps.periodicBonus.locked?cleverapps.Notification.create(cleverapps.periodicBonus.closedText,{image:new cc.Sprite(this.icon)}):(this.unmark(),cleverapps.metha.display({focus:"MiniGameWindowFromToolbar",action:function(e){cleverapps.periodicBonus.openWindow(e)}}))};var FriendRequestsToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.FRIEND_REQUESTS),this.lastNotProceedId=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LAST_VIEWED_FRIEND_REQUEST,{raw:!0}),levels.friendRequests.onNewListener=function(){this.mark(),
cleverapps.toolbar.updateItems()}.bind(this),levels.friendRequests.onChangeListener=function(){levels.friendRequests.existNotProcessed()||(this.unmark(),cleverapps.toolbar.updateItems(!0))}.bind(this),this.enable(),this.mark()};FriendRequestsToolbarItem.prototype=Object.create(ToolbarItem.prototype),(FriendRequestsToolbarItem.prototype.constructor=FriendRequestsToolbarItem).prototype.mark=function(){if(0!==cleverapps.friends.listFriends().concat(cleverapps.invitalbleFriends.listFriends()).length){var e=levels.friendRequests.lastNotProcessedId();!1!==e&&e!==this.lastNotProceedId&&ToolbarItem.prototype.mark.apply(this)}},FriendRequestsToolbarItem.prototype.isVisible=function(){return levels.friendRequests.existNotProcessed()},FriendRequestsToolbarItem.prototype.onClick=function(){this.lastNotProceedId=levels.friendRequests.lastNotProcessedId(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LAST_VIEWED_FRIEND_REQUEST,this.lastNotProceedId,{raw:!0}),this.unmark(),
cleverapps.metha.display({focus:"FriendRequestsWindow",control:["MenuBarGoldItem","MenuBarLivesItem"],action:function(e){new FriendRequestsWindow,cleverapps.metha.onceNoWindowsListener=e}})};var LeaderBoardToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.LEADER_BOARD),this.enable()};LeaderBoardToolbarItem.prototype=Object.create(ToolbarItem.prototype),LeaderBoardToolbarItem.prototype.constructor=FriendRequestsToolbarItem,LeaderBoardToolbarItem.prototype.onClick=function(){cleverapps.social instanceof cleverapps.MobileVk?cleverapps.social.showLeaderBoardBox({userResult:levels.user.getHumanReadableNumber()},function(){}):cleverapps.metha.display({focus:"LeadersWindow",action:function(e){new LeadersWindow,cleverapps.metha.onceNoWindowsListener=e}})},LeaderBoardToolbarItem.prototype.isVisible=function(){return!cleverapps.flags.norest&&ToolbarItem.prototype.isVisible.call(this)&&levels.user.checkAvailable(cleverapps.Availables.LEADER_BOARD)};var RewardedVideoToolbarItem=function(){
ToolbarItem.call(this,ToolbarItem.REWARDED_VIDEO),cleverapps.config.debugMode&&(RewardedVideoToolbarItem.INTERVAL="20 seconds",RewardedVideoToolbarItem.START_PLAY_INTERVAL="10 seconds",RewardedVideoToolbarItem.CHECK_INTERVAL="10 seconds"),this.isAvailable()?this.enable():this.disable(),this.checkAvailable=setInterval(function(){!this.enabled&&this.isAvailable()&&this.enable()}.bind(this),cleverapps.parseInterval(RewardedVideoToolbarItem.CHECK_INTERVAL)),cleverapps.rewardedAdsManager.onStartPlayListeners[RewardedAdsManager.REWARDED+"_toolbar"]=this.startPlay.bind(this),cleverapps.rewardedAdsManager.onEndPlayListeners[RewardedAdsManager.REWARDED+"_toolbar"]=this.startPlay.bind(this)};RewardedVideoToolbarItem.prototype=Object.create(ToolbarItem.prototype),(RewardedVideoToolbarItem.prototype.constructor=RewardedVideoToolbarItem).prototype.enable=function(){this.enabled||(ToolbarItem.prototype.enable.apply(this),this.mark())},RewardedVideoToolbarItem.prototype.onClick=function(){
this.isAvailable()&&cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.reward.bind(this))},RewardedVideoToolbarItem.prototype.isVisible=function(){return ToolbarItem.prototype.isVisible.call(this)&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)},RewardedVideoToolbarItem.prototype.isAvailable=function(){return(cc.sys.localStorage.getItem(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR)||0)<Date.now()&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)},RewardedVideoToolbarItem.prototype.startPlay=function(){this.disabled||(cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR,Date.now()+cleverapps.parseInterval(RewardedVideoToolbarItem.START_PLAY_INTERVAL)),this.disable())},RewardedVideoToolbarItem.prototype.reward=function(){cleverapps.metha.displayWhenFreeFocus({focus:"RewardedAdToolbarReward",action:function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR_WINDOW_SHOW),new RewardWindow({
reward:{gold:RewardedVideoToolbarItem.REWARD.gold},callback:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR_WINDOW_CLOSE)}}),cleverapps.metha.onceNoWindowsListener=e}}),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.REWARDED_TOOLBAR,Date.now()+cleverapps.parseInterval(RewardedVideoToolbarItem.INTERVAL)),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.REWARDED_TOOLBAR)},RewardedVideoToolbarItem.REWARD={gold:10},RewardedVideoToolbarItem.INTERVAL="5 minutes",RewardedVideoToolbarItem.START_PLAY_INTERVAL="1 minute",RewardedVideoToolbarItem.CHECK_INTERVAL="30 seconds";var DailyTasksToolbarItem=function(){ToolbarItem.call(this,ToolbarItem.DAILY_TASKS),this.countdown=new cleverapps.CountDown(cleverapps.dailyTasks.getTimeLeft()),this.enable(),cleverapps.dailyTasks.onChangeStateListener=this.onChangeState.bind(this),this.onChangeState()};DailyTasksToolbarItem.prototype=Object.create(ToolbarItem.prototype),(
DailyTasksToolbarItem.prototype.constructor=DailyTasksToolbarItem).prototype.onChangeState=function(){0<cleverapps.dailyTasks.getNotCollectedTasks().length||!cleverapps.dailyTasks.isRunning()?this.mark():this.unmark(),this.countdown.resetTimeLeft(cleverapps.dailyTasks.getTimeLeft()),this.countdown.nextSecond(Date.now())},DailyTasksToolbarItem.prototype.isVisible=function(){return levels.user.checkAvailable(cleverapps.Availables.DAILY_TASKS)},DailyTasksToolbarItem.prototype.onClick=function(){cleverapps.metha.display({focus:"DailyTasksWindow",action:function(e){new DailyTasksWindow,cleverapps.metha.onceNoWindowsListener=e}})};var ToolbarView=cc.Node.extend({ctor:function(e){this._super(),this.toolbar=cleverapps.toolbar,this.toolbar.update();var t=cleverapps.styles.ToolbarView;this.setAnchorPoint2(),this.height=t.bg.height,this.createBg(),this.itemsViews=[],this.toolbar.items.forEach(function(e){var t=new ToolbarItemView(e);this.itemsViews.push(t),this.addChild(t)}.bind(this)),
this.setPositionRound(t.position),this.deltaY=cleverapps.UI.getSceneOffsetY(),this.alignment=cleverapps.clone(this.alignment,!0),this.alignment.y.dy-=this.deltaY,e.addChild(this),this.hidePosition=cc.p(this.x,this.y-2*this.height),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL)},createBg:function(){bundles.toolbar.frames.toolbar_bg_png?this.bg=new cc.Scale9Sprite(bundles.toolbar.frames.toolbar_bg_png):(this.bg=new cc.Node,this.bg.setAnchorPoint2()),this.addChild(this.bg),this.bg.height=this.height,this.bg.setPositionRound(this.width/2,this.height/2)},onEnter:function(){this._super(),this.toolbar.onAddItemListener=this.createListener(this.addItem.bind(this)),this.toolbar.onRemoveItemListener=this.createListener(this.removeItem.bind(this)),this.toolbar.onUpdateItemsListener=this.createListener(this.updateItems.bind(this)),this.toolbar.onEnableListener=this.createListener(this.updateEnabled.bind(this)),this.toolbar.onForceItem=this.createListener(this.onForceItem.bind(this)),
this.updateItems(!0),this.hide(!0),this.updateEnabled(this.toolbar.enabled),cleverapps.metha.registerControl("toolbar",this.createListener(function(e){this.stopAllActions(),e?this.toolbar.enabled&&this.show():this.hide()}.bind(this)))},onForceItem:function(){this.show(!0)},addItem:function(e){var t=new(e.getViewClass())(e);this.addChild(t),this.itemsViews.push(t),this.itemsViews.sort(function(e,t){return e.toolbarItem.type-t.toolbarItem.type}),this.updateItems()},removeItem:function(t){var e=this.itemsViews.filter(function(e){return e.toolbarItem===t});e&&(this.itemsViews.splice(this.itemsViews.indexOf(e),1),e.removeFromParent(),this.updateItems())},updateItems:function(i){var e=cleverapps.styles.ToolbarView,n=[],o=[],r=[],a=0;this.itemsViews.forEach(function(e){var t=e.visible;t&&a++;var s=e.toolbarItem.isVisible();s!==t&&(o.push(e),s?e.setVisible(!0):i?e.setVisible(!1):(r.push(e),e.stopAllActions(),e.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.CallFunc(function(){
e.setVisible(!1),e.setScale(1)}))))),s&&n.push(e)}.bind(this));var c=(n.length-1)*e.margin;n.forEach(function(e){e.baseScaleX=1,c+=e.width});var t=0;0<n.length&&(t=cleverapps.UI.arrangeWithMargins(n,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,y:this.height/2+e.items.dy,iterator:function(e,t,s){t-=c/2,i?(e.scale=1,e.setPositionRound(t,s)):(-1!==o.indexOf(e)&&(e.scale=0,e.setPositionRound(t,s)),e.stopAllActions(),e.runAction(new cc.Spawn(new cc.ScaleTo(.6,1).easing(new cc.easeBackOut(.05)),new cc.MoveTo(.6,cc.p(t,s)))))}})),this.updateBg(t,a,n.length,i)},updateBg:function(e,t,s,i){this.bg.stopAllActions(),i||t<s?this._updateBg(e):this.bg.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(this._updateBg.bind(this,e))))},_updateBg:function(e){var t=cleverapps.styles.ToolbarView;this.bg.width=e+2*t.margin+2*t.bg.padding,this.bg.setPositionRound(this.width/2,this.height/2),this.setScale(this.bg.width>cc.director.getWinSize().width?cc.director.getWinSize(
).width/this.bg.width:1),this.decors&&(this.decors.forEach(function(e){e.removeFromParent()}),delete this.decors),this.decors=SceneDecors.add(this.bg,cleverapps.skins.getSlot("toolbarDecors"))},updateEnabled:function(e){this.stopAllActions(),e&&0===cleverapps.windows.list.length?(this.hide(!0),this.show()):this.hide()}});cleverapps.styles.ToolbarView={position:{x:{align:"center",dx:0},y:{align:"bottom",dy:0}},bg:{height:115,padding:0},hover:{margin:6},items:{dy:0},margin:30};var ToolbarItemCountdownView=cleverapps.CountDownView.extend({ctor:function(e){var t=cleverapps.overrideStyles(cleverapps.styles.ToolbarItemView.countdownView,{font:cleverapps.styles.FONTS.TOOLBAR_ITEM_TIMER_TEXT},!0);if(t.scale9){var s=new cc.Scale9Sprite(t.background_image);s.setContentSize2(t.bg.width,t.bg.height),t.background_content=s}this._super(e,t)},refresh:function(){this._super(),this.visible=0<this.countDown.getTimeLeft()},whatToDoOnStop:function(){this.countDown.onSecond=function(){}}}),
ToolbarItemView=cc.Node.extend({ctor:function(e){this._super(),this.toolbarItem=e;var t=cleverapps.styles.ToolbarItemView;this.shakeTimeout=new cc.Node,this.addChild(this.shakeTimeout),this.hideTimeout=new cc.Node,this.addChild(this.hideTimeout);var s=new cc.Sprite(this.toolbarItem.icon);s.setAnchorPoint2(),this.addChild(s),this.icon=s,this.setContentSize2(this.icon.getContentSize()),this.setAnchorPoint2(),this.icon.setPositionRound(t.icon);var i=new cc.Sprite(t.mark.icon);i.setAnchorPoint2(),this.addChild(i),i.setPositionRound(t.mark),(this.mark=i).runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1)))),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),cleverapps.forces.isRunningForce()&&(this.toolbarItem.countdown&&this.addTimerView(),cleverapps.forces.closeRunningForce()),this.toolbarItem.onClick()}.bind(this)),this.toolbarItem.countdown&&this.addTimerView()},
showForce:function(e){cleverapps.forces.create(this,e)},addTimerView:function(){this.timerView&&(this.timerView.removeFromParent(),delete this.timerView);var e=cleverapps.styles.ToolbarItemView.timer,t=new ToolbarItemCountdownView(this.toolbarItem.countdown);t.setPosition(this.width/2+e.offsetX,this.height/2+e.offsetY),t.setScale(e.scale),this.addChild(t),this.timerView=t},onEnter:function(){this._super(),this.toolbarItem.onChangeStateListener=this.createListener(this.onChangeState.bind(this)),this.toolbarItem.showForce=this.createListener(this.showForce.bind(this)),this.onChangeState()},grayscale:function(){this.icon.setColor(this.toolbarItem.enabled?cleverapps.styles.COLORS.GRAY_SCALE_RESTORE_COLOR:cleverapps.styles.COLORS.GRAY_SCALE_COLOR),this.toolbarItem.countdown&&(this.timerView.setVisible(!this.toolbarItem.enabled),this.timerView.refresh())},onChangeState:function(){if(this.toolbarItem.grayscaleDisabled&&this.grayscale(),this.mark.setVisible(this.toolbarItem.marked),
this.toolbarItem.marked){var e=Math.floor(8*Math.random())+8;this.shake(e)}},shake:function(e){if(this.toolbarItem.marked&&!this.shakeRunned){this.shakeRunned=!0;var t=function(){this.toolbarItem.marked&&this.parent.visible&&(cleverapps.audio.playSound(bundles.main.urls.icon_jump_effect),this.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2,.8),new cc.Spawn(new cc.ScaleTo(.2,1,1),new cc.MoveBy(.2,0,150)),new cc.MoveBy(.2,0,-150),new cc.MoveBy(.1,0,30),new cc.MoveBy(.1,0,-30),new cc.CallFunc(function(){this.shakeRunned=!1,this.shake(Math.floor(8*Math.random())+8)}.bind(this)))))}.bind(this);this.shakeTimeout.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(t)))}},onMouseOver:function(){this.toolbarItem.enabled&&this.setScale(1.05*this.baseScale||1.05)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{TOOLBAR_ITEM_TIMER_TEXT:{name:"default",size:40}}),cleverapps.styles.ToolbarItemView={timer:{offsetY:-10,offsetX:0,scale:.6},icon:{x:{align:"center"},y:{align:"center"}},
mark:{icon:bundles.toolbar.frames.toolbar_attention_icon_png,x:{align:"center",dx:-30},y:{align:"center",dy:30}},countdownView:{background_image:bundles.main.frames.timer_bg_png,timerPosition:{x:0,y:0}}},cleverapps.FBLoginOrInvite=function(){if(cleverapps.social.isInitialized()&&!cleverapps.flags.nologin){var e=!1;if((cleverapps.social.isLoggedIn()||cleverapps.social.nativeInviteFriends)&&(e=!0),!e||!cleverapps.flags.noviral){var t=cleverapps.styles.FBLoginOrInvite,s=new cc.Node;s.setAnchorPoint2();var i=s.createListener(function(){var e=cleverapps.social.isLoggedIn()?cleverapps.EVENTS.FBLOGINORINVITE_INVITE:cleverapps.EVENTS.FBLOGINORINVITE_LOGIN;cleverapps.eventLogger.logEvent(e),s.removeFromParent(!0)}),n=new FbButton({showIcon:!1,onSuccess:i});s.setContentSize2(n.getContentSize());var o=cleverapps.UI.getSceneSize();if(s.setPosition(o.width/2+t.x,n.height/2+cleverapps.UI.getSceneOffsetY()+t.y),s.addChild(n),n.setPositionRound(s.width/2,s.height/2),n.onMouseOver=function(){},
n.onMouseOut=function(){},t.images.avatars){var r=new cleverapps.UI.Avatar({avatar:bundles.main.frames.default_avatar,frame:bundles.avatar.frames.avatar_frame2});r.setScale(t.images.avatars.scale),r.setPositionRound(t.images.avatars.right.x,t.images.avatars.right.y,s.getContentSize()),r.setRotation(t.images.avatars.right.rotation),s.addChild(r);var a=new cleverapps.UI.Avatar({avatar:bundles.main.frames.default_avatar,frame:bundles.avatar.frames.avatar_frame2});a.setScale(t.images.avatars.scale),a.setPositionRound(t.images.avatars.left.x,t.images.avatars.left.y,s.getContentSize()),a.setRotation(t.images.avatars.left.rotation),s.addChild(a)}var c=cleverapps.UI.generateTTFText(e?"messages:FBLoginOrInvite.invite":"messages:FBLoginOrInvite.login",cleverapps.styles.FONTS.FBLOGINORINVITE_TEXT);return c.setPosition(s.width/2+t.text.offsetX,s.height+t.text.offsetY),c.fitTo(t.text.width),s.addChild(c),s.setScale(0),s.runAction(new cc.Sequence(new cc.ScaleTo(.5,1).easing(new cc.easeBackOut),
new cc.CallFunc(function(){cleverapps.UI.applyHover(s)}))),c.setOpacity(0),c.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.FadeIn(.5))),s.setLocalZOrder(5),s}}},cleverapps.styles.FBLoginOrInvite={y:4,x:40,images:{avatars:{scale:.7,left:{x:{align:"left",dx:-70},y:{align:"center"},rotation:-7},right:{x:{align:"left",dx:-40},y:{align:"center",dy:5},rotation:13}}},text:{offsetX:-40,offsetY:26,width:700}},cleverapps.Row=cc.Scale9Sprite.extend({getStyles:function(){return cleverapps.styles.Row},getMaxTextLength:function(){return 12},ctor:function(e){var t,s=this.getStyles();e.player&&(this.player=!0),this.notInTop=e.notInTop,this.clickableArea=e.clickableArea,e.player?t=s.you_bg:(t=s.bg,(e.place-1)%2==1&&s.bg2&&(t=s.bg2));var i=new cc.Sprite(t);this._super(i.getSpriteFrame()),this.setContentSize2(s.size),this.updatePlace(e.place,!0);var n=new cleverapps.UI.Avatar(e.avatar);n.setPosition(s.avatar.position.x,s.avatar.position.y+this.height/2),n.setScale(s.avatar.scale),this.addChild(n)
;var o=e.text||"";if(o||"string"!=typeof e.id||(o="Player_"+e.id.substr(-3)),o.length>this.getMaxTextLength()){var r=(o=o.replace(/^[\s]+/,"")).lastIndexOf(" ",this.getMaxTextLength());r<=0&&(r=this.getMaxTextLength()),o=o.substr(0,r)}var a=cleverapps.UI.generateTTFText(o,e.player?cleverapps.styles.FONTS.ROW_PLAYER_TEXT||s.text.playerFont:cleverapps.styles.FONTS.ROW_TEXT||s.text.font);s.text.width&&a.fitTo(s.text.width),a.setPosition(s.text.x,s.text.y+this.height/2),this.addChild(a),this.generateData(e)},updateParams:function(e){this.notInTop=e.notInTop},generateDataBg:function(e){var t,s=this.getStyles();if(s.data.bg){var i=e.player&&s.data.bgYou?s.data.bgYou:s.data.bg;t=new cc.Scale9Sprite(new cc.Sprite(i).getSpriteFrame())}else(t=new cc.Node).setAnchorPoint2();return this.addChild(t),t.setContentSize2(s.data.size),t.setPosition(s.data.position.x,s.data.position.y+this.height/2),t},generateDataContent:function(e,t){var s=this.getStyles(),i=t.dataIcon||s.data.icon;if(i){
var n=new cc.Sprite(i);n.setPosition(s.data.iconPosition.x,s.data.iconPosition.y+e.height/2),n.setScale(s.data.scale),n.setRotation(s.data.rotation),e.addChild(n)}this.dataAmount=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.ROW_DATA_TEXT||s.data.amount.font),this.dataAmount.baseScale=this.dataAmount.scale,this.dataAmount.setPosition(s.data.amount.x,e.height/2+s.data.amount.y),e.addChild(this.dataAmount),this.updateAmount(t.amount,!0)},generateData:function(e){this.getStyles();var t=this.generateDataBg(e);this.getTooltipText()&&cleverapps.tooltipManager.create(t,{text:this.getTooltipText(),position:cleverapps.styles.UI.Tooltip.LOCATION.below,clickableArea:this.clickableArea}),this.generateDataContent(t,e)},getTooltipText:function(){return""},updatePlace:function(e,t){this.currentPlace!==e&&(this.currentPlace=e,this.refreshPlace(this.currentPlace,t),this.refreshReward(this.currentPlace,t))},updateAmount:function(e,t){var s=this.getStyles();this.currentAmount!==e&&(
this.currentAmount=e,this.dataAmount.stopAllActions(),this.dataAmount.setScale(this.dataAmount.baseScale),this.dataAmount.setString(this.currentAmount),this.dataAmount.fitTo(s.data.amount.width,s.data.amount.height),this.dataAmount.baseScale=this.dataAmount.scale,t||this.dataAmount.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5*this.dataAmount.baseScale),new cc.ScaleTo(.2,this.dataAmount.baseScale))))},refreshReward:function(e){var t=this.getStyles();t.reward&&(this.reward&&this.reward.removeFromParent(!0),this.reward=this.generatePrizeBanner(e),this.reward&&(this.reward.setPosition(t.reward.x,t.reward.y+this.height/2),this.addChild(this.reward)))},refreshPlace:function(e){var t=this.getStyles();this.place&&this.place.removeFromParent(!0),this.place=this.generatePlaceBadge(e),this.place.setPosition(t.place.x,this.place.y+t.place.y+this.height/2),this.addChild(this.place)},generatePlaceBadge:function(e){var t=this.getStyles(),s=this.player?t.place.playerFont:t.place.font;if(!(
t=t.placeBadges)||e>t.icons.length)return this.generatePlaceText(e,s);var i=new cc.Sprite(t.icons[e-1]);return i.setPositionRound(t.x,t.y),i},generatePlaceText:function(e,t){var s=e;return this.notInTop&&(s="-"),cleverapps.UI.generateTTFText(s,t)},generatePrizeBanner:function(e){var t=this.getStyles();if(t.prizes&&!(e>(t=t.prizes).length)){t=t[e-1];var s=new cc.Node;if(t.banner){var i=new cc.Sprite(t.banner);s.addChild(i)}if(t.icon){var n=new cc.Sprite(t.icon);n.setScale(t.scale),s.addChild(n),n.setPosition(0,t.y);var o=new cc.Node;o.setContentSize2(n.getContentSize()),o.setAnchorPoint2(),s.addChild(o);var r=Messages.get("PrizeTooltip");this.currentPlace&&this.currentPlace<=5&&(r=Messages.get("Cup"+this.currentPlace+"PlaceTooltip")),this.addPrizeBannerTooltip(r,o)}return s}},getRewards:function(){},addPrizeBannerTooltip:function(e,t){cleverapps.tooltipManager.create(t,{rewards:this.getRewards(),text:e,position:cleverapps.styles.UI.Tooltip.LOCATION.above,clickableArea:this.clickableArea
})}}),cleverapps.styles.Row={bg:bundles.main.frames.row_player_png,bg2:bundles.main.frames.row_player_2_png,you_bg:bundles.main.frames.row_you_png,size:{width:680,height:70},placeBadges:{x:0,y:8,icons:[bundles.main.frames.levelstart_cup_1,bundles.main.frames.levelstart_cup_2,bundles.main.frames.levelstart_cup_3]},place:{x:56,y:0,font:cleverapps.styles.FONTS.TEXT,playerFont:cleverapps.styles.FONTS.WHITE_TEXT},avatar:{scale:.5,position:{x:150,y:0}},text:{x:290,y:-4,font:cleverapps.styles.FONTS.SMALL_TEXT,playerFont:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,width:200},reward:{x:464,y:-4},prizes:[{banner:bundles.main.frames.red_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.85,y:6},{banner:bundles.main.frames.blue_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.8,y:6},{banner:bundles.main.frames.green_banner_png,icon:bundles.menubar.frames.star_chest_icon_png,scale:.75,y:6},{icon:bundles.menubar.frames.star_chest_icon_png,scale:.7,y:6},{
icon:bundles.menubar.frames.star_chest_icon_png,scale:.7,y:6}],data:{size:{width:140,height:60},bg:bundles.main.frames.light_bg_png,scale:.5,rotation:-10,iconPosition:{x:32,y:0},position:{x:604,y:0},amount:{x:100,y:0,font:cleverapps.styles.FONTS.WHITE_TEXT}}},cleverapps.LeadersRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.LeadersRow},getMaxTextLength:function(){return 16}}),cleverapps.styles.LeadersRow={bg:bundles.main.frames.row_player_png,you_bg:bundles.main.frames.row_you_png,size:{width:680,height:70},badgeY:8,place:{x:56,y:0,font:cleverapps.styles.FONTS.TEXT,playerFont:cleverapps.styles.FONTS.WHITE_TEXT},placeBadges:{x:0,y:8,icons:[bundles.main.frames.levelstart_cup_1,bundles.main.frames.levelstart_cup_2,bundles.main.frames.levelstart_cup_3]},avatar:{scale:.5,position:{x:150,y:0}},text:{x:360,y:-4,font:cleverapps.styles.FONTS.SMALL_TEXT,playerFont:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,width:280},data:{size:{width:140,height:60},
bg:bundles.main.frames.light_bg_png,position:{x:604,y:0},amount:{x:70,y:0,font:cleverapps.styles.FONTS.WHITE_TEXT}}},cleverapps.MissionRow=cleverapps.Row.extend({getRewards:function(){var e=cleverapps.clone(RewardsConfig.Tournament.places[this.currentPlace-1],!0);return RewardsConfig.Tournament.prepareByRich&&(e=cleverapps.user.prepareRewardByRich(e)),e},getTooltipText:function(){return Messages.get("ResultTooltip")}}),cleverapps.DailyCupRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.DailyCupRow},getRewards:function(){return cleverapps.dailyCup.data.rewards[this.currentPlace-1]},getTooltipText:function(){return Messages.get("ResultTooltip")}}),cleverapps.styles.DailyCupRow=cleverapps.overrideStyles(cleverapps.styles.Row,{data:{icon:bundles.main.frames.stars_star,scale:.4,rotation:0}},!0),function(){cleverapps.styles.DailyCupRow.prizes=[];for(var e=[.85,.8,.7],t=[bundles.main.frames.red_banner_png,bundles.main.frames.blue_banner_png,
bundles.main.frames.green_banner_png],s=0;s<3;s++)cleverapps.styles.DailyCupRow.prizes[s]={banner:t[s],icon:bundles.menubar.frames.star_chest_icon_png,iconBet:bundles.menubar.frames.star_chest_icon_png,scale:e[s],y:6};for(s=3;s<10;s++)cleverapps.styles.DailyCupRow.prizes[s]={icon:bundles.reward_icons.frames.life_unlim_small,iconBet:bundles.reward_icons.frames.gold_small_png,scale:1,y:6}}(),cleverapps.DailyCupLeadersRow=cleverapps.Row.extend({getStyles:function(){return cleverapps.styles.DailyCupLeadersRow},generateMedalAmount:function(e,t){var s=this.getStyles(),i=new cc.Sprite(bundles.daily_cup.frames["place_badge_"+e]||bundles.main.frames["levelstart_cup_"+e]);i.setScale(s.medal.scale);var n=cleverapps.UI.generateImageText(t,cleverapps.styles.FONTS.DAILY_CUP_LEADERS_ROW_AMOUNT||cleverapps.styles.FONTS.SMALL_WHITE_TEXT);n.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.fitTo(s.medal.width);var o=new cc.Node;return o.setAnchorPoint2(),o.setContentSize2(s.medal.width,n.height),
o.addChild(n),n.setPositionRound(n.width/2*n.scale,n.height/2),new cleverapps.Layout([i,o],{direction:cleverapps.UI.HORIZONTAL,margin:s.medal.iconMargin})},generateDataContent:function(e,t){var s=this.getStyles(),i=[];i.push(this.generateMedalAmount(1,t.firstPlace)),i.push(this.generateMedalAmount(2,t.secondPlace)),i.push(this.generateMedalAmount(3,t.thirdPlace));var n=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:s.medal.margin});e.addChild(n),n.setPositionRound(e.width/2,e.height/2)}}),cleverapps.styles.DailyCupLeadersRow=cleverapps.overrideStyles(cleverapps.styles.Row,{prizes:[],placeBadges:void 0,medal:{scale:.5,width:50,iconMargin:2,margin:4},place:{x:36},avatar:{position:{x:96}},text:{x:240},data:{size:{width:320,height:60},position:{x:514,y:0}}},!0),cleverapps.Table=function(){this.results={}},cleverapps.Table.prototype.updateResults=function(e,t){this.results[e]=[];for(var s=0;s<t.length;s++)this.results[e].push(cleverapps.clone(t[s]))},
cleverapps.Table.prototype.resetResults=function(e){this.results[e]=void 0},cleverapps.Table.prototype.getResults=function(e){return this.results[e]},cleverapps.Table.prototype.createTableView=function(e){var t=new cleverapps.TableView(e.data,this.results[e.id],e.rowConstructor,e.dataIcon,e.options);return this.updateResults(e.id,e.data),t},cleverapps.TableView=cc.Node.extend({setupRowPosition:function(e,t,s){var i=function(){e.view.currentPlace===e.data.place&&e.data.place>this.amountRows?(e.view.removeFromParent(),delete this.rows[e.data.id]):this.scroll&&this.setRowVisibility(e),s&&s()}.bind(this);t=this.amountRows-t;var n=cc.p(this.styles.innerPadding,this.styles.innerPadding+(this.styles.margin+e.view.height)*t+e.view.height/2);e.view.setLocalZOrder(t),s&&(this.isVisiblePosition(e.view.y,e.view.height)||this.isVisiblePosition(n.y,e.view.height))?e.view.runAction(new cc.Sequence(new cc.MoveTo(.2,n),new cc.CallFunc(i))):(e.view.setPositionRound(n),i())},isVisiblePosition:function(e,
t){return e-=this.scroll.innerContent.height/2,-this.scroll.innerContent.y-this.scroll.height/2-t/2<=e&&e<=-this.scroll.innerContent.y+this.scroll.height/2+t/2},finishAnimation:function(){this.inSwapAnimation--,0===this.inSwapAnimation&&this.swapIfNeed()},startAnimation:function(e){e||(e=1),this.inSwapAnimation+=e},swapPairIfNeed:function(e,t){var s,i=e.view.currentPlace,n=t.view.currentPlace;this.startAnimation(2),e.view.updatePlace(n),t.view.updatePlace(i),this.setupRowPosition(e,n,this.finishAnimation.bind(this)),this.setupRowPosition(t,i,this.finishAnimation.bind(this)),e.data.player?s=this.rows[t.id]?t.view:e.view:t.data.player&&(s=this.rows[e.id]?e.view:t.view),s&&this.scroll.scrollToMakeNodeVisible(s,.2,{easing:cc.easeInOut(1),visibleBox:{top:.8,bottom:.8}})},findRowWithPlace:function(e){for(var t in this.rows)if(this.rows[t].view.currentPlace===e)return this.rows[t];return!1},swapIfNeed:function(){if(0===this.inSwapAnimation){var e,t,s=this.amountRows+2;for(t in this.rows
)this.rows[t].view.currentPlace>this.rows[t].data.place&&this.rows[t].data.place<s&&(s=this.rows[t].data.place,e=this.rows[t]);for(t in e&&this.swapPairIfNeed(this.findRowWithPlace(e.view.currentPlace-1),e),this.rows)this.rows[t].data.place<=s&&this.rows[t].view.updateAmount(this.rows[t].data.amount)}},setRowVisibility:function(e){e&&e.view&&e.view.setVisible(this.isVisiblePosition(e.view.y,e.view.height))},setRowsVisibility:function(){for(var e in this.rows)this.setRowVisibility(this.rows[e])},cloneResults:function(e){var t,s=[];for(t=0;t<e.length;t++)s.push(cleverapps.clone(e[t]));return s},updateResults:function(e){if(this.amountRows!==e.length)return!1;var t,s=this.cloneResults(e),i=this.amountRows+1;for(t in this.rows)this.rows[t].data.place=i;for(t=0;t<s.length;t++)if(this.rows[s[t].id])this.rows[s[t].id].data=s[t],this.rows[s[t].id].view.updateParams(s[t]);else{this.dataIcon&&(s[t].dataIcon=this.dataIcon);var n=cleverapps.clone(s[t]);n.place=i,this.rows[s[t].id]={
view:new this.rowConstructor(n),data:s[t]},this.rows[s[t].id].view.setAnchorPoint2(0,.5),this.node.addChild(this.rows[s[t].id].view),this.setupRowPosition(this.rows[s[t].id],n.place)}return this.swapIfNeed(),!0},findPlayerView:function(){for(var e in this.rows)if(this.rows[e].data.player)return this.rows[e].view},ctor:function(e,t,s,i,n){var o;for(n=n||{},this.rows={},this.amountRows=0,this.inSwapAnimation=0,this.startAnimation(),t&&e.length!==t.length&&(t=void 0),e=this.cloneResults(e),t||(t=e),t=this.cloneResults(t),s||(s=cleverapps.Row),this.rowConstructor=s,this.dataIcon=i,o=0;o<t.length;o++)this.dataIcon&&(t[o].dataIcon=this.dataIcon),(t[o].clickableArea=this).rows[t[o].id]={view:new this.rowConstructor(t[o]),data:t[o]},this.amountRows++;var r=cleverapps.styles.TableView;n.styles&&(r=cleverapps.overrideStyles(r,n.styles,!0)),this.styles=r,this._super(),this.setAnchorPoint2();var a=this.node=new cc.Node;a.setAnchorPoint2();var c=this.styles.width,l=0;for(o in this.rows
)this.rows[o].view.setAnchorPoint2(0,.5),a.addChild(this.rows[o].view),c=this.rows[o].view.width,l=this.rows[o].view.height,this.setupRowPosition(this.rows[o],this.rows[o].data.place);l=this.amountRows*l+(this.amountRows-1)*r.margin+2*r.innerPadding,a.setContentSize2(c+2*r.innerPadding,l);var p=0,d=r.height+2*r.innerPadding;l<=d&&(p=d-l),this.scroll=new cleverapps.UI.ScrollView(a,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,containerMovedListener:this.createListener(this.setRowsVisibility.bind(this))}),this.scroll.setContentSize2(a.width,0===p?d:l+1),this.scroll.setBarPadding(r.barPadding),0===p&&this.scroll.scrollTo(this.findPlayerView()),this.scroll.setAnchorPoint2(0,0),this.scroll.setPosition(r.padding,r.padding+p),this.setContentSize2(this.scroll.width+2*r.padding,d+2*r.padding),this.addChild(this.scroll),r.bg&&(this.bg=new cc.Scale9Sprite(r.bg),this.addChild(this.bg),this.bg.setContentSize2(this.getContentSize()),this.bg.setPositionRound(this.width/2,
this.height/2),this.bg.setLocalZOrder(-1)),this.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(this.finishAnimation.bind(this)))),this.updateResults(e),this.setRowsVisibility()}}),cleverapps.styles.TableView={bg:bundles.main.frames.light_bg_png,width:500,height:732,margin:4,padding:6,innerPadding:6,barPadding:{cornerPadding:20,sidePadding:5}};var DialoguePersonTitleView=cc.Scale9Sprite.extend({ctor:function(){var e=cleverapps.styles.DialoguePersonTitleView;this._super(e.image),this.originalSize=this.getContentSize();var t=this.titleText=cleverapps.UI.generateOnlyText("",cleverapps.styles.FONTS.DIALOGUE_PERSON_TITLE_TEXT);t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(t),this.setAnchorPoint2(),this.setCascadeOpacityEnabled(!0),this.setOpacity(0),this.setVisible(!1)},updateString:function(e){var t=cleverapps.styles.DialoguePersonTitleView.text,s=this.titleText;s.setString(e),s.setFontSize(cleverapps.styles.FONTS.DIALOGUE_PERSON_TITLE_TEXT.size),
this.setContentSize2(Math.max(s.width+2*t.padding.x,this.originalSize.width),Math.max(s.height+2*t.padding.y,this.originalSize.height)),s.setPositionRound(this.width/2,this.height/2+t.offset.y)},updatePosition:function(e){var t=cleverapps.styles.DialoguePersonTitleView,s=e.x,i=t.offsetX;s-this.width/2-i<0&&(s=this.width/2+i),s+this.width/2+i>this.parent.width&&(s=this.parent.width-this.width/2-i),this.setPositionRound(s,t.y)},update:function(e,t){this.visible?this.isLeft===t.isLeft&&this.title===e||this.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.CallFunc(function(){this.updateString(e),this.updatePosition(t.hideHandler.originalPosition)}.bind(this)),new cc.FadeIn(.2))):(this.updateString(e),this.updatePosition(t.hideHandler.originalPosition),this.setVisible(!0),this.runAction(new cc.FadeIn(.2))),this.isLeft=t.isLeft,this.title=e},hide:function(){this.visible&&this.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.CallFunc(function(){this.setVisible(!1)}.bind(this))))}})
;cleverapps.styles.DialoguePersonTitleView={image:bundles.dialogues.frames.dialogue_name,offsetX:0,y:{align:"top",anchor:"center",dy:0},text:{padding:{x:5,y:0},offset:{y:-3}}};var DialoguePersonView=cc.Node.extend({ctor:function(e,t){this._super(),this.isLeft="right"!==e.position,this.setCascadeColorEnabled(!0),this.setAnchorPoint2(.5,0),this.setContentSize2(e.styles);var s=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&void 0!==e.styles.mobileOffsetX?e.styles.mobileOffsetX:e.styles.offsetX,i=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&void 0!==e.styles.mobileOffsetY?e.styles.mobileOffsetY:e.styles.offsetY;this.setPositionRound(this.isLeft?this.width/2*this.scale+s:t.width-(this.width/2*Math.abs(this.scaleX)+s),t.height+i);var n=this.personAnimation=new cleverapps.Spine(e.styles.json);n.setAnchorPoint2(.5,0),n.setPositionRound(e.styles.jsonPos),this.addChild(n),cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),t.addChild(this,-1),
cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?this.setScale(e.styles.mobileScale||cleverapps.styles.DialoguePersonView.mobileScale):this.setScale(e.styles.scale||cleverapps.styles.DialoguePersonView.scale),this.isLeft||0<this.scaleX&&this.setScaleX(-this.scaleX),this.update(e,!0)},update:function(e,t){var s=cleverapps.styles.DialoguePersonView,i=!!this.curState,n=this.curState=e.active;this.setColor(n?cleverapps.styles.COLORS.WHITE:s.tintColor),t&&s.animateCharChange?(this.hide(!0),this.show(!1,.2),n||this.personAnimation.setScale(s.inactive.scale)):i!==this.curState&&(n?(this.personAnimation.setScale(s.inactive.scale),this.personAnimation.runAction(new cc.ScaleTo(.1,1))):this.personAnimation.runAction(new cc.ScaleTo(.1,s.inactive.scale)));var o=e.animation,r=e.idleAnimation?e.idleAnimation:o;this.isSpeaking=n,this.personAnimation.setAnimation(0,n?o:r,!1),this.personAnimation.setCompleteListener(function(){this.personAnimation.setAnimation(0,this.isSpeaking?o:r,!1)}.bind(this
))},finishSpeaking:function(){this.isSpeaking=!1},remove:function(){cleverapps.styles.DialoguePersonView.animateCharChange?(this.hide(),this.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.RemoveSelf))):this.runAction(new cc.RemoveSelf)}});cleverapps.styles.DialoguePersonView={zOrder:-1,mobileScale:.9,scale:1,inactive:{scale:.8},tintColor:new cc.Color(180,180,180),animateCharChange:!1};var DialogueView=Window.extend({onWindowLoaded:function(e,t){this.options=t||{},this.options.button=this.options.button||{},this.dialogue=e,this.dialogueStyles=this.options.styles||cleverapps.styles.DialogueView;var s=cleverapps.overrideStyles(cleverapps.styles.Window,this.dialogueStyles.Window,!0);s.shadow=this.options.overlay&&!1!==this.options.shadow,s.bgOffset={x:0,y:this.calcYOffset()},this._super({name:"DialogueViewWindow",content:this.generateContent(),closeButton:!1,closeByBackButton:!1,noBackground:!0,notCloseByTouchInShadow:!0,minHeight:this.dialogueStyles.height,styles:s}),
this.startPosition=new cc.p(cleverapps.UI.getSceneSize().width/2,-this.content.height/2-this.dialogueStyles.showUp.y),this.finalPosition=new cc.p(cleverapps.UI.getSceneSize().width/2,this.content.height/2+this.dialogueStyles.offsetY),this.dialogue.options.showUp||this.content.setPositionRound(this.finalPosition),e.on("showUp",this.showUp.bind(this),this),e.on("showPerson",this.showPerson.bind(this),this),e.on("hidePerson",this.hidePerson.bind(this),this),e.on("updatePerson",this.updatePerson.bind(this),this),e.on("updatePersonTitle",this.updatePersonTitle.bind(this),this),e.on("changeText",this.changeText.bind(this),this),e.on("updateButton",this.updateButton.bind(this),this),e.on("finishTyping",this.byLetterAnimationFinish.bind(this),this),e.on("beforeClose",this.close.bind(this),this),cleverapps.audio.playSound(bundles.game.urls.dialogue_effect),e.onBundlesLoaded()},calcYOffset:function(){return-(cleverapps.UI.getSceneSize(
).height/2-this.dialogueStyles.height/2+cleverapps.UI.getSceneOffsetY())},generateContent:function(){var t=this.content=new cc.Node;return t.setAnchorPoint2(),t.setContentSize2(cleverapps.UI.getSceneSize().width-2*this.dialogueStyles.widthPadding,this.dialogueStyles.height),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:void 0===this.options.swallowTouches||this.options.swallowTouches,onTouchBegan:function(e){return!!(this.options.overlay||this.options.screenClicked||cc.rectContainsPoint(cc.rect(0,0,t.width,t.height),t.convertTouchToNodeSpace(e)))&&(this.dialogue.screenClicked(),!0)}.bind(this)},t),t},showUp:function(){this.content.setPositionRound(this.startPosition),this.content.runAction(new cc.Sequence(new cc.DelayTime(this.options.delay||0),new cc.MoveTo(.2,this.finalPosition.x,this.finalPosition.y+this.dialogueStyles.showUp.offset),new cc.MoveTo(.1,this.finalPosition)))},showPerson:function(e){e.styles||(e=this.dialogueStyles.persons.default)
;var t=new DialoguePersonView(e,this.content);t.isLeft?this.leftPersonView=t:this.rightPersonView=t},updatePerson:function(e){("right"===e.position?this.rightPersonView:this.leftPersonView).update(e)},updatePersonTitle:function(e){if(this.personTitle||(this.personTitle=new DialoguePersonTitleView,this.content.addChild(this.personTitle,1)),!e)return this.personTitle.hide(),void(this.textBgArrow&&this.textBgArrow.setVisible(!1));var t="right"!==e.position;e.styles||(e=this.dialogueStyles.persons.default),e.styles.title?this.personTitle.update(e.styles.title,t?this.leftPersonView:this.rightPersonView):this.personTitle.hide();var s=this.dialogueStyles.text.arrow;s&&(this.textBgArrow||(this.textBgArrow=new cc.Sprite(s.img),this.textBg.addChild(this.textBgArrow,s.zOrder||1)),this.textBgArrow.setVisible(!0),this.textBgArrow.setScaleX(t?1:-1),"relative"===s.offsetX?this.textBgArrow.setPositionRound(
t?this.leftPersonView.x+this.leftPersonView.width/2:this.rightPersonView.x-this.rightPersonView.width/2,s.y):this.textBgArrow.setPositionRound(t?s.offsetX:this.content.width-s.offsetX,s.y))},hidePerson:function(e){"right"!==e&&this.leftPersonView&&(this.leftPersonView.remove(),delete this.leftPersonView),"right"===e&&this.rightPersonView&&(this.rightPersonView.remove(),delete this.rightPersonView)},changeText:function(e,t,s){this.textBg||(this.textBg=new cc.Scale9Sprite(bundles.dialogues.frames.bg_png),this.textBg.setContentSize2(this.content.width,this.content.height),this.textBg.setPositionRound(this.content.width/2,this.content.height/2),this.content.addChild(this.textBg)),this.text&&this.text.removeFromParent(),this.text=cleverapps.UI.generateOnlyText(e,this.dialogueStyles.font||cleverapps.styles.FONTS.FORCE_MESSAGE_TEXT),this.text.setHorizontalAlignment(this.dialogueStyles.text.alignment),this.text.setAnchorPoint2(.5,1),this.content.addChild(this.text,1)
;var i=this.dialogueStyles.text,n=this.content.width-i.padding.fromWallX,o=i.padding.x;t&&(n=this.content.width-i.padding.x,o=i.padding.fromWallX);var r=this.content.height-i.padding.y,a=1,c=n-o,l=r-((this.button&&this.button.visible?this.button.y+this.button.height/2:0)+i.padding.y);c>i.optimization.width&&(c/=a=1.5,l/=a,this.text.setFontSize(Math.round(this.text.getFontSize()/a))),this.text.setDimensions(c,0),this.text.fitToHeight(l),this.text.setScale(this.text.getScale()*a),this.text.setPositionRound((o+n)/2,r),this.text.byLetterAnimation({callback:s})},updateButton:function(e,t){e=!this.options.button.noButton&&e,!this.button&&e&&(this.button=new cleverapps.UI.Button({width:this.dialogueStyles.button.width,height:this.dialogueStyles.button.height,button_png:this.dialogueStyles.button.button_png,button_on_png:this.dialogueStyles.button.button_png_on,text:this.options.button.text||Messages.get("Next"),font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,onClicked:function(){
this.dialogue.buttonClicked()}.bind(this),noThrottle:!0,padding:this.dialogueStyles.button.padding}),this.button.setPositionRound(this.content.width-(this.button.width/2+this.dialogueStyles.button.offset.x),this.button.height/2+this.dialogueStyles.button.offset.y),this.content.addChild(this.button,1)),this.button&&(this.button.visible=e,t&&this.button.text.setString(Messages.get("OK")))},close:function(){this.byLetterAnimationFinish(),this.content.stopAllActions(),this.dialogue.options.showUp?this.content.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveTo(.15,cc.p(this.content.x,this.content.y+this.dialogueStyles.showUp.offset)),new cc.MoveTo(.15,this.startPosition),new cc.CallFunc(function(){Window.prototype.close.apply(this,arguments),this.dialogue.finishClose()}.bind(this)),new cc.RemoveSelf)):(this._super(),this.dialogue.finishClose())},byLetterAnimationFinish:function(){this.text&&this.text.byLetterAnimationFinish(),[this.leftPersonView,this.rightPersonView].forEach(
function(e){e&&e.finishSpeaking()})},listBundles:function(e){return e.bundlesToLoad}});cleverapps.styles.DialogueView={height:280,widthPadding:0,offsetY:20,showUp:{y:100,offset:75},button:{width:160,height:60,button_png:bundles.buttons_main.frames.small_green_button,button_png_on:bundles.buttons_main.frames.small_green_button_on,padding:{x:10},offset:{x:30,y:30}},text:{alignment:cc.TEXT_ALIGNMENT_LEFT,arrow:!1,padding:{fromWallX:30,x:30,y:30},optimization:{width:1e3}},persons:{default:{animation:"animation",position:"left",styles:{json:bundles.dialogues.jsons.default_json,width:350,height:300,offsetX:25,offsetY:0,jsonPos:{x:{align:"center"},y:{align:"center"}}}}},Window:{noWindowScale:!0,windowShowUpAnimation:!1}};var MinimalDialogue=cc.Node.extend({ctor:function(e){this._super(),this.options=e||{},this.setAnchorPoint2(),this.setLocalZOrder(20),this.shown=!0,cleverapps.bundleLoader.loadBundle("dialogues_minimal",{onSuccess:this.createListener(this.onLoaded.bind(this)),blocked:!0})},
onLoaded:function(){this.createContent(),this.calculatePosition(),this.showUp()},createContent:function(){var e=cleverapps.styles.MinimalDialogue,t=this.options.person||e.persons.default,s=Math.min(e.maxWidth,cleverapps.UI.getSceneSize().width-e.widthPadding);(!1===this.options.person||!1===t&&cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL)&&(s-=e.person.width);var i=e.height;cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(i=e.verticalHeight);var n=s-e.text.padding.fromWallX,o=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?e.text.padding.verticalX:e.text.padding.x;!1!==this.options.person&&(o+=t.styles.width/2+e.person.offsetX+e.person.width/2),this.text=cleverapps.UI.generateOnlyText(this.options.text,e.font||cleverapps.styles.FONTS.FORCE_MESSAGE_TEXT),this.text.setHorizontalAlignment(e.text.alignment),this.text.setDimensions(n-o,0),this.text.fitTo(void 0,i-e.text.padding.y);var r=Math.max(this.text.height,!1!==this.options.person?e.person.height:0
)+e.text.padding.y;if(this.setContentSize2(s,r),!1!==this.options.person){var a=new cc.Node;a.setAnchorPoint2(),a.setCascadeColorEnabled(!0),a.setContentSize2(e.person),a.setPositionRound(t.styles.width/2+e.person.offsetX,this.height/2+e.person.offsetY),this.personAnimation=new cleverapps.Spine(t.styles.minimalJson||bundles.dialogues_minimal.jsons.dialogue_minimal_json),this.personAnimation.setPositionRound(a.width/2,a.height/2),a.addChild(this.personAnimation),this.addChild(a,e.person.zOrder)}if(this.textBg=cleverapps.UI.createScale9Sprite(bundles.dialogues_minimal.frames.bg_minimal_png,cleverapps.UI.Scale9Rect.TwoPixelXY),this.textBg.setCascadeOpacityEnabled(!0),this.textBg.setContentSize2(this.text.width+2*e.text.bg.padding.x,this.text.height+2*e.text.bg.padding.y),this.textBg.setPositionRound((o+n)/2-e.text.bg.offsetX,this.height/2),this.textBg.setCascadeOpacityEnabled(!0),this.textBg.setOpacity(0),this.addChild(this.textBg),this.text.setPositionRound(this.textBg.width/2,
this.textBg.height/2-e.text.bg.offsetY),this.text.setOpacity(0),this.textBg.addChild(this.text),e.text.arrow){this.textBgArrow=new cc.Sprite(e.text.arrow.img),this.textBgArrow.setScaleX("right"===t.position?-1:1);var c="right"===t.position?this.textBg.width-e.text.arrow.offsetX:e.text.arrow.offsetX;this.textBgArrow.setPositionRound(c,e.text.arrow.y),this.textBg.addChild(this.textBgArrow,e.text.arrow.zOrder||1)}this.setVisible(!1)},calculatePosition:function(){var e=cleverapps.UI.getSceneSize(),t=cleverapps.styles.MinimalDialogue;if(this.options.forcePosition)this.options.forcePosition===Dialogue.POSITIONS.TOP?this.setPositionRound(e.width/2,e.height-this.height/2-t.positions.top.y):this.options.forcePosition===Dialogue.POSITIONS.TOP_LOWER?this.setPositionRound(e.width/2,e.height-this.height/2-t.positions.topLower.y):this.options.forcePosition===Dialogue.POSITIONS.BOTTOM?this.setPositionRound(e.width/2,this.height/2+t.positions.bottom.y
):this.options.forcePosition===Dialogue.POSITIONS.CENTER&&this.setPositionRound(e.width/2,e.height/2);else if(this.options.rects&&this.options.rects.length){if(!this.calcDynamicPosition()){var s=cc.view.getFrameSize(),i="Could not position minimal dialog with text: "+this.options.text+", screen size: "+s.width+" by "+s.height;cleverapps.ErrorHandler.logError(i)}}else this.setPositionRound(e.width/2,this.height/2+t.positions.bottom.y)},calcDynamicPosition:function(){for(var t=cleverapps.styles.MinimalDialogue.targetOffset,e=this.options.rects.map(function(e){return cc.rect(e.x-t,e.y-t,e.width+2*t,e.height+2*t)}.bind(this)),s=function(e){var t=cleverapps.UI.getSceneOffsetY(),s=cleverapps.UI.getSceneSize();return cc.p(Math.max(this.width/2,Math.min(e.x,s.width-this.width/2)),Math.max(-t+this.height/2,Math.min(e.y,s.height+t-this.height/2)))}.bind(this),i=cc.director.getRunningScene().scene,n=this.options.parent||i,o=Number.MAX_VALUE,r=0,a=[],c=0;c<e.length;c++)for(var l=e[c],
p=this.calcPositionSlots(l),d=0;d<p.length;d++){var h=s(p[d]),u=n.convertToNodeSpace(i.convertToWorldSpace(h));this.setPositionRound(u),a.push(u);var g=0,v=0;if(e.forEach(function(e){var t=cc.rectIntersection(this.getGlobalBoundingBox(void 0,n),e);v=Math.max(v,Math.min(t.width,t.height));var s=(0<t.width?t.width:0)*(0<t.height?t.height:0);g<s&&(g=s)},this),v<=2)return!0;g<o&&(o=g,r=c*p.length+d)}return this.setPositionRound(a[r]),!1},calcPositionSlots:function(e){var t={x:e.x-this.width/2,y:e.y+e.height/2},s={x:e.x+e.width+this.width/2,y:e.y+e.height/2},i={x:e.x+e.width/2,y:e.y+e.height+this.height/2},n={x:e.x+e.width/2,y:e.y-this.height/2},o=cleverapps.UI.getSceneSize(),r=e.x+e.width/2,a=e.y+e.height/2;return r<o.width/6||r>o.width/6*5?[t,s,i,n]:a<o.height/6||a>o.height/6*5?[i,n,t,s]:[t,s,i,n]},showUp:function(){this.runAction(new cc.Sequence(new cc.DelayTime(this.options.delay||.5),new cc.Show,new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.dialogue_effect),
this.personAnimation&&this.personAnimation.setAnimationAndIdleAfter("minimal_showup","talk_minimal"),this.textBg.runAction(new cc.Sequence(new cc.FadeIn(.3),new cc.CallFunc(function(){this.text.runAction(new cc.FadeIn(.6))}.bind(this))))}.bind(this))))},hide:function(e){this.shown&&(this.personAnimation&&(this.personAnimation.setAnimation(0,"minimal_hide",!1),this.personAnimation.setCompleteListenerRemove()),this.textBg.runAction(new cc.FadeOut(.3)),this.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(function(){this.removeFromParent(),cleverapps.bundleLoader.deleteBundle("dialogues_minimal"),e&&e()}.bind(this)))),this.shown=!1)}});cleverapps.styles.MinimalDialogue={height:320,verticalHeight:450,maxWidth:1e3,widthPadding:0,targetOffset:30,person:{height:240,width:240,zOrder:-1,offsetX:25,offsetY:0},text:{alignment:cc.TEXT_ALIGNMENT_CENTER,width:500,padding:{fromWallX:30,verticalX:40,x:80,y:60},arrow:{img:bundles.dialogues_minimal.frames.arrow_minimal_png,y:{
align:"center"},offsetX:-7},bg:{offsetX:0,offsetY:-4,padding:{x:20,y:20}}},positions:{topLower:{y:200},top:{y:100},bottom:{y:20}},skip:{x:{align:"right",dx:-30},y:{align:"bottom",dy:20},width:100,height:50},persons:cleverapps.styles.DialogueView.persons};var ProlongationWindow=Window.extend({onWindowLoaded:function(e,t){if(!Game.currentGame)return!1;this.prolongation=e,this.price=e.getCoinsPrice(),this.moves=e.getAmountByCoins(),this.giveUpAlert=e.getGiveUpAlert(),0<this.price&&this.prolongation.addProlongation(),this.onCancel=t;var s=this.content=new cc.Node;s.setLocalZOrder(2),s.setAnchorPoint(.5,.5);var i=cleverapps.styles.ProlongationWindow,n=i.width,o=this.prolongation.countOfGoals&&this.prolongation.countOfGoals();if(o){var r=3===o&&cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL;n=i.wider.width}s.setContentSize2(n,i.height);var a=cleverapps.UI.generateTTFText("messages:ProlongationWindow.addMoves",
cleverapps.styles.FONTS.ADD_MOVES_QUESTION_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);s.addChild(a),a.setPositionRound(i.question),o&&this.createGoalsViews(o<3||r),this.prolongation.on("addMoves",this.createListener(this.onAddMoves.bind(this)));var c=cleverapps.once(function(e){void 0===e.delay&&(e.delay=i.addMoves.delay),this.prolongation.addMoves(e)}.bind(this)),l=function(){this.giveUpAlert.onTakeMoves(),levels.user.takeGold(this.price)&&(c({moves:this.moves,goldUsed:!0,price:this.price}),l=function(){})}.bind(this);this.coinProlongButton=new CoinProlongButton(this.moves,this.price,cleverapps.styles.FONTS.ADDMOVES_PRICE,l);var p=[this.coinProlongButton];this.price&&!cleverapps.flags.nopayments&&(this.productProlongButton=new ProductProlongButton(this.prolongation.getProduct(),c),p.push(this.productProlongButton)),this.price&&"undefined"!=typeof BreakView&&BreakView.AddBreakViews(s,this.viewsLayout?[this.viewsLayout]:[a],cleverapps.styles.ProlongationWindow.breakView.y)
;var d=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.ProlongationWindow,!0);this._super({title:Messages.get("ProlongationWindow.title"),name:"prolongationwindow",content:s,buttons:p,styles:d,closeButton:0<this.price,notCloseByTouchInShadow:!0}),this.closeButton&&(this.closeButton.settings.onClicked=this.giveUp.bind(this)),cleverapps.audio.playSound(bundles.game.urls.lose_effect);var h=cleverapps.windows.list.filter(function(e){return"confirmexitwindow"===e.name});0!==h.length&&h[0]&&h[0].close(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MOVES_SHOW),this.scheduleUpdate(),i.hero&&(this.hero=new cleverapps.Spine(i.hero.json,1),this.hero.setAnimation(0,i.hero.animation,!0),this.hero.setPositionRound(i.hero),this.addChild(this.hero))},giveUp:function(){this.giveUpAlert.canShow()?this.giveUpAlertShow():(this.close(),this.onCancel())},giveUpAlertShow:function(){var e=cleverapps.styles.ProlongationWindow.alert,t=new GiveUpAlertView(this.giveUpAlert,{size:e.size,
position:e.position});this.content.addChild(t);var s=this.window.convertToNodeSpace(t.getParent().convertToWorldSpace(t.getPosition()));this.closeButton.y-e.distToClose.height<s.y+t.height/2&&(this.addHeight=s.y+t.height/2-this.closeButton.y+e.distToClose.height)},onShow:function(){this.goldInfo&&this.goldInfo.showUp(),this.productProlongButton&&this.productProlongButton.startAnimate(),this.coinProlongButton&&this.coinProlongButton.startAnimate()},onHide:function(){this.productProlongButton&&this.productProlongButton.stopAnimate(),this.coinProlongButton&&this.coinProlongButton.stopAnimate(),this.goldInfo&&this.goldInfo.onHide()},onClose:function(){this.goldInfo&&this.goldInfo.close(),this.finger&&this.finger.removeFromParent(!0),this.onCancel()},onAddMoves:function(e){this.onCancel=function(){},this.onAddMovesAnimation&&this.onAddMovesAnimation(e.moves),this.hint&&this.hint.close(),this.close()},listBundles:function(){return["prolongation_window"]},update:function(e){this._super(e)
;var t=cleverapps.styles.ProlongationWindow.alert.delta;0<this.addHeight&&(this.addHeight-=t,this.bg.setContentSize(this.bg.width,this.bg.height+t),this.bg.setPosition(this.bg.x,this.bg.y+t/2),this.window.titleText.setPosition(this.window.titleText.x,this.window.titleText.y+t),this.closeButton.setPosition(this.closeButton.x,this.closeButton.y+t),this.onChangeBackground(this.window))}});cleverapps.styles.ProlongationWindow={y:294,width:720,height:270,wider:{width:780},addMoves:{delay:700},question:{x:{align:"center"},y:200},buttons:{x:70,phone:50},breakView:{y:50},goals:{scale:!1},alert:{}};var Prolongation=function(e){cleverapps.EventEmitter.call(this),this.game=e,this.counter=0,this.free=!1};Prolongation.prototype=Object.create(cleverapps.EventEmitter.prototype),(Prolongation.prototype.constructor=Prolongation).prototype.getCoinsPrice=function(){return this.free?0:0===this.counter&&(this.isWhale()||500<levels.user.gold)?250:cleverapps.config.prices.prolongations[this.counter]},
Prolongation.prototype.updateFree=function(e){this.free=e},Prolongation.prototype.getAmountByCoins=function(){var e=5;return!this.free&&0===this.counter&&(this.isWhale()||500<levels.user.gold)&&(e=10),e},Prolongation.prototype.isWhale=function(){return cleverapps.paymentsHistory.classify()===cleverapps.PaymentsHistory.PAYER_BIGWHALE||cleverapps.paymentsHistory.classify()===cleverapps.PaymentsHistory.PAYER_WHALE},Prolongation.prototype.addProlongation=function(){this.counter++,this.counter>=cleverapps.config.prices.prolongations.length&&(this.counter=cleverapps.config.prices.prolongations.length-1)},Prolongation.prototype.getProduct=function(){var e=Prolongation.PRODUCTS[0];switch(cleverapps.paymentsHistory.classify()){case cleverapps.PaymentsHistory.PAYER_NORMAL:e=Prolongation.PRODUCTS[1];break;case cleverapps.PaymentsHistory.PAYER_WHALE:e=Prolongation.PRODUCTS[2];break;case cleverapps.PaymentsHistory.PAYER_BIGWHALE:e=Prolongation.PRODUCTS[3]}return Product.Create(e)},
Prolongation.prototype.getGiveUpAlert=function(){var e=this.game.gameMission,t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN).logic.lantern,s=this.game.getPercentOfCompletion(),i=this.game.rewards[GameBase.REWARD_GOLD],n=void 0;return this.game.collectedBoosterCell?n=Prolongation.GIVE_UP_TYPES.BOOSTER:t&&t.isActive(this.game.level)&&0<t.getCurrentStreak()?n=Prolongation.GIVE_UP_TYPES.LANTERN:e&&e.isRunning()&&0<this.game.rewards.clover?n=Prolongation.GIVE_UP_TYPES.MISSION:i&&i>this.game.basicGoldReward?n=Prolongation.GIVE_UP_TYPES.GOLD_COLLECTED:.85<=s&&(n=Prolongation.GIVE_UP_TYPES.NEARLY),new GiveUpAlert(n)},Prolongation.prototype.addMoves=function(t){if(t.goldUsed&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{amount:t.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MOVES_BOUGHT+"_"+t.price)),cleverapps.history.add("moves",t.moves),this.trigger(
"addMoves",t),Game.currentGame){var s=Game.currentGame;s.hand&&s.hand.extra.hide(),s.counter.setTimeout(function(){if(s.hand?s.hand.addExtra(t.moves,t.bonus):s.setMoves(t.moves),s.score&&s.score.addBuyMoves(),t.bonus&&"match3"===cleverapps.config.type)for(var e=0;e<t.bonus;e++)s.field.addRandomMulticolor()},t.delay||700)}},Prolongation.GIVE_UP_TYPES={BOOSTER:0,LANTERN:1,MISSION:2,GOLD_COLLECTED:3,NEARLY:4},Prolongation.PRODUCTS=["addMoves1","addMoves2","addMoves3","addMoves5"];var GiveUpAlert=function(e){cleverapps.EventEmitter.call(this),this.type=e,this.viewExists=!1};GiveUpAlert.prototype=Object.create(cleverapps.EventEmitter.prototype),(GiveUpAlert.prototype.constructor=GiveUpAlert).prototype.getMessage=function(){switch(this.type){case Prolongation.GIVE_UP_TYPES.BOOSTER:return"messages:AddMovesWindow.boosterGiveUp";case Prolongation.GIVE_UP_TYPES.MISSION:return"messages:AddMovesWindow.missionGiveUp."+Game.currentGame.gameMission.getName();case Prolongation.GIVE_UP_TYPES.LANTERN:
return"messages:AddMovesWindow.lanternGiveUp";case Prolongation.GIVE_UP_TYPES.GOLD_COLLECTED:return"messages:AddMovesWindow.goldCollectedGiveUp";case Prolongation.GIVE_UP_TYPES.NEARLY:return"messages:AddMovesWindow.nearlyDoneGiveUp"}return""},GiveUpAlert.prototype.onTakeMoves=function(){this.viewExists&&!this.takeMovesLogged&&(this.takeMovesLogged=!0,this.type===Prolongation.GIVE_UP_TYPES.NEARLY?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_CHANGE_NEARLY):void 0!==this.type&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_CHANGE))},GiveUpAlert.prototype.canShow=function(){return void 0!==this.type&&!this.viewExists&&Game.currentGame&&Game.currentGame.outcome===GameBase.OUTCOME_UNKNOWN},GiveUpAlert.prototype.onShow=function(){this.viewExists||(this.viewExists=!0,this.type===Prolongation.GIVE_UP_TYPES.NEARLY?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_ATTENTION_NEARLY):this.type===Prolongation.GIVE_UP_TYPES.MISSION?cleverapps.eventLogger.logEvent(
cleverapps.EVENTS.GIVEUP_MISSION):void 0!==this.type&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.GIVEUP_ATTENTION))};var GiveUpAlertView=cc.Node.extend({ctor:function(e,t){this._super(),this.giveUpAlert=e,this.giveUpAlert.onShow();var s=cleverapps.styles.GiveUpAlertView,i=cleverapps.UI.createScale9Sprite(s.bg.image,cleverapps.UI.Scale9Rect.TwoPixelXY);i.setContentSize2(t.size),i.setLocalZOrder(-1),this.setContentSize2(i.width,i.height),this.setAnchorPoint2(),i.setPositionRound(this.width/2,this.height/2),this.addChild(i),this.setCascadeOpacityEnabled(!0),this.setPositionRound(t.position);var n=cleverapps.UI.generateTTFText(e.getMessage(),cleverapps.styles.FONTS.LEVEL_TUTORIAL_TEXT);n.setCascadeOpacityEnabled(!0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(this.width+s.text.padding[cleverapps.wideMode.mode].x,0),n.fitTo(void 0,this.height),n.setPositionRound(s.text),this.addChild(n),this.showUp(),
cleverapps.audio.playSound(bundles.game.urls.bubble_effect)},showUp:function(){this.setOpacity(0),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.FadeIn(.2),new cc.CallFunc(function(){var e=this.getScale();this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,1.05*e),new cc.ScaleTo(.5,e))))}.bind(this))))}});cleverapps.styles.GiveUpAlertView={bg:{image:bundles.main.frames.speak_bg_png},text:{x:{align:"center",dx:30},y:{align:"center",dy:0},padding:[{x:-50},{x:-50},{x:-50}]}};var ProductProlongButton=cleverapps.UI.Button.extend({ctor:function(e,t){var s=cleverapps.styles.ProductProlongButton;this.product=e,this._super({content:this.getButtonContent(),onClicked:function(){this.product.buy(function(){t({moves:e.moves,bonus:e.bonus})})}.bind(this),width:s.width,height:s.height}),this.baseScale=s.scale,this.setScale(this.baseScale);var i=new ProductPriceView(this.product,{font:cleverapps.styles.FONTS.ADDMOVES_PRICE,iconScale:s.okPrice.scale,
offsetY:s.okPrice.offsetY});i.setPositionRound(this.width/2,s.price.y),this.addChild(i),Lottery.addIcon(this)},startAnimate:function(){this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.ScaleTo(.5,this.baseScale).easing(cc.easeBackOut())))},stopAnimate:function(){this.stopAllActions(),this.setScale(this.baseScale)},getButtonContent:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.ProductProlongButton.content,s=cleverapps.UI.generateImageText(this.product.moves,cleverapps.styles.FONTS.BUTTON_TEXT);e.addChild(s);var i=new cc.Sprite(bundles.moves.frames.game_moves_icon);if(i.setScale(t.moves.scale),i.setPositionRound(t.moves),e.addChild(i),this.product.bonus){var n=cleverapps.UI.generateImageText("+",cleverapps.styles.FONTS.BUTTON_TEXT);e.addChild(cleverapps.UI.wrapWithPadding(n,t.plus));var o=new cc.Node;o.setAnchorPoint2(.5,.5);for(var r=0;r<this.product.bonus;r++){var a=new cc.Sprite(t.bonus.image);a.setScale(t.bonus.scale),
o.addChild(a)}cleverapps.UI.arrangeWithMargins(o.children,{margin:t.bonus.margin,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(o),e.addChild(o),o.setPositionRound(t.bonus)}return cleverapps.UI.arrangeWithMargins(e.children,{margin:t.x,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(e),e.setAnchorPoint2(),e}});cleverapps.styles.ProductProlongButton={width:350,height:100,scale:1,price:{y:120},content:{x:0,bonus:{image:bundles.game.frames.cell_multicolor,scale:.5,margin:0,x:0,y:0},moves:{scale:1,x:0,y:0},plus:{x:15,y:0}},okPrice:{scale:.6,offsetY:0}};var CoinProlongButton=cleverapps.UI.Button.extend({ctor:function(e,t,s,i){var n=cleverapps.styles.CoinProlongButton;this.amount=e,this.price=t,this.font=s,this._super({content:this.getButtonContent(),width:n.width,height:n.height,onClicked:i}),this.baseScale=n.scale,this.addChild(this.getPriceContent())},startAnimate:function(){cleverapps.UI.removeHover(this),this.setScale(0),this.runAction(new cc.Sequence(new cc.DelayTime(
.4),new cc.ScaleTo(.5,cleverapps.styles.CoinProlongButton.scale).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.UI.applyHover(this)}.bind(this))))},stopAnimate:function(){this.stopAllActions(),this.setScale(cleverapps.styles.CoinProlongButton.scale)},getButtonContent:function(){var e=cleverapps.styles.CoinProlongButton,t=new cc.Node;t.setAnchorPoint(.5,.5);var s=cleverapps.UI.generateImageText(this.amount,cleverapps.styles.FONTS.BUTTON_TEXT);t.addChild(s);var i=new cc.Sprite(bundles.moves.frames.game_moves_icon);return i.setScale(e.content.moves.scale),i.setPositionRound(e.content.moves),t.addChild(i),cleverapps.UI.arrangeWithMargins(t.children,{direction:cleverapps.UI.HORIZONTAL,margin:e.content.margin}),cleverapps.UI.wrap(t),t.setAnchorPoint2(),t},getPriceContent:function(){var e=new cc.Node;e.setAnchorPoint(.5,.5);var t=cleverapps.styles.CoinProlongButton,s=new cc.Sprite(bundles.menubar.frames.coin_png);s.setScale(t.content.coin.scale),e.addChild(s)
;var i=cleverapps.UI.generateOnlyText(0===this.price?"messages:FREE":this.price,this.font);return i.setDimensions(0,t.height),i.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.addChild(i),cleverapps.UI.arrangeWithMargins(e.children,{margin:t.content.x,direction:cleverapps.UI.HORIZONTAL}),cleverapps.UI.wrap(e),e.setPositionRound(this.width/2,t.content.coin.y),e}});cleverapps.styles.CoinProlongButton={width:300,height:100,content:{x:10,margin:0,coin:{scale:.6,y:130},moves:{scale:1,x:0,y:0}},scale:.9};var RewardElementView=cc.Node.extend({ctor:function(e,t,s){this._super(),this.game=e.game;var i=cleverapps.styles.UI.RewardElementView;if(this.setLocalZOrder(i.zIndex),i.background){var n=i.background[cleverapps.wideMode.mode];n.image=bundles.reward_element.frames.reward_element_bg_png,this.bg=cleverapps.UI.createSprite(n),n.x&&this.bg.setPositionRound(n),this.addChild(this.bg),cleverapps.styles.COLORS.HARD&&this.game.level.isHard()&&this.bg.setColor(cleverapps.styles.COLORS.HARD)}if(
this.icon=s.icon,this.icon.baseScale=i.image.scale,this.icon.setScale(this.icon.baseScale),i[s.name]&&i[s.name].icon?this.icon.setPositionRound(i[s.name].icon.x,i[s.name].icon.y):this.icon.setPositionRound(i.icon.x,i.icon.y),this.addChild(this.icon),this.text=cleverapps.UI.generateImageText(this.getText(this.game.rewards[s.reward]||0),cleverapps.styles.FONTS.REWARD_ELEMENT_TEXT),i[s.name]&&i[s.name].color&&this.text.setColor(i[s.name].color),i.amountBg){var o=new cc.Sprite(i.amountBg.image);this.addChild(o),o.setPositionRound(i.text.x,i.text.y)}this.text.baseScale=this.text.scale,this.text.setPositionRound(i.text.x,i.text.y),this.addChild(this.text);var r=i.scale[cleverapps.wideMode.mode];this.setScale(r),this.setContentSize2(i.width,i.height),t.addChild(this);var a=i;if(a[s.name]&&a[s.name].position&&(a=a[s.name].position),a.positions)a=a.positions,Array.isArray(a)&&(a=a[cleverapps.wideMode.mode]),Array.isArray(a)&&(a=a[this.game.goals.amountGoals-1]),this.setPositionRound(a.x,a.y
);else{var c=a.margin[cleverapps.wideMode.mode],l=cleverapps.UI.getSceneSize(),p="right"===c.align?l.width:"center"===c.align?l.width/2:0;this.setPositionRound(p+c.x,c.y)}var d=new cc.Node;t.addChild(d),d.setPositionRound(this.x+i.targetPosition.offset.x,this.y),d.registerTarget(cleverapps.styles.UI.RewardElementView,s.targetName),-1!==["board","solitaire","differences"].indexOf(cleverapps.config.type)&&(cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl(s.control,function(e){cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&e||this.toggle(e)}.bind(this)),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(e.groupToggler.addToGroup(this,this.getGroupName()),this.hide()))},getText:function(e){return e+""},getGroupName:function(){return"rewardElements"}});RewardElementView.rotateAnimation=function(e,t){e.text.setString(e.getText(t)),0===e.icon.getRotation()&&e.icon.runAction(new cc.Sequence(new cc.Spawn(new cc.Sequence(new cc.ScaleTo(
.2,1.2*e.icon.baseScale),new cc.ScaleTo(.2,e.icon.baseScale)),new cc.RotateBy(.4,360)),new cc.CallFunc(function(){e.icon.setRotation(0)}))),e.text.stopAllActions(),e.text.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.5*e.text.baseScale),new cc.ScaleTo(.2,e.text.baseScale)))},RewardElementView.growAnimation=function(e,t){e.icon.stopAllActions(),e.icon.setScale(e.icon.baseScale),e.icon.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.3*e.icon.baseScale),new cc.ScaleTo(.15,e.icon.baseScale)));var s=e.text.baseScale;e.text.stopAllActions(),e.text.setScale(s),e.text.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.8*s),new cc.CallFunc(function(){e.text.setString(e.getText(t))}),new cc.ScaleTo(.15,s)))},cleverapps.overrideStyles(cleverapps.styles.FONTS,{REWARD_ELEMENT_TEXT:{name:"default",size:40}}),cleverapps.styles.UI.RewardElementView={zIndex:0,image:{scale:1.4},text:{y:0,x:0},icon:{x:0,y:0},amountBg:!1,scale:[.6,1,.7],width:100,height:100,margin:[{x:40,y:40},{x:-124,y:100,align:"right"},{
x:340,y:58}],TulpanTournament:{icon:{x:0,y:26}},targetPosition:{offset:{x:0}}};var RewardGoldView=RewardElementView.extend({ctor:function(e,t){var s,i=e.game;s=cleverapps.styles.UI.RewardElementView.missionIconAnimated?new CoinMarkView(new Mark("coin"),{counter:!0}):new cc.Sprite(bundles.menubar.frames.coin_png),this._super(e,t,{name:"gold",targetName:"rewardGoldViewTarget",icon:s,reward:GameBase.REWARD_GOLD,control:"rewardElementGold"}),i.onGoldRewardAdded=function(){this.hide&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&!cleverapps.styles.UI.RewardElementView.chest?e.groupToggler.show(this,this.getGroupName(),this.runCollectAnimation.bind(this)):this.runCollectAnimation()}.bind(this),cleverapps.tooltipManager.create(this.bg||this.icon,{text:"messages:RewardGoldTooltip",position:cleverapps.styles.UI.Tooltip.LOCATION.below,hideHandler:this.hideHandler})},runCollectAnimation:function(){RewardElementView.growAnimation(this,this.game.rewards[GameBase.REWARD_GOLD]),
cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect)}});cleverapps.UI.GroupToggler=function(e){this.game=e,this.groups={}},cleverapps.UI.GroupToggler.prototype.addToGroup=function(e,t){this.groups[t]||(this.groups[t]=[]),this.groups[t].push(e)},cleverapps.UI.GroupToggler.prototype.show=function(e,t,s){for(var i=0;i<this.groups[t].length;i++)this.groups[t][i]!==e&&this.groups[t][i].hide();e.showForDuration(s)};var BaseGame=function(){cleverapps.EventEmitter.call(this),this.running=!0,this.paused=!1};BaseGame.prototype=Object.create(cleverapps.EventEmitter.prototype),(BaseGame.prototype.constructor=BaseGame).prototype.pause=function(){this.paused=!0},BaseGame.prototype.resume=function(){this.paused=!1,this.trigger("resumed")},BaseGame.prototype.getName=function(){return""},BaseGame.prototype.finish=function(e){e=e||{},this.running&&(this.running=!1,this.trigger("finish",e),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MINIGAME_FINISH+"_"+this.getName()),
cleverapps.playSession.set(cleverapps.EVENTS.MINIGAME_FINISH+"_"+this.getName(),!0))};var MissionIcon=function(e){var t=Missions[e.type].sideBarJson,s="function"==typeof t?t(e):t,i=-1!==[Mission.TYPE_FAVORITE_SALE,Mission.TYPE_COINS_SALE].indexOf(e.type),n=void 0;e.isBattlePassMission()&&(n="battlepass"),SideBarIcon.call(this,{animation:s,lottery:i,target:n,progressIconJson:Missions[e.type].sideBarProgressIconJson}),this.priority=SideBarIcon.PRIORITY_LOW,this.mission=e};MissionIcon.prototype=Object.create(SideBarIcon.prototype),(MissionIcon.prototype.constructor=MissionIcon).prototype.resetState=function(){this.setAttention(this.isAttentionRequired());var e=this.mission.finishTime()-Date.now();0<e?(this.setLeftTime(e),this.setTitle(void 0)):(this.setLeftTime(0),this.setTitle("messages:Finished"))},MissionIcon.prototype.isAttentionRequired=function(){return this.mission.isMinigameMission()?this.mission.canPlayMinigame():this.mission.isBattlePassMission(
)?0<this.mission.battlePass.countAvailableRewards():this.mission.isSlotMachineMission()?0<this.mission.slotMachine.getTickets():this.mission.type===Mission.TYPE_BONUS_WORLD},MissionIcon.prototype.getForce=function(){return this.mission.iconForce},MissionIcon.prototype.onPressed=function(){this.mission.isRunning()?cleverapps.metha.display({focus:"MissionIconClicked",action:function(e){var t=new(this.mission.getViewClass())(this.mission);t instanceof cleverapps.FixedWidthScene||t instanceof SceneProxy?cleverapps.scenes.replaceScene(t,e):cleverapps.metha.onceNoWindowsListener=e}.bind(this)}):cleverapps.missionManager.displayCompleted(this.mission)};var MissionWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.MissionWindow;this.mission=e,this.content=new cc.Node,this.content.setContentSize(t.width,t.height),this.content.setAnchorPoint(.5,.5),this.onStart();var s={width:t.button.width,height:t.button.height,text:Messages.get("Play").toUpperCase(),
font:cleverapps.styles.FONTS.MISSION_BUTTON_TEXT,button_png:bundles.buttons_main.frames.mission_play_button,button_on_png:bundles.buttons_main.frames.mission_play_button_on,contentOffset:t.button.contentOffset,onPressed:function(){this.close(),cleverapps.metha.distract({focus:"MissionPlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e,{mission:!0})}})}.bind(this)};this.wasFinished&&(s=cleverapps.extend(s,{text:Messages.get(this.prize?"ClaimPrize.Button.text":"OK"),onPressed:this.close.bind(this)}));var i={title:{text:"messages:Missions."+e.getName()+".Title",font:cleverapps.skins.getSlot("missionWindowTitleFont")},name:" missionwindow",content:this.content,styles:cleverapps.overrideStyles(cleverapps.styles.Window,t.window,!0),button:s,help:this.wasFinished?void 0:function(){new MissionRulesWindow(e)}};this._super(i)},onStart:function(){this.contentLayout&&this.contentLayout.removeFromParent(),this.wasFinished=!this.mission.isRunning(),this.wasFinished&&(
this.prize=this.mission.getPrize());var e=cleverapps.styles.MissionWindow,t=cleverapps.missionManager.table.createTableView({id:this.mission.type,data:this.mission.getResults(),dataIcon:this.mission.getIcon(),options:e.tableHeight,rowConstructor:cleverapps.MissionRow});t.setScale(e.table.scale);var s=[cleverapps.UI.generateTTFText(this.mission.isRunning()?"messages:Missions.windowRunning":"messages:Missions.windowFinished",cleverapps.styles.FONTS.MISSION_WINDOW_STATUS_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT)],i={font:cleverapps.styles.FONTS.MISSION_WINDOW_TIMER_TEXT||cleverapps.styles.FONTS.TEXT};if(e.timer.bg){var n=cleverapps.UI.createScale9Sprite(e.timer.bg.image);n.setContentSize2(e.timer.bg),i.background_content=n}if(this.mission.isRunning()){var o=new cleverapps.CountDownView(new cleverapps.CountDown(this.mission.getTimeLeft(),{onFinish:function(){this.onFinishedSound&&"function"==typeof this.onFinishedSound&&this.onFinishedSound(!0),this.close()}.bind(this)}),i);o.setScale(
e.timer.scale),s.push(o)}s.reverse();var r=new cleverapps.Layout(s,{}),a=new cc.Node;a.setContentSize(e.width,e.textAndTimerHeight),a.setAnchorPoint(.5,.5),a.setLocalZOrder(-1),a.addChild(r),r.setPositionRound({align:"center"},{align:"center"});var c=[a],l=bundles[this.mission.getWindowBundleName()],p=new cc.Scale9Sprite(new cc.Sprite(cleverapps.styles.TableView.bg).getSpriteFrame());if(p.setContentSize2(t.width,e.animation.animationHeight),e.autoScrollText){var d;this.wasFinished&&(d=this.prize?"Win":"Lose");var h=e.text[this.mission.getName()]||"messages:Missions.CommonText";d&&(h="messages:Missions."+this.mission.getName()+".AnimationMainText"+d);var u=["messages:Missions."+this.mission.getName()+".AnimationMainTextInfo0","messages:Missions."+this.mission.getName()+".AnimationMainTextInfo1",h].filter(Messages.has),g=e.animation.animationWidth+e.contentObjectsMargin/2;this.autoScrollText=new AutoScrollText(u,{styles:{width:Math.max(e.contentObjectsMargin,t.width-g
)-2*e.autoScrollText.offset.x,height:p.height-2*e.autoScrollText.offset.y,font:cleverapps.styles.FONTS.MISSIONS_TEXT,padding:e.autoScrollText.padding}}),p.addChild(this.autoScrollText),this.autoScrollText.setPositionRound(g+(p.width-g)/2,p.height/2);var v=new cc.Node;v.setContentSize2(e.animation.animationWidth,e.animation.animationHeight),v.setAnchorPoint(0,0),v.setLocalZOrder(1);var m=new cleverapps.Spine(l.jsons.json);m.setAnimation(0,"finish",!0),m.setPosition(v.width/2,v.height/2),v.addChild(m),p.addChild(v),c.push(p)}if(c.push(t),c.reverse(),this.contentLayout=new cleverapps.Layout(c,{margin:e.contentObjectsMargin,padding:{x:0,y:1.5*e.contentObjectsMargin}}),this.content.addChild(this.contentLayout),this.contentLayout.setPositionRound(e.contentLayout),this.mission.onChangeResults=this.createListener(function(){var e=this.mission.getResults();t.updateResults(e),cleverapps.missionManager.table.updateResults(this.mission.type,e)}.bind(this)),
e.titleAnimation&&bundles[this.mission.getWindowBundleName()].jsons.mission_window_json){var f=new cleverapps.Spine(bundles[this.mission.getWindowBundleName()].jsons.mission_window_json);f.setAnimation(0,"animation",!0),this.content.addChild(f),f.setPositionRound(e.titleAnimation)}SceneDecors.add(this.content,cleverapps.skins.getSlot("missionWindowDecors"))},onFinishedSound:function(e){e&&this.mission&&!this.mission.finishTimeSoundPlayed&&cleverapps.windows.currentWindow()===this&&(this.mission.finishTimeSoundPlayed=!0,cleverapps.audio.playSound(bundles.main.urls.mission_finish_effect))},onShow:function(){this.onFinishedSound&&"function"==typeof this.onFinishedSound&&this.onFinishedSound(this.wasFinished),this.autoScrollText&&(this.autoScrollText.setTextByIndex(0),this.autoScrollText.reinitTimer()),cleverapps.audio.playSound(bundles.main.urls.window_effect)}});MissionWindow.prototype.listBundles=function(e){var t=[],s=e.getWindowBundleName();return s&&t.push(s),t},
cleverapps.styles.MissionWindow={width:700,height:940,textAndTimerHeight:90,titleFont:cleverapps.styles.FONTS.WINDOW_TITLE_TEXT,timer:{font:cleverapps.styles.FONTS.TEXT,scale:.8},button:{width:260,height:100,contentOffset:{y:0}},window:{Border:{x:36}},tableHeight:{styles:{height:449}},contentObjectsMargin:20,animation:{animationWidth:250,animationHeight:247},autoScrollText:{padding:{x:0,y:40},offset:{x:20,y:40}},table:{scale:1},contentLayout:{x:{align:"center"},y:{align:"top"}},text:{}};var MissionRulesWindow=RulesWindow.extend({onWindowLoaded:function(e){this.bundle=bundles[e.getWindowBundleName()];var t=cleverapps.styles.MissionRulesWindow;t.prefix="messages:MissionRulesWindow."+e.getName()+".",t.animation.json=cleverapps.skins.getSlot("missionRulesWindow",{bundle:this.bundle,type:e.type}),t.animation.json=t.animation.json||this.bundle.jsons.rules_json,t.animation.name="animation",this._super({name:"missionruleswindow",styles:t})},listBundles:function(e){var t=this._super(e)
;return t.push(e.getWindowBundleName()),t}});cleverapps.styles.MissionRulesWindow={margin:0,animation:{height:730,y:-110},subText:{width:240,left:{x:{align:"left",dx:0},y:{align:"top",dy:-250}},right:{x:{align:"right",dx:10},y:{align:"top",dy:-250}},bottom:{x:{align:"center",dx:15},y:{align:"bottom",dy:70}}}};var MissionAnimationView=cc.Node.extend({ctor:function(e){this._super(),this.usePool=!0;var t=this.clover=new cc.Sprite(this.getIcon(e));t.setScale(cleverapps.styles.MissionAnimationView.scale),this.addChild(t),this.setLocalZOrder(100),this.setCascadeOpacityEnabled(!0),this.initialize(e)},initialize:function(e){var t=this.getFieldAlgorithm();e.victory&&(t=this.getVictoryAlgorithm()),t(this,e)},reuse:function(e){this.initialize(e)},remove:function(){this.usePool?cc.pool.putInPool(this):this.unuse()},unuse:function(){this.removeFromParent()}}),MissionAnimationGoldView=MissionAnimationView.extend({getIcon:function(){return bundles.menubar.frames.coin_png},getFieldAlgorithm:function(
){return MissionAnimationView.SimpleFlyAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationCloverView=MissionAnimationView.extend({getIcon:function(){return bundles.game.frames.fly_clover_png},getFieldAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationRoseView=MissionAnimationView.extend({getIcon:function(e){return e.icon?e.icon:cleverapps.skins.getSlot("missionMarkIcon",{type:Mission.TYPE_COLLECT_MARK})},getFieldAlgorithm:function(){return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm},reuse:function(e){this._super(e),this.clover.setSpriteFrame(this.getIcon(e))}}),MissionAnimationTulpanView=MissionAnimationView.extend({getIcon:function(){return cleverapps.skins.getSlot("missionIcon",{type:Mission.TYPE_BURN_NEARBY})},getFieldAlgorithm:function(){
return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}}),MissionAnimationLetterView=MissionAnimationView.extend({ctor:function(e){cc.Node.prototype.ctor.call(this);var t=this.clover=this.getIcon(e.id);t.setScale(cleverapps.styles.MissionAnimationView.scale),this.addChild(t),this.setLocalZOrder(100),this.setCascadeOpacityEnabled(!0),this.initialize(e)},reuse:function(e){this.clover.setSpriteFrame(this.getSpriteFrame(e.id))},getIcon:function(e){return new cc.Sprite(this.getSpriteFrame(e))},getSpriteFrame:function(e){var t=e%Missions[Mission.TYPE_LETTER].STAR_TYPES_AMOUNT;return cleverapps.skins.getSlot("missionStar",{type:t})},getFieldAlgorithm:function(){return MissionAnimationView.flyToAlgorithm},getVictoryAlgorithm:function(){return MissionAnimationView.SimpleFlyAlgorithm}});MissionAnimationView.flyToAlgorithm=function(e,t){var s=cleverapps.styles.MissionAnimationView,i=s.upY,n=t.beginPos,o=t.targetPos;e.setPosition(n
),n.y+=i,e.setScale(t.beginScale),e.setOpacity(255);var r=cc.p(o.x,o.y+s.flyTo.second.y),a=[cc.p((n.x+r.x)/2,(n.y+r.y)/2+s.flyTo.first.y),r,o],c=Math.abs(o.x-n.x),l=Math.abs(o.y-n.y)+s.flyTo.first.y+s.flyTo.second.y,p=Math.sqrt(c*c+l*l);p/=s.flySpeed,t.targetScale||(t.targetScale=t.beginScale),t.finalScale||(t.finalScale=t.targetScale),e.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,t.targetScale),new cc.MoveBy(.3,cc.p(0,i))),new cc.Spawn(new cc.ScaleTo(p,t.finalScale),new cc.BezierTo(p,a).easing(cc.easeIn(1))),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.cell_collect_effect,{throttle:20}),e.remove(),t.callback&&t.callback()})))},MissionAnimationView.SimpleFlyAlgorithm=function(e,t){var s=t.beginPos;e.setPosition(s),e.setScale(0),e.setOpacity(255);var i=cleverapps.styles.MissionAnimationView.bezierLength,n=Math.random()*i;n<i/2&&(n-=i);var o=cc.p(s.x+n,s.y-2*i),r=cc.p(o.x,o.y+i),a=[cc.p(s.x,s.y+i*(1.5+.5*Math.random())),r,o],c=.2;3<c*t.amount&&(
c=3/t.amount),e.runAction(new cc.Sequence(new cc.DelayTime(t.id*c),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.game.urls.boom_effect,{throttle:20})}),new cc.Spawn(new cc.ScaleTo(.3,.8),new cc.BezierTo(2,a),new cc.RotateBy(2,n<0?-360:360),new cc.Sequence(new cc.DelayTime(1.5),new cc.FadeOut(.5))),new cc.CallFunc(function(){e.remove()})))},MissionAnimationCloverView.factory=function(e){return cc.pool.hasObject(MissionAnimationCloverView)?cc.pool.getFromPool(MissionAnimationCloverView,e):new MissionAnimationCloverView(e)},MissionAnimationRoseView.factory=function(e){return cc.pool.hasObject(MissionAnimationRoseView)?cc.pool.getFromPool(MissionAnimationRoseView,e):new MissionAnimationRoseView(e)},MissionAnimationTulpanView.factory=function(e){return cc.pool.hasObject(MissionAnimationTulpanView)?cc.pool.getFromPool(MissionAnimationTulpanView,e):new MissionAnimationTulpanView(e)},MissionAnimationLetterView.factory=function(e){return cc.pool.hasObject(
MissionAnimationLetterView)?cc.pool.getFromPool(MissionAnimationLetterView,e):new MissionAnimationLetterView(e)},MissionAnimationGoldView.factory=function(e){return cc.pool.hasObject(MissionAnimationGoldView)?cc.pool.getFromPool(MissionAnimationGoldView,e):new MissionAnimationGoldView(e)},MissionAnimationView.show=function(e,t,s){s.amount||(s.amount=1);for(var i=0;i<s.amount;i++)switch(s.id=i,e){case"gold":t.addChild(MissionAnimationGoldView.factory(s));break;case Mission.TYPE_COMBO:t.addChild(MissionAnimationCloverView.factory(s));break;case Mission.TYPE_COLLECT_MARK:t.addChild(MissionAnimationRoseView.factory(s));break;case Mission.TYPE_BURN_NEARBY:t.addChild(MissionAnimationTulpanView.factory(s));break;case Mission.TYPE_LETTER:t.addChild(MissionAnimationLetterView.factory(s))}},cleverapps.styles.MissionAnimationView={bezierLength:250,flySpeed:1500,upY:100,flyTo:{first:{y:300},second:{y:300}},scale:1};var CloversView=RewardElementView.extend({getAddedAnimation:function(e){switch(e){
case Mission.TYPE_COMBO:return RewardElementView.rotateAnimation;case Mission.TYPE_COLLECT_MARK:case Mission.TYPE_BURN_NEARBY:case Mission.TYPE_LETTER:return RewardElementView.growAnimation}},runAddedAnimation:function(){var e=this.getAddedAnimation(this.game.gameMission.type);e&&e(this,this.game.rewards[GameBase.REWARD_CLOVER]),cleverapps.audio.playSound(bundles.game.urls.tournament_element_collected)},ctor:function(e,t){var s,i=e.game,n=i.gameMission,o=cleverapps.styles.UI.RewardElementView;s=o.missionIconAnimated?new MissionMarkView(new Mark("mission"),{counter:!0}):new cc.Sprite(i.gameMission.getIcon()),this._super(e,t,{name:n.getName(),targetName:"cloversViewTarget",icon:s,reward:GameBase.REWARD_CLOVER,control:"rewardElementClover"}),cleverapps.tooltipManager.create(this.bg||this.icon,{text:"messages:CloversTooltip",position:"runes"===cleverapps.config.name?cleverapps.styles.UI.Tooltip.LOCATION.above:cleverapps.styles.UI.Tooltip.LOCATION.below,hideHandler:this.hideHandler,
control:"cloversViewTooltip"}),i.onCloverAdded=function(){this.hide&&cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?e.groupToggler.show(this,this.getGroupName(),this.runAddedAnimation.bind(this)):this.runAddedAnimation()}.bind(this),o.hideOnStart&&(this.visible=!1)}}),MainScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_MAIN),this.addToolbar(),this.addSideBar(),cleverapps.environment.levelNo=levels.user.level,cleverapps.environment.episodeNo=levels.user.episode,cleverapps.placements.run(Placements.INTERMEDIATE)},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.metha.gotoMainScene(e)}},closeAction:function(){cleverapps.administrator?AdministratorScene.open():window.closeApplication&&window.closeApplication()},addSideBar:function(){var e=new SideBarView;e.setPositionRound(this.scene.width/2,this.scene.height/2),e.setLocalZOrder(1),this.scene.addChild(e)},addToolbar:function(){(
this.downToolBar=new ToolbarView(this.scene)).setLocalZOrder(1)}}),MethaHelper={start:function(e,t,s){s=s||{};var i=MethaHelper.getCurrentLevel(t);0===i.episodeNo&&0===i.levelNo||!LevelStartWindow.isAvailable(i.episode.episodeNo,i.levelNo)||s.playNext&&!BoostersBefore.isAvailable()?i.play(e):cleverapps.metha.compound(e,[function(e){s.playNext&&BoostersBefore.isAvailable()?cleverapps.Plot.GameLeave(e,s):e()},function(e){t?(cleverapps.metha.showControlsWhileFocused("MenuBarGoldItem"),new BuildingStartWindow({building:t,level:i})):new LevelStartWindow({level:i}),cleverapps.metha.onceNoWindowsListener=e}])},getCurrentLevel:function(e){var t=void 0;cleverapps.metha.getType()===Metha.FARM?(t=e.label,cleverapps.playButton.disableIncLevel(),(void 0===t||t.episodeNo>=levels.episodes.getAmountEpisodes())&&(t=cleverapps.farm.chooseNextLevel(e)),e.label!==t&&(e.label=t,cleverapps.farm.save()),cleverapps.playButton.enableIncLevel()):t=cleverapps.user.getCurrentLevel(),cleverapps.isKnockoutGame(
)&&cleverapps.user.incLevel();var s=new Episode(t.episodeNo,t.levelNo).getLevel();return cleverapps.metha.getType()===Metha.FARM&&(s.building=e),s},prepare:function(){MethaHelper.prepareCharacters(),cleverapps.config.debugMode&&cleverapps.metha.getType()===Metha.FARM&&MethaHelper.validateDialogues(),cleverapps.metha.getType()===Metha.FARM&&MethaHelper.validateQuestItems()},prepareCharacters:function(){var s=cleverapps.styles.WorldMap,e=0;cleverapps.styles.WorldMap.persons.person0&&(e=1);var t=function(e,t){s.persons[e]=s.persons[e]||cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{json:t.jsons[e],title:"messages:"+e}},!0)};if(cleverapps.metha.getType()===Metha.HOMEFIX){var i=bundles.homefix_windows;if(!i)return;for(var n=e;n<100;n++){var o="person"+n;if(!i.jsons[o])break;t(o,i)}}else if(cleverapps.metha.getType()===Metha.FARM)for(n=e;n<100;n++){if(!bundles[o="person"+n])break;t(o,bundles[o])}},validateQuestItems:function(){MethaHelper.readConfig(
).questItems.forEach(function(e,t){if(!bundles.farm_windows.frames["item"+t])throw"No questItem resource - "+e})},readConfig:function(){return cleverapps.metha.getType()===Metha.FARM?cleverapps.farm.readConfig():cleverapps.metha.getType()===Metha.HOMEFIX?cleverapps.home.readConfig():void 0},validateDialogues:function(){cleverapps.values(this.readConfig().dialogues).forEach(function(e){e.forEach(function(e){if("string"==typeof e.person&&!cleverapps.styles.WorldMap.persons[e.person])throw"No person: "+e.person})})},allIsComplete:function(e){cleverapps.metha.compound(e,[function(e){var t=MethaHelper.createDialogue("Final");t.on("afterClose",e),new DialogueView(t,{overlay:!0}),t.run()},function(e){new AllDoneWindow,cleverapps.metha.onceNoWindowsListener=e}])},createDialogue:function(e){var t=this.readConfig().dialogues[e];if(t){var s=[],i=[];return t.forEach(function(e){var t={text:"messages:"+e.text,person:{animation:e.animation||cleverapps.styles.WorldMap.personsAnimation,
position:e.position||"left",styles:cleverapps.styles.WorldMap.persons[e.person].styles}};e.person2&&(t.person2={animation:e.person2.animation||cleverapps.styles.WorldMap.personsAnimation,position:e.person2.position||"left",styles:cleverapps.styles.WorldMap.persons[e.person2.person].styles}),i.push(t),cleverapps.metha.getType()===Metha.FARM&&(s.push(e.person),e.person2&&e.person2.person&&s.push(e.person2.person))}),new Dialogue(i,{autoClose:!0,showUp:!0,bundles:s})}}},options={ctor:function(){var e;switch(this._super(cleverapps.Environment.SCENE_METHA),cleverapps.metha.getType()){case Metha.FARM:e=cleverapps.farm;break;case Metha.HOMEFIX:e=cleverapps.home}switch(this.map=new WorldMap(e),this.map.setPositionRound(this.scene.width/2,this.scene.height/2),this.map.setLocalZOrder(-1),this.scene.addChild(this.map),this.addPlayButton(),cleverapps.metha.getType()){case Metha.FARM:this.controller=new FarmController(this.map);break;case Metha.HOMEFIX:this.controller=new HomeController(this.map),
this.addTasksIcon(),this.map.animateNewTask=this.createListener(this.animateNewTask.bind(this)),this.createFinger()}-1!==[Metha.FARM,Metha.HOMEFIX].indexOf(cleverapps.metha.getType())&&this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.city_loop_effect)}),new cc.DelayTime(5))))},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.metha.withSimpleMain()?cleverapps.scenes.replaceScene(new NoMainMethaScene,e):cleverapps.metha.gotoMainScene(e)}},onExit:function(){this._super(),this.controller.clear()},addPlayButton:function(){this.playButton=new PlayButtonView({isSmall:"wordsoup"===cleverapps.config.name,hard:"heroes"!==cleverapps.config.name}),this.scene.addChild(this.playButton)},addTasksIcon:function(){this.tasksIcon=new HomeTasksIcon(this.scene),this.scene.addChild(this.tasksIcon)},setFinger:function(){var e=cleverapps.home.getFurnitureToUpgrade(
)?this.tasksIcon.hideHandler.originalPosition:this.playButton.hideHandler.originalPosition;this.finger.setPositionRound(e)},createFinger:function(){var e=this.finger=new FingerView({control:"homefix_finger"});this.scene.addChild(e,1),cleverapps.styles.MethaScene.finger.scale&&e.setScale(cleverapps.styles.MethaScene.finger.scale),e.standardLoop(),cleverapps.metha.registerControl("finger_position_update",this.tasksIcon.createListener(function(){this.setFinger()}.bind(this)))},animateNewTask:function(e){var t=new NewTaskAnimation(e,this);this.scene.addChild(t),t.setPositionRound(cleverapps.styles.MethaScene.newTask)},displayIntro:function(e){this.controller.displayIntro(e)},getBackgroundStyles:function(){}},MethaScene=MainScene.extend(options),NoMainMethaScene=cleverapps.FixedWidthScene.extend(options);MethaScene.BUNDLES=NoMainMethaScene.BUNDLES=function(){var e=["homefix","world_map","dialogues","main"];switch(cleverapps.metha.getType()){case Metha.FARM:e.push("farm_windows");break
;case Metha.HOMEFIX:e.push("homefix_windows")}for(var t=0;bundles["metha_top_layer_"+t];t++)e.push("metha_top_layer_"+t);for(var s=0;bundles["metha_bottom_layer_"+s];s++)e.push("metha_bottom_layer_"+s);return e},cleverapps.styles.MethaScene={newTask:{x:{align:"right",dx:-50},y:{align:"top",dy:-50}}};var MethaSimpleMainScene=MainScene.extend({ctor:function(){this._super(),this.addPersons(),this.addPlayButton()},addPersons:function(){var e=cleverapps.styles.MethaSimpleMainScene.persons;if(e)for(var t in e){var s=e[t],i=new cleverapps.Spine(s.json);i.setAnimation(0,"animation",!0),i.setPositionRound(s),this.scene.addChild(i)}},getBackgroundStyles:function(){return cleverapps.styles.MethaSimpleMainScene.background},addPlayButton:function(){var e=new PlayButtonView({styles:cleverapps.styles.MethaSimpleMainScene.PlayButton});this.scene.addChild(e),e.addFingerTip()}});MethaSimpleMainScene.BUNDLES=["metha_simple_main","main"],cleverapps.styles.MethaSimpleMainScene={PlayButton:{width:300,
height:100,x:{align:"center"},y:{align:"bottom",dy:150},text:{paddingX:20},button:{button_png:bundles.buttons.frames.green_button_png,button_on_png:bundles.buttons.frames.green_button_on_png,x:{align:"center"},y:{align:"center"}}},background:{background:bundles.metha_simple_main.urls.background}};var PlayButtonView=cc.Node.extend({ctor:function(e){this._super(),this.options=e||{},this.styles=this.options.styles?this.options.styles:cleverapps.styles.PlayButtonView,this.isSmall=this.options.isSmall,this.noLevelNumber=cleverapps.metha.getType()===Metha.KNOCKOUT||cleverapps.metha.getType()===Metha.HOSE&&cleverapps.user.isPassedAll(),this.setAnchorPoint2(),this.setContentSize2(this.styles),this.setPositionRound(this.calcPosition()),cleverapps.UI.makeHideable(this,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("play_button",this),cleverapps.playButton.on("update",this.update.bind(this),this),cleverapps.playButton.on("animatePassLevel",this.animatePassLevel.bind(this),this),
this.update()},update:function(){this.styling=this.getStyling(),this.createButton(),this.createAnimation(),this.styles.button||(cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,function(){cleverapps.playButton.onClick()}))},calcPosition:function(){var e=this.styles;return e.noToolBarPosition&&cleverapps.metha.withSimpleMain()&&(e=e.noToolBarPosition),e=e.positions?e.positions[cleverapps.wideMode.mode]:e,(e=cc.p(cleverapps.clone(e.x),cleverapps.clone(e.y))).y.dy-=cleverapps.UI.getSceneOffsetY(),e},animatePassLevel:function(){if(this.button&&this.button.stopAllActions(),this.stopAllActions(),this.show(!0),!this.isSmall&&!this.noLevelNumber){var e=new cleverapps.Spine(bundles.main.jsons.play_button_transition_json);this.addChild(e),e.setPositionRound(this.width/2,this.height/2),e.runAction(new cc.Sequence(new cc.DelayTime(.6),new cc.CallFunc(function(){e.setAnimation(0,"animation",!1),e.setCompleteListenerRemove()})))}this.runAction(new cc.Sequence(this.listAnimationActions()))},
listAnimationActions:function(){if(this.noLevelNumber)return[new cc.DelayTime(1.1),new cc.CallFunc(this.updateTextAndButton.bind(this)),new cc.CallFunc(this.onPassLevelAnimationFinished.bind(this))];var e=this.scale;return[new cc.DelayTime(1.1),new cc.ScaleTo(.15,1.3*e),new cc.CallFunc(this.updateTextAndButton.bind(this)),new cc.PlaySound(bundles.main.urls.play_button_effect),new cc.ScaleTo(.2,e),new cc.CallFunc(this.onPassLevelAnimationFinished.bind(this))]},updateTextAndButton:function(){this.styling=this.getStyling(),this.text.setFontSize(this.getFont().size),this.text.setString(this.getTextMsg()),this.text.fitTo(this.styles.width-2*this.styles.text.paddingX,this.styles.height-2*this.styles.text.paddingY),this.animation?this.animation.setAnimation(0,this.styling.animation,!0):(this.button.setBackgroundImage(this.styling.button_png),this.button.setBackgroundImagePressed(this.styling.button_on_png))},onPassLevelAnimationFinished:function(){},addFingerTip:function(){
var e=new FingerView({control:"playbutton_finger",showDelay:.5});e.setLocalZOrder(14),this.getParent().fingerTip=e,this.getParent().addChild(e),e.setPositionRound(this.hideHandler.originalPosition),e.standardLoop({delay:5,delayOnBegin:.1})},createAnimation:function(){if(this.styles.animation){this.animation&&this.animation.removeFromParent();var e=this.animation=new cleverapps.Spine(bundles.main.jsons.play_button_json);e.setAnimation(0,this.styling.animation,!0),this.addChild(e),e.setPositionRound(this.width/2,this.height/2),this.styles.button||(this.text=this.createText(),this.text.setPositionRound(this.width/2,this.height/2),this.addChild(this.text))}},createButton:function(){if(this.styles.button){this.button&&this.button.removeFromParent(),this.text=this.createText();var e={width:this.styles.width,height:this.styles.height,contentOffset:this.styles.button.contentOffset,content:this.text,fitTo:!1,button_png:this.styling.button_png,button_on_png:this.styling.button_on_png,
onClicked:function(){cleverapps.playButton.onClick()}},t=this.button=new cleverapps.UI.Button(e);this.addChild(t),t.setPositionRound(this.styles.button)}},getTextMsg:function(){var e=cleverapps.playButton.getLevelNo(),t=this.getDisplayedLevel(),s=this.noLevelNumber?"messages:Play":"messages:PlayButton.text";return t.isHard()&&!1!==this.options.hard&&(s="messages:message.hardLevel"),t.isTricky()&&(s="messages:message.trickyLevel"),this.isSmall&&(s=e),Messages.getLocalized(s,{levelNo:e})},getDisplayedLevel:function(){return cleverapps.playButton.passedLevel&&cleverapps.playButton.previousLevel?cleverapps.playButton.previousLevel:cleverapps.playButton.currentLevel},getStyling:function(){var e=this.getDisplayedLevel();return this.styles.animation?{animation:e.isHard()&&this.styles.animation.customHard?"hard":"animation"}:e.isHard()?{button_png:this.styles.button.hardLvl&&this.styles.button.hardLvl.button_png||this.styles.button.button_png||bundles.buttons.frames.window_button_png,
button_on_png:this.styles.button.hardLvl&&this.styles.button.hardLvl.button_on_png||this.styles.button.button_on_png||bundles.buttons.frames.window_button_on_png}:e.isTricky()?{button_png:bundles.buttons_main.frames.play_button_tricky_png,button_on_png:bundles.buttons_main.frames.play_button_tricky_on_png}:{button_png:this.styles.button.button_png||bundles.buttons.frames.window_button_png,button_on_png:this.styles.button.button_on_png||bundles.buttons.frames.window_button_on_png}},getFont:function(){if(this.isSmall)return cleverapps.styles.FONTS.SMALL_PLAY_BUTTON_TEXT;var e=this.getDisplayedLevel();return e.isHard()&&cleverapps.styles.FONTS.PLAY_BUTTON_TEXT_HARD?cleverapps.styles.FONTS.PLAY_BUTTON_TEXT_HARD:e.isTricky()&&cleverapps.styles.FONTS.PLAY_BUTTON_TEXT_TRICKY?cleverapps.styles.FONTS.PLAY_BUTTON_TEXT_TRICKY:cleverapps.styles.FONTS.PLAY_BUTTON_TEXT},createText:function(){var e=cleverapps.UI.generateTTFText(this.getTextMsg(),this.getFont());return e.fitTo(
this.styles.width-2*this.styles.text.paddingX,this.styles.height-2*this.styles.text.paddingY),e}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{PLAY_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SMALL_PLAY_BUTTON_TEXT:{}}),cleverapps.styles.PlayButtonView={width:300,height:100,x:{align:"center"},y:{align:"bottom",dy:150},text:{paddingX:30,paddingY:0},button:{x:{align:"center"},y:{align:"center"}}};var PlayButton=function(){cleverapps.EventEmitter.call(this),cleverapps.user.on("incLevel",this.onIncLevel.bind(this)),levels.episodes.onResetListener=this.update.bind(this),this.update()};PlayButton.prototype=Object.create(cleverapps.EventEmitter.prototype),(PlayButton.prototype.constructor=PlayButton).prototype.onIncLevel=function(){this.incLevelDisabled||(this.passedLevel=!0,this.update())},PlayButton.prototype.enableIncLevel=function(){delete this.incLevelDisabled},PlayButton.prototype.disableIncLevel=function(){
this.incLevelDisabled=!0},PlayButton.prototype.getLevelNo=function(){var e=cleverapps.user.getVirtualDisplayLevel();return this.passedLevel&&e--,e},PlayButton.prototype.update=function(){if(PlayButton.IsAvailable()){var e=cleverapps.user.getCurrentLevel();this.currentLevel&&this.currentLevel.episodeNo===e.episodeNo&&this.currentLevel.levelNo===e.levelNo||(this.currentLevel&&(this.previousLevel=this.currentLevel),this.currentLevel=new Episode(e.episodeNo,e.levelNo).getLevel(),this.trigger("update"))}},PlayButton.prototype.onClick=function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),cleverapps.metha.display({focus:"PlayButton_scene",action:function(e){cleverapps.metha.wantsToPlay(e)}})},PlayButton.prototype.animatePassLevel=function(){this.passedLevel=!1,this.trigger("animatePassLevel")},PlayButton.IsAvailable=function(){return cleverapps.metha.getType()!==Metha.NONE};var AllDoneWindow=Window.extend({onWindowLoaded:function(){this._super({
title:"messages:AllDoneWindow.title",name:"alldonewindow",content:this.getContent(),button:{width:cleverapps.styles.AllDoneWindow.button.width,height:cleverapps.styles.AllDoneWindow.button.height,text:Messages.get("Play"),onPressed:function(){this.close(),cleverapps.metha.distract({focus:"PlayButton",action:function(e){cleverapps.metha.wantsToPlay(e)}.bind(this)})}.bind(this)}})},getContent:function(){return new cleverapps.Layout([this.getText(),this.getAnimation()],{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.AllDoneWindow.margin,padding:cleverapps.styles.AllDoneWindow.padding})},getText:function(){var e=cleverapps.UI.generateTTFText("messages:AllDoneWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT);return e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setDimensions(cleverapps.styles.AllDoneWindow.text.width,0),e},getAnimation:function(){var e=cleverapps.styles.AllDoneWindow.animation,t=new cleverapps.Spine(e.json);return t.setAnimation(0,e.animationName,!0),t},
listBundles:function(){return["episode_coming_soon"]}});cleverapps.styles.AllDoneWindow={margin:20,padding:{bottom:50},text:{width:550},button:{width:300,height:100},animation:{animationName:"animation",json:bundles.episode_coming_soon.jsons.spine_0_json}};var WorldMap=MapScrollView.extend({ctor:function(e){this._super();var t,s,i=cc.director.getWinSize();if(this.setContentSize2(i),this.setAnchorPoint2(),s={width:(t=cc.loader.getRes(bundles.world_map.jsons.mapData)).map.width*resolutionScale,height:t.map.height*resolutionScale},this.setContainerSize(s),bundles.world_map.urls.map){var n=new cc.Sprite(bundles.world_map.urls.map);n.setScale(s.width/n.width),n.setPositionRound(this.innerWidth/2,this.innerHeight/2),this.container.addChild(n)}this.addBgs(t),this.buildingViews={},this.setZoom(cleverapps.styles.WorldMap.zoom.unfocused),this.onEnterStart=function(){},this.animateNewTask=function(){}},addBgs:function(e){for(var t=0;t<=30;t++){var s;if(cleverapps.metha.getType(
)===Metha.FARM?s=bundles.metha_top_layer_0.jsons["map_json"+t]:cleverapps.metha.getType()===Metha.HOMEFIX&&(s=bundles.world_map.jsons["map_json"+t]||bundles.world_map_nodither.jsons["map_json"+t]),s){var i=new cleverapps.Spine(s,1);if(i.setAnimation(0,"animation",!0),e["map_json"+t]){var n=e["map_json"+t],o=new cc.Node;o.setAnchorPoint2(),o.setContentSize2(n.width*resolutionScale,n.height*resolutionScale),i.setPosition(o.width/2,o.height/2),o.addChild(i),o.setPosition(this.innerWidth/2+n.x*resolutionScale,this.innerHeight/2+n.y*resolutionScale),this.container.addChild(o,n.zOrder)}else i.setPosition(this.innerWidth/2,this.innerHeight/2),this.container.addChild(i)}}},highlight:function(e){e.addHighlight()},unhighlight:function(e){e.removeHighlight()},onEnter:function(){this._super(),cleverapps.config.debugMode&&cc.eventManager.addListener({event:cc.EventListener.KEYBOARD,onKeyPressed:function(e){if(e===cc.KEY.b&&!this.bordered)for(var t in this.bordered=!0,this.buildingViews){
this.buildingViews[t].debugBorder();var s=this.buildingViews[t].building.id,i=this.buildingViews[t].building.amountStages();if(cleverapps.home)for(var n=0;n<cleverapps.home.furniture.length;n++)if(cleverapps.home.furniture[n].id===this.buildingViews[t].building.id){s=n;break}var o=cleverapps.UI.generateImageText(s,cleverapps.styles.FONTS.BIG_TEXT),r=cleverapps.UI.generateOnlyText("Stages: "+i,cleverapps.styles.FONTS.TEXT),a=new cleverapps.Layout([r,o],{direction:cleverapps.UI.VERTICAL,margin:0});this.buildingViews[t].addChild(a,10),a.setPositionRound(this.buildingViews[t].width/2,this.buildingViews[t].height/2),a.replaceParentSamePlace(this.buildingViews[t].parent),this.buildingViews[t].idView=a}}.bind(this),onKeyReleased:function(e){if(e===cc.KEY.b)for(var t in this.bordered=!1,this.buildingViews)this.buildingViews[t].cleanupBorder(),this.buildingViews[t].idView.removeFromParent()}.bind(this)},this),this.onEnterStart()},availableScrollPosition:function(e){var t=this.getContainerSize()
,s=t.width-this.width,i=t.height-this.height;return 0<e.x?e.x=0:e.x<-s&&(e.x=-s),0<e.y?e.y=0:e.y<-i&&(e.y=-i),e},scrollTo:function(e,t,s){if(e){t||cleverapps.metha.isFocused()||(console.log("Scroll:",e),cleverapps.metha.debugMessage("Trying to scroll without user focus!"));var i=cleverapps.metha.focus,n=this.buildingViews[e.name].getPosition(),o={x:this.width/2-n.x,y:this.height/2-n.y};if(o=this.availableScrollPosition(o),t)this.setContainerPosition({x:o.x,y:o.y}),s&&s();else{var r=this.getContainerPosition();r.x-=o.x,r.y-=o.y;var a=Math.sqrt(r.x*r.x+r.y*r.y)/1300;a=Math.min(.7,Math.max(.3,a)),this.container.stopAllActions(),this.container.runAction(new cc.Spawn(new cc.MoveTo(a,o.x,o.y).easing(new cc.easeInOut(2.5)),new cc.Repeat(new cc.Sequence(new cc.DelayTime(.025),new cc.CallFunc(this.updateChildren.bind(this))),Math.ceil(a/.025))));var c=new Error;this.runAction(new cc.Sequence(new cc.DelayTime(.45*a||.5),new cc.CallFunc(function(){cleverapps.metha.isFocused(
)&&cleverapps.metha.focus===i||(console.log("Scroll:",e,i,cleverapps.metha.focus),cleverapps.throwAsync("Trying to scroll without user focus! Focus: "+cleverapps.metha.focus+" StartFocus: "+i,c)),s&&s()}.bind(this))))}}},showBuildings:function(i){var s=[];i.forEach(function(e,t){e.isComplete()&&e.throwaway||s.push(t)}),s.sort(function(e,t){return i[t].y-i[e].y}.bind(this)),s.forEach(function(e){var t=i[e],s=new BuildingView(t,this);this.buildingViews[t.name]=s,this.container.addChild(s)},this)},removeBuilding:function(e){var t=this.buildingViews[e.name];t&&(t.runAction(new cc.RemoveSelf),delete this.buildingViews[e.name])},removeTarget:function(){this.finger&&(this.finger.removeFromParent(),delete this.finger)},addTarget:function(e){this.removeTarget();var t=this.finger=new FingerView({control:"world_map_finger"});this.container.addChild(t),t.standardLoop();var s=this.buildingViews[e.name].getPosition();t.setPositionRound(s)},findClickedBuilding:function(e){var t;for(
var s in this.buildingViews){var i=this.buildingViews[s];i.building.canTouch()&&((!t||t.getLocalZOrder()<=i.getLocalZOrder())&&cc.rectContainsPoint(cc.rect(0,0,i.width,i.height),i.convertTouchToNodeSpace(e))&&(t=i))}return t},onTouchBegan:function(e){if(this._super(e))return this.clickedBuilding=this.findClickedBuilding(e),!0},onTouchMoved:function(e){this._super(e),cc.pLength(cc.pSub(e.getStartLocation(),e.getPreviousLocation()))>cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold&&delete this.clickedBuilding},onTouchEnded:function(e){this._super(e),this.clickedBuilding&&!this.pinchZooming&&(this.scrollHandler.stopAutoScroll(),this.clickedBuilding.building.onClick()),delete this.clickedBuilding}});cleverapps.styles.WorldMap={personsAnimation:"animation",persons:{},zoom:{base:1,unfocused:.7,minScale:.5}};var MissionGame=function(e){this.mission=e,BaseGame.call(this)};MissionGame.prototype=Object.create(BaseGame.prototype),(MissionGame.prototype.constructor=MissionGame
).prototype.finish=function(){this.running&&0<this.reward&&this.mission.update(this.reward),BaseGame.prototype.finish.apply(this,arguments)};var TreasureSearchWindow=Window.extend({onWindowLoaded:function(e){this.bundle=bundles[e.getWindowBundleName()],this.game=new TreasureSearch(e),this.game.on("open",this.open.bind(this)),this.game.on("prize",this.prize.bind(this)),this.game.on("finish",this.finish.bind(this)),this.generateContent();var t=cleverapps.styles.TreasureSearchWindow,s={title:"messages:TreasureSearchWindow.Title",name:"treasuresearchwindow",content:this.content,closeButton:t.closeButton,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.TreasureSearchWindow.window,!0),help:this.onClickHelp.bind(this)};t.button&&(s.button={width:t.button.width,text:Messages.get(t.button.text),onPressed:this.close.bind(this)}),this._super(s),this.controls(),e.isRunning()&&(this.timer=new cleverapps.CountDown(e.getTimeLeft(),{onFinish:function(){this.close()}.bind(
this)})),this.game.isFinished()&&this.game.finish({silent:!0}),e.needShowStartWindow=!1,cleverapps.audio.playSound(bundles.main.urls.treasure_search_effect)},onExit:function(){this._super(),this.timer&&this.timer.stop()},controls:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchEnded:this.onTouchEnded.bind(this)},this.fieldNode),cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:this.onMouseMove.bind(this)},this.fieldNode)},calculateIndex:function(e){var t=this.fieldNode.convertTouchToNodeSpace(e),s=cc.rect(0,0,this.fieldNode.width,this.fieldNode.height);if(cc.rectContainsPoint(s,t)){var i=cleverapps.styles.TreasureSearchWindow.game.cell,n=Math.floor(t.x/i.width),o=Math.floor(t.y/i.height);return{row:Math.max(Math.min(o,TreasureSearch.HEIGHT-1),0),col:Math.max(Math.min(n,TreasureSearch.WIDTH-1),0)}}},onTouchBegan:function(e){return!(!this.game.running||this.game.paused
)&&void 0!==this.calculateIndex(e)},onTouchEnded:function(e){if(this.game.running&&!this.game.paused){var t=this.calculateIndex(e);t&&this.onFieldClick(t.col,t.row)}},getPositionInContent:function(e){return this.content.convertToNodeSpace(e.getParent().convertToWorldSpace(e.getPosition()))},processPointer:function(){var e=this.field[this.index.row][this.index.col];this.pointer||this.createPointer(e),this.pointer.setPositionRound(this.getPositionInContent(e)),this.pointer.setVisible(!0),this.pointer.updateState(e)},createPointer:function(e){var t=cleverapps.styles.TreasureSearchWindow;if(t.pointerJson){this.pointer=new cc.Node,this.pointer.setAnchorPoint2(),this.pointer.setContentSize2(e.cover.getContentSize());var s=new cleverapps.Spine(t.pointerJson);this.pointer.addChild(s),s.setPositionRound(this.pointer.width/2,this.pointer.height/2),this.pointer.updateState=function(){s.setAnimation(0,"animation",!1),cleverapps.audio.playSound(this.bundle.urls.shot_sfx)}.bind(this)}else{
this.pointer=new cc.Sprite(e.cover.getSpriteFrame()),this.pointer.setScale(this.fieldNode.scale);var i=new cc.Sprite(this.bundle.frames.cross);i.setPosition(this.pointer.width/2,this.pointer.height/2),this.pointer.addChild(i);var n=new cc.Sprite(this.bundle.frames.hover_bottom);n.setPosition(this.pointer.width/2,this.pointer.height/2),this.pointer.addChild(n,-1),n.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.7,1.04),new cc.ScaleTo(.8,.95).easing(cc.easeInOut(1))))),this.pointer.updateState=function(e){this.pointer.setSpriteFrame(e.cover.getSpriteFrame())}.bind(this)}this.pointer.setLocalZOrder(21),this.content.addChild(this.pointer)},onMouseMove:function(e){if(this.game.running&&!this.game.paused){var t=this.calculateIndex(e);t&&this.game.hasElement(t.col,t.row)?void 0!==this.index&&100*t.row+t.col===100*this.index.row+this.index.col||(this.index=t,this.processPointer()):(this.pointer&&this.pointer.setVisible(!1),this.index=void 0)}},generateContent:function(){
var e=cleverapps.styles.TreasureSearchWindow.content,t=this.createGame(),s=this.text=cleverapps.UI.generateTTFText("messages:TreasureSearchWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);if(s.setDimensions(t.width*e.text.widthMultiplier[cleverapps.wideMode.mode],0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content=new cleverapps.Layout([s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding}),e.successAnimation){var i=this.succesAnimation=new cleverapps.Spine(this.bundle.jsons.chest),n=this.content.convertToNodeSpace(this.fieldNode.getParent().convertToWorldSpace(this.fieldNode.getPosition()));i.setPosition(n),i.setVisible(!1),i.setLocalZOrder(22),this.content.addChild(i)}},createGame:function(){var e=cleverapps.styles.TreasureSearchWindow,t=this.fieldNode=this.createField(),s=this.infoNode=this.createGameInfo();return new cleverapps.Layout([t,s],{direction:cleverapps.UI.VERTICAL,margin:e.game.margin})},createField:function(){this.field=[];for(
var e=0;e<TreasureSearch.HEIGHT;e++){for(var t=[],s=0;s<TreasureSearch.WIDTH;s++){var i=this.createCell();t.push(i),this.game.hasElement(s,e)?this.createActiveCellContent(s,e,i):this.createOpenedCellContent(s,e,i,!0)}this.field.push(t)}var n=this.field.map(function(e){return new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL})}),o=this.fieldNode=new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL});if(this.bundle.frames.map){var r=new cc.Sprite(this.bundle.frames.map);r.setPosition(o.width/2,o.height/2),r.setLocalZOrder(-1),o.addChild(r),o.setScale(cleverapps.styles.TreasureSearchWindow.game.field.scale[cleverapps.wideMode.mode])}return o},createCell:function(){var e=new cc.Node;return e.setAnchorPoint2(),e.setContentSize2(cleverapps.styles.TreasureSearchWindow.game.cell),e},createActiveCellContent:function(e,t,s){var i=s.cover=new cc.Sprite(this.bundle.frames["cover_"+(TreasureSearch.WIDTH*t+e)]);i.setPosition(s.width/2,s.height/2),s.addChild(i)},
createOpenedCellContent:function(e,t,s,i){if(this.game.gemWasThere(e,t)){var n=new cc.Sprite(this.bundle.frames.cross);n.setPosition(s.width/2,s.height/2),s.addChild(n),i||(n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.ScaleTo(.4,1).easing(cc.easeBackOut()))))}},onFieldClick:function(e,t){this.game.mission.currency>=this.game.mission.getMinigamePrice()?this.game.hasElement(e,t)&&(this.game.open(e,t),cleverapps.audio.playSound(bundles.main.urls.treasure_search_open_effect)):(this.field[t][e].setScale(1),new TellWindow({type:"notEnoughElements",text:"messages:TreasureSearchWindow.Currency.Text",title:"messages:TreasureSearchWindow.Currency.Title",buttonText:Messages.get("Play"),onPressed:function(){this.close(),cleverapps.metha.distract({focus:"TreasurePlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e,{mission:!0})}})}.bind(this)}))},onClickHelp:function(){var e=cleverapps.styles.TreasureSearchWindow.rulesWindow
;e.animation.json=bundles.treasuresearch.jsons.help,new RulesWindow({name:"ruleswindow",styles:e})},createGameInfo:function(){var e=cleverapps.styles.TreasureSearchWindow.game.infoNode,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.chest),this.chest=new cleverapps.Spine(this.bundle.jsons.chest),this.chest.setAnimation(0,"idle_"+this.game.mission.result,!0),t.addChild(this.chest),this.chest.setPositionRound(t.width/2,t.height/2+e.chest.offsetY);var s=new cc.Node;s.setAnchorPoint2(),s.setPositionRound(t.width/2,t.height/2),s.setContentSize2(e.tooltip),t.addChild(s),cleverapps.tooltipManager.create(s,{rewards:this.game.getReward(),text:Messages.get("TreasureSearch.prizeTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.above});var i=this.amountText=cleverapps.UI.generateImageText(this.game.mission.currency,cleverapps.styles.FONTS.SHOVEL_FONT);i.setPositionRound(e.shovelCount),t.addChild(i);var n=new cc.Sprite(this.bundle.frames.shovel);return n.setPositionRound(e.shovel),
t.addChild(n),cleverapps.tooltipManager.create(n,{text:Messages.get("ShovelsTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),t},open:function(e){var t=this.field[e.row][e.col];this.pointer&&this.pointer.setVisible(!1),t.runAction(new cc.Sequence(new cc.CallFunc(function(){var e=this.clouds=new cleverapps.Spine(this.bundle.jsons.clouds);e.setLocalZOrder(21),this.content.addChild(e),e.setCompleteListener(function(){e.runAction(new cc.RemoveSelf)}.bind(this)),e.setAnimation(0,"animation",!1),e.setPosition(this.getPositionInContent(t))}.bind(this)),new cc.DelayTime(.05),new cc.CallFunc(function(){t.cover&&t.cover.setVisible(!1)}))),this.amountText.setString(this.game.mission.currency)},prize:function(e){var t=this.field[e.row][e.col];this.createOpenedCellContent(e.col,e.row,t),this.runAction(new cc.Spawn(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.succesAnimation&&(this.succesAnimation.setCompleteListener(function(){
this.succesAnimation.setCompleteListener(function(){}),this.succesAnimation.setVisible(!1)}.bind(this)),this.succesAnimation.setAnimation(0,cleverapps.styles.TreasureSearchWindow.content.successAnimation,!1),this.succesAnimation.setVisible(!0)),cleverapps.audio.playSound(bundles.main.urls.treasure_search_found_effect)}.bind(this))),new cc.Sequence(new cc.DelayTime(1.65),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.treasure_search_part_effect),this.chest.setAnimation(0,"animation_"+this.game.mission.result,!1),this.chest.addAnimation(0,"idle_"+this.game.mission.result,!0)}.bind(this)),new cc.DelayTime(1.5),new cc.CallFunc(function(){this.game.isFinished()&&cleverapps.audio.playSound(bundles.main.urls.treasure_search_prize_effect)}.bind(this)))))},finish:function(e){this.runAction(new cc.Sequence(new cc.DelayTime(e&&e.silent?.1:3.6),new cc.CallFunc(function(){this.close()}.bind(this))))},onClose:function(){this.game.checkIfComplete()}})
;TreasureSearchWindow.prototype.listBundles=function(){return["treasuresearch"]},cleverapps.overrideFonts(cleverapps.styles.FONTS,{SHOVEL_FONT:{name:"default",size:40}}),cleverapps.styles.TreasureSearchWindow={content:{margin:10,padding:{x:0,y:45},text:{widthMultiplier:[.8,.9,.9]},successAnimation:"key"},game:{margin:0,cell:{width:116,height:96},field:{scale:[1.2,1.15,1.15]},infoNode:{shovelCount:{x:{align:"center",dx:285},y:{align:"center",dy:12}},shovel:{x:{align:"center",dx:240},y:{align:"center",dy:26}},chest:{width:570,height:285,offsetY:0},tooltip:{width:300,height:180}}},rulesWindow:{prefix:"messages:TreasureSearchWindow.Help.",bundles:["treasuresearch"],animation:{height:630,y:-145},subText:{width:220,left:{x:{align:"left",dx:0},y:{align:"top",dy:-245}},right:{x:{align:"right",dx:10},y:{align:"top",dy:-245}}}},window:{contentOffset:-30,Title:{bg:{adjustToText:{width:50}}},Border:{y:50}}};var TreasureSearch=function(e){MissionGame.call(this,e),this.width=TreasureSearch.WIDTH,
this.height=TreasureSearch.HEIGHT,this.field=e.details&&e.details.field,this.field||this.createField()};TreasureSearch.prototype=Object.create(MissionGame.prototype),(TreasureSearch.prototype.constructor=TreasureSearch).prototype.createField=function(){for(var e=[];e.length<TreasureSearch.GEMS;){var t=cleverapps.Random.random(0,19);-1===e.indexOf(t)&&e.push(t)}this.field=[];for(var s=0;s<TreasureSearch.HEIGHT;s++){this.field[s]=[];for(var i=0;i<TreasureSearch.WIDTH;i++){var n=TreasureSearch.ELEMENT_EMPTY;-1!==e.indexOf(s*TreasureSearch.WIDTH+i)&&(n=TreasureSearch.ELEMENT_GEM),this.field[s][i]=n}}this.mission.details={field:this.field}},TreasureSearch.prototype.open=function(e,t){if(this.hasElement(e,t)){var s=this.field[t][e];this.field[t][e]=TreasureSearch.ELEMENT_GEM===s?TreasureSearch.ELEMENT_FOUND:TreasureSearch.ELEMENT_OPENED,this.mission.updateCurrency(-this.mission.getMinigamePrice(),{field:this.field});var i={row:t,col:e};this.trigger("open",i),this.pause();var n=1e3
;TreasureSearch.ELEMENT_GEM===s&&(this.mission.update(1),this.trigger("prize",{row:t,col:e,score:this.mission.result}),n=3e3),setTimeout(this.resume.bind(this),n),this.isFinished()&&this.finish()}},TreasureSearch.prototype.checkIfComplete=function(){this.isFinished()&&this.mission.isRunning()&&(this.mission.complete(),-1!==["olympics","tripeaks"].indexOf(cleverapps.config.name)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TREASURE_SEARCH_FINISH),new RewardWindow({reward:this.getReward(),mission:this.mission}))},TreasureSearch.prototype.getReward=function(){return this.mission.getPrize()},TreasureSearch.prototype.hasElement=function(e,t){return this.field[t]&&void 0!==this.field[t][e]&&this.field[t][e]!==TreasureSearch.ELEMENT_OPENED&&!this.gemWasThere(e,t)},TreasureSearch.prototype.gemWasThere=function(e,t){return this.field[t]&&void 0!==this.field[t][e]&&this.field[t][e]===TreasureSearch.ELEMENT_FOUND},TreasureSearch.prototype.isFinished=function(){if(
this.mission.result>=TreasureSearch.GEMS)return!0;if(this.field){for(var e=0,t=0,s=0;s<TreasureSearch.WIDTH;s++)for(var i=0;i<TreasureSearch.HEIGHT;i++)this.hasElement(s,i)&&e++,this.gemWasThere(s,i)&&t++;return 0===e||t>=TreasureSearch.GEMS}return!1},TreasureSearch.WIDTH=5,TreasureSearch.HEIGHT=4,TreasureSearch.GEMS=4,TreasureSearch.ELEMENT_EMPTY="e",TreasureSearch.ELEMENT_OPENED="o",TreasureSearch.ELEMENT_FOUND="f",TreasureSearch.ELEMENT_GEM="g",TreasureSearch.ALL_ELEMENT_VALUES=[TreasureSearch.ELEMENT_EMPTY,TreasureSearch.ELEMENT_OPENED,TreasureSearch.ELEMENT_FOUND,TreasureSearch.ELEMENT_GEM];var StickersCollectionWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.StickersCollectionWindow;this.game=new StickersCollection(e),this.generateContent();var s={title:"messages:StickersCollectionWindow.Title",name:"stickerscollectionwindow",content:this.content,closeButton:t.closeButton,notCloseByTouchInShadow:!0,styles:cleverapps.overrideStyles(cleverapps.styles.Window
,cleverapps.styles.StickersCollectionWindow.window,!0),help:this.onClickHelp.bind(this)};t.button&&(s.button={width:t.button.width,text:Messages.get(t.button.text),onPressed:this.close.bind(this)}),this._super(s),e.isRunning()&&(this.timer=new cleverapps.CountDown(e.getTimeLeft(),{onFinish:function(){this.close()}.bind(this)})),this.game.isFinished()&&this.game.finish({silent:!0}),e.needShowStartWindow=!1,cleverapps.audio.playSound(bundles.main.urls.stickers_collection_effect)},onExit:function(){this._super(),this.timer&&this.timer.stop()},onClose:function(){this.game.checkIfComplete()},onClickHelp:function(){new MissionRulesWindow(this.game.mission)},generateContent:function(){var e=cleverapps.styles.StickersCollectionWindow,t=this.createBook(),s=cleverapps.UI.generateOnlyText("messages:StickersCollectionWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(e.book.width,0);var i=e.progressBar,
n=cleverapps.UI.generateOnlyText("messages:MissionRulesWindow.StickersCollection.leftToPrize",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(i.size.width,0);var o=Math.min(this.game.mission.result,StickersCollection.GEMS),r=new ScaledProgressBar(bundles.stickers_collection.frames.progress_bar);r.setMinProgressWidth(i.bar.minWidth),r.setPercentage(o/StickersCollection.GEMS*100),r.setDimension(i.size.width-i.bar.paddingX,i.size.height-i.bar.paddingY),r.setPositionRound(i.bar);var a=cleverapps.UI.generateImageText(o+"/"+StickersCollection.GEMS,cleverapps.styles.FONTS.TREASURE_SEARCH_PROGRESS_BAR_TEXT);a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),a.setPositionRound(i.text);var c=new cleverapps.Spine(i.gift.json);c.setSkin(i.gift.skin),c.setAnimation(0,"animation",!0),c.setPositionRound({align:"right",dx:c.width+i.gift.offsetX},{align:"center",dy:i.gift.offsetY}),c.setScale(i.gift.scale),cleverapps.tooltipManager.create(c,
{rewards:this.game.getReward(),text:Messages.get("StickersCollectionWindow.prizeTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.above,size:e.tooltipSize});var l=cleverapps.UI.createScale9Sprite(bundles.stickers_collection.frames.progress_bar_bg);l.setContentSize2(i.size),l.addChild(r),l.addChild(a),l.addChild(c);var p=new cleverapps.Layout([l,n],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:{x:0,y:2*e.margin}});this.content=new cleverapps.Layout([p,s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin}),this.content.setLocalZOrder(2)},createBook:function(){var e=cleverapps.styles.StickersCollectionWindow,t=new cleverapps.Spine(bundles.stickers_collection.jsons.book,1);t.setAnimation(0,"animation",!1),t.addAnimation(0,"idle",!0),t.setPositionRound({align:"center"},{align:"center"});var s=this.bookNode=new cc.Node;if(s.setAnchorPoint2(),s.setContentSize2(e.book),s.addChild(t),bundles.stickers_collection.jsons.light){var i=new cleverapps.Spine(
bundles.stickers_collection.jsons.light,1);i.setAnimation(0,"animation",!1),i.setPositionRound({align:"center"},{align:"center"}),s.addChild(i)}return this.game.open(),s},listBundles:function(){return["stickers_collection"]}});cleverapps.styles.StickersCollectionWindow={window:{maxTitleSize:{scale:.65}},progressBar:{size:{width:410,height:52},gift:{json:bundles.windows.jsons.present_json,skin:"blue",scale:.9,offsetX:-60,offsetY:25},bar:{paddingX:5,paddingY:10,minWidth:40,x:{align:"left",dx:2},y:{align:"center"}},text:{x:{align:"center"},y:{align:"center"}}},margin:20,book:{width:600,height:400},closeButton:!1,button:{width:160,text:"OK"},tooltipSize:{width:200,height:100}};var StickersCollection=function(e){MissionGame.call(this,e)};StickersCollection.prototype=Object.create(MissionGame.prototype),(StickersCollection.prototype.constructor=StickersCollection).prototype.open=function(){var e=this.mission.currency;this.mission.updateCurrency(-e),this.mission.update(e),this.isFinished(
)&&this.finish()},StickersCollection.prototype.checkIfComplete=function(){this.isFinished()&&this.mission.isRunning()&&(this.mission.complete(),new RewardWindow({reward:this.getReward(),mission:this.mission}))},StickersCollection.prototype.isFinished=function(){return this.mission.result>=StickersCollection.GEMS},StickersCollection.prototype.getReward=function(){return this.mission.getPrize()},StickersCollection.GEMS=25,StickersCollection.GEMS_BY_PLACE={1:5,2:3,3:1};var StickersCollectionLogic=function(e){this.mission=e};StickersCollectionLogic.prototype.isMinigameReadyToFinish=function(){return this.mission.result+this.mission.currency>=StickersCollection.GEMS};var TellWindow=Window.extend({onWindowLoaded:function(e){this.params=e,this.createContent(),e={content:this.content,name:this.getName(),title:this.params.title,button:{width:cleverapps.styles.TellWindow.button.width,text:this.params.buttonText||Messages.get("OK"),onPressed:function(){this.close(),
this.params.onPressed&&this.params.onPressed()}.bind(this)}},cleverapps.styles.TellWindow.window&&(e.styles=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.TellWindow.window,!0)),cleverapps.audio.playSound(bundles.main.urls.window_effect),this._super(e)},getName:function(){return"tellwindow"},createContent:function(){var e=cleverapps.styles.TellWindow,t=this.createText(),s=[t];if(e.hero){var i=new HeroView(e.hero);i.setLocalZOrder(1),this.addChild(i)}else{var n=new StoryTeller;n.setLocalZOrder(1),n.setScale(e.char.scale[cleverapps.wideMode.mode]),s.unshift(n)}if(this.content=new cleverapps.Layout(s,{direction:cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?cleverapps.UI.VERTICAL:cleverapps.UI.HORIZONTAL,margin:e.margin[cleverapps.wideMode.mode]*resolutionScale,padding:{x:0,y:e.padding.y[cleverapps.wideMode.mode]*resolutionScale}}),n){if(cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL){var o=n.height-t.height;0<o&&(t.y+=o/4)}n.y+=e.char.dy}},
createText:function(){var e=cleverapps.styles.TellWindow;e.types&&e.types[this.params.type]&&(e=cleverapps.overrideStyles(e,e.types[this.params.type],!0));var t=cleverapps.UI.generateTTFText(this.params.text,cleverapps.styles.FONTS.WINDOW_TEXT);return t.setDimensions(e.text.width[cleverapps.wideMode.mode]*resolutionScale,0),t.setHorizontalAlignment(e.horizontalAlignment),t.fitTo(void 0,e.text.height[cleverapps.wideMode.mode]*resolutionScale),t},listBundles:function(){return StoryTeller.listBundles()}});cleverapps.styles.TellWindow={width:660,height:350,margin:[40,50,50],horizontalAlignment:cc.TEXT_ALIGNMENT_CENTER,padding:{y:[50,10,10]},char:{scale:[1,1,1],dy:0},text:{width:[600,450,450],height:[270,300,300]},button:{width:260}};var FriendRequestsWindow=Window.extend({onWindowLoaded:function(){var e=new cc.Node;e.setAnchorPoint2(),this.content=e,this.createViews(),this._super({name:"friendrequestswindow",content:e,noBackground:!0,onClose:function(){cleverapps.toolbar.updateItems()}})
;var t=cleverapps.FBLoginOrInvite();t&&this.addChild(t),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createViews:function(){var e=cleverapps.styles.FriendRequestsWindow;this.requestsViews=[],this.requestsIds=[],this.pendingViews=[],this.pendingIds=[];for(var t=[],s=0;s<levels.friendRequests.notProcessed.length;s++){var i=this.createRequestView(levels.friendRequests.notProcessed[s]);i&&t.push(i)}t.forEach(function(e){this.requestsViews.length<FriendRequestsWindow.MAX_SHOW_REQUESTS?(this.content.addChild(e),this.requestsViews.push(e),this.requestsIds.push(e.model.getId())):(this.content.addChild(e),e.setVisible(!1),this.pendingViews.push(e),this.pendingIds.push(e.model.getId()))},this);var n=cleverapps.UI.arrangeWithMargins(this.requestsViews.slice().reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.margin,x:e.width/2,y:e.y});this.content.setContentSize2(e.width,n)},createRequestView:function(e){var o=e.getId(),t=e.getView();if(t)return new t(e,this,function(){
var e=this.getRequestIdViewOrder(o),t=this.requestsViews[0].getPosition();if(!1!==e){for(var s=e-1;0<=s;--s)this.requestsViews[s].isRunningSafe()&&this.requestsViews[s].runAction(new cc.MoveTo(this.getMoveTime(),this.requestsViews[s+1].getPosition()));this.requestsIds.splice(e,1),this.requestsViews.splice(e,1)}if(0===this.requestsViews.length&&0===this.pendingViews.length)this.close();else if(0<this.pendingViews.length){var i=this.pendingViews[0],n=this.pendingIds[0];this.pendingViews.splice(0,1),this.pendingIds.splice(0,1),this.requestsViews.splice(0,0,i),this.requestsIds.splice(0,0,n),i.setVisible(!0),i.setScale(0),i.setPosition(t),i.runAction(new cc.ScaleTo(this.getMoveTime(),1))}}.bind(this))},getRequestIdViewOrder:function(e){for(var t=0;t<this.requestsIds.length;t++)if(this.requestsIds[t]===e)return t;return!1},getMoveTime:function(){return.3}});FriendRequestsWindow.MAX_SHOW_REQUESTS=4,cleverapps.styles.FriendRequestsWindow={width:400,margin:15,y:0}
;var RewardWindow=Window.extend({onWindowLoaded:function(e){this.options=e=e||{},this.reward=e.reward,cleverapps.flags.doubleRewards&&(this.reward=cleverapps.doubleReward(this.reward)),this.styles=cleverapps.styles.RewardWindow,e.styles&&(this.styles=cleverapps.overrideStyles(this.styles,e.styles,!0)),void 0===e.animation&&(e.animation=this.styles.animation.json),this.createContent(),this._super({title:e.title||"messages:RewardWindow.title",name:e.name||"rewardwindow",content:this.content,minWidth:e.minWidth||this.styles.minWidth,minHeight:e.minHeight||this.styles.minHeight,button:{text:Messages.get(e.buttonText||"Claim"),width:this.styles.button.width,height:this.styles.button.height,onPressed:this.onPressed.bind(this)},buttons:this.getButtons(),shareCheckBox:this.getShareOptions(),noBackground:e.noBackground,closeButton:!1,notCloseByTouchInShadow:e.notCloseByTouchInShadow}),this.adjustRewardList(),this.content.y+=cleverapps.styles.RewardWindow.rewards.dy,this.runRewardsListAnimation(
)},adjustRewardList:function(){var e=this.rewardsList.width*this.rewardsList.scale;e>this.window.width&&this.rewardsList.setScale(this.rewardsList.scale*this.window.width/e)},getShareOptions:function(){var e=this.options.rewardName;return!1!==e&&{shareId:"reward",toReplace:{rewardName:Messages.get("RewardWindow."+(e||"default"))}}},createText:function(){var e=this.text=cleverapps.UI.generateTTFText(this.options.text,cleverapps.styles.FONTS.REWARD_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT),t=this.options.textWidth||cleverapps.styles.RewardWindow.textWidth;return void 0!==t&&e.setDimensions(t,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e},addAnimation:function(){var e=this.options.animation;if(e){var t=e.json?e.json:e,s=new cleverapps.Spine(t);return s.setAnimation(0,"animation",!0),s.setPositionRound(this.rewardsList.width/2,this.rewardsList.height/2+this.styles.animation.y),s.setLocalZOrder(-1),this.rewardsList.addChild(s),s}},runRewardsListAnimation:function(){
this.rewardsList.iterateRewards(this.rewardItemAnimation.bind(this))},getContentItems:function(){var e=[];return this.rewardsList=this.createRewardsList(),e.push(this.rewardsList),this.options.text&&(this.text=this.createText(),e.push(this.text)),e},rewardItemAnimation:function(e){e.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.3),new cc.ScaleTo(.2,1)))},createContent:function(){return this.content=new cleverapps.Layout(this.getContentItems(),{direction:cleverapps.UI.VERTICAL,margin:this.styles.margin,padding:this.styles.rewards.padding}),this.animation=this.addAnimation(),this.content},onShow:function(){this._super(),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(this.options.sound||bundles.main.urls.reward_window_effect)}.bind(this)))),this.animation&&(this.animation.scale=0,this.animation.runAction(new cc.ScaleTo(.5,1)))},createRewardsList:function(){return new RewardsListComponent(this.reward,{
font:cleverapps.styles.FONTS.REWARD_WINDOW_REWARDS_TEXT})},onReceiveReward:function(){},doubleReward:function(){this.reward=cleverapps.doubleReward(this.reward);var e=this.rewardsList.parent,t=this.rewardsList.getPosition();this.rewardsList.removeFromParent(!0),this.rewardsList=this.createRewardsList(),this.rewardsList.setPosition(t),e.addChild(this.rewardsList)},receiveReward:function(){this.reward&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward),this.reward=void 0)},onClose:function(){this.receiveReward(),cleverapps.starChest&&!cleverapps.starChest.locked&&new StarChestWindow,this.options.callback&&this.options.callback()},onPressed:function(){this.close()},selectDoubleStrategy:function(){var e=[];if(cleverapps.social.isLoggedIn()&&(cleverapps.flags.noviral||e.push(RewardWindow.DOUBLE_INVITE),cleverapps.flags.noviral||cleverapps.flags.noshares||e.push(RewardWindow.DOUBLE_SHARE)),cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)&&(
e.push(RewardWindow.DOUBLE_AD),e.push(RewardWindow.DOUBLE_AD)),0<e.length)return e[Math.floor(Math.random()*e.length)]},getButtons:function(){return[]},getDoubleButton:function(){if(!levels.user.isBeginner());},getDoubleRewardButtonContent:function(e,t){var s=cleverapps.styles.RewardWindow;this.options&&this.options.styles&&(s=cleverapps.overrideStyles(s,this.options.styles,!0));var i=new cc.Node,n=new cc.Sprite(e);n.setAnchorPoint2(),n.setScale(t),i.addChild(n);var o=cleverapps.UI.generateTTFText("messages:PeriodicBonus.DoubleRewardButton.Text",cleverapps.styles.FONTS.BUTTON_TEXT);return i.addChild(o),i.setContentSize2(n.width*n.scale+s.doubleButton.margin+o.width,n.height),n.setPositionRound(s.doubleButton.icon),o.setPositionRound(s.doubleButton.text),i},doubleRewardByInvite:function(s){var e={message:Messages.get("SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title"),element:this.doubleButton},t=this.createListener(function(e,t){
e===cleverapps.Social.CODE_SUCCEED&&(Buttons.remove(this.doubleButton),this.doubleReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_BONUS_DOUBLE+"_"+s))}.bind(this));s===RewardWindow.DOUBLE_INVITE?(cleverapps.history.add("invt",1),cleverapps.social.inviteFriends(e,t)):cleverapps.social.inviteFriendsShare(e,t)},doubleRewardByAd:function(){cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)?(Buttons.remove(this.doubleButton),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){cleverapps.playSession.inc(cleverapps.EVENTS.REWARDED_DAILY_BONUS),this.doubleReward(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_BONUS_DOUBLE+"_"+RewardWindow.DOUBLE_AD)}.bind(this))):cleverapps.Notification.create("messages:AdsUnavailable")},listBundles:function(e){var t=[],s=e&&e.reward||{};return s.herolevels&&t.push("heroes"),(s.coins||s.wands)&&t.push("episode_0"),s.battlePass&&t.push("battle_pass"),t.push("reward_icons"),t}})
;RewardWindow.DOUBLE_SHARE=0,RewardWindow.DOUBLE_INVITE=1,RewardWindow.DOUBLE_AD=2,RewardWindow.NO_PAYMENTS_MODIFIER=2,cleverapps.styles.RewardWindow={margin:30,animation:{y:0,json:bundles.main.jsons.reward_spine_json},minWidth:600,minHeight:700,text:{x:0,y:150},rewards:{padding:{x:100,y:50},dy:0},button:{width:250,height:100},buttons:{margin:30},doubleButton:{margin:10,width:300,height:100,padding:{x:20,y:0},icon:{scale:.8,x:{align:"left",dx:3},y:{align:"center",dy:3}},text:{x:{align:"right"},y:{align:"center"}}}};var UserStatus=function(){cleverapps.EventEmitter.call(this),cleverapps.environment.isSceneWithPreview()?this.timeouts=[]:this.timeouts=[new UserStatusTimeout(cleverapps.parseInterval("10 seconds"),function(e,t){this.trigger("inactive_very_short",t)}.bind(this)),new UserStatusTimeout(cleverapps.parseInterval("20 seconds"),function(e,t){this.trigger("inactive_short",t)}.bind(this)),new UserStatusTimeout(cleverapps.parseInterval("60 seconds"),function(e,t){this.trigger(
"inactive_long",t)}.bind(this))]};UserStatus.prototype=Object.create(cleverapps.EventEmitter.prototype),(UserStatus.prototype.constructor=UserStatus).prototype.clear=function(){this.timeouts.forEach(function(e){e.clear()})},UserStatus.prototype.reportUserAction=function(){this.trigger("active"),this.timeouts.forEach(function(e){e.reset()})};var UserStatusTimeout=function(e,t){this.time=e,this.callback=t,this.reset()};UserStatusTimeout.prototype.reset=function(){this.clear(),this.hintTimeout=new cleverapps.LongTimeout(function(){this.callback(),this.reset()}.bind(this),this.time)},UserStatusTimeout.prototype.clear=function(){clearTimeout(this.hintTimeout)};var Counter=function(){this.value=0,this.onceZero=void 0,this.afterRunStages=void 0,this.stages=[],this.off=!1,this.onStageActivatedListener=function(){}};Counter.prototype.registerStage=function(t,e){for(var s=0;s<this.stages.length;s++)if(this.stages[s].handler===e)return;cleverapps.config.debugMode&&0<this.stages.filter(function(e
){return e.priority===t}).length&&alert("Multiple stages with same priority: "+t),this.stages.push({priority:t,handler:e}),this.stages.sort(function(e,t){return e.priority-t.priority})},Counter.prototype.runStages=function(){if(0===this.value&&!this.off)for(var e=0;e<this.stages.length;e++)if(this.stages[e].handler(),this.isActive())return void this.onStageActivatedListener()},Counter.prototype.turnOff=function(){this.off=!0},Counter.prototype.isActive=function(){return 0<this.value},Counter.prototype.trigger=function(e){e?this.setTimeoutUnblocked(this.trigger.bind(this),e):this.runStages()},Counter.prototype.inc=function(){this.value++},Counter.prototype.dec=function(){if(this.value--,0===this.value&&!this.off){if(this.onceZero){var e=this.onceZero;this.onceZero=void 0,e()}0!==this.value||this.off||this.runStages(),this.afterRunStages&&(this.afterRunStages(),this.afterRunStages=void 0)}},Counter.prototype.setTimeoutUnblocked=function(e,t){return setTimeout(function(){this.off||e()
}.bind(this),t)},Counter.prototype.setTimeout=function(e,t){return this.inc(),setTimeout(function(){this.off||(e(),this.dec())}.bind(this),t)},cleverapps.GameSaver={gamesData:[],findSave:function(t){return this.gamesData.filter(function(e){return Object.keys(e)[0]===t})[0]},load:function(e){var t=this.findSave(e);return(t=t&&JSON.parse(t[e]))||(t=cleverapps.DataLoader.load(e))&&this.saveInfo(e,t),t},reset:function(){cleverapps.GameSaver.gamesData=[];var e=GameBase.getStoreKey(levels.user.episode,levels.user.level);"merge"===cleverapps.config.type&&(e=GameBase.getStoreKey(0,0)),cleverapps.GameSaver.saveInfo(e,{}),cleverapps.synchronizer.addUpdateTask("games")},saveInfo:function(e,t){var s=this.findSave(e);if(s)this.gamesData[this.gamesData.indexOf(s)][e]=JSON.stringify(t);else{for(;this.gamesData.length>=cleverapps.DataLoader.FIFO_LIMIT;)this.gamesData.shift();var i={};i[e]=JSON.stringify(t),this.gamesData.push(i)}cleverapps.DataLoader.save(e,t,{
fifoKey:cleverapps.DataLoaderTypes.GAME_SAVE_FIFO})},removeSave:function(e){var t=this.findSave(e);t&&this.gamesData.splice(this.gamesData.indexOf(t),1),cleverapps.DataLoader.remove(e,cleverapps.DataLoaderTypes.GAME_SAVE_FIFO)}};var FakeGame=function(e){if((Game.currentGame=this).counter={isActive:function(){return!0},registerStage:function(){},trigger:function(){},fieldCounter:{registerStage:function(){}},setTimeout:function(){}},this.onChangeOutcomeListeners={},this.levelContent=e,this.level={quick:!0,content:e,getHumanReadableNumber:function(){return cleverapps.humanReadableNumber(e.episodeNo,e.levelNo)},episode:{isBonusRound:function(){return!1},isBonusWorldLevel:function(){return!1},bundleId:function(){return Episode.BundleId(e.episodeNo)}},isHard:function(){return e.hard}.bind(this),isTricky:function(){return e.tricky}.bind(this)},"solitaire"===cleverapps.config.type&&(this.generator=new CardGenerator,this.table={getScreen:function(){return new Screen(0)}}),
"match3"===cleverapps.config.type){var t=new Loader;this.field=new Field(t),this.loader=t,this.callsOnFieldReady=[],this.goals=new Goals(e),this.score={addMoveExplode:function(){},addGoal:function(){}},Match3.counter=this.counter}"merge"===cleverapps.config.type&&cleverapps.extend(this,{tutorial:{isActive:function(){}},orders:{addOrder:function(){},updateOrder:function(){},chooseFreeRecipe:function(){}},gameLevel:{value:0,getLevel:function(){return 1},nextLevelThreshold:function(){return 1e3}},harvested:{canTakeList:function(){}},workers:{findAssigned:function(){},countRegularFree:function(){return 2},countRegularTotal:function(){return 2},isBonusWorkerBuyed:function(){return!1}},energyLottery:{isAvailable:function(){return!1},isReady:function(){return!1}},spawn:function(){return[]},decreasePrizeStageIfNeeded:function(e){return e},storeSave:function(){}}),"board"===cleverapps.config.type&&(this.board=new cleverapps.Board(this,[],[]),this.board.addHint=function(){},this.hintBooster={
addHint:function(){}},this.keypad=new Keypad(this,{}),this.current=new cleverapps.Current(this,this.keypad),this.extra=new cleverapps.Extra(this.levelContent,[])),cleverapps.config.rpg&&(this.enemies=Game.prototype.selectEnemies.call(this))};FakeGame.prototype.getMissionType=function(){},FakeGame.prototype.stop=function(){this.stopped||(this.stopped=!0,"merge"===cleverapps.config.type&&(this.map.stop(),InfoView.Clear()))};var GameBase=function(e,t){cleverapps.EventEmitter.call(this),Game.currentGame=this,cleverapps.user.incProgressCompare(),this.levelContent=e.content,this.level=e,this.options=t||{},this.timer=new GameTimer,this.counter=new Counter,this.boostersBefore=this.options.boostersBefore,this.levelWithCoins=!e.isRegular()||e.isCurrentLevel()||cleverapps.user.isPassedAll()&&cleverapps.metha.getType()===Metha.SIMPLE&&cleverapps.user.checkAvailable(GameBase.LEVEL_WITH_COINS_AVAILABLE),cleverapps.Combo&&cleverapps.Combo.isAvailable()&&(this.combo=new cleverapps.Combo(this))
;var s=cleverapps.userresult.getStarsForLevel(this.level.episodeNo,this.level.levelNo);if(this.level.isRegular()&&(this.level.isNew()||cleverapps.config.results&&3!==s)){var i=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_SECOND);i&&(this.gameMission=i)}if(this.level.isRegular()&&this.level.isNew()){var n=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_REGULAR);n&&(this.backgroundMission=n)}if(this.userStatus=new UserStatus,this.rewards={},void 0!==this.gameMission&&this.gameMission.isRunning()&&(this.rewards[GameBase.REWARD_CLOVER]=0),this.backgroundMission&&this.backgroundMission.isRunning()){var o=this.backgroundMission.getLevelReward(),r=o[0];this.level.isHard()&&(r=o[1]),this.level.isTricky()&&(r=o[2]),this.rewards[GameBase.REWARD_BACKGROUND_CLOVER]=r}cleverapps.piggyBank&&cleverapps.piggyBank.isActive()&&!cleverapps.piggyBank.isFull()&&(this.rewards[GameBase.REWARD_PIGGY_BANK]=cleverapps.piggyBank.getAddAmount()),this.level.isRegular(
)&&this.level.isNew()&&levels.user.expAvailable()&&(this.rewards[GameBase.REWARD_EXP]=this.level.isHard()?GameBase.HARD_LEVEL_EXP_PRIZE:GameBase.EXP_PRIZE),-1!==["board","solitaire","differences"].indexOf(cleverapps.config.type)&&(this.level.isCurrentLevel()||this.level.episode.isDailyCup()||this.level.episode.isDailyLevel()||this.level.episode.isBonusWorldLevel()||cleverapps.config.editorMode)&&(this.basicGoldReward=10,this.level.isTricky()&&(this.basicGoldReward=20),this.level.isHard()&&(this.basicGoldReward=30),this.rewards[GameBase.REWARD_GOLD]=this.basicGoldReward),this.level.episode.isBonusRound()&&(this.rewards[GameBase.REWARD_GOLD]=cleverapps.BonusRoundChest.REWARD),this.levelWithTutorial&&this.levelWithTutorial()?cleverapps.Random.seed(this.level.getHumanReadableNumber()-1):cleverapps.Random.randomSeed(),this.onCloverAdded=function(){},this.onGoldRewardAdded=function(){},this.onGameMessage=function(){},this.outcome=GameBase.OUTCOME_UNKNOWN,this.onChangeOutcomeListeners={},
this.afterOnChangeOutcomeListeners={},cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN).logic.lantern.isActive(this.level)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN).logic.lantern.onStart(),this.boostersBefore&&this.boostersBefore.onStart(),cleverapps.competitionStatistics.onGameStarted(this)};GameBase.prototype=Object.create(cleverapps.EventEmitter.prototype),(GameBase.prototype.constructor=GameBase).prototype.getInfo=function(){},GameBase.prototype.getInitialInfo=function(){},GameBase.prototype.storeSave=function(){if(-1!==["match3","board","merge"].indexOf(cleverapps.config.type)&&!cleverapps.isRumble()&&(this.level.isRegular()||this.level.episode.isDailyCup()||this.level.episode.isDailyLevel()||this.level.episode.isBonusWorldLevel())){var e=this.getInfo();console.log("storeSave"),console.log(e),cleverapps.GameSaver.saveInfo(
GameBase.getStoreKey(this.level),e),cleverapps.synchronizer.addUpdateTask("games")}},GameBase.prototype.loadSave=function(){var e=cleverapps.GameSaver.load(GameBase.getStoreKey(this.level));return cleverapps.isRumble()&&(e=void 0),e||this.getInitialInfo()},GameBase.getStoreKey=function(e,t){if("object"==typeof e){var s=e;e=s.episode.episodeNo,t=s.levelNo}return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_level_"+t+"x"+e},GameBase.prototype.getDailyCupStars=function(){return 1},GameBase.prototype.initPool=function(){},GameBase.prototype.stop=function(){this.counter.turnOff(),this.userStatus.clear(),this.combo&&this.combo.stop(),cleverapps.menuBar.stopItems(),cleverapps.exclamation.disable(),this.stopped=!0,this.trigger("stop")},GameBase.prototype.afterChangeOutcome=function(){},GameBase.prototype.setOutcome=function(e){this.outcome===GameBase.OUTCOME_UNKNOWN&&(this.outcome=e,this.runOutcomeListeners())},GameBase.prototype.runOutcomeListeners=function(){
cleverapps.values(this.onChangeOutcomeListeners).forEach(function(e){e(this.outcome)}.bind(this)),cleverapps.values(this.afterOnChangeOutcomeListeners).forEach(function(e){e(this.outcome)}.bind(this)),this.afterChangeOutcome()},GameBase.prototype.win=function(){cleverapps.user.incProgressCompare(300),this.setOutcome(GameBase.OUTCOME_VICTORY)},GameBase.prototype.lose=function(){cleverapps.user.incProgressCompare(10),this.setOutcome(GameBase.OUTCOME_LOST)},GameBase.prototype.giveUp=function(){cleverapps.user.incProgressCompare(10),this.boostersBefore&&this.boostersBefore.onGiveUp(),this.setOutcome(GameBase.OUTCOME_GAVEUP)},GameBase.prototype.showUp=function(e){e()},GameBase.EXP_PRIZE=1,GameBase.HARD_LEVEL_EXP_PRIZE=3,GameBase.REWARD_CLOVER="clover",GameBase.REWARD_BACKGROUND_CLOVER="background_clover",GameBase.REWARD_PIGGY_BANK="piggyBank",GameBase.REWARD_EXP="exp",GameBase.REWARD_GOLD="gold",GameBase.REWARD_BOOSTER="booster",GameBase.OUTCOME_UNKNOWN=void 0,GameBase.OUTCOME_VICTORY=1,
GameBase.OUTCOME_LOST=2,GameBase.OUTCOME_GAVEUP=3,GameBase.prototype.stillNoPenalty=function(){return!cleverapps.isRumble()&&(this.outcome===GameBase.OUTCOME_UNKNOWN&&(!this.level.episode.isBonusRound()&&("board"===cleverapps.config.type||("solitaire"===cleverapps.config.type?(!cleverapps.bet||!cleverapps.bet.isActive())&&this.table.beginCards===this.table.countOfCardsToPlay():!(!this.originalMoves||-1!==this.originalMoves)||this.beginMoves===this.moves))))},GameBase.prototype.canPayReward=function(e){switch(e){case GameBase.REWARD_CLOVER:return void 0!==this.gameMission&&this.gameMission.isRunning();case GameBase.REWARD_BACKGROUND_CLOVER:return void 0!==this.backgroundMission&&this.backgroundMission.isRunning();case GameBase.REWARD_PIGGY_BANK:return cleverapps.piggyBank.isActive();case GameBase.REWARD_EXP:case GameBase.REWARD_GOLD:case GameBase.REWARD_BOOSTER:return!0}},GameBase.prototype.payReward=function(e,t){if(this.canPayReward(e)&&t)switch(e){case GameBase.REWARD_CLOVER:
this.gameMission.update(t);break;case GameBase.REWARD_BACKGROUND_CLOVER:this.backgroundMission.type===Mission.TYPE_SLOT_MACHINE?this.backgroundMission.slotMachine.earnTickets(t):this.backgroundMission.type===Mission.TYPE_BATTLEPASS?cleverapps.missionManager.dispatchEvent(Mission.EVENT_COLLECT_BATTLE_PASS_STARS,{amount:t}):this.backgroundMission.updateCurrency(t);break;case GameBase.REWARD_PIGGY_BANK:cleverapps.piggyBank.addGold(t);break;case GameBase.REWARD_EXP:levels.user.setExp(levels.user.exp+t);break;case GameBase.REWARD_GOLD:levels.user.setGold(levels.user.gold+t);break;case GameBase.REWARD_BOOSTER:cleverapps.boostersCounter.add(this.collectedBoosterCell.type,t)}},GameBase.prototype.getMissionType=function(){if(this.gameMission)return this.gameMission.type},GameBase.prototype.addClover=function(e,t,s){this.getMissionType()===e&&(this.rewards[GameBase.REWARD_CLOVER]=(this.rewards[GameBase.REWARD_CLOVER]||0)+t,s||this.onCloverAdded())},GameBase.prototype.addGoldReward=function(e,t){
this.rewards[GameBase.REWARD_GOLD]=(this.rewards[GameBase.REWARD_GOLD]||0)+e,t||this.onGoldRewardAdded()},GameBase.LEVEL_WITH_COINS_AVAILABLE={episode:0,level:7},cleverapps.GameSyncer={getInfo:function(){var e=cleverapps.user.getCurrentLevel(),t=e.episodeNo,s=e.levelNo;"merge"===cleverapps.config.type&&(t=s=0);var i=cleverapps.GameSaver.load(GameBase.getStoreKey(t,s));if(i)return 0<Object.keys(i).length&&(i=cleverapps.extend(i,{episode:t,level:s})),i},saveInfo:function(e){if(void 0!==e&&void 0!==e.episode&&void 0!==e.level){var t=e.episode,s=e.level;delete e.episode,delete e.level,cleverapps.GameSaver.saveInfo(GameBase.getStoreKey(t,s),e)}}};var GameSceneBase=cleverapps.FixedWidthScene.extend({ctor:function(e,t){if(cleverapps.config.editorMode&&cleverapps.environment.setScene(cleverapps.Environment.SCENE_GAME),this.game=e,this.level=t,this._super(cleverapps.Environment.SCENE_GAME),levels.cookieJar&&levels.cookieJar.shouldBeVisible()&&levels.cookieJar.setVisible(),
this.game.competition&&cleverapps.isKnockoutGame()){var s=this.playersView=new KnockoutPlayersView(this.game.competition,cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound());this.scene.addChild(s)}if(e.combo){var i=new ComboView(e.combo,this.scene);this.scene.addChild(i),e.onChangeOutcomeListeners.comboResetAnimations=e.combo.reset.bind(e.combo)}"match3"===cleverapps.config.type&&(this.infoPanel=new InfoPanel,this.scene.addChild(this.infoPanel),this.controlsPanel=new ControlsPanel,this.scene.addChild(this.controlsPanel)),e.afterOnChangeOutcomeListeners.gameScene=this.createListener(this.animateChangeOutcome.bind(this)),this.initSceneBg(),cleverapps.history.add("newg",1),e.onChangeOutcomeListeners.misc=this.createListener(function(){cleverapps.audio.fadeOut(),cleverapps.gun&&cleverapps.gun.hide(),this.level.isPassed=this.game.outcome===GameBase.OUTCOME_VICTORY}.bind(this)),cleverapps.exclamation.setGame(this.game),this.boatswain=new Boatswain(t),this.actions=[],
this.game.churnActivated=cleverapps.once(function(){(this.game.level.isRegular()||this.game.level.episode.isBonusWorldLevel())&&levels.user.isUniqueStart(this.game.level.episodeNo,this.game.level.levelNo,this.level.content.version)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNIQUE_START,{hash:this.level.hash})}.bind(this)),cleverapps.environment.levelNo=t.levelNo,cleverapps.environment.episodeNo=t.episodeNo,this.prepareConfirmExit(),cc.pool.drainAllPools(),this.game.initPool(),cleverapps.lives&&cleverapps.lives.amount>cleverapps.Lives.MAX_REGEN_AMOUNT&&(this.game.moreThenMaxRegenLife=!0),"merge"!==cleverapps.config.type&&this.takeLife(!0),this.customize(),this.groupToggler=new cleverapps.UI.GroupToggler,this.game.rewardGoldView&&(this.rewardGoldView=new RewardGoldView(this,this.infoPanel||this.scene)),this.game.gameMission&&(this.cloversView=new CloversView(this,this.infoPanel||this.scene)),(this.level.isRegular()||this.level.episode.isBonusWorldLevel()
)&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_START,{hash:this.level.hash}),void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.LEVEL_START),cleverapps.gun.isAvailable()&&(this.gunView=new GunView(cleverapps.gun,this)),this.game.tournament&&(this.playersView=new TournamentPlayersView(this.game.competition),this.scene.addChild(this.playersView));var n=new GameMessageView(e);this.scene.addChild(n);var o=cleverapps.exclamation.createView();this.scene.addChild(o,20),o.setPositionRound(this.width/2,this.height/2)},calcHash:function(){return RecursiveHasher(this.level.content,["episodeNo","levelNo","version","hard","paint","extra","gold","bundles"])},introControls:function(){return"panel_info"},_playIntro:function(){this.needDisplayIntro=!1,cleverapps.metha.display({focus:"GameScene.intro",control:this.introControls(),actions:[this.animateSceneBg.bind(this),function(e){this.onChangeSize(),e()}.bind(this),
this.displayIntro.bind(this),this.displayDailyLevelWindow.bind(this)]})},initSceneBg:function(){if(!cleverapps.flags.introDisabled){var e=cleverapps.styles.GameScene.startAnimation.scale;this.bgScaleMargin=e;var t=this.background.getScaleX()*e,s=this.background.getScaleY()*e;this.background.setScale(t,s),this.scene.setScale(1/e)}},animateSceneBg:function(e){var t=this.bgScaleMargin||1;this.game.outcome===GameBase.OUTCOME_UNKNOWN?this.scene.runAction(new cc.ScaleTo(.8,1)):this.scene.runAction(new cc.ScaleTo(.8,1/t)),setTimeout(e,800)},displayIntro:function(e){this.game.showUp(function(){this.game.level.isRegular()&&levels.FPS.run(this.game.level.episodeNo,this.game.level.levelNo),cleverapps.placements.run(Placements.AFTER_GAME_START),e()}.bind(this))},displayDailyLevelWindow:function(e){this.level.episode.isDailyLevel()?DailyLevelWindow.shown||-1===["olympics","crocword","tripeaks"].indexOf(cleverapps.config.name)?e():(new DailyLevelWindow,DailyLevelWindow.shown=!0,
cleverapps.metha.onceNoWindowsListener=e):e()},prepareConfirmExit:function(){this.confirmWindow=void 0,this.game.onChangeOutcomeListeners.confirmexit=function(e){void 0!==this.confirmWindow&&this.confirmWindow.close()}.bind(this)},closeAction:function(){this.backToEditorOrAdmin()||this.game&&void 0===this.confirmWindow&&this.game.outcome===GameBase.OUTCOME_UNKNOWN&&(cleverapps.metha.isFocused()||(this.game.stillNoPenalty()?this.game.giveUp():cleverapps.metha.display({focus:"GameSceneCloseAction",action:function(e){this.confirmWindow=new ConfirmExitWindow({onAction:function(){this.game.lose()}.bind(this),onClose:function(){this.confirmWindow=void 0}.bind(this),game:this.game}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})))},customize:function(){},takeLife:function(e){if(cleverapps.lives&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)){if(this.level.episode.isDailyCup()&&!cleverapps.dailyCup.cupWithLives())return;cleverapps.lives.take(e)}},
giveLife:function(){if(cleverapps.lives&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)){if(this.level.episode.isDailyCup()&&!cleverapps.dailyCup.cupWithLives())return;(this.game.moreThenMaxRegenLife||cleverapps.lives.amount<cleverapps.Lives.MAX_REGEN_AMOUNT)&&cleverapps.lives.give()}},calcAddedStars:function(e){if(this.level.episode.isRegular()&&cleverapps.user.isPassedAll()||this.level.episode.isDailyCup())return e;if(!this.level.isRegular())return 0;var t=cleverapps.userresult.getStarsForLevel(this.level.episodeNo,this.level.levelNo);return t<=e?e-t:0},beforeWin:function(){cleverapps.placements.run(Placements.AFTER_GAME_FINISH);var e=this.game.outcome;this.giveLife(),this.controlsPanel&&this.controlsPanel.hide(),this.level.isRegular()&&cleverapps.metha.getMainObject().gamePlayed(e,this.game);var t=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN
).logic.lantern;if(e===GameBase.OUTCOME_GAVEUP)t&&t.isActive(this.level)&&t.restoreSavedStreak();else if(e===GameBase.OUTCOME_VICTORY){if(this.game.timer&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_PASSED_TIME,{hash:this.level.hash,passedTime:this.game.timer.getTime()}),this.level.isRegular()&&this.level.isNew()&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.PASS_LEVELS_IN_ROW),t&&t.isActive(this.level)&&t.onWin(),cleverapps.placements.run(Placements.VICTORY),cleverapps.history.add("win",1),this.level.isRegular()||this.level.episode.isBonusWorldLevel()){void 0!==this.game.leftMoves&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_LEFT_MOVES,{hash:this.level.hash,leftMoves:this.game.leftMoves});var s=!0;"board"===cleverapps.config.type&&this.game.timer&&(s=this.game.timer.getTime()<=cleverapps.parseInterval("5 minutes")),s&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_FINISH,{hash:this.level.hash}),(this.level.isNew(
)||this.level.episode.isBonusWorldLevel())&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNIQUE_FINISH,{hash:this.level.hash}),void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.LEVEL_FINISH)}var i=this.level.isCurrentLevel();this.boatswain.level=this.level=cleverapps.extend(cleverapps.clone(this.level),{isCurrentLevel:function(){return i}}),this.oldLeague=levels.user.league,this.level.isCurrentLevel()&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.PASS_LEVEL),this.level.episode.isDailyLevel()&&cleverapps.dailyLevel.onWin(this.level)}else e===GameBase.OUTCOME_LOST&&(cleverapps.dailyTasks.setProgress(cleverapps.DailyTasks.PASS_LEVELS_IN_ROW,0),t&&t.isActive(this.level)&&t.onLose(),this.takeLife(),cleverapps.placements.run(Placements.LOSE),cleverapps.history.add("lose",1))},congratulate:function(e){if(-1!==["riddles","scramble","tripeaks"].indexOf(cleverapps.config.name))if(
cleverapps.flags.gameMessagesDisabled)e();else if(this.game.outcome===GameBase.OUTCOME_VICTORY){cleverapps.audio.playSound(bundles.main.urls.congratulate_sfx),cleverapps.windows.onShowShadow({});var t=cleverapps.styles.GameScene.congratulation;if(t.rays){var s=new cleverapps.Spine(bundles.exclamations.jsons.animation,t.rays.scale);this.scene.addChild(s,20),s.setPositionRound(t.rays),s.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(function(){s.setAnimation(0,"rays",!1)})))}if(this.game.onGameMessage(e,"messages:VICTORY",!1,{json:bundles.gamemessage.jsons.game_message_victory_json,direction:"riddles"===cleverapps.config.name?GameMessageView.DIRECTION_TOP_TOP:GameMessageView.DIRECTION_TOP_DOWN,delay:2}),"tripeaks"===cleverapps.config.name){var i=VictoryWindowHero.hero=new VictoryWindowHero;i.setLocalZOrder(22),this.addChild(i),i.show()}}else e();else e()},showProperWindow:function(e){if(!cleverapps.flags.victoryWindowDisabled)if(this.game.outcome!==GameBase.OUTCOME_GAVEUP
){var t={level:this.level,game:this.game,boatswain:this.boatswain};this.level.episode.isBonusRound()?new BonusRoundWindow(this.game):this.game.outcome===GameBase.OUTCOME_LOST?cleverapps.lives?new LoseWindow(function(t){cleverapps.isRumble()||(this.boatswain.intent=function(e){this.boatswain.REPLAY(e,t)}.bind(this))}.bind(this),this.game):e():new VictoryWindow(t),cleverapps.metha.onceNoWindowsListener=e}else e()},waitWinLoseAnimations:function(e){e()},animateGoalsComplete:function(e){e()},fireworksAnimation:function(e){cleverapps.isKnockoutGame()||this.game.outcome!==GameBase.OUTCOME_VICTORY||this.scene.addChild(new Fireworks),e()},purgeOldGame:function(e){this.game&&!this.game.stopped&&cleverapps.throwAsync("purgeOldGame active game"),Game.currentGame=void 0,this.game=void 0,"undefined"!=typeof VictoryLoseAnimations&&VictoryLoseAnimations.clear(),e()},saveFinalResults:function(e){if(!this.game){var t="game empty ";Game.currentGame&&Game.currentGame.level&&(
t+=" level - "+Game.currentGame.level.levelNo+", episode - "+Game.currentGame.level.episodeNo),cleverapps.throwAsync(t)}this.game.outcome===GameBase.OUTCOME_VICTORY&&("undefined"!=typeof Match3&&this.game instanceof Match3&&this.level.isRegular()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_STARS,{hash:this.level.hash,stars:this.stars}),this.level.episode.isDailyCup()&&this.saveDailyCupProgress()),e()},saveDailyCupProgress:function(){cleverapps.dailyCup.addAmount(this.game.getDailyCupStars()),cleverapps.playSession.set(cleverapps.EVENTS.DAILY_CUP_PLAYERS,!0)},playChangeOutcome:function(){var e=cleverapps.toArray(this.introControls());this.level.episode.isBonusRound()&&this.game.outcome===GameBase.OUTCOME_LOST&&e.push("MenuBarBonusRoundTimerItem"),cleverapps.metha.display({focus:"ChangeOutcome",control:e,filter:function(){return this.wantAnimateChangeOutcome}.bind(this),action:function(e){this.wantAnimateChangeOutcome=!1,cleverapps.metha.compound(e,this.actions)}.bind(this)}
)},backToEditorOrAdmin:function(e){return cleverapps.config.editorMode?(this.game&&this.game.stop(),e&&e(),this.level.edit(),!0):!!cleverapps.config.adminMode&&(this.game&&this.game.stop(),e&&e(),AdministratorScene.open(),!0)},animateChangeOutcome:function(e){this.wantAnimateChangeOutcome=!0,cleverapps.config.debugMode&&console.log("OUTCOME: "+e),this.beforeWin(),cleverapps.isKnockoutGame()||e===GameBase.OUTCOME_VICTORY&&this.level.isCurrentLevel()&&levels.user.incLevel(),this.actions.push(this.waitWinLoseAnimations.bind(this)),this.actions.push(this.animateGoalsComplete.bind(this)),this.actions.push(this.fireworksAnimation.bind(this)),this.actions.push(this.saveFinalResults.bind(this)),this.actions.push(this.animateSceneBg.bind(this)),this.actions.push(this.congratulate.bind(this)),this.actions.push(this.showProperWindow.bind(this)),e===GameBase.OUTCOME_VICTORY?this.afterWin():this.actions.push(this.purgeOldGame.bind(this)),this.actions.push(function(){cleverapps.metha.distract({
focus:"boatswain",control:this.introControls(),action:function(e){this.backToEditorOrAdmin(e)||this.boatswain.intent(e)}.bind(this)})}.bind(this)),cleverapps.metha.display({focus:"empty",action:function(e){e()}})},afterWin:function(){if(this.actions.push(function(e){for(var t in this.game.rewards)this.game.payReward(t,this.game.rewards[t]);e()}.bind(this)),this.actions.push(this.purgeOldGame.bind(this)),this.level.isRegular()&&levels.user.checkAvailable(BeatFriendWindow.AVAILABLE)&&this.level.isNew()){var t=this.level.players.filter(function(e){return cleverapps.friends.getById(e)});0<t.length&&this.actions.push(function(e){cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.BEAT_FRIEND),new BeatFriendWindow(t[0],this.level),cleverapps.metha.onceNoWindowsListener=e}.bind(this))}cc.sys.isNative&&!cleverapps.flags.norest&&levels.user.checkAvailable(RateWindow.AVAILABLE)&&!RateWindow.hadRated()&&this.actions.push(function(e){new RateWindow,cleverapps.metha.onceNoWindowsListener=e}),
this.oldLeague===levels.user.league||cleverapps.flags.norest||(this.actions.push(function(e){new NewLeagueWindow(this.level),cleverapps.metha.onceNoWindowsListener=e}.bind(this)),this.actions.push(function(e){new LeadersWindow,cleverapps.metha.onceNoWindowsListener=e}));var s=this.game.backgroundMission;if(s&&s.isMinigameReadyToFinish()&&this.actions.push(function(e){new s.nudgeWindow(s),cleverapps.metha.onceNoWindowsListener=e}),cleverapps.missionManager.dispatchEvent(Mission.EVENT_LEVEL_FINISH,{level:this.level}),cleverapps.config.results&&this.level.isRegular()&&levels.user.checkAvailable(ChampionWindow.AVAILABLE)&&this.level.isChampion()&&(cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.LEVEL_CHAMPION),this.actions.push(function(e){new ChampionWindow(this.level),cleverapps.metha.onceNoWindowsListener=e}.bind(this))),"undefined"!=typeof match3&&!1!==match3.heroes.readyToOpen()){var i=match3.heroes.readyToOpen();match3.heroes.setLevel(i,1),this.actions.push(function(e){
cleverapps.Plot.onFirstHeroesOpen(e,{color:i})})}this.actions.push(function(e){cleverapps.starChest&&!cleverapps.starChest.locked?(new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e):e()})},onChangeSize:function(e){this._super(e),this.game&&this.game.combo&&this.game.combo.onChangeSize&&this.game.combo.onChangeSize()},getBackgroundStyles:function(){if(!this.level)throw new Error("Level is undefined in getBackgroundStyles "+cleverapps.gameSceneLogs.join(" "));var e=GameSceneBase.ChooseStyling(this.level);return e.background=bundles[e.bundle].urls.background,e.animation=bundles[e.bundle].jsons.background_spine,cleverapps.skins.getSlot("gameSceneBg")||e},getAudioStyles:function(){var e=GameSceneBase.ChooseStyling(this.level);return{res:cleverapps.skins.getSlot("gameAudio")||e.music,delay:cleverapps.styles.GameScene.sound.delay}}});GameSceneBase.ChooseStyling=function(e){if(bundles[e.episode.bundleId()]&&bundles[e.episode.bundleId()].urls.background)return{
bundle:e.episode.bundleId()};if(cleverapps.environment.isEditorScene()&&cleverapps.styles.GameScene.STYLING.editor)return cleverapps.styles.GameScene.STYLING.editor;var t=cleverapps.styles.GameScene.STYLING,s=t.regular[e.getHumanReadableNumber()%t.regular.length];if(e.episode.isBonusRound()?s=t.bonus:e.isHard()||cleverapps.isRumble()&&cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isLast()?s=t.hard:e.isTricky()&&(s=t.tricky),s=cleverapps.clone(s),e.episode.isBonusWorldLevel()){var i=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_BONUS_WORLD);i&&(s.bundle=i.bonusWorld.backgroundBundleId(),s.music=bundles[s.bundle].urls.music,s.skin=void 0)}return-1!==["wordheaps","spades","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(s.bundle="simple_background_"+cleverapps.simple.getCurrent()),s},GameSceneBase.BUNDLES=function(e,t){var i=["game","heroes","dialogues_minimal"];if(t&&(i=i.concat(t.content.bundles||[t.content.bundleName]||[])
).push(GameSceneBase.ChooseStyling(t).bundle),"match3"===cleverapps.config.type&&t.content.cellSkins&&cleverapps.values(t.content.cellSkins).forEach(function(e){if(bundles[e]){var t=e.substring(0,e.indexOf("_reskin")),s=i.indexOf(t);i.splice(s,0<s?1:0,e)}}),"stacks"===cleverapps.config.subtype&&i.push("extra_"+cleverapps.settings.language),e&&cleverapps.config.rpg)for(var s in e.enemies){var n=e.enemies[s];i.push("enemy"+n)}return bundles.exclamations&&i.push("exclamations"),bundles["letters_"+cleverapps.settings.language]&&i.push("letters_"+cleverapps.settings.language),i},cleverapps.styles.GameScene={actor:void 0,startAnimation:{scale:1.05},sound:{delay:1},debugLevelNo:{x:{align:"right",dx:-100},y:{align:"bottom",dy:100}},congratulation:{}},cleverapps.styles.GameScene.STYLING={bonus:{bundle:"game_background_bonus",music:bundles.game.urls.background_music_game,pattern:-1!==["wordsoup","olympics","crocword"].indexOf(cleverapps.config.name)},hard:{bundle:"game_background_hard",
animation:bundles.game.jsons.game_bg_clouds_json,skin:"gameBackground_hard",music:bundles.game.urls.background_music_hard,pattern:-1!==["differences","olympics","wordsoup"].indexOf(cleverapps.config.name)},regular:[{bundle:"game_background",animation:bundles.game.jsons.game_bg_clouds_json,skin:"gameBackground",music:bundles.game.urls.background_music_game,pattern:-1!==["differences","olympics","wordsoup"].indexOf(cleverapps.config.name)}]},function(){if(bundles.editor&&bundles.editor.urls.background&&(cleverapps.styles.GameScene.STYLING.editor={bundle:"editor"}),"crocword"===cleverapps.config.name)cleverapps.styles.GameScene.STYLING.regular[0].bundle="loading_scene_backgrounds";else for(var e=cleverapps.styles.GameScene.STYLING.regular[0],t=2;bundles["game_background_"+t];t++)cleverapps.styles.GameScene.STYLING.regular.push({bundle:"game_background_"+t,skin:"gameBackground"+t,music:e.music,animation:e.animation,pattern:e.pattern})}();var GameMessageView=cc.Node.extend({ctor:function(e
){this._super(),(this.game=e).onGameMessage=this.createListener(this.show.bind(this)),this.setLocalZOrder(21)},show:function(e,t,s,i){if(cleverapps.flags.gameMessagesDisabled)e();else{i=i||{};var n=cc.director.getRunningScene().scene,o=this.createBg();this.addChild(o);var r=this.createText(t);if(o.addChild(r),r.fitTo(.9*n.width),s){var a=this.createTitle(s);o.addChild(a)}var c=i.direction||GameMessageView.DIRECTION_TOP_DOWN,l=cc.p(n.width/2,n.height+o.height/2+cleverapps.UI.getSceneOffsetY()),p=cc.p(n.width/2,n.height/2),d=cc.p(n.width/2,-o.height/2-cleverapps.UI.getSceneOffsetY());c===GameMessageView.DIRECTION_TOP_TOP&&(d=l);var h=cleverapps.styles.GameMessageView,u=i.json||bundles.gamemessage.jsons.game_message_json;if(u){var g=new cleverapps.Spine(u,h.char.scale);this.addChild(g,1),g.setPositionRound(h.char),g.y-=cleverapps.UI.getSceneOffsetY();var v="idle";"stacks"===cleverapps.config.subtype&&(this.game.level.isHard()&&(v="idle_hard"),this.game.level.isTricky()&&(v="idle_tricky"),
this.game.level.episode.isBonusRound()&&(v="idle_bonus_round")),g.setAnimation(0,v,!1),cleverapps.UI.makeHideable(g,cleverapps.UI.VERTICAL),g.hide(!0),g.show(!1,0,{easing:!0,duration:.3})}o.setPositionRound(l),o.setVisible(!1),o.runAction(new cc.Sequence(new cc.DelayTime(this.getDelayTime()),new cc.CallFunc(function(){o.setVisible(!0),cleverapps.audio.playSound(bundles.game.urls.game_message_effect)}),new cc.MoveTo(.5,p).easing(cc.easeBackOut(1)),new cc.DelayTime(i.delay||1.2),new cc.CallFunc(function(){g&&g.hide(!1,0,{easing:!0,duration:.3}),cleverapps.audio.playSound(bundles.game.urls.game_message_effect)}),new cc.MoveTo(.5,d).easing(cc.easeBackIn(1)),new cc.RemoveSelf,new cc.CallFunc(e)))}},getBackgroundImage:function(){var e=bundles.gamemessage.frames.gamemessage_bg_png;return cleverapps.isRumble()&&cleverapps.metha.getMainObject().knockoutGame.rumble.getCurrentRound().isLast()&&(e=bundles.gamemessage.frames.gamemessage_bg_hard_png),this.game.level.isHard(
)&&bundles.gamemessage.frames.gamemessage_bg_hard_png&&(e=bundles.gamemessage.frames.gamemessage_bg_hard_png),this.game.level.isTricky()&&bundles.gamemessage.frames.tricky_level_msg_bg&&(e=bundles.gamemessage.frames.tricky_level_msg_bg),this.game.level.episode.isBonusRound()&&bundles.gamemessage.frames.bonus_round_level_msg_bg&&(e=bundles.gamemessage.frames.bonus_round_level_msg_bg),e},createText:function(e){e=Messages.has(e)?Messages.get(e):e;var t=cleverapps.styles.FONTS.GAME_MESSAGE_TEXT;this.game.level.isHard()&&cleverapps.styles.FONTS.GAME_MESSAGE_HARD_TEXT&&(t=cleverapps.styles.FONTS.GAME_MESSAGE_HARD_TEXT),this.game.level.isTricky()&&(t=cleverapps.styles.FONTS.GAME_MESSAGE_TRICKY_TEXT),this.game.level.episode.isBonusRound()&&cleverapps.styles.FONTS.GAME_MESSAGE_BONUS_ROUND_TEXT&&(t=cleverapps.styles.FONTS.GAME_MESSAGE_BONUS_ROUND_TEXT);var s=cleverapps.UI.generateTTFText(e.toUpperCase(),t);return s.setPositionRound(cleverapps.styles.GameMessageView.text),
s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s},createTitle:function(e){var t,s=cleverapps.styles.GameMessageView,i=bundles.gamemessage.frames.title_bg_png,n=cleverapps.styles.FONTS.GAME_MESSAGE_TITLE_TEXT;this.game.level.isHard()&&(i=bundles.gamemessage.frames.title_bg_hard_png,n=cleverapps.styles.FONTS.GAME_MESSAGE_TITLE_TEXT_HARD||n),this.game.level.isTricky()&&(i=bundles.gamemessage.frames.title_bg_tricky_png,n=cleverapps.styles.FONTS.GAME_MESSAGE_TITLE_TEXT_TRICKY||n),s.title.bg.width?(t=new cc.Scale9Sprite(i)).setContentSize2(s.title.bg):t=new cc.Sprite(i),e=Messages.has(e)?Messages.get(e):e;var o=cleverapps.UI.generateTTFText(e.toUpperCase(),n);return o.fitTo(s.title.width),t.addChild(o),o.setPositionRound(s.title),t.setPositionRound(s.title.bg),t},createBg:function(){var e,t=cleverapps.styles.GameMessageView,s=cleverapps.UI.getSceneSize();if(t.pattern){for(var i=new cc.Sprite(this.getBackgroundImage()).width,n=[],o=0;o<Math.ceil(s.width/(i+t.pattern.margin))+10;o++
)n.push(new cc.Sprite(this.getBackgroundImage()));e=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:t.pattern.margin})}else(e=new cc.Scale9Sprite(this.getBackgroundImage())).setContentSize2(1.2*s.width,e.height);return e},getDelayTime:function(){return.2}});GameMessageView.DIRECTION_TOP_DOWN=0,GameMessageView.DIRECTION_TOP_TOP=1,cleverapps.styles.GameMessageView={text:{x:{align:"center"},y:{align:"center"}},title:{width:200,bg:{x:{align:"center"},y:{align:"center",dy:110}},x:{align:"center"},y:{align:"center"}}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{GAME_MESSAGE_TEXT:{size:60,color:cleverapps.styles.COLORS.WHITE,stroke:{color:new cc.Color(145,56,188,255),size:1}},GAME_MESSAGE_TITLE_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE,shadow:cleverapps.styles.DECORATORS.IMAGE_FONT_SHADOW,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}});var GameTimer=function(e){this.start=Date.now(),this.game=e};GameTimer.prototype.setStartTime=function(e){
this.start=e},GameTimer.prototype.getStartTime=function(){return this.start},GameTimer.prototype.getTime=function(){return Date.now()-this.start},cleverapps.DailyTask=function(e,t,s,i){this.type=e,this.goal=t,this.level=i,this.progress=0,this.data=s||{},this.onUpdateListener=function(){}},cleverapps.DailyTask.prototype.getSaveInfo=function(){return{type:this.type,progress:this.progress,collected:this.collected,goal:this.goal,data:this.data}},cleverapps.DailyTask.prototype.addProgress=function(e,t){if("object"==typeof e&&(t=e),"number"!=typeof e&&(e=1),0<e)return this.setProgress(this.progress+e,t)},cleverapps.DailyTask.prototype.isApplicable=function(e){switch(this.type){case cleverapps.DailyTasks.USE_BOOSTER:return this.data.booster===e.booster;case cleverapps.DailyTasks.COLLECT_COLOR_CELLS:return this.data.color===e.color;case cleverapps.DailyTasks.COLLECT_SPECIAL_CELLS:return this.data.cell_code===e.cell_code;case cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER:
return this.data.letter===e.letter;case cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE:return this.data.cardValue===e.cardValue;case cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT:return this.data.cardSuit===e.cardSuit;case cleverapps.DailyTasks.COLLECT_HERO_CELLS:return this.data.color===e.color}return!0},cleverapps.DailyTask.prototype.setProgress=function(e,t){this.isApplicable(t)&&!this.isFinished()&&("object"==typeof e&&(t=e),"number"!=typeof e&&(e=1),e!==this.progress&&(this.progress=Math.min(e,this.goal),this.onUpdateListener(),this.save(),this.isFinished()&&(cleverapps.playSession.inc(cleverapps.EVENTS.SESSION_DAILY_TASK_FINISH),cleverapps.history.add("d"+this.level,1),this.type===cleverapps.DailyTasks.LIKE_PAGE&&cleverapps.serverFlags.setFlag(cleverapps.ServerFlags.PAGE_LIKED))))},cleverapps.DailyTask.prototype.isFinished=function(){return this.progress>=this.goal},cleverapps.DailyTask.prototype.getLevel=function(){return this.level},cleverapps.DailyTask.prototype.run=function(){
var e=function(){cleverapps.metha.distract({focus:"DailyTaskRunLevel",action:function(e){cleverapps.metha.wantsToPlay(e,{dailyTask:!0})}})};switch(this.type){case cleverapps.DailyTasks.LOGIN_FACEBOOK:cleverapps.social.checkConnection(this.setProgress.bind(this,1));break;case cleverapps.DailyTasks.LIKE_PAGE:cleverapps.social.joinGroup?cleverapps.social.joinGroup(function(e){e===cleverapps.Social.CODE_SUCCEED&&(cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL)),this.setProgress(1))}.bind(this)):(cc.sys.openURL(cleverapps.bySource(cleverapps.config.helpURL)),this.setProgress(1));break;case cleverapps.DailyTasks.SHARE:var t=cleverapps.ShareBonus.cycleShareData("share");cleverapps.social.shareDialog(t,function(e){e===cleverapps.Social.CODE_SUCCEED&&(cleverapps.history.add("share",1),this.setProgress(1))}.bind(this));break;case cleverapps.DailyTasks.INVITE_FRIENDS:cleverapps.history.add("invt",1),cleverapps.social.inviteFriends({message:Messages.get(
"SettingsWindow.InviteFriends.message"),title:Messages.get("SettingsWindow.InviteFriends.title")},function(e,t){e===cleverapps.Social.CODE_SUCCEED&&this.addProgress(1)}.bind(this));break;case cleverapps.DailyTasks.SEND_FRIEND_HELP:levels.friendRequests.existRequestTypes(levels.FriendRequest.SENT_HELP_REQUESTS)&&new FriendRequestsWindow;break;case cleverapps.DailyTasks.SPEND_GOLD:e();break;case cleverapps.DailyTasks.WATCH_ADS:cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED);break;case cleverapps.DailyTasks.TOURNAMENT_WIN:var s=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_REGULAR);("olympics"===cleverapps.config.name||s&&s.tournament)&&e();break;case cleverapps.DailyTasks.RECEIVE_PERIODIC_BONUS:cleverapps.periodicBonus.openWindow();break;case cleverapps.DailyTasks.PLAY_BONUS_ROUND:cleverapps.metha.distract({focus:"DailyTaskRunBonusRound",action:function(e){cleverapps.bonusRoundChest.locked?cleverapps.Notification.create("messages:BonusRound.ClosedText"
):cleverapps.bonusRoundChest.open(e)}});break;default:e()}},cleverapps.DailyTask.prototype.collect=function(){this.isFinished()&&!this.collected&&(this.collected=!0,this.save(),this.onUpdateListener())},cleverapps.DailyTask.prototype.expire=function(){this.isFinished()||(this.expired=!0,this.onUpdateListener())},cleverapps.DailyTask.prototype.givePrize=function(){this.isFinished()&&new DailyTaskRewardWindow(this)},cleverapps.DailyTask.prototype.save=function(){cleverapps.dailyTasks.save()},cleverapps.DailyTask.prototype.getTitle=function(){var e={};return cleverapps.DailyTasks.USE_BOOSTER===this.type&&(e.booster=Messages.get("Boosters."+this.data.booster+".Title")),cleverapps.DailyTasks.COLLECT_COLOR_CELLS===this.type&&(e.color=Messages.get("ColorCell."+this.data.color+".Title")),cleverapps.DailyTasks.COLLECT_SPECIAL_CELLS===this.type&&(e.elements=Messages.get("DailyTask.14.Element."+this.data.cell_code)),cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER===this.type&&this.data.letter&&(
e.letter=this.data.letter.toUpperCase()),cleverapps.DailyTasks.COLLECT_HERO_CELLS===this.type&&(e.heroes=Messages.get("DailyTask.24."+this.data.color)),cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE===this.type&&(e.cards=Messages.get("DailyTask.25."+this.data.cardValue)),cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT===this.type&&(e.cards=Messages.get("DailyTask.26."+this.data.cardSuit)),{text:"messages:DailyTask."+this.type+".Title",replace:e}},cleverapps.DailyTask.getIcon=function(e,t){if(cleverapps.DailyTasks.COLLECT_SPECIAL_CELLS===e)switch(t.cell_code){case FishCell.GOAL_ID:return new cc.Sprite(bundles.fish_cell.frames.cell_fish);case FlowerCell.GOAL_ID:return new cc.Sprite(bundles.flower_cell.frames.flower_cell_3);case NutCell.GOAL_ID:return new cc.Sprite(bundles.nut.frames.nut_cell_1);case Mark.GOAL_ID:return new cc.Sprite(bundles.game_mark.frames.mark_goal);case MouseCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_mouse_png);case IceTile.GOAL_ID:
return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_ice_png);case DragonCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_dragon_png);case CookieManCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_cookieman_png);case CakeCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_cake_png);case MuffinGoalCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_muffin_png);case WaffleCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_waffles_png);case LollipopCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_lollipop_png);case ColorCookieManCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_colorcookieman_png);case TruffleCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_truffle_png);case DogCell.GOAL_ID:return new cc.Sprite(bundles.dailytasks.frames.daily_task_cell_dog_png)}if(
cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER===e){var s=new CharView(t.letter.toUpperCase());return"scramble"===cleverapps.config.name&&s.setScale(.8),s}var i="daily_task_icon_"+e;return cleverapps.DailyTasks.USE_BOOSTER===e&&(i+="_"+t.booster),cleverapps.DailyTasks.COLLECT_COLOR_CELLS===e&&(i+="_"+t.color),cleverapps.DailyTasks.COLLECT_HERO_CELLS===e&&(i+="_"+t.color),cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE===e&&(i+="_"+t.cardValue),cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT===e&&(i+="_"+t.cardSuit),i+="_png",new cc.Sprite(bundles.dailytasks.frames[i])},cleverapps.DailyTask.prototype.getIcon=function(){return cleverapps.DailyTask.getIcon(this.type,this.data)},cleverapps.DailyTask.Create=function(e){var t=e.level;cleverapps.DailyTasks.LEVELS&&(t=cleverapps.DailyTasks.LEVELS[t]);var s=new cleverapps.DailyTask(e.type,e.goal,e.data,t);return s.progress=0<e.progress?e.progress:0,s.collected=e.collected,s},cleverapps.DailyTasks=function(e){this.onChangeStateListener=function(){},
cleverapps.config.debugMode&&(cleverapps.DailyTasks.DURATION="60 seconds"),this.tasks=[],e?(this.whenStart=-1,this.order=0,this.save()):this.load()},cleverapps.DailyTasks.prototype.getInfo=function(){return{whenStart:this.whenStart,order:this.order,tasks:this.tasks.map(function(e){return e.getSaveInfo()})}},cleverapps.DailyTasks.prototype.processFinishState=function(){clearTimeout(this.finishTimeout);var e=this.getTimeLeft();0<e?this.finishTimeout=new cleverapps.LongTimeout(this.processFinishState.bind(this),e):this.onChangeStateListener()},cleverapps.DailyTasks.prototype.load=function(e){var t=e||cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DAILY_TASKS)||{};this.whenStart=void 0!==t.whenStart?t.whenStart:-1,this.order=void 0!==t.order?t.order:0,this.whenStart>Date.now()&&(this.whenStart=Date.now()),t.tasks&&t.tasks.length===cleverapps.DailyTasks.ACTIVE_TASKS&&(this.tasks=t.tasks.map(function(e,t){return e.level=t,cleverapps.DailyTask.Create(e)})),this.processFinishState()},
cleverapps.DailyTasks.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_TASKS,this.getInfo()),this.onChangeStateListener(),!1!==e&&cleverapps.synchronizer.addUpdateTask("dailytasks")},cleverapps.DailyTasks.prototype.collect=function(e){e.collect(),this.sendActivity()},cleverapps.DailyTasks.prototype.collectFinishedTasks=function(e){var t=this.getNotCollectedTasks(),s=cleverapps.once(this.sendActivity);this.tasks=[],e&&this.openWindow(),t.forEach(function(e){e.givePrize(),s()},this),this.save()},cleverapps.DailyTasks.prototype.processResults=function(){this.isRunning()?0===this.tasks.length&&this.startNew():0===this.tasks.length?this.startNew():this.getActiveTasks().forEach(function(e){e.expire()})},cleverapps.DailyTasks.prototype.startNew=function(){this.tasks=this.generateTasks(),this.startGeneratedTasks()},cleverapps.DailyTasks.prototype.generateTasks=function(){var e=DailyTasksConfig.filter(function(e){return!e.filter||e.filter()});if(
cleverapps.Random.seed(this.order),(e=cleverapps.clone(e,!0)).forEach(function(e){e.data=e.data||{},e.dynamic&&cleverapps.extend(e.data,e.dynamic())}),cleverapps.DailyTasks.LEVELS)return this.generateTasksByLevels(e);var t=e.filter(function(e){return!e.permanent}),s=e.filter(function(e){return e.permanent});return(t=cleverapps.Random.shuffle(t)).slice(0,Math.max(0,cleverapps.DailyTasks.ACTIVE_TASKS-s.length)).concat(s).map(cleverapps.DailyTasks.CreateTask)},cleverapps.DailyTasks.prototype.generateTasksByLevels=function(i){i=cleverapps.Random.shuffle(i);var n={};i.forEach(function(e){n[e.type]=e});var e=[].concat(cleverapps.DailyTasks.TASKS_BY_ORDER[this.order]||[]).concat(cleverapps.DailyTasks.PRIORITY_TYPES);return n[cleverapps.DailyTasks.LOGIN_FACEBOOK]&&cleverapps.Random.nextDouble()<.3&&e.push(cleverapps.DailyTasks.LOGIN_FACEBOOK),e.forEach(function(e){n[e]&&i.unshift(n[e])}),cleverapps.DailyTasks.LEVELS.map(function(e){for(var t=0;t<i.length;t++){var s=i[t];if(n[s.type]&&s.data[e]
)return delete n[s.type],cleverapps.DailyTasks.CreateTask(s,e)}})},cleverapps.DailyTasks.CreateTask=function(e,t){var s=e.data.goal||e.data[t];return delete e.data.goal,delete e.data.low,delete e.data.mid,delete e.data.hard,new cleverapps.DailyTask(e.type,s,e.data,t)},cleverapps.DailyTasks.prototype.startGeneratedTasks=function(){this.order++,this.whenStart=Date.now(),this.save(),this.processFinishState(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASKS_START)},cleverapps.DailyTasks.prototype.sendActivity=function(){cleverapps.social.sendActivity&&cleverapps.social.sendActivity(cleverapps.Social.ACTIVITY.DAILY_TASK,{userName:cleverapps.friends.getPlayer().name})},cleverapps.DailyTasks.prototype.getNotCollectedTasks=function(){return this.tasks.filter(function(e){return e.isFinished()&&!e.collected})},cleverapps.DailyTasks.prototype.getActiveTasks=function(){return this.tasks.filter(function(e){return!e.isFinished()})},cleverapps.DailyTasks.prototype.getTaskByType=function(
t){var s;return this.getActiveTasks().forEach(function(e){e.type===t&&(s=e)}),s},cleverapps.DailyTasks.prototype.addProgress=function(e,t,s){var i=this.getTaskByType(e);i&&i.addProgress(t,s)},cleverapps.DailyTasks.prototype.setProgress=function(e,t,s){var i=this.getTaskByType(e);i&&i.setProgress(t,s)},cleverapps.DailyTasks.prototype.getTimeLeft=function(){return this.whenStart+cleverapps.parseInterval(cleverapps.DailyTasks.DURATION)-Date.now()},cleverapps.DailyTasks.prototype.isRunning=function(){return 0<this.getTimeLeft()},cleverapps.DailyTasks.prototype.getTasks=function(){return this.tasks},cleverapps.DailyTasks.prototype.onDiscoverWord=function(e){this.processDiscoverWordWithLetter(e)},cleverapps.DailyTasks.prototype.onDiscoverExtraWord=function(e){this.addProgress(cleverapps.DailyTasks.GUESS_EXTRA_WORDS),this.processDiscoverWordWithLetter(e)},cleverapps.DailyTasks.prototype.processDiscoverWordWithLetter=function(e){cleverapps.unique(e.split("")).forEach(function(e){
cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER,1,{letter:e})})},cleverapps.DailyTasks.prototype.processOpenCard=function(e,t){this.addProgress(cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE,1,{cardValue:Card.VALUES[e.value]}),this.addProgress(cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT,1,{cardSuit:e.suit}),t instanceof Wildcard&&this.addProgress(cleverapps.DailyTasks.USE_HINTS)},cleverapps.DailyTasks.LOGIN_FACEBOOK=0,cleverapps.DailyTasks.LIKE_PAGE=1,cleverapps.DailyTasks.SHARE=2,cleverapps.DailyTasks.INVITE_FRIENDS=3,cleverapps.DailyTasks.PASS_LEVEL=4,cleverapps.DailyTasks.COLLECT_STARS=5,cleverapps.DailyTasks.SEND_FRIEND_HELP=6,cleverapps.DailyTasks.WATCH_ADS=7,cleverapps.DailyTasks.USE_MULTI_COLOR_CELL=8,cleverapps.DailyTasks.USE_BOOSTER=9,cleverapps.DailyTasks.COLLECT_COLOR_CELLS=10,cleverapps.DailyTasks.PASS_LEVELS_IN_ROW=11,cleverapps.DailyTasks.LEVEL_CHAMPION=12,cleverapps.DailyTasks.SPEND_GOLD=13,cleverapps.DailyTasks.COLLECT_SPECIAL_CELLS=14,
cleverapps.DailyTasks.GUESS_EXTRA_WORDS=15,cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER=16,cleverapps.DailyTasks.USE_HINTS=17,cleverapps.DailyTasks.TOURNAMENT_WIN=18,cleverapps.DailyTasks.FINISH_EPISODE=19,cleverapps.DailyTasks.RECEIVE_PERIODIC_BONUS=20,cleverapps.DailyTasks.BEAT_FRIEND=22,cleverapps.DailyTasks.PLAY_BONUS_ROUND=23,cleverapps.DailyTasks.COLLECT_HERO_CELLS=24,cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE=25,cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT=26,cleverapps.DailyTasks.COLLECT_JOKERS_USING_COMBO=27,cleverapps.DailyTasks.COMPLETE_MINING=28,cleverapps.DailyTasks.MAKE_ORDER=29,cleverapps.DailyTasks.SPEND_COINS=30,cleverapps.DailyTasks.COLLECT_COINS=31,cleverapps.DailyTasks.HARVEST_FRUITS=32,cleverapps.DailyTasks.USE_WORKER=33,cleverapps.DailyTasks.OPEN_CHEST=34,cleverapps.DailyTasks.MERGE_WITH_BONUS=35,cleverapps.DailyTasks.MERGE=36,cleverapps.DailyTasks.BUY_UNITS_SHOP_ITEMS=37,cleverapps.DailyTasks.COMPLETE_DAILY_TASKS=38,cleverapps.DailyTasks.LEVELS=["low","mid",
"hard"],cleverapps.DailyTasks.TASKS_BY_ORDER={},cleverapps.DailyTasks.PRIORITY_TYPES=[],cleverapps.DailyTasks.ACTIVE_TASKS=3,cleverapps.DailyTasks.DURATION="1 day";var DailyTasksConfig=[{type:cleverapps.DailyTasks.LOGIN_FACEBOOK,data:{low:1},filter:function(){return!cleverapps.flags.nologin&&!cleverapps.social.isLoggedIn()&&"facebook"===cleverapps.social.getCode()}},{type:cleverapps.DailyTasks.LIKE_PAGE,data:{low:1},filter:function(){return!cleverapps.flags.nocommunity&&!cleverapps.serverFlags.hasFlag(cleverapps.ServerFlags.PAGE_LIKED)&&cleverapps.ShareBonus.IsRewardAvailable()}},{type:cleverapps.DailyTasks.INVITE_FRIENDS,data:{mid:1},filter:function(){return cleverapps.social.isLoggedIn()&&cleverapps.ShareBonus.IsRewardAvailable()}},{type:cleverapps.DailyTasks.SHARE,data:{low:1},filter:function(){return cleverapps.social.isLoggedIn()&&cleverapps.ShareBonus.IsRewardAvailable()&&-1===["android","amazon","ios"].indexOf(cleverapps.User.calcSource())}},{
type:cleverapps.DailyTasks.SEND_FRIEND_HELP,data:{low:1},filter:function(){return!cleverapps.flags.noviral&&levels.friendRequests.existRequestTypes(levels.FriendRequest.SENT_HELP_REQUESTS)}},{type:cleverapps.DailyTasks.WATCH_ADS,dinamic:function(){return cleverapps.flags.reduceAds?{low:10,mid:20,hard:60}:{low:2,mid:10,hard:30}},filter:function(){var e=cleverapps.toolbar.getItem(ToolbarItem.REWARDED_VIDEO);return RewardedAdsManager.IsEnabled()&&!cleverapps.flags.almostNoAds&&levels.user.checkAvailable(RewardedAdsManager.AVAILABLE)&&e&&e.isAvailable()}},{type:cleverapps.DailyTasks.SPEND_GOLD,data:{mid:500,hard:1500}}];"board"===cleverapps.config.type?DailyTasksConfig=DailyTasksConfig.concat([{type:cleverapps.DailyTasks.PASS_LEVEL,data:{low:1,mid:5,hard:10}},{type:cleverapps.DailyTasks.GUESS_EXTRA_WORDS,data:{low:2,mid:10,hard:30}},{type:cleverapps.DailyTasks.USE_HINTS,dynamic:function(){return"stacks"===cleverapps.config.subtype?{low:1,mid:3,hard:5}:{low:2,mid:10,hard:25}}},{
type:cleverapps.DailyTasks.FINISH_EPISODE,data:{mid:1,hard:3},filter:function(){return cleverapps.metha.getType()===Metha.HOSE&&levels.user.level<5&&!levels.user.isPassedAll()}},{type:cleverapps.DailyTasks.TOURNAMENT_WIN,data:{low:1,mid:2,hard:8},filter:function(){var e=cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_REGULAR);return cleverapps.isKnockoutGame()||e&&e.tournament}},{type:cleverapps.DailyTasks.RECEIVE_PERIODIC_BONUS,data:{low:1,mid:1}},{type:cleverapps.DailyTasks.BEAT_FRIEND,data:{mid:1},filter:function(){return cleverapps.metha.getType()===Metha.HOSE&&0<cleverapps.friends.listFriends().length}},{type:cleverapps.DailyTasks.PLAY_BONUS_ROUND,data:{low:1},filter:function(){return cleverapps.bonusRoundChest&&!cleverapps.bonusRoundChest.locked}},{type:cleverapps.DailyTasks.GUESS_WORDS_WITH_LETTER,dynamic:function(){var e=["t","a","o","i","n","s","h","r"],t=["d","l","c","u","m","w","g","y","p"];return cleverapps.settings.language===cc.sys.LANGUAGE_RUSSIAN?(e=["ч",
"е","г","п","в","ф","л","д"],t=["а","и","у","с","к","р","о","я","н"]):cleverapps.settings.language===cc.sys.LANGUAGE_JAPANESE&&(e=["あ","か","ち","す","と","モ","エ","コ"],t=["は","ラ","わ","ひ","ニ","る","く","ロ","ん"]),cleverapps.Random.choose([{letter:cleverapps.Random.choose(e),low:3,mid:15},{letter:cleverapps.Random.choose(t),low:5,mid:15}])}}]):"solitaire"===cleverapps.config.type?DailyTasksConfig=DailyTasksConfig.concat([{type:cleverapps.DailyTasks.PASS_LEVEL,data:{low:1,mid:5,hard:10}},{type:cleverapps.DailyTasks.USE_HINTS,data:{low:2,mid:10,hard:25}},{type:cleverapps.DailyTasks.COLLECT_CARDS_BY_VALUE,data:{low:5,mid:10,hard:15},dynamic:function(){return{cardValue:cleverapps.Random.choose(Card.VALUES.slice(8))}}},{type:cleverapps.DailyTasks.COLLECT_CARDS_BY_SUIT,data:{low:10,mid:25,hard:50},dynamic:function(){return{cardSuit:cleverapps.Random.choose(Card.SUITS)}}},{type:cleverapps.DailyTasks.COLLECT_JOKERS_USING_COMBO,data:{low:5,mid:10,hard:15}}]
):"differences"===cleverapps.config.type?DailyTasksConfig=DailyTasksConfig.concat([{type:cleverapps.DailyTasks.PASS_LEVEL,data:{low:1,mid:5,hard:10}},{type:cleverapps.DailyTasks.USE_HINTS,data:{low:2,mid:10,hard:25}},{type:cleverapps.DailyTasks.RECEIVE_PERIODIC_BONUS,data:{low:1,mid:1}}]):"match3"===cleverapps.config.type?(DailyTasksConfig=DailyTasksConfig.concat([{type:cleverapps.DailyTasks.PASS_LEVEL,data:{low:2,mid:10,hard:25}},{type:cleverapps.DailyTasks.COLLECT_STARS,data:{low:3,mid:20,hard:50}},{type:cleverapps.DailyTasks.USE_MULTI_COLOR_CELL,data:{low:3,mid:10,hard:30}},{type:cleverapps.DailyTasks.USE_BOOSTER,dynamic:function(){return cleverapps.Random.choose([{booster:CellBooster.ID,low:2,mid:5,hard:10},{booster:LineBooster.ID,low:2,mid:4,hard:8},{booster:ColorBooster.ID,mid:3,hard:7}])}},{type:cleverapps.DailyTasks.COLLECT_COLOR_CELLS,data:{low:50,mid:50},dynamic:function(){return{color:cleverapps.Random.choose(["a","b","c","d","e","w"])}}},{
type:cleverapps.DailyTasks.PASS_LEVELS_IN_ROW,data:{mid:5,hard:10}},{type:cleverapps.DailyTasks.LEVEL_CHAMPION,data:{mid:1,hard:3},filter:function(){return 0<cleverapps.friends.listFriends().length}},{type:cleverapps.DailyTasks.COLLECT_HERO_CELLS,data:{low:5,mid:25,hard:75},dynamic:function(){return{color:cleverapps.Random.choose(["a","b","c","d","e","w"])}}},{type:cleverapps.DailyTasks.COLLECT_SPECIAL_CELLS,dynamic:function(){var e={16:{mid:20,hard:50,cell_code:FishCell.GOAL_ID},23:{low:10,mid:50,hard:150,cell_code:FlowerCell.GOAL_ID},31:{low:20,mid:100,hard:300,cell_code:NutCell.GOAL_ID},76:{low:20,mid:100,hard:300,cell_code:Mark.GOAL_ID},91:{mid:5,hard:15,cell_code:MouseCell.GOAL_ID},151:{low:30,mid:150,hard:500,cell_code:IceTile.GOAL_ID},181:{mid:5,hard:15,cell_code:DragonCell.GOAL_ID},196:{mid:20,hard:50,cell_code:CookieManCell.GOAL_ID},376:{mid:50,hard:150,cell_code:CakeCell.GOAL_ID},406:{low:20,mid:100,hard:300,cell_code:MuffinGoalCell.GOAL_ID},526:{low:20,mid:100,hard:300,
cell_code:WaffleCell.GOAL_ID},616:{low:20,mid:100,hard:300,cell_code:LollipopCell.GOAL_ID},706:{mid:5,hard:15,cell_code:DogCell.GOAL_ID},736:{low:10,mid:50,hard:150,cell_code:TruffleCell.GOAL_ID},766:{low:20,mid:100,hard:300,cell_code:ColorCookieManCell.GOAL_ID}},t=levels.user.getProgress(),s=Object.keys(e).filter(function(e){return t<=+e}),i=cleverapps.Random.choose(s);if(i)return e[i]}}]),cleverapps.DailyTasks.TASKS_BY_ORDER={0:[cleverapps.DailyTasks.USE_MULTI_COLOR_CELL,cleverapps.DailyTasks.USE_BOOSTER,cleverapps.DailyTasks.PASS_LEVELS_IN_ROW]}):"merge"===cleverapps.config.type&&(DailyTasksConfig=[{type:cleverapps.DailyTasks.COMPLETE_MINING,data:{goal:10},reward:{coins:5}},{type:cleverapps.DailyTasks.MAKE_ORDER,data:{goal:3},reward:{coins:10}},{type:cleverapps.DailyTasks.SPEND_COINS,data:{goal:150},reward:{rubies:7}},{type:cleverapps.DailyTasks.COLLECT_COINS,data:{goal:200},reward:{coins:10}},{type:cleverapps.DailyTasks.SPEND_GOLD,data:{goal:7},reward:{rubies:10}},{
type:cleverapps.DailyTasks.HARVEST_FRUITS,data:{goal:15},reward:{coins:10}},{type:cleverapps.DailyTasks.USE_WORKER,data:{goal:10},reward:{coins:5}},{type:cleverapps.DailyTasks.OPEN_CHEST,data:{goal:3},reward:{coins:10}},{type:cleverapps.DailyTasks.MERGE_WITH_BONUS,data:{goal:3},reward:{coins:5},permanent:!0},{type:cleverapps.DailyTasks.MERGE,data:{goal:15},reward:{coins:5},permanent:!0},{type:cleverapps.DailyTasks.BUY_UNITS_SHOP_ITEMS,data:{goal:1},reward:{rubies:1},permanent:!0},{type:cleverapps.DailyTasks.COMPLETE_DAILY_TASKS,data:{goal:7},permanent:!0}],cleverapps.DailyTasks.ACTIVE_TASKS=8,cleverapps.DailyTasks.LEVELS=!1);var DailyTasksWindow=Window.extend({onWindowLoaded:function(){this.createContent();var e=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.DailyTasksWindow,!0);this._super({name:"dailytaskswindow",title:cleverapps.dailyTasks.isRunning()?"messages:DailyTasksWindow.title":"messages:DailyTasksWindow.finished.title",content:this.content,styles:e}),
this.content.baseScale=this.content.scale,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASKS_OPEN_WINDOW),cleverapps.playSession.set(cleverapps.EVENTS.SESSION_DAILY_TASK_OPEN_WINDOW,!0),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){cleverapps.dailyTasks.processResults();var e=[];e.push(this.createBottom()),e.push(this.createTasks());var t=cleverapps.styles.DailyTasksWindow.content,s=new cleverapps.Layout(e,{direction:cleverapps.UI.VERTICAL,y:t.offsetY,margin:t.margin,padding:t.padding});this.content?this.content.innerContent&&this.content.innerContent.removeFromParent():(this.content=new cc.Node,this.content.setContentSize2(s.getContentSize())),this.window&&this.setTitle(Messages.get(cleverapps.dailyTasks.isRunning()?"messages:DailyTasksWindow.title":"messages:DailyTasksWindow.finished.title")),this.content.innerContent=s,this.content.addChild(s),s.setAnchorPoint2(.5,1),s.setPositionRound(0,this.content.height/2)},
createBottom:function(){var e,t=new cc.Node;return t.setAnchorPoint2(),t.setContentSize2(cleverapps.styles.DailyTasksWindow.content.bottom),e=cleverapps.dailyTasks.isRunning()?this.createTimer():this.createRefreshButton(),t.addChild(e),e.setPosition(t.width/2,t.height/2),t.setCascadeOpacityEnabled(!0),e.setCascadeOpacityEnabled(!0),this.bottomContent=t},createTimer:function(){var e=cleverapps.styles.DailyTasksWindow.timer,t=cleverapps.dailyTasks.getTimeLeft(),s=this.countDown=new cleverapps.CountDown(t,{onFinish:function(){this.createContent()}.bind(this)}),i={font:cleverapps.styles.FONTS.DAILY_TASK_TIMER_TEXT||e.timerFont,timerPosition:e.timerPosition};bundles.main.frames.missions_item_bg_png&&(i.background_content=cleverapps.UI.createScale9Sprite(bundles.main.frames.daily_task_timer_bg_png||e.bg),i.background_content.setContentSize2(e.width,e.height));var n=new cleverapps.CountDownView(s,i),o=cleverapps.UI.generateTTFText("messages:DailyTasksWindow.TimeToRefresh",e.font);o.fitTo(
e.text.width);var r=[o,n];if(e.direction===cleverapps.UI.VERTICAL&&r.reverse(),n.setCascadeOpacityEnabled(!0),bundles.main.frames.daily_task_timer_icon_png){var a=new cc.Sprite(bundles.main.frames.daily_task_timer_icon_png);n.addChild(a),a.setPositionRound(e.icon),a.setScale(e.icon.scale||1)}return this.timer=new cleverapps.Layout(r,{direction:e.direction,margin:e.margin}),n.y+=e.dy,n.setCascadeOpacityEnabled(this.timer),this.timer},createTasks:function(){var i=[];cleverapps.dailyTasks.tasks.forEach(function(e,t){var s=new DailyTaskView(e,this.close.bind(this));i.push(s)},this),this.taskViews=cleverapps.clone(i);var e=cleverapps.styles.DailyTasksWindow.tasks,t=new cleverapps.Layout(i.reverse(),{direction:cleverapps.UI.VERTICAL,margin:e.margin}),s=new ccui.Layout;s.setAnchorPoint2(),s.setContentSize2(t.width+e.crop.dx,t.height+e.crop.dy),s.setClippingEnabled(!0),s.addChild(t),t.setPositionRound(s.width/2,s.height/2);var n=new cc.Node;return n.setAnchorPoint2(),n.setContentSize2(
t.getContentSize()),s.setPositionRound(n.width/2,n.height/2),n.addChild(s),n},createRefreshButton:function(){var e=cleverapps.styles.DailyTasksWindow;return new cleverapps.UI.Button({width:e.button.width,height:e.button.height,text:Messages.get("DailyTasksWindow.Refresh"),font:cleverapps.styles.FONTS.BUTTON_TEXT,padding:{x:e.button.paddingX},onClicked:this.refresh.bind(this)})},hideOneTask:function(e,t,s){e.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.Spawn(new cc.MoveBy(.5,cc.p(-e.width,0)).easing(cc.easeBackIn()),new cc.Sequence(new cc.DelayTime(.25),new cc.FadeOut(.25))),new cc.CallFunc(s)))},showOneTask:function(e,t,s){e.setVisible(!1),e.setScale(0),e.setOpacity(0),e.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){e.setVisible(!0),e.onShowAnimation()}),new cc.Spawn(new cc.ScaleTo(.5,1).easing(cc.easeBackOut()),new cc.FadeIn(.25)),new cc.CallFunc(s)))},hideTasks:function(e){var t=0,s=function(){++t===this.taskViews.length&&e()}.bind(this)
;this.taskViews.forEach(function(e,t){this.hideOneTask(e,.3*t,s)},this)},showTasks:function(e){var t=0,s=function(){++t===this.taskViews.length&&e()}.bind(this);this.taskViews.forEach(function(e,t){this.showOneTask(e,.3*t,s)},this)},refresh:function(){0===cleverapps.dailyTasks.getNotCollectedTasks().length?(this.bottomContent.runAction(new cc.ScaleTo(.2,0)),this.hideTasks(function(){cleverapps.dailyTasks.startNew(),this.createContent(),this.bottomContent.setVisible(!1),this.showTasks(function(){this.bottomContent.setVisible(!0),this.bottomContent.setOpacity(0),this.bottomContent.runAction(new cc.FadeIn(.3))}.bind(this))}.bind(this))):(cleverapps.dailyTasks.isRunning()||cleverapps.dailyTasks.collectFinishedTasks(),this.createContent())},close:function(){cleverapps.dailyTasks.isRunning()||cleverapps.dailyTasks.collectFinishedTasks(),this._super()}});DailyTasksWindow.prototype.listBundles=function(){return["dailytasks"]},cleverapps.styles.DailyTasksWindow={button:{width:350,height:100,
paddingX:10},tasks:{margin:20,crop:{dx:0,dy:150}},content:{margin:30,bottom:{width:500,height:100},padding:{x:-40,y:0}},timer:{direction:cleverapps.UI.HORIZONTAL,bg:bundles.main.frames.missions_item_bg_png,width:240,height:70,margin:10,timerPosition:{x:0,y:0},font:cleverapps.styles.FONTS.WINDOW_TEXT,timerFont:cleverapps.styles.FONTS.TEXT,dy:0,text:{width:450}},contentOffset:-60};var DailyTaskView=cc.Node.extend({ctor:function(e,t){this._super(),this.task=e;var s=cleverapps.styles.DailyTaskView;this.setContentSize2(s.width,s.height),this.setAnchorPoint2(),this.setLocalZOrder(s.localZOrder["level_"+e.getLevel()].zOrder),this.addBackground(),this.addTitle(),this.addPresent(),this.addIcon(),-1!==["scramble","differences","wordsoup","tripeaks","wordheaps","magicwords"].indexOf(cleverapps.config.name)?this.addProgressBar():(this.addProgressCounter(),this.addBackgroundTop()),this.addCheckMark(),this.addRewardButton(t),this.addPlayButton(t),this.setCascadeOpacityEnabled(!0)},
onShowAnimation:function(){var e=this.icon.getScale();this.icon.setScale(.7*e);var t=this.playButton.getScale();this.playButton.setScale(.7*t);var s=this.rewardButton.getScale();this.rewardButton.setScale(.7*s),this.icon.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*e),new cc.ScaleTo(.4,e).easing(cc.easeBackOut()))),this.playButton.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*t),new cc.ScaleTo(.4,t).easing(cc.easeBackOut()))),this.rewardButton.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.2*s),new cc.ScaleTo(.4,s).easing(cc.easeBackOut())))},onEnterTransitionDidFinish:function(){this._super(),this.task.onUpdateListener=this.createListener(this.onUpdate.bind(this)),this.onUpdate()},getBackgroundImage:function(){if(bundles.dailytasks.frames.daily_task_bg_png)return bundles.dailytasks.frames.daily_task_bg_png;var e=this.task.getLevel()
;return"low"===e?bundles.dailytasks.frames.missions_easy_bg_png:"mid"===e?bundles.dailytasks.frames.missions_medium_bg_png:"hard"===e?bundles.dailytasks.frames.missions_hard_bg_png:void 0},addBackground:function(){var e=this.background=cleverapps.UI.createScale9Sprite(this.getBackgroundImage());e.setContentSize2(this.getContentSize()),e.setPositionRound(this.width/2,this.height/2),this.addChild(e)},addRewardButton:function(){var e=cleverapps.styles.DailyTaskView,t=cleverapps.UI.generateOnlyText("messages:DailyTaskView.Get",cleverapps.styles.FONTS.DAILY_TASK_BUTTON_TEXT),s=this.rewardButton=new cleverapps.UI.Button({width:e.button.width,height:e.button.height,button_png:e.button_png,button_on_png:e.button_on_png,content:t,onClicked:function(){new DailyTaskRewardWindow(this.task)}.bind(this)});s.setPositionRound(e.button.x,e.button.y),this.addChild(s),s.setScale(e.button.scale),s.baseScale=s.scale,s.setCascadeOpacityEnabled(!0),s.setLocalZOrder(1)},addPlayButton:function(e){
var t=cleverapps.styles.DailyTaskView;t=t.playButton?t.playButton:t.button;var s=cleverapps.UI.generateOnlyText("messages:DailyTaskView.Go",cleverapps.styles.FONTS.DAILY_TASK_BUTTON_TEXT),i=this.playButton=new cleverapps.UI.Button({width:t.width,height:t.height,button_png:t.button_png,button_on_png:t.button_on_png,content:s,onClicked:function(){e(),this.task.run()}.bind(this)});this.addChild(i),i.setPositionRound(t.x,t.y),i.setScale(t.scale),i.baseScale=i.scale,i.setCascadeOpacityEnabled(!0),i.setLocalZOrder(1)},addProgressBar:function(){var e=cleverapps.styles.DailyTaskView.progressBar;this.progressBar=new ScaledProgressBar(bundles.dailytasks.frames.daily_task_bar_png),this.progressBar.setDimension(e.width,e.height),this.progressBar.setPercentage(0),this.progressBar.setMinProgressWidth(e.minWidth);var t=new cc.Scale9Sprite(bundles.dailytasks.frames.daily_task_bar_bg_png);t.setContentSize2(e.width+e.bg.padding.x,e.height+e.bg.padding.y),t.addChild(this.progressBar),
t.setCascadeOpacityEnabled(!0),this.progressBar.setPositionRound(e.offsetX,e.offsetY),this.progressBarText=cleverapps.UI.generateImageText(this.task.progress+"/"+this.task.goal,cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_FONT),t.addChild(this.progressBarText),this.progressBarText.setPositionRound(e.text),this.addChild(t),t.setPositionRound(e)},addProgressCounter:function(){var e=cleverapps.styles.DailyTaskView,t=cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_FONT||e.progress.font;100<=this.task.progress&&(t=cleverapps.styles.FONTS.DAILY_TASK_PROGRESS_SMALL_FONT||e.progress.fontSmall);var s=this.progressCounter=cleverapps.UI.generateImageText(this.task.progress+" / "+this.task.goal,t);s.setAnchorPoint2(),s.setPosition(e.progress.x,e.progress.y),this.addChild(s)},addTitle:function(){var e=cleverapps.styles.DailyTaskView,t=this.task.getTitle(),s=this.title=cleverapps.UI.generateOnlyText(t.text,cleverapps.styles.FONTS.DAILY_TASK_FONT||e.title.font,t.replace);s.setAnchorPoint2(),
s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(e.title.width,0),s.setPosition(e.title.x,e.title.y),e.title.height&&s.fitTo(void 0,e.title.height),this.addChild(s,1)},addCheckMark:function(){var e=cleverapps.styles.DailyTaskView,t=this.check=new cc.Sprite(bundles.dailytasks.frames.daily_task_mark_png||bundles.main.frames.goal_done_sign||bundles.game.frames.goal_done_sign);t.setPositionRound(e.check.x,this.height/2),t.visible=!1,this.addChild(t)},addPresent:function(){var e=cleverapps.styles.DailyTaskView.present,t=this.present=new cleverapps.Spine(e.animation.skeleton);e.animation.skin&&t.setSkin(e.animation.skin["level_"+this.task.getLevel()]),t.setScale(e.animation.scale),t.setPositionRound(e.x,e.y),t.visible=!1,this.addChild(t)},addIcon:function(){var e=cleverapps.styles.DailyTaskView,t=this.icon=new cc.Node;t.setAnchorPoint2();var s=this.task.getIcon();if(bundles.dailytasks.frames.daily_task_icon_bg_png){var i=new cc.Sprite(
bundles.dailytasks.frames.daily_task_icon_bg_png);t.addChild(i),t.setContentSize2(i.getContentSize()),i.setPositionRound(t.width/2,t.height/2),s.width>.7*i.width&&(s.scale=.7*i.width/s.width)}else t.setContentSize2(s.getContentSize());if(bundles.dailytasks.frames.missions_frame_white_png){var n=this.iconFrame=new cc.Sprite(bundles.dailytasks.frames.missions_frame_white_png);n.setPositionRound(t.width/2,t.height/2),t.addChild(n)}s.setPositionRound(t.width/2,t.height/2),t.addChild(s),t.setCascadeOpacityEnabled(!0),this.addChild(t),t.setPositionRound(e.icon.x,e.icon.y)},addBackgroundTop:function(){var e=cleverapps.styles.DailyTaskView.bg_top,t=cleverapps.UI.createScale9Sprite(e["level_"+this.task.getLevel()]);t.setContentSize2(e.width,e.height),this.addChild(t),t.setPositionRound(e);var s=cleverapps.UI.generateOnlyText("messages:DailyTaskView.level."+this.task.getLevel(),cleverapps.styles.FONTS.DAILY_TASKS_LEVEL_TEXT);s.setAnchorPoint2(),s.fitTo(
t.width-cleverapps.styles.UI.Button.contentPadding),t.addChild(s),s.setPositionRound(t.width/2,e.title.y)},updateProgress:function(){this.progressCounter&&(this.progressCounter.visible=!this.task.isFinished(),this.progressCounter.setString(this.task.progress+" / "+this.task.goal),this.task.expired&&this.progressCounter.setPositionY(this.height/2),this.task.expired&&!this.task.isFinished()&&this.progressCounter.setColor(cleverapps.styles.COLORS.EXPIRED_TASK_FONT_COLOR||cleverapps.styles.COLORS.DARK_RED||cleverapps.styles.COLORS.COLOR_RED)),this.progressBar&&(this.progressBar.setPercentage(this.task.progress/this.task.goal*100),this.progressBarText.setString(this.task.progress+"/"+this.task.goal))},onUpdate:function(){var e=cleverapps.styles.DailyTaskView;this.playButton.setVisible(!this.task.collected&&!this.task.expired&&!this.task.isFinished()),this.rewardButton.setVisible(!this.task.collected&&!this.task.expired&&this.task.isFinished()),this.iconFrame&&this.iconFrame.setSpriteFrame(
new cc.Sprite(this.task.isFinished()?bundles.dailytasks.frames.missions_frame_green_png:bundles.dailytasks.frames.missions_frame_white_png).getSpriteFrame()),this.check&&(this.check.visible=this.task.isFinished()&&this.task.collected),this.updateProgress(),this.task.isFinished()&&!this.task.collected?this.present.setAnimation(0,e.present.animation.animation["level_"+this.task.getLevel()]||e.present.animation.animation,e.present.animation.loop):this.present.visible=!1}});cleverapps.styles.DailyTaskView={width:700,height:180,icon:{x:90,y:94},title:{x:340,y:100,width:300,height:140,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},bg_top:{level_low:bundles.dailytasks.frames.daily_task_missions_easy_top_png,level_mid:bundles.dailytasks.frames.daily_task_missions_medium_top_png,level_hard:bundles.dailytasks.frames.daily_task_missions_hard_top_png,width:180,height:46,x:{align:"center"},y:{align:"bottom",dy:-8},title:{y:23}},localZOrder:{level_low:{zOrder:1},level_mid:{zOrder:2},level_hard:{
zOrder:3}},progress:{x:580,y:120,font:cleverapps.styles.FONTS.WINDOW_TEXT,fontSmall:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},check:{x:580},present:{x:580,y:120,animation:{skeleton:bundles.windows.jsons.present_json,skin:{level_low:"blue",level_mid:"pink",level_hard:"green"},scale:1,animation:"animation",loop:!0}},button:{width:210,height:100,scale:.7,x:580,y:58}};var DailyTaskRewardWindow=RewardWindow.extend({ctor:function(e){this.task=e,this.reward=this.getReward(),this._super({reward:this.reward})},onWindowLoaded:function(e){this._super({reward:this.reward,title:"messages:DailyTaskRewardWindow.title",name:"dailytaskrewardwindow",text:"messages:DailyTaskRewardWindow.text",animation:cleverapps.styles.DailyTaskRewardWindow.animation,rewardName:"dailyTasks"})},getReward:function(){var e=RewardsConfig.DailyTask,t=cleverapps.Random.choose(e[this.task.getLevel()]);return e.prepareByRich&&(t=cleverapps.user.prepareRewardByRich(t)),cleverapps.clone(t,!0)},onReceiveReward:function(){
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_TASK_REWARD+this.task.getLevel()),cleverapps.playSession.inc(cleverapps.EVENTS.SESSION_DAILY_TASK_REWARD),cleverapps.dailyTasks.collect(this.task)},receiveReward:function(){this.task.isFinished()&&!this.task.collected&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward))}});cleverapps.styles.DailyTaskRewardWindow={animation:{json:bundles.main.jsons.reward_spine_json}};var BattlePass=function(e){this.mission=e;var i=0;this.levels=e.levels.map(function(e,t){i+=e.task.goal;var s=cleverapps.extend({level:t},e);return s.task.goalTotal=i,s}),(e.battlePass=this).load(e.details),this.checkComplete()&&this.mission.complete()};BattlePass.prototype.checkComplete=function(){return this.isAllTasksCompleted()&&this.hasPremium()&&0===this.countAvailableRewards()},BattlePass.prototype.save=function(){this.mission.details=this.getInfo(),this.mission.update(0,this.getInfo())},BattlePass.prototype.load=function(e){
var t=function(e){return e.reduce(function(e,t){return e|1<<t},0)};if(this.premium=e.premium||e.boughtPremium||void 0,this.rewards=e.rewards||0,this.premiumRewards=e.premiumRewards||0,this.progress=e.progress||0,Array.isArray(e.levelsToReward)&&(this.rewards=t(e.levelsToReward)),Array.isArray(e.levelsToPremReward)&&(this.premiumRewards=t(e.levelsToPremReward)),e.currentTask){var s=Math.min(e.currentTask.level||0,this.levels.length-1),i=e.currentTask.progress||0;this.progress=this.levels[s].task.goalTotal-this.levels[s].task.goal+i}this.shownProgress=e.shownProgress||this.progress;var n=(1<<this.getLevel(this.progress))-1;(this.rewards>n||this.premiumRewards>n)&&cleverapps.throwAsync("Battle pass reward available on next level"),this.rewards&=n,this.premiumRewards&=n},BattlePass.prototype.getInfo=function(){return{premium:this.premium,rewards:this.rewards,premiumRewards:this.premiumRewards,progress:this.progress,shownProgress:this.shownProgress}},
BattlePass.prototype.completeCurrentTask=function(){var e=this.getCurrentTask();e&&this.addProgress(e.goal-e.progress)},BattlePass.prototype.updateLastShownTask=function(e){this.levels[e.level]?this.shownProgress=this.levels[e.level].task.goalTotal-this.levels[e.level].task.goal+e.progress:this.shownProgress=0,this.save()},BattlePass.prototype.takeLevelReward=function(e,t){if(this.hasReward(e,t)){var s=t?this.levels[e].premiumReward:this.levels[e].reward;if(s.unit){var i=cleverapps.toArray(s.unit).reduce(function(e,t){return e+t.amount},0)-Game.currentGame.map.countEmptySlots();if(0<i)return void Game.currentGame.onHintMessage("messages:Spawn.nospace",!0,{left:i})}return t?this.premiumRewards^=1<<e:this.rewards^=1<<e,this.save(),cleverapps.eventLogger.logEvent((t?cleverapps.EVENTS.BATTLE_PASS_RECEIVED_PREMIUM:cleverapps.EVENTS.BATTLE_PASS_RECEIVED)+"_"+e),this.checkComplete()&&this.mission.complete(),s}},BattlePass.prototype.hasReward=function(e,t){return(
t?this.premiumRewards:this.rewards)&1<<e},BattlePass.prototype.setPremium=function(){this.premium=1,this.save(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BATTLE_PASS_BOUGHT)},BattlePass.prototype.isAllTasksCompleted=function(){return this.progress>=this.getMaxProgress()},BattlePass.prototype.isAllTasksShown=function(){return this.shownProgress>=this.progress},BattlePass.prototype.getAvailableRewardsSet=function(){return this.hasPremium()?this.rewards<<this.levels.length|this.premiumRewards:this.rewards},BattlePass.prototype.countAvailableRewards=function(){var e=Number(this.getAvailableRewardsSet()).toString(2).match(/1/g);return e&&e.length||0},BattlePass.prototype.getLastShownReward=function(){for(var e=this.getLevel(this.shownProgress);0<=e;e--){if(this.hasPremium()&&this.hasReward(e,!0))return{level:e,premium:!0};if(this.hasReward(e))return{level:e,premium:!1}}},BattlePass.prototype.addProgress=function(e){var t=this.getLevel(this.progress),s=this.progress+(
"number"==typeof e?e:1);if(s>this.getMaxProgress()&&(s=this.getMaxProgress()),s!==this.progress){if("match3"===cleverapps.config.type){var i=cleverapps.sideBar.findMissionIcon(this.mission.type);i&&i.addProgress(s-this.progress)}this.progress=s;for(var n=this.getLevel(this.progress),o=function(e){this.rewards=this.rewards|1<<e,this.premiumRewards=this.premiumRewards|1<<e,cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BATTLE_PASS_FINISH_TASK+"_"+e),cleverapps.sideBar.resetByClassName(MissionIcon)}.bind(this);t<n;)o(t++);this.save()}},BattlePass.prototype.getLevel=function(e){for(var t=0;t<this.levels.length;t++)if(e<this.levels[t].task.goalTotal)return t;return this.levels.length},BattlePass.prototype.getTask=function(e){var t=this.getLevel(e);if(!this.levels[t])return{level:t,goal:1,progress:0};var s=this.levels[t].task;return{level:t,goal:s.goal,progress:Math.min(s.goal,e-(s.goalTotal-s.goal)),goalTotal:s.goalTotal}},BattlePass.prototype.getCurrentTask=function(){
return this.getTask(this.progress)},BattlePass.prototype.getShownTask=function(){return this.getTask(this.shownProgress)},BattlePass.prototype.getLevels=function(){return this.levels},BattlePass.prototype.getMaxProgress=function(){return this.levels[this.levels.length-1].task.goalTotal},BattlePass.prototype.hasPremium=function(){return this.premium},BattlePass.prototype.noRewards=function(){return 0===this.getLevel(this.progress)},BattlePass.PRICE=750;var BattlePassMissionLogic=function(e){this.mission=e,this.battlePass=new BattlePass(this.mission),this.shownAvailableRewards=0};BattlePassMissionLogic.prototype.canRemoveSilently=function(){return this.battlePass.checkComplete()},BattlePassMissionLogic.prototype.canRemove=function(){return 0===this.battlePass.countAvailableRewards()},BattlePassMissionLogic.prototype.hasLastChance=function(){return!this.battlePass.isAllTasksCompleted()},BattlePassMissionLogic.prototype.processEvent=function(e,t){var s=this.mission;return!(!s.isRunning(
)||s.eventType!==e)&&(s.battlePass.addProgress(t.amount),!0)},BattlePassMissionLogic.prototype.needDisplayWindow=function(){var e=this.battlePass.getAvailableRewardsSet();return e^=e&this.shownAvailableRewards},BattlePassMissionLogic.prototype.onDisplayWindow=function(){this.shownAvailableRewards=this.battlePass.getAvailableRewardsSet()},BattlePassMissionLogic.prototype.stop=function(){"merge"===cleverapps.config.type&&Game.currentGame&&Game.currentGame.map.listAvailableUnits().forEach(function(e){e.setPoints(0)})},BattlePass.LEVELS=[{level:0,task:{goal:3},reward:{unlimitedLives:"2 hour"},premiumReward:{unlimitedLives:"24 hour"}},{level:1,task:{goal:5},reward:{boosters:{5:1}},premiumReward:{boosters:{5:5}}},{level:2,task:{goal:8},reward:{unlimitedLives:"6 hour"},premiumReward:{boosters:{0:5}}},{level:3,task:{goal:12},reward:{boosters:{6:2}},premiumReward:{unlimitedLives:"48 hour"}},{level:4,task:{goal:15},reward:{unlimitedLives:"12 hour"},premiumReward:{boosters:{1:5}}},{level:5,task:{
goal:20},reward:{exp:20},premiumReward:{gold:2e3}},{level:6,task:{goal:25},reward:{boosters:{7:2}},premiumReward:{boosters:{2:5}}},{level:7,task:{goal:30},reward:{boosters:{6:3}},premiumReward:{unlimitedLives:"72 hour"}},{level:8,task:{goal:40},reward:{unlimitedLives:"24 hour"},premiumReward:{boosters:{0:10}}},{level:9,task:{goal:50},reward:{boosters:{2:5}},premiumReward:{gold:4e3}}];var BattlePassRewardIcon=cc.Node.extend({ctor:function(e){switch(this._super(),this.options=e=e||{},void 0===e.prefix&&(e.prefix="x"),e.type){case"gold":case"rubies":this.initWithSprite(bundles.reward_icons.frames.reward_gold_png,e.prefix+e.value);break;case"exp":this.initWithSprite(bundles.reward_icons.frames.reward_exp_png,e.prefix+e.value);break;case"battlePass":this.initWithSprite(bundles.battle_pass.frames.ticket,"messages:BattlePassProduct.Title");break;case"coins":this.initWithSprite(bundles.reward_icons.frames.reward_coin_png,e.prefix+e.value);break;case"lives":case"energy":this.initWithSprite(
bundles.reward_icons.frames.reward_energy_png,e.prefix+e.value);break;case"unlimitedLives":this.initWithSprite(bundles.reward_icons.frames.life_unlim,Product.FormatUnlimitedLives(e.value).title);break;case"boosters":var t=Object.keys(e.value)[0];this.initWithSprite(RewardsHelper.ICONS[t],e.prefix+e.value[t]);break;case"wands":this.initWithSprite(bundles.reward_icons.frames.reward_wand_png,e.prefix+e.value);break;case"worker":e.value=Product.FormatUnlimitedLives(e.value),this.initWithSprite(bundles.reward_icons.frames.reward_worker_png,e.value.title,{amount:e.value.amount});break;case"unit":this.initWithUnit(e.value,e.prefix)}},initWithSprite:function(e,t,s){this.initWithNode(new cc.Sprite(e),t,s)},initWithUnit:function(e,t){var s=UnitView.getUnitImage(e);s&&(s.clearTrack&&s.clearTrack(0),this.initWithNode(s,t+e.amount))},initWithNode:function(e,t,s){var i=this.options,n=cleverapps.styles.BattlePassRewardIcon;this.setContentSize2(n.icon),this.icon=e,cleverapps.UI.fitToBox(e,n.icon),
e.setAnchorPoint2(),e.setPositionRound(n.icon),this.addChild(e);var o=i.font||cleverapps.styles.FONTS.BATTLEPASS_REWARD_TEXT;cleverapps.UI.ImageFont.IsApplicable(o,t)?(this.text=cleverapps.UI.generateImageText(t,o,s),this.text.setPositionRound(n.text)):(this.text=cleverapps.UI.generateOnlyText(t,o,s),this.text.setPositionRound(n.regularText)),this.text.setAnchorPoint2(),this.text.setLocalZOrder(1),this.addChild(this.text)},setDiscolor:function(e){e?(this.icon.setOpacity(120),this.icon.setColor(new cc.Color(0,150,255,255))):(this.icon.setOpacity(255),this.icon.setColor(new cc.Color(255,255,255,255)))},setAttention:function(e){var t=cleverapps.styles.BattlePassRewardIcon.attention;if(this.attention&&(this.attention.removeFromParent(),delete this.attention),e){var s=this.attention=new cc.Sprite(e);s.setAnchorPoint2(),s.setPositionRound(t),s.setScale(t.scale),this.addChild(s)}},setShining:function(e){var t=cleverapps.styles.BattlePassRewardIcon.shining;if(this.shining&&(
this.shining.removeFromParent(),delete this.shining),e){var s=this.shining=new cleverapps.Spine(bundles.battle_pass.jsons.shining_json||bundles.merge.jsons.prize_shining_json,t.scale);s.setAnimation(0,t.animation,!0),s.setAnchorPoint2(),s.setPositionRound(t),s.setLocalZOrder(-1),this.addChild(s)}},setFlying:function(e,t){var s=cleverapps.styles.BattlePassRewardIcon.flying;this.flyingAction&&(this.stopAction(this.flyingAction),delete this.flyingAction),e&&(this.flyingAction=this.runAction(new cc.Sequence(new cc.DelayTime(1.5*Math.random()),new cc.CallFunc(function(){this.flyingAction=this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){this.icon.runAction(new cc.Sequence(new cc.MoveBy(3,0,s.offsetY),new cc.CallFunc(function(){Math.random()<.7/t.countAvailableRewards()&&this.icon.runAction(new cc.Sequence(new cc.RotateBy(.25,10),new cc.RotateBy(.25,-10),new cc.RotateBy(.25,10),new cc.RotateBy(.25,-10)))},this),new cc.MoveBy(1.5,0,-s.offsetY)))},this),
new cc.DelayTime(4.5))))},this))))},updateState:function(e,t){var s,i=cleverapps.styles.BattlePassRewardIcon;switch(this.options.premium&&!e.hasPremium()?s="premium_required":(this.options.level<t.level||this.options.level===t.level&&t.goal===t.progress)&&(s=e.hasReward(this.options.level,this.options.premium)?"fresh":"gained"),cc.eventManager.removeListeners(this),this.setDiscolor(!1),this.setAttention(),this.setShining(!1),this.setFlying(!1),s){case"premium_required":this.setDiscolor(!0),cleverapps.tooltipManager.create(this,{text:"messages:BattlePassWindow.needPremiumToolTip",position:cleverapps.styles.UI.Tooltip.LOCATION.above,swallowTouches:!1,ignoreOnTouchMoved:!0,ignoreOnTouchMovedThreshold:i.ignoreOnTouchMovedThreshold});break;case"fresh":this.setAttention(bundles.battle_pass.frames.attention_exclamation_large_png||bundles.mergeui.frames.attention_exclamation),this.setShining(!0),this.setFlying(!0,e),cleverapps.UI.onClick(this,this.claimReward.bind(this,e),{noThrottle:!0,
ignoreOnTouchMoved:!0,swallowTouches:!1,useInteractiveScale:!0});break;case"gained":this.setDiscolor(!0),this.setAttention(bundles.battle_pass.frames.attention_ok_png||bundles.mergeui.frames.attention_ok);break;default:cleverapps.tooltipManager.create(this,{text:"messages:BattlePassWindow.moreStarsToolTip",position:cleverapps.styles.UI.Tooltip.LOCATION.above,swallowTouches:!1,ignoreOnTouchMoved:!0,ignoreOnTouchMovedThreshold:i.ignoreOnTouchMovedThreshold})}return s},openRewardAnimation:function(e,t){this.options.level===t.level&&"fresh"===this.updateState(e,t)&&this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2),new cc.ScaleTo(.2,1)))},claimReward:function(e){if(!(e.getShownTask().level<this.options.level)){var t=e.takeLevelReward(this.options.level,this.options.premium);t&&new RewardWindow({reward:t})}}});BattlePassRewardIcon.createIconsFromRewardsList=function(e,t,s){var i=[];for(var n in e){var o=e[n];if("unit"===n){o=cleverapps.toArray(o);for(var r=0;r<o.length;++r)i.push(
new BattlePassRewardIcon({type:n,value:o[r],level:t,premium:s}))}else i.push(new BattlePassRewardIcon({type:n,value:o,level:t,premium:s}))}return i},cleverapps.overrideFonts(cleverapps.styles.FONTS,{BATTLEPASS_REWARD_TEXT:{size:40,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.BattlePassRewardIcon={icon:{x:{align:"center",dx:0},y:{align:"bottom",dy:10},width:180,height:180,maxScale:1.7},text:{x:{align:"right",dx:0},y:{align:"bottom",dy:10}},regularText:{x:{align:"right",dx:0},y:{align:"bottom",dy:-2}},attention:{x:{align:"right",dx:0},y:{align:"bottom",dy:85},scale:.8},shining:{x:{align:"center",dx:-8},y:{align:"center",dy:-13},animation:"idle",scale:1.2},flying:{offsetY:8},ignoreOnTouchMovedThreshold:10};var BattlePassProgress=cc.Node.extend({ctor:function(e){this._super(),this.battlePass=e;var t=cleverapps.styles.BattlePassProgress;this.setContentSize2(t.width,t.height);var s=this.tasks=this.createTasks()
;s.setAnchorPoint2(),s.setPositionRound(t.tasks);var i=this.progressBar=new ScaledProgressBar({progress:bundles.battle_pass.frames.progress_bar,background:bundles.battle_pass.frames.progress_substrate,padding:t.progressBar.padding});i.setDimension(s.width-t.tasks.width/2+t.progressBar.padding.left+t.progressBar.padding.right,t.progressBar.height),i.setAnchorPoint2(0,.5),i.setPositionRound(t.progressBar),i.setLocalZOrder(-1),i.setMinProgressWidth(t.progressBar.minWidth),s.addChild(i),cleverapps.config.debugMode&&cleverapps.UI.onClick(i,function(){e.completeCurrentTask(),this.updateState()}.bind(this)),this.progressBlock=this.createProgressAmount(),this.progressBlock.setAnchorPoint2(),s.addChild(this.progressBlock),"merge"===cleverapps.config.type?this.progressBlock.setPositionRound(t.amount):this.progressBlock.setPositionRound(this.calcAmountPosition(this.calcProgressPercentage(this.battlePass.getShownTask()))),this.addLine(t.line.height,t.line.first),this.addLine(t.line.height,
t.line.second);var n=this.progressScroll=new cleverapps.UI.ScrollView(s,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,direction:cleverapps.UI.ScrollView.DIR_HORIZONTAL,touchPadding:t.touchPadding,scrollBarEnabled:!1});n.setContentSize2(this.width,this.height),n.scrollTo(cleverapps.UI.ScrollView.SCROLLS.LOWER_RIGHT),n.setAnchorPoint2(),n.setPositionRound(t.scroll),this.addChild(n)},calcAmountPosition:function(e){var t=cleverapps.styles.BattlePassProgress,s=t.amount.offsetX,i=Math.min(Math.max(this.progressBar.width*e/100,s),this.progressBar.width-s);return this.progressBlock.calculatePositionRound(i,t.amount.y)},createTasks:function(){var n=cleverapps.styles.BattlePassProgress.tasks,e=this.battlePass.getLevels(),o=new cc.Node;o.setContentSize2(n.width*e.length,n.height);var r=this.rewardIcons=[];return e.forEach(function(e,t){var s=BattlePassRewardIcon.createIconsFromRewardsList(e.reward,e.level,!1);this.addIcons(o,s,n.width*(.5+t),n.reward.y),r.push.apply(r,s)
;var i=BattlePassRewardIcon.createIconsFromRewardsList(e.premiumReward,e.level,!0);this.addIcons(o,i,n.width*(.5+t),n.premiumReward.y),r.push.apply(r,i)}.bind(this)),this.arrows=e.map(function(e,t){var s=new cc.Sprite(bundles.battle_pass.frames.progress_arrows);return s.setAnchorPoint2(),s.setPositionRound(n.width*(.5+t),n.arrow.y),o.addChild(s),s}),o},addIcons:function(e,t,s,i){var n=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL});n.setAnchorPoint2(),n.setPositionRound(s,i),n.setLocalZOrder(1),e.addChild(n)},createProgressAmount:function(){var e=cleverapps.styles.BattlePassProgress.amount,t=new cc.Node;t.setAnchorPoint2();var s=this.progressAmount=cleverapps.UI.generateImageText("0/0",cleverapps.styles.FONTS.BATTLEPASS_PROGRESS_IMAGE_TEXT);if(s.setAnchorPoint2(0,.5),s.setPositionRound(e.value),t.addChild(s),this.battlePass.isAllTasksCompleted()&&this.battlePass.isAllTasksShown()){s.setVisible(!1);var i=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.completed",
cleverapps.styles.FONTS.BATTLEPASS_PROGRESS_TEXT);i.setAnchorPoint2(),i.setPositionRound(e.star),t.addChild(i)}else{var n=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.progress",cleverapps.styles.FONTS.BATTLEPASS_PROGRESS_TEXT);n.setAnchorPoint2(1,.5),n.setPositionRound(e.text),t.addChild(n);var o=new cc.Sprite(bundles.battle_pass.frames.progress_star);o.setAnchorPoint2(),o.setPositionRound(e.star),t.addChild(o),cleverapps.UI.wrap(t)}return t},addLine:function(e,t){var s=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.progress_lines);s.setAnchorPoint2(),s.setPositionRound(t),s.setContentSize2(this.width,e),s.setLocalZOrder(-1),this.addChild(s)},calcProgressPercentage:function(e){var t=this.battlePass.getLevels().length,s=.5/t,i=(1-s)/(t-1);return 0===e.level?e.progress/e.goal*s*100:e.level>=t?100:100*(s+i*(e.level-1)+i*e.progress/e.goal)},updateState:function(){this.finger&&(this.finger.removeFromParent(),this.finger=void 0);var t=this.battlePass,
s=t.getShownTask(),e=t.getCurrentTask();this.progressBar.setPercentage(this.calcProgressPercentage(s)),this.progressAmount.runAction(new BattlePassProgress.ProgressFromTo(0,s,s)),this.rewardIcons.forEach(function(e){e.updateState(t,s)}),this.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(function(){this.scrollToTask(s,{easing:cc.easeBackInOut(),callback:this.animateProgress.bind(this,s,e)})}.bind(this))))},animateProgress:function(e,t){if(e.progress===e.goal&&(e=this.battlePass.getTask(e.goalTotal)),e.level>=t.level&&e.progress>=t.progress)this.showFinger();else if(e.level>=t.level)this.animateProgressStep(e,t,this.animateProgress.bind(this,t,t));else{var s={level:e.level,progress:e.goal,goal:e.goal,goalTotal:e.goalTotal};this.animateProgressStep(e,s,this.animateProgress.bind(this,s,t))}},scrollToTask:function(e,t){var s=e.level;if(s===this.battlePass.getCurrentTask().level){var i=this.battlePass.getLastShownReward();void 0!==i&&(s=i.level)}
this.arrows[s]&&this.progressScroll.scrollTo(this.arrows[s].getPosition(),.8,t)},animateProgressStep:function(e,t,s){var i=this.battlePass,n=.8,o=this.calcProgressPercentage(t);if(this.progressBar.runAction(new ScaledProgressBar.ProgressTo(n,o).easing(cc.easeCubicActionOut())),this.progressAmount.runAction(new BattlePassProgress.ProgressFromTo(n,e,t)),"merge"!==cleverapps.config.type){var r=this.calcAmountPosition(o);this.progressBlock.runAction(new cc.MoveTo(.8,r).easing(cc.easeCubicActionOut()))}this.scrollToTask(e),t.progress===t.goal&&(this.progressAmount.runAction(new cc.Sequence(new cc.DelayTime(n),new cc.ScaleTo(.2,1.2),new cc.ScaleTo(.2,1))),this.runAction(new cc.Sequence(new cc.DelayTime(n),new cc.CallFunc(function(){this.rewardIcons.forEach(function(e){e.openRewardAnimation(i,t)}),"merge"===cleverapps.config.type&&Game.currentGame.addReward("energy",i.levels[t.level].energy,this.arrows[t.level],{beginScale:.8,withoutDelta:!0})}.bind(this)))),n+=.2),this.runAction(
new cc.Sequence(new cc.DelayTime(n),new cc.CallFunc(i.updateLastShownTask.bind(i,t)),new cc.CallFunc(s)))},showFinger:function(){var t=this.battlePass.getLastShownReward();if(t){var e=this.rewardIcons.filter(function(e){return e.options.level===t.level&&e.options.premium===t.premium})[0],s=this.finger=new FingerView;s.setPositionRound(e.width/2,e.height/2),e.addChild(s),s.standardLoop({delayOnBegin:!0,delay:2.5})}}});BattlePassProgress.ProgressFromTo=cc.ProgressFromTo.extend({update:function(e){if(this.target instanceof cleverapps.UI.ImageFont){e=this._computeEaseTime(e);var t=this._from,s=this._to,i=Math.round(t.progress+(s.progress-t.progress)*e),n=Math.round(t.goal+(s.goal-t.goal)*e);this.target.setString(i+" / "+n)}}}),cleverapps.styles.BattlePassProgress={width:1750,height:700,padding:{x:40,y:0},touchPadding:{bottom:60},scroll:{x:{align:"center",dx:0},y:{align:"center",dy:0}},progressBar:{x:{align:"left",dx:-13},y:{align:"center",dy:-6},height:108,minWidth:49,padding:{top:31,
bottom:29,left:28,right:28}},amount:{x:{align:"center",dx:0},y:{align:"center",dy:-8},text:{x:-40,y:-3},star:{x:0,y:0},value:{x:40,y:0}},line:{first:{x:{align:"center",dx:35},y:{align:"center",dy:103}},second:{x:{align:"center",dx:35},y:{align:"center",dy:-201}},height:90},tasks:{width:220,height:500,arrow:{y:{align:"center",dy:-4}},reward:{y:{align:"top",dy:-15}},premiumReward:{y:{align:"bottom",dy:0}}}};var BattlePassWindow=Window.extend({onWindowLoaded:function(e){this.mission=e;var t=cleverapps.styles.BattlePassWindow;this._super({name:"battlepasswindow",title:"match3"===cleverapps.config.type&&"messages:BattlePassWindow.title",content:this.createContent(),closeButton:!0,adjustToContent:"merge"===cleverapps.config.type,contentOffsetY:t.contentOffsetY,extraWidth:t.extraWidth,extraHeight:t.extraHeight,bgOffset:t.bgOffset,foreground:bundles.windows.frames.window_foreground_png,styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.BattlePassWindow.window,!0),
help:"match3"===cleverapps.config.type&&function(){new BattlePassRulesWindow}}),cleverapps.metha.showControlsWhileFocused(BattlePassWindow.CONTROLS)},onShow:function(){var e=this.mission;e.logic.onDisplayWindow(),this.progress.updateState(),this.buyTicketButton&&!e.isRunning()&&e.battlePass.noRewards()&&this.buyTicketButton.disable()},onHide:function(){this.progress.stopAllActions()},createContent:function(){var e=cleverapps.styles.BattlePassWindow,t=this.content=new cc.Node;if(t.setAnchorPoint2(),t.setContentSize2(e),"match3"===cleverapps.config.type){var s=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.window_foreground_png,cleverapps.UI.Scale9Rect.TwoPixelXY);s.setContentSize2(e.foreground),t.addChild(s),s.setLocalZOrder(1),s.setPositionRound(e.foreground)}var i=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.progress_gradient);i.setAnchorPoint2(),i.setPositionRound(e.gradient),i.setContentSize2(e.gradient),t.addChild(i);var n=this.createTimer()
;n.setAnchorPoint2(),n.setPositionRound(e.timer),t.addChild(n);var o=this.createDescription();o.setAnchorPoint2(),o.setPositionRound(e.description),t.addChild(o);var r=this.ticket=this.createTicket();r.setAnchorPoint2(),r.setPositionRound(e.ticket),t.addChild(r);var a=this.progress=new BattlePassProgress(this.mission.battlePass);return a.setAnchorPoint2(),a.setPositionRound(e.progress),t.addChild(a),t},createTimer:function(){var e,t=cleverapps.styles.BattlePassWindow.timer,s=this.mission;if(s.getTimeLeft()){e=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.timer",cleverapps.styles.FONTS.BATTLEPASS_TITLE_TEXT);var i=new cc.Scale9Sprite(bundles.battle_pass.frames.timer_substrate);i.setAnchorPoint2(),i.setContentSize2(t);var n=new cleverapps.CountDownView(new cleverapps.CountDown(s.getTimeLeft()),{font:cleverapps.styles.FONTS.BATTLEPASS_TIMER_TEXT,timerPosition:t.timerPosition,regularFontTimerPosition:t.regularFontTimerPosition});n.setAnchorPoint2(),n.setPositionRound(
t.countdown),n.fitTo(t.countdown.width,0),i.addChild(n);var o=new cc.Sprite(bundles.battle_pass.frames.timer_icon);o.setAnchorPoint2(),o.setPositionRound(t.icon),o.setScale(t.icon.scale),i.addChild(o)}else e=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.finished",cleverapps.styles.FONTS.BATTLEPASS_TITLE_TEXT);return new cleverapps.Layout([e,i],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin})},createTicket:function(){var e=cleverapps.styles.BattlePassWindow.ticket,t=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.ticket_background,cleverapps.UI.Scale9Rect.TwoPixelXY);if(t.setContentSize2(e.width,t.height),this.mission.battlePass.hasPremium()){(i=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.ticket.hint.active",cleverapps.styles.FONTS.BATTLEPASS_TICKET_TEXT)).fitTo(e.text.width),(n=new cleverapps.Spine(bundles.battle_pass.jsons.ticket_json)).setAnimation(0,"animation",!0);var s=new cleverapps.Layout([i,n],{direction:cleverapps.UI.HORIZONTAL,
margin:e.active.margin});s.setPositionRound(e.active),t.addChild(s)}else{var i,n;(i=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.ticket.hint",cleverapps.styles.FONTS.BATTLEPASS_TICKET_SMALL_TEXT)).setAnchorPoint2(1,.5),i.setPositionRound(e.text),i.fitTo(e.text.width),t.addChild(i),(n=new cleverapps.Spine(bundles.battle_pass.jsons.ticket_json)).setAnimation(0,"animation",!0),n.setAnchorPoint2(),n.setPositionRound(e.icon),t.addChild(n);var o=cleverapps.UI.Button.Images.button_blue;"match3"===cleverapps.config.type&&(o=cleverapps.UI.Button.Images.small_button_green);var r=this.buyTicketButton=new UseGoldButton({button_images:o,price:BattlePass.PRICE,onClicked:this.buyTicket.bind(this),font:cleverapps.styles.FONTS.BATTLEPASS_BUTTON_TEXT,image:bundles.reward_icons.frames.gold_medium_png||bundles.reward_icons.frames.gold_small_png,eventName:"battle_pass_ruby"},e.button);r.setAnchorPoint2(),r.setPositionRound(e.button),t.addChild(r)}return t},createDescription:function(){
var e=cleverapps.styles.BattlePassWindow.description,t=cleverapps.UI.createScale9Sprite(bundles.battle_pass.frames.description_background,cleverapps.UI.Scale9Rect.TwoPixelXY);t.setContentSize2(e);var s=new cc.Sprite(bundles.battle_pass.frames.build_task_icon);if(s.setAnchorPoint2(),s.setPositionRound(e.icon),t.addChild(s),bundles.battle_pass.frames.shining){var i=new cc.Sprite(bundles.battle_pass.frames.shining);i.setAnchorPoint2(),i.setPositionRound(e.shining),i.setScale(e.shining.scale),i.setLocalZOrder(-1),s.addChild(i)}var n=cleverapps.UI.generateOnlyText("messages:BattlePassWindow.description",cleverapps.styles.FONTS.BATTLEPASS_DESCRIPTION_TEXT);if(n.setAnchorPoint2(),n.setPositionRound(e.text),n.setDimensions(e.text.width,0),n.fitToHeight(e.text.height),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(n),"merge"===cleverapps.config.type){var o=new cleverapps.UI.Button({button_png:bundles.battle_pass.frames.guide_button_png,
button_on_png:bundles.battle_pass.frames.guide_button_on_png,onClicked:function(){new BattlePassRulesWindow}});o.setAnchorPoint2(),o.setPositionRound(e.button),t.addChild(o)}return t},listBundles:function(){return["battle_pass"]},buyTicket:function(){this.mission.battlePass.setPremium(),this.close(),new BattlePassWindow(this.mission),new RewardWindow({reward:{battlePass:!0}})}});BattlePassWindow.CONTROLS=["MenuBarGoldItem","MenuBarLivesItem"],cleverapps.overrideFonts(cleverapps.styles.FONTS,{BATTLEPASS_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},BATTLEPASS_TIMER_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE},BATTLEPASS_PROGRESS_TEXT:{size:38,color:cleverapps.styles.COLORS.WHITE},BATTLEPASS_PROGRESS_IMAGE_TEXT:{size:42,color:cleverapps.styles.COLORS.WHITE},BATTLEPASS_TICKET_TEXT:{size:45,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},BATTLEPASS_TICKET_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT},BATTLEPASS_BUTTON_TEXT:{size:60,
color:cleverapps.styles.COLORS.WHITE},BATTLEPASS_DESCRIPTION_TEXT:{size:50,color:cleverapps.styles.COLORS.COLOR_WINDOW_TEXT}}),cleverapps.styles.BattlePassWindow={width:1800,height:1070,timer:{x:{align:"center",dx:0},y:{align:"top",dy:-50},width:250,height:66,margin:40,countdown:{x:{align:"center",dx:17},y:{align:"center",dy:0},width:180},icon:{x:{align:"left",dx:-35},y:{align:"center",dy:0},scale:.6}},gradient:{x:{align:"center",dx:0},y:{align:"top",dy:-65},width:1750,height:650},progress:{x:{align:"center",dx:0},y:{align:"top",dy:-35}},ticket:{x:{align:"center",dx:0},y:{align:"top",dy:-605},width:1752,active:{margin:20,x:{align:"center"},y:{align:"center",dy:-36}},text:{x:{align:"right",dx:-545},y:{align:"center",dy:-37},width:1100},icon:{x:{align:"right",dx:-355},y:{align:"center",dy:-30}},button:{x:{align:"right",dx:-60},y:{align:"center",dy:-34},width:280,height:105}},description:{x:{align:"center",dx:0},y:{align:"top",dy:-775},height:235,width:1650,icon:{x:{align:"left",dx:65},
y:{align:"center",dy:0}},shining:{x:{align:"center",dx:0},y:{align:"center",dy:0},scale:1.1},text:{x:{align:"center",dx:55},y:{align:"center",dy:0},width:1100,height:120},button:{x:{align:"right",dx:-45},y:{align:"center",dy:0},width:280,height:105}},window:{}};var BattlePassLastChanceWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.price=this.calcPrice(),this._super({name:"battlepasslastchancewindow",title:"messages:BattlePassLastChanceWindow.title",content:this.createContent(),buttons:this.createButtons(),closeButton:!0})},createContent:function(){var e=cleverapps.styles.BattlePassLastChanceWindow,t=cleverapps.UI.generateOnlyText("messages:BattlePassLastChanceWindow.upperText",cleverapps.styles.FONTS.DARK_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);t.setAnchorPoint2(),t.setDimensions(e.texts.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var s=this.createRewards(),i=cleverapps.UI.generateOnlyText("messages:BattlePassLastChanceWindow.lowerText",
cleverapps.styles.FONTS.DARK_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);i.setAnchorPoint2(),i.setDimensions(e.texts.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var n=new cleverapps.Layout([i,s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding}),o=this.createOfferBadge();return o.setAnchorPoint2(),o.setPositionRound(e.offerBadge),n.addChild(o),n},createRewards:function(){var e=cleverapps.styles.BattlePassLastChanceWindow.rewards,t=this.mission.battlePass,s=t.getLevels()[t.getCurrentTask().level],i=BattlePassRewardIcon.createIconsFromRewardsList(s.reward,s.level,!1).map(function(e){return this.createReward(e,!1)},this);return t.hasPremium()&&i.push.apply(i,BattlePassRewardIcon.createIconsFromRewardsList(s.premiumReward,s.level,!0).map(function(e){return this.createReward(e,!0)},this)),new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin})},createOfferBadge:function(){var e=cleverapps.styles.BattlePassLastChanceWindow.offerBadge,
t=new cc.Sprite(bundles.battle_pass.frames.offer_badge);t.setRotation(e.rotation);var s=Messages.get("BattlePassLastChanceWindow.badgeText").replace(/ /g,"\n"),i=cleverapps.UI.generateOnlyText(s,cleverapps.styles.FONTS.BP_LAST_CHANCE_BADGE||cleverapps.styles.FONTS.LIGHT_TEXT);return i.setPositionRound(e.text),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.fitTo(e.text.width,e.text.height),i.setLineHeight(Math.floor(1.1*i.getFontSize())),t.addChild(i),t},createButtons:function(){var e=cleverapps.styles.BattlePassLastChanceWindow.buttons;return[new UseGoldButton({button_images:cleverapps.UI.Button.Images.button_blue,price:this.price,onClicked:this.buyReward.bind(this),font:cleverapps.styles.FONTS.BATTLEPASS_BUTTON_TEXT,image:bundles.reward_icons.frames.gold_medium_png||bundles.reward_icons.frames.gold_small_png,eventName:"battle_pass_last_chance_ruby"},e)]},createReward:function(e,t){var s=cleverapps.styles.BattlePassLastChanceWindow.rewards,i=cleverapps.UI.createScale9Sprite(
bundles.battle_pass.frames.icon_background);if(i.setAnchorPoint2(),i.setContentSize2(s.background),e.setScale(1.3),e.setAnchorPoint2(),e.setPositionRound(s.icon),i.addChild(e),t){var n=new cc.Sprite(bundles.battle_pass.frames.icon_ribbon);n.setAnchorPoint2(),n.setPositionRound(s.ribbon),i.addChild(n);var o=Messages.get("BattlePassRewardIcon.ribbonText").replace(/ /g,"\n"),r=cleverapps.UI.generateOnlyText(o,cleverapps.styles.FONTS.BP_LAST_CHANCE_RIBBON);r.setPositionRound(s.text),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.fitTo(s.text.width,s.text.height),r.setLineHeight(Math.floor(1.2*r.getFontSize())),r.setRotation(s.text.rotation),n.addChild(r);var a=new cleverapps.Spine(bundles.battle_pass.jsons.ticket_json);a.setAnimation(0,"animation",!0),a.clearTrack(0),a.setAnchorPoint2(),a.setScale(1.3),a.setPositionRound(s.ticket),i.addChild(a)}return i},calcPrice:function(){return 100},buyReward:function(){this.mission.battlePass.completeCurrentTask(),this.close(),
new BattlePassWindow(this.mission)},listBundles:function(){return["battle_pass"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BP_LAST_CHANCE_RIBBON:{size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.BattlePassLastChanceWindow={margin:40,padding:{x:20,top:30,bottom:100},texts:{width:800},buttons:{width:300,height:110},offerBadge:{x:{align:"right",dx:105},y:{align:"bottom",dy:-155},rotation:15,text:{x:{align:"center",dx:0},y:{align:"center",dy:-8},width:160,height:160}},rewards:{margin:30,background:{width:416,height:416},icon:{x:{align:"center",dx:0},y:{align:"center",dy:10}},ribbon:{x:{align:"left",dx:1},y:{align:"top",dy:4}},text:{x:{align:"center",dx:-26},y:{align:"center",dy:36},width:104,height:74,rotation:-45},ticket:{x:{align:"right",dx:109},y:{align:"bottom",dy:-100}}}};var BattlePassRulesWindow=RulesWindow.extend({
onWindowLoaded:function(){this._super({name:"piggybankwindow",styles:cleverapps.styles.BattlePassRulesWindow})}});cleverapps.styles.BattlePassRulesWindow={prefix:"messages:BattlePassRulesWindow.",subText:{left:{y:{align:"top",dy:-252}},right:{y:{align:"top",dy:-252}}},animation:{json:bundles.battle_pass.jsons.help_json,name:"animation"},bgOffset:{x:0,y:-40}};var DailyCupPlayButton=cc.Node.extend({ctor:function(e){this._super(),this.options=e;var t=cleverapps.styles.DailyCupPlayButton;this.button=this.createButton(),this.addChild(this.button),this.setAnchorPoint2(),this.setContentSize2(this.button.getContentSize()),this.button.setPositionRound(this.width/2,this.height/2),this.options.parent.addChild(this),this.setPositionRound(t)},createButton:function(){var e=cleverapps.styles.DailyCupPlayButton;return new cleverapps.UI.Button({text:Messages.get("Play"),font:cleverapps.styles.FONTS.DAILY_CUP_PLAY_BUTTON_TEXT||cleverapps.styles.FONTS.BIG_BUTTON_TEXT,onClicked:this.options.onClicked,
width:e.width,height:e.height,button_png:e.button_png,button_on_png:e.button_on_png,padding:{x:e.titlePaddingX}})},enable:function(){this.button.enable()},disable:function(){this.button.disable()},setTitle:function(e){var t=cleverapps.styles.DailyCupPlayButton;this.button.text.setString(Messages.get(e)),this.button.text.fitTo(this.button.width-2*t.titlePaddingX)}});cleverapps.styles.DailyCupPlayButton={x:{align:"center"},y:{align:"bottom",dy:120},width:300,height:125,titlePaddingX:20};var DailyCupScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_DAILY_CUP),this.mainContainer=new cc.Node,this.mainContainer.setAnchorPoint2(),this.mainContainer.setContentSize(this.scene.getContentSize()),this.mainContainer.setPositionRound(this.scene.width/2,this.scene.height/2),cleverapps.UI.makeHideable(this.mainContainer,cleverapps.UI.SCALE_ANIMATION),cleverapps.metha.registerControl("dailyCupMainContainer",this.mainContainer),this.scene.addChild(
this.mainContainer),this.table=new DailyCupTable(cleverapps.dailyCup,cleverapps.styles.DailyCupTable,cleverapps.DailyCupRow,this.mainContainer),this.createTableBg(),this.createTitleBg(),this.createTitle(),this.createPlayButton(),this.createHelpButton(),this.createLeadersButton(),cleverapps.playSession.set(cleverapps.EVENTS.DAILY_CUP_DAU,!0),this.onNoConnectionInfo(),cleverapps.dailyCup.onNoConnectionListener=this.createListener(this.onNoConnectionInfo.bind(this)),cleverapps.dailyCup.isActive()||this.onChangeActivation(),cleverapps.dailyCup.onActivationListener=this.createListener(this.onChangeActivation.bind(this)),this.updateState(),cleverapps.dailyCup.updateListeners.scene=this.createListener(this.updateState.bind(this)),cleverapps.environment.episodeNo=DailyCup.EPISODE_ID,cleverapps.placements.run(Placements.INTERMEDIATE)},getRefreshSceneActionOnChangeSize:function(){return function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)}},getBackgroundStyles:function(){
return cleverapps.styles.DailyCupScene.background},createTableBg:function(){var e=this.getStyles().tableBg;if(e){var t=this.tableBg=cleverapps.UI.createScale9Sprite(bundles.main.frames.table_bg_png||bundles.daily_cup.frames.table_bg_png||bundles.windows.frames.window_bg_png,cleverapps.UI.Scale9Rect.TwoPixelXY);if(t.setContentSize(e.width*this.table.tableView.scaleX,e.height),this.mainContainer.addChild(t),t.setPositionRound(this.mainContainer.width/2+e.x,this.mainContainer.height/2+e.y),e.stitches&&new StitchesComponent(t,e.stitches),e.innerBg){var s=new cc.Scale9Sprite(bundles.main.frames.window_inner_bg_png);s.setContentSize2(e.innerBg.width*this.table.tableView.scaleX,e.innerBg.height),this.mainContainer.addChild(s),s.setPositionRound(e.innerBg)}}},createLeadersButton:function(){var e=this.getStyles().leadersButton,t=new cc.Sprite(bundles.daily_cup.frames.daily_cup_leaders_icon_png);this.scene.addChild(t),t.setPositionRound(e),t.setLocalZOrder(1),t.baseScale=t.scale=e.scale,
cleverapps.UI.applyHover(t),cleverapps.UI.onClick(t,function(){cleverapps.metha.display({focus:"DailyCupLeadersWindow",action:function(e){new DailyCupLeadersWindow,cleverapps.metha.onceNoWindowsListener=e}})}),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("leadersButton",t)},onChangeActivation:function(){if(cleverapps.dailyCup.isActive()){this.loading&&(this.loading.removeFromParent(!0),this.loading=void 0);var e=this.table?.7:0;this.table=new DailyCupTable(cleverapps.dailyCup,cleverapps.styles.DailyCupTable,cleverapps.DailyCupRow,this.mainContainer),this.table.runStartAnimation(e)}else this.table.runFinishAnimation(),this.loading=WaitWindow.prototype.showLoading.call(this),this.mainContainer.addChild(this.loading),this.loading.setPositionRound(this.mainContainer.width/2,this.mainContainer.height/2)},onNoConnectionInfo:function(){if(cleverapps.dailyCup.noConnection){var e=this.getStyles().noConnectionInfo
;this.noConnectionInfo=cleverapps.UI.createScale9Sprite(e.bg.image),this.noConnectionInfo.setContentSize2(e.bg.width,e.bg.height);var t=cleverapps.UI.generateTTFText("messages:InternetConnectionError",cleverapps.styles.FONTS.WHITE_TEXT);t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),t.setPositionRound(this.noConnectionInfo.width/2,this.noConnectionInfo.height/2),t.setDimensions(this.noConnectionInfo.width,this.noConnectionInfo.height),this.noConnectionInfo.addChild(t),this.mainContainer.addChild(this.noConnectionInfo,1),this.noConnectionInfo.setPositionRound(e)}else this.noConnectionInfo&&(this.noConnectionInfo.removeFromParent(!0),delete this.noConnectionInfo)},updateState:function(){cleverapps.dailyCup.stillCanPlay()?(this.createTimer(),this.removeText(),this.playButton.enable(),this.playButton.setTitle("Play")):(this.createText(),this.removeTimer(),cleverapps.dailyCup.isFinished()?(this.playButton.setTitle("Next"),
this.playButton.enable()):(this.playButton.setTitle("Play"),this.playButton.disable()))},createHelpButton:function(){var e=this.getStyles().helpButton,t=new cleverapps.UI.Button({button_png:bundles.buttons_main.frames.help_button_png,button_on_png:bundles.buttons_main.frames.help_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"DailyCupRulesWindow",action:function(e){new DailyCupRulesWindow,cleverapps.metha.onceNoWindowsListener=e}})}});this.scene.addChild(t),t.setPositionRound(e),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("helpButton",t)},createTitleBg:function(){var e=this.getStyles().titleBg;if(e){var t=bundles.daily_cup.frames.daily_cup_titleBg||bundles.main.frames.window_title_bg_png;if(e.useRibbonTitle&&(t=bundles.main.frames.ribbon),this.titleBg=cleverapps.UI.createScale9Sprite(t,cleverapps.UI.Scale9Rect.TwoPixelXY),e.width&&this.titleBg.setContentSize2(e.width*this.table.tableView.scaleX,e.height),
e.scale&&this.titleBg.setScale(e.scale),this.mainContainer.addChild(this.titleBg),this.titleBg.setPositionRound(e),bundles.daily_cup.frames.dailycup_title_icon){var s=new cc.Sprite(bundles.daily_cup.frames.dailycup_title_icon);this.titleBg.addChild(s,e.icon.zOrder||0),s.setPositionRound(e.icon)}}},createTitle:function(){var e=this.getStyles(),t=this.title=cleverapps.UI.generateTTFText("messages:DailyCup.title",cleverapps.styles.FONTS.DAILY_TOURNAMENT_TITLE_TEXT);t.setLocalZOrder(1),this.titleBg?this.titleBg.addChild(t):this.mainContainer.addChild(t),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setPositionRound(e.title),t.fitTo(e.title.width);var s=e.title.width/t.width,i=e.title.height/t.height,n=Math.min(s,i);n<1&&t.setScale(n)},removeTimer:function(){this.timer&&(this.timer.removeFromParent(),delete this.timer)},createTimer:function(){if(this.removeTimer(),cleverapps.dailyCup.timeout){var e=cleverapps.dailyCup.timeout.getTimeLeft(),t=this.getStyles().timer,s={
font:cleverapps.styles.FONTS.DAILY_CUP_TIMER_TEXT,timerPosition:t.timerPosition,regularFontTimerPosition:t.regularFontTimerPosition};if(t.timerBg){var i=cleverapps.UI.createScale9Sprite(t.timerBg.image);i.setContentSize2(t.timerBg),s.background_content=i}this.timer=new cleverapps.CountDownView(new cleverapps.CountDown(e),s),this.mainContainer.addChild(this.timer),this.timer.setPositionRound(t)}},removeText:function(){this.textNode&&(this.textNode.removeFromParent(),delete this.textNode)},createText:function(){if(!this.textNode){var e=this.getStyles(),t=cleverapps.UI.generateOnlyText("messages:DailyCup.finished",cleverapps.styles.FONTS.DAILY_CUP_TIMER_TEXT);if(this.textNode=new cc.Node,this.textNode.setAnchorPoint2(),this.mainContainer.addChild(this.textNode),this.textNode.setContentSize2(t.getContentSize()),this.textNode.setPositionRound(e.timer),this.textNode.addChild(t),t.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),t.setPositionRound(this.textNode.width/2,
this.textNode.height/2),e.timer.timerBg){var s=cleverapps.UI.createScale9Sprite(e.timer.timerBg.image);s.setContentSize2(t.width+e.textBg.offsetWidth,t.height+e.textBg.offsetHeight),this.textNode.addChild(s),s.setLocalZOrder(-1),s.setPositionRound(this.textNode.width/2,this.textNode.height/2)}}},createPlayButton:function(){this.playButton=new DailyCupPlayButton({parent:this.scene,onClicked:this.onPlayClicked.bind(this)}),cleverapps.UI.makeHideable(this.playButton,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("playButton",this.playButton)},onPlayClicked:function(){cleverapps.dailyCup.stillCanPlay()?cleverapps.dailyCup.noConnection?cleverapps.Notification.create("messages:InternetConnectionError"):cleverapps.metha.display({focus:"PlayDailyCup",action:function(e){cleverapps.dailyCup.wantsToPlay(e)}}):cleverapps.dailyCup.isFinished()&&cleverapps.dailyCup.restart()},getStyles:function(){return cleverapps.styles.DailyCupScene},displayIntro:function(e){cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.DAILY_CUP_RULES)?e():(new DailyCupRulesWindow(function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_CUP_RULES,!0)}),cleverapps.metha.onceNoWindowsListener=e)}});DailyCupScene.BUNDLES=function(){return["daily_cup","main","windows"]},cleverapps.styles.DailyCupTable={x:{align:"center",dx:0},y:{align:"center",dy:-40},table:{height:700,width:500,bg:bundles.daily_cup.frames.daily_cup_table_bg,padding:5}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{DAILY_CUP_TIMER_TEXT:{name:"default",size:40,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.DailyCupScene={background:{background:bundles.daily_cup.urls.bg},title:{x:{align:"center",dx:0},y:{align:"center",dy:15},width:520,height:100},titleBg:{x:{align:"center",dx:0},y:{align:"top",dy:-90}},noConnectionInfo:{x:{align:"center",dx:0},y:{align:"center",dy:0},bg:{width:480,height:120,image:bundles.main.frames.timer_bg_png}},timer:{x:{align:"center",dx:0},y:{align:"top",
dy:-275},timerBg:{width:220,height:50,image:bundles.main.frames.timer_bg_png},timerPosition:{x:0,y:0}},textBg:{offsetWidth:40,offsetHeight:20},helpButton:{x:{align:"center",dx:-210},y:{align:"bottom",dy:160}},leadersButton:{x:{align:"center",dx:230},y:{align:"bottom",dy:60},scale:.4}};var DailyCupLeadersWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.DailyCupLeadersWindow;this.content=new cc.Node,this.content.setAnchorPoint(.5,.5),this.content.setContentSize(e.width,e.height),this._super({title:"messages:DailyCupLeadersWindow.Title",name:"dailycupleaderswindow",content:this.content}),cleverapps.dailyCupLeadersWindowTable.getResults("cache")?this.leadersOnLoad(cleverapps.dailyCupLeadersWindowTable.getResults("cache")[0]):(this.loading=new LeadersLoading,this.loading.setPosition(this.content.width/2,this.content.height/2),this.content.addChild(this.loading),cleverapps.RestClient.get("/dailycup/leaders/"+cleverapps.user.id,{},this.createListener(
this.leadersOnLoad.bind(this)),function(){cleverapps.Notification.create("messages:LeadersLoadFailed")})),cleverapps.audio.playSound(bundles.main.urls.window_effect)},leadersOnLoad:function(e){this.loading&&(this.loading.remove(),cleverapps.dailyCupLeadersWindowTable.updateResults("cache",[e]));for(var t=cleverapps.styles.DailyCupLeadersWindow,s=e.leaders,i=!1,n=0;n<s.length;n++)if(s[n].id===cleverapps.user.id){i=!0,s[n].player=!0;break}if(!i){var o={id:cleverapps.user.id,firstPlace:e.playerResult.firstPlace,secondPlace:e.playerResult.secondPlace,thirdPlace:e.playerResult.thirdPlace,player:!0,avatar:cleverapps.friends.getPlayer().avatar,text:cleverapps.friends.getPlayer().name,notInTop:!0};s.push(o)}s.forEach(function(e,t){e.place=t+1});var r=this.table=cleverapps.dailyCupLeadersWindowTable.createTableView({id:"dailyCupLeadersWindow",data:s,rowConstructor:cleverapps.DailyCupLeadersRow});r.setPositionRound(t.tablePosition),this.content.addChild(r)}})
;cleverapps.styles.DailyCupLeadersWindow={width:600,height:770,tablePosition:{x:{align:"center"},y:{align:"center",dy:-50}}};var DailyCupTable=function(e,t,s,i){this.parent=i,this.dailyCup=e,this.id=this.dailyCup.id,this.styles=t,this.rowConstructor=s,this.createTable()};DailyCupTable.prototype.createTable=function(){this.tableView&&this.tableView.removeFromParent(),this.tableView=this.dailyCup.table.createTableView({id:this.dailyCup.type,data:this.dailyCup.players,rowConstructor:this.rowConstructor,options:{styles:{height:this.styles.table.height,bg:this.styles.table.bg}}}),this.adjustSize(),this.parent.addChild(this.tableView),this.tableView.setPositionRound(this.styles),this.tableView.setLocalZOrder(1),this.dailyCup.updateListeners.scoreboard=this.tableView.createListener(function(e,t){t&&this.parent.isRunningSafe()&&(t!==this.id?(this.id=t,this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable()):this.updateResults())}.bind(this)),
this.dailyCup.onPlayerInfoChanged=this.tableView.createListener(function(){this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable()}.bind(this))},DailyCupTable.prototype.adjustSize=function(){var e=this.styles.table.padding||0,t=cleverapps.UI.getSceneSize().width/(this.tableView.getContentSize().width+2*e);t<1&&this.tableView.setScale(t)},DailyCupTable.prototype.updateResults=function(){this.tableView.updateResults(this.dailyCup.players)?this.dailyCup.table.updateResults(this.dailyCup.type,this.dailyCup.players):(this.dailyCup.table.resetResults(this.dailyCup.type),this.createTable())},DailyCupTable.prototype.runFinishAnimation=function(){if(!this.inFinishAnimation){this.inFinishAnimation=!0,this.tableView.stopAllActions();var e=this.tableView.getScale();this.tableView.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.1*e).easing(cc.easeIn(2)),new cc.ScaleTo(.3,0),new cc.RemoveSelf))}},DailyCupTable.prototype.runStartAnimation=function(e){this.tableView.stopAllActions()
;var t=this.tableView.getScale();this.tableView.setScale(0),this.tableView.runAction(new cc.Sequence(new cc.DelayTime(e||0),new cc.ScaleTo(.3,1.1*t).easing(cc.easeOut(2)),new cc.ScaleTo(.2,t)))};var DailyCup=function(e){(this.type=e,this.data=DailyCupsConfig[e],this.debugInfo={},cleverapps.config.debugMode&&(DailyCup.RELOAD_INTERVAL="5 seconds"),this.updateListeners={},this.onNoConnectionListener=function(){},this.onActivationListener=function(){},this.onPlayerInfoChanged=function(){},this.reset(),this.load(),this.reload(),setInterval(this.reload.bind(this),cleverapps.parseInterval(DailyCup.RELOAD_INTERVAL)),this.runLocalTimeout(),this.table=new cleverapps.Table,cleverapps.friends.playerInfoChangedListeners["dailyCup_"+e]=this.playerInfoChanged.bind(this),this.finished)&&(void 0===this.calcRewardPlace()&&this.data.autoRestart&&this.restart())};DailyCup.prototype.reset=function(){this.deactivate(),this.setNoConnection(!1),this.stars=0,this.level=0,this.timeFinish=void 0,this.finished=!1
},DailyCup.prototype.setNoConnection=function(e){this.noConnection!==e&&(this.noConnection=e,this.onNoConnectionListener())},DailyCup.prototype.getTimeLeft=function(){if(this.timeFinish){var e=this.timeFinish-Date.now();return e<0?0:e}},DailyCup.prototype.runLocalTimeout=function(){clearTimeout(this.timeout),void 0!==this.getTimeLeft()&&(this.timeout=new cleverapps.LongTimeout(function(){this.runUpdateListeners()}.bind(this),this.getTimeLeft()))},DailyCup.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes[this.data.storageKey]);e&&(this.activate(e.id),this.stars=e.stars,this.level=e.level,this.finished=e.finished,this.timeFinish=e.timeFinish,this.players=e.players,e.timeLeft&&(this.timeFinish=Date.now()+e.timeLeft)),this.players=this.players||[],this.finished&&0===this.players.length&&(this.finished=!1),this.debugInfo.loadTime=Date.now(),this.preparePlayersData()},DailyCup.prototype.getInfo=function(){return{id:this.id,stars:this.stars,
level:this.level,finished:this.finished,timeFinish:this.timeFinish}},DailyCup.prototype.updateInfo=function(e,t){this.activate(e.id),this.stars=e.stars,this.level=e.level,this.timeFinish=void 0,this.finished=!1,this.debugInfo.updateInfoTime=Date.now(),this.save(t)},DailyCup.prototype.save=function(e){var t=this.getInfo();t.players=this.players,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes[this.data.storageKey],t),!e&&this.data.serverTaskName&&cleverapps.synchronizer.addUpdateTask(this.data.serverTaskName)},DailyCup.prototype.createEpisode=function(){var e=Episode.LevelChooseAlgorithm({start:5,seed:1e3*(this.id||0)+(this.level||0)});return new Episode(e.episodeNo,e.levelNo,{type:Episode.Types.DAILYCUP})},DailyCup.prototype.getPlayerInfo=function(){return{id:cleverapps.user.id,amount:this.stars,player:!0,avatar:this.getPlayerAvatar(),text:cleverapps.friends.getPlayer().name}},DailyCup.prototype.getPlayerAvatar=function(){return{avatar:cleverapps.friends.getPlayer().avatar,
id:cleverapps.user.id}},DailyCup.prototype.playerInfoChanged=function(e){for(var t=0;t<this.players.length;t++)if(this.players[t].id===e){var s=this.getPlayerInfo();return this.players[t].id=s.id,this.players[t].avatar=s.avatar,this.players[t].text=s.text,this.save(),void this.onPlayerInfoChanged()}},DailyCup.prototype.addDebugPlayers=function(){if(cleverapps.config.debugMode&&DailyCup.DEBUG_PLAYERS_AMOUNT){for(var e=0;this.players.length<DailyCup.DEBUG_PLAYERS_AMOUNT;)this.players.push({id:"10000"+e,amount:cleverapps.Random.random(10,30)*e,avatar:this.getPlayerAvatar(),text:"Player_"+e}),e++;this.players.sort(function(e,t){return t.amount-e.amount})}},DailyCup.prototype.preparePlayersData=function(){for(var e=void 0,t=0;t<this.players.length;t++)this.players[t].id===cleverapps.user.id&&(this.players[t].amount=this.stars,this.players[t].player=!0,this.players[t].avatar=this.getPlayerAvatar(),e=t);if(void 0===e){var s=this.getPlayerInfo();e=this.players.length,this.players.push(s)}for(
this.addDebugPlayers();0<e&&this.players[e-1].amount<this.players[e].amount;){var i=this.players[e-1];this.players[e-1]=this.players[e],this.players[e]=i,e--}this.players[e].notInTop=e>=DailyCup.TOP_LIMIT,this.players.forEach(function(e,t){e.place=t+1})},DailyCup.prototype.stillCanPlay=function(){return this.isActive()&&0<this.getTimeLeft()},DailyCup.prototype.isFinished=function(){return this.finished},DailyCup.prototype.isActive=function(){return 0!==this.id},DailyCup.prototype.activate=function(e){this.id!==e&&(this.id=e,this.onActivationListener())},DailyCup.prototype.deactivate=function(){0!==this.id&&(this.id=0,this.onActivationListener())},DailyCup.prototype.calcRewardPlace=function(){if(this.isFinished())for(var e=0;e<this.players.length&&e<this.data.rewards.length;e++)if(this.players[e].player){if(0===this.players[e].amount)return;return e}},DailyCup.prototype.giveReward=function(){var s=this.calcRewardPlace(),i=this.id;0===s&&cleverapps.missionManager.dispatchEvent(
Mission.EVENT_WIN_DAILYCUP),cleverapps.metha.display({focus:"DailyCupRewards",actions:[function(e){this.data.victoryWindow?(new this.data.victoryWindow(s),cleverapps.metha.onceNoWindowsListener=e):e()}.bind(this),function(e){this.restart();var t=this.data.rewards[s];this.type!==DailyCup.TYPE_WEEKLY&&RewardsConfig.DailyCup.prepareByRich&&(t=cleverapps.user.prepareRewardByRich(t)),new DailyCupRewardWindow({reward:t,place:s+1,id:i,type:this.type}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},DailyCup.prototype.restart=function(){this.reset(),this.save(),this.runUpdateListeners(),this.reload()},DailyCup.prototype.markFinished=function(){if(!this.finished){this.finished=!0,this.debugInfo.markFinishedTime=Date.now(),cleverapps.dailyCupLeadersWindowTable.resetResults("cache"),this.save(),this.runUpdateListeners();var e=this.calcRewardPlace();void 0===e||cleverapps.metha.isFocused()||this.giveReward(),void 0===e&&this.data.autoRestart&&this.restart()}},
DailyCup.prototype.onRespond=function(){this.reloading=!1},DailyCup.prototype.onSuccess=function(e){if(!e)return console.log("Empty result"),void this.onFailure();var t=this.id;if(this.setNoConnection(!1),this.onRespond(),this.timeFinish=Date.now()+e.time,this.players=e.players,this.id!==e.id&&(this.stars=0,this.level=0),this.preparePlayersData(),this.id!==e.id&&(this.table.resetResults(this.type),cleverapps.dailyCupLeadersWindowTable.resetResults("cache"),this.activate(e.id)),this.save(!0),this.debugInfo.onSuccessTime=Date.now(),this.debugInfo.onSuccessPlayersLenght=this.players.length,this.debugInfo.onSuccessData=JSON.stringify(e),this.debugInfo.onSuccessThisId=t,e.time<=0){this.calcRewardPlace();this.markFinished()}else this.runLocalTimeout();this.runUpdateListeners()},DailyCup.prototype.onFailure=function(){this.setNoConnection(!0),this.onRespond(),console.error("can't update DailyCup of type "+this.type)},DailyCup.prototype.reload=function(){DailyCup.IsAvailable(this.type)&&(
this.reloading||this.isFinished()||(this.type!==DailyCup.TYPE_WEEKLY||cleverapps.scenes.isLoaderScene()||cleverapps.environment.isMainScene())&&(this.type!==DailyCup.TYPE_DAILY||cleverapps.environment.isDailyCupScene()||cleverapps.environment.isMainScene())&&(this.reloading=!0,cleverapps.RestClient.get("/dailycup/get/"+this.id+"/"+this.type,{},this.onSuccess.bind(this),this.onFailure.bind(this))))},DailyCup.prototype.runUpdateListeners=function(){cleverapps.sideBar.resetByClassName(DailyCupIcon),cleverapps.values(this.updateListeners).forEach(function(e){e(this.players,this.id)}.bind(this))},DailyCup.prototype.addAmount=function(e){if(this.stillCanPlay()){e=void 0===e?0:e,this.level++,this.stars+=e,this.save();var t=this.id?this.id:-1;cleverapps.RestClient.post("/dailycup/update/"+cleverapps.user.id+"/"+this.type,{id:t,stars:this.stars},function(){},function(){console.log("couldn't update progress")}),this.preparePlayersData()}},DailyCup.prototype.cupWithLives=function(){
return cleverapps.lives&&"board"!==cleverapps.config.type},DailyCup.prototype.wantsToPlay=function(e){if(this.cupWithLives()&&cleverapps.lives.isEmpty())return new LivesShopWindow,void(cleverapps.metha.onceNoWindowsListener=e);var t=this.createEpisode().getLevel();BoostersBefore.isAvailable()&&LevelStartWindow.isAvailable(t.episode.episodeNo,t.levelNo)?(cleverapps.metha.showControlsWhileFocused("MenuBarGoldItem"),new LevelStartWindow({level:t}),cleverapps.metha.onceNoWindowsListener=e):t.play(e)},DailyCup.IsAvailable=function(e,t){return(e!==DailyCup.TYPE_WEEKLY||cleverapps.metha.getType()===Metha.KNOCKOUT)&&levels.user.checkAvailable(DailyCupsConfig[e].available,t)},DailyCup.TOP_LIMIT=25,DailyCup.RELOAD_INTERVAL="1 minute",DailyCup.TYPE_DAILY=0,DailyCup.TYPE_WEEKLY=1;var DailyCupsConfig={};DailyCupsConfig[DailyCup.TYPE_DAILY]={available:{episode:5,level:0,registered:"7 days",differences:{disabled:!0}},serverTaskName:"userdailycup",rewards:RewardsConfig.DailyCup.places,
leadersWindow:DailyCupLeadersWindow,storageKey:"DAILY_CUP"},RewardsConfig.WeeklyCup&&(DailyCupsConfig[DailyCup.TYPE_WEEKLY]={available:{episode:0,level:0,projectName:["olympics","differences"]},serverTaskName:"userweeklycup",rewards:RewardsConfig.WeeklyCup.places,storageKey:"WEEKLY_CUP",victoryWindow:"undefined"!=typeof WeeklyCupVictoryWindow&&WeeklyCupVictoryWindow,autoRestart:!0});var DailyCupRewardWindow=RewardWindow.extend({onWindowLoaded:function(e){this.place=e.place,this.id=e.id,this._super({title:e.type===DailyCup.TYPE_WEEKLY?"messages:WeeklyCupTable.title":"messages:DailyCup.title",name:"dailycuprewardwindow",text:"messages:DailyCup.reward",reward:e.reward,rewardName:"dailyCup"})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_CUP_REWARD+"_"+this.place+"_"+this.id)}}),DailyCupRulesWindow=RulesWindow.extend({onWindowLoaded:function(e){this.callback=e,this._super({name:"dailycupruleswindow",styles:cleverapps.styles.DailyCupRulesWindow})},
onClose:function(){this.callback&&this.callback()}});cleverapps.styles.DailyCupRulesWindow={prefix:"messages:DailyCupRulesWindow.",animation:{json:bundles.daily_cup.jsons.daily_cup_json,name:"animation"},subText:{width:200,left:{x:{align:"left",dx:40},y:{align:"top",dy:-250}},right:{x:{align:"right",dx:45},y:{align:"top",dy:-215}},bottom:{x:{align:"center",dx:5},y:{align:"center",dy:-320}}}};var Subscription=function(){this.load(),this.onChangeStateListeners={icon:Subscription.updateIcon},"ios"===cleverapps.User.calcSource()&&("merge"===cleverapps.config.type?Subscription.AVAILABLE={level:2}:Subscription.AVAILABLE={episode:0,level:1}),this.reload(),this.haveTmpId()&&this.runOnBuyReloads()};Subscription.updateIcon=function(){cleverapps.sideBar.resetByClassName(SubscriptionIcon)},Subscription.calcSource=function(){var e=cleverapps.User.calcSource();return"mobile_ok"===e&&(e="web_ok"),e},Subscription.prototype.load=function(){var e=cleverapps.DataLoader.load(
cleverapps.DataLoaderTypes.SUBSCRIPTION),t=Subscription.calcSource();e&&e[t]?(this.id=e[t].id,this.lastRewardTime=e[t].lastRewardTime||0,this.lastReloadTime=e[t].lastReloadTime||0,this.trialBoughtTime=e[t].trialBoughtTime||0,this.tokens=e[t].tokens||{}):(this.id=0,this.lastRewardTime=0,this.lastReloadTime=0,this.trialBoughtTime=0,this.tokens={})},Subscription.prototype.getInfo=function(){var e={},t=Subscription.calcSource();return e[t]={id:this.id,lastRewardTime:this.lastRewardTime,lastReloadTime:this.lastReloadTime,trialBoughtTime:this.trialBoughtTime},0<Object.keys(this.tokens).length&&(e[t].tokens=this.tokens),e},Subscription.prototype.updateInfo=function(e,t){var s=Subscription.calcSource();e[s]&&(this.id=e[s].id,this.lastRewardTime=e[s].lastRewardTime||0,this.lastReloadTime=e[s].lastReloadTime||0,this.trialBoughtTime=e[s].trialBoughtTime||0,this.tokens=cleverapps.override({},e[s].tokens||{},this.tokens),this.save(t))},Subscription.prototype.save=function(e){
cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SUBSCRIPTION,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("subscription")},Subscription.prototype.getLeftTime=function(){if(this.isActive()){if(!this.lastRewardTime)return 0;var e=Date.now();return"daily"===Subscription.REWARD_INTERVAL?Math.max(cleverapps.extractDateFromDateTime(this.lastRewardTime)+cleverapps.parseInterval("1 day")-e,0):Math.max(this.lastRewardTime+cleverapps.parseInterval(Subscription.REWARD_INTERVAL)-e,0)}},Subscription.prototype.reload=function(){var e=Subscription.calcSource();cleverapps.isLocalhost()||this.isDebugNoPayments()||-1===["facebook","web_ok","mobile_ok","android","ios"].indexOf(e)||-1!==["android","ios"].indexOf(e)&&0===Object.keys(this.tokens).length||!this.haveTmpId()&&this.lastReloadTime+cleverapps.parseInterval(Subscription.RELOAD_INTERVAL)>Date.now()||this.getAsync(function(e,t){if(!e){t=t||{};var s=this.isActive();this.id=t.id,this.lastReloadTime=Date.now(),this.save(),
cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc),s&&!this.isActive()&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_CANCELLED)}}.bind(this))},Subscription.prototype.getAsync=function(t){var e=Subscription.calcSource();if(-1!==["facebook","web_ok","mobile_ok","android","ios"].indexOf(e))if(levels.user.haveTmpId()&&-1!==["facebook","web_ok","mobile_ok"].indexOf(e))t(cleverapps.Social.CODE_FAILED);else{var s={source:e,tokens:this.tokens,id:this.id};cleverapps.RestClient.post("/subscriptions/get/"+levels.user.id,s,function(e){e&&!e.id&&(e={}),t(cleverapps.Social.CODE_SUCCEED,e)},function(){t(cleverapps.Social.CODE_FAILED)})}},Subscription.prototype.haveTmpId=function(){return this.id&&2<=this.id.length&&"__"===this.id.substr(0,2)},Subscription.prototype.onBuySubscription=function(e){cleverapps.history.add("sbcrb",1),this.id=cleverapps.user.generateTmpId();var t=Subscription.calcSource();(-1!==["facebook","android","ios"].indexOf(t
)||this.isDebugNoPayments())&&(this.lastRewardTime=0),this.lastReloadTime=0,e.trial&&(this.trialBoughtTime=Date.now()),this.save(),Game.currentGame&&Game.currentGame.workers&&(Game.currentGame.workers.addSubscriptionWorker(),Game.currentGame.workers.removeRegularIfNeeded()),this.runOnBuyReloads()},Subscription.prototype.runOnBuyReloads=function(){["5 seconds","15 seconds","30 seconds","1 minute","3 minutes","5 minutes","10 minutes"].forEach(function(e){setTimeout(function(){cleverapps.subscription.reload()},cleverapps.parseInterval(e))})},Subscription.prototype.addPurchaseTokens=function(e,t){Array.isArray(e)||(e=[e]);var r=!1;e.forEach(function(e){var t=e.name,s=e.purchaseToken,i=e.productId,n=e.packageName,o=this.tokens[t]||{};t&&s&&i&&n&&(o.purchaseToken!==s||o.productId!==i||o.packageName!==n)&&(this.tokens[t]={productId:i,packageName:n,purchaseToken:s},r=!0)}.bind(this)),r&&(t&&!this.isActive()&&(this.lastReloadTime=0,this.reload()),this.save())},
Subscription.prototype.isRewardReady=function(){return!!this.isActive()&&0===this.getLeftTime()},Subscription.prototype.getReward=function(){if(!this.isRewardReady())return!1;var e=this.calcReward(),t=e.unit&&e.unit.amount-Game.currentGame.map.countEmptySlots();return 0<t?(Game.currentGame.onHintMessage("messages:Spawn.nospace",!1,{left:t}),!1):(this.lastRewardTime=Date.now(),this.save(),cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_REWARD),!0)},Subscription.prototype.isActive=function(){return this.id},Subscription.prototype.calcReward=function(){var e=cleverapps.clone(RewardsConfig.Subscription,!0);return cleverapps.user.setRandomBoostersReward(e)},Subscription.prototype.reactivate=function(e){!this.isActive()||cleverapps.isLocalhost()||this.isDebugNoPayments()||0===this.id.indexOf("__")||cleverapps.payments.reactivateSubscription&&cleverapps.payments.reactivateSubscription(this.id,e)},
Subscription.prototype.canBuyTrial=function(){return!(!cleverapps.isLocalhost()&&-1===["580731438762","577203420866","585959187481","576593702177","8593874"].indexOf(cleverapps.user.id))||this.trialBoughtTime+cleverapps.parseInterval(Subscription.BUY_TRIAL_INTERVAL)<Date.now()},Subscription.prototype.isDebugNoPayments=function(){return cleverapps.isStaging()&&-1!==Subscription.SOCIAL_PAYMENT_NOT_FREE_ON_STAGING.indexOf(cleverapps.User.calcSource())&&this.toolDebugWithoutPayment},Subscription.prototype.cancel=function(e){if(this.isActive())return cleverapps.isLocalhost()||this.isDebugNoPayments()?(delete this.id,this.save(),void cleverapps.values(this.onChangeStateListeners).forEach(cleverapps.callFunc)):void(0!==this.id.indexOf("__")&&cleverapps.payments.cancelSubscription&&cleverapps.payments.cancelSubscription(this.id,e))},Subscription.IsAvailable=function(){return!!cleverapps.subscription&&(!!cleverapps.subscription.isActive()||!("ios"===cleverapps.User.calcSource(
)&&!cleverapps.payments.isProductsExists(["subsWeek","subsMonth"]))&&cleverapps.user.checkAvailable(Subscription.AVAILABLE))},Subscription.IsModelAvailable=function(){var e=[];switch(cleverapps.User.calcSource()){case"web_ok":case"mobile_ok":e=Subscription.MODEL_AVAILABLE_OK;break;case"facebook":e=Subscription.MODEL_AVAILABLE_FACEBOOK;break;case"android":e=Subscription.MODEL_AVAILABLE_ANDROID;break;case"ios":e=Subscription.MODEL_AVAILABLE_IOS}return cleverapps.config.debugMode&&(cleverapps.OK.isAppropriate()||cleverapps.MobileOK.isAppropriate()||cleverapps.FakeFacebook.isAppropriate())&&(e=Subscription.MODEL_AVAILABLE_OK.concat(Subscription.MODEL_AVAILABLE_FACEBOOK)),cleverapps.config.debugMode&&e.push("mergecraft"),-1!==e.indexOf(cleverapps.config.name)},Subscription.MODEL_AVAILABLE_OK=["heroes","riddles","wordsoup","crocword","tripeaks","runes","olympics","scramble","differences","magicwords"],Subscription.MODEL_AVAILABLE_FACEBOOK=["heroes","riddles","wordsoup","crocword","tripeaks",
"scramble","magicwords"],Subscription.MODEL_AVAILABLE_ANDROID=["heroes","riddles","wordsoup","crocword","tripeaks","olympics","scramble"],Subscription.MODEL_AVAILABLE_IOS=["crocword","wordsoup","tripeaks"],Subscription.AVAILABLE={episode:3,level:0},"merge"===cleverapps.config.type&&(Subscription.AVAILABLE={level:5}),Subscription.REWARD_INTERVAL="daily",Subscription.RELOAD_INTERVAL="1 hour",Subscription.BUY_TRIAL_INTERVAL="3 day",Subscription.SOCIAL_PAYMENT_NOT_FREE_ON_STAGING=["mobile_ok","web_ok"],cleverapps.config.debugMode&&(Subscription.REWARD_INTERVAL="20 minutes",Subscription.RELOAD_INTERVAL="1 minute",Subscription.BUY_TRIAL_INTERVAL="10 seconds");var SubscriptionWindow=Window.extend({onWindowLoaded:function(){this.weekProduct=Product.Create("subsWeek"),this.monthProduct=Product.Create("subsMonth");var e={name:"SubscriptionWindow",content:this.createContent(),styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.SubscriptionWindow.window,!0)}
;"olympics"===cleverapps.config.name&&(e.windowBg=bundles.windows.frames.window_gold_bg_png),cleverapps.styles.SubscriptionWindow.window.Title&&(e.title={text:"messages:SubscriptionWindow.Title",font:cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_TITLE_TEXT||cleverapps.styles.FONTS.WINDOW_TITLE_TEXT}),this._super(e),cleverapps.audio.playSound(bundles.main.urls.window_effect),cleverapps.subscription.isActive()||cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SUBSCRIPTION_WINDOW_OPEN),Lottery.addText(this)},buySubscription:function(e){if(cleverapps.subscription.isActive())return cleverapps.Notification.create("messages:Product.PurchaseCancelled"),void this.close();var t=function(){cleverapps.subscription.onBuySubscription(e),this.close()}.bind(this);cleverapps.subscription.isDebugNoPayments()?t():e.buy(t)},onClose:function(){cleverapps.subscription.isRewardReady()&&new SubscriptionRewardWindow},onShow:function(){if(this.personAnimation){
var e=cleverapps.styles.SubscriptionWindow.animation.person;e.open?this.personAnimation.setAnimationAndIdleAfter(e.open,e.idle):this.personAnimation.setAnimation(0,e.idle,!0)}this.prizesView.onShow&&this.prizesView.onShow()},createContent:function(){var e=cleverapps.styles.SubscriptionWindow;e.animation.person&&(this.personAnimation=new cleverapps.Spine(bundles.subscription_window.jsons.subscription_json||e.animation.person.json,e.animation.person.scale),this.personAnimationNode=new cc.Node,this.personAnimationNode.setLocalZOrder(e.animation.person.zOrder),this.personAnimationNode.addChild(this.personAnimation)),"merge"===cleverapps.config.type?this.prizesView=new MergeSubscriptionPrize:"match3"===cleverapps.config.type?this.prizesView=new SubscriptionPrize:this.prizesView=new GoldBasedPrize;var t=cleverapps.subscription.isActive(),s=t&&cleverapps.subscription.isRewardReady(),i=t&&!s,n=[];n.push(this.createFooter()),n.push(new SubscriptionButtons({isActive:t,
prizesLayoutWidth:this.prizesView.width,monthProduct:this.monthProduct,weekProduct:this.weekProduct,buySubscription:this.buySubscription.bind(this),onClaimClicked:this.close.bind(this)})),n.push(new SubscriptionInfo({isRewardReady:s,isTimerActive:i,availableTextWidth:this.prizesView.width,close:this.close.bind(this)})),n.push(this.prizesView),e.animation.person&&((e.window.noBackground||"scramble"===cleverapps.config.name)&&(this.personAnimationNode.setAnchorPoint2(),this.personAnimationNode.setContentSize(e.animation.person.size),this.personAnimation.setPositionRound(e.animation.person.position),n.push(this.personAnimationNode)),e.animation.person.offset&&this.personAnimation.setPositionRound(e.animation.person.offset[cleverapps.wideMode.mode]),e.animation.person.scales&&this.personAnimation.setScale(e.animation.person.scales[cleverapps.wideMode.mode]));var o=new cleverapps.Layout(n,{direction:cleverapps.UI.VERTICAL,padding:e.contentPadding,margin:e.contentItemsMargin})
;return o.setLocalZOrder(5),e.animation.person&&!e.window.noBackground&&"scramble"!==cleverapps.config.name&&("tripeaks"===cleverapps.config.name?(this.addChild(this.personAnimationNode),this.personAnimationNode.setPositionRound(e.animation.person.position[cleverapps.wideMode.mode])):(o.addChild(this.personAnimationNode),this.personAnimationNode.setPositionRound(e.animation.person.position))),o},createFooter:function(){if("merge"===cleverapps.config.type)var e=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.note",cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TITLE);if("ios"===cleverapps.User.calcSource()){var t=new Terms;if(t.width>.9*this.prizesView.width&&t.setScale(.9*this.prizesView.width/t.width),!cleverapps.subscription.isActive()){var s=new Restore;s.setScale(t.getScale())}}return new cleverapps.Layout([s,t,e],{direction:cleverapps.UI.VERTICAL})}});SubscriptionWindow.prototype.listBundles=function(){return["reward_icons","subscription_window"]},
cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{SUBSCRIPTION_WINDOW_GOLD_OFFER_STROKE:{color:new cc.Color(46,83,26,255),size:2}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT:{size:100,color:cleverapps.styles.COLORS.WHITE},SUBSCRIPTION_WINDOW_GOLD_OFFER_TEXT:{size:24,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.SUBSCRIPTION_WINDOW_GOLD_OFFER_STROKE}}),cleverapps.styles.SubscriptionWindow={contentItemsMargin:15,contentPadding:{x:64,y:140,isTop:!0},animation:{person:{position:{x:{align:"left",dx:344},y:{align:"top",dy:-142}},json:bundles.subscription_window.jsons.subscription_window_star_json,open:"open",idle:"idle",scale:1,zOrder:0}},window:{Border:{x:0,y:30},Title:{}}};var SubscriptionRewardWindow=RewardWindow.extend({ctor:function(){this._super({reward:cleverapps.subscription.calcReward()})},onWindowLoaded:function(e){this._super({title:"messages:SubscriptionRewardWindow.title",name:"subscriptionrewardwindow",
text:"messages:MiniGameRewardWindow.text",reward:e.reward,rewardName:"subscription"})},beforeCloseAnimation:function(e){cleverapps.subscription.getReward()||(this.reward=void 0),this._super(e)}}),SubscriptionBonus=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint2();var e=cleverapps.styles.SubscriptionBonus,t=new cc.Sprite(bundles.subscription_window.frames.subscription_badge_png);if(this.addChild(t),this.setContentSize2(t.getContentSize()),this.setScale(e.scale),t.setPositionRound(this.width/2,this.height/2),e.backgroundAnimation){var s=new cleverapps.Spine(e.backgroundAnimation.json,e.backgroundAnimation.scale);s.setPositionRound(t.width/2,t.height/2),t.addChild(s,-1),s.setAnimation(0,e.backgroundAnimation.name,!0)}var i=new cc.Sprite(bundles.subscription_window.frames.subscription_plus_png);if(this.addChild(i),i.setPositionRound(e.plus),!e.description){var n=cleverapps.UI.generateTTFText("messages:UnlimitedLives.ThreeHours",cleverapps.styles.FONTS.WHITE_TEXT)
;this.addChild(n),n.setPositionRound(e.text),n.fitTo(e.text.width),n.setRotation(e.text.rotation)}this.setPositionRound(e)},getDescription:function(){var e=cleverapps.styles.SubscriptionBonus;if(e.description){var t=cleverapps.UI.generateTTFText("messages:UnlimitedLives.ThreeHoursShort",cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT),s=new cc.Sprite(e.description.icon);return s.setScale(e.description.scale),s.setPositionRound(e.description),[s,t]}return[]}});cleverapps.styles.SubscriptionBonus={x:{align:"center",dx:260},y:{align:"center",dy:-135},scale:1,plus:{x:{align:"center",dx:-74},y:{align:"center",dy:18}},text:{x:{align:"center",dx:-10},y:{align:"center",dy:-30},rotation:20,width:100}};var SubscriptionButtons=cleverapps.Layout.extend({ctor:function(e){var t=cleverapps.styles.SubscriptionButtons,s=cleverapps.User.calcSource();if(e.isActive)var i=new cleverapps.UI.Button({content:cleverapps.UI.generateOnlyText("messages:OK",
cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT),button_png:t.buttonClaim.button_png,button_on_png:t.buttonClaim.button_on_png,width:t.buttonWidth,maxWidth:t.buttonWidth,height:t.buttonHeight,onClicked:e.onClaimClicked});else{var n="ios"===s?Messages.get("SubscriptionWindow.iosMonthButton",{price:e.monthProduct.getCurrentPrice()}):e.monthProduct.getCurrentPrice(),o=this.createBuyButton(e.monthProduct,e.buySubscription,t.buttonPay,n,cleverapps.styles.FONTS.SUBSCRIPTION_BUY_BUTTON_TEXT||cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT);if(Lottery.addIcon(o,"subscription"),o.lotteryIcon&&o.lotteryIcon.setScale(.7),cleverapps.subscription.canBuyTrial()){var r=Messages.get("ios"===s?"SubscriptionWindow.iosWeekButton":"SubscriptionWindow.Free",{price:e.weekProduct.getCurrentPrice()}),a=this.createBuyButton(e.weekProduct,e.buySubscription,t.buttonTryFree,r,cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TEXT);if("ios"===s)var c="messages:SubscriptionWindow.monthButtonTitle",l=void 0,
p="messages:SubscriptionWindow.weekButtonTitle",d=Messages.get("SubscriptionWindow.iOSThreeDaysAdditional",{price:e.weekProduct.getCurrentPrice()});else l="messages:SubscriptionWindow.MonthlyAdditional",d=0===e.weekProduct.trial.indexOf("3 day")?"messages:SubscriptionWindow.ThreeDaysAdditional":"messages:SubscriptionWindow.OneDayAdditional";"merge"===cleverapps.config.type&&(c="messages:SubscriptionWindow.MonthlyAdditional",p=d,d=l=void 0),a=this.createLayout(a,d,p),o=this.createLayout(o,l,c);var h=t.buttonsMargin||Math.max(4*t.contentObjectsMargin,e.prizesLayoutWidth-2*t.buttonWidth)}}this._super([i,a,o],{direction:cleverapps.UI.HORIZONTAL,align:t.align,margin:h})},createBuyButton:function(e,t,s,i,n){var o=cleverapps.styles.SubscriptionButtons;return new cleverapps.UI.Button({content:new ProductPriceView(e,{text:i,font:n}),button_png:s.button_png,button_on_png:s.button_on_png,width:o.buttonWidth,maxWidth:o.buttonWidth,height:o.buttonHeight,contentPadding:1,
contentOffset:o.contentOffset,onClicked:function(){t(e)}})},createLayout:function(e,t,s){var i=cleverapps.styles.SubscriptionButtons;if(t){var n=cleverapps.UI.generateOnlyText(t,cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT);n.setDimensions(i.buttonWidth,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)}if(s){var o=cleverapps.UI.generateOnlyText(s,cleverapps.styles.FONTS.SUBSCRIPTION_BUTTON_TITLE||cleverapps.styles.FONTS.SUBSCRIPTION_MAIN_TEXT);o.setDimensions(i.buttonWidth,0),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)}return new cleverapps.Layout([n,e,o],{direction:cleverapps.UI.VERTICAL,margin:i.contentObjectsMargin})}});cleverapps.styles.SubscriptionButtons={height:100,align:cleverapps.UI.ALIGN_END,contentObjectsMargin:7,buttonWidth:270,buttonHeight:100,buttonTryFree:{button_png:bundles.buttons.frames.green_button_png,button_on_png:bundles.buttons.frames.green_button_on_png},buttonPay:{button_png:bundles.buttons_main.frames.blue_button_png,
button_on_png:bundles.buttons_main.frames.blue_button_on_png},buttonClaim:{button_png:bundles.buttons.frames.window_button_png,button_on_png:bundles.buttons.frames.window_button_on_png}};var SubscriptionPrize=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.SubscriptionPrize,t=new cc.Node;t.setContentSize2(e.prizesLayout.size.width,e.prizesLayout.size.height),t.setAnchorPoint(0,0);var s=cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationMainText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_MAIN_TEXT);s.setDimensions(e.animation.everyDayTextWidth,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(s),s.setAnchorPoint2(),s.setPositionRound(e.prizesLayout.everyDayTextPosition);var i=[cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationLeftText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT)];i.push(cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationLeftMiddleText",
cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT));var n=[cleverapps.UI.generateTTFText("messages:SubscriptionWindow.AnimationRightText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT)];n.push(cleverapps.UI.generateTTFText("messages:SubscriptionWindow.UnlimitedLivesTwoHourText",cleverapps.styles.FONTS.SUBSCRIPTION_OFFERS_TEXT));for(var o=[i,n],r=[],a=0;a<o.length;a++){for(var c=[],l=0;l<o[a].length;l++){var p=o[a][l];e.prizesLayout.fitTo&&p.fitTo(e.prizesLayout.fitTo),p.setDimensions(e.animation.oneBoosterTextWidth,0),p.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),c.push(new cleverapps.Layout([p],{direction:cleverapps.UI.VERTICAL,margin:e.contentObjectsMargin}))}r.push(new cleverapps.Layout(c,{direction:cleverapps.UI.HORIZONTAL,margin:3*e.contentObjectsMargin})),t.addChild(r[a]),r[a].setAnchorPoint2()}r[0].setPositionRound(e.prizesLayout.topBoostersPrizeTextPosition),r[1].setPositionRound(e.prizesLayout.bottomBoostersPrizeTextPosition),this.boostersAnimation=new cleverapps.Spine(
e.animation.boosters.json,e.animation.boosters.scale),this.boostersAnimationNode=new cc.Node,this.boostersAnimationNode.addChild(this.boostersAnimation),this.boostersAnimationNode.setContentSize2(e.animation.boosters.width,e.animation.boosters.height),this.boostersAnimationNode.setAnchorPoint2(),t.addChild(this.boostersAnimationNode),this.boostersAnimationNode.setPositionRound(e.prizesLayout.boostersPrizeAnimationPosition),this.boostersAnimationNode.setLocalZOrder(-1);var d=cleverapps.UI.createScale9Sprite(e.animation.background.image,cleverapps.UI.Scale9Rect.TwoPixelXY);d.setContentSize(t.width,t.height),d.setAnchorPoint(0,0),d.addChild(t),this.setAnchorPoint(.5,.5),this.addChild(d),this.setContentSize(d.getContentSize())},onShow:function(){var e=cleverapps.styles.SubscriptionPrize;this.boostersAnimation.setAnimation(0,e.animation.boosters.open,!1),this.boostersAnimation.setCompleteListener(function(){this.boostersAnimation.setAnimation(0,e.animation.boosters.idle,!0)}.bind(this))}})
;cleverapps.styles.SubscriptionPrize={contentObjectsMargin:7,animation:{background:{image:bundles.subscription_window.frames.premium_bg},oneBoosterTextWidth:154,everyDayTextWidth:350,boosters:{json:bundles.subscription_window.jsons.subscription_window_boosters_json,open:"open",idle:"idle",scale:1,width:529,height:148}},prizesLayout:{size:{width:550,height:520},boostersPrizeAnimationPosition:{x:{align:"center",dx:90},y:{align:"center",dy:30}},everyDayTextPosition:{x:{align:"center"},y:{align:"top",dy:-20}},topBoostersPrizeTextPosition:{x:{align:"center"},y:{align:"top",dy:-110}},bottomBoostersPrizeTextPosition:{x:{align:"center"},y:{align:"bottom",dy:155}},fitTo:273}};var SubscriptionInfo=cleverapps.Layout.extend({ctor:function(e){var t,s,i=cleverapps.styles.SubscriptionInfo;e.isRewardReady?((t=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.RewardIsReadyText",cleverapps.styles.FONTS.SUBSCRIPTION_REWARD_READY_TEXT)).setDimensions(e.availableTextWidth,0),
t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)):e.isTimerActive?(s=this.createTimer(e.close),"merge"===cleverapps.config.type&&((t=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.RewardTimerDescription",cleverapps.styles.FONTS.SUBSCRIPTION_REWARD_READY_TEXT)).setDimensions(e.availableTextWidth,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER))):((t=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.MainText",cleverapps.styles.FONTS.SUBSCRIPTION_MAIN_TEXT)).setDimensions(e.availableTextWidth,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)),this._super([t,s],{direction:cleverapps.UI.VERTICAL,margin:i.contentObjectsMargin,padding:i.padding})},createTimer:function(e){var t=cleverapps.styles.SubscriptionInfo,s=cleverapps.UI.createScale9Sprite(bundles.subscription_window.frames.subscription_timer_substrate||bundles.main.frames.timer_bg_png);s.setContentSize2(t.timer);var i=new cleverapps.CountDownView(new cleverapps.CountDown(
cleverapps.subscription.getLeftTime(),{onFinish:e}),{background_content:s,font:cleverapps.styles.FONTS.SUBSCRIPTION_TIMER_TEXT,timerPosition:{x:t.timer.textXShift,y:t.timer.textYShift}});if(bundles.subscription_window.frames.subscription_timer_icon){var n=new cc.Sprite(bundles.subscription_window.frames.subscription_timer_icon);n.setAnchorPoint2(),n.setPositionRound(t.timer.icon),i.addChild(n)}var o=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.RewardTimerText",cleverapps.styles.FONTS.SUBSCRIPTION_REWARD_READY_TEXT);return t.direction===cleverapps.UI.VERTICAL&&(t.direction=cleverapps.UI.TOP_TO_BOTTOM),new cleverapps.Layout([o,i],{direction:t.direction,margin:3*t.contentObjectsMargin})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{SUBSCRIPTION_TIMER_TEXT:{size:36,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.SubscriptionInfo={contentObjectsMargin:7,direction:cleverapps.UI.HORIZONTAL,timer:{width:210,
height:50,textXShift:0,textYShift:-3}};var GoldBasedPrize=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.GoldBasedPrize;if(this.setAnchorPoint2(),this.setContentSize2(e),"stacks"!==cleverapps.config.subtype){var t=this.createGoldBlock();this.addChild(t)}var s,i=[];s=-1!==["differences","scramble","tripeaks","wordheaps"].indexOf(cleverapps.config.name)?this.createRewardsGrid():this.createGold(),i.push(s);var n=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.AnimationMainText",cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_OFFER_TEXT);n.fitTo(e.everyDayText.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.push(n);var o=new cleverapps.Layout(i,{direction:cleverapps.UI.VERTICAL,margin:e.everyDayText.margin});o.setPositionRound(e.position);var r=this.bg=cleverapps.UI.createScale9Sprite(bundles.subscription_window.frames.subscription_ribbon_png||bundles.main.frames.ribbon,cleverapps.UI.Scale9Rect.TwoPixelXY);r.setAnchorPoint2(0,0),
r.setContentSize2(e.goldRibbonBg),r.addChild(o),e.goldRibbonBg.dx&&(r.x+=e.goldRibbonBg.dx),this.addChild(r),this.bonus&&this.addChild(this.bonus)},createGold:function(){var e=cleverapps.styles.GoldBasedPrize,t=cleverapps.UI.generateImageText(cleverapps.subscription.calcReward().gold,cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT),s=new cc.Sprite(bundles.reward_icons.frames.gold_small_png);s.setScale(e.goldAmount.icon.scale);var i=[s,t];return-1!==["olympics"].indexOf(cleverapps.config.name)&&(this.bonus=new SubscriptionBonus,this.bonus.getDescription().forEach(function(e){i.push(e)})),new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:e.goldAmount.margin})},createRewardsGrid:function(){var n=cleverapps.styles.GoldBasedPrize,e=RewardsHelper.getDisplayData(cleverapps.subscription.calcReward(),{itemsPrefix:"x"}),t=cleverapps.values(e).map(function(e){return function(e,t){var s=new cc.Sprite(e);cleverapps.UI.fitToBox(s,n.prizes.icon),s.setPositionY(
s.getPositionY()+n.prizes.icon.dy);var i=cleverapps.UI.generateTTFText(t,cleverapps.styles.FONTS.SUBSCRIPTION_WINDOW_GOLD_COIN_TEXT);return new cleverapps.Layout([s,i],{direction:cleverapps.UI.HORIZONTAL,margin:n.prizes.margin})}(e.img,e.txt)}),s=[],i=2;"scramble"===cleverapps.config.name&&(i=4);var o=new cleverapps.Layout(t.splice(0,i),{direction:cleverapps.UI.HORIZONTAL,margin:n.prizes.marginCol});if(s.push(o),0<t.length){var r=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:n.prizes.marginCol});s.push(r)}return n.prizes.boostersBelow&&s.reverse(),new cleverapps.Layout(s,{direction:cleverapps.UI.VERTICAL,margin:n.prizes.marginRow})},createGoldBlock:function(){var e=cleverapps.styles.GoldBasedPrize,t=new cc.Node;t.setAnchorPoint2();var s=new cc.Sprite(bundles.subscription_window.frames.prize_icon);t.setContentSize2(s.getContentSize());var i=new cleverapps.Spine(bundles.main.jsons.reward_spine_json,e.gold.backgroundAnimation.scale);return i.setPositionRound(
e.gold.backgroundAnimation.position),t.addChild(i,-1),i.setAnimation(0,"animation",!0),s.setPositionRound(t.width/2,t.height/2),t.addChild(s),t.setPositionRound(e.gold.position),t}});cleverapps.styles.GoldBasedPrize={width:600,height:500,gold:{animation:!1,backgroundAnimation:{scale:.7,position:{x:{align:"center"},y:{align:"center"}}},margin:0,position:{x:{align:"right",dx:0},y:{align:"top",dy:-70}}},goldRibbonBg:{scaleY:1.4,height:204,width:766},goldAmount:{icon:{scale:1.5},margin:10},position:{x:500,y:100},everyDayText:{margin:-4,width:400}};var BonusWorld=function(e,t){this.mission=e,(this.mission.bonusWorld=this).type=t,this.config=BonusWorldConfig[this.type],this.bundle=bundles[this.config.bundle],cleverapps.EventEmitter.call(this)};BonusWorld.prototype=Object.create(cleverapps.EventEmitter.prototype),(BonusWorld.prototype.constructor=BonusWorld).prototype.backgroundBundleId=function(){return cleverapps.isInstant(
)&&bundles[this.config.bundle+"_background_instant"]?this.config.bundle+"_background_instant":this.config.bundle+"_background"},BonusWorld.prototype.isFinished=function(){return this.mission.result===Episode.LEVELS_PER_EPISODE||!this.mission.isRunning()},BonusWorld.prototype.finish=function(e){this.mission.complete(),cleverapps.metha.compound(e,[function(e){new TellWindow({text:"messages:"+this.config.localizationPrefix+".BonusWorldFinishWindow.Text",title:"messages:"+this.config.localizationPrefix+".BonusWorldFinishWindow.Title",buttonText:Messages.get("OK")}),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){cleverapps.metha.gotoMainScene(e)}])},BonusWorld.prototype.onLevelPassed=function(e){this.isCurrentLevel(e)&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BONUS_WORLD_LEVEL+"_"+this.type+"_"+this.getProgress()),cleverapps.playSession.set(cleverapps.EVENTS.BONUS_WORLD_LEVEL_DAU,!0),this.mission.update(1),this.levelPassed=!0)},
BonusWorld.prototype.animateChangeProgress=function(){this.levelPassed=!1,this.trigger("changeProgress")},BonusWorld.prototype.getProgress=function(){return this.mission.result},BonusWorld.prototype.isCurrentLevel=function(e){return e.levelNo===this.getProgress()},BonusWorld.prototype.getAvailableReward=function(){for(var e=0;e<RewardsConfig.BonusWorld.length;e++)if(this.getProgress()>=RewardsConfig.BonusWorld[e].level&&!this.isRewardReceived(RewardsConfig.BonusWorld[e]))return RewardsConfig.BonusWorld[e]},BonusWorld.prototype.isRewardReceived=function(e){return(this.mission.details.receivedRewards||{})[e.level]},BonusWorld.prototype.giveReward=function(e){var s=this.getAvailableReward();s?cleverapps.metha.compound(e,[function(e){this.trigger("giveReward",s,e)}.bind(this),function(e){new RewardWindow({reward:s.reward}),cleverapps.metha.onceNoWindowsListener=e},function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BONUS_WORLD_REWARD+"_"+RewardsConfig.BonusWorld.indexOf(s))
;var t=this.mission.details.receivedRewards||{};t[s.level]=!0,this.mission.update(0,cleverapps.extend(this.mission.details,{receivedRewards:t})),e()}.bind(this)]):e()};var BonusWorldLevel=function(e,t){this.bonusWorld=e,this.levelNo=t,this.type=this.calcType(),this.bonusWorld.on("changeProgress",this.onChangeProgress.bind(this)),cleverapps.EventEmitter.call(this)};BonusWorldLevel.prototype=Object.create(cleverapps.EventEmitter.prototype),(BonusWorldLevel.prototype.constructor=BonusWorldLevel).prototype.calcType=function(){var e=this.bonusWorld.getProgress();return this.bonusWorld.levelPassed&&e--,this.levelNo<e?BonusWorldLevel.TYPE_PASSED:e===this.levelNo?BonusWorldLevel.TYPE_CURRENT:BonusWorldLevel.TYPE_NOT_PASSED},BonusWorldLevel.prototype.setType=function(e){this.type=e,this.trigger("changeType")},BonusWorldLevel.prototype.onChangeProgress=function(){this.bonusWorld.getProgress()!==this.levelNo&&this.bonusWorld.getProgress()-1!==this.levelNo||this.setType(this.calcType())},
BonusWorldLevel.prototype.onClick=function(){new Episode(BonusWorldConfig[this.bonusWorld.type].episode,this.levelNo,{type:Episode.Types.BONUS_WORLD}).getLevel().onPressed()},BonusWorldLevel.TYPE_PASSED=0,BonusWorldLevel.TYPE_CURRENT=1,BonusWorldLevel.TYPE_NOT_PASSED=2;var BonusWorldMissionLogic=function(e,t){this.mission=e;var s=cleverapps.eventManager.getFeatureEvent("bonusworld").options.bonusWorldType;this.bonusWorld=new BonusWorld(e,s),this.mission.iconForce.text="messages:"+this.bonusWorld.config.localizationPrefix+".BonusWorld.Force",t&&(this.clearSavedGames(),cleverapps.forces.clearForce(Forces.BONUS_WORLD.id))};BonusWorldMissionLogic.prototype.hasIntent=function(){return!0},BonusWorldMissionLogic.prototype.willUseIntent=function(e){return e.episode.isBonusWorldLevel()},BonusWorldMissionLogic.prototype.processEvent=function(e,t){e===Mission.EVENT_LEVEL_FINISH&&t.level.episode.isBonusWorldLevel()&&this.bonusWorld.onLevelPassed(t.level)},
BonusWorldMissionLogic.prototype.clearSavedGames=function(){for(var e=0;e<Episode.LEVELS_PER_EPISODE;e++)cleverapps.GameSaver.removeSave(GameBase.getStoreKey({episode:{episodeNo:BonusWorldConfig[this.bonusWorld.type].episode},levelNo:e}))},BonusWorld.TYPE_VALENTINES="valentines",BonusWorld.TYPE_EASTER="easter",BonusWorld.TYPE_SUMMER="summer";var BonusWorldConfig={};BonusWorldConfig[BonusWorld.TYPE_VALENTINES]={bundle:"bonus_world_valentines",episode:"bonus_world_valentines",sideBarJson:bundles.sidebar.jsons.bonus_world_valentines_icon_json,localizationPrefix:"Valentines"},BonusWorldConfig[BonusWorld.TYPE_EASTER]={bundle:"bonus_world_easter",episode:"bonus_world_easter",sideBarJson:bundles.sidebar.jsons.bonus_world_easter_icon_json,localizationPrefix:"Easter"},BonusWorldConfig[BonusWorld.TYPE_SUMMER]={bundle:"bonus_world_summer",episode:"bonus_world_summer",sideBarJson:bundles.sidebar.jsons.bonus_world_summer_icon_json,localizationPrefix:"Summer"};var BonusWorldLockedIcon=function(){
this.featureEvent=cleverapps.eventManager.getNextFeatureEvent(Missions[Mission.TYPE_BONUS_WORLD].feature),SideBarIcon.call(this,{})};BonusWorldLockedIcon.prototype=Object.create(SideBarIcon.prototype),(BonusWorldLockedIcon.prototype.constructor=BonusWorldLockedIcon).prototype.resetState=function(){if(this.available=!1,-1!==cleverapps.missionManager.getProjectAvailableTypes().indexOf(Mission.TYPE_BONUS_WORLD)&&cleverapps.user.checkAvailable(Missions[Mission.TYPE_BONUS_WORLD].available,{future:!0})){var e=Missions[Mission.TYPE_BONUS_WORLD].feature;if(-1===cleverapps.eventManager.listCurrentFeatures().indexOf(e)&&this.featureEvent){var t=this.featureEvent.getTimeBeforeStart();t>BonusWorldLockedIcon.TIME_BEFORE_EVENT||(this.available=!0,t<=0?(this.setLeftTime(0),this.setLocked(!1)):(this.setAnimation(BonusWorldConfig[this.featureEvent.options.bonusWorldType].sideBarJson),this.setLocked(!0),this.setAttention(!1),this.setLeftTime(t)))}}},BonusWorldLockedIcon.prototype.onPressed=function(){
this.removeFromSideBar(),cleverapps.metha.display({focus:"reloadMainScene",action:function(e){cleverapps.metha.gotoMainScene(e)}})},BonusWorldLockedIcon.prototype.getLockedTip=function(){return Messages.get("IconLocked.TipTimer")},BonusWorldLockedIcon.TIME_BEFORE_EVENT=cleverapps.parseInterval("7 days");var BonusWorldScene=cleverapps.FixedWidthScene.extend({ctor:function(e){this.bonusWorld=e.bonusWorld,this._super(cleverapps.Environment.SCENE_BONUS_WORLD);for(var t=0;t<Episode.LEVELS_PER_EPISODE;t++)new BonusWorldLevelView(new BonusWorldLevel(this.bonusWorld,t),this.scene);this.scene.addChild(new BonusWorldRewardsView(this.bonusWorld)),cleverapps.environment.episodeNo=this.bonusWorld.config.episode,cleverapps.playSession.set(cleverapps.EVENTS.BONUS_WORLD_DAU,!0)},onExit:function(){this._super(),this.bonusWorld.purge()},getBackgroundStyles:function(){return{background:bundles[this.bonusWorld.backgroundBundleId()].urls.background,animation:bundles[this.bonusWorld.backgroundBundleId(
)].jsons.background_spine}},getAudioStyles:function(){return{res:bundles[this.bonusWorld.backgroundBundleId()].urls.music,delay:1}}});BonusWorldScene.BUNDLES=function(e){var t=[BonusWorldConfig[e.bonusWorld.type].bundle];return t.push(e.bonusWorld.backgroundBundleId()),t};var BonusWorldLevelView=cc.Node.extend({ctor:function(e,t){this._super(),this.level=e,this.styles=cleverapps.styles.BonusWorldLevelView[this.level.bonusWorld.type],this.setAnchorPoint2(),this.setContentSize2(this.styles),this.setLocalZOrder(Episode.LEVELS_PER_EPISODE-this.level.levelNo),this.createBg(),this.createText(),this.level.type===BonusWorldLevel.TYPE_CURRENT&&this.createIndicator(),t.addChild(this),this.setPositionRound(this.styles.levels[this.level.levelNo]),this.onChangeType(),this.registerTarget(this.styles,"targetLevel"+this.level.levelNo),this.level.on("changeType",this.createListener(this.animateChangeType.bind(this)))},createTooltip:function(){cleverapps.tooltipManager.create(this,{
text:this.level.type===BonusWorldLevel.TYPE_NOT_PASSED?"messages:BonusWorldNotPassedLevelTooltip":"messages:BonusWorldPassedLevelTooltip",position:3<=this.level.levelNo?cleverapps.styles.UI.Tooltip.LOCATION.below:cleverapps.styles.UI.Tooltip.LOCATION.above})},createFinger:function(){this.finger=new FingerView({control:"bonus_world_finger"}),this.getParent().addChild(this.finger),this.finger.setPositionRound(this.styles.levels[this.level.levelNo]),this.finger.standardLoop({delay:5,delayOnBegin:!0})},createBg:function(){var e=this.level.bonusWorld.bundle.jsons.level_json,t=1;this.styles.levels[this.level.levelNo].scaleX&&(e=this.level.bonusWorld.bundle.jsons.level_2_json,t=this.styles.levels[this.level.levelNo].scaleX),this.bg=new cleverapps.Spine(e),this.addChild(this.bg),this.bg.setPositionRound(this.width/2,this.height/2),this.styles.skins&&this.bg.setSkin("skin_"+this.level.levelNo%this.styles.skins),this.bg.setScaleX(t);var s="current"
;this.level.type===BonusWorldLevel.TYPE_PASSED&&(s="passed"),this.level.type===BonusWorldLevel.TYPE_NOT_PASSED&&(s="not_passed"),this.bg.setAnimation(0,s,!0)},createIndicator:function(){if(this.styles.indicator){var e=this.indicator=new cleverapps.Spine(this.level.bonusWorld.bundle.jsons.level_indicator);this.addChild(e),e.setPositionRound(this.width/2,this.height/2),e.setAnimation(0,this.getIndicatorAnimation("idle"),!0)}},createText:function(){this.styles.skinNumbers?this.level.type!==BonusWorldLevel.TYPE_PASSED&&this.bg.setSkin(""+this.level.levelNo):(this.text=cleverapps.UI.generateImageText(this.level.levelNo+1,cleverapps.styles.FONTS.BONUS_WORLD_LEVEL_TEXT),this.addChild(this.text),this.text.setPositionRound(this.styles.text))},onChangeType:function(){this.onClickListener&&(cc.eventManager.removeListener(this.onClickListener),delete this.onClickListener),cleverapps.UI.removeHover(this),cleverapps.tooltipManager.remove(this),this.finger&&this.finger.removeFromParent(),
this.level.type===BonusWorldLevel.TYPE_PASSED&&this.createTooltip(),this.level.type===BonusWorldLevel.TYPE_CURRENT&&(cleverapps.UI.applyHover(this),this.onClickListener=cleverapps.UI.onClick(this,this.onClick.bind(this)),this.createFinger()),this.level.type===BonusWorldLevel.TYPE_NOT_PASSED&&this.createTooltip()},animateChangeType:function(){this.styles.indicator?this.animateIndicatorChange():(this.level.type===BonusWorldLevel.TYPE_CURRENT&&this.bg.setAnimationAndIdleAfter("np-c","current"),this.level.type===BonusWorldLevel.TYPE_PASSED&&(this.bg.setAnimationAndIdleAfter("c-p","passed"),this.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.PlaySound(this.level.bonusWorld.bundle.urls.pass_level_effect))))),this.onChangeType()},animateIndicatorChange:function(){if(this.level.type===BonusWorldLevel.TYPE_CURRENT){var e=this.styles["targetLevel"+(this.level.levelNo-1)],t=cc.p(this.width/2,this.height/2),s=this.indicator=e.indicator;delete e.indicator,s.replaceParentSamePlace(this),
s.setAnimation(0,this.getIndicatorAnimation("animation"),!1),cleverapps.audio.playSound(this.level.bonusWorld.bundle.urls.jump_sfx),this.bg.setAnimation(0,"np-c",!1),s.runAction(new cc.Sequence(new cc.JumpTo(this.styles.delay,t,this.styles.jumpHeight,1),new cc.CallFunc(function(){s.setAnimation(0,this.getIndicatorAnimation("idle"),!0),this.bg.setAnimation(0,"current",!0)}.bind(this))))}if(this.level.type===BonusWorldLevel.TYPE_PASSED&&(this.bg.setAnimationAndIdleAfter("c-p","passed"),this.level.levelNo===Episode.LEVELS_PER_EPISODE-1)){var i=cleverapps.styles.BonusWorldRewardsView[this.level.bonusWorld.type].finalPrizeTarget;this.indicator.replaceParentSamePlace(i),this.indicator.setAnimationAndIdleAfter("animation","idle_static");t=cc.p(i.width/2+this.styles.finalPrizePos.x,i.height/2+this.styles.finalPrizePos.y);this.indicator.runAction(new cc.JumpTo(this.styles.delay,t,this.styles.jumpHeight,1)),cleverapps.audio.playSound(this.level.bonusWorld.bundle.urls.jump_sfx)}},
getIndicatorAnimation:function(e){return e+(this.styles.levels[this.level.levelNo].invertIndicator?"_invert":"")},onClick:function(){this.level.onClick()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BONUS_WORLD_LEVEL_TEXT:{name:"default",size:40}}),cleverapps.styles.BonusWorldLevelView={},cleverapps.styles.BonusWorldLevelView[BonusWorld.TYPE_VALENTINES]={width:130,height:100,text:{x:{align:"center"},y:{align:"center"}},levels:[{x:{align:"center",dx:-84},y:{align:"center",dy:-550}},{x:{align:"center",dx:53},y:{align:"center",dy:-600},scaleX:1},{x:{align:"center",dx:220},y:{align:"center",dy:-550},scaleX:-1},{x:{align:"center",dx:100},y:{align:"center",dy:-350}},{x:{align:"center",dx:-30},y:{align:"center",dy:-307},scaleX:-1},{x:{align:"center",dx:-190},y:{align:"center",dy:-300},scaleX:-1},{x:{align:"center",dx:-245},y:{align:"center",dy:-210}},{x:{align:"center",dx:-205},y:{align:"center",dy:-90},scaleX:-1},{x:{align:"center",dx:60},y:{align:"center",dy:-47},scaleX:1},{x:{
align:"center",dx:210},y:{align:"center",dy:-10}},{x:{align:"center",dx:200},y:{align:"center",dy:110},scaleX:-1},{x:{align:"center",dx:30},y:{align:"center",dy:135}},{x:{align:"center",dx:-130},y:{align:"center",dy:159},scaleX:-1},{x:{align:"center",dx:-190},y:{align:"center",dy:280},scaleX:1},{x:{align:"center",dx:-80},y:{align:"center",dy:370},scaleX:1}]},cleverapps.styles.BonusWorldLevelView[BonusWorld.TYPE_EASTER]={width:130,height:160,skins:3,text:{x:{align:"center"},y:{align:"center",dy:10}},levels:[{x:{align:"center",dx:-149},y:{align:"center",dy:-490}},{x:{align:"center",dx:12},y:{align:"center",dy:-515}},{x:{align:"center",dx:159},y:{align:"center",dy:-470}},{x:{align:"center",dx:97},y:{align:"center",dy:-314}},{x:{align:"center",dx:-48},y:{align:"center",dy:-320}},{x:{align:"center",dx:-194},y:{align:"center",dy:-305}},{x:{align:"center",dx:-256},y:{align:"center",dy:-198}},{x:{align:"center",dx:-253},y:{align:"center",dy:-68}},{x:{align:"center",dx:-113},y:{align:"center",
dy:10}},{x:{align:"center",dx:54},y:{align:"center",dy:-19}},{x:{align:"center",dx:190},y:{align:"center",dy:7}},{x:{align:"center",dx:99},y:{align:"center",dy:102}},{x:{align:"center",dx:-29},y:{align:"center",dy:149}},{x:{align:"center",dx:-148},y:{align:"center",dy:241}},{x:{align:"center",dx:-125},y:{align:"center",dy:363}}]},cleverapps.styles.BonusWorldLevelView[BonusWorld.TYPE_SUMMER]={width:75,height:105,skinNumbers:!0,indicator:!0,jumpHeight:60,delay:.99,text:{x:{align:"center"},y:{align:"center"}},finalPrizePos:{x:-10,y:50},levels:[{x:{align:"center",dx:-224},y:{align:"center",dy:-551}},{x:{align:"center",dx:-115},y:{align:"center",dy:-445}},{x:{align:"center",dx:-41},y:{align:"center",dy:-347}},{x:{align:"center",dx:89},y:{align:"center",dy:-298}},{x:{align:"center",dx:211},y:{align:"center",dy:-252}},{x:{align:"center",dx:273},y:{align:"center",dy:-175}},{invertIndicator:!0,x:{align:"center",dx:179},y:{align:"center",dy:-119}},{invertIndicator:!0,x:{align:"center",dx:43},y:{
align:"center",dy:-81}},{invertIndicator:!0,x:{align:"center",dx:-95},y:{align:"center",dy:-67}},{invertIndicator:!0,x:{align:"center",dx:-225},y:{align:"center",dy:-31}},{x:{align:"center",dx:-132},y:{align:"center",dy:47}},{x:{align:"center",dx:-31},y:{align:"center",dy:104}},{x:{align:"center",dx:74},y:{align:"center",dy:140}},{invertIndicator:!0,x:{align:"center",dx:17},y:{align:"center",dy:206}},{invertIndicator:!0,x:{align:"center",dx:-74},y:{align:"center",dy:255}}]},"riddles"===cleverapps.config.name&&(cleverapps.styles.BonusWorldLevelView[BonusWorld.TYPE_SUMMER]={width:85,height:85,skinNumbers:!0,indicator:!0,jumpHeight:50,delay:.4,finalPrizePos:{x:0,y:0},text:{x:{align:"center"},y:{align:"center"}},levels:[{x:{align:"center",dx:38},y:{align:"center",dy:-523},invertIndicator:!0},{x:{align:"center",dx:-56},y:{align:"center",dy:-488},invertIndicator:!0},{x:{align:"center",dx:-138},y:{align:"center",dy:-437},invertIndicator:!0},{x:{align:"center",dx:-211},y:{align:"center",
dy:-363},invertIndicator:!0},{x:{align:"center",dx:-262},y:{align:"center",dy:-275},invertIndicator:!0},{x:{align:"center",dx:-198},y:{align:"center",dy:-193}},{x:{align:"center",dx:-87},y:{align:"center",dy:-170}},{x:{align:"center",dx:35},y:{align:"center",dy:-150}},{x:{align:"center",dx:268},y:{align:"center",dy:-70}},{x:{align:"center",dx:220},y:{align:"center",dy:14},invertIndicator:!0},{x:{align:"center",dx:141},y:{align:"center",dy:84},invertIndicator:!0},{x:{align:"center",dx:73},y:{align:"center",dy:164},invertIndicator:!0},{x:{align:"center",dx:-36},y:{align:"center",dy:201},invertIndicator:!0},{x:{align:"center",dx:-115},y:{align:"center",dy:259},invertIndicator:!0},{x:{align:"center",dx:-174},y:{align:"center",dy:337},invertIndicator:!0}]}),"scramble"===cleverapps.config.name&&(cleverapps.styles.BonusWorldLevelView[BonusWorld.TYPE_SUMMER]={skins:2,width:80,height:70,text:{x:{align:"center",dx:2},y:{align:"center",dy:2}},levels:[{x:{align:"center",dx:-50},y:{align:"center",
dy:-455}},{x:{align:"center",dx:41},y:{align:"center",dy:-389}},{x:{align:"center",dx:145},y:{align:"center",dy:-345}},{x:{align:"center",dx:58},y:{align:"center",dy:-245}},{x:{align:"center",dx:-75},y:{align:"center",dy:-230}},{x:{align:"center",dx:-176},y:{align:"center",dy:-177}},{x:{align:"center",dx:-154},y:{align:"center",dy:-82}},{x:{align:"center",dx:-32},y:{align:"center",dy:-63}},{x:{align:"center",dx:190},y:{align:"center",dy:29}},{x:{align:"center",dx:59},y:{align:"center",dy:80}},{x:{align:"center",dx:-68},y:{align:"center",dy:92}},{x:{align:"center",dx:-164},y:{align:"center",dy:163}},{x:{align:"center",dx:-46},y:{align:"center",dy:202}},{x:{align:"center",dx:70},y:{align:"center",dy:247}},{x:{align:"center",dx:186},y:{align:"center",dy:283}}]});var BonusWorldRewardsView=cc.Node.extend({ctor:function(e){this._super(),this.bonusWorld=e,this.setAnchorPoint2(),this.styles=cleverapps.styles.BonusWorldRewardsView[this.bonusWorld.type],this.setPositionRound({x:{align:"center"},
y:{align:"center"}}),this.rewards=RewardsConfig.BonusWorld.map(function(e,t){var s=this.bonusWorld.isRewardReceived(e),i=new cc.Node;this.addChild(i),i.setAnchorPoint2(),i.setContentSize2(this.styles.prize),i.setPositionRound(this.styles.prizes[t]),s||(cleverapps.tooltipManager.create(i,{rewards:e.reward,text:"messages:"+this.bonusWorld.config.localizationPrefix+".BonusWorld.RewardTooltip",position:t<1?cleverapps.styles.UI.Tooltip.LOCATION.above:cleverapps.styles.UI.Tooltip.LOCATION.below}),cleverapps.UI.applyHover(i));var n=new cleverapps.Spine(this.bonusWorld.bundle.jsons.chest_json);return i.addChild(n),n.setAnimation(0,s?"idle_open":"idle",!0),n.setSkin("skin_"+t),n.setPositionRound(i.width/2,i.height/2),i.animation=n,t===RewardsConfig.BonusWorld.length-1&&i.registerTarget(this.styles,"finalPrizeTarget"),i},this),this.bonusWorld.on("giveReward",this.giveReward.bind(this))},giveReward:function(e,t){var s=this.rewards[RewardsConfig.BonusWorld.indexOf(e)];cleverapps.UI.removeHover(s),
cleverapps.tooltipManager.remove(s),cleverapps.audio.playSound(this.bonusWorld.bundle.urls.prize_sfx);var i=s.animation;i.setAnimation(0,"open",!1),i.setCompleteListener(function(){i.setAnimation(0,"idle_open",!0),i.setCompleteListener(function(){}),t()}.bind(this))}});cleverapps.styles.BonusWorldRewardsView={},cleverapps.styles.BonusWorldRewardsView[BonusWorld.TYPE_VALENTINES]={prize:{width:150,height:150},prizes:[{x:{align:"center",dx:220},y:{align:"center",dy:-430}},{x:{align:"center",dx:-71},y:{align:"center",dy:-60}},{x:{align:"center",dx:19},y:{align:"center",dy:441}}]},cleverapps.styles.BonusWorldRewardsView[BonusWorld.TYPE_EASTER]={prize:{width:150,height:150},prizes:[{x:{align:"center",dx:245},y:{align:"center",dy:-349}},{x:{align:"center",dx:-245},y:{align:"center",dy:85}},{x:{align:"center",dx:19},y:{align:"center",dy:476}}]},cleverapps.styles.BonusWorldRewardsView[BonusWorld.TYPE_SUMMER]={prize:{width:150,height:150},prizes:[{x:{align:"center",dx:144},y:{align:"center",
dy:-422}},{x:{align:"center",dx:203},y:{align:"center",dy:33}},{x:{align:"center",dx:22},y:{align:"center",dy:422}}]},"riddles"===cleverapps.config.name&&(cleverapps.styles.BonusWorldRewardsView[BonusWorld.TYPE_SUMMER]={prize:{width:90,height:90},prizes:[{x:{align:"center",dx:-251},y:{align:"center",dy:-467}},{x:{align:"center",dx:140},y:{align:"center",dy:-91}},{x:{align:"center",dx:-40},y:{align:"center",dy:373}}]}),"scramble"===cleverapps.config.name&&(cleverapps.styles.BonusWorldRewardsView[BonusWorld.TYPE_SUMMER]={prize:{width:110,height:110},prizes:[{x:{align:"center",dx:180},y:{align:"center",dy:-241}},{x:{align:"center",dx:98},y:{align:"center",dy:-41}},{x:{align:"center",dx:-10},y:{align:"center",dy:384}}]});var SlotMachine=function(e){cleverapps.EventEmitter.call(this),this.mission=e,(this.mission.slotMachine=this).reels=[];for(var t=0;t<SlotMachine.REELS_AMOUNT;t++)this.reels.push(new SlotMachineReel(SlotMachine.SYMBOLS)),this.reels[t].setCurrentByType(
cleverapps.Random.choose(SlotMachine.SYMBOLS).type)};SlotMachine.prototype=Object.create(cleverapps.EventEmitter.prototype),(SlotMachine.prototype.constructor=SlotMachine).prototype.isForceAvailable=function(){return!cleverapps.forces.isShown(Forces.SLOT_MACHINE.id)},SlotMachine.prototype.showForce=function(){0===this.getTickets()&&this.earnTickets(1),this.trigger("showForce")},SlotMachine.prototype.getTickets=function(){return this.mission.result},SlotMachine.prototype.earnTickets=function(e){e=Math.min(e,SlotMachine.MAX_TICKETS_AMOUNT-this.mission.result),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SLOT_MACHINE_TICKET,{amount:e}),this.mission.update(e),this.trigger("updateTickets")},SlotMachine.prototype.takeTicket=function(e){this.mission.update(-1),this.trigger("updateTickets",e)},SlotMachine.prototype.canSpin=function(){return 0<this.getTickets()},SlotMachine.prototype.spin=function(e){this.takeTicket(),cleverapps.playSession.set(cleverapps.EVENTS.SLOT_MACHINE_SPIN_DAU,!0),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SLOT_MACHINE_SPIN);var i=this.calcPayline();this.trigger("spin"),cleverapps.metha.compound(e,[function(s){s=cleverapps.wait(this.reels.length,s),this.reels.forEach(function(e,t){setTimeout(function(){this.reels[t].spin(i[t],s)}.bind(this),t*SlotMachine.REEL_SPIN_DELAY)},this)}.bind(this),function(e){setTimeout(e,500)},this.giveReward.bind(this)])},SlotMachine.prototype.calcPayline=function(){return cleverapps.config.debugMode&&SlotMachine.PREDEFINED_PAYLINE?SlotMachine.PREDEFINED_PAYLINE:[cleverapps.Random.choose(SlotMachine.SYMBOLS).type,cleverapps.Random.choose(SlotMachine.SYMBOLS).type,cleverapps.Random.choose(SlotMachine.SYMBOLS).type]},SlotMachine.prototype.giveReward=function(e){var t,s=this.reels.map(function(e){return e.getCurrent()});if(s.every(function(e){return e.type===s[0].type}))t=s[0].reward;else{var i=s.reduce(function(e,t){return e+(t.gold||0)},0);0<i&&(t={gold:i})}this.trigger("giveReward",t,e),t&&setTimeout(
cleverapps.Chest.prototype._receiveReward.bind(null,t),2e3)},SlotMachine.REELS_AMOUNT=3,SlotMachine.REEL_SPIN_DELAY=300,SlotMachine.MAX_TICKETS_AMOUNT=20,SlotMachine.COIN_SYMBOL={type:"coin",icon:bundles.slot_machine.frames.coin_png,reward:{gold:100},gold:10},SlotMachine.COINS_SYMBOL={type:"coins",icon:bundles.slot_machine.frames.coins_png,reward:{gold:500},gold:50},SlotMachine.SYMBOLS=[SlotMachine.COINS_SYMBOL,{type:"booster_1",icon:bundles.slot_machine.frames.booster_13_png,reward:{boosters:{13:5}}},SlotMachine.COIN_SYMBOL,{type:"booster_2",icon:bundles.slot_machine.frames.booster_14_png,reward:{boosters:{14:5}}},SlotMachine.COINS_SYMBOL,{type:"booster_3",icon:bundles.slot_machine.frames.booster_15_png,reward:{boosters:{15:5}}},SlotMachine.COIN_SYMBOL];var SlotMachineReel=function(e){cleverapps.EventEmitter.call(this),this.symbols=e.map(function(e,t){return new SlotMachineSymbol(this,e,t)},this),this.current=0};SlotMachineReel.prototype=Object.create(cleverapps.EventEmitter.prototype
),(SlotMachineReel.prototype.constructor=SlotMachineReel).prototype.setCurrentByType=function(t){this.current=this.symbols.filter(function(e){return e.type===t})[0].index;for(var e=0;e<this.symbols.length;e++)this.symbols[e].move()},SlotMachineReel.prototype.getCurrent=function(){return this.symbols[this.current]},SlotMachineReel.prototype.spin=function(e,t){this.minSpinsAmount=cleverapps.Random.random(20,25),this._spinOneDegree(0,e,t)},SlotMachineReel.prototype._spinOneDegree=function(e,t,s){e++,this.current=(this.current-1+this.symbols.length)%this.symbols.length;for(var i=e>=this.minSpinsAmount&&this.symbols[this.current].type===t,n=0;n<this.symbols.length;n++)this.symbols[n].spin(i);setTimeout(function(){i?s():this._spinOneDegree(e,t,s)}.bind(this),SlotMachineReel.ONE_DEGREE_DURATION)},SlotMachineReel.ONE_DEGREE_DURATION=50;var SlotMachineSymbol=function(e,t,s){cleverapps.EventEmitter.call(this),cleverapps.extend(this,t),this.reel=e,this.index=s}
;SlotMachineSymbol.prototype=Object.create(cleverapps.EventEmitter.prototype),(SlotMachineSymbol.prototype.constructor=SlotMachineSymbol).prototype.move=function(){this.trigger("move")},SlotMachineSymbol.prototype.spin=function(e){this.trigger("spin",e)};var SlotMachineMissionLogic=function(e){this.mission=e,this.slotMachine=new SlotMachine(e)},SlotMachineButton=cc.Node.extend({ctor:function(e){this.slotMachine=e;var t=cleverapps.styles.SlotMachineButton;this._super(),this.setAnchorPoint2(),this.setContentSize2(t),this.background=new cleverapps.Spine(bundles.slot_machine.jsons.button_json),this.addChild(this.background),this.background.setPositionRound(this.width/2,this.height/2),this.background.setAnimation(0,"idle",!0),this.setScale(.5),this.baseScale=this.scale,this.setPositionRound(t),cleverapps.UI.onClick(this,this.onClicked.bind(this),{swallowTouches:!1}),this.updateState(!0),this.slotMachine.on("showForce",this.createListener(this.showForce.bind(this))),this.slotMachine.on(
"updateTickets",this.createListener(this.updateState.bind(this)))},showForce:function(){cleverapps.metha.display({focus:"SlotMachineForce",action:function(e){cleverapps.forces.create(this,Forces.SLOT_MACHINE,{scaleX:1.5,scaleY:1.5}),cleverapps.forces.onceForceClosed=e}.bind(this)})},onClicked:function(){cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),cleverapps.metha.display({focus:"SlotMachine",control:"MenuBarGoldItem",action:function(e){if(!this.slotMachine.canSpin())return this.runDisabledAnimation(),void e();this.slotMachine.spin(e),this.runPressAnimation()}.bind(this)})},runDisabledAnimation:function(){this.background.setAnimationAndIdleAfter("disabled_press","disabled_idle"),cleverapps.audio.playSound(bundles.slot_machine.urls.button_click_effect)},runPressAnimation:function(){this.background.setAnimationAndIdleAfter("press","idle"),cleverapps.audio.playSound(bundles.slot_machine.urls.button_click_effect)},createTooltip:function(){
cleverapps.tooltipManager.create(this,{text:"messages:SlotMachine.NoTickets",position:cleverapps.styles.UI.Tooltip.LOCATION.above})},updateState:function(e){cleverapps.UI.removeHover(this),0===this.slotMachine.getTickets()&&(e?(this.background.setAnimation(0,"disabled_idle",!0),this.createTooltip()):this.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){this.background.setAnimationAndIdleAfter("disabled_transition","disabled_idle"),this.createTooltip()}.bind(this))))),0<this.slotMachine.getTickets()&&(this.background.setAnimation(0,"idle",!0),cleverapps.UI.applyHover(this),cleverapps.tooltipManager.remove(this))}});cleverapps.styles.SlotMachineButton={x:{align:"center"},y:{align:"center",dy:-200},contentOffset:{x:0,y:28},width:400,height:250};var SlotMachineReelView=ccui.Layout.extend({ctor:function(e){this._super(),this.reel=e,this.setClippingEnabled(!0);var t=cleverapps.styles.SlotMachineReelView;this.setContentSize2(t),this.reel.symbols.forEach(function(e){
this.addChild(new SlotMachineSymbolView(e))}.bind(this))}});cleverapps.styles.SlotMachineReelView={width:140,height:286};var SlotMachineSymbolView=cc.Node.extend({ctor:function(e){this._super(),this.symbol=e,this.reel=this.symbol.reel;var t=cleverapps.styles.SlotMachineSymbolView;this.setContentSize2(t),this.setAnchorPoint2();var s=new cc.Sprite(e.icon);this.addChild(s),s.setPositionRound(this.width/2,this.height/2),e.on("move",this.createListener(this.move.bind(this))),e.on("spin",this.createListener(this.spinOneDegree.bind(this))),this.setPositionRound(this.calcPosition())},move:function(){this.setPositionRound(this.calcPosition())},spinOneDegree:function(e){var t=cleverapps.styles.SlotMachineSymbolView,s=this.calcPosition();e?this.runAction(new cc.Sequence(new cc.MoveBy(SlotMachineReel.ONE_DEGREE_DURATION/1e3,0,-t.height-t.height/2).easing(cc.easeBackInOut(.6)),new cc.PlaySound(bundles.slot_machine.urls.spin_stop_effect,{throttle:0}),new cc.MoveBy(.1,0,t.height/2+t.height/8),
new cc.MoveBy(.1,0,-t.height/8).easing(cc.easeIn(2)),new cc.CallFunc(function(){this.setPositionRound(s)}.bind(this)))):this.runAction(new cc.Sequence(new cc.MoveBy(SlotMachineReel.ONE_DEGREE_DURATION/1e3,0,-t.height),new cc.CallFunc(function(){this.setPositionRound(s)}.bind(this)))),cleverapps.audio.playSound(bundles.slot_machine.urls.spin_effect,{throttle:25})},calcPosition:function(){var e=cleverapps.styles.SlotMachineSymbolView,t=((this.reel.getCurrent().index+1)%this.reel.symbols.length-this.symbol.index+this.reel.symbols.length)%this.reel.symbols.length,s=cleverapps.styles.SlotMachineReelView.height/2-(e.height/2+e.height);return cc.p(this.width/2,e.height/2+t*e.height+s)}});cleverapps.styles.SlotMachineSymbolView={width:150,height:150,lastAnimation:{}};var SlotMachineScene=cleverapps.FixedWidthScene.extend({ctor:function(e){this._super(cleverapps.Environment.SCENE_SLOT_MACHINE),this.slotMachine=e.slotMachine,this.background.addChild(new SlotMachineButton(this.slotMachine)),
this.background.addChild(new SlotMachineView(this.slotMachine,this)),cleverapps.playSession.set(cleverapps.EVENTS.SLOT_MACHINE_DAU,!0)},onExit:function(){this._super(),this.slotMachine.purge()},getBackgroundStyles:function(){return{background:bundles.slot_machine.urls.background}},getAudioStyles:function(){return{res:bundles.slot_machine.urls.music,delay:1}}});SlotMachineScene.BUNDLES=function(){return["slot_machine"]};var SlotMachineView=cc.Node.extend({ctor:function(e,t){this._super(),this.setAnchorPoint2(),this.slotMachine=e,this.scene=t;var s=cleverapps.styles.SlotMachineView,i=this.slotMachine.reels.map(function(e){return new SlotMachineReelView(e)},this),n=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:s.margin});this.addChild(n),this.setContentSize2(n.getContentSize()),n.setPositionRound(this.width/2,this.height/2),this.setScale(.5),this.setPositionRound(s);var o=new cc.Sprite(bundles.slot_machine.frames.arrow_png);this.addChild(o),o.setPositionRound(s.arrow)
,this.createBar(),this.createHelpButton(),this.slotMachine.on("giveReward",this.createListener(this.giveReward.bind(this))),this.slotMachine.on("spin",this.createListener(this.onSpin.bind(this))),this.slotMachine.on("updateTickets",this.createListener(this.updateBar.bind(this)))},createBar:function(){var e=cleverapps.styles.SlotMachineView;this.bar=new ScaledProgressBar({progress:bundles.slot_machine.frames.bar_png,background:bundles.slot_machine.frames.bar_bg_png,padding:e.bar.padding}),this.addChild(this.bar),this.bar.setDimension(e.bar.width,e.bar.height),this.bar.setPositionRound(e.bar),this.bar.setPercentage(this.slotMachine.getTickets()/SlotMachine.MAX_TICKETS_AMOUNT*100),this.barText=cleverapps.UI.generateImageText(this.slotMachine.getTickets()+"/"+SlotMachine.MAX_TICKETS_AMOUNT,cleverapps.styles.FONTS.SLOT_MACHINE_BAR_TEXT),this.bar.addChild(this.barText),this.barText.setPositionRound(e.bar.text)},createHelpButton:function(){var e=cleverapps.styles.SlotMachineView
;this.helpButton=new cleverapps.UI.Button({button_png:bundles.slot_machine.frames.help_button_png,button_on_png:bundles.slot_machine.frames.help_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"SlotMachineRulesWindow",action:function(e){new SlotMachineRulesWindow,cleverapps.metha.onceNoWindowsListener=e}})}}),this.addChild(this.helpButton),this.helpButton.setPositionRound(e.helpButton)},updateBar:function(){var e=this.slotMachine.getTickets()/SlotMachine.MAX_TICKETS_AMOUNT*100-this.bar.getPercentage();this.bar.animatedChange(e),this.barText.setString(this.slotMachine.getTickets()+"/"+SlotMachine.MAX_TICKETS_AMOUNT)},giveReward:function(e,t){if(!e)return cleverapps.audio.playSound(bundles.slot_machine.urls.no_reward_effect),void t();var s;e.boosters?(s=new cleverapps.Spine(bundles.slot_machine.jsons.reward_json),this.addChild(s),s.setPositionRound(this.width/2,this.height/2),s.setSkin("booster_"+Object.keys(e.boosters)[0]),s.setAnimation(0,"show_up",!1),
cleverapps.audio.playSound(bundles.slot_machine.urls.boosters_reward_effect)):(s=new cleverapps.Spine(bundles.slot_machine.jsons.reward_gold_json),this.addChild(s),s.setPositionRound(this.width/2,this.height/2),s.setAnimation(0,"animation2",!1),cleverapps.audio.playSound(bundles.slot_machine.urls.coins_reward_effect)),s.setCompleteListenerRemove(this.showRewards.bind(this,e,t))},createReward:function(e,t){var s=cleverapps.styles.SlotMachineView,i=cleverapps.UI.generateImageText(e,cleverapps.styles.FONTS.SLOT_MACHINE_REWARD_TEXT),n=new cc.Sprite(t);return n.setScale(.7),new cleverapps.Layout([n,i],{margin:s.rewards.textMargin,direction:cleverapps.UI.HORIZONTAL})},showRewards:function(e,t){var s=cleverapps.styles.SlotMachineView,i=[];for(var n in e)if("boosters"===n)for(var o in e[n])i.push(this.createReward("x"+e[n][o],RewardsHelper.ICONS[o]));else i.push(this.createReward(e[n],RewardsHelper.ICONS[n]));this.rewardsBlock=new cleverapps.Layout(i,{margin:s.rewards.margin,
direction:cleverapps.UI.HORIZONTAL}),this.rewardsBlock.setCascadeOpacityEnabledRecursively(!0),this.addChild(this.rewardsBlock),this.rewardsBlock.setPositionRound(s.rewards),this.rewardsBlock.setScale(.5),this.rewardsBlock.setOpacity(0),this.rewardsBlock.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,1).easing(cc.easeBackInOut(1)),new cc.FadeIn(.3)),new cc.PlaySound(bundles.slot_machine.urls.reward_window_effect),new cc.CallFunc(t)))},onSpin:function(){this.rewardsBlock&&(this.rewardsBlock.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.RemoveSelf)),delete this.rewardsBlock)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{SLOT_MACHINE_REWARD_TEXT:{size:50,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SLOT_MACHINE_BAR_TEXT:{size:32,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.SlotMachineView={x:{align:"center"},y:{align:"center",dy:55},helpButton:{x:{
align:"center",dx:-192},y:{align:"center",dy:-320}},arrow:{x:{align:"center",dx:-239},y:{align:"center",dy:0}},rewards:{textMargin:4,margin:5,x:{align:"center"},y:{align:"center",dy:231}},bar:{width:400,height:55,x:{align:"center",dx:30},y:{align:"center",dy:-320},padding:{left:7,right:7,top:9,bottom:14},text:{x:{align:"center"},y:{align:"center",dy:3}}},margin:10};var SlotMachineRulesWindow=RulesWindow.extend({onWindowLoaded:function(){this._super({name:"slotmachineruleswindow",styles:cleverapps.styles.SlotMachineRulesWindow})},listBundles:function(){return["slot_machine_rules_window"]}});cleverapps.styles.SlotMachineRulesWindow={prefix:"messages:SlotMachineRulesWindow.",animation:{json:bundles.slot_machine_rules_window.jsons.rules_json},subText:{width:190,left:{y:{align:"top",dy:-245}},right:{x:{align:"right",dx:-5},y:{align:"top",dy:-260}},bottom:{y:{align:"bottom",dy:5}}}};var PurchaseRewardWindow=RewardWindow.extend({onWindowLoaded:function(e){this._super({
title:"messages:PurchaseRewardWindow.title",name:"purchaserewardwindow",reward:e.reward,callback:e.callback,buttonText:"messages:OK",rewardName:!1})},receiveReward:function(){this.reward&&(this.onReceiveReward(),cleverapps.Chest.prototype._receiveReward(this.reward,!0),this.reward=[])},selectDoubleStrategy:function(){}});WINDOW_ANIMATIONS={default:{open:function(e){var t=this.window.scale;this.window.setScale(.8*t),this.window.runAction(new cc.Sequence(new cc.ScaleTo(.3,t).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){e()}},fallIn:{open:function(e){var t=this.window.scale;this.window.setScale(3.2*t),this.runForAllChildren(function(e){e.setCascadeOpacityEnabled(!0)}),this.window.setOpacity(30),this.window.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.5,t).easing(cc.easeIn(1.5)),new cc.FadeIn(.5).easing(cc.easeIn(2))),new cc.CallFunc(e)))},close:function(e){e()}},fromLeft:{open:function(e){var t=this.window.basePosition;this.window.setPositionX(-t.x),
this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,-this.window.x,this.window.y).easing(cc.easeBackIn()),new cc.CallFunc(e)))}},fromBelow:{open:function(e){var t=this.window.basePosition;this.window.setPositionY(0),this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.4,this.window.x,0).easing(cc.easeBackIn()),new cc.CallFunc(e)))}},fromLeftToRight:{open:function(e){var t=this.window.basePosition;this.window.setPositionX(-this.window.width/2),this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,t.x,t.y).easing(cc.easeBackOut()),new cc.CallFunc(e)))},close:function(e){this.window.runAction(new cc.Sequence(new cc.MoveTo(.3,this.width+this.window.width/2,this.window.y).easing(cc.easeBackIn()),new cc.CallFunc(e)))}},bezierCircle:{
open:function(e){var t=cc.p(this.window.basePosition.x,this.window.basePosition.y),s=cc.p(t.x+.2*this.width,this.height-this.window.height/2),i=cc.p(t.x+.35*this.width,t.y-this.window.height/6),n=this.window.scale;this.window.setScale(.3*n),this.window.setPosition(s);this.window.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.25,[s,i,t]),new cc.ScaleTo(.25,n).easing(cc.easeIn(3))),new cc.CallFunc(e)))},close:function(e){var t=cc.p(this.window.basePosition.x,this.window.basePosition.y),s=cc.p(t.x-.2*this.width,this.height-this.window.height/2),i=cc.p(t.x-.35*this.width,t.y-this.window.height/2);this.window.setPosition(t);this.window.runAction(new cc.Sequence(new cc.Spawn(new cc.BezierTo(.25,[t,i,s]),new cc.ScaleTo(.25,.3).easing(cc.easeOut(.33))),new cc.CallFunc(e)))}},instant:{open:function(e){e()},close:function(e){e()}},force:{open:function(e){e()},close:function(e){this.dialogue.close(e)}}},AVAILABLE_MOVE_ANIMATIONS={default:function(e,t,s){var i=e.scale,n=e.x,o=e.y,
r=-t.col*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.16,a=t.row*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.16;0===t.row&&(a-=.075*cleverapps.styles.BaseCellView.CELL_SIZE_PX),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.Repeat(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.35,1.1*i),new cc.MoveTo(.35,n-r,o-a).easing(cc.easeIn(3.5))),new cc.Spawn(new cc.ScaleTo(.35,i),new cc.MoveTo(.35,n,o).easing(cc.easeOut(3.5)))),3),new cc.DelayTime(3))))},homescapes:function(e,t,s){var i=e.getScaleX(),n=e.getScaleY(),o=e.x,r=e.y,a=e.getRotation();if(e.cell.x===s.start.x&&e.cell.y===s.start.y){var c=s.dir.col*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.2,l=-s.dir.row*cleverapps.styles.BaseCellView.CELL_SIZE_PX*.2;e.setLocalZOrder(10),e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.Spawn(new cc.Sequence(new cc.MoveBy(.45,c,l),new cc.MoveBy(.2,-.3*c,-.3*l),new cc.MoveBy(.2,.3*c,.3*l),new cc.MoveTo(.4,o,r).easing(cc.easeOut(1))),new cc.Sequence(new cc.ScaleTo(.45,1.1*i,1.1*n),
new cc.DelayTime(.4),new cc.ScaleTo(.4,i,n).easing(cc.easeOut(1)))),new cc.DelayTime(.5))))}else e.runAction(new cc.RepeatForever(new cc.Sequence(new cc.DelayTime(.1),new cc.Spawn(new cc.Sequence(new cc.ScaleTo(.35,1.1*i,1.1*n),new cc.DelayTime(.35),new cc.ScaleTo(.35,i,n)),new cc.Sequence(new cc.RotateTo(.35,a-5).easing(cc.easeIn(2)),new cc.RotateTo(.175,a+5),new cc.RotateTo(.175,a-5),new cc.RotateTo(.35,a))),new cc.DelayTime(.6))))}},WRONG_MOVE_ANIMATIONS={default:function(e,t){var s=cleverapps.styles.BaseCellView.wrongMove.move,i=function(e){return 0<e?1:e<0?-1:0},n=s*i(t.x-e.cell.x),o=s*i(e.cell.y-t.y),r=.9,a=1.1;e.cell.x===t.x&&(r=1.1,a=.9),Game.counter.setTimeout(function(){}.bind(e),100),e.runAction(new cc.Spawn(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.1,r,a),new cc.MoveBy(.1,new cc.p(n,o))),new cc.Spawn(new cc.ScaleTo(.1,1,1),new cc.MoveBy(.1,new cc.p(-n,-o)))),new cc.CallFunc(e.squeeze.bind(e,1))))}},BOARD_GUN_ANIMATIONS={default:function(e,t){t()},explosion:function(e,t){
cleverapps.audio.playSound(bundles.game.urls.gun_bombing_effect),this.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(t)));var s=new cleverapps.Spine(bundles.game.jsons.gun_json,5);this.addChild(s),s.setPositionRound(this.grid.getPosition()),s.replaceParentSamePlace(cc.director.getRunningScene().scene),s.setCompleteListenerRemove(),s.setAnimation(0,"animation",!1),s.setTimeScale(.5)},byLetter:function(e,t){cleverapps.audio.playSound(bundles.game.urls.gun_bombing_effect),this.runAction(new cc.Sequence(new cc.DelayTime(0),new cc.CallFunc(t))),e.forEach(function(e){var t=this.placeholders[e.row][e.column],s=new cleverapps.Spine(bundles.game.jsons.gun_json);this.letterGrid.addChild(s),s.setAnimation(0,"animation",!1),s.setPositionRound(t.getPosition()),s.setLocalZOrder(-1)}.bind(this))}};var ComicsPlayer=function(e,t){this.stages=e,this.animation=t,this.stage=-1};ComicsPlayer.prototype.onChangeStage=function(){(void 0===this.dialogueStages||this.dialogueStages<1)&&(
this.next(),this.dialogueStages=this.comics.dialogueStages||1),this.dialogueStages--},ComicsPlayer.prototype.next=function(){this.stage++,this.stage>=this.stages.length||(this.comics=this.stages[this.stage],this.runAnimation())},ComicsPlayer.prototype.completeShowAnimation=function(){this.inAnimation&&this.comics.idleAnimation&&(this.animation.setCompleteListener(function(){}),this.inAnimation=!1,this.animation.setAnimation(0,this.comics.idleAnimation,!0))},ComicsPlayer.prototype.runAnimation=function(){this.comics.showAnimation?(this.inAnimation=!0,this.animation.setAnimation(0,this.comics.showAnimation,!1),this.animation.setCompleteListener(this.animation.createListener(this.completeShowAnimation.bind(this)))):(this.inAnimation=!1,this.animation.setAnimation(0,this.comics.idleAnimation,!0))};var ComicsScene=cleverapps.FixedWidthScene.extend({ctor:function(e,t){this._super(cleverapps.Environment.SCENE_COMICS),this.createBg(),this.addFilmEffect();var s=this.dialogue=new Dialogue(
e.dialogue,{autoClose:!0,autoScroll:3}),i=new ComicsPlayer(e.stages,this.createAnimation(e));s.on("afterClose",t),s.on("changedStage",i.onChangeStage.bind(i)),this.runAction(new cc.Sequence(new cc.DelayTime(0),new cc.callFunc(function(){this.createDialogueView(s),s.run()}.bind(this))))},onChangeSize:function(e){this._super(e),this.bg&&this.bg.setScale(this.bg.baseScale/this.scene.scale),this.animationNode.setScale(1/this.scene.scale)},addFilmEffect:function(){var e=cleverapps.styles.ComicsScene,t={scale:1,silent:!0,noControls:!0};e.createFilmEffect&&(t=cleverapps.extend(t,e.createFilmEffect)),this.runAsync(function(){this.createFilmEffect(t)}.bind(this))},createAnimation:function(e){var t=this.animationNode=new cc.Node;t.setAnchorPoint2(),t.setContentSize(this.scene.getContentSize()),t.setPositionRound(this.scene.width/2,this.scene.height/2),this.scene.addChild(t);var s=this.animation=new cleverapps.Spine(e.json);return t.addChild(s),s.setPositionRound(t.width/2,t.height/2),s},
createDialogueView:function(e){var t={overlay:!0,shadow:!1,styles:cleverapps.overrideStyles(cleverapps.styles.DialogueView,cleverapps.styles.ComicsScene.dialogue,!0)};"runes"===cleverapps.config.name&&(t.inner=!0),this.dialogueView=new DialogueView(e,t)},createBg:function(){var e=cleverapps.styles.ComicsScene;if(e.bg){var t=this.bg=new cc.Sprite(e.bg.image);this.scene.addChild(t),t.setPositionRound(this.scene.width/2,this.scene.height/2),this.bg.baseScale=Math.max(this.width/t.width,this.height/t.height),t.setScale(this.bg.baseScale),t.setLocalZOrder(-10)}}});ComicsScene.BUNDLES=function(e){var t=["dialogues"];return e.bundles&&(t=t.concat(e.bundles)),t},ComicsScene.showComics=function(e,t){cleverapps.scenes.replaceScene(new ComicsScene(t,e))},cleverapps.styles.ComicsScene={dialogue:{offsetY:150}};var KeyboardController=function(){this.keyPressed={},cc.eventManager.addListener(cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:this.onKeyPressedHandler.bind(this),
onKeyReleased:this.onKeyReleasedHandler.bind(this)}),2)};KeyboardController.prototype.RETURN_THROTTLE=250,KeyboardController.prototype.THROTTLE_KEYS=[cc.KEY.escape,cc.KEY.back],KeyboardController.prototype.KEYS=[cc.KEY.ctrl,cc.KEY.shift],cleverapps.config.debugMode&&KeyboardController.prototype.KEYS.push(cc.KEY.s,cc.KEY.d,cc.KEY.r,cc.KEY.j,cc.KEY.a,cc.KEY.Delete,cc.KEY.c),KeyboardController.prototype.isPressed=function(e){return this.keyPressed[e]},KeyboardController.prototype.onKeyPressedHandler=function(e){-1!==this.KEYS.indexOf(e)&&(this.keyPressed[e]=!0)},KeyboardController.prototype.onKeyReleasedHandler=function(e){-1!==this.KEYS.indexOf(e)?this.keyPressed[e]=!1:-1!==this.THROTTLE_KEYS.indexOf(e)&&this.returnAction()},KeyboardController.prototype.returnAction=cleverapps.throttle(KeyboardController.prototype.RETURN_THROTTLE,function(){if(window.debug)window.debug.cleanupBorder(),window.debug=void 0;else if(0<cleverapps.windows.list.length){
var e=cleverapps.windows.list[cleverapps.windows.list.length-1];e.closeByBackButton&&e.closeByBackButton()}else{var t=cc.director.getRunningScene();t&&t.closeAction()}});var LanternWindow=Window.extend({onWindowLoaded:function(e,t){var s=this.getStyles();this.mission=e,this.options=t||{},this._super({name:"lanternwindow",title:"messages:LanternWindow.Title",content:this.getContent(),button:{width:s.button.width,height:s.button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)},styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.LanternWindow.window,!0)}),this.onStart()},getStyles:function(){return cleverapps.styles.LanternWindow},onStart:function(){this.mission.isRunning()&&this.addTimer();var e=this.getStyles(),t=this.animation=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json,e.animation.scale);this.picture.addChild(t),t.setPositionRound(this.picture.width/2+e.animation.x,this.picture.height/2+e.animation.y),t.setAnimation(0,
"idle_"+this.mission.logic.lantern.getCurrentStreak(),!0)},getContent:function(){var e=this.getStyles(),t=this.picture=new cc.Node;t.setContentSize(e.bg.width,e.bg.height),t.setAnchorPoint(0,0);var s=new cc.Sprite(bundles.lantern_window.frames.lantern_bg_png);s.setScale(e.bg.scale),s.setAnchorPoint(0,0),t.addChild(s);var i=this.createBonuses();i.setAnchorPoint(0,0),t.addChild(i),i.setPositionRound(e.bonuses);var n=this.createText();return n.setAnchorPoint(0,0),this.content=new cleverapps.Layout([n,t],{margin:e.margin,direction:cleverapps.UI.VERTICAL}),this.content},createBonuses:function(){var p=this.getStyles(),d=cleverapps.values(Lantern.BONUS_TYPES).sort(function(e,t){return LanternWindow.BONUSES_ORDER[e]-LanternWindow.BONUSES_ORDER[t]}),h=Lantern.BONUSES_BY_SERIA[this.mission.logic.lantern.getCurrentStreak()]||{},u=[];return d.forEach(function(e,t){var s=h[e],i=new cc.Scale9Sprite(s?p.bonuses.bonusBg.on:p.bonuses.bonusBg.off);i.setContentSize2(p.bonuses.bonusBg)
;var n=new cc.Sprite(p.bonuses.images[e].image);if(n.setScale(p.bonuses.images[e].scale),i.addChild(n),(i.icon=n).setPositionRound(i.width/2,i.height/2),s){var o=cleverapps.UI.generateTTFText("x"+h[e],cleverapps.styles.FONTS.LANTERN_WINDOW_AMOUNT_TEXT);if(i.addChild(o),o.setPositionRound(p.bonuses.amount),bundles.lantern_window.frames.amountBg){var r=cleverapps.UI.createScale9Sprite(bundles.lantern_window.frames.amountBg,cleverapps.UI.Scale9Rect.TwoPixelXY);r.setContentSize2(p.bonuses.amount.bg),o.addChild(r,-1),r.setPositionRound(p.bonuses.amount.bg)}}else n.setColor(new cc.Color(120,120,120,255));if(u.push(i),t<d.length-1){var a=new cc.Sprite(p.bonuses.arrow.image);if(a.setLocalZOrder(1),u.push(a),p.flashingArrows){var c=cleverapps.styles.COLORS.WHITE,l=cleverapps.styles.COLORS.COLOR_DARK_GRAY;s?h[d[t+1]]||a.runAction(new cc.RepeatForever(new cc.Sequence(new cc.TintTo(.9,l.r,l.g,l.b),new cc.DelayTime(.1),new cc.TintTo(.9,c.r,c.g,c.b),new cc.DelayTime(.1)))):a.setColor(l)}}}.bind(this
)),new cleverapps.Layout(u,{direction:cleverapps.UI.HORIZONTAL,margin:p.bonuses.margin})},createText:function(){var e=this.getStyles(),t=cleverapps.UI.generateTTFText("messages:LanternWindow.text",e.text.font);return t.setDimensions(e.text.width,0),t.fitTo(void 0,e.text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t},addTimer:function(){var e=this.getStyles(),t=new cc.Scale9Sprite(e.timer.bg.image);t.setContentSize2(e.timer.bg);var s={background_content:t,font:cleverapps.styles.FONTS.LANTERN_TIMER_FONT||cleverapps.styles.FONTS.WINDOW_TEXT},i=new cleverapps.CountDownView(new cleverapps.CountDown(this.mission.getTimeLeft(),{onFinish:this.close.bind(this)}),s);this.picture.addChild(i),i.setPositionRound(e.timer)},listBundles:function(){return["windows","lantern_window","lantern"]}});LanternWindow.BONUSES_ORDER={heroes:0,moves:1,multicolor:2},cleverapps.overrideFonts(cleverapps.styles.FONTS,{LANTERN_WINDOW_TEXT:{size:33,color:new cc.Color(130,70,40,255)},
LANTERN_WINDOW_AMOUNT_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:{size:2,color:cleverapps.styles.COLORS.BLACK}}}),cleverapps.styles.LanternWindow={margin:30,bg:{scale:2,width:612,height:532},timer:{x:{align:"center"},y:{align:"top",dy:15},bg:{image:bundles.main.frames.tournamentstory_bg,width:215,height:65}},text:{height:400,width:600,font:cleverapps.styles.FONTS.LANTERN_WINDOW_TEXT},button:{width:220,height:110},animation:{x:0,y:20,scale:1},bonuses:{x:{align:"center"},y:{align:"bottom",dy:5},bonusBg:{width:180,height:180,on:bundles.lantern_window.frames.bonus_bg_on_png,off:bundles.lantern_window.frames.bonus_bg_off_png},arrow:{image:bundles.lantern_window.frames.lantern_arrow_png},offsetY:5,margin:-23,amount:{x:{align:"right",dx:-28},y:{align:"bottom",dy:17}},images:{heroes:{image:bundles.reward_icons.frames.heroes_png,scale:1},moves:{image:bundles.reward_icons.frames.moves_png,scale:1},multicolor:{image:bundles.reward_icons.frames.multicolor_png,scale:1}}},window:{
Border:{y:170}}};var WardrobeWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.wardrobeBundle=bundles[cleverapps.skins.getBundle()||e.feature];var t=cleverapps.styles.WardrobeWindow,s=cleverapps.environment.isGameScene(),i=cleverapps.overrideStyles(cleverapps.styles.Window,{HelpButton:t.HelpButton,bandButton:!0},!0);this._super({name:"wardrobewindow",content:this.generateContent(),styles:i,help:function(){this.close(),new WardrobeRulesWindow(e)}.bind(this),button:{width:t.button.width,height:t.button.height,button_png:t.button.button_png,button_on_png:t.button.button_on_png,text:s?Messages.get("OK"):Messages.get("Play"),onPressed:function(){cleverapps.eventLogger.logEvent(cleverapps.styles.WardrobeWindow.eventName+"_play"+(s?"_ongame":"")),this.close(),cleverapps.metha.distract({focus:"WardrobePlayButtonPressed",action:function(e){cleverapps.metha.wantsToPlay(e)}})}.bind(this)}})},generateUpperBanner:function(e){var t=cleverapps.styles.WardrobeWindow.banner
;this.banner=new cc.Sprite(cleverapps.skins.getSlot("wardrobeWindowBanner"));var s=new ccui.Layout;s.setAnchorPoint2(),s.setPositionRound(t.position.x+e.width/2,e.height+t.position.y),s.setContentSize2(this.banner.width,2*this.banner.height),s.setClippingEnabled(!0),e.addChild(s),this.banner.setPositionRound(s.width/2,this.banner.height/2),s.addChild(this.banner),this.refreshPerson()},refreshPerson:function(){var e=cleverapps.styles.WardrobeWindow.person;this.banner.removeAllChildren();var t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.width,e.height),this.person=new cleverapps.Spine(e.json,e.scale),this.person.setAnimation(0,"idle",!0),t.addChild(this.person),this.person.setPositionRound(t.width/2,t.height/2),this.banner.addChild(t),t.setPositionRound(this.banner.width/2+e.position.x,this.banner.height/2+e.position.y)},refreshStagesScroll:function(){var e=cleverapps.styles.WardrobeWindow.stages;this.stages.removeAllChildren();for(var t=[],s=0;s<WardrobeWindow.stages.length;s++
)t.push(this.generateStageContent(s));var i=new cleverapps.Layout(t,{direction:cleverapps.UI.VERTICAL,margin:e.margin});this.stagesScroll=new cleverapps.UI.ScrollView(i,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_LINEAR}),this.stagesScroll.setContentSize2(e.width,e.height-2*e.padding),this.stagesScroll.setPositionRound(this.stages.width/2,this.stages.height/2),this.stages.addChild(this.stagesScroll);var n=this.mission.logic.getCurrentStage().stage;n>=t.length&&(n=t.length-1),this.needScroll=t[n]},addTimer:function(){var e=this.mission.finishTime()-Date.now();if(!(e<=0)){var t=new cleverapps.CountDown(e,{onFinish:this.close.bind(this)}),s=cleverapps.styles.WardrobeWindow.timer,i={font:s.font,timerPosition:{x:0,y:s.offsetY},regularFontTimerPosition:{x:0,y:s.regularFont.offsetY}};if(s.bg){var n=cleverapps.UI.createScale9Sprite(s.bg.image);n.setContentSize2(s.bg.width,s.bg.height),i.background_content=n}var o=new cleverapps.CountDownView(t,i);this.banner.addChild(o),
o.setPositionRound(s.position)}},generateContent:function(){var e=cleverapps.styles.WardrobeWindow,t=new cc.Node;t.setContentSize2(e.width,e.height),t.setAnchorPoint2(),this.generateUpperBanner(t),this.stages=new cc.Scale9Sprite(e.stages.bg),this.stages.setContentSize2(e.stages.width,e.stages.height);var s=cleverapps.UI.generateOnlyText("messages:WardrobeDescText",cleverapps.styles.FONTS.WINDOW_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(t.width,0),s.fitTo(void 0,e.text.height);var i=new cleverapps.Layout([s,this.stages],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return i.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(i),e.zOrder&&t.setLocalZOrder(e.zOrder),this.refreshStagesScroll(),this.addTimer(),t},scrollToNeedStage:function(e){if(!1!==this.needScroll){var t=this.mission.logic.getCurrentStage().stage;t<WardrobeWindow.stages.length-1&&this.stagesScroll.runAction(new cc.Sequence(
new cc.DelayTime(e),new cc.CallFunc(function(){this.stagesScroll.scrollTo(this.needScroll,.5*(WardrobeWindow.stages.length-1-t)),this.needScroll=!1}.bind(this))))}},onShow:function(){this._super(),this.scrollToNeedStage(.2)},buyDecoration:function(e,t,s){levels.user.takeGold(t)&&(this.close(),this.mission.update(s),cleverapps.eventLogger.logEvent("buy_"+cleverapps.styles.WardrobeWindow.eventName+"_"+(e+1),{amount:t}),cleverapps.eventLogger.logEvent("buy_"+cleverapps.styles.WardrobeWindow.eventName+"_amount_"+(e+1)),this.mission.logic.stageToShow=e+1)},generateStageContent:function(e){var t=cleverapps.styles.WardrobeWindow.stages.stage,s=this.mission.logic.getCurrentStage(),i=0,n=!1,o=!1;s.stage>e?(i=WardrobeWindow.stages[e],n=!0):s.stage==e&&(i=s.progress,o=!0);var r=new cc.Scale9Sprite(t.bg);r.setContentSize2(t.width,t.height),r.setAnchorPoint2();var a=new cc.Node;a.setAnchorPoint2(),a.setContentSize2(r.getContentSize()),a.setPositionRound(r.width/2,r.height/2),
a.setCascadeOpacityEnabled(!0),r.addChild(a);var c=new cc.Sprite(this.wardrobeBundle.frames["stage"+(e+1)+"_icon"]);if(c.setPositionRound(t.icon.position.x,t.icon.position.y+a.height/2),c.setScale(t.icon.scale),a.addChild(c),n&&t.icon.passedMark){var l=new cc.Sprite(t.icon.passedMark.icon);l.setPositionRound(c.x+t.icon.passedMark.position.x,c.y+t.icon.passedMark.position.y),l.setScale(t.icon.passedMark.scale),a.addChild(l)}if(!o){var p=cleverapps.UI.generateOnlyText(n?"messages:WardrobeCompleteText":"messages:WardrobeStageTaskText",cleverapps.styles.FONTS.WINDOW_TEXT,{amount:WardrobeWindow.stages[e]});p.fitTo(t.text.width,0),p.setPositionRound(t.text.position.x,t.text.position.y+a.height/2),p.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),a.addChild(p)}if(o){var d=new cc.Scale9Sprite(t.progress.bg);d.setContentSize2(t.progress.width,t.progress.height),d.setAnchorPoint2(),this.progressBar=new ScaledProgressBar(t.progress.line),this.progressBar.setDimension(
d.width-2*t.progress.padding.x,d.height-2*t.progress.padding.y),this.progressBar.setPositionRound(t.progress.padding.x,t.progress.padding.y),this.progressBar.setPercentage(i/WardrobeWindow.stages[e]*100),d.addChild(this.progressBar);var h=cleverapps.UI.generateOnlyText("messages:WardrobeCurrentText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),h.fitTo(d.width);var u=cleverapps.UI.generateImageText(i+"/"+WardrobeWindow.stages[e],cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);u.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var g=new cleverapps.Layout([u,d,h],{direction:cleverapps.UI.VERTICAL,margin:t.currentDesc.margin});g.setPositionRound(t.currentDesc.position.x,t.currentDesc.position.y+a.height/2),a.addChild(g);var v=new cc.Sprite(bundles.menubar.frames.coin_png);v.setScale(t.button.coin.scale);var m=cleverapps.UI.generateImageText(WardrobeWindow.prices[e],
cleverapps.styles.FONTS.WARDROBE_BUY_BUTTON_TEXT||cleverapps.styles.FONTS.BUTTON_SMALL_TEXT),f=new cleverapps.Layout([m,v],{direction:cleverapps.UI.HORIZONTAL,margin:t.button.margin}),_=new cleverapps.UI.Button({content:f,width:t.button.width,height:t.button.height,padding:t.button.padding,onClicked:function(){this.buyDecoration(e,WardrobeWindow.prices[e],WardrobeWindow.stages[e]-i)}.bind(this),button_png:t.button.button_png,button_on_png:t.button.button_on_png}),y=cleverapps.UI.generateOnlyText("messages:WardrobeBuyText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);y.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),y.setDimensions(t.buttonContainer.width,0),y.fitTo(void 0,t.buttonContainer.height);var w=new cleverapps.Layout([y,_],{direction:cleverapps.UI.VERTICAL,margin:t.buttonContainer.margin});w.setPositionRound(t.buttonContainer.position.x,t.buttonContainer.position.y+a.height/2),a.addChild(w)}var T=WardrobeWindow.prizes[e+1];if(T&&!n){var S=new cc.Node;S.setAnchorPoint2(),
S.setPositionRound(t.present.x,t.present.y),S.setContentSize2(t.present.width,t.present.height);var b=new cleverapps.Spine(t.present.animation.json,t.present.scale);b.setAnimation(0,t.present.animation.animation,!0),t.present.animation.skin&&b.setSkin(t.present.animation.skin),T.skin&&b.setSkin(T.skin),S.addChild(b),b.setPositionRound(S.width/2,S.height/2),cleverapps.tooltipManager.create(S,{rewards:T.prize,text:"messages:WardrobePrizeRewardTitle",position:cleverapps.styles.UI.Tooltip.LOCATION.above}),a.addChild(S,t.present.zOrder?t.present.zOrder:-1)}return n||o||p.setOpacity(80),r}});WardrobeWindow.prototype.listBundles=function(){return["wardrobe_window"]},WardrobeWindow.stages=[1,2,3,4,5,5,5,5,5,5,5,5],WardrobeWindow.prices=[100,150,300,350,650,1e3,1250,1500,2e3,2500,3e3,3500],WardrobeWindow.prizes={4:{prize:{gold:100},skin:"pink"},8:{prize:{gold:300},skin:"blue"},12:{prize:{gold:500},skin:"green"}},cleverapps.styles.WardrobeWindow={eventName:"wardrobe",HelpButton:{x:{align:"left",
dx:64},y:{align:"bottom",dy:64}},CloseButton:{},timer:{font:cleverapps.styles.FONTS.SMALL_WHITE_TEXT,offsetY:-2,regularFont:{offsetY:-2},position:{x:{align:"center",dx:0},y:{align:"bottom",dy:4}},bg:{width:180,height:50,image:bundles.wardrobe_window.frames.progress_bg}},person:{json:bundles.hero.jsons.hero_json,scale:.65,width:200,height:200,position:{x:-80,y:44}},banner:{position:{x:0,y:130}},stages:{bg:bundles.wardrobe_window.frames.window_table_bg,width:596,height:506,padding:14,margin:14,stage:{bg:bundles.main.frames.row_player_png,width:566,height:150,present:{x:160,y:97,iconDelta:20,width:100,height:100,scale:.55,animation:{json:bundles.windows.jsons.present_json,animation:"animation"}},currentDesc:{margin:6,position:{x:270,y:0}},buttonContainer:{width:140,height:60,position:{x:470,y:0},margin:2},button:{width:160,height:74,button_png:bundles.buttons_main.frames.small_green_button,button_on_png:bundles.buttons_main.frames.small_green_button_on,margin:4,coin:{scale:.46}},
progress:{width:200,height:28,padding:{x:2,y:2},bg:bundles.wardrobe_window.frames.progress_bg,line:bundles.wardrobe_window.frames.progress_fill},text:{width:330,position:{x:360,y:0}},icon:{scale:.8,position:{x:80,y:0},passedMark:{icon:bundles.main.frames.goal_done_sign,scale:1,position:{x:60,y:-26}}}}},width:520,height:800,content:{margin:30,position:{x:0,y:-40}},text:{height:180},button:{button_png:bundles.buttons_main.frames.red_button,button_on_png:bundles.buttons_main.frames.red_button_on,width:250,height:100}};var WardrobeReceiveWindow=Window.extend({onWindowLoaded:function(e){this.mission=e;var t=cleverapps.styles.WardrobeReceiveWindow;this._super({name:"wardrobereceivewindow",content:this.generateContent(),closeButton:!1,button:{width:t.button.width,height:t.button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)}})},onShow:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(
bundles.main.urls.reward_window_effect)}.bind(this))))},personAnimation:function(){var e=cleverapps.styles.WardrobeReceiveWindow;this.person.setAnimation(0,e.person.actionAnimation,!1),this.person.setCompleteListener(function(){this.person.setCompleteListener(function(){}),this.person.setAnimation(0,"idle",!0),this.personNode.runAction(new cc.Sequence(new cc.DelayTime(5),new cc.CallFunc(this.personAnimation.bind(this))))}.bind(this))},generateContent:function(){var e=cleverapps.styles.WardrobeReceiveWindow,t=new cc.Node;t.setContentSize2(e.width,e.height),t.setAnchorPoint2(),this.personNode=new cc.Node,this.personNode.setContentSize2(e.personNode.width,e.personNode.height),this.personNode.setAnchorPoint2(),this.person=new cleverapps.Spine(e.person.json,e.person.scale),this.personNode.addChild(this.person),this.person.setPositionRound(e.person.position);var s=cleverapps.UI.generateTTFText("messages:WardrobeRecieveText",cleverapps.styles.FONTS.WINDOW_TEXT);s.setHorizontalAlignment(
cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(t.width,0);var i=new cleverapps.Layout([this.personNode,s],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return i.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(i),this.personAnimation(),t}});WardrobeReceiveWindow.prototype.listBundles=function(){return["wardrobe_window"]},cleverapps.styles.WardrobeReceiveWindow={width:520,height:500,personNode:{width:300,height:500},person:{json:bundles.hero.jsons.hero_json,actionAnimation:"idle_jump",scale:.9,position:{x:{align:"center"},y:{align:"center"}}},content:{margin:50,position:{x:0,y:90}},button:{width:250,height:100}};var WardrobeRulesWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this.wardrobeBundle=bundles[cleverapps.skins.getBundle()||e.feature];var t=cleverapps.styles.WardrobeRulesWindow;this._super({name:"wardroberuleswindow",content:this.generateContent(),button:{width:t.button.width,height:t.button.height,
text:Messages.get("OK")}})},scrollToStage:function(e){var t=0;0<e&&((t=this.stageNodes[this.skin-1].x-this.stagesLayout.width/2)<0&&(t=0),t>this.stagesList.width-this.stagesLayout.width&&(t=this.stagesList.width-this.stagesLayout.width));this.stagesList.runAction(new cc.MoveTo(.3,{x:-t,y:this.stagesList.y}))},updateSkin:function(){void 0===this.skin?this.skin=0:(0!==this.skin&&this.stageNodes[this.skin-1].setOpacity(100),this.skin=(this.skin+1)%(WardrobeWindow.stages.length+1),0!==this.skin&&this.stageNodes[this.skin-1].setOpacity(255)),this.person.setSkin("skin_"+this.skin);var e=cleverapps.styles.WardrobeRulesWindow.states[this.skin];e.mirror?this.personNode.setScaleX(-1):this.personNode.setScaleX(1),this.scrollToStage(this.skin),e.animation&&(this.person.setAnimation(0,e.animation,!1),this.person.setCompleteListener(function(){this.person.setAnimation(0,"idle",!0)}.bind(this))),e.sound&&cleverapps.audio.playSound(e.sound),this.person.runAction(new cc.Sequence(new cc.DelayTime(e.time
),new cc.CallFunc(function(){this.updateSkin()}.bind(this))))},onClose:function(){new WardrobeWindow(this.mission)},generateContent:function(){var e=cleverapps.styles.WardrobeRulesWindow,t=new cc.Node;t.setContentSize2(e.width,e.height),t.setAnchorPoint2();var s=this.personNode=new cc.Node;s.setAnchorPoint2(),s.setContentSize(e.person.width,e.person.height),this.person=new cleverapps.Spine(e.person.json,e.person.scale),this.person.setAnimation(0,"idle",!0),s.addChild(this.person),this.person.setPositionRound(e.person.position),this.stageNodes=[];for(var i=0;i<WardrobeWindow.stages.length;i++){var n=new cc.Sprite(this.wardrobeBundle.frames["stage"+(i+1)+"_icon"]);n.setScale(e.icon.scale),n.setOpacity(100),this.stageNodes.push(n)}this.stagesList=new cleverapps.Layout(this.stageNodes,{direction:cleverapps.UI.HORIZONTAL,margin:e.icon.margin}),this.stagesLayout=new ccui.Layout,this.stagesLayout.addChild(this.stagesList),this.stagesLayout.setClippingEnabled(!0),
this.stagesLayout.setContentSize2(e.icons.width,e.icons.height),this.stagesLayout.setAnchorPoint2(),this.stagesList.setAnchorPoint2(0,.5),this.stagesList.setPositionRound(0,this.stagesLayout.height/2),this.updateSkin();var o=cleverapps.UI.generateTTFText("messages:WardrobeRulesText",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(t.width,0),o.fitTo(void 0,e.text.height);var r=new cleverapps.Layout([o,this.stagesLayout,s],{direction:cleverapps.UI.VERTICAL,margin:e.content.margin});return r.setPositionRound(t.width/2+e.content.position.x,t.height/2+e.content.position.y),t.addChild(r),t}});WardrobeRulesWindow.prototype.listBundles=function(){return["wardrobe_window"]},cleverapps.styles.WardrobeRulesWindow={width:520,height:780,icons:{width:500,height:110},icon:{scale:.55,margin:15},person:{json:bundles.hero.jsons.hero_json,scale:1,width:200,height:260,position:{x:{align:"center"},y:{align:"center"}}},text:{height:260},content:{
margin:30,position:{x:0,y:-40}},button:{width:250,height:100},states:[{time:1,mirror:!1},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:2,mirror:!0},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:2,mirror:!0},{time:1,mirror:!1},{animation:"idle_jump",time:2,mirror:!1},{time:1,mirror:!0},{animation:"idle_jump",time:5,mirror:!0}]};var Favorite=function(e){this.mission=e,this.productId=Favorite.CalcFavorite(),this.product=Product.Create(this.productId),this.product.favorite=!0};Favorite.prototype.getReward=function(){return RewardsConfig.Favorite[this.productId]},Favorite.prototype.isPackProduct=function(){return-1!==Favorite.PACK_PRODUCTS.indexOf(this.productId)},Favorite.CalcFavorite=function(){return cleverapps.paymentsHistory.calcFavoriteProduct(Favorite.ListProducts())},Favorite.ListProducts=function(){return"match3"===cleverapps.config.type||-1!==["scramble",
"tripeaks"].indexOf(cleverapps.config.name)?Favorite.PACK_PRODUCTS.concat(Favorite.COIN_PRODUCTS):Favorite.COIN_PRODUCTS},Favorite.IsAvailable=function(){return void 0!==Favorite.CalcFavorite()},Favorite.PACK_PRODUCTS=["jamPack","tastyPack","honeyPack","epicPack","sweetPack"],Favorite.COIN_PRODUCTS=["gold1800","gold3800","gold6000","gold25000"];var BoostersSale=function(e){this.mission=e,this.reward=void 0,this.onRewardListener=function(){}};BoostersSale.prototype.listProducts=function(){var e=this.mission.productsExpensive;switch(cleverapps.paymentsHistory.classify()){case cleverapps.PaymentsHistory.PAYER_NONE:case cleverapps.PaymentsHistory.PAYER_WEAK:e=this.mission.productsCheap}return e},BoostersSale.prototype.onUpdate=function(){this.mission.result===BoostersSale.PURCHASES_LIMIT&&(this.reward=this.mission.prize,this.onRewardListener(),this.mission.complete())},BoostersSale.PURCHASES_LIMIT=5;var EnergyFeast=function(e,t){this.mission=e,t&&Game.currentGame.pixelsPlanner.restart()},
CoinsFeast=function(e,t){this.mission=e,t&&Game.currentGame.pixelsPlanner.restart()},WardRobeMissionLogic=function(e){this.mission=e,this.refreshSkin(this.mission)};WardRobeMissionLogic.prototype.refreshSkin=function(){var t=void 0;["valentines","xmas","memorial"].forEach(function(e){-1!==cleverapps.eventManager.listCurrentFeatures().indexOf(e)&&(t=e)});var e=t?"wardrobe_"+t:"wardrobe",s=t?bundles[t].jsons.hero_json:bundles.hero.jsons.hero_json,i="skin_"+this.getCurrentStage(this.mission).stage;cleverapps.Spine.updateSkin(e,s,i),cleverapps.user.trigger("heroSkinUpdated",i)},WardRobeMissionLogic.prototype.onUpdate=function(){this.refreshSkin(this.mission)},WardRobeMissionLogic.prototype.skipNext=function(){return this.mission.isRunning()&&this.stageToShow},WardRobeMissionLogic.prototype.getCurrentStage=function(){for(var e=0,t=this.mission.result;t>=WardrobeWindow.stages[e];)t-=WardrobeWindow.stages[e],e++;return e===WardrobeWindow.stages.length?{stage:e,finished:!0}:{stage:e,progress:t
}},WardRobeMissionLogic.prototype.getProgressForStage=function(e){var t=0;return WardrobeWindow.stages.slice(0,e).forEach(function(e){t+=e}),t},WardRobeMissionLogic.prototype.runReceiveDialogue=function(e){for(var t=[],s="WardrobeDialogue.stage"+(this.getCurrentStage().stage-1)+".text",i=0;Messages.has(s+i);i++)t.push({text:Messages.get(s+i)});if(t.length){var n=new Dialogue(t,{showUp:!0}),o=function(){n.stage>=n.data.length-1&&n.close()};n.on("afterClose",e),n.on("buttonClicked",o),n.on("screenClicked",function(){n.typing||o()}),new DialogueView(n,{overlay:!0}),n.run()}else e()},WardRobeMissionLogic.prototype.givePrize=function(e,t){var s=WardrobeWindow.prizes[e];if(s){var i=cleverapps.styles.FONTS.WINDOW_TITLE_TEXT;cleverapps.styles.FONTS.SMALL_TITLE_TEXT&&cleverapps.eventManager.isActive("valentines")&&(i=cleverapps.styles.FONTS.SMALL_TITLE_TEXT),new RewardWindow({title:{text:"messages:WardrobePrizeRewardTitle",font:i},callback:t,reward:s.prize})}else t()},
WardRobeMissionLogic.prototype.processEvent=function(e,t){if(e===Mission.EVENT_LEVEL_FINISH&&this.mission.isRunning()&&(t.level.isRegular()&&t.level.isNew()||t.level.episode.isDailyCup())){var s=this.getCurrentStage().stage;this.mission.update(1);var i=this.getCurrentStage().stage;i!==s&&(this.stageToShow=i)}},WardRobeMissionLogic.IsAvailable=function(){return-1!==["wordsoup","crocword","scramble"].indexOf(cleverapps.config.name)};var LanternMissionLogic=function(e){this.mission=e,this.lantern=new Lantern(e)};LanternMissionLogic.prototype.giveBonus=function(e,t){this.lantern.isActive(t)&&0<this.lantern.getCurrentStreak()?cleverapps.metha.compound(e,[function(e){new LanternView(this.lantern).show(),Game.counter.setTimeout(e,1e3*cleverapps.styles.LanternView.show.delay)}.bind(this),function(e){this.lantern.giveBonus(e)}.bind(this)]):e()},LanternMissionLogic.IsAvailable=function(){return levels.user.checkAvailable(LanternMissionLogic.AVAILABLE)},LanternMissionLogic.AVAILABLE={adventure:{
debugMode:!0}},Mission.EVENT_LEVEL_FINISH=0,Mission.EVENT_COLLECT_BATTLE_PASS_STARS=1,Mission.TYPE_COMBO=0,Mission.TYPE_COLLECT_MARK=1,Mission.TYPE_BURN_NEARBY=2,Mission.TYPE_LETTER=3,Mission.TYPE_TREASURE_SEARCH=7,Mission.TYPE_LANTERN=9,Mission.TYPE_WARDROBE=10,Mission.TYPE_FAVORITE_SALE=11,Mission.TYPE_LIVES_SALE=12,Mission.TYPE_BOOSTERS_SALE=13,Mission.TYPE_COINS_SALE=14,Mission.TYPE_BATTLEPASS=15,Mission.TYPE_STICKERS_COLLECTION=18,Mission.TYPE_BONUS_WORLD=19,Mission.TYPE_ENERGY_FEAST=20,Mission.TYPE_SLOT_MACHINE=21,Mission.TYPE_COINS_FEAST=22,Mission.TYPE_COINS_TIME=23,Mission.TYPE_ENERGY_TIME=24;var Missions={SEMAPHORE_REGULAR:1,SEMAPHORE_SECOND:2,SEMAPHORE_CUSTOM_LANTERN:4,SEMAPHORE_CUSTOM_WARDROBE:8,SEMAPHORE_CUSTOM_SALE:16,SEMAPHORE_CUSTOM_BONUS_WORLD:32,SEMAPHORE_SLAVE:64,initialize:function(){var e={available:{episode:1,level:11,social:!0},view:MissionWindow,duration:"1 day",semaphore:Missions.SEMAPHORE_SECOND,cooldown:"1 minute",startWindow:MissionRulesWindow,
prize:RewardsConfig.Tournament.places};Missions[Mission.TYPE_COMBO]=cleverapps.extend({},e,{available:{episode:2,level:7,social:!0},name:"MagicTournament",icon:bundles.main.frames.clover_png,gameIcon:bundles.game.frames.clover_png,competition:{step:[5,20],amount:[20,30]},bundle:"magic_tournament",sideBarJson:bundles.sidebar.jsons.tournament_magic_icon_json,finishView:MissionWindow}),Missions[Mission.TYPE_COLLECT_MARK]=cleverapps.extend({},e,{available:{episode:1,level:12,social:!0},name:"RoseTournament",icon:bundles.main.frames.rose_png,gameIcon:bundles.game.frames.rose_png,competition:{step:[10,40],amount:[20,30]},bundle:"rose_tournament",sideBarJson:bundles.sidebar.jsons.tournament_rose_icon_json,finishView:MissionWindow,lockedTip:function(e){return Messages.get("UnlockOnLevel",{level:cleverapps.humanReadableNumber(e.episode,e.level)})}}),Missions[Mission.TYPE_BURN_NEARBY]=cleverapps.extend({},e,{available:{episode:2,level:3,social:!0},name:"TulpanTournament",
icon:bundles.main.frames.tulpan_png,gameIcon:bundles.game.frames.tulpan_png,competition:{step:[3,10],amount:[20,30]},bundle:"tulpan_tournament",sideBarJson:bundles.sidebar.jsons.tournament_tulpan_icon_json,finishView:MissionWindow}),Missions[Mission.TYPE_LETTER]=cleverapps.extend({},e,{name:"LetterTournament",icon:bundles.main.frames.mission_letter_png,gameIcon:bundles.game.frames.mission_letter_png,competition:{step:[2,6],amount:[20,30]},cooldown:"2 days",sideBarJson:bundles.sidebar.jsons.mission_letter_icon_json,finishView:MissionWindow,bundle:"letter_tournament",STAR_TYPES_AMOUNT:2}),Missions[Mission.TYPE_TREASURE_SEARCH]=cleverapps.extend({},e,{available:{episode:2,level:7,social:!1},name:"TreasureSearch",view:TreasureSearchWindow,icon:bundles.game.frames.shovel,minigame:{price:1},prize:RewardsConfig.TreasureSearch,startWindow:TreasureSearchWindow,nudgeWindow:TreasureSearchWindow,duration:"3 days",semaphore:Missions.SEMAPHORE_REGULAR,cooldown:"3 days",bundle:"treasuresearch",
sideBarJson:bundles.sidebar.jsons.treasure_search_icon_json}),Missions[Mission.TYPE_STICKERS_COLLECTION]=cleverapps.extend({},e,{available:{episode:2,level:7,social:!0},name:"StickersCollection",view:StickersCollectionWindow,minigame:{price:1},prize:RewardsConfig.StickersCollection,startWindow:StickersCollectionWindow,nudgeWindow:StickersCollectionWindow,duration:"3 days",semaphore:Missions.SEMAPHORE_REGULAR,cooldown:"3 days",bundle:"stickers_collection",sideBarJson:bundles.sidebar.jsons.stickers_collection_icon_json,logic:StickersCollectionLogic,startCurrency:0,tournament:!0}),Missions[Mission.TYPE_LANTERN]=cleverapps.extend({},e,{available:{episode:4,level:3,social:!1},name:"Lantern",view:LanternWindow,duration:"2 day",semaphore:Missions.SEMAPHORE_CUSTOM_LANTERN,cooldown:"5 days",startWindow:LanternWindow,sideBarJson:bundles.sidebar.jsons.lantern_icon_json,iconForce:Forces.LANTERN,logic:LanternMissionLogic,prize:void 0}),Missions[Mission.TYPE_WARDROBE]=cleverapps.extend({},e,{
available:{episode:1,level:11,social:!1},name:"Wardrobe",view:WardrobeWindow,semaphore:Missions.SEMAPHORE_CUSTOM_WARDROBE,startWindow:WardrobeRulesWindow,logic:WardRobeMissionLogic,sideBarJson:bundles.sidebar.jsons.wardrobe_icon_json,feature:"wardrobe"}),Missions[Mission.TYPE_FAVORITE_SALE]=cleverapps.extend({},e,{priority:5,name:"FavoriteSale",view:FavoriteSaleWindow,semaphore:Missions.SEMAPHORE_CUSTOM_SALE,startWindow:FavoriteSaleWindow,logic:Favorite,sideBarJson:bundles.sidebar.jsons.lives_sale_icon_json,prize:RewardsConfig.Sale,feature:"favorite"}),Missions[Mission.TYPE_LIVES_SALE]=cleverapps.extend({},e,{name:"LivesSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_CUSTOM_SALE,startWindow:BoostersSaleWindow,logic:BoostersSale,sideBarJson:bundles.sidebar.jsons.lives_sale_icon_json,prize:RewardsConfig.Sale,feature:"lives",productsCheap:["unlimitedLives05","lives074","exp1"],productsExpensive:["unlimitedLives2","lives3","exp4"],available:{episode:1,level:1}}),-1!==["tripeaks"
,"scramble"].indexOf(cleverapps.config.name)&&(Missions[Mission.TYPE_FAVORITE_SALE].sideBarJson=bundles.sidebar.jsons.favorite_sale_icon_json),"match3"!==cleverapps.config.type&&(Missions[Mission.TYPE_LIVES_SALE].productsCheap=cleverapps.substract(Missions[Mission.TYPE_LIVES_SALE].productsCheap,["exp1"]),Missions[Mission.TYPE_LIVES_SALE].productsExpensive=cleverapps.substract(Missions[Mission.TYPE_LIVES_SALE].productsExpensive,["exp4"])),Missions[Mission.TYPE_BOOSTERS_SALE]=cleverapps.extend({},e,{name:"BoostersSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_CUSTOM_SALE,startWindow:BoostersSaleWindow,sideBarJson:bundles.sidebar.jsons.boosters_sale_icon_json,logic:BoostersSale,prize:RewardsConfig.Sale,feature:"boosters",productsCheap:["cellPack05","linePack074","colorPack10"],productsExpensive:["cellPack2","linePack3","colorPack4"],available:{episode:1,level:1}}),"stacks"===cleverapps.config.subtype&&(Missions[Mission.TYPE_BOOSTERS_SALE].productsCheap=[
"hintBoosterBeforePack3","eyePack2","highlightPack1"],Missions[Mission.TYPE_BOOSTERS_SALE].productsExpensive=["hintBoosterBeforePack3","eyePack2","highlightPack1"]),Missions[Mission.TYPE_COINS_SALE]=cleverapps.extend({},e,{name:"CoinsSale",view:BoostersSaleWindow,semaphore:Missions.SEMAPHORE_CUSTOM_SALE,startWindow:BoostersSaleWindow,sideBarJson:bundles.sidebar.jsons.coins_sale_icon_json,logic:BoostersSale,prize:RewardsConfig.Sale,feature:"coins",productsCheap:["gold500sale","gold1800sale"],productsExpensive:["gold500sale","gold1800sale"],available:{episode:1,level:1}}),Missions[Mission.TYPE_BONUS_WORLD]=cleverapps.extend({},e,{name:"BonusWorld",startWindow:void 0,view:BonusWorldScene,semaphore:Missions.SEMAPHORE_CUSTOM_BONUS_WORLD,available:{episode:1,level:14},logic:BonusWorldMissionLogic,sideBarJson:function(e){return BonusWorldConfig[e.bonusWorld.type].sideBarJson},feature:"bonusworld",oncePerEvent:!cleverapps.config.debugMode,iconForce:Forces.BONUS_WORLD}),
void 0!==EnergyFeastMissionWindow&&(Missions[Mission.TYPE_ENERGY_FEAST]=cleverapps.extend({},e,{available:{level:5},priority:5,name:"EnergyFeast",duration:"3 day",cooldown:"1 month",semaphore:Missions.SEMAPHORE_REGULAR,competition:{step:[3,3,3,5,5,5,10,10,15,20,25],forceCoef:.45,amount:[20,30],noPlayerEpisodeCoef:!0,botAheadPlayerCoef:.5,botAheadPlayerBigDifferenceCoef:.2,bigDistanceLength:100},logic:EnergyFeast,prize:RewardsConfig.EnergyFeast.places,bundle:"energy_feast",icon:bundles.reward_icons.frames.reward_energy_png,sideBarJson:bundles.sidebar.jsons.energy_feast_icon_json,view:EnergyFeastMissionWindow,startWindow:EnergyFeastMissionWindow,finishView:EnergyFeastMissionWindow})),void 0!==EnergyTimeMissionWindow&&(Missions[Mission.TYPE_ENERGY_TIME]=cleverapps.extend({},e,{available:{level:7},name:"EnergyTime",duration:"1 day",cooldown:"1 month",semaphore:Missions.SEMAPHORE_SLAVE,bundle:"energy_time",sideBarJson:bundles.sidebar.jsons.energy_time_icon_json,view:EnergyTimeMissionWindow,
startWindow:EnergyTimeMissionWindow,finishView:EnergyTimeMissionWindow})),void 0!==CoinsFeastMissionWindow&&(Missions[Mission.TYPE_COINS_FEAST]=cleverapps.extend({},e,{available:{level:5},priority:3,name:"CoinsFeast",duration:"3 day",cooldown:"1 month",semaphore:Missions.SEMAPHORE_REGULAR,competition:{step:[5,50],forceCoef:.3,amount:[20,30],noPlayerEpisodeCoef:!0,botAheadPlayerCoef:.5,botAheadPlayerBigDifferenceCoef:.2,bigDistanceLength:500},logic:CoinsFeast,prize:RewardsConfig.CoinsFeast.places,bundle:"energy_feast",icon:bundles.reward_icons.frames.reward_coin_png,sideBarJson:bundles.sidebar.jsons.coins_feast_icon_json,view:CoinsFeastMissionWindow,startWindow:CoinsFeastMissionWindow,finishView:CoinsFeastMissionWindow})),void 0!==CoinsTimeMissionWindow&&(Missions[Mission.TYPE_COINS_TIME]=cleverapps.extend({},e,{available:{level:5},priority:3,name:"CoinsTime",duration:"3 day",cooldown:"1 month",semaphore:Missions.SEMAPHORE_SLAVE,bundle:"coins_time",
sideBarJson:bundles.sidebar.jsons.coins_time_icon_json,view:CoinsTimeMissionWindow,startWindow:CoinsTimeMissionWindow,finishView:CoinsTimeMissionWindow,canCreate:function(){return cleverapps.missionManager.findByType(Mission.TYPE_COINS_FEAST)}})),Missions[Mission.TYPE_BATTLEPASS]=cleverapps.extend({},e,{priority:4,name:"BattlePass",view:BattlePassWindow,semaphore:Missions.SEMAPHORE_REGULAR,icon:bundles.game.frames.battle_pass_icon_png,startWindow:BattlePassWindow,finishView:BattlePassWindow,logic:BattlePassMissionLogic,sideBarJson:bundles.sidebar.jsons.battlepass_icon_json,sideBarProgressIconJson:bundles.sidebar.jsons.battle_pass_star_json,levels:BattlePass.LEVELS,eventType:Mission.EVENT_COLLECT_BATTLE_PASS_STARS,lastChanceView:BattlePassLastChanceWindow,cooldown:"1 month",duration:"7 days",available:{episode:7,level:0}}),"merge"===cleverapps.config.type&&(Missions[Mission.TYPE_BATTLEPASS].available={level:5}),Missions[Mission.TYPE_SLOT_MACHINE]=cleverapps.extend({},e,{
name:"SlotMachine",startWindow:void 0,view:SlotMachineScene,semaphore:Missions.SEMAPHORE_REGULAR,available:{episode:1,level:14},logic:SlotMachineMissionLogic,sideBarJson:bundles.sidebar.jsons.slot_machine_json,feature:"slotmachine",iconForce:Forces.SLOT_MACHINE_ICON}),"olympics"===cleverapps.config.name&&cleverapps.override(Missions[Mission.TYPE_LIVES_SALE],{productsCheap:["unlimitedLives05","lives074","gold1"],productsExpensive:["unlimitedLives2","lives3","gold4"],sideBarJson:bundles.sidebar.jsons.lives_sale_json}),"match3"===cleverapps.config.type&&(Missions[Mission.TYPE_BONUS_WORLD].available={episode:5,level:10})}},CurrentEpisodeLabel=cc.Node.extend({ctor:function(e,t){this._super(),this.episode=e,this.createContent(),this.setAnchorPoint2(),this.setPositionRound({x:{align:"center"},y:{align:"center"}}),this.setLocalZOrder(1)},createContent:function(){this.bg=this.createBg();var e=this.label=new cc.Node;e.setAnchorPoint2(),e.setContentSize2(this.bg.getContentSize()),e.addChild(
this.bg),e.setPositionRound(cleverapps.styles.CurrentEpisodeLabel.label.alignment),this.addLabelText(),this.setContentSize2(e.getContentSize()),this.addChild(this.label)},createBg:function(){var e,t=cleverapps.styles.CurrentEpisodeLabel.background;if(t.json){(e=new cc.Node).setAnchorPoint2(),e.setContentSize2(t);var s=this.bgAnimation=new cleverapps.Spine(t.json);s.setAnimation(0,"idle",!1),s.setPosition(e.width/2,e.height/2),e.addChild(s)}else e=cleverapps.UI.createScale9Sprite(t.image,cleverapps.UI.Scale9Rect.TwoPixelXY),t.width&&e.setContentSize2(t);return e.setPosition(e.width/2,e.height/2),e},addLabelText:function(){var e=cleverapps.styles.CurrentEpisodeLabel.label.islandText,t=this.labelText=cleverapps.UI.generateTTFText("messages:StartEpisodeWindow.Title"+this.episode.episodeNo,e.font);t.fitTo(this.bg.width+e.padding),t.setPositionRound(e.alignment),this.label.addChild(t)},addLevelsLabel:function(){var e=cleverapps.styles.CurrentEpisodeLabel.label.levelsText;if(e){
var t=this.episode.levels.filter(function(e){return e.type===Episode.LEVEL_TYPE_PASSED}).length,s=this.episode.levels.length,i=cleverapps.UI.generateTTFText(t+"/"+s,e.font);i.setPositionRound(e.alignment),this.label.addChild(i)}}});cleverapps.MiniGame=function(e){cleverapps.config.debugMode&&(cleverapps.MiniGame.TIMEOUT="60 seconds"),cleverapps.DailyChest.call(this,{isNewUser:e,serverTaskName:"bonuses",interval:cleverapps.parseInterval(cleverapps.MiniGame.TIMEOUT)}),this.closedText="messages:MiniGame.ClosedText"},cleverapps.MiniGame.prototype=Object.create(cleverapps.DailyChest.prototype),cleverapps.MiniGame.prototype.constructor=cleverapps.MiniGame,cleverapps.MiniGame.prototype.initializeForNewUser=function(){this.locked=!1,this.setWhenUnlock(Date.now())},cleverapps.MiniGame.TIMEOUT="1 day",cleverapps.MiniGame.prototype.resetUnlockCountdown=function(){cleverapps.DailyChest.prototype.resetUnlockCountdown.call(this),cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.MINI_GAME,
this.when-Date.now())},cleverapps.MiniGame.prototype.refreshItems=function(){},cleverapps.MiniGame.prototype.isAvailable=function(){return!!levels.user.checkAvailable(cleverapps.MiniGame.AVAILABLE)&&!this.locked},cleverapps.MiniGame.prototype.getReward=function(){cleverapps.history.add("drwrd",1);var e=cleverapps.Random.choose(RewardsConfig.MiniGame);return levels.user.isBeginner()&&RewardsConfig.MiniGameBeginner&&(e=cleverapps.Random.choose(RewardsConfig.MiniGameBeginner)),levels.user.isNovice()&&RewardsConfig.MiniGameNovice&&(e=cleverapps.Random.choose(RewardsConfig.MiniGameNovice)),e.betGold&&delete e.betGold,e=cleverapps.user.prepareRewardByRich(e)},cleverapps.MiniGame.prototype.openWindow=function(e){if(cleverapps.periodicBonus.locked)cleverapps.Notification.create(cleverapps.periodicBonus.closedText),e&&e();else{var t=cleverapps.clone(cleverapps.periodicBonus.getReward(),!0);new MiniGameWindow(t),e&&(cleverapps.metha.onceNoWindowsListener=e)}},cleverapps.MiniGame.AVAILABLE={
episode:1,level:1,registered:"1 hour"};var MiniGameWindow=Window.extend({onWindowLoaded:function(e){this.reward=e;var n=cleverapps.styles.MiniGameWindow,o=this.content=new cc.Node;o.setAnchorPoint(.5,.5),o.setContentSize2(n.width,n.height),this.createText(),this.boxes=[],n.boxes.reverse().forEach(function(e,t){var s=new cc.Node;s.setAnchorPoint(.5,.5),s.setContentSize2(n.box),s.setPositionRound(o.width/2+e.x,o.height/2+e.y),s.setScale(n.box.scale),s.baseScale=n.box.scale;var i=s.animation=new cleverapps.Spine(n.animation.json);s.addChild(i),e.skin&&i.setSkin(e.skin),i.setPositionRound(s.width/2-n.box.offsetX,s.height/2-n.box.offsetY),i.setAnimation(0,e.name||"animation",!0),o.addChild(s),this.onMouseOver&&(s.onMouseOver=this.onMouseOver.bind(this,s)),this.onMouseOut&&(s.onMouseOut=this.onMouseOut.bind(this,s)),cleverapps.UI.applyHover(s),cleverapps.UI.onClick(s,this.onPressed.bind(this,s),{noThrottle:n.noThrottle}),this.boxes.push(s)},this);var t=cleverapps.overrideStyles(
cleverapps.styles.Window,cleverapps.styles.MiniGameWindow.window,!0);this._super({title:this.getTitle(),name:"minigamewindow",content:o,closeButton:!1,notCloseByTouchInShadow:!0,styles:t,shareCheckBox:this.getShareOptions(),buttons:this.getButtons()}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getTitle:function(){return"messages:MiniGameWindow.Title"},createText:function(){var e=cleverapps.styles.MiniGameWindow,t=cleverapps.UI.generateTTFText("messages:MiniGameWindow.Text",cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2+e.text.x,this.content.height/2+e.text.y),this.content.addChild(t),this.text=t},getShareOptions:function(){},onShow:function(){this.showUpAnimation(),this.isOpened||this.setCustomCursor()},onHide:function(){this.boxes&&this.boxes.forEach(function(e){e.stopAllActions()}),this.text&&this.text.stopAllActions(),this.hint&&(this.hint.removeFromParent(),delete this.hint),this.setDefaultCursor()},close:function(){
this.hint&&this.hint.close(),this._super()},onClose:function(){this.setDefaultCursor()},showUpAnimation:function(){var e=this.boxes,s=e.map(function(e){return e.getPosition()}),i=[[2,0,1],[0,2,1],[1,0,2]];this.text.scale=0,e.forEach(function(e,t){e.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.MoveTo(.3,s[i[0][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(bundles.main.urls.daily_game_mix_effect)}),new cc.MoveTo(.3,s[i[1][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(bundles.main.urls.daily_game_mix_effect)}),new cc.MoveTo(.3,s[i[2][t]]),new cc.DelayTime(.1),new cc.CallFunc(function(){0===t&&cleverapps.audio.playSound(bundles.main.urls.daily_game_mix_effect)}),new cc.MoveTo(.3,s[t]),new cc.DelayTime(.3),new cc.CallFunc(function(){0===t&&this.text.runAction(new cc.ScaleTo(1,1).easing(cc.easeBackOut()))}.bind(this))))},this)},setDefaultCursor:function(){
!cc.sys.isNative&&cleverapps.styles.MiniGameWindow.customCursor&&(cc._canvas.style.cursor="default",this.onMouseMoveListener&&(cc.eventManager.removeListener(this.onMouseMoveListener),delete this.onMouseMoveListener,this.cursor&&(this.cursor.removeFromParent(!0),delete this.cursor)))},setCustomCursor:function(){!cc.sys.isNative&&cleverapps.styles.MiniGameWindow.customCursor&&"mouse"in cc.sys.capabilities&&(this.onMouseMoveListener=cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseMove:function(e){return this.cursor||(cc._canvas.style.cursor="none",this.cursor=new cc.Sprite(bundles.daily_minigame_window.frames.daily_game_cursor_png),this.cursor.setAnchorPoint2(0,1),this.cursor.setLocalZOrder(10),this.window.addChild(this.cursor)),this.cursor.setPositionRound(this.window.convertToNodeSpace(e.getLocation())),!0}.bind(this)},this.window))},onPressed:function(e){new MiniGameRewardWindow(this.reward),this.close()},getButtons:function(){var e=cleverapps.styles.MiniGameWindow
;if(!e.button)return[];var t=this.okButton=new cleverapps.UI.Button({text:Messages.get("OK"),font:cleverapps.styles.FONTS.BUTTON_TEXT,width:e.button.width,height:e.button.height,onClicked:function(){this.close(),this.receiveReward()}.bind(this)});return t.setVisible(!1),[t]}});MiniGameWindow.prototype.listBundles=function(){return["reward_icons","daily_minigame_window"]},cleverapps.styles.MiniGameWindow={width:500,height:300,text:{x:0,y:-200},box:{width:150,height:150,scale:1,offsetX:0,offsetY:0},boxes:[{x:-180,y:-50,skin:"green",name:"animation"},{x:0,y:50,skin:"blue",name:"animation"},{x:180,y:-50,skin:"pink",name:"animation"}],animation:{json:bundles.windows.jsons.present_json},window:{decors:{}},noThrottle:!1};var MiniGameRewardWindow=RewardWindow.extend({ctor:function(e){this._super({reward:e})},onWindowLoaded:function(e){this._super({title:"messages:MiniGameRewardWindow.title",name:"minigamerewardwindow",buttonText:"OK",reward:e.reward,text:"messages:MiniGameRewardWindow.text",
rewardName:"miniGame"})},onReceiveReward:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.DAILY_BONUS)},receiveReward:function(){cleverapps.periodicBonus.locked||(cleverapps.periodicBonus.open(),this.onReceiveReward(),cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.RECEIVE_PERIODIC_BONUS),cleverapps.Chest.prototype._receiveReward(this.reward))},getButtons:function(){var e=this.getDoubleButton();return e?[e]:[]}});cleverapps.styles.MiniGameRewardWindow={padding:{x:200,y:0}},cleverapps.UI.Tooltip=cc.Node.extend({ctor:function(e,t){this._super();var s=cleverapps.styles.UI.Tooltip,i=t.size||s.SIZE.medium;if(t.rewards?this.setContentSize2(i.width+s.rewards.extraWidth,i.height+s.rewards.extraHeight):this.setContentSize2(i),this.setAnchorPoint2(),this.bg=new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_bg_png),this.addChild(this.bg),this.bg.setPositionRound(this.width/2,this.height/2),this.bg.setContentSize2(this.getContentSize()),void 0===t.arrow&&(
t.arrow=t.position===s.LOCATION.below?s.ARROW.top:s.ARROW.bottom),this.drawArrow(t.arrow),t.content){this.content=t.content,this.bg.addChild(this.content);var n=Math.min(this.width/(this.content.width*this.content.scaleX+s.content.padding),this.height/(this.content.height*this.content.scaleY+s.content.padding));n<1&&this.content.setScale(this.content.scaleX*n,this.content.scaleY*n),this.content.setPositionRound(this.width/2,this.height/2+s.content.offset.y)}else{var o=cleverapps.UI.generateOnlyText(t.text,cleverapps.styles.FONTS.TOOLTIP_TEXT);o.fitTo(this.width-s.content.padding);var r=o;if(t.rewards){var a=new TooltipRewardsView(t.rewards);r=new cleverapps.Layout([a,o],{direction:cleverapps.UI.VERTICAL,margin:s.rewards.margin})}r.setPositionRound(this.width/2,this.height/2+s.content.offset.y),this.bg.addChild(r)}t.control?cleverapps.metha.registerControl(t.control,function(e){e?this.show():this.hide()}.bind(this)):this.show(),this.target=e},hide:function(){this.stopAllActions()
;var e=.2*this.scale;this.runAction(new cc.Sequence(new cc.ScaleTo(e,0),new cc.CallFunc(function(){this.content&&this.content.removeFromParent()}.bind(this)),new cc.RemoveSelf))},show:function(){this.stopAllActions(),this.setScale(.2),this.runAction(new cc.Sequence(new cc.CallFunc(function(){this.x-this.width/2<0&&(this.bg.x+=this.width/2-this.x+cleverapps.styles.UI.Tooltip.bgPadding),this.x+this.width/2>cc.director.getRunningScene().width&&(this.bg.x-=this.width/2-cc.director.getRunningScene().width+this.x+cleverapps.styles.UI.Tooltip.bgPadding)}.bind(this)),new cc.ScaleTo(.1,1))),this.runAction(new cc.Sequence(new cc.DelayTime(4),new cc.CallFunc(function(){this.hide()}.bind(this))))},drawArrow:function(e){var t=e===cleverapps.styles.UI.Tooltip.ARROW.bottom?new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_shadow_arrow_png):new cc.Scale9Sprite(bundles.tooltip.frames.tooltip_arrow_png);this.addChild(t),t.setRotation(e.rotation),t.setPositionRound(e)}}),cleverapps.styles.UI.Tooltip={
content:{padding:20,offset:{y:-4}},bgPadding:10,rewards:{extraWidth:0,extraHeight:110,margin:10},SIZE:{short:{width:360,height:100},medium:{width:480,height:100},long:{width:600,height:100}},LOCATION:{above:{x:{align:"center",dx:0},y:{align:"top",dy:60},rewards:{x:{align:"center",dx:0},y:{align:"top",dy:120}}},below:{x:{align:"center",dx:0},y:{align:"bottom",dy:-72},rewards:{x:{align:"center",dx:0},y:{align:"bottom",dy:-142}}}},ARROW:{top:{x:{align:"center",dx:0},y:{align:"top",dy:20},rotation:180},bottom:{x:{align:"center",dx:0},y:{align:"bottom",dy:-16},rotation:0},left:{x:{align:"left",dx:-22},y:{align:"center",dy:0},rotation:90},right:{x:{align:"right",dx:22},y:{align:"center",dy:0},rotation:-90}}};var TooltipManager=function(){this.active=void 0;var e=cc._EventListenerTouchOneByOne.create();if(e.onTouchBegan=function(){this.onClick()}.bind(this),cc.eventManager.addListener(e,-1),"mouse"in cc.sys.capabilities){var t=cc._EventListenerMouse.create();t.onMouseScroll=function(){
this.onClick()}.bind(this),cc.eventManager.addListener(t,-1)}};TooltipManager.prototype.create=function(s,i){s.tooltipListener&&this.remove(s),s.tooltipListener=cleverapps.UI.onClick(s,function(e){if(s.isDisplayed()){if(cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce(),i.clickableArea){var t=i.clickableArea.convertToNodeSpace(s.convertToWorldSpace(e));cc.rectContainsPoint(cc.rect(0,0,i.clickableArea.width,i.clickableArea.height),t)&&cleverapps.tooltipManager.onClick(s,i)}else cleverapps.tooltipManager.onClick(s,i);i.hideHandler&&i.hideHandler.postponeHiding(4e3)}},{noThrottle:!0,swallowTouches:i.swallowTouches,ignoreOnTouchMoved:i.ignoreOnTouchMoved,ignoreOnTouchMovedThreshold:i.ignoreOnTouchMovedThreshold,useInteractiveScale:i.useInteractiveScale})},TooltipManager.prototype.remove=function(e){e.tooltipListener&&(cc.eventManager.removeListener(e.tooltipListener),delete e.tooltipListener)},TooltipManager.prototype.onClick=cleverapps.accumulate(0,function(e,t){if(
e||this.active){var s=this.active&&this.active.target,i=e&&s!==e;this.hide(),i&&this.show(e,t||{})}}),TooltipManager.prototype.show=function(e,t){var s=new cleverapps.UI.Tooltip(e,t);e.addChild(s),s.setPositionRound(t.rewards?t.position.rewards:t.position),s.replaceParentSamePlace(cc.director.getRunningScene()),s.registerCleanupCallback(function(){this.active===s&&delete this.active}.bind(this)),this.active=s},TooltipManager.prototype.hide=function(){this.active&&this.active.hide()};var TooltipRewardsView=cleverapps.Layout.extend({ctor:function(e){var o=cleverapps.styles.TooltipRewardsView,t=[];for(key in e.boosters)t.push({text:e.boosters[key],icon:o.boosters.icons[key]});e.unlimitedLives&&t.push({text:Product.FormatUnlimitedLives(e.unlimitedLives,!0).title,icon:bundles.reward_icons.frames.life_unlim_small,scale:o.unlimitedLives.scale,toReplace:{amount:e.unlimitedLives.amount}}),e.gold&&t.push({text:e.gold,icon:bundles.reward_icons.frames.gold_small_png,iconDy:o.goldIconDy}),
e.exp&&t.push({text:e.exp,icon:bundles.reward_icons.frames.reward_exp_png}),e.stars&&t.push({text:e.stars,icon:bundles.reward_icons.frames.stars_png});var s=t.map(function(e){var t=cleverapps.UI.generateTTFText(e.text,cleverapps.styles.FONTS.TOOLTIP_FONT,e.toReplace);o.textHeight&&t.fitTo(void 0,o.textHeight);var s=new cc.Sprite(e.icon);if(e.iconDy){var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(s.getContentSize()),i.addChild(s),s.setPositionRound(i.width/2,i.height/2+e.iconDy),s=i}s.setScale(o.iconHeight/s.height*(e.scale?e.scale:1));var n=new cleverapps.Layout([t,s],{direction:cleverapps.UI.VERTICAL,margin:o.textMargin});return n.setAnchorPoint2(.5,1),n});this._super(s,{direction:cleverapps.UI.HORIZONTAL,margin:o.margin,align:o.align})}});cleverapps.styles.TooltipRewardsView={iconHeight:60,margin:30,textMargin:0,unlimitedLives:{scale:.95}};var Exclamation=function(){this.onShowListener=function(e){},this.onHideListener=function(){}};Exclamation.prototype.show=function(e,t){
this.enabled&&this.onShowListener(e,t)},Exclamation.prototype.setGame=function(e){this.game=e,this.game.onChangeOutcomeListeners.exclamation=this.disable.bind(this),this.enabled=!0},Exclamation.prototype.disable=function(){this.enabled&&(this.enabled=!1,delete this.game,this.onHideListener())},Exclamation.prototype.createView=function(){return-1!==["heroes","runes","mergeheroes"].indexOf(cleverapps.config.name)?new EXCLAMATIONS.heroes:-1!==["board","solitaire","differences"].indexOf(cleverapps.config.type)?new EXCLAMATIONS.words:-1!==["adventure"].indexOf(cleverapps.config.name)?new EXCLAMATIONS.actor:new EXCLAMATIONS.base},Exclamation.prototype.getCongratulations=function(){return-1!==["heroes","runes","mergeheroes"].indexOf(cleverapps.config.name)?["wow","super","yay","yeah","ohyeah","oh"]:Messages.get("congratulations")};var EXCLAMATIONS={base:cc.Node.extend({ctor:function(){this._super();var e=this.getStyles();this.setAnchorPoint2(),this.setContentSize2(e),e.scale&&this.setScale(
e.scale[cleverapps.wideMode.mode]),cleverapps.exclamation.onShowListener=this.createListener(cleverapps.throttle(1e3,this.showMessage.bind(this))),cleverapps.exclamation.onHideListener=this.createListener(this.hideMessage.bind(this))},showMessage:function(e,t){var s=bundles.game.urls.keep_going_effect,i="keep_going_letsgo",n=cleverapps.styles.FONTS.MESSAGE_TEXT_NORMAL;switch(t){case FieldView.MESSAGE_WARNING:i="5_moves_left",s=bundles.game.urls.five_moves_effect,n=cleverapps.styles.FONTS.MESSAGE_TEXT_WARNING;break;case FieldView.MESSAGE_CONGRATS:i="you_win",s=bundles.main.urls.beat_friend_effect,n=cleverapps.styles.FONTS.MESSAGE_TEXT_CONGRATS}this.runActions(e,n,s,i)},hideMessage:function(){this.setVisible(!1)},runActions:function(e,t,s,i){this.createAnimation(i),this.createMsg(e,t),this.playSound(s)},playSound:function(e){if(e){var t=this.getStyles().sound?this.getStyles().sound.delay:0;this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){
cleverapps.audio.playSound(e)})))}},createMsg:function(e,t){var s=this.createText(e,t);s.opacity=0,s.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.FadeIn(.2),new cc.Spawn(new cc.MoveBy(.1,0,-2),new cc.ScaleTo(.1,1,.9)),new cc.ScaleTo(.25,1,1),new cc.DelayTime(.3),new cc.FadeOut(.2),new cc.RemoveSelf))},createText:function(e,t){var s=cleverapps.UI.LabelTTF.GetLocalizedText(e),i=cleverapps.UI.generateTTFText(e,t);return-1!==s.indexOf(" ")?i.setDimensions(this.width,0):i.fitTo(this.width),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setPositionRound(this.width/2,this.height/2),this.addChild(i),i},createAnimation:function(e){this.animation||(this.animation=new cleverapps.Spine(bundles.exclamations.jsons.animation),this.animation.setPositionRound(this.width/2,this.height/2),this.addChild(this.animation)),this.animation.setAnimation(0,e,!1)},getStyles:function(){return cleverapps.styles.Exclamations.base}})};EXCLAMATIONS.heroes=EXCLAMATIONS.base.extend({getStyles:function(){
return cleverapps.styles.Exclamations.heroes},showMessage:function(e,t){var s=this.getStyles(),i="messages:message.YouWin"===e?res.sound_win_effect:bundles.game.urls.keep_going_effect,n=cleverapps.styles.FONTS.CONGRATS_MESSAGE_FONT,o=s[e];o?n.color=o.color:t===FieldView.MESSAGE_WARNING?n.color=s.warning.color:n.color=s.default.color;var r="lets_go";-1!==cleverapps.exclamation.getCongratulations().indexOf(e)?(i=bundles.game.urls[e+"_effect"],e="messages:message."+(r=e)):"messages:message.KeepGoing"===e?i=bundles.game.urls.go_on_effect:"messages:message.Shuffle"===e&&(r="shuffle",i=bundles.game.urls.shuffle_effect),this.runActions(e,n,i,r)},createMsg:function(e,t){var s=this.createText(e,t);s.setRotation(10);s.setScale(.1),s.setVisible(!1),s.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.Show,new cc.ScaleTo(.3,1).easing(cc.easeInOut(3)),new cc.DelayTime(.55),new cc.ScaleTo(.3,.1),new cc.RemoveSelf))}}),EXCLAMATIONS.words=EXCLAMATIONS.base.extend({getStyles:function(){
return cleverapps.styles.Exclamations.base},showMessage:function(e){this.runActions(e,void 0,void 0,"animation")},createMsg:function(e){e=Messages.getLocalized(e);var t=this.splitTextToLines(e).map(this.createLine.bind(this)),s=new cleverapps.Layout(t.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.length&&t[0].height/10||0});s.setCascadeOpacityEnabled(!0),s.setOpacity(0),s.setScale(0),s.setPositionRound(this.width/2,this.height/2),this.addChild(s);var i=1,n=cc.director.getRunningScene();s.width>n.scene.width&&(i=n.scene.width/(1.2*s.width)),this.setVisible(!0),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(1.4),new cc.Hide)),s.runAction(new cc.Spawn(new cc.FadeIn(.25),new cc.Sequence(new cc.ScaleTo(.2,1.4*i,1.4*i),new cc.ScaleTo(.2,.8*i,.8*i),new cc.ScaleTo(1,i,i)),new cc.Sequence(new cc.DelayTime(1.2),new cc.FadeOut(.2),new cc.RemoveSelf)))},createLine:function(e){var t=new cc.Node;t.setAnchorPoint(.5,.5);for(var s=0,i=0,n=this.splitLineToBlocks(e),
o=0;o<n.length;o++){var r=cleverapps.UI.generateOnlyText(n[o],cleverapps.styles.FONTS.CONGRATE_TEXT);t.addChild(r);var a=Math.abs(o-n.length/2),c=1-.2/n.length*a,l=.2+.6/n.length*a;r.setPosition(s+r.width*c/2,r.height/2),s+=r.width*c,i=Math.max(i,r.height),r.setScale(0),r.runAction(new cc.Sequence(new cc.ScaleTo(l,1.36),new cc.ScaleTo(.13,c)))}return t.setContentSize(s,i),t.setCascadeOpacityEnabled(!0),t},splitTextToLines:function(e){if(!e)return[];var t=e.indexOf(" ");if(e.length<=16||-1===t)return[e];var s=e.substr(0,16).lastIndexOf(" ");-1===s&&(s=t);var i=[e.substr(0,s)];return i=i.concat(e.substr(s+1).trim())},splitLineToBlocks:function(e){var t=e.split("");return t.length<=6?t:t.slice(0,3).concat([t.slice(3,t.length-3).join("")]).concat(t.slice(t.length-3,t.length))}}),EXCLAMATIONS.actor=EXCLAMATIONS.words.extend({getStyles:function(){return cleverapps.styles.Exclamations.actor},showMessage:function(e){var t=bundles.exclamations.urls.exclamation_alert_effect;if(
-1!==cleverapps.exclamation.getCongratulations().indexOf(e)){var s=cleverapps.Random.mathChoose(this.getStyles().actorActions);t=s.sound,cc.director.getRunningScene().actor.animate(s.animation,{noSFX:!0})}else"messages:message.YouWin"===e?t=bundles.exclamations.urls.exclamation_win_effect:"messages:message.Shuffle"===e&&(t=bundles.exclamations.urls.exclamation_shuffle_effect);this.runActions(e,void 0,t,"animation")}}),cleverapps.overrideColors(cleverapps.styles.COLORS,{CONGRATS_RED:new cc.Color(255,35,60,255),CONGRATS_LIGHT_GREEN:new cc.Color(182,248,68,255),CONGRATS_BLUE:new cc.Color(0,177,249,255),CONGRATS_ORANGE:new cc.Color(233,117,38,255),CONGRATS_PURPLE:new cc.Color(194,11,227,255),CONGRATS_GREEN:new cc.Color(0,209,121,255),CONGRATS_DARK_RED:new cc.Color(241,15,51,255)}),cleverapps.styles.Exclamations={base:{width:600,height:200}},cleverapps.styles.Exclamations.heroes=cleverapps.overrideStyles(cleverapps.styles.Exclamations.base,{width:760,scale:[.8,1,1],sound:{delay:.6},
default:{color:cleverapps.styles.COLORS.CONGRATS_BLUE},warning:{color:cleverapps.styles.COLORS.CONGRATS_DARK_RED},yeah:{color:cleverapps.styles.COLORS.CONGRATS_RED},super:{color:cleverapps.styles.COLORS.CONGRATS_LIGHT_GREEN},yay:{color:cleverapps.styles.COLORS.CONGRATS_BLUE},lets_go:{color:cleverapps.styles.COLORS.CONGRATS_ORANGE},ohyeah:{color:cleverapps.styles.COLORS.CONGRATS_PURPLE},oh:{color:cleverapps.styles.COLORS.CONGRATS_GREEN},wow:{color:cleverapps.styles.COLORS.CONGRATS_DARK_RED}},!0),cleverapps.styles.Exclamations.actor=cleverapps.overrideStyles(cleverapps.styles.Exclamations.base,{actorActions:[{animation:Actor.ANIMATIONS.ATTACK1,sound:bundles.game.urls.sc_welldone},{animation:Actor.ANIMATIONS.ATTACK2,sound:bundles.game.urls.sc_welldone2},{animation:Actor.ANIMATIONS.ATTACK3,sound:bundles.game.urls.sc_welldone3}]},!0);var ComboBarView=cc.Node.extend({ctor:function(e){this._super(),this.combo=e;var t=cleverapps.styles.ComboBarView;this.setPositionRound(
t.positions[cleverapps.wideMode.mode]),this.setContentSize(t),this.setAnchorPoint2(),this.setScale(t.scale[cleverapps.wideMode.mode]),this.initSlots(),this.progressPoints=new Array(cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE),cleverapps.UI.makeHideable(this,cleverapps.UI.HORIZONTAL),cleverapps.metha.registerControl("comboBar",this),this.registerTarget(t),cleverapps.tooltipManager.create(this,{text:Messages.get("StreakTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below,size:cleverapps.styles.UI.Tooltip.SIZE.long})},initSlots:function(){var e=cleverapps.styles.ComboBarView,t=new cc.Node;t.setPositionRound(e.row),this.progressSlots=[];for(var s=0;s<cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE;s++){var i=new cc.Sprite(0===s?bundles.game.frames.combo_notch1:bundles.game.frames.combo_notch2);i.setPosition(s*e.slot.offset,0),t.addChild(i),this.progressSlots.push(i)}var n=cleverapps.UI.createSprite(bundles.game.frames.combo_back_png);n.setPosition(this.width/2,this.height/2),
n.setContentSize(e),n.setLocalZOrder(-1),n.addChild(t),this.addChild(n),this.goalSlot=new cc.Node,this.goalSlot.setPosition(this.width+e.goal.offsetX,e.goal.offsetY),this.updateGoal(),this.addChild(this.goalSlot)},onChangeLevel:function(e){e&&(this.progressPoints[this.combo.level-1]=e),this.progressSlots.forEach(function(e,t){e.innerView&&t>=this.combo.level&&(e.innerView.runAction(new cc.Sequence(new cc.ScaleTo(.1,0),new cc.RemoveSelf)),e.innerView=void 0),void 0===e.innerView&&t<this.combo.level&&this.drawProgressPoint(e,t)}.bind(this))},drawProgressPoint:function(e,t){var s=cleverapps.styles.ComboBarView.progressImages[this.progressPoints[t]];e.innerView=cleverapps.UI.createSprite(0===t?bundles.game.frames.combo_point1:bundles.game.frames.combo_point2);var i=cleverapps.UI.createSprite(s);i.setPosition(e.innerView.width/2,e.innerView.height/2),e.innerView.addChild(i),e.innerView.setPosition(e.width/2,e.height/2),e.innerView.setScale(0),e.addChild(e.innerView),e.innerView.runAction(
new cc.ScaleTo(.2,1)),i.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ScaleTo(.2,1.4).easing(cc.easeBackOut()),new cc.ScaleTo(.1,1)));var n=new cleverapps.Spine(bundles.game.jsons.combo_light_json);n.setAnimation(0,"animation",!1),n.setPositionRound(this.goalView.width/2,this.goalView.height/2),n.setCompleteListenerRemove(),this.goalView.addChild(n),this.goalView.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.2),new cc.ScaleTo(.1,.9),new cc.ScaleTo(.1,1.1),new cc.ScaleTo(.1,1)))},updateGoal:function(){switch(this.goalView&&(this.goalView.removeFromParent(),this.goalView=void 0),this.combo.currentGoal){case 0:var e=cleverapps.cardSkins.getSelectedSkin().combo;break;case 1:e=cleverapps.cardSkins.getSelectedSkin().combo2;break;default:e=bundles.game.frames.combo_goal_png}this.goalView=cleverapps.UI.createSprite(e),this.goalSlot.addChild(this.goalView),this.goalView.setScale(0),this.goalView.runAction(new cc.Sequence(new cc.DelayTime(.2),new cc.ScaleTo(.3,1)))},reward:function(e,t
){var s=cleverapps.styles.ComboBarView.bonus,i=CardView.GetView(e);this.goalView&&(this.goalView.visible=!1),this.addChild(i),i.setPosition(this.width+s.offsetX,s.offsetY),i.setScale(s.scale),i.setRotation(s.rotation),i.runAction(new cc.Sequence(new cc.Spawn(new cc.ScaleTo(.3,1).easing(cc.easeInOut(3)),new cc.RotateTo(.3,0)),new cc.CallFunc(function(){t(),cleverapps.audio.playSound(bundles.game.urls.collected_effect)})))}});cleverapps.styles.ComboBarView={width:308,height:98,scale:[1,.9,1],positions:[{x:{align:"right",dx:-20},y:{align:"top",dy:-124}},{x:{align:"right",dx:-20},y:{align:"top",dy:-134}},{x:{align:"right",dx:-20},y:{align:"top",dy:-134}}],goal:{offsetX:-46,offsetY:50},row:{x:{align:"left",dx:40},y:{align:"center"}},slot:{offset:50},bonus:{offsetX:-46,offsetY:40,rotation:18,scale:.42}};var ComboView=cc.Node.extend({ctor:function(e,t){this._super(),this.combo=e,this.setAnchorPoint2(),"solitaire"===cleverapps.config.type?(this.comboBarView=new ComboBarView(this.combo),
t.addChild(this.comboBarView),this.combo.on("updateGoal",function(){this.comboBarView.updateGoal()}.bind(this))):(this.border=new cleverapps.Spine(bundles.combo_background.jsons.combo_background_json),this.border.setCascadeOpacityEnabled(!0),this.addChild(this.border),this.particles=new cleverapps.Spine(bundles.combo_background.jsons.combo_background_particles_json),this.addChild(this.particles)),this.updateSize=cleverapps.accumulate(10,this.updateSize.bind(this)),this.updateSize(),this.onChangeLevel(),this.combo.on("changeSize",this.updateSize.bind(this)),this.combo.on("changeLevel",this.onChangeLevel.bind(this)),this.combo.on("stopAlarm",this.stopAlarm.bind(this)),this.combo.on("runAlarm",this.runAlarm.bind(this)),this.combo.on("reward",this.reward.bind(this)),this.combo.on("runLater",this.runLater.bind(this))},runLater:function(e,t){this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.CallFunc(t)))},updateSize:function(){var e=cleverapps.UI.getSceneSize();this.setContentSize(
e.width,e.height+2*cleverapps.UI.getSceneOffsetY());var t=this.parent;this.setPositionRound(t.width/2,t.height/2),this.border&&(this.border.setScaleX(this.width/this.border.width/t.scale),this.border.setScaleY(this.height/this.border.height/t.scale),this.border.setPositionRound(this.width/2,this.height/2),this.particles.setPositionRound(this.width/2,this.height/2))},stopAlarm:function(){this.border&&(this.border.stopAllActions(),this.border.runAction(new cc.FadeTo(.3,255)))},reward:function(e,t){this.comboBarView&&this.comboBarView.reward(e,t)},runAlarm:function(){this.border&&(this.border.stopAllActions(),this.border.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.5,170),new cc.FadeTo(.5,255)))))},onChangeLevel:function(e){if(this.border)if(this.combo.level<=1)this.border.visible=!1,this.particles.visible=!1;else{this.border.visible=!0,this.particles.visible=!0;var t=Math.min(this.combo.level,cleverapps.Combo.COMBO_LEVEL_WITH_PRIZE)-1;this.border.setAnimation(0,"c"+t,!1)
,this.border.addAnimation(0,"c"+t+"_idle",!0),this.particles.setAnimation(0,"c"+t,!1),this.particles.addAnimation(0,"c"+t+"_idle",!0)}this.comboBarView&&this.comboBarView.onChangeLevel(e)}}),SceneDecors={add:function(e,t){if(t)return this.createDecors(e,t)},createDecors:function(s,e){return e.map(function(e){var t;return e.json?(t=new cleverapps.Spine(e.json)).setAnimation(0,e.animation,!0):t=new cc.Sprite(e.image),s.addChild(t),e.scale&&(e.scale.x?t.setScale(e.scale.x,e.scale.y):t.setScale(e.scale)),void 0!==e.zOrder&&t.setLocalZOrder(e.zOrder),t.setPositionRound(e),t})}};cleverapps.styles.SceneDecors={},cleverapps.SkinManager=function(){this.active=void 0,this.defaultSlots=cleverapps.SkinManager.SKINS.default.slots},cleverapps.SkinManager.prototype.getSlot=function(e,t){if(this.active&&this.active.slots[e]){var s=this.active.slots[e](t);if(void 0!==s)return s}return this.defaultSlots[e]&&this.defaultSlots[e](t)},cleverapps.SkinManager.prototype.update=function(){this.active=void 0,
cleverapps.eventManager&&cleverapps.eventManager.listCurrentFeatures().forEach(function(e){cleverapps.SkinManager.SKINS[e]&&(this.active=cleverapps.SkinManager.SKINS[e])},this)},cleverapps.SkinManager.prototype.getBundle=function(){if(this.active)return this.active.bundle},cleverapps.SkinManager.SKINS={default:{localization:{},slots:{windowDecors:function(e){return e.decors},windowBg:function(e){return e.image},spine:function(e){return e.json},menuBarItem:function(e){},sceneControlButton:function(e){},episodeView:function(e){},episodeViewTitle:function(e){},iconBg:function(e){return e.image},gameAudio:function(){},sceneBg:function(){},gameSceneBg:function(){},missionIcon:function(e){return cleverapps.environment.isGameScene()&&Missions[e.type].gameIcon?Missions[e.type].gameIcon:Missions[e.type].icon},missionStar:function(e){return bundles.game.frames["mission_star"+e.type+"_png"]},missionWindowHero:function(){return cleverapps.styles.MissionWindow.heroTitleAnimation},
tulpanScale:function(){return cleverapps.styles.TulpanCellView.scale},removeMissions:function(){},toolbarDecors:function(){return[]},localization:function(){return cleverapps.SkinManager.SKINS.default.localization},windowTitle:function(e){return e.image},missionMarkIcon:function(e){return cleverapps.environment.isGameScene()&&Missions[e.type].gameIcon?Missions[e.type].gameIcon:Missions[e.type].icon},missionWindowTitleFont:function(){return cleverapps.styles.FONTS.MISSION_WINDOW_TITLE_TEXT||cleverapps.styles.MissionWindow.titleFont},wardrobeWindowBanner:function(){return bundles.wardrobe_window.frames.window_bg},cardMarkSpine:function(e){return e.json}}}},cleverapps.SkinManager.SKINS.xmas={bundle:"xmas",localization:{tripeaks:{"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3",
"AddMovesWindow.missionGiveUp.LetterTournament":"Xmas.AddMovesWindow.missionGiveUp.LetterTournament","AddMovesWindow.mission.LetterTournament":"Xmas.AddMovesWindow.mission.LetterTournament",CloversTooltip:"Xmas.CloversTooltip"},wordsoup:{"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3","WardrobeDialogue.stage0.text0":"Xmas.WardrobeDialogue.stage0.text0","WardrobeDialogue.stage1.text0":"Xmas.WardrobeDialogue.stage1.text0","WardrobeDialogue.stage2.text0":"Xmas.WardrobeDialogue.stage2.text0","WardrobeDialogue.stage3.text0":"Xmas.WardrobeDialogue.stage3.text0","WardrobeDialogue.stage4.text0":"Xmas.WardrobeDialogue.stage4.text0","WardrobeDialogue.stage5.text0":"Xmas.WardrobeDialogue.stage5.text0","WardrobeDialogue.stage6.text0":"Xmas.WardrobeDialogue.stage6.text0",
"WardrobeDialogue.stage7.text0":"Xmas.WardrobeDialogue.stage7.text0","WardrobeDialogue.stage8.text0":"Xmas.WardrobeDialogue.stage8.text0","WardrobeDialogue.stage9.text0":"Xmas.WardrobeDialogue.stage9.text0","WardrobeDialogue.stage10.text0":"Xmas.WardrobeDialogue.stage10.text0","WardrobeDialogue.stage11.text0":"Xmas.WardrobeDialogue.stage11.text0",WardrobeDescText:"Xmas.WardrobeDescText",WardrobeRulesText:"Xmas.WardrobeRulesText",WardrobePrizeRewardTitle:"Xmas.WardrobePrizeRewardTitle","Missions.LetterTournament.Rules1":"Xmas.Missions.LetterTournament.Rules1"},scramble:{"Missions.LetterTournament.Title":"Xmas.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Xmas.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Xmas.MissionRulesWindow.LetterTournament.text3"}},slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return t.leaves_left=!1,t.leaves_right=!1,t.xmas_window_1=!0,t.xmas_window_2=!0,
"crocword"===cleverapps.config.name&&(e.window instanceof VictoryWindow||(t.xmas_decor_horizontal=!0),t.xmas_decor_right_top=!0,t.xmas_decor_left_top=!0,t.xmas_decor_vertical_right=!0,t.xmas_decor_vertical_left=!0),-1!==["scramble"].indexOf(cleverapps.config.name)&&("victorywindow"!==e.window.name&&(t.xmas_decor_left_top=!0,t.xmas_decor_right_top=!0),"leaderswindow"!==e.window.name&&(t.xmas_decor_bottom=!0)),-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(t.xmas_decor_left_top=!0,t.xmas_decor_center_top=!0,t.xmas_decor_right_top=!0,"leaderswindow"!==e.window.name&&(t.xmas_decor_bottom=!0)),"riddles"===cleverapps.config.name&&e.level&&e.level.isHard()&&(t.xmas_window_1=!1,t.xmas_window_2=!1),t},windowBg:function(e){return"riddles"===cleverapps.config.name&&e.level&&e.level.isHard()?e.image:bundles.xmas.frames.window_bg_png?bundles.xmas.frames.window_bg_png:void 0},hero:function(e){if(bundles.xmas.jsons[e.color+"_hero_spine_json"])return bundles.xmas.jsons[e.color+"_hero_spine_json"]
},spine:function(e){var t={};return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.heroes.jsons.A_hero_spine_json]=bundles.xmas.jsons.A_hero_spine_json,t[bundles.heroes.jsons.B_hero_spine_json]=bundles.xmas.jsons.B_hero_spine_json,t[bundles.heroes.jsons.C_hero_spine_json]=bundles.xmas.jsons.C_hero_spine_json,t[bundles.heroes.jsons.D_hero_spine_json]=bundles.xmas.jsons.D_hero_spine_json,t[bundles.heroes.jsons.E_hero_spine_json]=bundles.xmas.jsons.E_hero_spine_json,t[bundles.heroes.jsons.W_hero_spine_json]=bundles.xmas.jsons.W_hero_spine_json),"board"===cleverapps.config.type&&(t[bundles.hero.jsons.hero_json]=bundles.xmas.jsons.hero_json),-1!==["tripeaks"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.xmas.jsons.xmas_mission_window_json),-1!==["scramble"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.xmas.jsons.mission_window_json,
cleverapps.styles.MissionWindow.heroTitleAnimation=cleverapps.styles.xmasNewStyles.heroTitleAnimation),-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name)&&(t[bundles.sidebar.jsons.mission_letter_icon_json]=bundles.sidebar.jsons.xmas_letter_json,t[bundles.sidebar.jsons.wardrobe_icon_json]=bundles.xmas.jsons.wardrobe_sidebar_icon_json),t[e.json]?t[e.json]:e.json},menuBarItem:function(e){return-1!==["crocword","scramble","tripeaks"].indexOf(cleverapps.config.name)?cleverapps.styles.SceneDecors.menuBarItemXmas:"undefined"!=typeof LivesView&&e.target instanceof LivesView?cleverapps.styles.SceneDecors.livesViewXmas:cleverapps.styles.SceneDecors.menuBarItemXmas},sceneControlButton:function(e){return cleverapps.styles.SceneDecors.sceneControlButtonXmas},progressViewDecor:function(e){return cleverapps.styles.SceneDecors.progressViewDecor},episodeView:function(e){return cleverapps.styles.SceneDecors.episodeViewXmas},iconBg:function(e){if(bundles.xmas.frames.icon_bg_png
)return bundles.xmas.frames.icon_bg_png},gameAudio:function(){if("wordsoup"===cleverapps.config.name)return bundles.xmas.urls.background_music_game},sceneBg:function(){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.xmas.urls.pattern_bg_main_png}},gameSceneBg:function(e){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.xmas.urls.pattern_bg_main_png}},missionIcon:function(e){if(-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.xmas.frames.mission_letter_png},missionStar:function(e){return-1!==["wordsoup","scramble"].indexOf(cleverapps.config.name)?bundles.xmas.frames["mission_star"+e.type+"_png"]:-1!==["tripeaks"].indexOf(cleverapps.config.name)?bundles.xmas.frames.mission_letter_png:void 0},missionRulesWindow:function(e){if(-1!==["wordsoup","tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.xmas.jsons.letter_rules_json},
wardrobeWindowBanner:function(){return bundles.xmas.frames.window_banner},cardMarkSpine:function(e){return-1!==["tripeaks"].indexOf(cleverapps.config.name)&&"mission"===e.type?bundles.xmas.jsons.xmas_marks_json:e.json},localization:function(){if(cleverapps.SkinManager.SKINS.xmas.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.xmas.localization[cleverapps.config.name]}}},cleverapps.SkinManager.SKINS.valentines={bundle:"valentines",localization:{heroes:{"Missions.TulpanTournament.Title":"Valentine.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Valentine.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Valentine.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Valentine.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo0",
"Missions.TulpanTournament.AnimationMainTextInfo1":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo1"},riddles:{"Missions.TulpanTournament.Title":"Valentine.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Valentine.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Valentine.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Valentine.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Valentine.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Valentine.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Valentine.AddMovesWindow.missionGiveUp.TulpanTournament"},scramble:{
"Missions.LetterTournament.Title":"Valentine.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Valentine.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Valentine.MissionRulesWindow.LetterTournament.text3"},wordsoup:{"Missions.LetterTournament.Title":"Valentine.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Valentine.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Valentine.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Valentine.MissionRulesWindow.LetterTournament.text3"},crocword:{"Missions.LetterTournament.Title":"Valentine.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Valentine.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Valentine.MissionRulesWindow.LetterTournament.text2",
"MissionRulesWindow.LetterTournament.text3":"Valentine.MissionRulesWindow.LetterTournament.text3"}},slots:{removeMissions:function(){if("riddles"===cleverapps.config.name||"heroes"===cleverapps.config.name)return[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]},menuBarItem:function(e){return"crocword"===cleverapps.config.name?"BonusRoundTimerItem"===e.target.item.getName()?cleverapps.styles.SceneDecors.menuBarBonusRoundTimerItemValentines:cleverapps.styles.SceneDecors.menuBarItemValentines:-1!==["wordsoup","riddles","heroes","scramble"].indexOf(cleverapps.config.name)?cleverapps.styles.SceneDecors.menuBarItemValentines:void 0},sceneControlButton:function(e){if(-1!==["crocword","wordsoup","riddles","scramble"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.sceneControlButtonValentines},progressViewDecor:function(e){if(-1!==["scramble"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.progressViewDecorValentines},missionWindowDecors:function(){
return cleverapps.styles.SceneDecors.missionWindowValentines},episodeView:function(e){if(-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.episodeViewValentines},episodeViewTitle:function(e){if(-1!==["wordsoup"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.episodeViewTitleValentines},iconBg:function(e){if(-1!==["crocword","heroes","riddles"].indexOf(cleverapps.config.name))return bundles.valentines.frames.valentines_icon_bg_png},toolbarDecors:function(e){if(-1!==["crocword","wordsoup","heroes","riddles"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.toolbarViewValentines},windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return-1!==["wordsoup","crocword","heroes","riddles"].indexOf(cleverapps.config.name)&&(e.window instanceof LeadersWindow||(t.valentines_decor_right=!0,t.valentines_decor_right2=!0),t.valentines_decor_left=!0,t.valentines_decor_left2=!0,-1!==["heroes"
,"wordsoup","riddles","crocword"].indexOf(cleverapps.config.name)&&(t.valentines_decor_hearts=!0,t.valentines_decor_top_1=!0,t.valentines_decor_top_2=!0,t.valentines_decor_top_3=!0,t.valentines_decor_heart_top_1=!0,t.valentines_decor_heart_top_2=!0,t.valentines_decor_heart_top_3=!0,t.valentines_decor_heart_top_4=!0,t.gears_animation=!1,t.gears=!1,t.star=!1,t.present=!1,t.leaves_left=!1,t.leaves_right=!1)),-1!==["scramble"].indexOf(cleverapps.config.name)&&(t.valentines_decor_bottom=!0,t.valentines_decor_top=!0,e.window instanceof LeadersWindow&&(t.valentines_decor_bottom=!1),e.window instanceof MissionWindow&&(t.valentines_decor_top=!1),e.window instanceof ExtraWindow&&(t.valentines_decor_top=!1),e.window instanceof VictoryWindow&&(t.valentines_decor_top=!1)),t},missionIcon:function(e){return-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER?bundles.valentines.frames.mission_icon_png:-1!==["riddles","heroes"].indexOf(
cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.valentines.frames.mission_icon_png:void 0},missionStar:function(e){if(-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name))return bundles.valentines.frames["mission_star"+e.type+"_png"]},missionRulesWindow:function(e){if(-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.valentines.jsons.letter_rules_json},missionWindowHero:function(){if(-1!==["scramble"].indexOf(cleverapps.config.name))return cleverapps.styles.Valentines.heroTitleAnimation},spine:function(e){var t={};return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.tulpan_tournament.jsons.json]=bundles.valentines.jsons.json,t[bundles.main.jsons.tournament_tulpan_icon_json]=bundles.valentines.jsons.icon_json),"board"===cleverapps.config.type&&(t[bundles.hero.jsons.hero_json]=bundles.valentines.jsons.hero_json),-1!==["scramble"].indexOf(cleverapps.config.name
)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.valentines.jsons.mission_window_json),-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&(t[bundles.sidebar.jsons.mission_letter_icon_json]=bundles.sidebar.jsons.valentine_letter_json),-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_WARDROBE&&(t[bundles.sidebar.jsons.wardrobe_icon_json]=bundles.sidebar.jsons.wardrobe_valentine_icon_json),t[e.json]?t[e.json]:e.json},localization:function(){if(cleverapps.SkinManager.SKINS.valentines.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.valentines.localization[cleverapps.config.name]},gameSceneBg:function(e){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.valentines.urls.valentines_pattern_bg_png}},gameAudio:function(){},windowTitle:function(e){if("heroes"===cleverapps.config.name)return bundles.valentines.frames.valentines_window_title_bg_png},missionWindowTitleFont:function(){
return cleverapps.styles.FONTS.VALENTINE_MISSION_WINDOW_TITLE_TEXT},wardrobeWindowBanner:function(){return bundles.valentines.frames.wardrobe_window_banner}}},cleverapps.overrideFonts(cleverapps.styles.FONTS,{VALENTINE_MISSION_WINDOW_TITLE_TEXT:{size:80,color:cleverapps.styles.COLORS.WHITE,shadow:{direction:cc.size(0,-5),blur:1,color:new cc.Color(106,2,88,255)}}}),cleverapps.SkinManager.SKINS.easter={bundle:"easter",localization:{heroes:{"Missions.TulpanTournament.Title":"Easter.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Easter.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Easter.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Easter.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Easter.Missions.TulpanTournament.AnimationMainTextInfo0",
"Missions.TulpanTournament.AnimationMainTextInfo1":"Easter.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Easter.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Easter.AddMovesWindow.missionGiveUp.TulpanTournament"},riddles:{"Missions.RoseTournament.Title":"Easter.Missions.RoseTournament.Title","Missions.RoseTournament.Rules1":"Easter.Missions.RoseTournament.Rules1","Missions.RoseTournament.AnimationMainTextWin":"Easter.Missions.RoseTournament.AnimationMainTextWin","Missions.RoseTournament.AnimationMainTextLose":"Easter.Missions.RoseTournament.AnimationMainTextLose","Missions.RoseTournament.AnimationMainTextInfo0":"Easter.Missions.RoseTournament.AnimationMainTextInfo0","Missions.RoseTournament.AnimationMainTextInfo1":"Easter.Missions.RoseTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Easter.AddMovesWindow.mission.RoseTournament",
"AddMovesWindow.missionGiveUp.RoseTournament":"Easter.AddMovesWindow.missionGiveUp.RoseTournament","AddMovesWindow.mission.RoseTournament":"Easter.AddMovesWindow.mission.RoseTournament"},wordsoup:{"Missions.LetterTournament.Title":"Easter.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Easter.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Easter.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Easter.MissionRulesWindow.LetterTournament.text3"},scramble:{"Missions.LetterTournament.Title":"Easter.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Easter.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Easter.MissionRulesWindow.LetterTournament.text3"},crocword:{"Missions.LetterTournament.Title":"Easter.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Easter.Missions.LetterTournament.Rules1",
"MissionRulesWindow.LetterTournament.text2":"Easter.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Easter.MissionRulesWindow.LetterTournament.text3"}},slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return"wordsoup"===cleverapps.config.name&&(e.window instanceof LeadersWindow||(t.window_bottom_right_corner_2=!0,t.window_bottom_right_corner_1=!0,t.window_bottom_left_corner_2=!0,t.window_bottom_left_corner_1=!0)),"riddles"===cleverapps.config.name&&(t.window_bottom_right=!0,t.window_bottom_left=!0),"scramble"===cleverapps.config.name&&(t.easter_decor_top=!0,t.easter_decor_bottom=!0,e.window instanceof TellWindow&&(t.easter_decor_bottom=!1),e.window instanceof MissionWindow&&(t.easter_decor_top=!1),e.window instanceof ExtraWindow&&(t.easter_decor_top=!1),e.window instanceof VictoryWindow&&(t.easter_decor_top=!1),e.window instanceof BoostersSaleWindow&&(t.easter_decor_bottom=!1)),t},menuBarItem:function(){
return cleverapps.styles.SceneDecors.menuBarItemEaster},episodeView:function(){return cleverapps.styles.SceneDecors.episodeViewEaster},toolbarDecors:function(){return cleverapps.styles.SceneDecors.toolbarViewEaster},progressViewDecor:function(){return cleverapps.styles.SceneDecors.progressViewDecorEaster},sceneControlButton:function(e){if(e.target.options.logic===MenuControlButton)return cleverapps.styles.SceneDecors.sceneControlButtonEaster},missionWindowDecors:function(){return cleverapps.styles.SceneDecors.missionWindowEaster},tulpanScale:function(){if("heroes"===cleverapps.config.name)return.9},missionIcon:function(e){return-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER?bundles.easter.frames.letter_mission_icon:-1!==["heroes"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.easter.frames.tulpan_png:-1!==["riddles"].indexOf(cleverapps.config.name
)&&e.type===Mission.TYPE_COLLECT_MARK?bundles.easter.frames.rose_png:void 0},missionStar:function(e){if(-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name))return bundles.easter.frames["mission_star"+e.type+"_png"]},missionMarkIcon:function(){return bundles.easter.frames["rose_"+(Math.random()<.5?1:2)]},missionRulesWindow:function(e){if(-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.easter.jsons.letter_rules_json},removeMissions:function(){return"riddles"===cleverapps.config.name?[Mission.TYPE_COMBO,Mission.TYPE_BURN_NEARBY]:"heroes"===cleverapps.config.name?[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]:void 0},gameSceneBg:function(){if("wordsoup"===cleverapps.config.name)return{pattern:bundles.easter.urls.pattern_bg}},spine:function(e){var t={};return-1!==["riddles"].indexOf(cleverapps.config.name)&&(t[bundles.rose_tournament.jsons.json]=bundles.easter.jsons.rose_tournament_json,
t[bundles.main.jsons.tournament_rose_icon_json]=bundles.easter.jsons.tournament_rose_icon_json),-1!==["heroes"].indexOf(cleverapps.config.name)&&(t[bundles.tulpan_tournament.jsons.json]=bundles.easter.jsons.tulpan_tournament_json,t[bundles.main.jsons.tournament_tulpan_icon_json]=bundles.easter.jsons.tournament_tulpan_icon_json),-1!==["scramble"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.easter.jsons.mission_window_json),"board"===cleverapps.config.type&&(t[bundles.sidebar.jsons.mission_letter_icon_json]=bundles.sidebar.jsons.easter_letter_json),t[e.json]},localization:function(){if(cleverapps.SkinManager.SKINS.easter.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.easter.localization[cleverapps.config.name]}}},cleverapps.SkinManager.SKINS.memorial={bundle:"memorial",localization:{heroes:{"Missions.TulpanTournament.Title":"Memorial.Missions.TulpanTournament.Title",
"Missions.TulpanTournament.Rules1":"Memorial.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Memorial.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Memorial.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Memorial.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Memorial.AddMovesWindow.missionGiveUp.TulpanTournament","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},wordsoup:{"Missions.LetterTournament.Title":"Memorial.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Memorial.Missions.LetterTournament.Rules1",
"MissionRulesWindow.LetterTournament.text2":"Memorial.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Memorial.MissionRulesWindow.LetterTournament.text3","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},crocword:{"Missions.LetterTournament.Title":"Memorial.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Memorial.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Memorial.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Memorial.MissionRulesWindow.LetterTournament.text3",WardrobeDescText:"Memorial.WardrobeDescText",WardrobeRulesText:"Memorial.WardrobeRulesText",WardrobePrizeRewardTitle:"Memorial.WardrobePrizeRewardTitle","WardrobeDialogue.stage0.text0":"Memorial.WardrobeDialogue.stage0.text0","WardrobeDialogue.stage1.text0":"Memorial.WardrobeDialogue.stage1.text0","WardrobeDialogue.stage2.text0":"Memorial.WardrobeDialogue.stage2.text0",
"WardrobeDialogue.stage3.text0":"Memorial.WardrobeDialogue.stage3.text0","WardrobeDialogue.stage4.text0":"Memorial.WardrobeDialogue.stage4.text0","WardrobeDialogue.stage5.text0":"Memorial.WardrobeDialogue.stage5.text0","WardrobeDialogue.stage6.text0":"Memorial.WardrobeDialogue.stage6.text0","WardrobeDialogue.stage7.text0":"Memorial.WardrobeDialogue.stage7.text0","WardrobeDialogue.stage8.text0":"Memorial.WardrobeDialogue.stage8.text0","WardrobeDialogue.stage9.text0":"Memorial.WardrobeDialogue.stage9.text0","WardrobeDialogue.stage10.text0":"Memorial.WardrobeDialogue.stage10.text0","WardrobeDialogue.stage11.text0":"Memorial.WardrobeDialogue.stage11.text0","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"},scramble:{"Missions.LetterTournament.Title":"Memorial.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Memorial.MissionRulesWindow.LetterTournament.text2",
"MissionRulesWindow.LetterTournament.text3":"Memorial.MissionRulesWindow.LetterTournament.text3"},riddles:{"Missions.TulpanTournament.Title":"Memorial.Missions.TulpanTournament.Title","Missions.TulpanTournament.Rules1":"Memorial.Missions.TulpanTournament.Rules1","Missions.TulpanTournament.AnimationMainTextWin":"Memorial.Missions.TulpanTournament.AnimationMainTextWin","Missions.TulpanTournament.AnimationMainTextLose":"Memorial.Missions.TulpanTournament.AnimationMainTextLose","Missions.TulpanTournament.AnimationMainTextInfo0":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo0","Missions.TulpanTournament.AnimationMainTextInfo1":"Memorial.Missions.TulpanTournament.AnimationMainTextInfo1","AddMovesWindow.mission.TulpanTournament":"Memorial.AddMovesWindow.mission.TulpanTournament","AddMovesWindow.missionGiveUp.TulpanTournament":"Memorial.AddMovesWindow.missionGiveUp.TulpanTournament","BoostersSaleWindow.title":"Memorial.BoostersSaleWindow.title"}},slots:{spine:function(e){var t={}
;return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&(t[bundles.tulpan_tournament.jsons.json]=bundles.memorial.jsons.json,t[bundles.sidebar.jsons.tournament_tulpan_icon_json]=bundles.memorial.jsons.icon_json),-1!==["crocword","scramble"].indexOf(cleverapps.config.name)&&(t[bundles.hero.jsons.hero_json]=bundles.memorial.jsons.hero_json),-1!==["crocword","wordsoup","scramble"].indexOf(cleverapps.config.name)&&(t[bundles.sidebar.jsons.mission_letter_icon_json]=bundles.sidebar.jsons.memorial_letter_json),-1!==["scramble"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.memorial.jsons.mission_window_json),t[e.json]?t[e.json]:e.json},toolbarDecors:function(e){if(-1!==["heroes","riddles","wordsoup","crocword"].indexOf(cleverapps.config.name))return cleverapps.styles.SceneDecors.toolbarViewMemorial},windowDecors:function(e){if(-1!==["heroes","riddles","wordsoup","crocword","scramble"].indexOf(cleverapps.config.name)){
var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return t.memorial_decor_top=!0,t.memorial_decor_bottom_left=!0,t.memorial_decor_bottom_right=!0,e.window instanceof LeadersWindow&&(t.memorial_decor_bottom_right=!1),e.window instanceof FavoriteSaleWindow&&(t.memorial_decor_bottom_left=!1,t.memorial_decor_bottom_right=!1),e.window instanceof SubscriptionWindow&&-1!==["crocword","wordsoup"].indexOf(cleverapps.config.name)&&(t.memorial_decor_top=!1,t.memorial_decor_bottom_left=!1,t.memorial_decor_bottom_right=!1),e.window instanceof WardrobeWindow&&(t.memorial_decor_top=!1),e.window instanceof WardrobeRulesWindow&&(t.memorial_decor_top=!1),e.window instanceof WardrobeReceiveWindow&&(t.memorial_decor_top=!1),t.leaves_right=!1,t.gears=!1,t.gears_animation=!1,"scramble"===cleverapps.config.name&&(e.window instanceof LeadersWindow&&(t.memorial_decor_bottom_left=!1),e.window instanceof SubscriptionWindow&&(t.memorial_decor_bottom_left=!1),e.window instanceof VictoryWindow&&(
t.memorial_decor_top=!1,t.memorial_decor_bottom_left=!1),e.window instanceof TreasureSearchWindow&&(t.memorial_decor_bottom_left=!1),e.window instanceof TellWindow&&(t.memorial_decor_bottom_left=!1)),"wordsoup"===cleverapps.config.name&&e.window instanceof HomeTasksWindow&&(t.memorial_decor_bottom_left=!1,t.memorial_decor_bottom_right=!1),t}return e.decors},menuBarItem:function(e){if(e.target.item&&"GoldItem"===e.target.item.getName())return cleverapps.styles.SceneDecors.menuBarItemMemorial},sceneControlButton:function(e){if(e.target.options.logic===MenuControlButton)return cleverapps.styles.SceneDecors.sceneControlButtonMemorial},progressViewDecor:function(){return cleverapps.styles.SceneDecors.progressViewMemorial},missionIcon:function(e){return-1!==["heroes","riddles"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_BURN_NEARBY?bundles.memorial.frames.mission_icon_png:-1!==["wordsoup","crocword","scramble"].indexOf(cleverapps.config.name
)&&e.type===Mission.TYPE_LETTER?bundles.memorial.frames.mission_icon_png:void 0},missionStar:function(e){if(-1!==["wordsoup","crocword","scramble"].indexOf(cleverapps.config.name))return bundles.memorial.frames["mission_star"+e.type+"_png"]},missionRulesWindow:function(e){if(-1!==["wordsoup","crocword","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.memorial.jsons.letter_rules_json},missionWindowDecors:function(){return cleverapps.styles.SceneDecors.missionWindowMemorial},removeMissions:function(){if(-1!==["heroes","riddles"].indexOf(cleverapps.config.name))return[Mission.TYPE_COLLECT_MARK,Mission.TYPE_COMBO]},wardrobeWindowBanner:function(){return bundles.memorial.frames.wardrobe_window_banner},localization:function(){if(cleverapps.SkinManager.SKINS.memorial.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.memorial.localization[cleverapps.config.name]}}},cleverapps.SkinManager.SKINS.halloween={bundle:"halloween",
localization:{heroes:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},scramble:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title","Missions.LetterTournament.Title":"Halloween.Missions.LetterTournament.Title","Missions.LetterTournament.Rules1":"Halloween.Missions.LetterTournament.Rules1","MissionRulesWindow.LetterTournament.text2":"Halloween.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Halloween.MissionRulesWindow.LetterTournament.text3"},wordsoup:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},tripeaks:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title",CloversTooltip:"Halloween.CloversTooltip","Missions.LetterTournament.Title":"Halloween.Missions.LetterTournament.Title","MissionRulesWindow.LetterTournament.text2":"Halloween.MissionRulesWindow.LetterTournament.text2","MissionRulesWindow.LetterTournament.text3":"Halloween.MissionRulesWindow.LetterTournament.text3",
"AddMovesWindow.missionGiveUp.LetterTournament":"Halloween.AddMovesWindow.missionGiveUp.LetterTournament","AddMovesWindow.mission.LetterTournament":"Halloween.AddMovesWindow.mission.LetterTournament"},differences:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"},riddles:{"BoostersSaleWindow.title":"Halloween.BoostersSaleWindow.title"}},slots:{windowDecors:function(e){var t={};return-1!==["wordsoup"].indexOf(cleverapps.config.name)&&-1!==[VictoryWindow].indexOf(e.window.constructor)?t.web_bottom=!0:(t.web_top=!0,t.web_bottom=!0,t.pumpkin_animation=!0),-1!==["wordsoup"].indexOf(cleverapps.config.name)&&-1!==[ExtraWindow].indexOf(e.window.constructor)&&(t.web_top=!1),-1!==[MiniGameWindow].indexOf(e.window.constructor)&&(t.web_top=!1,t.web_bottom=!1),-1!==["olympics","differences"].indexOf(cleverapps.config.name)&&-1!==[KnockoutWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),-1!==[PiggyBankWindow,MissionRulesWindow,DailyTasksWindow,LeadersWindow].indexOf(
e.window.constructor)&&(t.forest=!0,t.roots_top_left=!0,t.roots_top_right=!0,t.owls_animation=!0,t.pumpkin_animation=!1,t.web_top=!1),-1!==[MissionRulesWindow].indexOf(e.window.constructor)&&cleverapps.wideMode.mode!==cleverapps.WideMode.VERTICAL&&(t.forest=!1,t.owls_animation=!1),-1!==[RestartWindow,LevelStartWindow,LoseWindow,SettingsWindow].indexOf(e.window.constructor)&&(t.pumpkins=!0,t.candle_animation=!0,t.pumpkin_animation=!1,t.web_top=!1),"undefined"!=typeof QuestWindow&&e.window.constructor===QuestWindow&&(t.pumpkin_animation=!1),"undefined"!=typeof BuildingStartWindow&&e.window.constructor===BuildingStartWindow&&(t.web_top=!1),-1!==[RulesWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),"differences"===cleverapps.config.name&&-1!==[MissionWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),"tripeaks"===cleverapps.config.name&&(-1!==[MissionWindow].indexOf(e.window.constructor)&&(t.web_top=!1),-1!==[VictoryWindow].indexOf(e.window.constructor)&&(
t.web_top=!1,t.pumpkin_animation=!1),e.window instanceof RulesWindow&&(t.pumpkin_animation=!1)),"scramble"===cleverapps.config.name&&(-1!==[BackgroundsWindow].indexOf(e.window.constructor)&&(t.web_bottom=!1),e.window instanceof RulesWindow&&(t.pumpkin_animation=!1),-1!==[DailyCupLeadersWindow,CryptexWindow,BackgroundsWindow,VictoryWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!1),-1!==[DailyTasksWindow,LevelStartWindow,SettingsWindow].indexOf(e.window.constructor)&&(t.pumpkin_animation=!0)),t},localization:function(){if(cleverapps.SkinManager.SKINS.halloween.localization[cleverapps.config.name])return cleverapps.SkinManager.SKINS.halloween.localization[cleverapps.config.name]},missionIcon:function(e){if(-1!==["scramble","tripeaks"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.halloween.frames.mission_letter_png},missionStar:function(e){return-1!==["scramble"].indexOf(cleverapps.config.name
)?bundles.halloween.frames["mission_star_"+e.type+"_png"]:-1!==["tripeaks"].indexOf(cleverapps.config.name)?bundles.halloween.frames.mission_letter_png:void 0},missionRulesWindow:function(e){if(-1!==["tripeaks","scramble"].indexOf(cleverapps.config.name)&&e.type===Mission.TYPE_LETTER)return bundles.halloween.jsons.letter_rules_json},spine:function(e){var t={};return-1!==["scramble","tripeaks"].indexOf(cleverapps.config.name)&&(t[bundles.letter_tournament.jsons.mission_window_json]=bundles.halloween.jsons.halloween_mission_window_json,t[bundles.sidebar.jsons.mission_letter_icon_json]=bundles.sidebar.jsons.halloween_letter_json),t[e.json]},cardMarkSpine:function(e){return-1!==["tripeaks"].indexOf(cleverapps.config.name)&&"mission"===e.type?bundles.halloween.jsons.halloween_marks_json:e.json}}},cleverapps.SkinManager.SKINS.black_friday={bundle:"black_friday",slots:{windowDecors:function(e){var t=e.decors&&cleverapps.clone(e.decors,!0)||{};return"scramble"===cleverapps.config.name&&-1!==[
FavoriteSaleWindow,BoostersSaleWindow].indexOf(e.window.constructor)&&(t.black_friday_balloon=!0,t.black_friday_label=!0),t}}};var NoConnectionWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.NoConnectionWindow;this._super({title:"messages:NoConnectionWindow.title",name:"noconnectionwindow",content:this.getContent(),button:{width:e.button.width,height:e.button.height,text:Messages.get("OK"),onPressed:function(){this.close()}.bind(this)}})},getContent:function(){var e=cleverapps.styles.NoConnectionWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e.animation);var s=new cleverapps.Spine(bundles.main.jsons.no_connection_json,1);t.addChild(s),s.setPositionRound(t.width/2,t.height/2),s.setAnimation(0,"animation",!0);var i=cleverapps.UI.generateTTFText("messages:RestartWindow.AnErrorOccured",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return i.setDimensions(e.text.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),new cleverapps.Layout([i,t],{
direction:cleverapps.UI.VERTICAL,margin:e.margin})}});cleverapps.styles.NoConnectionWindow={width:500,height:800,margin:30,animation:{width:400,height:400},text:{width:480},button:{width:200,height:100}},cleverapps.UI.ZoomHandler=function(e){this.target=e,cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseScroll:this.handleMouseScroll.bind(this)},this.target),cc.sys.isMobile&&cc.sys.capabilities.touches&&this.enablePinchZoom()},cleverapps.UI.ZoomHandler.prototype.handleMouseScroll=function(e){if(cleverapps.metha.isControlEnabled()&&!this._zoomRunning){var t=e._scrollY;0!==t&&(t=0<t?.1:-.1,this.zoomTo(this.target.zoom+t,0))}},cleverapps.UI.ZoomHandler.prototype.normalizeZoom=function(e){return Math.min(Math.max(e,.8),2)},cleverapps.UI.ZoomHandler.prototype.setZoom=function(e,t){this.target.zoom=t?e:this.normalizeZoom(e),this.target.centerNode.setScale(this.target.zoom),this.target.updateVisibility(),this.target.calcBorders(),this.target.scrollHandler.afterContainerScale()}
,cleverapps.UI.ZoomHandler.prototype.zoomTo=function(e,t){this._targetZoom=this.normalizeZoom(e),this._startZoom=this.target.zoom,this._elapsedTime=0,this._zoomDuration=t,this._zoomRunning=!0},cleverapps.UI.ZoomHandler.prototype.processZoom=function(e){this._zoomRunning&&(this._elapsedTime<this._zoomDuration?(this.setZoom(this._startZoom+(this._targetZoom-this._startZoom)*(this._elapsedTime/this._zoomDuration),!0),this._elapsedTime+=e):(this._zoomRunning=!1,this.setZoom(this._targetZoom)))},cleverapps.UI.ZoomHandler.prototype.enablePinchZoom=function(){var n=0,o=function(e,t){return e=e.getLocationInView(),t=t.getLocationInView(),Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},e=function(e){var t=r._claimedTouches;return 1===t.length?n=o(t[0],e):1<t.length&&(n=o(t[0],t[1])),!0}.bind(this),t=function(e,t){if(2<=r._claimedTouches.length){this.pinchZooming=!0;var s=o(r._claimedTouches[0],r._claimedTouches[1]),i=n-s;3<Math.abs(i)&&(n=s,this.zoomTo(this.target.zoom-85e-5*i,0)),t.stopPropagation()}
}.bind(this),s=function(){r._claimedTouches.length<2&&(this.pinchZooming=!1)}.bind(this),r=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:e,onTouchMoved:t,onTouchCancelled:s,onTouchEnded:s},this.target)};var BaseBoosterBefore=function(e){cleverapps.EventEmitter.call(this),this.id=e,this.price=cleverapps.config.prices.boosters[e][1],this.state=BaseBoosterBefore.ACTIVE_STATE,this.bonusState=BaseBoosterBefore.BONUS_EMPTY_STATE,this.isAvailable()||(this.state=BaseBoosterBefore.DISABLED_STATE)};BaseBoosterBefore.prototype=Object.create(cleverapps.EventEmitter.prototype),(BaseBoosterBefore.prototype.constructor=BaseBoosterBefore).prototype.onStart=function(){this.state===BaseBoosterBefore.USE_STATE&&cleverapps.boostersCounter.use(this.id)},BaseBoosterBefore.prototype.onGiveUp=function(){this.state===BaseBoosterBefore.USE_STATE&&(cleverapps.boostersCounter.add(this.id,1),this.state=BaseBoosterBefore.ACTIVE_STATE)},
BaseBoosterBefore.prototype.isActivated=function(){return this.state===BaseBoosterBefore.USE_STATE},BaseBoosterBefore.prototype.isBonusActivated=function(){return this.bonusState===BaseBoosterBefore.BONUS_LANTERN_STATE},BaseBoosterBefore.prototype.getActivatedStates=function(){var e=[];return this.isActivated()&&e.push(this.state),this.isBonusActivated()&&e.push(this.bonusState),e},BaseBoosterBefore.prototype.getAmount=function(){return cleverapps.boostersCounter.getAmount(this.id)},BaseBoosterBefore.prototype.setState=function(e){this.state=e,this.trigger("update")},BaseBoosterBefore.prototype.setBonusState=function(e){this.bonusState=e,this.trigger("update")},BaseBoosterBefore.prototype.use=function(){if(this.state===BaseBoosterBefore.ACTIVE_STATE)if(0<this.getAmount())this.setState(BaseBoosterBefore.USE_STATE);else if(cleverapps.user.canTakeGold(this.price)){levels.user.takeGold(this.price),cleverapps.boostersCounter.add(this.id,1)
;var e=BoostersBefore.instance&&BoostersBefore.instance.level;cleverapps.eventLogger.logEvent(cleverapps.EVENTS.HINT_USED,{hash:e.hash,amount:this.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT,{amount:1}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_BOUGHT_ITEM,{id:this.id,amount:1}),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),this.setState(BaseBoosterBefore.USE_STATE)}else cleverapps.flags.nopayments?cleverapps.Notification.create("messages:NotEnoughCoins"):new HardCurrencyShopWindow},BaseBoosterBefore.prototype.unuse=function(){this.state===BaseBoosterBefore.USE_STATE&&this.setState(BaseBoosterBefore.ACTIVE_STATE)},BaseBoosterBefore.prototype.onClick=function(){this.state===BaseBoosterBefore.USE_STATE?this.unuse():(this.use(),cleverapps.forces.isRunningForce()&&cleverapps.forces.closeRunningForce())},BaseBoosterBefore.prototype.isAvailable=function(){return cleverapps.user.checkAvailable(
BoostersBeforeConfig[this.id].available)},BaseBoosterBefore.prototype.isDisabled=function(){return this.state===BaseBoosterBefore.DISABLED_STATE||this.state===BaseBoosterBefore.UPCOMING_STATE},BaseBoosterBefore.prototype.showTutorialStep=function(e){this.isForceAvailable()?(cleverapps.boostersCounter.canUse(this.id)||cleverapps.boostersCounter.add(this.id,1),this.trigger("showForce",e)):e()},BaseBoosterBefore.prototype.isForceAvailable=function(){return this.isAvailable()&&!cleverapps.forces.isShown(this.force.id)},BaseBoosterBefore.ACTIVE_STATE=0,BaseBoosterBefore.USE_STATE=1,BaseBoosterBefore.DISABLED_STATE=4,BaseBoosterBefore.UPCOMING_STATE=7,BaseBoosterBefore.BONUS_LANTERN_STATE=2,BaseBoosterBefore.BONUS_EMPTY_STATE=6;var ComboBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_COMBO),this.force=Forces.FIRST_BOOSTERS_BEFORE};ComboBooster.prototype=Object.create(BaseBoosterBefore.prototype),(ComboBooster.prototype.constructor=ComboBooster
).prototype.giveBonus=function(){var e=this.getActivatedStates().length*ComboBooster.COMBOS_AMOUNT,t=ComboBooster.COMBOS_TIMEOUTS.slice(0,e),s=Game.currentGame.field.addRandomCombo(e,{boosterBefore:!0,timeouts:t});s<e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_COMBO_NO_PLACE,{amount:e-s}),s<=e-ComboBooster.COMBOS_AMOUNT&&this.onGiveUp()},ComboBooster.COMBOS_AMOUNT=5,ComboBooster.COMBOS_TIMEOUTS=[0,120,250,360,500,620,750,860,1e3,1100];var DiceBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_DICE),this.force=Forces.SECOND_BOOSTERS_BEFORE};DiceBooster.prototype=Object.create(BaseBoosterBefore.prototype),(DiceBooster.prototype.constructor=DiceBooster).prototype.giveBonus=function(){Game.currentGame.dice.roll(),Game.currentGame.dice.reward(),this.number=Game.currentGame.dice.number},DiceBooster.prototype.getBonusDuration=function(){return DiceBooster.BONUS_DURATION+.2*(this.number||6)},DiceBooster.BONUS_DURATION=2.6;var MagnetBooster=function(){
BaseBoosterBefore.call(this,BoostersBefore.TYPE_MAGNET),this.force=Forces.FIRST_BOOSTERS_BEFORE};MagnetBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MagnetBooster.prototype.constructor=MagnetBooster).prototype.giveBonus=function(){var e=Game.currentGame.table.getScreen(),t=cleverapps.Random.shuffle(e.cardsThatCanBeReplacedWithBoosters());if(0!==t.length){var s=t.filter(function(e){return e.isOpen()}),i=0<s.length?s[0]:t[0],n=cleverapps.extend(i.toJSON(),{marks:["magnet"]}),o=CardFactory.Create(n);o.setOwner(i.owner),o.deep=i.deep,o.screenZOrder=i.screenZOrder,e.replaceCard(i,o),e.trigger("replaceCardWithAnother",i,o),i.isOpen()&&o.flip();var r=o.marks[0];r.hide(),e.trigger("demonstrateBoosterBefore",o,function(){r.show(!0)})}else this.onGiveUp()},MagnetBooster.prototype.getBonusDuration=function(){return MagnetBooster.BONUS_DURATION},MagnetBooster.BONUS_DURATION=2.2;var MovesBooster=function(e){BaseBoosterBefore.call(this,BoostersBefore.TYPE_MOVES),
this.force=Forces.SECOND_BOOSTERS_BEFORE,e&&0===e.episodeNo&&e.levelNo<=2&&(this.state=BaseBoosterBefore.DISABLED_STATE)};MovesBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MovesBooster.prototype.constructor=MovesBooster).prototype.giveBonus=function(){var e=0;this.isActivated()&&(e+=MovesBooster.BOUGHT_MOVES_AMOUNT),this.isBonusActivated()&&(e+=MovesBooster.BONUS_MOVES_AMOUNT),Game.currentGame.setMoves(Game.currentGame.moves+e,{animate:!0,boosterBefore:!0}),Game.currentGame.beginMoves+=e},MovesBooster.BONUS_MOVES_AMOUNT=3,MovesBooster.BOUGHT_MOVES_AMOUNT=5;var MultiColorBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_MULTICOLOR),this.force=Forces.THIRD_BOOSTERS_BEFORE};MultiColorBooster.prototype=Object.create(BaseBoosterBefore.prototype),(MultiColorBooster.prototype.constructor=MultiColorBooster).prototype.giveBonus=function(){var e=this.getActivatedStates().length,t=Game.currentGame.field.addRandomMulticolor(e,{boosterBefore:!0});t<e&&(
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTER_MULTICOLOR_NO_PLACE,{amount:e-t}),this.onGiveUp())};var TwoJokersBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_TWO_JOKERS),this.force=Forces.THIRD_BOOSTERS_BEFORE};TwoJokersBooster.prototype=Object.create(BaseBoosterBefore.prototype),(TwoJokersBooster.prototype.constructor=TwoJokersBooster).prototype.giveBonus=function(){var i=Game.currentGame.table.getScreen(),e=function(e,t){if(e){var s=CardFactory.Create({feature:"wild",x:e.getPositionX(),y:e.getPositionY(),rotation:e.getRotation(),screenZOrder:e.screenZOrder});s.setOwner(e.owner),s.deep=e.deep,i.insertBeforeCard(e,s),i.trigger("insertCard",s,t?-2*cleverapps.styles.CardView.width:2*cleverapps.styles.CardView.width)}},t=i.cardsWithPossibilityOfPlacingUnderThem();e(t.filter(function(e){return e.getPositionX()<0}).pop(),!0),e(t.filter(function(e){return 0<=e.getPositionX()}).pop(),!1)},TwoJokersBooster.prototype.getBonusDuration=function(){
return TwoJokersBooster.BONUS_DURATION},TwoJokersBooster.BONUS_DURATION=1.6;var HighlightBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_HIGHLIGHT),this.force=Forces.FIRST_BOOSTERS_BEFORE};HighlightBooster.prototype=Object.create(BaseBoosterBefore.prototype),(HighlightBooster.prototype.constructor=HighlightBooster).prototype.giveBonus=function(){Game.currentGame.currentHighlighter.enable()};var EyeBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_EYE),this.force=Forces.SECOND_BOOSTERS_BEFORE};EyeBooster.prototype=Object.create(BaseBoosterBefore.prototype),(EyeBooster.prototype.constructor=EyeBooster).prototype.giveBonus=function(){this.trigger("giveBonus")},EyeBooster.prototype.getBonusDuration=function(){return 5};var MagnifierBooster=function(){BaseBoosterBefore.call(this,BoostersBefore.TYPE_HINT),this.force=Forces.THIRD_BOOSTERS_BEFORE};MagnifierBooster.prototype=Object.create(BaseBoosterBefore.prototype),(
MagnifierBooster.prototype.constructor=MagnifierBooster).prototype.giveBonus=function(){Game.currentGame.keypad.addMagnifiers(MagnifierBooster.AMOUNT),Game.currentGame.keypad.magnifiersShowUp()},MagnifierBooster.AMOUNT=5;var BoostersBefore=function(e){var t=(BoostersBefore.instance=this).level=e.level;"solitaire"===cleverapps.config.type?(this.list=[new MagnetBooster,new DiceBooster,new TwoJokersBooster],cleverapps.boostersCounter.onChangeListeners.BoostersBefore=function(){this.list.forEach(function(e){e.onChangeAmountListener()})}.bind(this)):"stacks"===cleverapps.config.subtype?this.list=[new HighlightBooster,new EyeBooster,new MagnifierBooster]:this.list=[new ComboBooster,new MovesBooster(t),new MultiColorBooster];var s=Lantern.GetStreak(this.level);if(0<s){this.lantern=Lantern.Get();for(var i=0;i<s;i++)this.list[i].setBonusState(BaseBoosterBefore.BONUS_LANTERN_STATE)}for(i=0;i<this.list.length;i++)if(!this.list[i].isAvailable()){this.list[i].setState(
BaseBoosterBefore.UPCOMING_STATE);break}};BoostersBefore.prototype.onStart=function(){this.list.forEach(function(e){e.onStart()})},BoostersBefore.prototype.onGiveUp=function(){cleverapps.lives&&this.list.forEach(function(e){e.onGiveUp()})},BoostersBefore.prototype.giveBonus=function(e){var t=this.list.filter(function(e){return 0<e.getActivatedStates().length});"match3"===cleverapps.config.type&&t.reverse();var s=t.map(function(s){return s.getActivatedStates().forEach(function(e){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BOOSTERS_EXECUTE+"_"+s.id+"_"+e)}),function(e){s.giveBonus();var t=cleverapps.styles.BoostersBefore.duration;s.getBonusDuration&&(t=s.getBonusDuration()),0===t?e():Game.currentGame.counter.setTimeout(e,1e3*t)}});cleverapps.metha.compound(e,s)},BoostersBefore.prototype.showTutorialStep=function(){var e=this.list.map(function(t){return function(e){t.showTutorialStep(e)}});cleverapps.metha.compound(function(){},e)},
BoostersBefore.prototype.getActivatedBooster=function(t){var e=this.list.filter(function(e){return e instanceof t})[0];return e&&e.isActivated()?e:void 0},BoostersBefore.GetAppropriateTypes=function(){return"solitaire"===cleverapps.config.type?[BoostersBefore.TYPE_MAGNET,BoostersBefore.TYPE_DICE,BoostersBefore.TYPE_TWO_JOKERS]:"stacks"===cleverapps.config.subtype?[BoostersBefore.TYPE_HIGHLIGHT,BoostersBefore.TYPE_EYE,BoostersBefore.TYPE_HINT]:[BoostersBefore.TYPE_COMBO,BoostersBefore.TYPE_MOVES,BoostersBefore.TYPE_MULTICOLOR]},BoostersBefore.isAvailable=function(e){return cleverapps.user.checkAvailable(BoostersBefore.AVAILABLE,e)},BoostersBefore.AVAILABLE={episode:0,level:4,projectName:["riddles","heroes","tripeaks","scramble","adventure","runes"]},cleverapps.styles.BoostersBefore={duration:.3},BoostersBefore.TYPE_COMBO=5,BoostersBefore.TYPE_MOVES=6,BoostersBefore.TYPE_MULTICOLOR=7,BoostersBefore.TYPE_MAGNET=10,BoostersBefore.TYPE_DICE=11,BoostersBefore.TYPE_TWO_JOKERS=12,
BoostersBefore.TYPE_HIGHLIGHT=13,BoostersBefore.TYPE_EYE=14,BoostersBefore.TYPE_HINT=15;var BoostersBeforeConfig={};BoostersBeforeConfig[BoostersBefore.TYPE_COMBO]={icon:bundles.reward_icons.frames.heroes_png,available:{episode:0,level:13}},BoostersBeforeConfig[BoostersBefore.TYPE_MOVES]={icon:bundles.reward_icons.frames.moves_png,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_MULTICOLOR]={icon:bundles.reward_icons.frames.multicolor_png,available:{episode:1,level:7}},BoostersBeforeConfig[BoostersBefore.TYPE_MAGNET]={icon:bundles.reward_icons.frames.magnet_png,available:{episode:0,level:14}},BoostersBeforeConfig[BoostersBefore.TYPE_DICE]={icon:bundles.reward_icons.frames.dice_png,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_TWO_JOKERS]={icon:bundles.reward_icons.frames.joker_png,available:{episode:1,level:7}},BoostersBeforeConfig[BoostersBefore.TYPE_HIGHLIGHT]={icon:bundles.reward_icons.frames.highlight,available:{episode:0,level:10}},
BoostersBeforeConfig[BoostersBefore.TYPE_EYE]={icon:bundles.reward_icons.frames.eye,available:{episode:1,level:3}},BoostersBeforeConfig[BoostersBefore.TYPE_HINT]={icon:bundles.reward_icons.frames.hint,available:{episode:1,level:7}};var BoosterBeforeAmountView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5),this.setCascadeOpacityEnabled(!0),this.booster=e,this.bg=new cc.Sprite(bundles.boosters_before.frames.booster_before_purple_button_png),this.addChild(this.bg),this.booster.isDisabled()&&this.booster.getAmount()>cleverapps.BoostersCounter.INIT_AMOUNT&&cleverapps.UI.convertToGrayScale(this.bg),this.amount=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.BOOSTER_BEFORE_AMOUNT_TEXT),this.addChild(this.amount),this.icon=new cc.Sprite(bundles.boosters_before.frames.booster_before_plus_icon_png),this.addChild(this.icon),this.update()},showActivated:function(){this.amount.visible=!1,this.icon.visible=!0,this.icon.setSpriteFrame(
bundles.boosters_before.frames.booster_before_check_icon_png),this.bg.setSpriteFrame(bundles.boosters_before.frames.booster_before_green_button_png)},showAmount:function(){var e=cleverapps.styles.BoosterBeforeAmountView;this.amount.visible=!1,this.icon.visible=!1,this.icon.setSpriteFrame(bundles.boosters_before.frames.booster_before_plus_icon_png),this.bg.setSpriteFrame(bundles.boosters_before.frames.booster_before_purple_button_png),0<this.booster.getAmount()?(this.amount.visible=!0,this.amount.setString(this.booster.getAmount()),this.amount.fitTo(e.amount.width)):this.icon.visible=!0},update:function(){this.booster.isActivated()?this.showActivated():this.showAmount(),this.visible=!this.booster.isDisabled()||this.booster.getAmount()>cleverapps.BoostersCounter.INIT_AMOUNT;var e=cleverapps.styles.BoosterBeforeAmountView;this.setContentSize2(Math.max(this.bg.width*this.bg.scale,this.amount.width*this.amount.scale),Math.max(this.bg.height*this.bg.scale,this.amount.height*this.amount.scale
)),this.amount.setPositionRound(e.amount),this.bg.setPositionRound(this.width/2,this.height/2),this.icon.setPositionRound(e.icon)}});cleverapps.styles.BoosterBeforeAmountView={amount:{x:{align:"center",dx:0},y:{align:"center",dy:4},width:55},icon:{x:{align:"center"},y:{align:"center"}}};var BoosterBeforeBonusView=cc.Sprite.extend({ctor:function(e){this._super(bundles.boosters_before.frames.booster_before_green_button_png),this.booster=e,this.icon=new cc.Sprite(bundles.boosters_before.frames.booster_before_lantern_icon_png),this.icon.setPositionRound(this.width/2,this.height/2),this.addChild(this.icon)},lanternAnimation:function(){this.scale=0,this.runAction(new cc.Sequence(new cc.DelayTime(1.1),new cc.ScaleTo(.2,1,1)))}}),BoosterBeforeView=cc.Scale9Sprite.extend({ctor:function(e,t){var s=cleverapps.styles.BoosterBeforeView;this._super(bundles.boosters_before.frames.booster_before_bg_png),this.setContentSize2(s),this.booster=e;var i=s.icon[e.id]?s.icon[e.id].dy:s.icon.dy,
n=this.icon=new cc.Sprite(this.getIconImage());if(n.scale=n.baseScale=1,n.setPositionRound(this.width/2,this.height/2+i),this.addChild(n),this.textAvailable=cleverapps.UI.generateTTFText(Messages.get("UnlockOnLevel",{level:cleverapps.humanReadableNumber(BoostersBeforeConfig[this.booster.id].available.episode,BoostersBeforeConfig[this.booster.id].available.level)}),cleverapps.styles.FONTS.BOOSTERS_BEFORE_UNLOCK||cleverapps.styles.FONTS.WINDOW_SMALL_TEXT),this.addChild(this.textAvailable,1),this.textAvailable.setPositionRound(s.textAvailable),this.textAvailable.fitTo(s.textAvailable.width),s.textAvailable.bg){var o=bundles.boosters_before.frames.booster_before_level_bg;t.isHard()&&bundles.boosters_before.frames.booster_before_level_bg_hard&&(o=bundles.boosters_before.frames.booster_before_level_bg_hard),t.isTricky()&&bundles.boosters_before.frames.booster_before_level_bg_tricky&&(o=bundles.boosters_before.frames.booster_before_level_bg_tricky),this.textAvailableBg=new cc.Scale9Sprite(o),
this.addChild(this.textAvailableBg),this.textAvailableBg.setContentSize2(s.textAvailable.bg),this.textAvailableBg.setPositionRound(s.textAvailable.bg)}if(e.state===BaseBoosterBefore.UPCOMING_STATE&&(cleverapps.UI.convertToGrayScale(n),void 0!==cleverapps.styles.BoosterBeforeView.disabled[e.id]&&(n.opacity*=cleverapps.styles.BoosterBeforeView.disabled[e.id].opacity)),e.bonusState===BaseBoosterBefore.BONUS_LANTERN_STATE){var r=new BoosterBeforeBonusView(e);r.setPositionRound(s.bonus),this.addChild(r),r.lanternAnimation()}-1===[BaseBoosterBefore.UPCOMING_STATE,BaseBoosterBefore.DISABLED_STATE].indexOf(e.state)&&(this.amount=new BoosterBeforeAmountView(e),this.amount.setPositionRound(s.amount),this.addChild(this.amount));var a=cleverapps.overrideStyles(cleverapps.styles.CoinsPriceView,s.price.styles,!0);if(this.price=new CoinsPriceView(e.price,{styles:a,font:cleverapps.styles.FONTS.BOOSTER_BEFORE_COINS_PRICE_TEXT}),this.price.setPositionRound(s.price),this.addChild(this.price),e.on(
"update",this.createListener(this.update.bind(this))),e.on("showForce",this.createListener(this.showForce.bind(this))),this.update(),e.isAvailable())cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.onClick.bind(this));else BoostersBeforeConfig[e.id].available;this.booster.onChangeAmountListener=this.createListener(this.update.bind(this))},onClick:function(){var e=this.booster.isActivated()?bundles.main.urls.booster_before_cancel_effect:bundles.main.urls.booster_before_selection_effect;cleverapps.audio.playSound(e),this.booster.onClick(),this.icon.stopAllActions(),this.icon.setScale(.95*this.icon.baseScale),this.icon.runAction(new cc.ScaleTo(.15,this.icon.baseScale).easing(cc.easeBackInOut()))},update:function(){var e=bundles.boosters_before.frames.booster_before_bg_png;this.booster.isDisabled()?e=bundles.boosters_before.frames.booster_before_bg_off_png:this.booster.isActivated()&&(e=bundles.boosters_before.frames.booster_before_bg_on_png),this.setSpriteFrame(
cc.spriteFrameCache.getSpriteFrame(e)),this.icon.setSpriteFrame(this.getIconImage()),cleverapps.UI.convertToGrayScale(this.icon,this.booster.state!==BaseBoosterBefore.UPCOMING_STATE),this.textAvailable.setVisible(this.booster.state===BaseBoosterBefore.UPCOMING_STATE),this.textAvailableBg&&this.textAvailableBg.setVisible(this.booster.state===BaseBoosterBefore.UPCOMING_STATE),this.amount&&this.amount.update(),this.price.visible=this.booster.state===BaseBoosterBefore.ACTIVE_STATE&&this.booster.getAmount()<=0,this.booster.state===BaseBoosterBefore.USE_STATE&&Messages.has("BoosterBeforeUse_"+this.booster.id)&&cleverapps.Notification.create("messages:BoosterBeforeUse_"+this.booster.id,{image:new cc.Sprite(BoostersBeforeConfig[this.booster.id].icon)})},getIconImage:function(){return this.booster.state===BaseBoosterBefore.DISABLED_STATE?bundles.boosters_before.frames.booster_before_lock_png:BoostersBeforeConfig[this.booster.id].icon},showForce:function(e){var t=this.booster.force
;cleverapps.forces.isAvailable(this,t)?(cleverapps.forces.create(this,t),cleverapps.forces.onceForceClosed=e,this.update()):e()}});cleverapps.styles.BoosterBeforeView={width:186,height:186,bonus:{x:{align:"left",dx:0},y:{align:"bottom",dy:-18}},amount:{x:{align:"right",dx:18},y:{align:"bottom",dy:-18}},price:{x:{align:"center",dx:0},y:{align:"top",dy:5},styles:{icon:{scale:.6},bg:{image:bundles.boosters_before.frames.booster_before_price_bg_png,padding:{x:20,y:8},dx:4,dy:-2},margin:3}},textAvailable:{x:{align:"center"},y:{align:"top",dy:40},width:250},disabled:{},icon:{dy:0}},cleverapps.styles.BoosterBeforeView.disabled[BoostersBefore.TYPE_DICE]={opacity:.8};var BoostersBeforeComponent=function(t){var e=cleverapps.styles.BoostersBeforeComponent,s=cleverapps.UI.generateTTFText("messages:BoostersBeforeComponent.Title",cleverapps.styles.FONTS.BOOSTERS_BEFORE_TEXT||cleverapps.styles.FONTS.WINDOW_BIG_TEXT),i=t.list.map(function(e){return new BoosterBeforeView(e,t.level)}.bind(this)),
n=new cleverapps.Layout(i,{margin:e.margin,direction:cleverapps.UI.HORIZONTAL});i.forEach(function(e,t){e.setVisible(!1),e.runAction(new cc.Sequence(new cc.DelayTime(.2+.2*t),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.boosters_before.urls.appear_sfx,{throttle:0}),e.setScale(.5),e.setVisible(!0)}),new cc.ScaleTo(.4,1,1).easing(cc.easeBackOut(2))))});var o=new cleverapps.Layout([n,s],{margin:e.contentMargin||e.margin,direction:cleverapps.UI.VERTICAL});if(o.height+=2*e.margin,t.lantern){var r=new LanternView(t.lantern,o);o.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){r.show()}),new cc.DelayTime(.2),new cc.CallFunc(function(){r.replaceParentSamePlace(cleverapps.windows.currentWindow()),r.setLocalZOrder(20)}),new cc.DelayTime(.6),new cc.CallFunc(function(){t.lantern.onGiveBonusListener()}.bind(this))))}return o};cleverapps.styles.BoostersBeforeComponent={margin:15};var BoostersBeforeHelper={animateAppear:function(e,t,s){if(s=cleverapps.once(
s||function(){}),e&&e.parent&&t.target&&t.target.parent){var i=t.target,n=cc.director.getRunningScene();e.setPosition(e.getParent().convertToNodeSpace(i.getParent().convertToWorldSpace(i.getPosition()))),e.replaceParentSamePlace(n),e.setLocalZOrder(10),e.setScale(2),e.runAction(new cc.Sequence(new cc.ScaleTo(.5,t.scale).easing(cc.easeBackOut()),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.collect_coins_effect),!1!==t.remove&&e.parent&&e.removeFromParent(!0)}))),e.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(s))),BoostersBeforeHelper.animateStars(e)}else s()},animateStars:function(e){var t=new cleverapps.Spine(bundles.game.jsons.boosters_before_json);t.setAnimation(0,"animation",!1),t.setPositionRound(e.x,e.y),e.parent.addChild(t),t.setLocalZOrder(e.getLocalZOrder()-1),t.setTimeScale(1.3),t.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.RemoveSelf))}},EyeBoosterView=cc.Node.extend({ctor:function(e,t){this._super(),this.booster=e,
this.boardView=t,this.board=this.boardView.board,this.setAnchorPoint2(),this.booster.on("giveBonus",this.giveBonus.bind(this)),cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL&&(EyeBoosterView.ANIMATION_TIME_SCALE=.6,EyeBoosterView.SINGLE_PASS_TIME=2.25)},giveBonus:function(){this.boardView.toggleElements(!1);var e=cc.director.getRunningScene().scene,t=new cleverapps.Spine(bundles.game.jsons.eye_booster_json);e.addChild(t),t.setLocalZOrder(110),t.setPositionRound(e.width/2,e.height/2),t.setAnimation(0,"show",!1),t.setCompleteListener(function(){t.setAnimation(0,"activate",!1),t.setCompleteListenerRemove(),t.setTimeScale(EyeBoosterView.ANIMATION_TIME_SCALE);var n=[];this.boardView.placeholders.forEach(function(e,i){e.forEach(function(e,t){if(!this.board.foundWordsSet[this.board.words[i]]){var s=this.boardView.createLetter(this.board.words[i][t].toUpperCase());this.boardView.letterGrid.addChild(s),s.setPositionRound(e.x,e.y+cleverapps.styles.BoardView.Letter.paddingBottom),n.push(
s)}}.bind(this))}.bind(this)),n.sort(function(e,t){return e.x-t.x}),this.audio=cleverapps.audio.playSound(bundles.game.urls.eye_booster_effect,{loop:!0}),this.runPass(n,0)}.bind(this)),cleverapps.audio.playSound(bundles.game.urls.eye_booster_start_effect)},runPass:function(e,n){if(n===EyeBoosterView.PASSES_COUNT)return cleverapps.audio.stopSound(this.audio),void this.onAllPassesFinished(e);var t=cleverapps.styles.EyeBoosterView,o=t.MIN_OPACITY_OFFSET,r=t.MAX_OPACITY_OFFSET,a=e[0].x-o,c=e[e.length-1].x+o,l=c-a,p=cleverapps.wait(e.length,this.runPass.bind(this,e,n+1));e.forEach(function(e){var t,s=((t=n%2==0?e.x:c-e.x)-o-a)/l*EyeBoosterView.SINGLE_PASS_TIME,i=(t-r-a)/l*EyeBoosterView.SINGLE_PASS_TIME-s;e.setOpacity(0),e.runAction(new cc.Sequence(new cc.DelayTime(s),new cc.FadeIn(i),new cc.FadeOut(i),new cc.CallFunc(p)))})},onAllPassesFinished:function(e){e.forEach(function(e){e.removeFromParent()}),this.boardView.showUpAnimation(void 0,{onlyElements:!0})}})
;EyeBoosterView.ANIMATION_TIME_SCALE=.8,EyeBoosterView.SINGLE_PASS_TIME=1.8,EyeBoosterView.PASSES_COUNT=2,cleverapps.styles.EyeBoosterView={MIN_OPACITY_OFFSET:300,MAX_OPACITY_OFFSET:100};var Rocket=cc.Node.extend({ctor:function(e,t,s){this._super(),this.startCell=e,this.targetCell=t,this.addChild(s.rocket),this.setVisible(!1);var i=0;s.startDX&&(i+=s.startDX),cleverapps.styles.Rocket.startDX&&(i+=cleverapps.styles.Rocket.startDX);var n=0;s.startDY&&(n+=s.startDY),cleverapps.styles.Rocket.startDY&&(n+=cleverapps.styles.Rocket.startDY),this.setPositionRound(BaseCellView.alignInTheGrid(e.x,e.y)),this.setPosition(this.getPosition().x+i,this.getPosition().y+n),this.aim(s)},aim:function(e){this.targetPos=BaseCellView.alignInTheGrid(this.targetCell.x,this.targetCell.y),this.prevPos=this.getPosition(),this.scheduleUpdate(),this.animateFly(e)},animateFly:function(e){var t=cleverapps.styles.Rocket,s=this.getPosition(),i=BaseCellView.alignInTheGrid(this.targetCell.x,this.targetCell.y),n=cc.p(s.x,
Math.max(s.y,i.y)+t.flyUp),o=cc.p(i.x,n.y),r=this.targetCell.y-this.startCell.y;if(this.targetCell.y>this.startCell.y&&Math.abs(this.targetCell.x-this.startCell.x)<=1){var a=Math.abs(r)*cleverapps.styles.BaseCellView.CELL_SIZE_PX;this.startCell.x<Field.SIZE/2?o.x+=a:o.x-=a}else if(this.startCell.x===this.targetCell.x&&this.startCell.y>this.targetCell.y){a=Math.abs(r)*cleverapps.styles.BaseCellView.CELL_SIZE_PX;n.y-=a/2,this.startCell.x<Field.SIZE/2?n.x+=a/2:n.x-=a/2,o=cc.p(n.x,i.y+cleverapps.styles.BaseCellView.CELL_SIZE_PX)}this.runAction(new cc.Sequence(new cc.DelayTime(e.delay),new cc.CallFunc(function(){this.setVisible(!0),e.onLaunch()}.bind(this)),new cc.BezierTo(e.duration,[n,o,i]).easing(cc.easeIn(1)),new cc.CallFunc(function(){this.unscheduleUpdate(),e.onArrive(function(){this.runAction(new cc.RemoveSelf)}.bind(this))}.bind(this))))},update:function(e){this._super(e),this.setRotation(180*Math.atan2(this.x-this.prevPos.x,this.y-this.prevPos.y)/Math.PI),
this.prevPos=this.getPosition()}});cleverapps.styles.Rocket={flyUp:150};var Map2d=function(e,t){cleverapps.EventEmitter.call(this),t=t||{},this.visibleBox=t.visibleBox||Map2d.VISIBLE_BOX,this.waterBorder=void 0!==t.waterBorder?t.waterBorder:Map2d.WATER_BORDER,this.regions=t.regions||{},this.decorators=new Map2dDecorators(t.decorators||[]),this.terrains=(t.terrains||[]).map(function(e){return e.split("")}),this.visibleBox.cutLeft||this.visibleBox.cutRight||(this.visibleBox.cutLeft=this.visibleBox.cutRight=(1-this.visibleBox.width)/2),e=e.map(function(e){return"string"==typeof e&&(e=e.split("").map(cleverapps.castType)),e}),this.width=e[0].length,this.height=e.length;var s=this.map(e,function(e){return e===Map2d.TILE_WATER?Map2d.TILE_WATER:void 0}),i=this.map(e,function(e){return e===Map2d.TILE_WATER?Map2d.TILE_BORDER:void 0}),n=this.map(e,function(e){return e===Map2d.TILE_WATER?void 0:e}),o=this.map(e,function(){}),r=this.map(e,function(){});this.layers=[s,i,n,o,r],this.onAdd=function(
){},this.onAnimationsAdd=function(){},this.onMove=function(){},this.onFogOpen=function(){},this.onCenterTo=function(e,t,s){},this.onAddTarget=function(e,t){},this.onDiscoverView=function(){},this.onZoomTo=function(e,t){},this.pointer={x:0,y:0},this.constructTerrains(),this.constructGrowth()};Map2d.prototype=Object.create(cleverapps.EventEmitter.prototype),(Map2d.prototype.constructor=Map2d).TILE_WATER=0,Map2d.TILE_GREEN_LEVEL_1=1,Map2d.TILE_GREEN_LEVEL_2=2,Map2d.TILE_GROW=10,Map2d.TILE_BORDER=11,Map2d.LAYER_WATER=0,Map2d.LAYER_BORDERS=1,Map2d.LAYER_GROUND=2,Map2d.LAYER_UNITS=3,Map2d.LAYER_FOG=4;var Iso={SAME:{x:0,y:0},UP_LEFT:{y:-1,x:0},UP_RIGHT:{y:0,x:1},UP_ABOVE:{y:-1,x:1},DOWN_LEFT:{y:0,x:-1},DOWN_RIGHT:{y:1,x:0},DOWN_BELOW:{y:1,x:-1},HORIZONTAL_LEFT:{y:-1,x:-1},HORIZONTAL_RIGHT:{y:1,x:1}},ISO_NEIGHBORS=[Iso.DOWN_LEFT,Iso.DOWN_RIGHT,Iso.UP_LEFT,Iso.UP_RIGHT];Map2d.prototype.getView=function(){return this.onDiscoverView()},Map2d.prototype.stop=function(){this.listAvailableUnits(
).forEach(function(e){e.clear()}),this.trigger("stop")},Map2d.prototype.setPointer=function(e,t){this.pointer.x=e,this.pointer.y=t},Map2d.prototype.isHiddenCorner=function(e,t){var s=this.width+this.height;return e+t<=s/2-s*(.5-this.visibleBox.cutLeft)-this.waterBorder||e+t>=s/2+s*(.5-this.visibleBox.cutRight)+this.waterBorder||e-t>=this.width-1-s*(1-this.visibleBox.height)/2+this.waterBorder||e-t<=1-this.height+s*(1-this.visibleBox.height)/2-this.waterBorder},Map2d.prototype.map=function(e,i){return e.map(function(e,s){return e.map(function(e,t){if(!this.isHiddenCorner(t,s))return i(e)},this)},this)},Map2d.prototype.getGround=function(e){return this.layers[Map2d.LAYER_GROUND][this.pointer.y+e.y]&&this.layers[Map2d.LAYER_GROUND][this.pointer.y+e.y][this.pointer.x+e.x]},Map2d.prototype.getTerrain=function(e,t){return void 0===e&&(e=this.pointer.x),void 0===t&&(t=this.pointer.y),this.terrains[t]&&this.terrains[t][e]||Map2d.TERRAIN_GREEN},Map2d.prototype.setTerrain=function(e,t,s){
this.terrains[t][e]=s},Map2d.prototype.getTerrainFrames=function(e,t){return"object"==typeof e&&void 0===t&&(t=this.pointer.y+e.y,e=this.pointer.x+e.x),(Map2d.TERRAIN_BUNDLES[this.getTerrain(e,t)]||bundles.tiles_green).frames},Map2d.prototype.setValue=function(e,t,s){this.layers[e][this.pointer.y+t.y][this.pointer.x+t.x]=s,this.trigger("setValue",e,this.pointer.x+t.x,this.pointer.y+t.y)},Map2d.prototype.add=function(e,t,s,i){this.layers[e][s][t]=i},Map2d.prototype.getFog=function(e,t){return this.layers[Map2d.LAYER_FOG][t]&&this.layers[Map2d.LAYER_FOG][t][e]},Map2d.prototype.remove=function(e,t,s){this.layers[e][s][t]=void 0},Map2d.prototype.isWater=function(e){return this.layers[Map2d.LAYER_WATER][this.pointer.y+e.y]&&this.layers[Map2d.LAYER_WATER][this.pointer.y+e.y][this.pointer.x+e.x]===Map2d.TILE_WATER},Map2d.prototype.isGround=function(e,t){return"object"==typeof e&&e.direction&&(t=this.pointer.y+e.y,e=this.pointer.x+e.x),this.layers[Map2d.LAYER_GROUND][t]&&-1!==[
Map2d.TILE_GREEN_LEVEL_1,Map2d.TILE_GREEN_LEVEL_2].indexOf(this.layers[Map2d.LAYER_GROUND][t][e])},Map2d.prototype.getUnit=function(e,t){return this.layers[Map2d.LAYER_UNITS][t]&&this.layers[Map2d.LAYER_UNITS][t][e]},Map2d.prototype.getUnitWithHead=function(e,t){var s=this.getUnit(e,t);return s&&s.head?s.head:s},Map2d.prototype.bfs=function(e,t,s){var i=ISO_NEIGHBORS,n=[{x:e,y:t}],o={};o[e+t*this.getWidth()]=!0;for(var r=0;r<n.length;)for(var a=n[r++],c=0;c<i.length;c++){var l=a.x+i[c].x,p=a.y+i[c].y;o[l+p*this.getWidth()]||this.isGround(l,p)&&!this.getFog(l,p)&&this.getUnit(l,p)&&this.getUnit(l,p).isMergeable(s)&&(o[l+p*this.getWidth()]=!0,n.push({x:l,y:p}))}return n},Map2d.prototype.setScreenRect=function(e){this.screenRect=e},Map2d.prototype.getScreenCenterCell=function(){if(this.screenRect)return cc.isoRectGetCenter(this.screenRect)},Map2d.prototype.getMapCenterCell=function(){return cc.p(Math.round(this.width/2),Math.round(this.height/2))},
Map2d.prototype.listAvailableGrounds=function(){for(var s=[],e=function(e,t){this.isGround(e,t)&&!this.getFog(e,t)&&s.push(cc.p(e,t))}.bind(this),t=0;t<this.getHeight();t++)for(var i=0;i<this.getWidth();i++)e(i,t);return s},Map2d.prototype.listAvailableUnits=function(s){var i=[];return this.listAvailableGrounds().forEach(function(e){var t=this.getUnit(e.x,e.y);t&&Unit.IsApplicable(s,t)&&i.push(t)},this),i},Map2d.prototype.listUnitsFromPointByCircle=function(e,t){var s=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],i=[],n=function(e,t){var s=this.getUnit(e,t);s&&this.isGround(e,t)&&!this.getFog(e,t)&&i.push(s)}.bind(this);n(e,t);for(var o=1;o<10;++o){t+=1;for(var r=0;r<4;++r)for(var a=0;a<o;++a)n(e,t),e+=s[r].x,t+=s[r].y}return i},Map2d.prototype.isEmpty=function(e,t){return this.isGround(e,t)&&!this.getUnit(e,t)&&!this.getFog(e,t)},Map2d.prototype.countEmptySlots=function(){for(var e=0,t=0;t<this.getHeight();t++)for(var s=0;s<this.getWidth();s++)this.isEmpty(s,t)&&e++;return e},
Map2d.prototype.findEmptySlot=function(e,t,n,s,i){var o=ISO_NEIGHBORS,r=function(e,t){for(var s=0;s<o.length;s++){var i=this.getUnit(e+o[s].x,t+o[s].y);if(i&&n.isMergeable(i)&&!this.getFog(e+o[s].x,t+o[s].y))return!0}}.bind(this);n&&!n.getData().unmergeable||(r=function(){return!0}),cleverapps.Random.shuffle(o);for(var a,c,l,p=!s||void 0===s.skipCheckScreen||!s.skipCheckScreen,d=s&&void 0!==s.radius?s.radius:Map2d.RADIUS_FULL,h=0;h<100&&(p||!a)&&(h<=d||!a);h++){for(var u=!1,g=0;g<=h;g++)for(var v=0;v<2;v++){var m=g;if(0<v){if(0===g)continue;m=-g}for(var f=0;f<o.length;f++){var _=e+(0===o[f].x?m:o[f].x*h),y=t+(0===o[f].y?m:o[f].y*h),w=!1;p&&(w=this.isScreenCell(_,y),u=u||w);var T=r(_,y);if(!(i&&0<i.filter(function(e){return e.x===_&&e.y===y}).length)&&this.isEmpty(_,y)){var S=cc.p(_,y);if(a=a||S,w&&(c=c||S,T))return S;T&&(l=l||S)}}}p=u}return c||l||a},Map2d.prototype.isScreenCell=function(e,t){return cc.isoRectContainsPoint(this.screenRect,e,t)},
Map2d.prototype.constructTerrains=function(){for(var e=0;e<this.getHeight();e++){this.terrains.length<=e&&this.terrains.push([]);for(var t=0;t<this.getWidth();t++)this.terrains[e].length<=t&&this.terrains[e].push(Map2d.TERRAIN_EMPTY),this.terrains[e][t]===Map2d.TERRAIN_EMPTY&&this.isGround(t,e)&&(this.terrains[e][t]=Map2d.TERRAIN_GREEN)}},Map2d.prototype.constructGrowth=function(e,t){if(void 0!==e)this.setPointer(e,t),this.getGround(Iso.SAME)===Map2d.TILE_GREEN_LEVEL_2&&(this.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_LEFT,Map2d.TILE_GROW),this.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_RIGHT,Map2d.TILE_GROW),this.getGround(Iso.DOWN_BELOW)===Map2d.TILE_GREEN_LEVEL_1&&this.setValue(Map2d.LAYER_GROUND,Iso.DOWN_BELOW,Map2d.TILE_GROW));else for(t=0;t<this.getHeight();t++)for(e=0;e<this.getWidth();e++)this.constructGrowth(e,t)},Map2d.prototype.getWidth=function(){return this.width},
Map2d.prototype.getHeight=function(){return this.height},Map2d.prototype.setDragging=function(e){this.dragging=e,this.trigger("changeDragging",e)},Map2d.prototype.showMergeBonus=function(e){this.trigger("showMergeBonus",e)},Map2d.prototype.findPath=function(e,t){var i=[{x:e.x,y:e.y,vertical:!0}],n={};n[e.x+e.y*this.getWidth()]=!0;for(var s=0,o=function(e){for(var t=[];e;)t.push(cc.p(e.x,e.y)),e=e.prevStep;return t.reverse()};s<i.length;){var r=i[s++];if(cc.pointEqualToPoint(r,t))return o(r);(r.vertical?[Iso.DOWN_RIGHT,Iso.UP_LEFT,Iso.UP_RIGHT,Iso.DOWN_LEFT]:[Iso.UP_RIGHT,Iso.DOWN_LEFT,Iso.DOWN_RIGHT,Iso.UP_LEFT]).forEach(function(e){var t=r.x+e.x,s=r.y+e.y;this.isGround(t,s)&&!n[t+s*this.getWidth()]&&void 0===this.getUnit(t,s)&&(n[t+s*this.getWidth()]=!0,i.push({x:t,y:s,vertical:0===e.x,prevStep:r}))}.bind(this))}},Object.keys(Iso).forEach(function(e){Iso[e].direction=!0}),Map2d.RADIUS_SMALL=3,Map2d.RADIUS_BIG=5,Map2d.RADIUS_FULL=9,Map2d.VISIBLE_BOX={width:.5,height:.5},
Map2d.WATER_BORDER=10,Map2d.TERRAIN_EMPTY=".",Map2d.TERRAIN_GREEN="g",Map2d.TERRAINS={g:"green",i:"ice",p:"purple",s:"sand",b:"blue"},Map2d.TERRAIN_BUNDLES={},Object.keys(Map2d.TERRAINS).forEach(function(e){var s=Map2d.TERRAINS[e],i=bundles["tiles_"+s]||bundles.tiles_green;i?(Map2d.TERRAIN_BUNDLES[e]=i)===bundles["tiles_"+s]&&Object.keys(i.frames).forEach(function(e){var t=e.replace("_"+s,"");i.frames[e]&&!i.frames[t]&&(i.frames[t]=i.frames[e])}):delete Map2d.TERRAINS[e]});var ViewReader={calcGrowType:function(e){var t=e.getTerrainFrames();return e.getGround(Iso.UP_LEFT)!==Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)!==Map2d.TILE_GREEN_LEVEL_2?t.grow12_corner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?t.grow12_both:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?t.grow12_left:t.grow12_right},calcBorderTypeUp:function(e){return e.getGround(Iso.UP_ABOVE)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_LEFT
)!==Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)!==Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.UP_ABOVE).level2_up_corner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.UP_RIGHT).level2_up_both:e.isWater(Iso.UP_LEFT)&&e.isWater(Iso.UP_RIGHT)&&e.getGround(Iso.UP_ABOVE)===Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.UP_ABOVE).level1_up_corner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.UP_RIGHT).level1_up_both:void 0},calcBorderTypeDown:function(e){return e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2||e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.DOWN_RIGHT).level1_down_both:e.isWater(Iso.DOWN_LEFT)&&e.isWater(Iso.DOWN_RIGHT)&&e.isGround(Iso.DOWN_BELOW
)?e.getTerrainFrames(Iso.DOWN_BELOW).level1_down_corner:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.DOWN_LEFT).level1_down_left_only:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.DOWN_LEFT).level1_down_left_only:e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.DOWN_RIGHT).level1_down_right_only:e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.DOWN_RIGHT).level1_down_right_only:void 0},calcBorderTypeLeft:function(e){return e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.DOWN_LEFT).level2_left_inner_last:e.getTerrainFrames(Iso.DOWN_LEFT).level2_left_inner:e.getGround(Iso.DOWN_LEFT)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(
Iso.DOWN_LEFT).level1_left_inner_last:e.getTerrainFrames(Iso.DOWN_LEFT).level1_left_inner:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_2?e.isWater(Iso.UP_ABOVE)?e.getTerrainFrames(Iso.UP_LEFT).level2_up_left_only_last:e.getTerrainFrames(Iso.UP_LEFT).level2_up_left_only:e.getGround(Iso.UP_LEFT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.UP_LEFT).level1_up_left_only_last:e.getTerrainFrames(Iso.UP_LEFT).level1_up_left_only:e.isWater(Iso.DOWN_LEFT)&&e.isWater(Iso.UP_LEFT)&&e.isGround(Iso.HORIZONTAL_LEFT)?e.getTerrainFrames(Iso.HORIZONTAL_LEFT).level1_left_corner:void 0},calcBorderTypeRight:function(e){return e.getGround(Iso.DOWN_RIGHT)===Map2d.TILE_GREEN_LEVEL_2&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_2?e.getTerrainFrames(Iso.DOWN_RIGHT).level2_right_inner_last:e.getTerrainFrames(Iso.DOWN_RIGHT).level2_right_inner:e.getGround(Iso.DOWN_RIGHT
)===Map2d.TILE_GREEN_LEVEL_1&&e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.getGround(Iso.UP_ABOVE)!==Map2d.TILE_GREEN_LEVEL_1?e.getTerrainFrames(Iso.DOWN_RIGHT).level1_right_inner_last:e.getTerrainFrames(Iso.DOWN_RIGHT).level1_right_inner:e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_2?e.isWater(Iso.UP_ABOVE)?e.getTerrainFrames(Iso.UP_RIGHT).level2_up_right_only_last:e.getTerrainFrames(Iso.UP_RIGHT).level2_up_right_only:e.getGround(Iso.UP_RIGHT)===Map2d.TILE_GREEN_LEVEL_1?e.isWater(Iso.UP_ABOVE)?e.getTerrainFrames(Iso.UP_RIGHT).level1_up_right_only_last:e.getTerrainFrames(Iso.UP_RIGHT).level1_up_right_only:e.isWater(Iso.DOWN_RIGHT)&&e.isWater(Iso.UP_RIGHT)&&e.isGround(Iso.HORIZONTAL_RIGHT)?e.getTerrainFrames(Iso.HORIZONTAL_RIGHT).level1_right_corner:void 0},unlockBorders:function(){ViewReader.lockedBorders=[]},frameBorderLocksCache:{},getFrameBorderLocks:function(e){if(ViewReader.frameBorderLocksCache[e])return ViewReader.frameBorderLocksCache[e];var t=[],
s=cleverapps.styles.ViewReader.borderLocks;return-1!==s.upBoth.indexOf(e)?(t.push(ViewReader.UP_LEFT_LOCK),t.push(ViewReader.UP_RIGHT_LOCK)):-1!==s.upLeft.indexOf(e)?t.push(ViewReader.UP_LEFT_LOCK):-1!==s.upLeft.indexOf(e)&&t.push(ViewReader.UP_RIGHT_LOCK),ViewReader.frameBorderLocksCache[e]=t},lockBorders:function(e){var t=ViewReader.getFrameBorderLocks(e);return 0===t.length?e:0<cleverapps.intersect(t,ViewReader.lockedBorders).length?void 0:(ViewReader.lockedBorders=ViewReader.lockedBorders.concat(t),e)},calcBorderType:function(e){ViewReader.unlockBorders();var t=ViewReader.calcBorderTypeUp(e),s=ViewReader.calcBorderTypeDown(e),i=ViewReader.calcBorderTypeLeft(e);return[t,ViewReader.calcBorderTypeRight(e),i,s].map(function(e){return ViewReader.lockBorders(e)}).filter(function(e){return void 0!==e})},createTopYAnchorElement:function(e){if(e.height<=cleverapps.styles.Map2dView.cell.height)return e;var t=new cc.Node;return t.setContentSize(cleverapps.styles.Map2dView.cell.width,
cleverapps.styles.Map2dView.cell.height),t.setAnchorPoint2(),e.setAnchorPoint2(.5,1),e.setPositionRound(t.width/2,t.height+1),t.addChild(e),t},hasView:function(e,t){return e===Map2d.TILE_BORDER&&0<ViewReader.calcBorderType(t).length||-1!==[Map2d.TILE_GROW,Map2d.TILE_WATER,Map2d.TILE_GREEN_LEVEL_1,Map2d.TILE_GREEN_LEVEL_2].indexOf(e)},parse:function(e,t){var s=t.getTerrainFrames();switch(e){case Map2d.TILE_GROW:return[ViewReader.createTopYAnchorElement(new cc.Sprite(ViewReader.calcGrowType(t)))];case Map2d.TILE_WATER:return[new cc.Sprite(bundles.tiles.frames.water)];case Map2d.TILE_BORDER:return(s=ViewReader.calcBorderType(t)).map(function(e){return ViewReader.createTopYAnchorElement(new cc.Sprite(e))});case Map2d.TILE_GREEN_LEVEL_1:case Map2d.TILE_GREEN_LEVEL_2:var i=(t.pointer.x+t.pointer.y)%2;return[new cc.Sprite(i?s.green_ground_1:s.green_ground_2)]}return[]},UP_LEFT_LOCK:0,UP_RIGHT_LOCK:1};cleverapps.styles.ViewReader={borderLocks:{upBoth:[],upLeft:[],upRight:[]}},function(){
var s=cleverapps.styles.ViewReader.borderLocks;cleverapps.values(Map2d.TERRAIN_BUNDLES).forEach(function(e){var t;t=e.frames,s.upBoth=s.upBoth.concat([t.level1_up_corner,t.level1_up_both,t.level2_up_corner,t.level2_up_both,t.level1_up_right_only,t.level1_up_left_only,t.level2_up_right_only,t.level2_up_left_only]),s.upLeft=s.upLeft.concat([t.level1_up_left_only_last,t.level2_up_left_only_last,t.level1_left_inner,t.level1_left_inner_last,t.level2_left_inner,t.level2_left_inner_last]),s.upRight=s.upRight.concat([t.level1_up_right_only_last,t.level2_up_right_only_last,t.level1_right_inner,t.level1_right_inner_last,t.level2_right_inner,t.level2_right_inner_last])}),s.upBoth=cleverapps.unique(s.upBoth),s.upLeft=cleverapps.unique(s.upLeft),s.upRight=cleverapps.unique(s.upRight)}();var Map2dView=cc.Node.extend({ctor:function(o){this._super(),(this.map2d=o).onDiscoverView=function(){return this}.bind(this);var e=o.visibleBox,t=o.getWidth()+o.getHeight(),
s=t*cleverapps.styles.Map2dView.cell.width/2,i=t*cleverapps.styles.Map2dView.cell.height/2;this.cutLeft=s*e.cutLeft,this.cutRight=s*e.cutRight,this.cutTop=i*(1-e.height)/2,this.setContentSize2(s-this.cutLeft-this.cutRight,i-2*this.cutTop),this.setAnchorPoint2();var r=this.layersViews=new Map2dLayersView(o);this.addChild(r);var n=this.animations=new cc.Node;n.setContentSize(this.getContentSize()),n.setPositionRound(this.width/2,this.height/2),n.setAnchorPoint2(),this.addChild(n,1),o.layers.forEach(function(e,n){e.forEach(function(e,i){e.forEach(function(e,t){o.setPointer(t,i);var s=r.getCell(n,t,i);this.createView(e,s,o)},this)},this)},this),o.decorators.createViews(),o.onAdd=function(e,t,s,i){this.createView(i,this.getCell(e,t,s),o)}.bind(this),o.onAnimationsAdd=function(e){this.createView(e,this.animations,o)}.bind(this),cleverapps.config.debugMode&&cleverapps.UI.onClick(this,function(e){var t=this.getCellByCoordinates(e);if(t){o.setPointer(t.x,t.y);var s=o.getFog(t.x,t.y),
i=this.cleanableValue(o.getUnit(t.x,t.y));console.log(t,s?s.fogBlock.id:o.isWater(Iso.SAME)?"water":"ground"+o.getGround(Iso.SAME),i)}}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0}),cleverapps.environment.isSceneWithPreview()||this.addControls(),cleverapps.UI.onClick(this,function(){InfoView.CloseInfo()},{swallowTouches:!1,ignoreOnTouchMoved:!0}),this.setVisibleRect(cc.rectScale(cc.rect(0,0,this.width,this.height),2)),this.addChild=function(){throw"Map2d.addChild is blocked after creations - map has many cell children"},o.on("showMergeBonus",this.showMergeBonus.bind(this),this)},findTouchUnit:function(e){var t=this.convertTouchToNodeSpace(e),s=this.getCellByCoordinates(t);if(s)for(var i=[{x:0,y:0},{x:-1,y:1},{x:-1,y:0},{x:0,y:1}],n=0;n<i.length;n++){var o=this.map2d.getUnitWithHead(s.x+i[n].x,s.y+i[n].y);if(o&&o.checkTouchInside(e))return o}},getUnitCenterPos:function(e,t){var s=this.map2d.getUnit(e,t),i=s&&s.onGetView();return i?this.animations.convertToNodeSpace(
i.parent.convertToWorldSpace(i.getCenterPos())):this.alignInIsometricGrid(e,t)},addControls:function(){var n,o,r,s,i,a,c=cleverapps.throttle(cleverapps.UI.DRAG_THROTTLE,function(e){s.onDragMove(e)}),l=!1;this.clickListener=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:function(e){if(l=!1,!this.isDisplayed())return!1;var t=this.findTouchUnit(e);if(!t){var s=this.convertTouchToNodeSpace(e),i=this.getCellByCoordinates(s);i&&(t=this.map2d.getFog(i.x,i.y))}return!!t&&(t.onTouchBeginEvent&&t.onTouchBeginEvent()?!(l=!0):(n=!1,o=t,r=e.getLocation(),!0))}.bind(this),onTouchMoved:function(e){var t=e.getLocation();!n&&Math.abs(t.x-r.x)+Math.abs(t.y-r.y)>cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold&&(n=!0)},onTouchEnded:function(e){n||o.onClickEvent()}},this);var p,d,h=!1;this.dragListener=cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e){if(h=!1,l)return h=!(l=!1);if(
a&&(s.onDragEnd(),a=void 0),!this.isDisplayed())return!1;var t=this.findTouchUnit(e);return!(!t||!t.isMoveable())&&(a=!1,s=t,i=e.getLocation(),p=e.getID(),d=e,!0)}.bind(this),onTouchMoved:function(e){if(!h&&e.getID()===p){var t=e.getLocation();if(!a&&Math.abs(t.x-i.x)+Math.abs(t.y-i.y)>cleverapps.styles.UI.onClick.ignoreOnTouchMovedThreshold){if(!s.onDragStart())return;a=!0}a&&c({touch:e})}},onTouchEnded:function(e){h||e.getID()!==p||a&&(s.onDragMove({touch:e}),s.onDragEnd(),a=void 0)},setEnabled:function(e){this.isEnabled()&&!e&&a&&d&&this.onTouchEnded(d),cc.EventListener.prototype.setEnabled.call(this,e)}},this),this.map2d.on("stop",this.stop.bind(this),this),cleverapps.metha.registerControl("map2d",this.createListener(this.toggleControls.bind(this)))},stop:function(){this.toggleControls(!1)},toggleControls:function(e){this.clickListener.setEnabled(e),this.dragListener.setEnabled(e)},getStableLayers:function(){return[Map2d.LAYER_WATER,Map2d.LAYER_BORDERS,Map2d.LAYER_GROUND,
Map2d.LAYER_UNITS,Map2d.LAYER_FOG]},showMergeBonus:function(e){var t=cleverapps.styles.Map2dView.mergeBonus,s=cc.getCenter(e.map(function(e){return this.getCell(Map2d.LAYER_UNITS,e.x,e.y)},this)),i=new cleverapps.Spine(bundles.merge.jsons.bonus_shining_json);i.setAnchorPoint2(),i.setPositionRound(s.x+t.x,s.y+t.y),i.setAnimation(0,"animation",!1),i.setCompleteListenerRemove(),this.animations.addChild(i)}});Map2dView.prototype.setVisibleRect=function(e){var t=this.screenRectToIso(e);cc.rectEqualToRect(t,this.map2d.screenRect)||(this.map2d.setScreenRect(t),this.layersViews.setVisibleIsoRect(t))},Map2dView.prototype.screenRectToIso=function(e){var t=this.getCellByCoordinates(e),s=Math.round(e.width/cleverapps.styles.Map2dView.cell.width),i=Math.round(e.height/cleverapps.styles.Map2dView.cell.height);return cc.rect(t.x,t.y,s,i)},Map2dView.prototype.getCellByCoordinates=function(e){var t=this.alignInIsometricGrid(0,0),s=Map2dView.ScreenToIso(e.x-t.x,e.y-t.y);return cc.p(Math.round(s.x),
Math.round(s.y))},Map2dView.ScreenToIso=function(e,t){var s=e/cleverapps.styles.Map2dView.cell.width,i=t/cleverapps.styles.Map2dView.cell.height;return{x:s+i,y:s-i}},Map2dView.IsoToScreen=function(e,t){var s=(e-t)/2;return{x:(e+t)/2*cleverapps.styles.Map2dView.cell.width,y:s*cleverapps.styles.Map2dView.cell.height}},Map2dView.prototype.getCell=function(e,t,s){return this.layersViews.getCell(e,t,s)},Map2dView.prototype.hasView=function(e,t,s){var i=this.map2d.layers[e][s]&&this.map2d.layers[e][s][t];return this.map2d.setPointer(t,s),i instanceof FogTile||i instanceof Highlight||i instanceof Unit&&!this.map2d.getFog(i.x,i.y)&&!i.isMultiCellBody()||ViewReader.hasView(i,this.map2d)||this.map2d.decorators.hasView(e,t,s)},Map2dView.prototype.createView=function(s,i,e){var t=[];s instanceof FogTile?t.push(new FogTileView(s)):s instanceof Highlight?t.push(new HighlightView(s)):s instanceof Unit?e.getFog(s.x,s.y)||s.isMultiCellBody()||t.push(new UnitView(s)):t=ViewReader.parse(s,e),t.forEach(
function(e){try{i.addChild(e)}catch(e){var t="object"!=typeof s?s:{x:s&&s.x,y:s&&s.y,type:s&&s.type,fogBlockId:s&&s.fogBlock&&s.fogBlock.id};throw new Error("Map2dView.createView - cell undefined for object - "+JSON.stringify(t)+" stack "+JSON.stringify(e.stack))}})},Map2dView.prototype.alignInIsometricGrid=function(e,t){var s=e+t+1,i=e-t+this.map2d.getHeight();return cc.p(s*cleverapps.styles.Map2dView.cell.width/2-this.cutLeft,i*cleverapps.styles.Map2dView.cell.height/2-this.cutTop)},cleverapps.overrideFonts(cleverapps.styles.FONTS,{MERGE_BONUS_TEXT:{size:45,color:cleverapps.styles.COLORS.COLOR_RED,stroke:{color:cleverapps.styles.COLORS.WHITE,size:2}}}),cleverapps.styles.Map2dView={cell:{width:174,height:100},mergeBonus:{x:0,y:30}};var Map2dCellView=cc.Node.extend({ctor:function(e,t,s){this._super(),this.map2d=e.map2d,this.mapView=e,this.cell=t,this.layerId=s,this.setCascadeOpacityEnabled(!0);var i=e.alignInIsometricGrid(t.x,t.y);this.setPositionRound(i.x,i.y)},setVisible:function(t){
this._visible!==t&&(cc.Node.prototype.setVisible.apply(this,arguments),this.parent.setVisibleDirty&&this.parent.setVisibleDirty(t),this.performRecursive(function(e){e.onCellSetVisible&&e.onCellSetVisible(t)}))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new Map2dCellView.WebGLRenderCmd(this):this._super()}});Map2dCellView.WebGLRenderCmd=function(e){this._rootCtor(e)},Map2dCellView.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),Map2dCellView.WebGLRenderCmd.prototype.constructor=Map2dCellView.WebGLRenderCmd,Map2dCellView.WebGLRenderCmd.prototype.transform=function(e,t){if(this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:this._node._position.x,ty:this._node._position.y},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}),e){var s=e._worldTransform,i=this._worldTransform;i.a=s.a,i.b=s.b,i.c=s.c,i.d=s.d,i.tx=this._transform.tx*s.a+s.tx,i.ty=this._transform.ty*s.d+s.ty}this._cacheDirty=!0};var Map2dDecorator=function(e){
cleverapps.extend(this,e)};Map2dDecorator.prototype.getLayerId=function(){var e=Game.currentGame.map;return void 0!==e.layers[Map2d.LAYER_GROUND][this.y][this.x]?Map2d.LAYER_GROUND:void 0!==e.layers[Map2d.LAYER_BORDERS][this.y][this.x]?Map2d.LAYER_BORDERS:Map2d.LAYER_WATER};var Map2dDecorators=function(e){this.decorators=[],(e||[]).forEach(function(e){bundles.map_decorators.frames[e.code]?this.decorators.push(new Map2dDecorator(e)):console.log("No frame for decorator '"+e.code+"' at x: "+e.x+", y: "+e.y)},this)};Map2dDecorators.prototype.createViews=function(){this.decorators.forEach(this.createView.bind(this))},Map2dDecorators.prototype.hasView=function(e,t,s){return this.occupied||(this.occupied={},this.decorators.forEach(function(e){this.occupied[e.getLayerId()+"_"+e.x+"_"+e.y]=!0},this)),this.occupied[e+"_"+t+"_"+s]},Map2dDecorators.prototype.createView=function(e){var t=Game.currentGame.map,s=t.getView();t.setPointer(e.x,e.y);var i=e.getLayerId(),n=s.getCell(i,e.x,e.y),o=new(
this.getViewClass())(e);return o.setLocalZOrder(1),n.addChild(o),o},Map2dDecorators.prototype.getViewClass=function(){return Map2dDecoratorView};var Map2dDecoratorView=cc.Sprite.extend({ctor:function(e){var t=bundles.map_decorators.frames[e.code];this._super(t);var s=((this.decorator=e).dx||0)*resolutionScale,i=(e.dy||0)*resolutionScale;this.setPositionRound({x:{align:"center",dx:s},y:{align:"center",dy:i}}),this.setRotation(e.rotation||0)}});cc.isoRectGetCenter=function(e){return cc.p(Math.round(e.x+e.width/2+e.height/2),Math.round(e.y+e.width/2-e.height/2))},cc.isoRectContainsPoint=function(e,t,s){var i=t-e.x,n=s-e.y,o=(i+n)/2,r=(i-n)/2;return 0<=o&&o<=e.width&&0<=r&&r<=e.height},cc.isoRectMove=function(e,t,s,i,n){return t=t||0,s=s||0,cc.rect(e.x-s+t,e.y+s+t,e.width+(i||0),e.height+(n||0))},cc.isoRectGetLines=function(e){var t,s,i={};for(t=0;t<=e.height;t+=.5)s=e.x+Math.floor(t),i[e.y-Math.ceil(t)-s]={startX:s,endX:s+e.width};return i},cc.isoRectIterate=function(e,t,s){var i,n,o,r,a,
c=cc.isoRectGetLines(e),l={};for(a in s&&s.skipRect&&(l=cc.isoRectGetLines(s.skipRect)),c){o=c[n=parseInt(a)],r=l[n];try{for(i=o.startX;i<=o.endX;)r&&r.startX<=i&&i<=r.endX?i=r.endX+1:(t(i,n+i),i++)}catch(e){throw new Error("Error cc.isoRectIterate code - "+a+" - lines - "+JSON.stringify(c)+" stack - "+JSON.stringify(e.stack))}}};var Map2dLayerView=cc.Node.extend({ctor:function(o,e){this.map2d=o,this.layerIds=cleverapps.toArray(e);var r=o.onDiscoverView();this._super(),this.setContentSize2(r.getContentSize()),this.setAnchorPoint2(),this.setPositionRound(r.width/2,r.height/2),this.cells={};var a=r.getStableLayers(),c=[];this.layerIds.forEach(function(n){this.cells[n]=o.layers[n].map(function(e,i){return e.map(function(e,t){if(r.hasView(n,t,i)||-1===a.indexOf(n)||n===Map2d.LAYER_UNITS&&o.isGround(t,i)){var s=new Map2dCellView(r,cc.p(t,i),n);return c.push(s),s}})})},this),c=c.sort(function(e,t){return e.y!==t.y?t.y-e.y:e.x!==t.x?t.x-e.x:e.layerId-t.layerId})
;var t=this.tree=new Map2dCellTree({map2d:this.map2d,nodes:c,size:this.getContentSize()});t.setPositionRound(this.width/2,this.height/2),this.addChild(t),this.visibleRect=r.screenRectToIso(cc.rectScale(cc.rect(0,0,this.width,this.height),2))},getCell:function(e,t,s){return this.cells[e][s]&&this.cells[e][s][t]},setVisibleIsoRect:function(e){var t=function(i){var n;return function(e,t){for(n=0;n<this.layerIds.length;n++){var s=this.getCell(this.layerIds[n],e,t);s&&s.setVisible(i)}}.bind(this)}.bind(this),s=this.visibleRect;s&&cc.isoRectIterate(s,t(!1),{skipRect:e}),cc.isoRectIterate(e,t(!0),{skipRect:s}),this.tree.visitVisibleDirty(),this.visibleRect=e}}),Map2dLayersView=cc.Node.extend({ctor:function(i){var e=(this.map2d=i).onDiscoverView();this._super(),this.setContentSize2(e.getContentSize()),this.setAnchorPoint2(),this.setPositionRound(e.width/2,e.height/2),this.layersViews=Map2dLayersView.LAYERS.map(function(e,t){var s=new Map2dLayerView(i,e);return this.addChild(s),s},this)
;var t=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_UPDATE,this.afterUpdate.bind(this));this.registerCleanupCallback(function(){cc.eventManager.removeListener(t)})},getCell:function(e,t,s){var i=e;return Map2d.LAYER_FOG===e&&(i=Map2d.LAYER_UNITS),this.layersViews[i].getCell(e,t,s)},setVisibleIsoRect:function(e){e=cc.isoRectMove(e,-1,3,3,4),cc.rectEqualToRect(this.visibleRect,e)||(this.visibleRectDirty=e)},afterUpdate:function(){if(this.visibleRectDirty){var s=this.visibleRect=this.visibleRectDirty;delete this.visibleRectDirty,this.layersViews.forEach(function(e,t){e.setVisibleIsoRect(s)})}}});Map2dLayersView.LAYERS=[[Map2d.LAYER_WATER],[Map2d.LAYER_BORDERS],[Map2d.LAYER_GROUND],[Map2d.LAYER_UNITS,Map2d.LAYER_FOG]];var Map2dCellTree=cc.Node.extend({ctor:function(e){this.size=e.size;this.map2d=e.map2d,this._super(),this.setContentSize2(e.size),this.setAnchorPoint2();var t=this.nodes=e.nodes;if(t.length<=Map2dCellTree.THRESHOLD)this.makeLeaves();else{var s=Math.round(
t.length/2);[t.slice(0,s),t.slice(s)].forEach(function(e){var t=new Map2dCellTree({size:this.size,nodes:e,map2d:this.map2d});t.setPositionRound(this.width/2,this.height/2),this.addChild(t)},this)}},makeLeaves:function(){this.nodes.forEach(function(e){this.addChild(e)},this)},setVisibleDirty:function(){this.visibleDirty||(this.visibleDirty=!0,this.parent.setVisibleDirty&&this.parent.setVisibleDirty())},visitVisibleDirty:function(){if(this.visibleDirty){for(var e=this.visibleDirty=!1,t=0;t<this.children.length;t++){var s=this.children[t];s.visitVisibleDirty&&s.visitVisibleDirty(),e=e||s._visible}this.setVisible(e)}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new Map2dCellTree.WebGLRenderCmd(this):this._super()}});Map2dCellTree.THRESHOLD=8,Map2dCellTree.WebGLRenderCmd=function(e){this._rootCtor(e)},Map2dCellTree.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype),
Map2dCellTree.WebGLRenderCmd.prototype.constructor=Map2dCellTree.WebGLRenderCmd,Map2dCellTree.WebGLRenderCmd.prototype.transform=function(e,t){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}),e&&(this._worldTransform=e._worldTransform),this._cacheDirty=!0};var GitButtons=function(e){cleverapps.EventEmitter.call(this),this.status=GitButtons.NO_CHANGES,this.folder=e};GitButtons.prototype=Object.create(cleverapps.EventEmitter.prototype),(GitButtons.prototype.constructor=GitButtons).prototype.setStatus=function(e){this.status!==e&&(this.status=e,this.trigger("statusChanged",this.status))},GitButtons.prototype.revert=function(){this.status!==GitButtons.CAN_PUSH&&this.status!==GitButtons.PUSH_ERROR||this.checkStatus(function(){this.status!==GitButtons.CAN_PUSH&&this.status!==GitButtons.PUSH_ERROR||cleverapps.metha.display({focus:"GitInfoWindow",action:function(e){new GitInfoWindow({status:this.gitStatus,action:"revert",
callback:function(t){var e="Are you sure to revert all local changes?";void 0!==t&&(e="Are you sure to revert file: "+t+"?"),window.confirm(e)&&(this.setStatus(GitButtons.RUNNING_COMMAND),cleverapps.RestClient.post("/gitcommands/revert",{folder:this.folder,status:this.gitStatus,file:t},function(e){"ok"===e?(this.setStatus(GitButtons.NO_CHANGES),this.checkStatus(),cleverapps.administrator&&cleverapps.administrator.log.createEntry({type:AdminLog.GIT_REVERT,data:t||this.gitStatus})):(alert("Revert error: "+JSON.stringify(e)),this.setStatus(GitButtons.REVERT_ERROR))}.bind(this),function(){this.setStatus(GitButtons.REVERT_ERROR)}.bind(this),{timeout:3e4}))}.bind(this)}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}.bind(this),!0)},GitButtons.prototype.push=function(){this.status!==GitButtons.NEED_PUSH&&this.status!==GitButtons.CAN_PUSH||this.checkStatus(function(){this.status!==GitButtons.NEED_PUSH&&this.status!==GitButtons.CAN_PUSH||cleverapps.metha.display({
focus:"GitInfoWindow",action:function(e){new GitInfoWindow({status:this.gitStatus,action:"push",callback:function(t){var e="";if("need push"!==this.gitStatus&&(e=window.prompt("Enter commit comment:","")),null!=e){var s="user: "+cleverapps.friends.getPlayer().name;""!==e&&(s=s+'\ncomment: "'+e+'"'),this.setStatus(GitButtons.RUNNING_COMMAND),cleverapps.RestClient.post("/gitcommands/push",{folder:this.folder,status:this.gitStatus,file:t,comment:s},function(e){"ok"===e?(this.setStatus(GitButtons.NO_CHANGES),this.checkStatus(),cleverapps.administrator&&cleverapps.administrator.log.createEntry({type:AdminLog.GIT_PUSH,data:t||this.gitStatus})):(alert("Push error: "+JSON.stringify(e)),this.setStatus(GitButtons.PUSH_ERROR))}.bind(this),function(){this.setStatus(GitButtons.PUSH_ERROR)}.bind(this),{timeout:3e4})}}.bind(this)}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}.bind(this),!0)},GitButtons.prototype.checkStatus=function(t,e){this.status!==GitButtons.RUNNING_COMMAND&&(
e&&this.setStatus(GitButtons.RUNNING_COMMAND),t=t||function(){},cleverapps.RestClient.get("/gitcommands/status?folder="+this.folder,{},function(e){this.gitStatus=e,"need push"===this.gitStatus?this.setStatus(GitButtons.NEED_PUSH):0<this.gitStatus.newFiles.length||0<this.gitStatus.changedFiles.length?this.setStatus(GitButtons.CAN_PUSH):this.setStatus(GitButtons.NO_CHANGES),t()}.bind(this),function(){this.setStatus(GitButtons.STATUS_ERROR),t()}.bind(this)))},GitButtons.NO_CHANGES=0,GitButtons.CAN_PUSH=1,GitButtons.NEED_PUSH=2,GitButtons.RUNNING_COMMAND=3,GitButtons.PUSH_ERROR=4,GitButtons.REVERT_ERROR=5,GitButtons.STATUS_ERROR=6;var GitButtonsView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint2(),this.gitButtons=e;var t=cleverapps.styles.GitButtonsView;this.pushButton=this.createButton(bundles.git.frames.push_icon,e.push.bind(e)),this.revertButton=this.createButton(bundles.git.frames.revert_icon,e.revert.bind(e));var s=new cleverapps.Layout([this.pushButton,
this.revertButton],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin});this.addChild(s),this.setContentSize2(s.getContentSize()),s.setPositionRound(this.width/2,this.height/2),e.checkStatus(),e.on("statusChanged",this.drawStatus.bind(this),this),this.drawStatus(),this.setPositionRound(t.position),this.pushButton.setCascadeOpacityEnabled(!0),this.pushButton.setCascadeColorEnabled(!0),this.revertButton.setCascadeOpacityEnabled(!0),this.revertButton.setCascadeColorEnabled(!0)},createButton:function(e,t){var s=cleverapps.styles.GitButtonsView;return new cleverapps.UI.Button({button_png:bundles.git.frames.regular_button,button_on_png:bundles.git.frames.regular_button_on,button_off_png:bundles.git.frames.regular_button,content:new cc.Sprite(e),fitTo:!1,contentOffset:{y:0},width:s.button.width,height:s.button.height,onClicked:t})},setButtonState:function(e,t){switch(t){case GitButtonsView.ENABLE_BUTTON:e.enable(),e.setColor(new cc.Color(255,255,255,255)),e.setOpacity(255);break
;case GitButtonsView.DISABLE_BUTTON:e.disable(),e.setColor(new cc.Color(255,255,255,255)),e.setOpacity(100);break;case GitButtonsView.ERROR_BUTTON:e.disable(),e.setColor(new cc.Color(255,0,0,255)),e.setOpacity(255)}},drawStatus:function(){switch(this.pushButton.setVisible(!0),this.revertButton.setVisible(!0),this.loading&&(this.loading.removeFromParent(),this.loading=void 0),this.gitButtons.status){case GitButtons.NEED_PUSH:this.setButtonState(this.pushButton,GitButtonsView.ENABLE_BUTTON),this.setButtonState(this.revertButton,GitButtonsView.DISABLE_BUTTON);break;case GitButtons.CAN_PUSH:this.setButtonState(this.pushButton,GitButtonsView.ENABLE_BUTTON),this.setButtonState(this.revertButton,GitButtonsView.ENABLE_BUTTON);break;case GitButtons.NO_CHANGES:this.setButtonState(this.pushButton,GitButtonsView.DISABLE_BUTTON),this.setButtonState(this.revertButton,GitButtonsView.DISABLE_BUTTON);break;case GitButtons.RUNNING_COMMAND:this.setButtonState(this.pushButton,GitButtonsView.DISABLE_BUTTON
),this.setButtonState(this.revertButton,GitButtonsView.DISABLE_BUTTON),this.pushButton.setVisible(!1),this.revertButton.setVisible(!1),this.loading=new cc.Sprite(bundles.git.frames.loading),this.loading.runAction(new cc.RepeatForever(new cc.RotateBy(5,360))),this.loading.setPositionRound(this.width/2,this.height/2),this.addChild(this.loading);break;case GitButtons.PUSH_ERROR:this.setButtonState(this.pushButton,GitButtonsView.ERROR_BUTTON),this.setButtonState(this.revertButton,GitButtonsView.ENABLE_BUTTON);break;case GitButtons.STATUS_ERROR:case GitButtons.REVERT_ERROR:this.setButtonState(this.pushButton,GitButtonsView.ERROR_BUTTON),this.setButtonState(this.revertButton,GitButtonsView.ERROR_BUTTON)}}});GitButtonsView.ENABLE_BUTTON=0,GitButtonsView.DISABLE_BUTTON=1,GitButtonsView.ERROR_BUTTON=2,cleverapps.styles.GitButtonsView={button:{width:60,height:60},margin:10,position:{x:{align:"left",dx:10},y:{align:"top",dy:-70}}};var GitInfoWindow=Window.extend({onWindowLoaded:function(e){
this.options=e,this._super({noBackground:!0,closeButton:!1,noTitleBg:!0,name:"GitInfoWindow",title:{text:"push"===e.action?"Push local changes?":"Revert local changes?",font:cleverapps.styles.FONTS.GIT_INFO_TITLE_TEXT},content:this.getContent(),buttons:this.getButtons()})},getButtons:function(){var e=cleverapps.styles.GitInfoWindow.button;return[new cleverapps.UI.Button({button_png:bundles.git.frames.regular_button,button_on_png:bundles.git.frames.regular_button_on,font:cleverapps.styles.FONTS.GIT_INFO_BUTTON_TEXT,text:"push"===this.options.action?"push all":"revert all",width:e.width,height:e.height,onClicked:function(){this.options.callback(),this.close()}.bind(this)}),new cleverapps.UI.Button({button_png:bundles.git.frames.regular_button,button_on_png:bundles.git.frames.regular_button_on,font:cleverapps.styles.FONTS.GIT_INFO_BUTTON_TEXT,text:"cancel",width:e.width,height:e.height,onClicked:this.close.bind(this)})]},generateFileLine:function(e){var t=cleverapps.styles.GitInfoWindow,
s=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.GIT_INFO_TEXT),i=new cleverapps.UI.Button({button_png:bundles.git.frames.regular_button,button_on_png:bundles.git.frames.regular_button_on,text:"push"===this.options.action?"push":"revert",font:cleverapps.styles.FONTS.GIT_INFO_BUTTON_TEXT,onClicked:function(){this.options.callback(e),this.close()}.bind(this),width:t.lineButton.width,height:t.lineButton.height}),n=t.scroll.width-i.width-t.lineMargin;return s.fitTo(n),new cleverapps.Layout([s,i],{direction:cleverapps.UI.HORIZONTAL,margin:t.scroll.width-s.width-i.width})},getContent:function(){var e,t=cleverapps.styles.GitInfoWindow,s=[];if("need push"===this.options.status){var i=cleverapps.UI.generateTTFText("Push already commited changes!",cleverapps.styles.FONTS.GIT_INFO_TEXT);i.setDimensions(t.scroll.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.push(i)}else{if(0<this.options.status.newFiles.length)for(s.push(cleverapps.UI.generateTTFText("New files:",
cleverapps.styles.FONTS.GIT_INFO_TEXT)),e=0;e<this.options.status.newFiles.length;e++)s.push(this.generateFileLine(this.options.status.newFiles[e]));if(0<this.options.status.changedFiles.length)for(s.push(cleverapps.UI.generateTTFText("Changed files:",cleverapps.styles.FONTS.GIT_INFO_TEXT)),e=0;e<this.options.status.changedFiles.length;e++)s.push(this.generateFileLine(this.options.status.changedFiles[e]))}var n=new cleverapps.Layout(s.reverse(),{direction:cleverapps.UI.VERTICAL,margin:t.margin}),o=t.scroll.height;n.height<o&&(o=n.height);var r=cleverapps.UI.createScale9Sprite(bundles.git.frames.scroll_bg,cleverapps.UI.Scale9Rect.TwoPixelXY);r.setContentSize2(t.scroll.width+2*t.scroll.bgPadding,o+2*t.scroll.bgPadding);var a=new cleverapps.UI.ScrollView(n);a.setContentSize2(t.scroll.width,o),a.setPositionRound(r.width/2,r.height/2),r.addChild(a);var c=cleverapps.UI.createScale9Sprite(bundles.git.frames.scroll_content_bg);c.setContentSize2(t.width,r.height+2*t.padding),r.setPositionRound(
c.width/2,c.height/2),c.addChild(r);var l=new cleverapps.UI.Button({button_png:bundles.git.frames.delete_button,button_on_png:bundles.git.frames.delete_button,onClicked:this.close.bind(this)});return l.setPositionRound(t.closeButton),c.addChild(l),c}});GitInfoWindow.prototype.editorWindow=!0,cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{GIT_TEXT_COLOR:new cc.Color(89,144,221,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{GIT_INFO_BUTTON_TEXT:{size:30,color:cleverapps.styles.COLORS.WHITE},GIT_INFO_TEXT:{size:25,color:cleverapps.styles.COLORS.GIT_TEXT_COLOR},GIT_INFO_TITLE_TEXT:{size:35,color:cleverapps.styles.COLORS.GIT_TEXT_COLOR}}),cleverapps.styles.GitInfoWindow={button:{width:150,height:70},scroll:{width:450,height:500,bgPadding:10},closeButton:{x:{align:"right",dx:20},y:{align:"top",dy:20}},width:600,padding:150,margin:20,lineMargin:20,lineButton:{width:100,height:44}};var UseGoldButton=cleverapps.UI.Button.extend({ctor:function(e,t){
this.price=e.price,this.filterHandler=e.filter||function(){return!0},this.clickHandler=e.onClicked,this.eventName=e.eventName,this.price&&e.canCoins&&cleverapps.missionManager.findByType(Mission.TYPE_COINS_TIME)&&(this.useCoins=!0,this.price*=UseGoldButton.RUBY_COINS_RATE),this._super({styles:t,content:this.createContent(e,t),onClicked:this.onClick.bind(this),button_images:e.button_images||cleverapps.UI.Button.Images.button_blue})},createContent:function(e,t){var s,i;return this.price?(s=new cc.Sprite(this.useCoins?e.coinImage||bundles.reward_icons.frames.reward_coin_png:e.image||bundles.reward_icons.frames.reward_gold_png),i=cleverapps.UI.generateImageText(this.useCoins?this.price+"*":this.price,e.font||cleverapps.styles.FONTS.BUTTON_TEXT)):i=cleverapps.UI.generateOnlyText("messages:UseGoldButton.free",e.font||cleverapps.styles.FONTS.BUTTON_TEXT),new cleverapps.Layout([s,i],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin})},takeCurrency:function(){
return this.useCoins?Game.currentGame&&Game.currentGame.takeCoins(this.price):cleverapps.user.takeGold(this.price)},onClick:function(){this.filterHandler()&&this.takeCurrency()&&(this.price&&cleverapps.toArray(this.eventName||[]).forEach(function(e){this.useCoins&&(e=e.replace("_ruby","_coins")),cleverapps.eventLogger.logEvent(e,{amount:this.price})},this),this.clickHandler())}});UseGoldButton.RUBY_COINS_RATE=5,cleverapps.ServerFlags=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SERVER_FLAGS);this.flags=e||[]},cleverapps.ServerFlags.prototype.reset=function(){this.flags=[],this.save()},cleverapps.ServerFlags.prototype.hasFlag=function(e){return 0<=this.flags.indexOf(e)},cleverapps.ServerFlags.prototype.setFlag=function(e){this.hasFlag(e)||(this.flags.push(e),this.save())},cleverapps.ServerFlags.prototype.clearFlag=function(e){var t=this.flags.indexOf(e);-1!==t&&(this.flags.splice(t,1),this.save())},cleverapps.ServerFlags.prototype.getInfo=function(){
return this.flags},cleverapps.ServerFlags.prototype.updateInfo=function(e,t){this.flags=e,this.save(t)},cleverapps.ServerFlags.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SERVER_FLAGS,this.flags),e||cleverapps.synchronizer.addUpdateTask("serverflags")},cleverapps.ServerFlags.PAGE_LIKED=2,cleverapps.ServerFlags.PAYER=3;var levels={reset:function(){levels.episodes.reset(),levels.episodes.setCurrentEpisode(levels.user.episode),levels.tutorial&&levels.tutorial.stop(),cleverapps.social.isLoggedIn()?cleverapps.SocialManager.onLogin():cleverapps.synchronizer.syncWhenReady()},initUser:function(){var e=!1===cleverapps.DataLoader.haveSavedData();return e&&(console.log("Creating new user"),cleverapps.synchronizer.reset()),cleverapps.user=levels.user=new levels.User(e),e},initialize:function(){cleverapps.rewardedAdsManager.init(),cleverapps.LocalizationManager.run(),cleverapps.localPushes.init(),levels.progress.init(),cleverapps.isLevels(
)&&levels.episodes.setCurrentEpisode(cleverapps.user.episode),UIScrollBarFix(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.APP_INITIALIZE),cleverapps.Shaders.initialize(),cleverapps.wideMode.refresh(),cleverapps.config.debugMode&&(-1===["spades","mergeriddles","mergeheroes"].indexOf(cleverapps.config.name)&&(cleverapps.administrator=new Administrator,cleverapps.administrator.run()),cleverapps.taskManager=new TaskManager),cleverapps.flags.update(),cleverapps.placements=new Placements,cc.renderer.assignedZStep=1e-5},User:function(e){this.onLevelStatusChanged=function(e,t){},cleverapps.User.call(this,e)}};levels.User.prototype=Object.create(cleverapps.User.prototype),levels.User.prototype.constructor=levels.User,levels.User.prototype.getProgress=function(){return cleverapps.humanReadableNumber(this.episode,this.level)-1},levels.User.prototype.loadData=function(e){cleverapps.User.prototype.loadData.call(this,e),this.episode=e.episode,this.level=e.level,this.league=this.calcLeague(),
this.progress=e.progress||0,e.uniqueStartEvent&&(this.uniqueStartEvent=e.uniqueStartEvent),this.calcRating(),this.calcExp()},levels.User.prototype.calcRating=function(){var e=this.calcLeague();this.league!==e&&(this.league=e,this.onLeagueChangeListener()),this.save()},levels.User.prototype.calcExp=function(){void 0===this.exp&&this.setExp(this.getProgress())},levels.User.prototype.isUniqueStart=function(e,t,s){var i=e+"_"+t+"_"+s;return this.uniqueStartEvent!==i&&(this.uniqueStartEvent=i,this.save(!1),!0)},levels.User.prototype.getPassAllProgress=function(){return this.progress},levels.User.prototype.isCurrentLevel=function(e,t){if(cleverapps.metha.getType()!==Metha.HOSE)return!0;var s=this.getCurrentLevel();return s.levelNo===e&&s.episodeNo===t},levels.User.prototype.isPassedLevel=function(e,t){return this.episode>t||this.episode===t&&this.level>e},levels.User.prototype.getHumanReadableNumber=function(){return cleverapps.humanReadableNumber(this.episode,this.level)},
levels.User.prototype.checkAvailable=function(e,t){e=e||{},t=t||[];var s=cc.game.config.projectName;if(e[s])return this.checkAvailable(e[s],t);if(cleverapps.config.subtype&&e[cleverapps.config.subtype])return this.checkAvailable(e[cleverapps.config.subtype],t);var i=cleverapps.User.calcSource();if(e[i])return this.checkAvailable(e[i],t);if(!cleverapps.config.debugMode&&e.registered&&this.registered+cleverapps.parseInterval(e.registered)>Date.now())return!1;if(cleverapps.flags.nosocial&&e.social)return!1;if(e.disabled)return!1;if(e.debugMode&&!cleverapps.config.debugMode)return!1;if(e.level=e.level||0,e.episode=e.episode||0,e.projectName&&(Array.isArray(e.projectName)||(e.projectName=[e.projectName]),-1===e.projectName.indexOf(s)))return!1;if(e.source&&(Array.isArray(e.source)||(e.source=[e.source]),-1===e.source.indexOf(i)))return!1;if(e.language&&cleverapps.settings.language!==e.language)return!1;if(e.payments&&cleverapps.flags.nopayments)return!1;if(t.ignoreProgress)return!0
;var n=this.episode,o=this.level;return t.future&&("merge"===cleverapps.config.type?o++:n++),n>e.episode||o>=e.level&&n===e.episode},levels.User.prototype.sendLevelPassedEvents=function(){var e=[1,3,5],s=this.getDaysSinceRegistration(),i=this.getHumanReadableNumber();[50,100,200].forEach(function(t){t+1===i&&e.forEach(function(e){s<e&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_PASS_EVENT+"_"+t+"_"+e)},this)},this)},levels.User.prototype.isPassedAll=function(){return this.episode>=levels.episodes.getAmountEpisodes()},levels.User.prototype.incLevel=function(){if(this.isPassedAll())return this.progress++,this.trigger("incLevel"),void this.save();var e=this.level,t=this.episode;levels.episodes.currentLevel=void 0,this.level++,this.level===Episode.LEVELS_PER_EPISODE&&(this.level=0,this.incEpisode()),this.trigger("incLevel"),this.calcRating(),this.save(),this.sendLevelPassedEvents(),this.onLevelStatusChanged(t,e),this.onLevelStatusChanged(this.episode,this.level),
cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ACHIEVED_LEVEL),cleverapps.User.reportRetention&&cleverapps.User.reportRetention()},levels.User.prototype.incEpisode=function(){this.episode++,this.calcRating(),this.save(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_UP),cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.FINISH_EPISODE)},levels.User.prototype.getPhysicalLevel=function(){return this.getHumanReadableNumber()},levels.User.prototype.getCurrentLevel=function(){return this.isPassedAll()?Episode.LevelChooseAlgorithm({start:5,seed:this.progress}):{episodeNo:this.episode,levelNo:this.level}},levels.User.prototype.getVirtualLevel=function(){return this.getHumanReadableNumber()+this.progress},levels.User.prototype.getVirtualDisplayLevel=function(){var e=this.getVirtualLevel(),t=cleverapps.metha.getMainObject();return t.takenLevelsAmount&&(e-=t.takenLevelsAmount()),e},levels.User.prototype.setId=function(e){this.reportChannel&&this.reportChannel(),this.id=e,
delete this.idfa,this.save(!1)},levels.User.prototype.getSaveInfo=function(){var e=cleverapps.User.prototype.getSaveInfo.call(this);return cleverapps.extend(e,{episode:this.episode,level:this.level,uniqueStartEvent:this.uniqueStartEvent,progress:this.progress})},levels.User.prototype.initializeNewPlayer=function(){cleverapps.User.prototype.initializeNewPlayer.call(this),this.episode=0,this.level=0,this.progress=0},levels.User.GOLD_FB_CONNECT_REWARD=100;var VersionChecker=function(){this.serverVersion=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SERVER_VERSION,{raw:!0}),this.clientVersion=void 0};VersionChecker.prototype.check=function(){cleverapps.RestClient.get("/",{},function(e){this.serverVersion=e,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SERVER_VERSION,e,{raw:!0})}.bind(this),function(){console.log("Error getting server version in VersionChecker!")}.bind(this))},VersionChecker.prototype.needUpdate=function(){return!!this.serverVersion&&parseInt(
cleverapps.config.version)<parseInt(this.serverVersion)},VersionChecker.prototype.isNewClientVersionAvailable=function(){return this.clientVersion&&this.clientVersion!==cleverapps.config.version},VersionChecker.prototype.isClientVersionActual=function(){return this.clientVersion&&this.clientVersion===cleverapps.config.version},VersionChecker.prototype.loadClientVersion=function(t){if(t=t||function(){},cc.sys.isNative||cleverapps.isLocalhost()||-1!==["instant","plinga","huzcom"].indexOf(cleverapps.User.calcSource()))return this.clientVersion=cleverapps.config.version,void t();var e=cleverapps.config.deployment+window.location.pathname,s=e.lastIndexOf("/");e=e.substr(0,s+1)+"version.json";var i=function(e){console.log("loaded current client version - "+e.version),this.clientVersion=e.version,t()}.bind(this);cleverapps.RestClient.get(e,{},i,function(){console.log("error loading client version from path - "+e),t()})},levels.FPS={run:function(e,t){levels.FPS.fpsInterval||(
levels.FPS.episode=e,levels.FPS.level=t,levels.FPS.fpsStatistics=[],levels.FPS.fpsTotalFrames=cc.director.getTotalFrames(),levels.FPS.fpsInterval=setInterval(function(){if(levels.FPS.fpsStatistics.length<levels.FPS.FPS_STATISTICS_MAX_LENGTH){var e=cc.director.getTotalFrames(),t=Math.round(1e3*(e-levels.FPS.fpsTotalFrames)/levels.FPS.FPS_STATISTICS_INTERVAL);60<t&&(t=60),levels.FPS.fpsStatistics.push(t),levels.FPS.fpsTotalFrames=e}else levels.FPS.stop()},levels.FPS.FPS_STATISTICS_INTERVAL))},stop:function(){if(levels.FPS.fpsInterval&&(clearInterval(levels.FPS.fpsInterval),levels.FPS.fpsInterval=!1),levels.FPS.fpsStatistics&&levels.FPS.fpsStatistics.length){levels.FPS.fpsStatistics.sort();var e=levels.FPS.fpsStatistics[Math.floor(levels.FPS.fpsStatistics.length*levels.FPS.FPS_STATISTICS_PERCENT_VALUE)];console.log("SAVE FPS: "+e),cc.sys.os!==cc.sys.OS_IOS&&void 0===cleverapps.settings.fpsMode&&(e<=levels.FPS.FPS_SWITCH_TO_LOW?(console.log("Auto switch to low fps mode!"),
cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_LOW)):(console.log("Auto switch to high fps mode!"),cleverapps.settings.setFpsMode(cleverapps.Settings.FPS_MODE_HIGH))),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_FPS,{episode:levels.FPS.episode,level:levels.FPS.level,fps:e}),levels.FPS.fpsStatistics=!1}}},levels.FPS.FPS_STATISTICS_MAX_LENGTH=15,levels.FPS.FPS_STATISTICS_PERCENT_VALUE=.1,levels.FPS.FPS_STATISTICS_INTERVAL=500,levels.FPS.FPS_SWITCH_TO_LOW=40;var NewVersionWindow=Window.extend({onWindowLoaded:function(){var e=cleverapps.styles.NewVersionWindow,t=cleverapps.UI.generateTTFText("messages:NewVersionWindow.text1",cleverapps.styles.FONTS.NEW_VERSION_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT,{version:cleverapps.versionChecker.serverVersion,title:Messages.get(cleverapps.config.title)});t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(e.dimensions),t.setAnchorPoint2();var s=cleverapps.UI.generateTTFText(
"messages:NewVersionWindow.text2",cleverapps.styles.FONTS.NEW_VERSION_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(e.dimensions),s.setAnchorPoint2();var i=new cleverapps.Layout([s,t],{direction:cleverapps.UI.VERTICAL,padding:e.padding,margin:e.margin});i.setAnchorPoint2(),this._super({title:"messages:NewVersionWindow.Title",name:"newversionwindow",content:i,button:{text:Messages.get("OK"),width:cleverapps.styles.NewVersionWindow.button.width,height:cleverapps.styles.NewVersionWindow.button.height,onPressed:function(){var e=cleverapps.config[levels.user.source]||cleverapps.config.facebook;cc.sys.openURL(e.url)},width:i.width/2},closeButton:!1})},close:function(){}});cleverapps.styles.NewVersionWindow={dimensions:{width:550,height:0},padding:{x:0,y:50},button:{},margin:40},"horizontal"===cleverapps.config.orientation&&cleverapps.increaseStylesByKoef(cleverapps.styles.RestartWindow,1.4);var WaitWindow=Window.extend({
onWindowLoaded:function(){var e=this.showLoading();e.setCascadeOpacityEnabled(!0),e.setOpacity(0),e.setVisible(!1);var t=cleverapps.styles.WaitWindow;this._super({name:"waitwindow",noBackground:!0,content:e,closeButton:!1,styles:t,notCloseByTouchInShadow:!0}),e.runAction(new cc.Sequence(new cc.DelayTime(t.delay),new cc.CallFunc(function(){e.setVisible(!0)}),new cc.FadeTo(.3,255)))},showLoading:function(){var e=new cc.Node;if(cleverapps.styles.WaitWindow.text){var t=cleverapps.UI.generateOnlyText(Messages.get("Loading")||"Loading",cleverapps.styles.FONTS.WAIT_WINDOW_TEXT);t.setPositionRound(cleverapps.styles.WaitWindow.text),e.addChild(t,1)}var s=new cleverapps.Spine(bundles.main.jsons.wait_json);return e.addChild(s),s.setAnimation(0,"idle",!0),e},closeByBackButton:function(){},popUpAnimation:function(){},closeAnimation:function(e){e()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{WAIT_WINDOW_TEXT:{size:25,color:cleverapps.styles.COLORS.WHITE,
stroke:cleverapps.styles.DECORATORS.WINDOW_WHITE_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.WHITE_TEXT_SHADOW}}),cleverapps.styles.WaitWindow=cleverapps.overrideStyles(cleverapps.styles.Window,{delay:.2,text:{x:0,y:0}},!0);var StartEpisodeWindow=Window.extend({onWindowLoaded:function(e){this.episode=e,this._super({title:"messages:StartEpisodeWindow.Title"+levels.episodes.currentEpisode,name:"startepisodewindow",content:this.getContent(),closeButton:!1,button:{width:cleverapps.styles.StartEpisodeWindow.button.width,height:cleverapps.styles.StartEpisodeWindow.button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)}}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getContent:function(){var e=cleverapps.styles.StartEpisodeWindow,t=new cleverapps.Spine(bundles.main.jsons.yellow_hi_spine_json);t.setAnimation(0,"animation",!0);var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.animation),s.addChild(t),t.setPositionRound(s.width/2,s.height/2)
;var i=cleverapps.UI.generateTTFText("messages:StartEpisodeWindow.Text"+this.episode.episodeNo,cleverapps.styles.FONTS.WINDOW_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var n,o,r,a=[s,i];return cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?(r=e.phoneMargin,n=cleverapps.UI.VERTICAL,o=e.text.phoneWidth,a.reverse()):(r=e.margin,n=cleverapps.UI.HORIZONTAL,o=e.text.width),i.setDimensions(o,0),new cleverapps.Layout(a,{direction:n,margin:r,padding:e.padding})}});cleverapps.styles.StartEpisodeWindow={animation:{width:300,height:300},phoneMargin:20,margin:40,text:{phoneWidth:600,width:400},padding:{x:0,y:40},button:{width:250,height:100}};var StuckPlayerView=cc.Node.extend({ctor:function(e){this._super();var t=cleverapps.styles.StuckPlayerView,s=new cleverapps.UI.Avatar(e);this.addChild(s);var i=cleverapps.humanReadableNumber(e.episode,e.level),n=cleverapps.UI.generateTTFText("messages:StuckWindow.player.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{level:i})
;n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(t.text.width,0),n.y=t.text.y,this.addChild(n),cleverapps.UI.wrap(this)}});cleverapps.styles.StuckPlayerView={text:{width:195,y:-120}};var StuckWindow=Window.extend({onWindowLoaded:function(e){var t,s=cleverapps.styles.StuckWindow;bundles.stuck_window.jsons.send_help_spine_json&&(t=new cleverapps.Spine(bundles.stuck_window.jsons.send_help_spine_json)).setAnimation(0,"animation",!0);var i=new cc.Node;e.forEach(function(e){i.addChild(new StuckPlayerView(e))}),cleverapps.UI.arrangeWithMargins(i.children,{direction:cleverapps.UI.HORIZONTAL,margin:s.players.margin}),cleverapps.UI.wrap(i),i.setAnchorPoint2();var n=cleverapps.UI.generateTTFText("messages:StuckWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT);n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(s.text.width,0);var o=new cc.Node;o.addChild(i),o.addChild(n),t&&o.addChild(t),cleverapps.UI.arrangeWithMargins(o.children,{margin:s.margin}),
cleverapps.UI.wrap(o),o.setAnchorPoint2(),o=cleverapps.UI.wrapWithPadding(o,s.padding),this._super({title:"messages:StuckWindow.title",name:"stuckwindow",minWidth:s.minWidth,content:o,button:{width:s.button.width,height:s.button.height,content:cleverapps.UI.generateTTFText("messages:StuckWindow.button.text",cleverapps.styles.FONTS.BUTTON_TEXT),onPressed:function(){levels.progress.sendStuckFriendsHelp(e,function(){this.closed||this.close()}.bind(this))}.bind(this)}}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},listBundles:function(){return["stuck_window"]},load:function(e,t,s){e=cleverapps.wait(2,e),this._super(e,t,s),cleverapps.UI.Avatar.preload(s,cleverapps.waitNoMore(5e3,e))}});StuckWindow.displayIfNeeded=function(){var t=levels.progress.getStuckFriends();0<t.length&&!cleverapps.flags.noviral&&cleverapps.metha.display({focus:"StuckWindow",action:function(e){new StuckWindow(t),cleverapps.metha.onceNoWindowsListener=e}})},cleverapps.styles.StuckWindow={minWidth:600,
margin:50,padding:{x:0,y:60},players:{margin:60},text:{width:650},button:{width:380,height:110}};var FinishEpisodeWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.overrideStyles(cleverapps.clone(cleverapps.styles.Window,!0),cleverapps.styles.FinishEpisodeWindow);this.episode=e.episode;var s=this.content=new cc.Node,i="messages:FinishEpisodeWindow.Text"+this.episode.episodeNo;Messages.has(i)||(i="messages:FinishEpisodeWindow.Text");var n=this.text=cleverapps.UI.generateTTFText(i,cleverapps.styles.FinishEpisodeWindow.font);if(n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setDimensions(t.width,0),s.addChild(n),t.animation){var o=new cleverapps.Spine(t.animation.json);o.setAnimation(0,"animation",!0),s.setLocalZOrder(10),s.addChild(o)}else if(t.image){var r=this.findProperBundle(this.episode),a=new cc.Sprite(bundles[r].urls.episode_finish_image);s.addChild(a),a.setPosition(s.width/2,t.image.y)}if(cleverapps.UI.arrangeWithMargins(s.children,{margin:t.margin,
x:t.width/2,y:t.padding.y}),t.text.bg){var c=new cc.Scale9Sprite(t.text.bg.image);c.setContentSize2(n.width+2*t.text.bg.padding.x,n.height+2*t.text.bg.padding.y),this.content.addChild(c),c.setPositionRound(n.getPosition()),c.setLocalZOrder(n.getLocalZOrder()-1)}cleverapps.UI.wrap(s),s.setAnchorPoint2(),this._super({title:"messages:FinishEpisodeWindow.Title",name:"finishepisodewindow",content:s,closeButton:!0,noBackground:t.noBackground,button:{width:t.Button.width,height:t.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this),bottomPadding:t.BottomButton.bottomPadding},buttons:this.getButtons(),shareCheckBox:this.getShareOptions(),styles:t})},onShow:function(){this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible&&cleverapps.audio.playSound(bundles.main.urls.congratulate_sfx||bundles.game.urls.win_effect)}.bind(this))))},getButtons:function(){var e=[],t=ShareBonusButton.create(this.getShareOptions());return t&&e.push(t),e},
getShareOptions:function(){return{shareBonus:cleverapps.ShareBonus.SHARES.finishEpisode,shareId:cleverapps.ShareBonus.SHARES.finishEpisode.id,toReplace:{episodeTitle:this.episode.getBundle().title||this.episode.episodeNo+1}}},findProperBundle:function(e){if(!cleverapps.styles.FinishEpisodeWindow.animation){for(var t=[],s=0;s<10;s++){var i="finish_episode_"+s,n=i+"_"+cleverapps.settings.language;if(bundles[n])t.push(n);else{if(!bundles[i])break;t.push(i)}}return t[e.episodeNo%t.length]}},listBundles:function(e){var t=["finish_episode_window"],s=this.findProperBundle(e.episode);return s&&t.push(s),t}});cleverapps.styles.FinishEpisodeWindow={width:600,height:740,text:{y:165,Dimensions:{y:300}},margin:80,padding:{y:50},image:{y:500,width:700},Button:{width:280,height:110},font:cleverapps.styles.FONTS.WINDOW_TEXT};var HelpFromFriendsWindow=Window.extend({onWindowLoaded:function(e,t){var s=this.styles=cleverapps.styles.HelpFromFriendsWindow;s[e.type]&&(s=cleverapps.overrideStyles(
cleverapps.clone(s,!0),s[e.type]));var i=s.height,n=s.width,o=new cc.Node;o.setAnchorPoint(.5,.5);var r=new cc.Node;e.buy?r.setContentSize2(s.container.buy):r.setContentSize2(s.container);var a=new cleverapps.Spine(bundles.help_from_friends.jsons.help_from_friends_json);a.setSkin(cc.game.config.projectName),a.setAnimation(0,e.type,!0),r.addChild(a),e.buy?a.setPositionRound(s.animation.buy):a.setPositionRound(s.animation),o.addChild(r),o.setContentSize2(n,i);var c=cleverapps.UI.generateTTFText("messages:helpFromFriends."+e.type+".text",s.text.font,{amount:e.amount});c.setDimensions(n,0),c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),c.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),o.addChild(c);var l=cleverapps.UI.arrangeWithMargins([c,r],{direction:cleverapps.UI.VERTICAL,margin:s.margin.y,x:s.width/2,y:s.margin.bottom});o.setContentSize2(s.width,l+s.margin.top);var p,d=e.amount,h=function(){cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),
this.closeAnimationCallbacks.push(function(){t(p,e)}),this.close(),e.event&&cleverapps.eventLogger.logEvent(e.event)}.bind(this);if(e.buy){var u=s.animation.buy.person,g=new cleverapps.Spine(u.json,u.scale);g.setAnimation(0,u.animation,!0),r.addChild(g),g.setPositionRound(u),p=new cleverapps.UI.Button({width:s.button.buy.width,height:s.button.buy.height,content:this.getBuyButtonContent(e.price),onClicked:function(){levels.user.takeGold(e.price)&&h()}})}else p=new BonusButton({styles:s.button,reward:d,rewardIcon:e.icon,text:"messages:helpFromFriends."+e.type+".Button.text",onClick:function(){if(e.request)cleverapps.social.inviteRandomFriends(h,"helpInviteFriends");else if(e.video){if(!cleverapps.rewardedAdsManager.isAvailable())return void cleverapps.Notification.create("messages:AdsUnavailable");cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.createListener(h))}}.bind(this)});this._super({title:"messages:helpFromFriends."+e.type+".title",
name:"helpfromfriendswindow",content:o}),p.setPositionRound(this.window.width/2,p.height/2+s.button.Margin.y),this.window.addChild(p);var v=bundles.help_from_friends.urls["window_effect_"+e.type]||bundles.main.urls.window_effect;cleverapps.audio.playSound(v)},getBuyButtonContent:function(e){var t=cleverapps.styles.HelpFromFriendsWindow.button.buy,s=new cc.Node;s.setAnchorPoint(.5,.5);var i=new cc.Sprite(bundles.menubar.frames.coin_png);i.setScale(t.coin.scale),s.addChild(i);e=cleverapps.UI.generateTTFText(e,cleverapps.styles.FONTS.BUTTON_TEXT);return s.addChild(e),cleverapps.UI.arrangeWithMargins(s.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:t.buyMargin}),cleverapps.UI.wrap(s),s}});HelpFromFriendsWindow.isAvailable=function(e){if(!cleverapps.user.checkAvailable(HelpFromFriendsWindow.AVAILABLE))return!1;if(e.buy&&!levels.user.canTakeGold(e.price))return!1;if(e.video&&!cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED))return!1
;var t=HelpFromFriendsWindow.load()[e.storageKey||e.type]||0;return Date.now()-t>cleverapps.parseInterval(e.interval)},HelpFromFriendsWindow.chooseMovesHelp=function(){var e=.12;if(config.debugMode&&(e=5),Math.random()>e)return!1;var t=[HelpFromFriendsWindow.TYPES.addmoves,HelpFromFriendsWindow.TYPES.addmovesvideo].filter(function(e){return HelpFromFriendsWindow.isAvailable(e)});return 0!==t.length&&cleverapps.Random.choose(t)},HelpFromFriendsWindow.showIfCanMoves=function(t){var s=HelpFromFriendsWindow.chooseMovesHelp();s&&cleverapps.metha.display({focus:"HelpFromFriendsWindow.moves",action:function(e){HelpFromFriendsWindow.create(s,t),cleverapps.metha.onceNoWindowsListener=e}})},HelpFromFriendsWindow.showIfCan=function(e,t){HelpFromFriendsWindow.isAvailable(e)&&HelpFromFriendsWindow.create(e,t)},HelpFromFriendsWindow.create=function(t,s){var e=HelpFromFriendsWindow.load();e[t.storageKey||t.type]=Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.HELP_FROM_FRIENDS,e),
config.debugMode&&(HelpFromFriendsWindow.TYPES.addmoves.interval="1 minute",HelpFromFriendsWindow.TYPES.addlivesvideo.interval="1 minute",HelpFromFriendsWindow.TYPES.addcoinsvideo.interval="1 minute"),cleverapps.flags.reduceAds&&t.amountReduced&&(t.amount=t.amountReduced),cleverapps.eventLogger.logEvent(t.show),new HelpFromFriendsWindow(t,function(e){s&&s(e,t),t.success.forEach(function(e){cleverapps.eventLogger.logEvent(e)})})},HelpFromFriendsWindow.load=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.HELP_FROM_FRIENDS)||{}},HelpFromFriendsWindow.TYPES={showhint:{type:"showhint",interval:"1 day",amount:1,request:!0,icon:!1,success:[cleverapps.EVENTS.HINT_FOR_INVITE_SUCCESS],show:cleverapps.EVENTS.HINT_FOR_INVITE_SHOW},addmoves:{type:"addmoves",storageKey:"addmoves",interval:"1 hour",amount:3,buy:!0,price:50,icon:"#main-moves_icon.png",success:[cleverapps.EVENTS.MOVES_FOR_BUY_SUCCESS],show:cleverapps.EVENTS.MOVES_FOR_BUY_SHOW},addmovesvideo:{
type:"addmovesvideo",storageKey:"addmoves",interval:"1 hour",amount:3,video:!0,icon:"#main-moves_icon.png",success:[cleverapps.EVENTS.MOVES_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_MOVES],show:cleverapps.EVENTS.MOVES_FOR_VIDEO_SHOW},addlivesvideo:{type:"addlivesvideo",interval:"30 minutes",amount:1,video:!0,icon:bundles.help_from_friends.frames.add_lives_icon,success:[cleverapps.EVENTS.LIVES_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_LIVES],show:cleverapps.EVENTS.LIVES_FOR_VIDEO_SHOW},addcoinsvideo:{type:"addcoinsvideo",interval:"30 minutes",amount:30,amountReduced:10,video:!0,success:[cleverapps.EVENTS.COINS_FOR_VIDEO_SUCCESS,cleverapps.EVENTS.REWARDED_ADD_COINS],show:cleverapps.EVENTS.COINS_FOR_VIDEO_SHOW}},HelpFromFriendsWindow.ADD_MOVES_CLEAR_INTERVAL="30 minutes",HelpFromFriendsWindow.AVAILABLE={episode:0,level:9},"merge"===cleverapps.config.type&&(HelpFromFriendsWindow.AVAILABLE={disabled:!0}),HelpFromFriendsWindow.prototype.listBundles=function(){var e=[
"help_from_friends"];return-1!==["adventure","runes"].indexOf(cleverapps.config.name)&&e.push("dialogues"),e},cleverapps.styles.HelpFromFriendsWindow={text:{font:cleverapps.styles.FONTS.WINDOW_TEXT,y:110,dimension:{y:150}},container:{width:200,height:180,buy:{width:200,height:280}},animation:{buy:{x:240,y:110,person:{x:-60,y:110,scale:.8,json:bundles.dialogues.jsons.default_json,animation:"animation"}},x:100,y:80},width:620,y:70,margin:{bottom:70,y:30,top:60},button:{width:320,height:120,buy:{width:260,height:100,buyMargin:20,coin:{scale:1}},Text:{font:cleverapps.styles.FONTS.BUTTON_TEXT,offsetX:0,offsetY:18},RewardText:{font:cleverapps.styles.FONTS.SHARE_BUTTON_REWARD_TEXT,offsetX:-18,offsetY:-24},RewardCoins:{scale:.5,offsetX:20,offsetY:-24},Margin:{y:50}}};var BeatFriendView=cc.Node.extend({ctor:function(e){this._super(),this.setAnchorPoint(.5,.5);var t=new cleverapps.UI.Avatar(e);this.addChild(t),this.avatar=t,this.setContentSize(t.width*t.scale,t.height*t.scale),
t.setPositionRound(this.width/2,t.height/2);var s=new cc.Sprite(bundles.main.frames.levelstart_cup_1);s.setPositionRound(this.avatar.width+cleverapps.styles.BeatFriendView.Cup.Margin.x,this.avatar.y),s.setLocalZOrder(1),this.addChild(s),this.cup=s}});cleverapps.styles.BeatFriendView={Cup:{Margin:{x:10}}};var BeatFriendWindow=Window.extend({onWindowLoaded:function(e,t){this.friendId=e,this.friend=cleverapps.friends.getById(e),this.level=t,cleverapps.social.sendActivity&&cleverapps.social.sendActivity(cleverapps.Social.ACTIVITY.PASSED_FRIEND,{userName:cleverapps.friends.getPlayer().name,friendName:this.friend.name});var s=cleverapps.styles.BeatFriendWindow,i=new cc.Node;i.setAnchorPoint(.5,.5),i.setContentSize(s.width,s.height),this.content=i;var n=cleverapps.UI.generateTTFText("messages:LevelFriendBeatWindow.text",cleverapps.styles.FONTS.WINDOW_TEXT,{friendName:this.friend.name});n.setDimensions(s.Text.width,0),n.setPositionRound(i.width/2,i.height-n.height/2+s.Text.Margin.y),
n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(n);var o=new cc.Sprite(bundles.beatfriendwindow.frames.beat_friend_bg_png);o.setScale(s.bg.scale),o.setPositionRound(i.width/2+s.bg.offsetX,o.height*o.scale/2+s.bg.offsetY),i.addChild(o),this.bg=o,this.addAvatars(),this._super({title:"messages:LevelFriendBeatWindow.title",name:"beatfriendwindow",content:i,buttons:this.listButtons()}),cleverapps.audio.playSound(bundles.main.urls.window_effect),this.customize()},customize:function(){},addAvatars:function(){var e=this.content,t=new BeatFriendView(cleverapps.friends.getById(this.friendId)),s=new BeatFriendView(cleverapps.friends.getPlayer());e.addChild(t),e.addChild(s);var i=cleverapps.styles.BeatFriendWindow;t.setPositionRound(e.width/2+i.Animation.Friend.Margin.x,this.bg.y+i.Animation.Friend.Margin.y),t.originalPosition=t.getPosition(),s.setPositionRound(e.width/2+i.Animation.User.Margin.x,this.bg.y+i.Animation.User.Margin.y),s.originalPosition=s.getPosition(),
this.friend=t,this.user=s},onShow:function(){var r=this.user;r.stopAllActions(),r.setPositionRound(this.user.originalPosition),r.scale=1,r.cup.opacity=0,r.cup.scale=0;var e=cleverapps.styles.BeatFriendWindow.Animation;[cc.pRound(e.User.MoveBy[0].x,e.User.MoveBy[0].y),cc.pRound(e.User.MoveBy[1].x,e.User.MoveBy[1].y),cc.pRound(e.User.MoveBy[2].x,e.User.MoveBy[2].y)].forEach(function(e,t){r.runAction(new cc.Sequence(new cc.DelayTime(.4*t*1.5+.2),new cc.CallFunc(function(e,t){var s=r.getPosition(),i=cc.pRound(s.x+e.x,s.y+e.y),n=cc.pRound((s.x+2*i.x)/3,(s.y+2*i.y)/3+e.x*(t?1.2:2)),o=cc.pRound((s.x+n.x)/2,(s.y+n.y)/2);r.runAction(new cc.Spawn(new cc.BezierTo(1.5*(t?.5:.4),[o,n,i])))}.bind(this,e,2===t))))}),r.runAction(new cc.Sequence(new cc.DelayTime(1.2*1.5+.2),new cc.ScaleTo(.3*1.5,1.4).easing(cc.easeBackOut()),new cc.CallFunc(function(){r.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.5,1.45),new cc.ScaleTo(.5,1.4))))}))),r.cup.runAction(new cc.Sequence(new cc.DelayTime(
2.3),new cc.Spawn(new cc.ScaleTo(.3*1.5,1).easing(cc.easeBackOut()),new cc.FadeIn(.3*1.5))));var t=void 0===BeatFriendWindow.SOUND_DELAY?2.3:BeatFriendWindow.SOUND_DELAY;this.runAction(new cc.Sequence(new cc.DelayTime(t),new cc.CallFunc(function(){cleverapps.audio.playSound(bundles.main.urls.beat_friend_effect)})));var s=this.friend;s.stopAllActions(),s.setPositionRound(s.originalPosition),s.scale=1.4,s.cup.visible=!1,s.runAction(new cc.Sequence(new cc.DelayTime(1.7),new cc.Spawn(new cc.ScaleTo(.3*1.5,1),new cc.MoveBy(.3*1.5,cc.pRound(e.Friend.MoveBy.x,e.Friend.MoveBy.y)))))},onHide:function(){this.user&&(this.user.stopAllActions(),this.user.cup&&this.user.cup.stopAllActions()),this.friend&&this.friend.stopAllActions()},listButtons:function(){if(this.level.isRegular()){var e=ShareBonusButton.create({shareBonus:cleverapps.ShareBonus.SHARES.beatFriend,toReplace:{levelNo:levels.user.getProgress(),friendId:this.friendId},callback:function(){this.close()}.bind(this)});if(e)return[e]}
var t=cleverapps.styles.BeatFriendWindow;return[new BottomButton(this,{width:t.Button.width,height:t.Button.height,text:Messages.get("OK"),onPressed:this.close.bind(this)})]}});BeatFriendWindow.prototype.listBundles=function(){return["beatfriendwindow"]},BeatFriendWindow.AVAILABLE={episode:0,level:5},cleverapps.styles.BeatFriendWindow={width:600,height:600,bg:{offsetX:0,offsetY:80,scale:2},Button:{width:280,height:110,Margin:{x:26}},Animation:{User:{MoveBy:{0:{x:25,y:10},1:{x:35,y:10},2:{x:230,y:20}},Margin:{x:-200,y:-50}},Friend:{MoveBy:{x:-40,y:-20},Margin:{x:-50,y:-40}}},Text:{Margin:{y:-80},width:500},share:{}};var FinisherWindow=Window.extend({onWindowLoaded:function(){var e=this.generateContent();this._super({title:"messages:FinisherWindow.title",name:"finisherwindow",content:e,button:{width:cleverapps.styles.FinisherWindow.Button.width,height:cleverapps.styles.FinisherWindow.Button.height,text:Messages.get("FinisherWindow.Button.text"),onPressed:function(){cc.sys.openURL(
cleverapps.bySource(cleverapps.config.helpURL))}}}),cleverapps.audio.playSound(bundles.game.urls.win_effect),this.addChild(new Fireworks)},generateContent:function(){var e=cleverapps.styles.FinisherWindow,t=new cc.Node;t.setAnchorPoint(.5,.5),this.content=t;var s=function(e){var t={android:bundles.store_links.urls.android_png,ios:bundles.store_links.urls.ios_png,amazon:bundles.store_links.urls.amazon_png}[e],s=cleverapps.config[e]&&cleverapps.config[e].url;if(s&&t){var i=new cc.Sprite(t);return cleverapps.UI.applyHover(i),cleverapps.UI.onClick(i,function(){cc.sys.openURL(s)}),i}};this.addText("messages:FinisherWindow.GroupText");var i=cleverapps.User.calcSource();if(cc.sys.isNative||cleverapps.isInstant()||-1!==["mobile_ok","web_ok","mobile_vk","web_vk","web_mm","mobile_mm"].indexOf(i)){var n=s(i);n&&this.addButtons([n]),this.addText("messages:FinisherWindow.AllAndStoreText")}else{var o=["android","ios","amazon"].map(s).filter(function(e){return void 0!==e});0<o.length&&(
this.addButtons(o.slice(0,2)),this.addText("messages:FinisherWindow.StoreText")),this.addText("messages:FinisherWindow.AllPassedText")}return cleverapps.UI.arrangeWithMargins(t.getChildren(),{direction:cleverapps.UI.VERTICAL,margin:e.Text.margin,y:e.bottomPadding.y}),cleverapps.UI.wrap(t),t=cleverapps.UI.wrapWithPadding(t,e.padding)},addText:function(e){var t=cleverapps.styles.FinisherWindow.Text,s=cleverapps.UI.generateTTFText(e,t.font);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(t.width,0),this.content.addChild(s)},addButtons:function(e){var t=cleverapps.styles.FinisherWindow,s=new cc.Node;e.forEach(function(e){s.addChild(e)}),cleverapps.UI.arrangeWithMargins(s.getChildren(),{direction:cleverapps.UI.HORIZONTAL,margin:t.margin}),cleverapps.UI.wrap(s),s=cleverapps.UI.wrapWithPadding(s,{x:0,y:10}),this.content.addChild(s)}});FinisherWindow.prototype.listBundles=function(){return["store_links"]},cleverapps.styles.FinisherWindow={bottomPadding:{y:0},padding:{x:0,
y:10},GroupInfo:{width:450,heigth:70},Text:{font:cleverapps.styles.FONTS.SMALL_TEXT_BROWN,paddingTop:10,paddingBottom:10,width:550,margin:10},Button:{width:460,height:100},paddingTop:25,paddingBottom:50,width:500,margin:30},CustomSyncers.extractors.result=function(e){if(cleverapps.config.results){var t=[];if(e)t.push(e);else for(var s=cleverapps.user.episode;0<=s;s--)if(!cleverapps.userresult.isEmpty(s)){var i=cleverapps.userresult.getEpisodeInfo(s);i.episodeNo=s,t.push(i)}return 0<t.length?t.map(function(e){return{episode:e.episodeNo,scores:JSON.stringify(UserResult.ParseLib.objToArray(e.scores)),stars:JSON.stringify(UserResult.ParseLib.objToNumber(e.stars))}}):void 0}},CustomSyncers.importerData.result=function(e){cleverapps.config.results&&e.forEach(function(e){var t=e.episode,s=UserResult.ParseLib.parseScores(e.scores),i=UserResult.ParseLib.parseStars(e.stars);Object.keys(s).forEach(function(e){i.hasOwnProperty(e)&&cleverapps.userresult.updateLevel(t,e,s[e],i[e],{force:!0,
skipUpdate:!0})})})},levels.GameHints=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LEVEL_HINTS);this.usedHints="number"==typeof e?e:0},levels.GameHints.prototype.reset=function(){this.isCurrentLevel()&&(this.usedHints=0,this.save())},levels.GameHints.prototype.isCurrentLevel=function(){return Game.currentGame&&Game.currentGame.level.isCurrentLevel()},levels.GameHints.prototype.addHint=function(){this.isCurrentLevel()&&(this.usedHints++,this.save())},levels.GameHints.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LEVEL_HINTS,this.usedHints)};var Lantern=function(e){this.mission=e,this.onGiveBonusListener=function(){},this.load()};Lantern.prototype.isActive=function(e){return e?e.isCurrentLevel():levels.user.isCurrentLevel(cleverapps.environment.levelNo,cleverapps.environment.episodeNo)},Lantern.getMaxStreak=function(){return 3},Lantern.prototype.giveBonus=function(n){var o=this.getCurrentStreak();cleverapps.audio.playSound(
bundles.game.urls.lanterngivebonus_effect),Game.currentGame.counter.setTimeout(function(){var e=Lantern.BONUSES_BY_SERIA[o];for(var t in e){if(t===Lantern.BONUS_TYPES.HEROES){var s=Game.currentGame.field.addRandomCombo(e[t]);s<e[t]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LANTERN_COMBO_NO_PLACE,{amount:e[t]-s})}if(t===Lantern.BONUS_TYPES.MULTICOLOR){var i=Game.currentGame.field.addRandomMulticolor(e[t]);i<e[t]&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LANTERN_MULTICOLOR_NO_PLACE,{amount:e[t]-i})}t===Lantern.BONUS_TYPES.MOVES&&(Game.currentGame.setMoves(Game.currentGame.moves+e[t],{animate:!0}),Game.currentGame.beginMoves+=e[t])}n()}.bind(this),1e3*cleverapps.styles.Lantern.duration),this.onGiveBonusListener()},Lantern.prototype.save=function(){this.mission.result=0,this.mission.update(this.streak)},Lantern.prototype.load=function(){this.streak=this.mission.result,this.savedStreak=this.streak,this.beforeShownProgress=this.streak},
Lantern.prototype.getCurrentStreak=function(){return this.savedStreak},Lantern.prototype.restoreSavedStreak=function(){this.streak=this.savedStreak,this.save()},Lantern.prototype.onStart=function(){this.savedStreak=this.streak,this.streak=0,this.save()},Lantern.prototype.onWin=function(){this.streak=Math.min(this.savedStreak+1,Lantern.getMaxStreak()),this.savedStreak=this.streak,this.save()},Lantern.prototype.onLose=function(){this.streak=0,this.savedStreak=0,this.beforeShownProgress=0,this.save()},Lantern.Get=function(){return cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN)&&cleverapps.missionManager.getRunningMission(Missions.SEMAPHORE_CUSTOM_LANTERN).logic.lantern},Lantern.IsActive=function(e){var t=Lantern.Get();return t&&t.isActive(e)},Lantern.GetStreak=function(e){var t=Lantern.Get();return t&&t.isActive(e)&&0<t.streak?t.streak:0},Lantern.BONUS_TYPES={},Lantern.BONUS_TYPES.HEROES="heroes",Lantern.BONUS_TYPES.MULTICOLOR="multicolor",
Lantern.BONUS_TYPES.MOVES="moves",Lantern.BONUSES_BY_SERIA={1:{heroes:5},2:{heroes:5,moves:3},3:{heroes:5,moves:3,multicolor:1}},cleverapps.styles.Lantern={duration:.4};var LanternView=cc.Node.extend({ctor:function(e,t){this._super(),this.lantern=e,this.setAnchorPoint2(),this.setLocalZOrder(2),this.styles=cleverapps.styles.LanternView,this.animation=new cleverapps.Spine(bundles.lantern.jsons.lantern_game_json),this.addChild(this.animation),this.setContentSize2(this.animation.getContentSize()),this.animation.setPositionRound(this.width/2,this.height/2),(t=t||cc.director.getRunningScene().fieldView).addChild(this),this.lantern.onGiveBonusListener=this.createListener(this.hide.bind(this))},show:function(){this.animation.setAnimation(0,"idle_"+this.lantern.getCurrentStreak(),!0);var e=this.getParent().convertToNodeSpace(cc.p(-this.width,0));e.x||(e.x=0),e.y=this.styles.show.y;var t=1/this.parent.scale,s=this.styles.offset.x*(t<1?t:1),i=this.styles.offset.y*(t<1?t:1),n=cc.p(
this.parent.width/2+s,this.parent.height/2+i);this.setPositionRound(e),"heroes"===cleverapps.config.name?this.runAction(new cc.MoveTo(.5,n)):(this.setRotation(45),this.runAction(new cc.Spawn(new cc.MoveTo(.5,n),new cc.RotateTo(.5,0)))),cleverapps.audio.playSound(bundles.game.urls.lanternshow_effect)},hide:function(){var t=this.getParent().convertToNodeSpace(cc.p(-this.width,0));t.y=this.styles.hide.y,this.animation.setCompleteListener(function(){this.animation.setAnimation(0,"idle_"+this.lantern.getCurrentStreak(),!0);var e=new cc.Spawn(new cc.MoveTo(.5,t),new cc.RotateTo(.4,-45));"heroes"===cleverapps.config.name&&(e=new cc.MoveTo(.5,t)),this.runAction(new cc.Sequence(e,new cc.RemoveSelf))}.bind(this)),this.animation.setAnimation(0,"out_"+this.lantern.getCurrentStreak(),!1),cleverapps.audio.playSound(bundles.game.urls.lanternhide_effect)},listNodeBundles:function(){return["lantern"]}});cleverapps.styles.LanternView={offset:{x:0,y:150},show:{y:100,delay:1},hide:{y:1e3}}
;var FriendSorter=function(){this.data=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SORTER),this.data||(this.data={}),cleverapps.config.debugMode&&(FriendSorter.PRIVACY_INTERVAL="1 minute"),this.update()};FriendSorter.PRIVACY_INTERVAL="1 day",FriendSorter.prototype.update=function(){var e={},t=Date.now(),s=!1;for(var i in this.data)this.data[i]+cleverapps.parseInterval(FriendSorter.PRIVACY_INTERVAL)>t?e[i]=this.data[i]:s=!0;s&&(this.data=e,this.save())},FriendSorter.prototype.save=function(){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SORTER,this.data)},FriendSorter.isActivePlayer=function(e){return 1<=e.episode||6<=e.level},FriendSorter.prototype.canUse=function(e){return void 0===this.data[e]},FriendSorter.prototype.markUsed=function(e){e.forEach(function(e){this.data[e]=Date.now()},this),this.save()},FriendSorter.prototype.listActiveFriends=function(){return levels.progress.data?levels.progress.data.filter(FriendSorter.isActivePlayer).map(function(e){
return cleverapps.friends.getById(e.id)}).filter(function(e){return e}):cleverapps.friends.listFriends()},FriendSorter.prototype.listInactiveFriends=function(){var e=cleverapps.invitalbleFriends.listFriends();if(levels.progress.data){var t=levels.progress.data.filter(function(e){return!FriendSorter.isActivePlayer(e)});e=e.concat(t.map(function(e){return cleverapps.friends.getById(e.id)})).filter(function(e){return e})}return this.update(),e=e.filter(function(e){return e&&void 0===this.data[e.id]},this)};var SelectFriendWindow=Window.extend({onWindowLoaded:function(e,t){var s=new cc.Node;s.setAnchorPoint(.5,.5),this.content=s,this.type=e,cleverapps.config.debugMode&&(SelectFriendWindow.PROCESS_PERIOD="300 second");var i=cleverapps.friends.listFriends().concat(cleverapps.invitalbleFriends.listFriends());i.length?this.generateFriendsContent(i,t):this.generateNoFriendsContent();var n=cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.SelectFriendWindow.window,!0)
;this._super({title:SelectFriendWindow.ByType[this.type].title,name:"selectfriendwindow"+e,content:s,styles:n}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},addCheck:function(e,t){var s=new cc.Sprite(bundles.main.frames.select_friend_checkbox_selected);t&&cleverapps.UI.convertToGrayScale(s),s.setPosition(e.width/2,e.height/2),e.check=s,e.addChild(s)},checkElementByFriendId:function(e,t){var s=this.selectedElements.friends.indexOf(e);-1!==s?(this.selectedElements.data[e].checked=!1,this.selectedElements.data[e].check.removeFromParent(),this.selectedElements.data[e]=void 0,this.selectedElements.friends.splice(s,1)):(this.addCheck(t),t.checked=!0,this.selectedElements.data[e]=t,this.selectedElements.friends.push(e),this.selectedElements.friends.length>SelectFriendWindow.MAX_SELECTED&&this.checkElementByFriendId(this.selectedElements.friends[0])),this.updateSelectedContent()},generateCheckbox:function(s,i){
var e=cleverapps.styles.SelectFriendWindow.withFriends.friendContainer.checkBox;if(!this.processTimeData)for(var t in this.processTimeData=cleverapps.DataLoader.load(SelectFriendWindow.ByType[this.type].dataLoaderType()),this.processTimeData||(this.processTimeData={}),this.processTimeData)this.processTimeData[t]<Date.now()-cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)&&(this.processTimeData[t]=void 0);var n=function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=i.convertTouchToNodeSpace(e);return!!cc.rectContainsPoint(cc.rect(0,0,i.width,i.height),t)&&(t=this.friendsContainer.convertTouchToNodeSpace(e),cc.rectContainsPoint(cc.rect(0,0,this.friendsContainer.width,this.friendsContainer.height),t))}.bind(this),onTouchEnded:function(e){var t=i.convertTouchToNodeSpace(e);if(!cc.rectContainsPoint(cc.rect(0,0,i.width,i.height),t))return!1;t=this.friendsContainer.convertTouchToNodeSpace(e),cc.rectContainsPoint(cc.rect(0,0,
this.friendsContainer.width,this.friendsContainer.height),t)&&this.checkElementByFriendId(s.id,o)}.bind(this)},i),i.onMouseOver=function(){i.bg&&i.bg.setColor(cleverapps.styles.COLORS.HOVER),o.setScale(1.1)},i.onMouseOut=function(){i.bg&&i.bg.setColor(cleverapps.styles.COLORS.WHITE),o.setScale(1)},cleverapps.UI.applyHover(i)}.bind(this),o=this.generateCheckBoxBg();if(o.setPositionRound(e.x,i.height/2+cleverapps.styles.SelectFriendWindow.Avatar.y),i.fullData={checkBox:o,id:s.id},i.addChild(o),this.processTimeData&&this.processTimeData[s.id]&&this.processTimeData[s.id]>Date.now()-cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)){var r={showHours:!0,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,imageFont:!1};console.log("disabled",i);var a=this.processTimeData[s.id]+cleverapps.parseInterval(SelectFriendWindow.PROCESS_PERIOD)-Date.now(),c=new cleverapps.CountDownView(new cleverapps.CountDown(a),r),l=function(){c.refresh(),c.removeFromParent(),i.name.setVisible(!0),
i.avatar.setOpacity(255),o.setOpacity(255),i.coinsIcon&&i.coinsIcon.setOpacity(255),o.check.removeFromParent(),i.notActive=!1,n()}.bind(this);return c.onEnter=function(){cleverapps.CountDownView.prototype.onEnter.call(this),c.countDown.onFinish=c.createListener(l)},c.setPosition(i.width/2,e.timer.y),i.addChild(c),i.name.setVisible(!1),this.addCheck(o,!0),o.setOpacity(150),i.avatar.setOpacity(120),i.notActive=!0,void(i.coinsIcon&&i.coinsIcon.setOpacity(150))}i.notActive=!1,n()},generateCheckBoxBg:function(){var e=new cc.Sprite(bundles.main.frames.select_friend_checkbox);return e.setAnchorPoint(.5,.5),e.setCascadeOpacityEnabled(!0),e},generateFriendContent:function(e,t){var s=cleverapps.styles.SelectFriendWindow.withFriends.friendContainer,i=new cc.Node;if(i.setAnchorPoint(.5,.5),i.setContentSize(s.width,s.height),bundles.select_friend_window.frames.friend_bg_png){var n=cleverapps.UI.createScale9Sprite(bundles.select_friend_window.frames.friend_bg_png);n.setAnchorPoint(.5,.5),
n.setContentSize(s.width,s.height),n.setPosition(i.width/2,i.height/2),i.addChild(n),i.bg=n}var o=new cleverapps.UI.Avatar(e);o.setPositionRound(cleverapps.styles.SelectFriendWindow.Avatar.x,i.height/2+cleverapps.styles.SelectFriendWindow.Avatar.y),o.setAnchorPoint2(),(i.avatar=o).setCascadeOpacityEnabled(!0),i.addChild(o);var r=cleverapps.UI.generateTTFText(e.name,cleverapps.styles.FONTS.WINDOW_SMALL_TEXT);return r.setDimensions(s.Name.width,s.Name.height),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_TOP),i.addChild(r),r.setPositionRound(i.width/2,s.Name.y),i.name=r,this.generateCheckbox(e,i),i},getButtonContent:function(){var e=new cc.Node;e.setAnchorPoint2();var t=cleverapps.UI.generateTTFText(SelectFriendWindow.ByType[this.type].button,cleverapps.styles.FONTS.BUTTON_TEXT);return e.buttonText=t,e.addChild(t),e.setContentSize(t.width,t.height),t.setPositionRound({align:"center"},{align:"center"}),e},
generateFriendsContent:function(e,s){this.selectedElements={friends:[],data:{}};var t=cleverapps.styles.SelectFriendWindow.withFriends;this.content.setContentSize(t.width,t.height);var i=new cleverapps.UI.Button({content:this.getButtonContent(),width:t.Button.width,height:t.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){this.selectedElements.friends.length&&(this.close(),s(this.selectedElements.friends,function(){if(this.processTimeData){for(var e=0;e<this.selectedElements.friends.length;e++)this.processTimeData[this.selectedElements.friends[e]]=Date.now();cleverapps.DataLoader.save(SelectFriendWindow.ByType[this.type].dataLoaderType(),this.processTimeData)}}.bind(this)))}.bind(this),clickThrottle:cleverapps.UI.SOCIAL_CLICK_THROTTLE});i.setPositionRound(this.content.width/2+t.Button.x,t.Button.y),this.button=i,this.content.addChild(i);var n=new cc.Node;n.setAnchorPoint(0,.5),n.setPositionRound(t.SelectedBlock.x,t.SelectedBlock.y)
;var o=this.generateCheckBoxBg();o.setAnchorPoint(0,.5),o.setPositionRound(0,o.height/2),n.addChild(o);var r=cleverapps.UI.generateTTFText("messages:Selected",cleverapps.styles.FONTS.WINDOW_TEXT);r.setPositionRound(o.width+t.SelectedBlock.margin.x,o.y+r.height/2),r.setAnchorPoint(0,.5),n.addChild(r);var a=cleverapps.UI.generateTTFText("",cleverapps.styles.FONTS.WINDOW_TEXT);a.setAnchorPoint(.5,.5),this.selectedAmountText=a,n.addChild(a),this.updateSelectedContent(),a.setPositionRound(r.x+r.width/2,o.y-a.height/2),n.setContentSize(o.width+r.width+t.SelectedBlock.margin.x,o.height),this.content.addChild(n),n.onMouseOver=function(){o.setScale(1.1)},n.onMouseOut=function(){o.setScale(1)},cleverapps.UI.applyHover(n),cleverapps.UI.onClick(n,function(e){this.switchSelectAll(o)}.bind(this));var c=new cc.Node;this.friendContainers=e.map(function(e,t){return{container:this.generateFriendContent(e,s),order:t}},this),levels.friendSorter.update(),this.friendContainers.sort(function(e,t){
return e.container.notActive!==t.container.notActive?e.container.notActive?1:-1:levels.friendSorter.canUse(e.container.fullData.id)!==levels.friendSorter.canUse(t.container.fullData.id)?levels.friendSorter.canUse(e.container.fullData.id)?-1:1:e.order-t.order}),this.friendContainers.length>SelectFriendWindow.MAX_ROWS_AMOUNT*SelectFriendWindow.IN_ROW&&(this.friendContainers=this.friendContainers.slice(0,SelectFriendWindow.MAX_ROWS_AMOUNT*SelectFriendWindow.IN_ROW));for(var l=0;l<this.friendContainers.length;l++)c.addChild(this.friendContainers[l].container),this.friendContainers[l].container.setPositionRound(l%SelectFriendWindow.IN_ROW*(t.friendContainer.margin+t.friendContainer.width)+t.friendContainer.width/2,c.height-Math.floor(l/SelectFriendWindow.IN_ROW)*(t.friendContainer.margin+t.friendContainer.height)-t.friendContainer.height/2);c=cleverapps.UI.wrap(c),this.friendsContainer=new cleverapps.UI.ScrollView(c),this.friendsContainer.setContentSize(
c.width+cleverapps.styles.SelectFriendWindow.scroll.margin.mx[0],t.friendsContainer.height),this.friendsContainer.setAnchorPoint(.5,0),this.friendsContainer.setPositionRound(this.content.width/2,t.friendsContainer.y),cc.sys.isNative||this.switchSelectAll(o),this.content.addChild(this.friendsContainer)},switchSelectAll:function(e){if(e.selected){e.selected=!1,e.check.removeFromParent();for(var t=this.selectedElements.friends.length-1;0<=t;t--)this.checkElementByFriendId(this.selectedElements.friends[t])}else{var s=!1;for(t=0;t<this.friendContainers.length;t++){var i=this.friendContainers[t].container,n=i.fullData;this.selectedElements.friends.length<SelectFriendWindow.MAX_SELECTED&&!i.notActive&&!n.checkBox.checked&&(this.checkElementByFriendId(n.id,n.checkBox),s=!0)}s&&(e.selected=!0,this.addCheck(e))}},updateSelectedContent:function(){this.selectedAmountText.setString(this.selectedElements.friends.length+"/"+SelectFriendWindow.MAX_SELECTED),
this.selectedElements.friends.length?this.button.enable():this.button.disable()},generateNoFriendsContent:function(){var e=cleverapps.styles.SelectFriendWindow.noFriends;this.content.setContentSize(e.width,e.height);var t=cleverapps.UI.generateTTFText(SelectFriendWindow.ByType[this.type].noFriends,cleverapps.styles.FONTS.WINDOW_TEXT);t.setPositionRound(this.content.width/2,e.Text.y),t.setDimensions(e.Text.width,e.Text.height),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.content.addChild(t);var s=new cleverapps.UI.Button({text:Messages.get("SettingsWindow.InviteFriends"),width:e.Button.width,height:e.Button.height,font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:function(){cleverapps.social.inviteFriendsWindow(function(){this.close()}.bind(this))}.bind(this)});s.setPositionRound(this.content.width/2,e.Button.y),this.content.addChild(s)}});SelectFriendWindow.ByType={askLives:{title:"messages:SelectFriendWindow.askLives.title",button:"messages:Ask",
noFriends:"messages:SelectFriendWindow.askLives.noFriendsText",dataLoaderType:function(){return cleverapps.DataLoaderTypes.ASKED_LIVES}},askStars:{title:"messages:SelectFriendWindow.askStars.title",button:"messages:Ask",noFriends:"messages:SelectFriendWindow.askStars.noFriendsText",dataLoaderType:function(){return cleverapps.DataLoaderTypes.ASKED_STARS}}},SelectFriendWindow.PROCESS_PERIOD="1 day",SelectFriendWindow.MAX_SELECTED=10,SelectFriendWindow.MAX_ROWS_AMOUNT=10,SelectFriendWindow.IN_ROW=3,cleverapps.styles.SelectFriendWindow={Avatar:{x:140,y:20},scroll:{margin:{mx:[30]}},withFriends:{width:670,height:750,friendsContainer:{height:580,y:100},friendContainer:{height:180,width:210,margin:20,Name:{width:200,height:40,y:24},checkBox:{x:42,timer:{y:24,height:20}}},Button:{width:300,height:120,y:0,x:190,margin:10},SelectedBlock:{y:0,x:0,margin:{x:20}}},noFriends:{width:550,height:500,Text:{y:250,width:550,height:400},Button:{width:450,height:120,y:0}}},levels.FriendRequests=function(){
this.load(),this.lastServerReload=0,this.onNewListener=function(){},this.onChangeListener=function(){},cleverapps.flags.noviral&&this.deleteFakeRequests(),this.serverReload(),FakeRequestSender.sendIfNeed(this),setInterval(function(){this.serverReload(),FakeRequestSender.sendIfNeed(this)}.bind(this),cleverapps.parseInterval("1 minute"))},levels.FriendRequests.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FRIEND_REQUESTS);if(e){this.notProcessed=[];var t=this.listAvailableTypes();e.notProcessed=e.notProcessed.filter(function(e){return-1!==t.indexOf(e.type)});for(var s=0;s<e.notProcessed.length;s++)this.notProcessed.push(levels.FriendRequest.createFriendRequest(e.notProcessed[s]));this.processedIds=e.processedIds}else this.notProcessed=[],this.processedIds=[]},levels.FriendRequests.prototype.save=function(){for(var e=[],t=0;t<this.notProcessed.length;t++)e.push(this.notProcessed[t].getData());cleverapps.DataLoader.save(
cleverapps.DataLoaderTypes.FRIEND_REQUESTS,{notProcessed:e,processedIds:this.processedIds})},levels.FriendRequests.prototype.idInNotProcessed=function(e){for(var t=0;t<this.notProcessed.length;t++)if(this.notProcessed[t].getId()===e)return!0;return!1},levels.FriendRequests.prototype.lastNotProcessedId=function(){for(var e=this.notProcessed.length-1;0<=e;e--)if(this.notProcessed[e].canView())return this.notProcessed[e].id;return!1},levels.FriendRequests.prototype.existNotProcessed=function(){for(var e=0;e<this.notProcessed.length;e++)if(this.notProcessed[e].canView())return!0;return!1},levels.FriendRequests.prototype.existRequestFrom=function(e){for(var t=0;t<this.notProcessed.length;t++)if(this.notProcessed[t].canView()&&this.notProcessed[t].from===e)return!0;return!1},levels.FriendRequests.prototype.existRequestTypes=function(e){for(var t=0;t<this.notProcessed.length;t++)if(0<=e.indexOf(this.notProcessed[t].type))return!0;return!1},levels.FriendRequests.prototype.processById=function(
e){for(var t=!1,s=!1,i=0;i<this.notProcessed.length;i++)if(this.notProcessed[i].getId()===e){this.notProcessed[i].onServer()&&(s=!0),this.notProcessed.splice(i,1),t=!0;break}s&&(this.processedIds.push(e),this.deleteOnServerById(e)),t&&this.onChangeListener(),this.save()},levels.FriendRequests.prototype.onServerLoad=function(e){var t=[],s=!1,i=this.listAvailableTypes();Array.isArray(e)||(cleverapps.throwAsync("FriendRequests.onServerLoad data type is - "+typeof e),e=[]),e=e.filter(function(e){return-1!==i.indexOf(e.type)});for(var n=0;n<e.length;n++)0<=this.processedIds.indexOf(e[n].id)?(this.deleteOnServerById(e[n].id),t.push(e[n].id)):this.idInNotProcessed(e[n].id)||(this.notProcessed.push(levels.FriendRequest.createFriendRequest({id:e[n].id,from:e[n].fromUserId,type:e[n].type})),s=!0);this.processedIds=t,this.save(),s&&(this.onNewListener(),this.onChangeListener())},levels.FriendRequests.prototype.sendServerRequest=function(e,t){cleverapps.RestClient.post(
"/friendrequests/create/"+cleverapps.user.id+"/a",{toUserId:e,type:t})},levels.FriendRequests.prototype.deleteOnServerById=function(e){cleverapps.RestClient.post("/friendrequests/delete/"+cleverapps.user.id+"/a",{id:e})},levels.FriendRequests.prototype.serverReload=function(){this.lastServerReload<Date.now()-cleverapps.parseInterval(levels.FriendRequests.RELOAD_INTERVAL)&&cleverapps.synchronizer.synced&&(this.lastServerReload=Date.now(),cleverapps.RestClient.get("/friendrequests/getmy/"+cleverapps.user.id+"/a",{},this.onServerLoad.bind(this)))},levels.FriendRequests.prototype.deleteFakeRequests=function(){var e=this.notProcessed.filter(function(e){return!e.fake});e.length!==this.notProcessed.length&&(this.notProcessed=e,this.onChangeListener(),this.save())},levels.FriendRequests.prototype.listAvailableTypes=function(){var e=[levels.FriendRequest.TYPE_STUCK_HELP_COINS,levels.FriendRequest.TYPE_BOUNTY_READY];return"undefined"==typeof match3&&(e=e.concat([
levels.FriendRequest.TYPE_SENT_COINS,levels.FriendRequest.TYPE_ASK_COINS,levels.FriendRequest.TYPE_SENT_HELP_COINS,levels.FriendRequest.TYPE_ASK_HELP_COINS])),cleverapps.lives&&(e=e.concat([levels.FriendRequest.TYPE_SENT_HELP_LIVE,levels.FriendRequest.TYPE_ASK_HELP_LIVE,levels.FriendRequest.TYPE_SENT_LIVE,levels.FriendRequest.TYPE_ASK_LIVE])),cleverapps.starChest&&(e=e.concat([levels.FriendRequest.TYPE_SENT_HELP_STAR,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_SENT_STAR,levels.FriendRequest.TYPE_ASK_STAR])),e},levels.FriendRequests.RELOAD_INTERVAL="10 minutes",levels.FriendRequest=function(e){this.id=e.id,this.from=e.from,this.type=e.type,this.fake=e.fake,this.onRemoveListener=function(){}},levels.FriendRequest.prototype.getId=function(){return this.id},levels.FriendRequest.prototype.getView=function(){if(this.canView())return levels.FriendRequestView},levels.FriendRequest.prototype.canView=function(){return levels.FriendRequest.REQUEST_TYPES[this.type]},
levels.FriendRequest.prototype.isFake=function(){return!0===this.fake},levels.FriendRequest.prototype.onServer=function(){return!this.isFake()},levels.FriendRequest.prototype.getData=function(){return{id:this.id,from:this.from,type:this.type,fake:this.fake}},levels.FriendRequest.prototype.process=function(){var e=levels.FriendRequest.REQUEST_TYPES[this.type];if(!e.checkProcess||e.checkProcess()){var t=function(){e.createNewRequestId&&levels.friendRequests.sendServerRequest(this.from,e.createNewRequestId),e.onProcess&&e.onProcess(this),this.remove(),0<=levels.FriendRequest.SENT_HELP_REQUESTS.indexOf(this.type)&&cleverapps.dailyTasks.addProgress(cleverapps.DailyTasks.SEND_FRIEND_HELP)}.bind(this);e.fbRequest?cleverapps.social.sendRequest(this.from,e.fbRequest,t):t()}},levels.FriendRequest.prototype.canRemove=function(){return this.type!==levels.FriendRequest.TYPE_BOUNTY_READY||0===cleverapps.bountyManager.listPrizes().length},levels.FriendRequest.prototype.remove=function(){
this.canRemove()&&(levels.friendRequests.processById(this.getId()),this.onRemoveListener())},levels.FriendRequest.prototype.cancel=function(){levels.friendRequests.processById(this.getId()),this.onRemoveListener()},levels.FriendRequest.createFriendRequest=function(e){return new levels.FriendRequest(e)},levels.FriendRequest.addLiveProcess=function(e){e.animateCollect(cleverapps.styles.MenuBar.LivesItem.target,function(){cleverapps.lives.setAmount(cleverapps.lives.amount+1)})},levels.FriendRequest.checkAddLiveProcess=function(){return!0},levels.FriendRequest.addStarProcess=function(e){cleverapps.starChest.addStars(1),cleverapps.starChest.locked||cleverapps.metha.display({focus:"StarChestFriendRequest",action:function(e){new StarChestWindow,cleverapps.metha.onceNoWindowsListener=e}})},levels.FriendRequest.addCoinsProcess=function(e,t){t=t||levels.FriendRequest.HELP_COINS_AMOUNT,e.animateCollect(cleverapps.styles.MenuBar.GoldItem.target,function(){cleverapps.user.setGold(
cleverapps.user.gold+t)})},levels.FriendRequest.addCoinsStuckProcess=function(e){levels.FriendRequest.addCoinsProcess(e,levels.FriendRequest.STUCK_COINS_AMOUNT)},levels.FriendRequest.TYPE_ASK_LIVE=0,levels.FriendRequest.TYPE_SENT_LIVE=1,levels.FriendRequest.TYPE_ASK_STAR=2,levels.FriendRequest.TYPE_SENT_STAR=3,levels.FriendRequest.TYPE_ASK_HELP_LIVE=4,levels.FriendRequest.TYPE_SENT_HELP_LIVE=5,levels.FriendRequest.TYPE_ASK_HELP_STAR=6,levels.FriendRequest.TYPE_SENT_HELP_STAR=7,levels.FriendRequest.TYPE_BOUNTY_READY=8,levels.FriendRequest.TYPE_ASK_HELP_COINS=9,levels.FriendRequest.TYPE_SENT_HELP_COINS=10,levels.FriendRequest.TYPE_ASK_COINS=12,levels.FriendRequest.TYPE_SENT_COINS=13,levels.FriendRequest.TYPE_STUCK_HELP_COINS=14,levels.FriendRequest.SENT_HELP_REQUESTS=[levels.FriendRequest.TYPE_ASK_LIVE,levels.FriendRequest.TYPE_ASK_HELP_LIVE,levels.FriendRequest.TYPE_ASK_STAR,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_ASK_COINS,
levels.FriendRequest.TYPE_ASK_HELP_COINS,levels.FriendRequest.TYPE_STUCK_HELP_COINS],levels.FriendRequest.HELP_COINS_AMOUNT=10,levels.FriendRequest.STUCK_COINS_AMOUNT=50,levels.FriendRequest.REQUEST_TYPES={},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_LIVE]={image:bundles.request_center.frames.send_life_icon,button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskLiveRequest",fbRequest:"sendLiveRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_LIVE},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_LIVE]={image:bundles.request_center.frames.accept_life_icon,text:"SendLiveRequest",fbRequest:"thanksForLiveRequest",onProcess:levels.FriendRequest.addLiveProcess,checkProcess:levels.FriendRequest.checkAddLiveProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_STAR]={image:bundles.request_center.frames.send_star_icon,
button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskStarRequest",fbRequest:"sendStarRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_STAR},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_STAR]={image:bundles.request_center.frames.accept_star_icon,text:"SendStarRequest",fbRequest:"thanksForStarRequest",onProcess:levels.FriendRequest.addStarProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_HELP_LIVE]={image:bundles.request_center.frames.send_life_icon,button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_LIVE},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_HELP_LIVE]={image:bundles.request_center.frames.accept_life_icon,
text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addLiveProcess,checkProcess:levels.FriendRequest.checkAddLiveProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_HELP_STAR]={image:bundles.request_center.frames.send_star_icon,button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_STAR},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_HELP_STAR]={image:bundles.request_center.frames.accept_star_icon,text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addStarProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_BOUNTY_READY]={avatar:bundles.request_center.frames.bounty_ready_icon,text:"BountyRequest",button_text:"Collect",onProcess:BountyManager.openWindow},
levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_HELP_COINS]={image:bundles.request_center.frames.send_coins_icon,button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskHelpRequest",fbRequest:"sentHelpRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_HELP_COINS},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_HELP_COINS]={image:bundles.request_center.frames.accept_coins_icon,text:"SentHelpRequest",fbRequest:"thanksForHelpRequest",onProcess:levels.FriendRequest.addCoinsProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_ASK_COINS]={image:bundles.request_center.frames.send_coins_icon,button_png:bundles.buttons_main.frames.small_blue_button,button_on_png:bundles.buttons_main.frames.small_blue_button_on,button_text:"Send",text:"AskCoinsRequest",fbRequest:"sendCoinsRequest",createNewRequestId:levels.FriendRequest.TYPE_SENT_COINS},
levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_SENT_COINS]={image:bundles.request_center.frames.accept_coins_icon,text:"SendCoinsRequest",fbRequest:"thanksForCoinsRequest",onProcess:levels.FriendRequest.addCoinsProcess},levels.FriendRequest.REQUEST_TYPES[levels.FriendRequest.TYPE_STUCK_HELP_COINS]={image:bundles.request_center.frames.accept_stuck_coins_icon,text:"SendStuckHelpRequest",onProcess:levels.FriendRequest.addCoinsStuckProcess},levels.FriendRequest.SYSTEM_ID=-1,levels.FriendRequestView=cc.Node.extend({ctor:function(e,t,s){this._super(),this.setContentSize(cleverapps.styles.FriendRequestView.width,cleverapps.styles.FriendRequestView.height),this.setAnchorPoint2(),this.model=e,this.onRemove=s,this.createBackground(),this.createFromContent(),this.createRequestContent(),this.createRequestImage(),this.createCancelContent(),this.createProcessContent(),cleverapps.UI.onClick(this,function(){t.showAutoHide&&t.showAutoHide()||this.process()}.bind(this))},onEnter:function(
){this._super(),this.model.onRemoveListener=this.createListener(this.removeAnimation.bind(this)),this.model.animateCollect=this.createListener(this.animateCollect.bind(this))},animateCollect:function(e,t){cleverapps.history.add("reqclt",1),WindowHelper.animateCollect(this.image,{scale:.8,target:e},t)},createFromContent:function(){var e,t=levels.FriendRequest.REQUEST_TYPES[this.model.type],s=void 0;if(cleverapps.social instanceof cleverapps.BaseFB&&(s=this.model.from),t.avatar)e=new cleverapps.UI.Avatar(cc.spriteFrameCache.getSpriteFrame(t.avatar),s);else{var i=cleverapps.friends.getById(this.model.from);e=i?new cleverapps.UI.Avatar(i):new cleverapps.UI.Avatar("https://scontent.xx.fbcdn.net/v/",s)}var n=cleverapps.styles.FriendRequestView.Avatar;e.setPositionRound(e.width/2+n.Margin.x,this.height/2+n.Margin.y),e.setAnchorPoint2(),this.addChild(e)},createBackground:function(){var e=cleverapps.UI.createScale9Sprite(bundles.main.frames.wood_bg,cleverapps.UI.Scale9Rect.TwoPixelXY)
;e.setContentSize2(this.width,this.height),e.setPosition(this.width/2,this.height/2),this.addChild(e)},getRequestText:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];return Messages.get(e.text)},createRequestContent:function(){var e=this.getRequestText();if(e){var t=cleverapps.styles.FriendRequestView.Request;(e=cleverapps.UI.generateTTFText(e,t.font)).setPositionRound(this.width/2+t.x,this.height/2+t.y),e.setDimensions(t.width,0),e.fitTo(void 0,t.height),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),e.setVerticalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(e)}},getRequestImage:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];return!!e.image&&new cc.Sprite(e.image)},createRequestImage:function(){var e=this.getRequestImage();e&&(e.setPosition(cleverapps.styles.FriendRequestView.Icon.x,this.height/2+cleverapps.styles.FriendRequestView.Icon.y),this.addChild(e),this.image=e)},getProcessButtonStyle:function(){
var e=levels.FriendRequest.REQUEST_TYPES[this.model.type];return{button_png:e.button_png||bundles.buttons_main.frames.small_green_button,button_on_png:e.button_on_png||bundles.buttons_main.frames.small_green_button_on,text:Messages.get(e.button_text?e.button_text:"Accept"),font:cleverapps.styles.FriendRequestView.processButton.font}},createProcessContent:function(){var e=this.getProcessButtonStyle(),t=cleverapps.styles.FriendRequestView.processButton,s=new cc.Node;s.setPosition(t.width/2,t.height/2);var i=cleverapps.UI.generateTTFText(e.text,e.font);i.fitTo(.9*t.width),i.setPosition(0,t.text.y),s.addChild(i);var n=new cleverapps.UI.Button({button_png:e.button_png,button_on_png:e.button_on_png,content:s,onClicked:this.process.bind(this),width:t.width,height:t.height});levels.FriendRequest.REQUEST_TYPES[this.model.type].image?n.setPositionRound(this.width-n.width/2-cleverapps.styles.FriendRequestView.processButton.x,this.height/2+cleverapps.styles.FriendRequestView.processButton.y
):n.setPositionRound(this.width-n.width/2-cleverapps.styles.FriendRequestView.processButton.noImage.x,this.height/2+cleverapps.styles.FriendRequestView.processButton.noImage.y),this.addChild(n)},createCancelContent:function(){var e=levels.FriendRequest.REQUEST_TYPES[this.model.type],t=cleverapps.styles.FriendRequestView.close;if(!e.noCancel){var s=new cleverapps.UI.Button({button_png:bundles.buttons_main.frames.close_small||bundles.buttons_main.frames.window_close_png,button_on_png:bundles.buttons_main.frames.close_small_on||bundles.buttons_main.frames.window_close_on_png,onClicked:this.cancel.bind(this)});s.setPositionRound(this.width-s.width/2+t.x,this.height-s.height/2+t.y),s.baseScale=t.scale,s.scale=t.scale,this.addChild(s)}},cancel:function(){this.model.cancel()},process:function(){this.model.process()},removeAnimation:function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.3,0),new cc.CallFunc(this.onRemove),new cc.RemoveSelf))},showAnimation:function(e){this.setScale(0),
this.runAction(new cc.Sequence(new cc.DelayTime(e),new cc.ScaleTo(.3,1)))}}),cleverapps.styles.FriendRequestView={width:480,height:166,close:{x:10,y:10,scale:.75},processButton:{width:170,height:60,font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,x:20,y:-35,noImage:{x:90,y:-35},text:{y:0}},Request:{x:66,y:28,width:270,height:80,font:cleverapps.styles.FONTS.WINDOW_SMALL_TEXT},Icon:{x:216,y:-30},Avatar:{Margin:{x:25,y:0}}};var FakeRequestSender={load:function(){cleverapps.config.debugMode&&(FakeRequestSender.REQUEST_PERIOD="1 minute");var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.FAKE_REQUESTS);return e||(e={lastLoadTime:0}),e},save:function(e){e.lastLoadTime=Date.now(),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.FAKE_REQUESTS,e)},sendIfNeed:function(e){if(0!==cleverapps.friends.listIds().length&&"merge"!==cleverapps.config.type&&!cleverapps.flags.noviral){var t=FakeRequestSender.load(),s=Math.floor((Date.now()-t.lastLoadTime)/cleverapps.parseInterval(
FakeRequestSender.REQUEST_PERIOD));if(!(s<=0)){var i=e.notProcessed.filter(function(e){return e.isFake()});s>FakeRequestSender.MAX_REQUESTS-i.length&&(s=FakeRequestSender.MAX_REQUESTS-i.length);var n=!1,o=levels.friendSorter.listActiveFriends();cleverapps.Random.shuffle(o),10<o.length&&(o=o.slice(0,10));for(var r=0;r<o.length&&0<s;r++){var a=o[r];if(!e.existRequestFrom(a.id)){var c=cleverapps.Random.mathChoose(this.listFakeRequestsTypes(e));s--,n=!0,e.notProcessed.push(levels.FriendRequest.createFriendRequest({id:"__"+Math.floor(1e15*Math.random()),from:a.id,type:c,fake:!0}))}}n&&(e.onNewListener(),FakeRequestSender.save(t),e.save())}}},listFakeRequestsTypes:function(e){var t=[levels.FriendRequest.TYPE_ASK_HELP_LIVE,levels.FriendRequest.TYPE_ASK_HELP_STAR,levels.FriendRequest.TYPE_ASK_HELP_COINS],s=e.listAvailableTypes();return t.filter(function(e){return-1!==s.indexOf(e)})},MAX_REQUESTS:2,REQUEST_PERIOD:"12 hours"},UserResult=function(){this.scores={},this.stars={}
;var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.RESULT_FIFO);if(e)for(var t=0;t<e.length;t++){var s=e[t].match(/\d+$/);if(s){var i=parseInt(s[0],10);this.loadEpisode(i)}}};UserResult.prototype.isActive=function(e){return!cleverapps.config.editorMode&&(cleverapps.config.results&&HoseEpisode.isFreshEpisode(e))},UserResult.prototype.isEmpty=function(e){return!this.scores[e]||0===Object.keys(this.scores[e]).length},UserResult.prototype.getEpisodeInfo=function(e){return{scores:this.scores[e]||{},stars:this.stars[e]||{}}},UserResult.prototype.getStarsForLevel=function(e,t){return this.isEmpty(e)?0:this.stars[e][t]||0},UserResult.prototype.getScoresForLevel=function(e,t){return this.isEmpty(e)?0:this.scores[e][t]||0},UserResult.prototype.updateLevel=function(e,t,s,i,n){if(n=n||{},this.isActive(e)){this.scores[e]=this.scores[e]||{},this.stars[e]=this.stars[e]||{};var o=!1;(!this.scores[e][t]||this.scores[e][t]<s)&&(o=!0,this.scores[e][t]=s),(!this.stars[e][t]||this.stars[e][t]<i
)&&(o=!0,this.stars[e][t]=i,levels.episodes.episodes&&levels.episodes.episodes[e]&&levels.episodes.episodes[e].levels[t].improveStars(i)),o&&this.saveEpisode(e,n)}},UserResult.ParseLib={parseScores:function(e){var t=JSON.parse(e);return Array.isArray(t)?UserResult.ParseLib.objFromArray(t):t},parseStars:function(e){var t=JSON.parse(e);return"number"==typeof t?UserResult.ParseLib.objFromNumber(t):t},objFromArray:function(e){var s={};return e.forEach(function(e,t){s[t]=e}),s},objFromNumber:function(e){for(var t={},s=0;s<Episode.LEVELS_PER_EPISODE;s++)t[s]=e%4,e=Math.floor(e/4);return t},objToArray:function(e){for(var t=[],s=0;s<Episode.LEVELS_PER_EPISODE;s++)void 0===e[s]?t.push(0):t.push(e[s]);return t},objToNumber:function(e){for(var t=0,s=1,i=0;i<Episode.LEVELS_PER_EPISODE;i++)void 0!==e[i]&&(t+=s*e[i]),s*=4;return t}},UserResult.GetStoreKey=function(e){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_result_"+e},UserResult.prototype.saveEpisode=function(e,t
){if(t&&t.force);else if(!this.isActive(e))return;var s={scores:this.scores[e],stars:this.stars[e]};cleverapps.DataLoader.save(UserResult.GetStoreKey(e),s,{fifoKey:cleverapps.DataLoaderTypes.RESULT_FIFO,limit:Episode.FRESH_EPISODES}),(!t||t&&!t.skipUpdate)&&cleverapps.synchronizer.addUpdateTask("result")},UserResult.prototype.loadEpisode=function(e,t){if(this.scores[e]={},this.stars[e]={},this.isActive(e)){var s=cleverapps.DataLoader.load(UserResult.GetStoreKey(e));s&&(this.scores[e]=s.scores,this.stars[e]=s.stars)}},UserResult.prototype.reset=function(e){this.scores[e]={},this.stars[e]={},this.saveEpisode(e,{force:!0})};var Results=function(e){this.data=void 0,this.lastUpdateTime=0,this.episode=e,this.isActive()&&this.load(),this.reload(),this.setReloadTimeout()};Results.prototype.setReloadTimeout=function(){clearTimeout(this.reloadTimeout),this.reloadTimeout=new cleverapps.LongTimeout(function(){this.reload(),this.setReloadTimeout()}.bind(this),1.01*this.calcCacheTime())},
Results.prototype.destructor=function(){clearTimeout(this.reloadTimeout)},Results.prototype.isActive=function(){return cleverapps.config.results&&this.episode.isFreshEpisode()},Results.prototype.botResults=function(e){var t=this.episode.getLevelContent(e).score;return[{id:"bot3",avatar:bundles.main.frames.bot_avatar_3,name:"Donuter",score:10*Math.round(.7*t/10)},{id:"bot2",avatar:bundles.main.frames.bot_avatar_2,name:"Lemon Ice",score:10*Math.round(.8*t/10)},{id:"bot1",avatar:bundles.main.frames.bot_avatar_1,name:"Creamer",score:10*Math.round(1*t/10)}]},Results.prototype.listFriendResults=function(e){if(cleverapps.isLocalhost()){var s=this.episode.getLevelContent(e).score;return cleverapps.friends.listFriends().map(function(e,t){return{id:e.id,avatar:e.avatar,name:e.name,score:Math.round(1*s/10)*(8-t)}})}var i=[];return this.data&&this.data[e]&&this.data[e].forEach(function(e){var t=cleverapps.friends.getById(e.id);t&&i.push({id:e.id,avatar:t.avatar,name:t.name,score:e.score})},this),i
},Results.prototype.listTop4=function(e,t){var s=t?[]:this.botResults(e);(s=s.concat(this.listFriendResults(e))).sort(function(e,t){return t.score-e.score});var i=void 0;return cleverapps.userresult.isActive(this.episode.episodeNo)&&(i={id:levels.user.id,avatar:cleverapps.friends.getPlayer().avatar,name:cleverapps.friends.getPlayer().name,score:cleverapps.userresult.getScoresForLevel(this.episode.episodeNo,e)}),s=s.slice(0,i?3:4),i&&(i.player=!0,s.push(i)),s.sort(function(e,t){return e.score!==t.score?t.score-e.score:e.id===levels.user.id?-1:t.id===levels.user.id?1:0}),s},Results.GetStoreKey=function(e){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_results_"+e},Results.prototype.reset=function(){this.data=void 0,this.lastUpdateTime=0,this.save(!0)},Results.prototype.save=function(e){!0!==e&&(this.lastUpdateTime=Date.now());var t={data:this.data,when:this.lastUpdateTime};cleverapps.DataLoader.save(Results.GetStoreKey(this.episode.episodeNo),t,{
fifoKey:cleverapps.DataLoaderTypes.RESULTS_FIFO,limit:Episode.FRESH_EPISODES}),this.setReloadTimeout()},Results.prototype.load=function(){var e=cleverapps.DataLoader.load(Results.GetStoreKey(this.episode.episodeNo));e&&(this.data=e.data,this.lastUpdateTime=e.when)},Results.prototype.calcCacheTime=function(){return this.episode.episodeNo===levels.user.episode?cleverapps.parseInterval(Results.CACHE_CURRENT_INTERVAL):cleverapps.parseInterval(Results.CACHE_NEAR_INTERVAL)},Results.prototype.whenFriendListUpdated=function(){if(void 0!==this.data){for(var e in this.data)this.data[e]=this.data[e].filter(function(e){return void 0!==cleverapps.friends.getById(e.id)});this.reload(!0)}else this.reload()},Results.prototype.reload=function(e){this.isActive()&&(void 0!==this.data?(e||this.lastUpdateTime+this.calcCacheTime()<Date.now())&&this.getFromServer():this.getFromServer())},Results.prototype.getFromServer=function(){if(cleverapps.friends.haveData()&&!this.loading){this.loading=!0
;var e=function(e){this.loading=!1,this.data={},e.forEach(function(e){var t=e.userId,s=UserResult.ParseLib.parseScores(e.scores);for(var i in s){var n=s[i];void 0===this.data[i]&&(this.data[i]=[]),this.data[i].push({id:t,score:n})}},this),this.episode.isFreshEpisode()&&this.save()}.bind(this),t=cleverapps.friends.listIds();t.length&&(t.join(","),cleverapps.RestClient.get("/results/"+this.episode.episodeNo+"/"+t,{},e,function(e){console.log("Failure loading friends results: ",e)}))}},Results.CACHE_NEAR_INTERVAL="3 days",Results.CACHE_CURRENT_INTERVAL="1 hour";var Progress=function(){this.data=void 0,this.lastUpdateTime=[0,0],this.load(),this.onUpdated=function(){}};Progress.prototype.init=function(){this.reload(!0),setInterval(this.reload.bind(this),cleverapps.parseInterval(Progress.CHECK_INTERVAL))},Progress.TYPE_NEAR=0,Progress.TYPE_FAR=1,Progress.FILTER_FRIENDS=2,Progress.RESET=3,Progress.CHECK_INTERVAL="12 hours",Progress.CACHE_INTERVAL=["1 day","3 day"],
Progress.STUCK_INTERVAL="5 day",Progress.STUCK_HELP_INTERVAL="14 days",Progress.prototype.reset=function(){this.lastUpdateTime=[0,0],this.data=void 0,this.save(Progress.RESET)},Progress.prototype.listByEpisode=function(t){return this.data?this.data.filter(function(e){return e.episode===t}):[]},Progress.getType=function(e){return 1<Math.abs(e.episode-levels.user.episode)?Progress.TYPE_FAR:Progress.TYPE_NEAR},Progress.prototype.listIds=function(e){var t=(this.data?this.data.filter(function(e){return Progress.getType(e)===Progress.TYPE_FAR}):[]).map(function(e){return e.id}),s=cleverapps.friends.listIds();return e===Progress.TYPE_NEAR?s.filter(function(e){return-1===t.indexOf(e)}):s.filter(function(e){return-1!==t.indexOf(e)})},Progress.GetStoreKey=function(){return cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_progress"},Progress.prototype.save=function(e){e!==Progress.FILTER_FRIENDS&&e!==Progress.RESET&&(this.lastUpdateTime[e]=Date.now());var t={data:this.data,
last:this.lastUpdateTime};cleverapps.DataLoader.save(Progress.GetStoreKey(),t),this.onUpdated()},Progress.prototype.load=function(){var e=cleverapps.DataLoader.load(Progress.GetStoreKey());e&&(this.data=e.data,this.lastUpdateTime=e.last||[0,0])},Progress.prototype.whenFriendListUpdated=function(){if(this.data){var t=cleverapps.friends.listIds();this.data=this.data.filter(function(e){return-1!==t.indexOf(e.id)}),this.save(Progress.FILTER_FRIENDS),this.reload(!0)}else this.reload()},Progress.prototype.reload=function(e){if(!this.data)return this.getFromServer(Progress.TYPE_NEAR),void this.getFromServer(Progress.TYPE_FAR);(e||this.lastUpdateTime[Progress.TYPE_NEAR]+cleverapps.parseInterval(Progress.CACHE_INTERVAL[Progress.TYPE_NEAR])<Date.now())&&this.getFromServer(Progress.TYPE_NEAR),this.lastUpdateTime[Progress.TYPE_FAR]+cleverapps.parseInterval(Progress.CACHE_INTERVAL[Progress.TYPE_FAR])<Date.now()&&this.getFromServer(Progress.TYPE_FAR)},Progress.prototype.getLeaders=function(){var e=[
];if(!this.data)return e;for(var t=0;t<this.data.length;t++)cleverapps.friends.getById(this.data[t].id)&&e.push({id:this.data[t].id,rating:cleverapps.humanReadableNumber(this.data[t].episode,this.data[t].level)+(this.data[t].progress||0),name:cleverapps.friends.getById(this.data[t].id).name,avatar:cleverapps.friends.getById(this.data[t].id).avatar});return e.sort(function(e,t){return t.rating-e.rating}),cleverapps.config.leagues&&e.forEach(function(e){e.league=Progress.getLeague(e.rating)}),e},Progress.getLeague=function(e){var t=cleverapps.config.leagues;if(!t)return 0;for(var s=0;s<t.length;s++){var i=t[s];if(!1===i||e<=i)return s}return t.length-1},Progress.prototype.getStuckFriendsFake=function(){return cleverapps.friends.listFriends().map(function(e,t){return{id:e.id,name:e.name,avatar:e.avatar,episode:2*(t+1),level:t+3}})},Progress.prototype.getStuckFriends=function(){if(cleverapps.isLocalhost())return this.getStuckFriendsFake();var i=[];if("merge"===cleverapps.config.type
)return i;if(!this.data||this.updateInProgress)return i;var n=Date.now();return this.data.forEach(function(e){var t=e.updateTime||n;if(!(e.helpTime&&e.helpTime+cleverapps.parseInterval(Progress.STUCK_HELP_INTERVAL)>n)){var s=cleverapps.friends.getById(e.id);s&&t+cleverapps.parseInterval(Progress.STUCK_INTERVAL)<n&&i.push({id:e.id,name:s.name,avatar:s.avatar,episode:e.episode,level:e.level})}}.bind(this)),i.sort(function(e,t){return e.episode!==t.episode?t.episode-e.episode:t.level-e.level}),i.slice(0,3)},Progress.prototype.sendStuckFriendsHelp=function(e,t){var s=e.map(function(e){return e.id});cleverapps.social.sendRequest(s,"stuckHelpGold",function(){s.forEach(function(e){cleverapps.friends.inApp(e)&&levels.friendRequests.sendServerRequest(e,levels.FriendRequest.TYPE_STUCK_HELP_COINS)}),this.data.forEach(function(e){-1!==s.indexOf(e.id)&&(e.helpTime=Date.now())}),this.save(Progress.FILTER_FRIENDS),t()}.bind(this))},Progress.prototype.getFromServer=function(s){var i=this.listIds(s)
;if(0!==i.length){var e=function(e){this.updateInProgress=!1;var t=cleverapps.friends.listIds();this.data||(this.data=[]);var c={};this.data.forEach(function(e){c[e.id]=e}),this.data=this.data.filter(function(e){return-1!==t.indexOf(e.id)&&-1===i.indexOf(e.id)}),e.forEach(function(e){var t=e.id,s=e.episode,i=e.level,n=e.progress;s>=levels.episodes.getAmountEpisodes()&&(s=levels.episodes.getAmountEpisodes()-1,i=Episode.LEVELS_PER_EPISODE-1);var o=c[e.id],r=Date.now();o&&o.updateTime&&o.episode===s&&o.level===i&&o.progress===n&&(r=o.updateTime);var a={id:t,episode:s,level:i,progress:n,updateTime:r};o&&o.helpTime&&(a.helpTime=o.helpTime),this.data.push(a)},this),this.save(s)}.bind(this),t=i.join(",");this.updateInProgress=!0,cleverapps.RestClient.get("/progress/"+t,{},e,function(e){console.log("Failure loading friends progress: ",e)})}},levels.EpisodesScene=MainScene.extend({ctor:function(){this._super(),this.customize(),new levels.EpisodesController(this.scene),PlayButton.IsAvailable(
)&&(this.scene.playButton=new PlayButtonView,this.scene.addChild(this.scene.playButton),this.scene.playButton.addFingerTip())},customize:function(){}}),cleverapps.styles.EpisodesScene={},levels.EpisodesScene.BUNDLES=function(){for(var e=[],t=[],s=0;s<cleverapps.styles.PagesView.visiblePages;s++){e.push("episode_"+(levels.user.episode+s));var i="episode_"+(levels.user.episode+s)+"_external";bundles[i]&&(cc.sys.isNative?t=t.concat(bundles[i].urls):e.push(i))}return t.forEach(function(e){cc.loader.load(e)}),e};var Episode=function(e,t,s){s=s||{},this.episodeNo=e,this.levelNo=t,this.type=s.type?s.type:Episode.TypeValues[e]?e:Episode.Types.REGULAR,this.copyData=s.copyData,this.onLoadListener=function(){},this.onRemoveListener=function(){},this.whenLoadedListeners=[],this.init()};Episode.prototype.isComingSoon=function(){return this.episodeNo===Episodes.getAmountEpisodes()},Episode.prototype.init=function(){this.loaded=!1,this.levelsPerEpisode=bundles[this.bundleId()].levelsAmount,(
this.isComingSoon()||void 0!==this.levelNo)&&(this.levelsPerEpisode=1);var e=void 0!==this.levelNo?[this.levelNo]:cleverapps.rangeArray(0,this.levelsPerEpisode-1);this.levels=e.map(function(e){var t=cleverapps.userresult.getStarsForLevel(this.episodeNo,e);return new Level(this,e,t)}.bind(this))},Episode.prototype.getLevel=function(e){return void 0!==this.levelNo&&(e=0),this.levels[e]},Episode.prototype.isRegular=function(){return this.type===Episode.Types.REGULAR},Episode.prototype.getCurrentLevel=function(){for(var e in this.levels){var t=this.levels[e];if(t.type===Level.TYPE_CURRENT)return t}},Episode.prototype.whenLoaded=function(e,t){this.loaded?e(this):(t||cleverapps.bundleLoader.addBlockWindow(),this.whenLoadedListeners.push(function(){cleverapps.bundleLoader.removeBlockWindow(),e(this)}.bind(this)))},Episode.prototype.isPassed=function(){return levels.user.episode>this.episodeNo},Episode.prototype.isCurrent=function(){return levels.user.episode===this.episodeNo},
Episode.prototype.destructor=function(){this.loadTask&&this.loadTask.cancel(),this.loadDataStarted&&cleverapps.bundleLoader.deleteBundle(this.bundleId()),this.onRemoveListener(),this.deleted=!0},Episode.BundleId=function(e,t){t=t||cleverapps.settings.language;var s="episode_"+e;return"board"===cleverapps.config.type&&"en"!==t&&(s+="_"+t),s},Episode.prototype.bundleId=function(){return this.episodeNo===Episodes.getAmountEpisodes()?"episode_coming_soon":Episode.BundleId(this.episodeNo)},Episode.prototype.finishWait=function(){this.waitCounter--,0===this.waitCounter&&this.onceLoaded()},Episode.prototype.loadData=function(){if(this.loadDataStarted||this.deleted)return cleverapps.NO_ACTION;this.loadDataStarted=!0,this.loadDataInt()},Episode.prototype.loadDataInt=function(){this.waitCounter=1,this.loadTask=new SuccessWait(function(e){cleverapps.bundleLoader.loadBundle(this.bundleId(),e)}.bind(this),this.finishWait.bind(this))},Episode.prototype.onceLoaded=function(){this.loaded=!0,
this.onLoadListener&&this.onLoadListener(),this.whenLoadedListeners.forEach(cleverapps.callFunc),this.whenLoadedListeners=[]},Episode.prototype.getHardLevels=function(){return this.getBundle().hard||[]},Episode.prototype.getTrickyLevels=function(){return this.getBundle().tricky||[]},Episode.prototype.getBundle=function(){return bundles[this.bundleId()]},Episode.prototype.getContent=function(){return this.content||(this.content=cc.loader.getRes(this.getBundle().jsons.levels),this.copyData&&(this.content=JSON.parse(JSON.stringify(this.content)))),this.content},Episode.prototype.getLevels=function(){var e=this.getContent();return Array.isArray(e)?e:e.levels},Episode.prototype.isDebug=function(){return this.getContent().debug},Episode.prototype.getHashes=function(){var s={};return this.getLevels().forEach(function(e,t){cleverapps.extend(s,this.getLevelHashes(t))}.bind(this)),s},Episode.prototype.getLevelHashes=function(i){var n={},o=this.getLevelVersions(i);return Object.keys(o).map(
cleverapps.castType).sort().forEach(function(e){var t=o[e],s=Level.CalcHash(t);n[s]={levelNo:i,version:e,hash:s}}),n},Episode.prototype.getLastVersionHashes=function(){return this.levels.map(function(e){var t=this.getLevelContent(e.levelNo);return Level.CalcHash(t)},this)},Episode.prototype.getLevelVersions=function(e){var t=this.getLevels();t&&t[e]||cleverapps.throwAsync("No levels for episode "+this.episodeNo+" level "+e);var s=t[e];Array.isArray(s)||(s=[s]);var i={};return s.forEach(function(e,t){var s=e.version||t;i[s]=e}),i},Episode.prototype.getMaxVersion=function(e){var t=0;for(var s in e)t=Math.max(t,parseInt(s));return t},Episode.prototype.getLevelContent=function(e){var t=this.getLevelVersions(e),s=this.getMaxVersion(t);cleverapps.config.editorMode&&void 0!==LevelManager.getInstance().version&&!cleverapps.environment.isMainScene()&&(s=LevelManager.getInstance().version);var i=t[s];return i.episodeNo=this.episodeNo,i.levelNo=e,i.version=s,i},
Episode.prototype.isDailyCup=function(){return this.type===Episode.Types.DAILYCUP},Episode.prototype.isBonusRound=function(){return this.type===Episode.Types.BONUSROUNDS},Episode.prototype.isDailyLevel=function(){return this.type===Episode.Types.DAILY_LEVELS},Episode.prototype.isBonusWorldLevel=function(){return this.type===Episode.Types.BONUS_WORLD},Episode.LevelChooseAlgorithm=function(e){var t=e.start,s=e.finish||levels.episodes.getAmountEpisodes(),i=e.seed,n=t*Episode.LEVELS_PER_EPISODE,o=s*Episode.LEVELS_PER_EPISODE-1,r=cleverapps.Random.random(n,o,i);return{levelNo:r%Episode.LEVELS_PER_EPISODE,episodeNo:Math.floor(r/Episode.LEVELS_PER_EPISODE)}},Episode.LEVELS_PER_EPISODE=15,Episode.Types={REGULAR:"regular",BONUSROUNDS:"bonusrounds",EDITOR:"editor",DAILY_LEVELS:"daily_levels",DAILYCUP:"dailycup",BONUS_WORLD:"bonus_world",ADS:"ads"},Episode.TypeValues=cleverapps.createSet(cleverapps.values(Episode.Types));var HoseEpisode=function(e){Episode.apply(this,arguments),
this.onAnimatePass=void 0,this.onAnimateOpen=void 0,this.onExternalLoadListener=function(){}};HoseEpisode.prototype=Object.create(Episode.prototype),(HoseEpisode.prototype.constructor=HoseEpisode).prototype.currentLevelPosition=function(e){var t=cleverapps.styles.LevelView[this.getBundle().levelPositions||"levels_1"];return t&&t[e]},HoseEpisode.prototype.init=function(){Episode.prototype.init.call(this,arguments),this.externalLoaded=!1,cleverapps.userresult.loadEpisode(this.episodeNo),this.friendsResults=new Results(this),this.updateProgress()},HoseEpisode.prototype.updateProgress=function(){var t=[],i={};this.levels.forEach(function(e,t){e.players.forEach(function(e){i[e]=t})});var e=levels.progress.listByEpisode(this.episodeNo),s=[];e.forEach(function(e){e.level!==i[e.id]&&t.push(e),s.push(e.id)}),t.forEach(function(e){var t=this.levels[i[e.id]];t&&t.removePlayer(e.id);var s=this.levels[e.level];s?s.insertPlayer(e.id):console.log("No level for player: "+e.id+" at "+e.level)},this),
Object.keys(i).forEach(function(e){if(-1===s.indexOf(e)){var t=this.levels[i[e]];t&&t.removePlayer(e)}},this)},HoseEpisode.prototype.isFirstNotInShadow=function(){return!!this.isAvailableToPlay()&&cleverapps.user.episode-this.episodeNo==Episode.FRESH_EPISODES-1},HoseEpisode.prototype.destructor=function(){this.externalLoadTask&&this.externalLoadTask.cancel(),this.friendsResults&&this.friendsResults.destructor(),this.loadDataStarted&&(cleverapps.bundleLoader.deleteBundles(this.listRpgBundles()),cleverapps.bundleLoader.deleteBundle(this.bundleExternalId())),Episode.prototype.destructor.apply(this,arguments)},HoseEpisode.prototype.bundleExternalId=function(){return this.bundleId()+"_external"},HoseEpisode.prototype.listRpgBundles=function(){var s=[];return!cleverapps.config.rpg||"number"!=typeof this.episodeNo||this.episodeNo>=Episodes.getAmountEpisodes()?s:(s.push(this.getIslandBundleId()),"runes"!==cleverapps.config.name||this.isPassed(
)||!cleverapps.styles.IslandEnemies[this.episodeNo]||cleverapps.styles.IslandEnemies[this.episodeNo].forEach(function(e){var t=cleverapps.Spine.jsonToBundle[e.enemy];t&&bundles[t]&&s.push(t)}),s)},HoseEpisode.WAIT_FOR_EXTERNAL_TIMEOUT=3e3,HoseEpisode.prototype.waitExternal=function(){this.waitExternalTimeout=void 0,this.finishWait()},HoseEpisode.prototype.loadDataInt=function(){this.waitCounter=1,this.getExternalBundle()&&!this.externalLoaded&&(this.waitCounter++,this.waitExternalTimeout=setTimeout(this.waitExternal.bind(this),Episode.WAIT_FOR_EXTERNAL_TIMEOUT),this.externalLoadTask=new SuccessWait(function(e){cleverapps.bundleLoader.loadBundle(this.bundleExternalId(),e)}.bind(this),this.onceExternalLoaded.bind(this))),this.loadTask=new SuccessWait(function(e){var t=[this.bundleId()].concat(this.listRpgBundles());cleverapps.bundleLoader.loadBundles(t,e)}.bind(this),this.finishWait.bind(this))},HoseEpisode.prototype.onceExternalLoaded=function(){this.externalLoaded=!0,
this.loaded&&this.onExternalLoadListener&&this.onExternalLoadListener(),this.waitExternalTimeout&&(clearTimeout(this.waitExternalTimeout),this.finishWait())},HoseEpisode.prototype.onceLoaded=function(){Episode.prototype.onceLoaded.apply(this,arguments),(this.getExternalBundle()&&this.externalLoaded||!this.getExternalBundle())&&this.onExternalLoadListener&&this.onExternalLoadListener()},HoseEpisode.prototype.getIslandBundleId=function(){return"episode_"+Math.floor(this.episodeNo/10)+"_island"},HoseEpisode.prototype.getIslandBundle=function(){return bundles[this.getIslandBundleId()]},HoseEpisode.prototype.getExternalBundle=function(){if(cleverapps.metha.getType()===Metha.HOSE)return bundles[this.bundleExternalId()]},HoseEpisode.prototype.animatePass=function(e){this.onAnimatePass?this.onAnimatePass(e):e()},HoseEpisode.prototype.animateOpen=function(e){this.onAnimateOpen?this.onAnimateOpen(e):e()},HoseEpisode.isFreshEpisode=function(e){
return e>=cleverapps.user.episode-HoseEpisode.FRESH_EPISODES+1&&e<=cleverapps.user.episode},HoseEpisode.prototype.isFreshEpisode=function(){return HoseEpisode.isFreshEpisode(this.episodeNo)},HoseEpisode.prototype.isAvailableToPlay=function(){return!!cleverapps.config.editorMode||(cleverapps.config.results?this.isFreshEpisode():levels.user.episode>=this.episodeNo)},HoseEpisode.FRESH_EPISODES=3;var EpisodesManager={create:function(){switch(cleverapps.config.name){case"riddles":case"runes":case"adventure":case"crocword":return new HoseEpisodes}return new FakeEpisodes}},Episodes=function(){this.getAmountEpisodes=Episodes.getAmountEpisodes,this.onResetListener=function(){}};Episodes.prototype.reset=function(){delete Episodes.amountEpisodes,this.onResetListener()},Episodes.getAmountEpisodes=function(){return void 0===Episodes.amountEpisodes&&(Episodes.amountEpisodes=Episodes.calcAmountEpisodes()),Episodes.amountEpisodes},Episodes.calcAmountEpisodes=function(){for(
var e=0;void 0!==bundles[Episode.BundleId(e)];){var t=bundles[Episode.BundleId(e)];if(!t.jsons||!t.jsons.levels)break;e++}return e};var HoseEpisodes=function(){Episodes.call(this),this.episodes={},this.onAddEpisode=function(e){},levels.user.onLevelStatusChanged=function(e,t){var s=this.episodes[e];s&&s.levels[t].update()}.bind(this);var e={};cc.sys.isNative&&"match3"===cleverapps.config.type&&(e={amount:cleverapps.styles.PagesView.visiblePages+2,interval:"2 seconds",delay:"2 seconds"}),this.loadEpisodesExecutor=new ExecutorPool(e),cleverapps.config.results&&cleverapps.friends.addFriendsUpdatedListener(function(){for(var e in this.episodes){this.episodes[e].friendsResults.whenFriendListUpdated()}}.bind(this)),cleverapps.friends.addFriendsUpdatedListener(function(){levels.progress.whenFriendListUpdated()}),levels.progress.onUpdated=function(){for(var e in this.episodes){this.episodes[e].updateProgress()}}.bind(this),cleverapps.metha.getType()===Metha.HOSE&&this.reset()}
;HoseEpisodes.prototype=Object.create(Episodes.prototype),(HoseEpisodes.prototype.constructor=HoseEpisodes).prototype.gamePlayed=function(e,t){},HoseEpisodes.prototype.getActiveEpisode=function(){var e=levels.user.getCurrentLevel(),t=this.episodes[e.episodeNo];return t||(this.addEpisode(e.episodeNo),(t=this.episodes[e.episodeNo]).loadData()),t},HoseEpisodes.prototype.wantsToPlay=function(e,t){var s=this.getActiveEpisode().getLevel(levels.user.getCurrentLevel().levelNo);cleverapps.Plot.isPassedAllEpisodes=levels.user.isPassedAll(),((t=t||{}).playNext||t.dailyTask||t.mission||LevelStartWindow.isAvailable(s.episode.episodeNo,s.levelNo))&&BoostersBefore.isAvailable()?cleverapps.metha.compound(e,[function(e){t.playNext?cleverapps.Plot.GameLeave(e,t):e()},function(e){cleverapps.metha.showControlsWhileFocused("MenuBarGoldItem"),new LevelStartWindow({level:s}),cleverapps.metha.onceNoWindowsListener=e}]):(cleverapps.metha.showControlsWhileFocused("mainTableView"),s.play(e))},
HoseEpisodes.prototype.reset=function(){for(var e in delete this.currentEpisode,this.episodes)this.removeEpisode(e);this.episodes={},Episodes.prototype.reset.apply(this,arguments)},HoseEpisodes.prototype.addEpisode=function(e){var t=new HoseEpisode(e);this.episodes[e]=t,this.onAddEpisode(t)},HoseEpisodes.prototype.removeEpisode=function(e){this.episodes[e].destructor(),delete this.episodes[e]},HoseEpisodes.prototype.getCurrentEpisode=function(){return this.episodes[this.currentEpisode]},HoseEpisodes.prototype.loadCurrentEpisode=function(e){var t=[this.getCurrentEpisode()];cleverapps.styles.PagesView.noAutoScroll&&this.episodes[this.currentEpisode+1]&&t.push(this.episodes[this.currentEpisode+1]);var s=cleverapps.wait(t.length,e);t.forEach(function(e){e.whenLoaded(s)})},HoseEpisodes.prototype.range=function(e,t,s){return cleverapps.rangeArray(e+t,e+s).filter(function(e){return 0<=e&&e<=this.getAmountEpisodes()}.bind(this))},HoseEpisodes.prototype.setCurrentEpisode=function(t){void 0===(
t=parseInt(t))&&(t=levels.user.episode),t>=this.getAmountEpisodes()&&(t=this.getAmountEpisodes()),this.currentEpisode=t;var e,s,i=Object.keys(this.episodes).map(function(e){return parseInt(e)});if(this.currentEpisode<0)e=i.concat(i.indexOf(this.currentEpisode)<0?[this.currentEpisode]:[]).filter(function(e){return 0<=e||e===t}),s=[t];else{var n=cleverapps.styles.PagesView.visiblePages;e=this.range(t,-1,n+1),s=this.range(t,cleverapps.styles.PagesView.prevEpisodeShowed?-1:0,n)}cleverapps.substract(i,e).forEach(function(e){this.removeEpisode(e)},this),cleverapps.substract(e,i).forEach(function(e){this.addEpisode(e)},this),s.forEach(function(e){this.loadEpisodesExecutor.execute(function(){return this.episodes[e]?this.episodes[e].loadData():cleverapps.NO_ACTION}.bind(this))},this)},HoseEpisodes.prototype.nextEpisode=function(){this.currentEpisode+cleverapps.styles.PagesView.visiblePages<=this.getAmountEpisodes()&&this.setCurrentEpisode(this.currentEpisode+1)},
HoseEpisodes.prototype.prevEpisode=function(){return 0<this.currentEpisode&&(this.setCurrentEpisode(this.currentEpisode-1),!0)};var FakeEpisodes=function(){Episodes.call(this)};FakeEpisodes.prototype=Object.create(Episodes.prototype),(FakeEpisodes.prototype.constructor=FakeEpisodes).prototype.setCurrentEpisode=function(){},FakeEpisodes.prototype.getCurrentEpisode=function(){};var CloudsAnimation=cc.Node.extend({ctor:function(){this._super(),this.setLocalZOrder(101);var e=this.animation=new cleverapps.Spine(bundles.main.jsons.episode_clouds_spine_json);if(this.addChild(e),this.inUse=!0,cleverapps.styles.EpisodeView.text){var t=cleverapps.UI.generateTTFText("messages:LoadingEpisode",cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT);t.setPositionRound(cleverapps.styles.EpisodeView.text.x,cleverapps.styles.EpisodeView.text.y),t.setDimensions(.5*cleverapps.UI.getSceneSize().width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.addChild(t),(this.text=t).setAnchorPoint2()}},
startLoadAnimation:function(e){this.animation.setAnimation(0,"idle",!0),this.setVisible(!1),this.runAction(new cc.Sequence(new cc.DelayTime(.1),new cc.CallFunc(function(){this.visible=e.isRunningSafe()&&e.visible,this.text&&this.text.runAction(new cc.FadeIn(.3))}.bind(this))))},finishLoadAnimation:function(e){this.animation.setAnimation(0,"open",!1),this.animation.setCompleteListener(function(){this.finishAnimation(e)}.bind(this)),this.text&&(this.text.stopAllActions(),this.text.runAction(new cc.FadeOut(.7)))},finishAnimation:function(e){this.inUse&&(this.inUse=!1,cc.pool.putInPool(this),"function"==typeof e&&e())},unuse:function(){this.animation.visible=!1,this.animation.setCompleteListener(function(){}),this.animation.setStartVisibleListener(function(){}),this.removeFromParent()},reuse:function(){this.inUse=!0}});CloudsAnimation.factory=function(){return cc.pool.hasObject(CloudsAnimation)?cc.pool.getFromPool(CloudsAnimation):new CloudsAnimation},levels.EpisodesController=function(s){
var e=levels.episodes.currentLevel,t=levels.episodes.getCurrentEpisode();t||(levels.episodes.setCurrentEpisode(levels.user.episode),t=levels.episodes.getCurrentEpisode());var i=t.episodeNo;(cleverapps.user.episode<i||!t.isAvailableToPlay()&&!t.isComingSoon())&&(e=i=void 0),void 0===i&&(i=levels.user.episode),void 0===e&&(e=i===levels.user.episode?levels.user.level:0),levels.episodes.changeEpisodeAnimation&&(i=levels.user.episode-1,e=Episode.LEVELS_PER_EPISODE-1),levels.episodes.currentEpisode!==i&&levels.episodes.setCurrentEpisode(i);var n=new PagesView({currentLevelPos:levels.episodes.episodes[i].currentLevelPosition(e),disableLevelScroll:levels.episodes.disableLevelScroll,beginPage:i,amountPages:levels.episodes.getAmountEpisodes()+1,swallowTouches:!0});n.setLocalZOrder(-1),cleverapps.styles.EpisodeView.parallaxContainer?s.parallaxContainer.addChild(n):s.addChild(n),cleverapps.styles.EpisodesScene.hidable&&(cleverapps.UI.makeHideable(n),cleverapps.metha.registerControl("mainTableView"
,n)),s.updateBackgroundScale=function(){n.updateParallaxBackgroundsScale()};var o=function(e){if(n.autoScroll){var t=n.currentPage!==levels.episodes.currentEpisode;n.currentPage=levels.episodes.currentEpisode,n.scrollToCurrentPage(!1,t,e)}};levels.episodes.scrollToCurrentLevel=function(){n.scrollToCurrentLevel(!1)},levels.episodes.scrollToCurrentEpisode=function(e,t,s){n.currentPage=levels.episodes.currentEpisode,n.scrollToCurrentPage(e,t,s,levels.episodes.currentEpisode)};var r=function(){};for(var a in n.onScrolledToCurrentPage=function(){cleverapps.bundleLoader.clearUnusedResources(),r()},levels.episodes.gotoNextEpisode=function(e,t,s){r=function(){r=function(){},e()},n.autoScroll?(levels.episodes.nextEpisode(),o(t)):n.scrollToCurrentPage(!1,!0,t,void 0!==s?s:levels.episodes.currentEpisode+1)},levels.episodes.gotoPrevEpisode=function(e){n.autoScroll?(levels.episodes.prevEpisode(),o(e)):n.scrollToCurrentPage(!1,!0,e,levels.episodes.currentEpisode-1)},n.onNextPageListener=function(){
levels.episodes.nextEpisode(),o()}.bind(this),n.onPrevPageListener=function(){levels.episodes.prevEpisode(),o()}.bind(this),this.addPage=function(e){if(e.isComingSoon()){var t=new ComingSoonEpisodeView(e,s);n.addPage(t)}else if(0<=e.episodeNo){t=new EpisodeView(e,s);n.addPage(t)}},levels.episodes.onAddEpisode=n.createListener(this.addPage),levels.episodes.episodes)this.addPage(levels.episodes.episodes[a]);this.customize()},levels.EpisodesController.prototype.customize=function(){};var PagesView=PagingScrollView.extend({ctor:function(e){this.options=e;var t=cleverapps.UI.getSceneSize(),s=cleverapps.styles.PagesView;this.currentLevelPos=e.currentLevelPos,this.disableLevelScroll=e.disableLevelScroll;var i="scene"===s.pageWidth?t.width:s.pageWidth,n="scene"===s.pageHeight?t.height:s.pageHeight;this._super({beginPage:e.beginPage,amountPages:e.amountPages,swallowTouches:e.swallowTouches,noWheelScroll:e.noWheelScroll,styles:s,pageWidth:i,pageHeight:n}),this.setAnchorPoint(.5,.5)
;var o="scene"===s.width?t.width:s.width,r="scene"===s.height?t.height:s.height;this.setContentSize(o,r),this.calcFirstOffset(),this.parallax=new PagesViewParallax(s.parallax,this.container,s.direction),s["3d"]&&this.scheduleUpdate();var a=cleverapps.styles.PagesView.maxWidth;a&&a<o&&this.setScale(o/a)},updateParallaxBackgroundsScale:function(){this.parallax.updateScale()},update:function(e){if(this._super(e),cleverapps.styles.PagesView["3d"]){var r,a=cleverapps.styles.PagesView["3d"];r=cleverapps.wideMode.mode===cleverapps.WideMode.VERTICAL?a.mobileScales:a.scales,this.getVisiblePages().forEach(function(e){var t=this.height,s=-this.container.y,i=(t-(e.y-s)+this.pageHeight/2)/t,n=(i=i<1?i:1)*r[1]+r[0],o=n;a.horizont&&(o=i*r[1]+(i*(1-a.horizont.scale)+a.horizont.scale)*r[0]),e.setScale(n,o),e.setLocalZOrder(-e.pageNo)}.bind(this))}},scrollToCurrentLevel:function(e){this.autoScroll||!this.currentLevelPos||this.disableLevelScroll&&e||this.scrollToPositionInPage(this.currentLevelPos,e)},
showAnimation:function(e,t){if(this.stopAllActions(),e)return this.visible=!0,void this.setScale(1);this.getPages().forEach(function(e){e.setVisible(this.currentPage===e.pageNo)}.bind(this)),this.visible=!0,this.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.25,1),new cc.CallFunc(function(){this.showCurrentPageOnly()}.bind(this))))},hideAnimation:function(e,t){if(this.stopAllActions(),e)return this.setScale(0),void(this.visible=!1);this.getPages().forEach(function(e){e.setVisible(this.currentPage===e.pageNo)}.bind(this)),this.runAction(new cc.Sequence(new cc.DelayTime(t||0),new cc.ScaleTo(.15,0),new cc.CallFunc(function(){this.visible=!1}.bind(this))))},onEnter:function(){this._super(),this.customize(),this.scrollToCurrentPage(!0),this.scrollToCurrentLevel(!0)},customize:function(){this.setPosition(this.width/2,this.height/2+30*resolutionScale)}});cleverapps.styles.PagesView={direction:PagingScrollView.DIRECTIONS.Horizontal,height:1200,width:"scene",visiblePages:1,
prevEpisodeShowed:!1,pageHeight:1200,pageWidth:"scene","3d":!1,parallax:{speed:[0,.15],zIndex:[-1e3,-999],layers:[1,2,2],bundle:"episodes_spines",width:"scene",height:"scene"}};var EpisodeView=cc.Node.extend({ctor:function(e,t){this._super(),this.episode=e,this.pageNo=e.episodeNo,this.levels=[],this.setAnchorPoint(.5,.5),(this.episode.currentView=this).episodesScene=t;var s=cleverapps.UI.getSceneSize(),i=cleverapps.styles.EpisodeView.height,n=cleverapps.styles.EpisodeView.offsetEpisodes?-cleverapps.UI.getSceneOffsetY():0;cleverapps.styles.EpisodeView.direction===cleverapps.UI.VERTICAL?(this.setPositionRound(s.width/2,i*(e.episodeNo+.5)+n),this.bgScale=(i+cleverapps.styles.EpisodeView.addPixels)/i):(this.setPosition(s.width*(e.episodeNo+.5),i/2),this.bgScale=(s.width+cleverapps.styles.EpisodeView.addPixels)/s.width),this.isCustomBackground()||this.addDefaultBackground(),e.onLoadListener=this.createListener(this.onLoad.bind(this)),e.getExternalBundle(
)&&e.externalLoaded&&e.loaded||!e.getExternalBundle()&&e.loaded?this.onExternalLoad():e.onExternalLoadListener=this.createListener(this.onExternalLoad.bind(this)),e.onRemoveListener=this.createListener(this.onDelete.bind(this)),this.setLocalZOrder(-e.episodeNo),this.updateScale()},customize:function(){},updateScale:function(){var e=cleverapps.styles.EpisodeView;if(e.scale)this.setScale(e.scale);else{var t=cleverapps.UI.getSceneSize().width/(e.Background.width+e.padding);(t=Math.max(e.minScale,t))<1&&this.setScale(t)}this.baseScale=this.scale},onShow:function(){this.episode.loaded?this.onLoad():this.startLoadAnimation()},onDelete:function(){this.removeLoadAnimation(),this.removeNotOpennedAnimation(),this.removeFromParent()},addBetweenEpisodesFlag:function(){var e=cleverapps.styles.LevelView;if(e.betweenEpisodesFlag&&(e=e.betweenEpisodesFlag)[this.episode.getBundle().levelPositions]){var t=this.episode.bundleId(),s=e[this.episode.getBundle().levelPositions];if(!1!==s[t]){
var i=new cleverapps.Spine(e.spine);i.setPositionRound(s[t]?s[t]:s.default),i.setAnimation(0,this.episode.episodeNo<levels.user.episode?e.passed:e.notpassed,!0),this.addChild(i)}}},onLoad:function(){this.addDescription(),this.finishLoadAnimation(),this.levelViews=[],cleverapps.config.rpg||(this.levelViews=this.episode.levels.map(function(e){var t=LevelView;cleverapps.config.editorMode&&(t=LevelViewEditor);var s=new t(e,this);return this.addChild(s),s},this)),this.addBetweenEpisodesFlag(),this.addPlayerAvatar(),this.addFingerTip(),this.addTitle(),this.customize(),this.episode.getExternalBundle()&&!this.episode.externalLoaded&&this.addDefaultBackground()},onExternalLoad:function(){this.addSpines(),this.addIsland(),this.addBackground()},addTitle:function(){if("undefined"==typeof match3){var e={episodeNo:this.episode.episodeNo+1},t=cleverapps.styles.EpisodeView.title,s="messages:EpisodeView.Title";if(this.episode.isComingSoon()&&(s="messages:EpisodeView.ComingSoonTitle"),t.bg){
var i=cleverapps.UI.createScale9Sprite(t.bg.image);this.addChild(i),i.setPositionRound(t.bg),i.setContentSize2(t.bg)}var n=this.title=cleverapps.UI.generateTTFText(s,cleverapps.styles.FONTS.EPISODE_TITLE_TEXT,e);n.y=t.y,this.addChild(n,1)}},addDescription:function(){if("board"===cleverapps.config.type&&"stacks"!==cleverapps.config.subtype){var e,t=cleverapps.styles.EpisodeView;if(this.episode.isComingSoon())(e=cleverapps.UI.generateTTFText("messages:EpisodeView.ComingSoonDescription",cleverapps.styles.FONTS.DESCRIPTION_TEXT)).fitTo(.9*t.Background.width);else{for(var s=100,i=0,n=0;n<this.episode.levelsPerEpisode;n++){var o=this.episode.getLevelContent(n);s=Math.min(s,o.base.length),i=Math.max(i,o.base.length)}var r=Math.round(s/3+i/2-2);r<1&&(r=1),5<r&&(r=5),r=this.formatDifficulty(r);var a=s+" - "+i;s===i&&(a=s),e=cleverapps.UI.generateTTFText("messages:EpisodeView.Description",cleverapps.styles.FONTS.DESCRIPTION_TEXT,{letters:a,difficulty:r})}(this.description=e).y=t.description.y,
this.addChild(e)}},isCustomBackground:function(){return this.episode.getExternalBundle()||this.episode.getBundle().urls.background},addBackground:function(){var e=this.episode.getExternalBundle()&&this.episode.getExternalBundle().urls.background||this.episode.getBundle().urls.background;if(e){if(void 0===cc.loader.getRes(e))return console.log("No bg image loaded, using default: "+e),void this.addDefaultBackground();this.bg&&this.bg.removeFromParent(),this.bg=new cc.Sprite(cc.loader.getRes(e)),this.bg.setScale(this.bgScale),this.bg.setLocalZOrder(-1),this.addChild(this.bg)}},addDefaultBackground:function(){if("undefined"==typeof match3){var e=cleverapps.styles.EpisodeView.Background;this.bg=cleverapps.UI.createScale9Sprite(bundles.main.frames.episode_bg_png,cleverapps.UI.Scale9Rect.TwoPixelY),this.bg.setContentSize(e.width,e.height),this.bg.y=e.y,this.bg.setLocalZOrder(-1),this.addChild(this.bg),SceneDecors.add(this.bg,cleverapps.skins.getSlot("episodeView"))
}else bundles.main.urls.blank_bg_jpg&&(this.bg=new cc.Sprite(bundles.main.urls.blank_bg_jpg),this.bg.setScale(2*this.bgScale),this.bg.setLocalZOrder(-2),this.addChild(this.bg))},addSpines:function(){var e=this.episode.getExternalBundle()&&this.episode.getExternalBundle().urls.png;if(e)if(void 0!==cc.loader.getRes(e))for(var t=0;t<10;t++){var s=this.episode.getExternalBundle().jsons["spine_"+t+"_json"];if(!s)break;var i=new cleverapps.Spine(s);i.setAnimation(0,"animation",!0),i.setLocalZOrder(1),this.animation=i,this.addChild(i)}else console.log("No spines image loaded")},addIsland:function(){var e=this.episode.getIslandBundle();if(e&&e.jsons["island_"+this.episode.episodeNo+"_json"]){var t=this.island=new IslandView(this.episode,this.episodesScene);t.setLocalZOrder(3),this.addChild(t)}},removeLoadAnimation:function(){this.loading&&(this.loading.finishAnimation(),delete this.loading)},removeNotOpennedAnimation:function(){this.notOpennedAnimation&&(
this.notOpennedAnimation.removeFromParent(),delete this.notOpennedAnimation)},startLoadAnimation:function(){if(cleverapps.styles.EpisodeView.loadAnimation){var e=CloudsAnimation.factory();e.pageNo=this.pageNo,e.setPositionRound(this.getPosition()),this.getParent().addChild(e),(this.loading=e).startLoadAnimation(this)}},formatDifficulty:function(e){return e},finishLoadAnimation:function(){if(cleverapps.styles.EpisodeView.loadAnimation){if(this.loading)if(cc.director.getRunningScene()instanceof levels.EpisodesScene&&this.loading.visible){cleverapps.styles.EpisodeView;this.loading.finishLoadAnimation(this.removeLoadAnimation.bind(this))}else this.removeLoadAnimation();if(cleverapps.styles.EpisodeView.oldAnimation&&!this.episode.isComingSoon()&&cleverapps.user.episode>=this.episode.episodeNo){var e;if(this.episode.isAvailableToPlay())this.episode.isFirstNotInShadow()&&(e=new cleverapps.Spine(bundles.main.jsons.episode_clouds_line_spine_json)).setAnimation(0,"animation",!0);else{(
e=new cleverapps.Spine(bundles.main.jsons.episode_clouds_spine_json)).setAnimation(0,"old",!0);var t=cleverapps.UI.generateTTFText("messages:EpisodeView.TooOldEpisode",cleverapps.styles.FONTS.EPISODE_CLOUD_TEXT);t.setPositionRound(e.width/2,e.height/2+cleverapps.styles.EpisodeView.text.y),t.setDimensions(.5*cleverapps.UI.getSceneSize().width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setAnchorPoint2(),e.addChild(t)}e&&(e.setLocalZOrder(100),e.pageNo=this.pageNo,e.setPositionRound(this.getPosition()),this.getParent().addChild(e),this.notOpennedAnimation=e)}}},createUserView:function(){return new cleverapps.UI.Avatar(cleverapps.friends.getPlayer())},addPlayerAvatar:function(){var e=this.levelViews[levels.user.level];if(e&&!this.userView&&levels.user.episode===this.episode.episodeNo&&!this.episode.isComingSoon())if(cleverapps.social.isLoggedIn()){var t,s=this.userView=this.createUserView(),i=e.inLeftLevels(!0);cleverapps.styles.EpisodeView["player"+levels.user.level]?(
t=cleverapps.styles.EpisodeView["player"+levels.user.level],i&&cleverapps.styles.EpisodeView["playerLeftLevels"+levels.user.level]&&(t=cleverapps.styles.EpisodeView["playerLeftLevels"+levels.user.level])):(t=cleverapps.styles.EpisodeView.player,i&&cleverapps.styles.EpisodeView.playerLeftLevels&&(t=cleverapps.styles.EpisodeView.playerLeftLevels)),s.setPosition(e.getPosition()),s.x+=e.width/2+t.x,s.y+=e.height/2+t.y,void 0!==t.scale&&s.setScale(s.getScale()*t.scale),this.addChild(s),s.setLocalZOrder(4)}else cleverapps.friends.onUserUpdatedListener=this.createListener(function(){this.addPlayerAvatar()}.bind(this))},addFingerTip:function(){if(levels.user.episode===this.episode.episodeNo&&!this.episode.isComingSoon()&&cleverapps.styles.EpisodeView.fingerTip){var e=this.levelViews[levels.user.level];if(!e||e.fingerTip)return;var t=new FingerView({control:"episode_view_finger"});e.fingerTip=t,e.addChild(t),t.setPositionRound(e.width/2,e.height/2),t.standardLoop({
delay:cleverapps.styles.EpisodeView.finger.delay,delayOnBegin:!0})}}});cleverapps.styles.EpisodeView={height:cleverapps.styles.SCENE_HEIGHT,paddingTop:300,parallaxContainer:!0,addPixels:2,direction:cleverapps.UI.HORIZONTAL,Background:{width:720,height:1200},title:{y:490},description:{y:420},player:{x:5,y:5},episodeNum:{position:[{x:-180,y:480},{x:-540,y:480},{x:-540,y:480}]},finger:{delay:5},loadAnimation:!1,oldAnimation:!1};var ComingSoonEpisodeView=EpisodeView.extend({ctor:function(e,t){this._super(e,t),this.setLocalZOrder(1)},customize:function(){this._super();var e=cleverapps.styles.EpisodeView.comingSoon;e.textOffset&&(this.title.y+=e.textOffset,this.description.y+=e.textOffset)},onExternalLoad:function(){this._super(),this.addCharacter()},addCharacter:function(){var e=cleverapps.styles.EpisodeView.comingSoon.character;if(e.json)(t=new cleverapps.Spine(e.json)).setAnimation(0,e.animationName,!0);else var t=new cc.Sprite(e.image);t.setScale(e.scale),t.setPosition(e.x,e.y),
this.addChild(t)},addBackground:function(){if(bundles.main.jsons.episode_clouds_line_spine_json){var e=new cleverapps.Spine(bundles.main.jsons.episode_clouds_spine_json);e.setAnimation(0,"idle",!0),e.setLocalZOrder(-1),this.addChild(e)}}});cleverapps.overrideStyles(cleverapps.styles.EpisodeView,{comingSoon:{character:{scale:1,x:0,y:0}}});var Level=function(e,t,s){this.episode=e,this.levelNo=t,this.episodeNo=e.episodeNo,this.stars=s||0,this.players=[],this.update()};Level.prototype.getHash=function(){},Level.prototype.listPlayers=function(){return this.players.length<=3?this.players:this.players.splice(0,3)},Level.prototype.isClickable=function(){return!!cleverapps.config.editorMode||!(this.type===Level.TYPE_NOTPASSED||!this.episode.isAvailableToPlay())&&(this.type===Level.TYPE_CURRENT||"olympics"!==cleverapps.config.name)},Level.prototype.getHumanReadableNumber=function(){return cleverapps.humanReadableNumber(this.episodeNo,this.levelNo)},Level.prototype.insertPlayer=function(e){
this.players.push(e)},Level.prototype.removePlayer=function(e){var t=this.players.indexOf(e);-1<t&&this.players.splice(t,1)},Level.prototype.isRegular=function(){return this.episode.isRegular()},Level.prototype.isCurrentLevel=function(){return this.isRegular()&&levels.user.isCurrentLevel(this.levelNo,this.episode.episodeNo)},Level.prototype.isPassedLevel=function(){return levels.user.isPassedLevel(this.levelNo,this.episode.episodeNo)},Level.prototype.isHard=function(){return-1!==this.episode.getHardLevels().indexOf(this.levelNo)},Level.prototype.isTricky=function(){return-1!==this.episode.getTrickyLevels().indexOf(this.levelNo)},Level.prototype.isNew=function(){return this.type!==Level.TYPE_PASSED||this.isCurrentLevel()},Level.prototype.isLastLevelOnEpisode=function(){return this.episode.levels.map(function(e){return e.levelNo}).indexOf(this.levelNo)===this.episode.levelsPerEpisode-1},Level.prototype.getVersion=function(){return void 0===this.version&&(
this.version=this.episode.getLevelContent(this.levelNo).version),this.version},Level.prototype.improveStars=function(e){this.stars=e},Level.prototype.loadBundle=function(e){var t=e&&e.onSuccess||function(){};this.load(t)},Level.prototype.load=function(e,t){this.content&&!cleverapps.config.editorMode?e&&e():(this.episode.loadData(),this.episode.whenLoaded(function(){this.content=this.episode.getLevelContent(this.levelNo),this.hash=Level.CalcHash(this.content),e&&e()}.bind(this),t))},Level.prototype.unload=function(){this.episode.destructor()},Level.CalcHash=function(e){return RecursiveHasher(e,["episodeNo","levelNo","version","hard","paint","extra","gold","hash","hashes","comments","translate","definitions","bundles"])},Level.prototype.play=function(e,i){cleverapps.social.requestFullScreen(function(){cleverapps.config.editorMode&&(this.content=void 0,cleverapps.environment.setScene(cleverapps.Environment.SCENE_GAME)),cleverapps.rewardedAdsManager&&!cleverapps.isLocalhost(
)&&cleverapps.rewardedAdsManager.showInterstitial();var s=new SceneProxy;cleverapps.scenes.replaceScene(s,e,{level:this}),this.episode.levels&&1===this.episode.levels.length&&!this.episode.loaded&&s.whenLoaded(function(e){e.registerCleanupCallback(this.unload.bind(this))}.bind(this)),this.load(function(){var e="mergecraft"===cleverapps.config.name?void 0:new Game(this,i),t=new GameScene(e,this);t instanceof SceneProxy?t.whenLoaded(function(e){s.instance=e,s.onLoad()}):(s.instance=t,s.onLoad())}.bind(this))}.bind(this))},Level.prototype.onPressed=function(){cleverapps.lives&&cleverapps.lives.isEmpty()?cleverapps.metha.display({focus:["LevelPressedNoLives","MenuBarGoldItem","MenuBarLivesItem"],action:function(e){new LivesShopWindow,cleverapps.metha.onceNoWindowsListener=e}}):!BoostersBefore.isAvailable()&&(!0!==cleverapps.config.results||this.isCurrentLevel()&&!this.isHard())||!LevelStartWindow.isAvailable(this.episode.episodeNo,this.levelNo)?cleverapps.metha.display({
focus:"LevelPressedPlay",action:function(e){this.play(e)}.bind(this)}):cleverapps.metha.display({focus:"LevelStartWindow",control:"MenuBarGoldItem",actions:[function(e){this.load(e)}.bind(this),function(e){new LevelStartWindow({level:this}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},Level.prototype.update=function(){cleverapps.metha.getType()===Metha.HOSE?levels.user.episode>this.episode.episodeNo?this.type=Level.TYPE_PASSED:levels.user.episode<this.episode.episodeNo?this.type=Level.TYPE_NOTPASSED:levels.user.level>this.levelNo?this.type=Level.TYPE_PASSED:levels.user.level===this.levelNo?this.type=Level.TYPE_CURRENT:this.type=Level.TYPE_NOTPASSED:this.type=Level.TYPE_CURRENT},Level.prototype.isChampion=function(){if(!this.episode.friendsResults)return!1;var e=this.episode.friendsResults.listTop4(this.levelNo,!0);return!(e.length<=1||levels.user.id!==e[0].id||void 0===e[0].score)},Level.TYPE_PASSED=0,Level.TYPE_CURRENT=1,Level.TYPE_NOTPASSED=2
;var PlayerView=cleverapps.UI.Avatar.extend({ctor:function(e,t,s,i){var n=cleverapps.friends.getById(e);if(this._super(n.avatar),this.id=e,void 0!==t){var o=cleverapps.styles.LevelView;o=t?o["PlayerViewLeft"+i]?o["PlayerViewLeft"+i]:o.PlayerViewLeft:o["PlayerViewRight"+i]?o["PlayerViewRight"+i]:o.PlayerViewRight,this.setPositionRound(o.x,o.y),o.scale&&this.setScale(o.scale)}else{o=cleverapps.styles.LevelView.PlayerView;this.setPositionRound(o.x,o.y),o.scale&&this.setScale(o.scale)}}});PlayerView.TAG=1;var LevelView=cc.Node.extend({ctor:function(e,t){this._super(),this.level=e,void 0!==t&&this.calculatePosition(t),void 0!==t&&t.episode.isComingSoon()?this.setPosition(cleverapps.styles.LevelView.coming_soon[0]):(this.addLevelBg(),this.addLevelId()),this.level.listPlayers().forEach(this.insertPlayer.bind(this)),this.level.isClickable()?(this.addTouchListener(),cleverapps.UI.applyHover(this)):(this.level.type===Level.TYPE_NOTPASSED||!this.level.episode.isAvailableToPlay(
)&&this.level.episode.episodeNo>=levels.user.episode)&&cleverapps.tooltipManager.create(this,{text:Messages.get("LevelNotPassedTooltip"),position:cleverapps.styles.UI.Tooltip.LOCATION.below}),void 0!==t&&t.episode.isComingSoon()||this.customize()},inLeftLevels:function(e){var t=cleverapps.styles.LevelView;if(t.leftLevels){var s=t.leftLevels;e&&t.playerLeftLevels&&(s=t.playerLeftLevels);var i=!1;return this.level.episodeNo%2&&!t.notAlternate&&(i=!i),0<=s.indexOf(this.level.levelNo)&&(i=!i),i}},insertPlayer:function(e,t){if(cleverapps.friends.getById(e)){var s=cleverapps.styles.LevelView,i=new PlayerView(e,this.inLeftLevels(),this.level.episodeNo,this.level.levelNo),n=cleverapps.styles.LevelView.playersInterval,o=s.notAlternate?!this.inLeftLevels():this.inLeftLevels();i.x+=t*(o?n.x:-n.x),i.y-=t*n.y,0<t&&i.setLocalZOrder(-t),this.addChild(i)}},calculatePosition:function(){var e=cleverapps.styles.LevelView[this.level.episode.getBundle().levelPositions||"levels_1"][this.level.levelNo];(
this.level.levelNo<Episode.LEVELS_PER_EPISODE||e)&&this.setPosition(e)},customize:function(){},getAnimationName:function(){var e=this.level.isHard()?["hard_past","hard_current","hard_future"]:["past","current","future"],t=this.getStars();return void 0!==t&&this.level.type===Level.TYPE_PASSED?(e=this.level.isHard()?["hard_past_stars0","hard_past_stars1","hard_past_stars2","hard_past_stars3"]:["past_stars0","past_stars1","past_stars2","past_stars3"])[t]:e[this.level.type]},getStars:function(){if(cleverapps.config.results&&(this.level.episode.isAvailableToPlay()&&this.level.type!==Level.TYPE_CURRENT&&this.level.type===Level.TYPE_PASSED))return void 0!==this.level.stars?this.level.stars:0},addLevelBg:function(){var e=cleverapps.styles.LevelView,t=new cc.Node;t.setContentSize(e.clickSize),this.setContentSize(t.getContentSize());var s=this.getAnimationName(),i=new cleverapps.Spine(bundles.level.jsons.level_json);i.setAnimation(0,s,!0),i.setPosition(t.width/2,t.height/2+e.dy),t.addChild(i),
this.setAnchorPoint2(),this.addChild(t)},addLevelId:function(){this.level.isHard()&&cleverapps.styles.LevelView.hideHardLevelNo||LevelView.generateLevelId(this,this.level.type,this.level.getHumanReadableNumber())},addTouchListener:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,onTouchBegan:function(e){var t=this.convertTouchToNodeSpace(e);return this.beginLocation=e.getLocation(),!(!cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t)||!this.isVisible())&&(this.onTouchBegan(),!0)}.bind(this),onTouchMoved:function(e){if(this.beginLocation){var t=e.getLocation();if(10<Math.abs(t.x-this.beginLocation.x)+Math.abs(t.y-this.beginLocation.y))return this.onTouchEnded(),this.beginLocation=!1}return!0}.bind(this),onTouchEnded:function(e){if(this.beginLocation){var t=this.convertTouchToNodeSpace(e);if(cc.rectContainsPoint(cc.rect(0,0,this.width,this.height),t))return this.onTouchBegan(),this.onPressed(),!0}return!1}.bind(this)},this)},onPressed:function(){
cleverapps.audio.playSound(bundles.main.urls.click_effect),this.level.onPressed()},onTouchBegan:function(){this.startPositionY=this.startPositionY||this.getPositionY(),this.setPositionY(this.startPositionY-3)},onTouchEnded:function(){this.setPositionY(this.startPositionY)}});LevelView.generateLevelId=function(e,t,s){var i=cleverapps.styles.LevelView.LevelId;if(cleverapps.config.editorMode||-1!==i.showTypes.indexOf(t)){var n=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT;t===Level.TYPE_NOTPASSED&&(n=cleverapps.styles.FONTS.LEVEL_NOT_PASSED_TITLE_TEXT),t===Level.TYPE_CURRENT&&cleverapps.styles.FONTS.LEVEL_CURRENT_TITLE_TEXT&&(n=cleverapps.styles.FONTS.LEVEL_CURRENT_TITLE_TEXT);var o,r=cleverapps.UI.generateImageText(s,n);1e3<=s?o=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT.alternativeSizes[1]:100<=s&&(o=cleverapps.styles.FONTS.LEVEL_TITLE_TEXT.alternativeSizes[0]),o&&r.setScale(r.scale*o),e.addChild(r);var a=i;(e.levelId=r).setPositionRound(a.x,a.y)}},cleverapps.overrideFonts(
cleverapps.styles.FONTS,{LEVEL_TITLE_TEXT:{name:"default",size:40,color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]},LEVEL_NOT_PASSED_TITLE_TEXT:{name:"default",size:40,color:cleverapps.styles.COLORS.WHITE,alternativeSizes:[.9,.8]}}),cleverapps.styles.LevelView={curLevelAction:{scale:1.2},coming_soon:[{x:-60,y:-200}],LevelId:{x:{dx:0},y:{dy:0},showTypes:[Level.TYPE_PASSED,Level.TYPE_CURRENT,Level.TYPE_NOTPASSED]},playersInterval:{x:16,y:8},PlayerView:{x:0,y:0},clickSize:{width:90,height:75},dy:-10};var FbConnectWindow=Window.extend({onWindowLoaded:function(e,t,s){var i=cleverapps.styles.FbConnectWindow;s=s||{};var n=i.width,o=[],r=function(e){e.setDimensions(n,0),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.push(e)};s.errorMessage&&r(cleverapps.UI.generateTTFText(s.errorMessage,cleverapps.styles.FONTS.SMALL_TEXT_ERROR)),r(cleverapps.UI.generateTTFText("xsolla"===cleverapps.User.calcSource()?"messages:XsollaLogin.text":"messages:FbConnectWindow.text",
cleverapps.styles.FONTS.FBCONNECT_WINDOW_TEXT||cleverapps.styles.FONTS.WINDOW_TEXT));var a=new cleverapps.Layout(o,{padding:i.padding,y:i.offsetY,margin:i.Text.padding,direction:cleverapps.UI.VERTICAL,x:n/2});this._super({title:"messages:SignIn",closeButton:!s.withWindow,name:"fbconnectwindow",content:a}),e=cleverapps.once(e||function(){});var c=function(){this.onClose=function(){},this.close(),e()}.bind(this);t&&(this.onClose=t),this.addButtons(c),cleverapps.audio.playSound(bundles.main.urls.window_effect)},addButtons:function(s){var i=cleverapps.social.getCodes(),n=cleverapps.styles.FbConnectWindow,e=i.map(function(e){n.Button[e]&&n.Button[e].button_png;var t={multiSocials:1<i.length,height:n.Button.height,showText:1===i.length,iconScale:n.Button.iconScale,login:!0,source:e,onSuccess:s};return new FbButton(t)}),t=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:n.Button.margin});this.window.addChild(t);var o=n.Button.bottomPadding
;1<i.length&&void 0!==n.Button.multiSocials.bottomPadding&&(o=n.Button.multiSocials.bottomPadding),t.setPositionRound(this.window.width/2,t.height/2+o)}});cleverapps.styles.FbConnectWindow={width:600,offsetY:75,padding:{x:0,y:0},Button:{bottomPadding:50,height:120,margin:40,iconScale:.9,multiSocials:{}},Text:{extraWidth:0,padding:20},ButtonContent:{width:340,height:120,image:{x:20,y:5},minWidth:80,text:{x:10,y:6},empty:!1}};var Boatswain=function(e){this.level=e,this.level.episode.isDailyCup()?this.intent=this.BACK_TO_DAILY_CUP:this.intent=this.BACK_TO_MAIN};Boatswain.prototype.BACK_TO_DAILY_CUP=function(e){cleverapps.scenes.replaceScene(new DailyCupScene,e)},Boatswain.prototype.DAILY_LEVEL_BACK_TO_MAIN=function(e){var t=function(){cleverapps.metha.gotoMainScene(e)};cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED)?(t=cleverapps.waitNoMore(3e4,t),cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,t)):t()},Boatswain.prototype.BACK_TO_MAIN=function(e){
cleverapps.Plot.GameLeave(e,{level:this.level})},Boatswain.prototype.PLAY_NEXT=function(e){cleverapps.metha.wantsToPlay(e,{level:this.level,playNext:!0})},Boatswain.prototype.REPLAY=function(e,t){(t=t||{}).level=this.level,t.replay=!0,cleverapps.metha.wantsToReplay(e,t)},Boatswain.EXIT_INTENT=0,Boatswain.NEXT_INTENT=1,Boatswain.REPLAY_INTENT=2;var DailyLevel=function(){cleverapps.isLocalhost()&&delete DailyLevel.AVAILABLE.source,this.load()};DailyLevel.prototype.load=function(){if(this.isAvailable()){var e=cleverapps.User.calcChannel("event");e&&0===e.indexOf(DailyLevel.EVENT_NAME)&&(this.currentEvent=e.substr(DailyLevel.EVENT_NAME.length),this.startFromPortlet=!0),this.currentEvent=this.currentEvent||this.getCurrentEvent();var t=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.DAILY_LEVEL);this.passed=t&&t.event===this.currentEvent&&(!t.levelsToPass||0===t.levelsToPass),this.levelsToPass=t&&t.levelsToPass?t.levelsToPass:this.getCountOfLevelsForReward(),
cleverapps.config.debugMode&&-1!==["576593702177"].indexOf(cleverapps.user.id)&&(this.passed=!1)}},DailyLevel.prototype.start=function(e){var t=this.getCurrentLevel(),s=new Episode(Episode.Types.DAILY_LEVELS,t).getLevel();LevelStartWindow.isAvailable(cleverapps.user.episode,cleverapps.user.level)&&BoostersBefore.isAvailable()?(new LevelStartWindow({level:s}),cleverapps.metha.onceNoWindowsListener=e):s.play(e)},DailyLevel.prototype.isAvailable=function(){return cleverapps.user.checkAvailable(DailyLevel.AVAILABLE)&&this.getBundle()},DailyLevel.prototype.getBundle=function(){return bundles.episode_daily_levels_ru||bundles.episode_daily_levels},DailyLevel.prototype.isActive=function(){return this.isAvailable()&&!this.passed},DailyLevel.prototype.isStartFromPortlet=function(){return this.isAvailable()&&this.startFromPortlet},DailyLevel.prototype.reset=function(){this.passed=!1,this.levelsToPass=this.getCountOfLevelsForReward(),cleverapps.DataLoader.remove(
cleverapps.DataLoaderTypes.DAILY_LEVEL)},DailyLevel.prototype.onWin=function(e){this.levelsToPass--,cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.DAILY_LEVEL,{event:this.getCurrentEvent(),levelsToPass:this.levelsToPass}),0===this.levelsToPass&&(this.passed=!0,cleverapps.social.setStatus&&cleverapps.social.setStatus(DailyLevel.EVENT_NAME+this.getCurrentEvent(),this.getStatus(e)),cleverapps.eventLogger.logEvent("daily_level_passed_"+this.getCurrentEvent()))},DailyLevel.prototype.getStatus=function(e){var t={},s=e.content;if("board"===cleverapps.config.type){var i=function(e){return 1===e?Messages.get("DailyLevel.Status.wordsAmount1"):e<=4?Messages.get("DailyLevel.Status.wordsAmount234",{amount:e}):Messages.get("DailyLevel.Status.wordsAmount5",{amount:e})};t={firstWord:s.words[0].toUpperCase(),base:s.base.toUpperCase(),amountMinus1:i(s.words.length-1),baseLength:s.base.length,wordsAmount:i(s.words.length)}}else"solitaire"===cleverapps.config.type&&(t={
cardsCount:Game.currentGame.table.beginCards,movesLeft:s.hand.num});var n=Messages.get("DailyLevel.Status.common",t);return n[Math.floor(Math.random()*n.length)]},DailyLevel.prototype.getCurrentEvent=function(){if(this.currentEvent)return this.currentEvent;var e=new Date;return cleverapps.padZeroes(e.getFullYear()%100,2)+cleverapps.padZeroes(e.getMonth()+1,2)+cleverapps.padZeroes(e.getDate(),2)},DailyLevel.prototype.getCurrentLevel=function(){var e=this.getCurrentEvent(),t=e.substr(0,2),s=e.substr(2,2),i=e.substr(4,2),n=new Date;n.setUTCFullYear(parseInt("20"+t),parseInt(s)-1,parseInt(i)),n.setUTCHours(0,0,0,0);var o=n.getTime()-new Date("2019-12-17").getTime();o/=864e5;var r=Math.floor(o),a=this.getBundle().levelsAmount-this.getCountOfLevelsForReward()+1,c=(r%a+a)%a;return console.log("dailylevel.getCurrentLevel event "+e+" levelNo "+c),c+(this.getCountOfLevelsForReward()-this.levelsToPass)},DailyLevel.prototype.getCountOfLevelsForReward=function(){return 1},
DailyLevel.EVENT_NAME="dailylevel",DailyLevel.AVAILABLE={projectName:["wordsoup","crocword","olympics","tripeaks"],language:"ru",source:["web_ok","mobile_ok"]};var DailyLevelWindow=Window.extend({onWindowLoaded:function(e){this.options=e;var t=cleverapps.styles.DailyLevelWindow;this._super({title:"messages:DailyLevelWindow.title",name:"dailylevelwindow",content:this.getContent(),styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.DailyLevelWindow.window,!0),button:{text:Messages.get("Play"),width:t.button.width,height:t.button.height,onPressed:function(){this.close()}.bind(this)}}),t.hero&&(this.hero=new cleverapps.Spine(t.hero.json,1),this.hero.setAnimation(0,t.hero.animation,!0),this.hero.setPositionRound(t.hero),this.hero.setScale(t.hero.scale),this.addChild(this.hero))},getContent:function(){var e=cleverapps.styles.DailyLevelWindow,t=[];if(e.animation.json){var s=this.createAnimation();t.push(s)}if(e.label){var i=new cc.Sprite(e.label);i.rotation=-15,t.push(
i)}var n=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:2*e.contentObjectsMargin}),o=this.createText();return new cleverapps.Layout([o,n],{direction:cleverapps.UI.VERTICAL,margin:e.contentObjectsMargin,padding:{x:0,y:e.contentObjectsMargin}})},createText:function(){var e=cleverapps.styles.DailyLevelWindow,t=cleverapps.UI.generateTTFText("messages:DailyLevelWindow.text",cleverapps.styles.FONTS.WINDOW_SMALL_TEXT,{left:cleverapps.dailyLevel.levelsToPass});return t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(cc.size(e.textWidth,0)),t},createAnimation:function(){var e=cleverapps.styles.DailyLevelWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize(e.size);var s=new cleverapps.Spine(e.animation.json,e.scale);return s.setAnimation(0,e.animation.name?e.animation.name:"idle",!0),t.addChild(s),s.setPositionRound(t.width/2+e.animation.dx,t.height/2+e.animation.dy),t}});cleverapps.styles.DailyLevelWindow={contentObjectsMargin:30,textWidth:540,size:{
width:250,height:350},scale:.55,button:{width:200,height:100},animation:{dx:-100,dy:-70,json:bundles.hero.jsons.hero_json,name:"coming_soon"},label:bundles.game.frames.label_50_ok_png},cleverapps.Lives=function(e){cleverapps.config.debugMode&&(cleverapps.Lives.TIMEOUT=cleverapps.parseInterval("1 minutes")/cleverapps.Lives.MAX_REGEN_AMOUNT/1e3+""),e?(this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0,this.save()):this.load(),this.onChangeAmountListeners={},this.onStartRegenerateListener=function(){},this.onBuyUnlimitedLivesListener=function(){},this.onShowIconForceListener=function(e){},this.onShowShopForceListener=function(e){},this.processRegenerateState()},cleverapps.Lives.prototype.processRegenerateState=function(e){var t,s;for(this.stopRegenerateTimeout();this.amount<cleverapps.Lives.MAX_REGEN_AMOUNT&&this.whenStart&&this.whenStart+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)<=Date.now();)this.amount++,this.whenStart+=cleverapps.parseInterval(
cleverapps.Lives.TIMEOUT),s=t=!0;var i=cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES);!t||e||i||this.runListeners(),this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT?delete this.whenStart:(this.whenStart||(this.whenStart=Date.now(),s=!0),this.startRegenerateTimeout(void 0!==e?e:i)),s&&this.save(),this.processLocalPushes()},cleverapps.Lives.prototype.startRegenerateTimeout=function(e){void 0===this.finishRegenerateTimeout&&(this.finishRegenerateTimeout=new cleverapps.LongTimeout(this.processRegenerateState.bind(this),this.calcTimeLeft()),e||this.onStartRegenerateListener())},cleverapps.Lives.prototype.stopRegenerateTimeout=function(){clearTimeout(this.finishRegenerateTimeout),this.finishRegenerateTimeout=void 0},cleverapps.Lives.prototype.isRegenerateRunning=function(){return void 0!==this.finishRegenerateTimeout},cleverapps.Lives.prototype.calcTimeLeft=function(){var e=(this.whenStart||Date.now())+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)-Date.now()
;return e<0&&(e=0),e>cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)&&(e=cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)),e},cleverapps.Lives.prototype.isEmpty=function(){return 0===this.amount&&!cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)},cleverapps.Lives.prototype.isFull=function(){return this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES)},cleverapps.Lives.prototype.give=function(e,t){e=void 0===e?1:e,this.setAmount(this.amount+e,t)},cleverapps.Lives.prototype.setMaxAmount=function(e){cleverapps.Lives.MAX_REGEN_AMOUNT=e,this.save(),this.runListeners(),this.processRegenerateState()},cleverapps.Lives.prototype.setAmount=function(e,t){if(e<0&&(e=0),0<this.amount-e){var s=cleverapps.missionManager.findByType(Mission.TYPE_ENERGY_FEAST);s&&s.update(this.amount-e)}this.amount!==e&&(this.amount=e,this.save(),t||this.runListeners()),this.processRegenerateState(t),this.showForce()},
cleverapps.Lives.prototype.processLocalPushes=cleverapps.timeredThrottle(cleverapps.parseInterval("1 minute"),function(){if(this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT||cleverapps.tempGoods.checkGoodBuyed(cleverapps.TempGoods.UNLIMITED_LIVES))cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.LIVES);else{var e=cleverapps.Lives.MAX_REGEN_AMOUNT-this.amount,t=(this.whenStart||Date.now())+cleverapps.parseInterval(cleverapps.Lives.TIMEOUT)*e-Date.now();cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.LIVES,t)}}),cleverapps.Lives.prototype.reset=function(){this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0,this.processRegenerateState(),this.save()},cleverapps.Lives.prototype.canTake=function(e){return this.amount>=e},cleverapps.Lives.prototype.take=function(e){cleverapps.config.editorMode||(this.amount>=cleverapps.Lives.MAX_REGEN_AMOUNT&&delete this.whenStart,0<this.amount&&this.setAmount(this.amount-1,e))},
cleverapps.Lives.prototype.getInfo=function(){var e={amount:this.amount,ws:this.whenStart};return cleverapps.Lives.SAVE_MAX_AMOUNT&&(e.max=cleverapps.Lives.MAX_REGEN_AMOUNT),e},cleverapps.Lives.prototype.updateInfo=function(e,t){this.amount=e.amount,this.whenStart=e.ws||e.whenStart,e.max&&(cleverapps.Lives.MAX_REGEN_AMOUNT=e.max),this.processRegenerateState(),this.save(t)},cleverapps.Lives.prototype.runListeners=function(){cleverapps.values(this.onChangeAmountListeners).forEach(function(e){e()})},cleverapps.Lives.prototype.save=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.LIVES,this.getInfo()),e||cleverapps.synchronizer.addUpdateTask("lives")},cleverapps.Lives.prototype.load=function(){var e=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.LIVES);e?(this.amount=e.amount,this.whenStart=e.ws||e.whenStart,e.max&&(cleverapps.Lives.MAX_REGEN_AMOUNT=e.max)):(this.amount=cleverapps.Lives.MAX_REGEN_AMOUNT,this.whenStart=void 0)},
cleverapps.Lives.prototype.canShowForce=function(){return"merge"===cleverapps.config.type&&VirtualProducts.buyEnergy350&&Game.currentGame&&Game.currentGame.gameLevel&&Game.currentGame.gameLevel.getLevel()<=7&&this.amount<.1*cleverapps.Lives.MAX_REGEN_AMOUNT&&!cleverapps.forces.isShown(Forces.BUY_ENERGY_ICON.id)},cleverapps.Lives.prototype.showForce=function(){var t,s;this.canShowForce()&&cleverapps.metha.display({focus:"LivesMenuBarItemForce",control:"MenuBarLivesItem",actions:[function(e){setTimeout(e,500)},function(e){this.onShowIconForceListener(Forces.BUY_ENERGY_ICON),cleverapps.forces.onceForceClosed=e}.bind(this),function(e){t=VirtualProducts.buyEnergy350.price,s=VirtualProducts.buyEnergy350.reward,VirtualProducts.buyEnergy350.price=0,VirtualProducts.buyEnergy350.reward=30,new LivesShopWindow,cleverapps.environment.onOpenWindowListener=cleverapps.once(e)},function(e){this.onShowShopForceListener(Forces.BUY_ENERGY_SHOP),e=cleverapps.once(e),cleverapps.forces.onceForceClosed=e,
cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){VirtualProducts.buyEnergy350.price=t,VirtualProducts.buyEnergy350.reward=s,e()}]})},cleverapps.Lives.MAX_REGEN_AMOUNT=5,cleverapps.Lives.TIMEOUT="30 minutes","olympics"===cleverapps.config.name&&(cleverapps.Lives.MAX_REGEN_AMOUNT=3),"merge"===cleverapps.config.type&&(cleverapps.Lives.TIMEOUT="3 minutes",cleverapps.Lives.SAVE_MAX_AMOUNT=!0),cleverapps.overrideStyles(cleverapps.styles.SideBarIconView,{lock:{color:!1,greyscale:!0,x:{align:"right",dx:4},y:{align:"bottom",dy:39}},text:{x:{align:"center",dx:0},y:{align:"bottom",dy:-15},offsetY:4,bg:{scale9:!0,width:180,height:80},textWidth:150}}),cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{LIGHT_TEXT_COLOR:new cc.Color(255,255,255,255),YELLOW_TEXT_COLOR:new cc.Color(247,230,43,255),LIGHT_TEXT_DISABLED_COLOR:new cc.Color(200,200,200,255),LIGHT_TEXT_STROKE_COLOR:new cc.Color(0,0,0,125),LIGHT_TEXT_SHADOW_COLOR:new cc.Color(9,0,0,100),
GREEN:new cc.Color(123,194,63,255),COLOR_RED:new cc.Color(255,74,74,255),DARK_TEXT_COLOR:new cc.Color(121,75,57,255)}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{TITLE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.TITLE_SHADOW,direction:cc.size(0,-2),blur:1},LIGHT_TEXT_STROKE:{color:cleverapps.styles.COLORS.LIGHT_TEXT_STROKE_COLOR,size:1},LIGHT_TEXT_SHADOW:{color:cleverapps.styles.COLORS.LIGHT_TEXT_SHADOW_COLOR,direction:cc.size(0,-3),blur:3}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{WINDOW_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},WINDOW_SMALL_TEXT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},WINDOW_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},WAIT_WINDOW_TEXT:{
size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SMALL_TEXT_ERROR:{size:40,color:cleverapps.styles.COLORS.COLOR_RED},FBCONNECT_WINDOW_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},NEW_VERSION_WINDOW_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},SETTINGS_WINDOW_ID_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},LIGHT_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},LIGHT_TITLE_TEXT_DISABLED:{size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_DISABLED_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},LIGHT_SUBTITLE_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,
shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},UNIT_PROB:{size:35,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BIG_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BUTTON_SMALL_TEXT:{size:36,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},FORCE_MESSAGE_TEXT:{size:45,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},LIGHT_BUTTON_IMAGE_TEXT:{name:"default",size:35,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},LIGHT_BUTTON_TEXT:{size:45,
color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},LIGHT_TEXT:{size:35,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},DARK_TEXT:{name:"nostroke",size:45,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},LOADING_TEXT:{size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},REWARDS_LIST_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},REWARD_WINDOW_REWARDS_TEXT:{name:"nostroke",size:40,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},SIDEBAR_ICON_TEXT:{name:"default",size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},CONFIRM_AND_EXIT_TEXT:{
name:"nostroke",size:45,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.overrideStyles(cleverapps.styles.Window,{Border:{y:110,x:60},titleCloseButtonMargin:70,Title:{offsetX:0,offsetY:-10,bg:{adjustToText:{width:120,height:-25,offset:{y:-8,x:0}},image:bundles.windows.frames.window_title_background,zIndex:1,x:{align:"center"},y:{align:"top",dy:0}}},CloseButton:{offsetX:30,offsetY:30},BottomButton:{bottomPadding:80},bgOffset:{y:-50,x:0},Background:{paddingX:30}}),cleverapps.overrideStyles(cleverapps.styles.Tabs,{buttons:{x:{align:"center",dx:0},y:{align:"center",dy:0},width:135,height:240},attention:{x:{align:"left",dx:-30},y:{align:"top",dy:-15}},margin:6,direction:cleverapps.UI.TOP_TO_BOTTOM}),cleverapps.overrideStyles(cleverapps.styles.SettingsWindow,{window:{contentOffset:-20}}),cleverapps.overrideStyles(cleverapps.styles.FbConnectWindow,{offsetY:90,Button:{bottomPadding:70}}),cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{
COLOR_BONUS:new cc.Color(215,169,255,255)}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{MENUBAR_TEXT:{name:"default",size:56}}),cleverapps.overrideStyles(cleverapps.styles.MenuBar,{margin:0,smallMargin:-18,padding:{x:78,y:0},position:{x:{align:"left",dx:0},y:{align:"top",dy:-52}}}),cleverapps.overrideStyles(cleverapps.styles.MenuBarItem,{bg:{width:299,height:91,minWidth:247},icon:{x:26,y:0},plusButton:{position:{x:{align:"right",dx:-14},y:{align:"center",dy:1}}},textOffset:{imageFont:2},noPlusDx:12,iconBlockWidth:84,plusBlockWidth:84}),cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{SHOP_STROKE_COLOR:new cc.Color(0,0,0,100),SHOP_SHADOW_COLOR:new cc.Color(0,0,0,80)}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{SHOP_STROKE:{color:cleverapps.styles.COLORS.SHOP_STROKE_COLOR,size:1},SHOP_SHADOW:{color:cleverapps.styles.COLORS.SHOP_SHADOW_COLOR,direction:cc.size(0,-2),blur:3}}),cleverapps.overrideFonts(
cleverapps.styles.FONTS,{TILE_SHOP_OFFER_TEXT_LARGE:{name:"default",color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,size:62},TILE_SHOP_OFFER_TEXT_SMALL:{name:"default",color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,size:35},SHOP_LARGE_TILE_BUTTON_TEXT:{name:"default",size:48,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.SHOP_STROKE,shadow:cleverapps.styles.DECORATORS.SHOP_SHADOW},SHOP_SMALL_TILE_BUTTON_TEXT:{name:"default",size:32,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.SHOP_STROKE,shadow:cleverapps.styles.DECORATORS.SHOP_SHADOW},SHOP_LIVES_PRODUCT_TILE_TITLE:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.SHOP_STROKE,shadow:cleverapps.styles.DECORATORS.SHOP_SHADOW},SHOP_LIVES_PRODUCT_TILE_DESCRIPTION_TEXT:{name:"nostroke",size:26,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.overrideStyles(cleverapps.styles.CoinsProductLargeTile,{
adjustBackgroundCapInsets:!0,width:460,margin:18,offset:{y:-30}}),cleverapps.overrideStyles(cleverapps.styles.CoinsProductSmallTile,{adjustBackgroundCapInsets:!0,width:260,height:360,margin:5,offset:{y:-15}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileRewardsBlock,{width:445,height:130,offsetY:30,gold:{icon:bundles.tile_shop.frames.shop_gold_png,scale:.7}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileRewardsBlock,{width:245,height:80,offsetY:20,gold:{icon:bundles.tile_shop.frames.shop_gold_png,scale:.6}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileButton,{width:230,height:90,text:{dy:0}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileButton,{width:150,height:60,text:{dy:0}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileIcon,{height:void 0,wrap:{dx:15,dy:30}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileIcon,{height:190,wrap:{dy:5}}),cleverapps.overrideStyles(cleverapps.styles.LargeTileBadge,{x:{align:"left",dx:-39},y:{align:"top",
dy:39},text:{x:-5,y:5}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileBadge,{x:{align:"right",dx:35},y:{align:"top",dy:33},text:{x:0,y:0},scale:.6}),cleverapps.overrideStyles(cleverapps.styles.LivesProductTile,{isSmall:!1,adjustBackgroundCapInsets:!0,width:460,height:747,margin:10,offset:{y:-30},title:{size:{width:445,height:125},y:12,bg:bundles.tile_shop.frames.tile_best_stripe_png,bg_off:bundles.tile_shop.frames.tile_best_stripe_png_off,paddingX:60}});var UseEnergyButton=cleverapps.UI.Button.extend({ctor:function(e,t){this.price=e.energy,this._super({styles:t,content:this.createContent(e,t),onClicked:e.onClicked,button_images:e.button_images||cleverapps.UI.Button.Images.button_green})},createContent:function(e,t){var s=new cc.Sprite(bundles.energyup.frames.button_energy_png),i=cleverapps.UI.generateImageText(this.price,e.font||cleverapps.styles.FONTS.BUTTON_TEXT);this.price>cleverapps.lives.amount&&i.setColor(cleverapps.styles.COLORS.COLOR_RED);var n=new cleverapps.Layout([s,
i],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin});return s.y+=cleverapps.styles.UseEnergyButton.iconOffsetY,n}});cleverapps.styles.UseEnergyButton={iconOffsetY:-3};var SpeedUpWindow=Window.extend({onWindowLoaded:function(e){this.worker=e,this.controls=cleverapps.missionManager.findByType(Mission.TYPE_COINS_TIME)?"MenuBarCoinsItem":"MenuBarGoldItem",this._super({title:"messages:SpeedUpWindow.title",name:"SpeedUpWindow",content:this.createContent(),adjustToContent:!0,closeButton:!0}),cleverapps.metha.showControlsWhileFocused(this.controls),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.SpeedUpWindow,t=cleverapps.UI.generateOnlyText("messages:SpeedUpWindow.text",cleverapps.styles.FONTS.SPEEDUP_WINDOW_TEXT),s=this.createTimer(this.worker.getTimeLeft()),i=this.createButtons();return new cleverapps.Layout([i,s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},createButtons:function(){
var e=cleverapps.styles.SpeedUpWindow.buttons,t=["speedup_worker_ruby"];this.worker.unit&&t.push("speedup_"+this.worker.unit.getKey()+"_ruby");var s=new UseGoldButton({price:SpeedUpWindow.CalcPrice(this.worker.getTimeLeft()),canCoins:!0,onClicked:this.speedUpForGold.bind(this),font:cleverapps.styles.FONTS.SPEEDUP_WINDOW_BUTTON_IMAGE_TEXT,eventName:t},e.button);if(this.worker.isSpeedUpBonusActive()){var i=new cc.Sprite(bundles.shared.frames.adicon_png);i.setScale(e.reward.scale);var n=new cleverapps.Layout([i,cleverapps.UI.generateOnlyText("messages:Watch",cleverapps.styles.FONTS.SPEEDUP_WINDOW_BUTTON_TEXT)],{direction:cleverapps.UI.HORIZONTAL,margin:e.button.margin}),o=new cleverapps.UI.Button({styles:e.button,content:n,onClicked:this.speedUpForVideo.bind(this),button_images:cleverapps.UI.Button.Images.button_blue}),r=cleverapps.UI.generateOnlyText("messages:SpeedUpWindow.hint",cleverapps.styles.FONTS.SPEEDUP_WINDOW_HINT_TEXT,{minutes:Number.parseInt(this.worker.bonus.time)})
;r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)}if(cleverapps.missionManager.findByType(Mission.TYPE_COINS_TIME)&&(r=new cleverapps.Layout([cleverapps.UI.generateOnlyText("*",cleverapps.styles.FONTS.SPEEDUP_WINDOW_HINT_TEXT),cleverapps.UI.generateOnlyText("messages:CoinsTimeMissionWindow.details.text",cleverapps.styles.FONTS.SPEEDUP_WINDOW_HINT_TEXT)],{direction:cleverapps.UI.HORIZONTAL,margin:e.note.margin})),this.isStopAvailable())var a=new cleverapps.UI.Button({styles:e.button,content:cleverapps.UI.generateOnlyText("messages:SpeedUpWindow.stop",cleverapps.styles.FONTS.SPEEDUP_WINDOW_BUTTON_TEXT),onClicked:this.stopWorker.bind(this),button_images:cleverapps.UI.Button.Images.button_red});var c=new cleverapps.Layout([s,o,a],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin,padding:e.padding});return new cleverapps.Layout([r,c],{direction:cleverapps.UI.VERTICAL,margin:e.margin})},createTimer:function(e){var t=cleverapps.styles.SpeedUpWindow.timer,s=new cc.Scale9Sprite(
bundles.merge.frames.bar_bg_png);s.setAnchorPoint2(),s.setContentSize2(t);var i=new cleverapps.CountDownView(new cleverapps.CountDown(e,{onFinish:this.close.bind(this)}),{font:cleverapps.styles.FONTS.SPEEDUP_WINDOW_TIMER_TEXT});i.setAnchorPoint2(),i.setPositionRound(t.countdown),s.addChild(i);var n=new cc.Sprite(bundles.mergeui.frames.timer_icon_large);return n.setAnchorPoint2(),n.setPositionRound(t.icon),s.addChild(n),s},speedUpForGold:function(){this.close(),cleverapps.metha.distract({focus:"dospeedup",control:this.controls,actions:[function(e){setTimeout(e,300)},function(e){this.worker.speedUp(),e()}.bind(this)]})},speedUpForVideo:function(){if(this.close(),cleverapps.rewardedAdsManager.isAvailable()){if(this.worker.unit){var s=this.worker.bonus.time,i=cc.p(this.worker.unit.x,this.worker.unit.y);cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,function(){var e=Game.currentGame.map.getUnit(i.x,i.y),t=Game.currentGame.workers.findAssigned(e);t&&t.speedUpPartially(
cleverapps.parseInterval(s),!0)})}}else cleverapps.Notification.create("messages:AdsUnavailable")},stopWorker:function(){this.close(),this.worker.completeAssignment()},isStopAvailable:function(){return this.worker.unit&&void 0!==this.worker.unit.findComponent(Buildable)}});SpeedUpWindow.CalcPrice=function(e){return Math.max(Math.ceil(.7*(e/60/1e3-.5)),0)},cleverapps.overrideFonts(cleverapps.styles.FONTS,{SPEEDUP_WINDOW_TEXT:{size:70,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},SPEEDUP_WINDOW_TIMER_TEXT:{size:76,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},SPEEDUP_WINDOW_BUTTON_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SPEEDUP_WINDOW_BUTTON_IMAGE_TEXT:{size:90,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SPEEDUP_WINDOW_HINT_TEXT:{size:50,
color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.SpeedUpWindow={margin:35,padding:{x:120,top:110,bottom:80},timer:{width:470,height:100,countdown:{x:{align:"right",dx:-20},y:{align:"center",dy:0},width:360},icon:{x:{align:"left",dx:-60},y:{align:"center",dy:0}}},buttons:{margin:30,padding:{x:0,top:15,bottom:0},reward:{scale:1.4},button:{width:400,height:136,padding:{left:30,right:30,top:15,bottom:15},margin:8},note:{margin:10}}};var BuyFogWindow=Window.extend({onWindowLoaded:function(e){this.fogBlock=e,this._super({name:"BuyFogWindow",title:"messages:"+this.fogBlock.id+".name",content:this.createContent()}),this.addPerson(),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.BuyFogWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=cleverapps.UI.generateOnlyText("messages:"+this.fogBlock.id+".text",cleverapps.styles.FONTS.WINDOW_TEXT,{tiles:this.fogBlock.tiles.length});s.setHorizontalAlignment(
cc.TEXT_ALIGNMENT_CENTER),s.setDimensions(e.width,0),s.fitToHeight(e.text.height),s.setPositionRound(e.text),t.addChild(s);var i=cleverapps.UI.createScale9Sprite(bundles.buyfogwindow.frames.button_block);i.setContentSize2(e.buttonBlock),i.setPositionRound(e.buttonBlock);var n=new cc.Sprite(bundles.reward_icons.frames.gold_small_png),o=cleverapps.UI.generateImageText(this.fogBlock.getOpenPrice(),cleverapps.styles.FONTS.BUY_FOG_WINDOW_BUTTON_TEXT),r=new cleverapps.UI.Button({content:new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:e.buttonBlock.button.margin}),width:e.buttonBlock.button.width,height:e.buttonBlock.button.height,onClicked:function(){this.fogBlock.buy()&&this.close()}.bind(this)});r.setPositionRound(e.buttonBlock.button),i.addChild(r);var a=cleverapps.UI.generateOnlyText("messages:moneyFog.buyNow",cleverapps.styles.FONTS.BUY_FOG_WINDOW_BUY_NOW_TEXT);a.setPositionRound(e.buttonBlock.buyNowText),a.fitTo(e.buttonBlock.button.width),i.addChild(a)
;var c=new cleverapps.Spine(bundles.buyfogwindow.jsons.island_items_json);return c.setPositionRound(e.buttonBlock.islandItems),c.setAnimation(0,"animation",!0),i.addChild(c),t.addChild(i),t},addPerson:function(){var e=new cleverapps.Spine(bundles.dialogues.jsons.seller_json);e.setAnchorPoint2(),e.setPositionRound(cleverapps.styles.BuyFogWindow.person),e.setAnimation(0,"special_offer",!0),e.setLocalZOrder(1),this.addChild(e),e.y-=e.height,e.runAction(new cc.MoveBy(.4,0,e.height).easing(cc.easeBackOut()))},listBundles:function(){return["buyfogwindow"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BUY_FOG_WINDOW_BUY_NOW_TEXT:{size:55,color:cleverapps.styles.COLORS.YELLOW_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BUY_FOG_WINDOW_BUTTON_TEXT:{name:"default",size:70}}),cleverapps.styles.BuyFogWindow={width:1e3,height:650,text:{height:220,x:{align:"center"},y:{align:"top",dy:-15}},person:{x:{align:"center",
dx:-650},y:{align:"bottom",dy:-70}},buttonBlock:{width:1020,height:450,x:{align:"center"},y:{align:"bottom",dy:-65},buyNowText:{x:{align:"center",dx:270},y:{align:"top",dy:-115}},button:{x:{align:"center",dx:270},y:{align:"bottom",dy:115},margin:10,width:330,height:110},islandItems:{x:{align:"left",dx:55},y:{align:"center",dy:5}}}};var BuyIngredientsWindow=Window.extend({onWindowLoaded:function(e,t){this.ingredients=e,this.price=this.calcPrice(),this._super({title:"messages:BuyIngredientsWindow.title",name:"BuyIngredientsWindow",content:this.createContent(),buttons:this.createButton(),adjustToContent:!0,closeButton:!0,onClose:t}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.BuyIngredientsWindow,t=Object.keys(this.ingredients).map(function(e){return this.createTile({code:e,stage:4,amount:this.ingredients[e]})},this),s=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:e.tiles.margin}),
i=cleverapps.UI.generateOnlyText("messages:BuyIngredientsWindow.text",cleverapps.styles.FONTS.DARK_TEXT);return new cleverapps.Layout([s,i],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},createTile:function(e){var t=cleverapps.styles.BuyIngredientsWindow.tile,s=new cc.Node;s.setContentSize2(t.background);var i=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.bg_png);i.setContentSize2(t.background),i.setPositionRound(t.background),s.addChild(i);var n=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.amount_bg_png);n.setContentSize2(t.amountBackground),n.setPositionRound(t.amountBackground),s.addChild(n);var o=cleverapps.UI.generateImageText("x"+e.amount,cleverapps.styles.FONTS.BUYINGREDIENTSWINDOW_AMOUNT);o.setPositionRound(t.amountText),s.addChild(o);var r=UnitView.getUnitImage(e);r.setAnchorPoint2(),r.setPositionRound(t.icon),r.setScale(t.icon.scale),s.addChild(r);var a=cleverapps.UI.generateOnlyText(Game.currentGame.unitsLibrary.getUnitName(
e),cleverapps.styles.FONTS.DARK_TEXT);return a.setAnchorPoint2(),a.setPositionRound(t.title),a.fitTo(t.title.width),s.addChild(a),s},createButton:function(){var e=cleverapps.styles.BuyIngredientsWindow.button;return new UseGoldButton({button_images:cleverapps.UI.Button.Images.button_green,font:cleverapps.styles.FONTS.BUYINGREDIENTSWINDOW_AMOUNT,price:this.price,onClicked:this.buyIngredients.bind(this),image:bundles.reward_icons.frames.gold_small_png,eventName:"buy_ingredients_ruby"},e)},calcPrice:function(){var e=0;for(var t in this.ingredients)e+=3*this.ingredients[t];return e},buyIngredients:function(){Game.currentGame.harvested.addList(this.ingredients),this.close()},listBundles:function(){return["units_shop"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BUYINGREDIENTSWINDOW_AMOUNT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),
cleverapps.styles.BuyIngredientsWindow={margin:40,scale:1.4,padding:{x:120,top:100,bottom:230},icons:{margin:20},button:{width:300,height:110,padding:{left:20,right:20,top:5,bottom:10},margin:4},tiles:{margin:60},tile:{background:{width:280,height:450,x:{align:"center"},y:{align:"center"}},amountBackground:{width:290,height:115,x:{align:"center"},y:{align:"center",dy:-80}},amountText:{x:{align:"center"},y:{align:"center",dy:-68}},icon:{x:{align:"center"},y:{align:"center",dy:75},scale:1.6},title:{width:260,x:{align:"center"},y:{align:"center",dy:-170}}}};var CenterHint=cc.Node.extend({ctor:function(e){this._super(),(this.game=e).onHintMessage=this.createListener(this.textHint.bind(this)),e.onStartMergeHint=this.createListener(this.startMergeHint.bind(this)),e.onFinishMergeHint=this.createListener(this.finishMergeHint.bind(this))},textHint:function(e,t,s){if(this.stopAllActions(),e=cleverapps.UI.LabelTTF.GetLocalizedText(e,s),this.hint){if(this.hint.message===e
)return void this.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){this.hideHintView(this.hint),delete this.hint}.bind(this))));this.hideHintView(this.hint),delete this.hint}var i=cleverapps.UI.generateOnlyText("",cleverapps.styles.FONTS.CENTER_HINT_TEXT);i.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),40<e.length&&i.setDimensions(.6*this.width,0),i.setString(e);var n=this.createHintView([i]);n.message=e,this.setLocalZOrder(t?50:15),this.runAction(new cc.Sequence(new cc.CallFunc(function(){this.showHintView(n),this.hint=n}.bind(this)),new cc.DelayTime(2.5),new cc.CallFunc(function(){this.hideHintView(this.hint),delete this.hint}.bind(this))))},startMergeHint:function(e,t){this.setLocalZOrder(15);var s=this.game.gameLevel.getLevel(),i=Families[t.code].units.length;if(!(s<=1||t.stage===i-1||"hero"===t.getType()&&t.stage===i-2)){var n=this.game.map.listAvailableUnits(t).length+1,
o=Game.currentGame.mergeBonus(t,e);if(!(n<o.next)){if(this.stopAllActions(),this.hint){if(Unit.Equals(this.hint.unit,t))return;this.hideHintView(this.hint),delete this.hint}if(o.next<=17)var r=Game.currentGame.mergeBonus(t,o.next),a=Messages.get("CenterHint.merge.begins")+" "+o.next,c=Messages.get("CenterHint.merge.ends")+" "+r.bonus;else a=Messages.get("CenterHint.merge.beginsExtra"),c=Messages.get("CenterHint.merge.endsExtra");var l=[cleverapps.UI.generateOnlyText(a,cleverapps.styles.FONTS.CENTER_HINT_TEXT),UnitView.getUnitImage(t),cleverapps.UI.generateOnlyText(c,cleverapps.styles.FONTS.CENTER_HINT_TEXT),UnitView.getUnitImage({code:t.code,stage:t.stage+1})];cleverapps.UI.fitToBox(l[1],{width:l[1].width,height:1.9*l[0].height}),cleverapps.UI.fitToBox(l[3],{width:l[3].width,height:2.1*l[0].height});var p=this.createHintView(l);p.unit=t,this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.showHintView(p),this.hint=p}.bind(this))))}}},
finishMergeHint:function(){this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){this.hint&&(this.hideHintView(this.hint),delete this.hint)}.bind(this))))},createHintView:function(e){var t=cleverapps.styles.CenterHint,s=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:t.padding}),i=new cc.Scale9Sprite(bundles.merge.frames.hint_background_png);i.setContentSize2(s.width,s.height),i.setAnchorPoint2(),i.setCascadeOpacityEnabled(!0),s.setAnchorPoint2(),s.setPositionRound(s.width/2,s.height/2),s.setCascadeOpacityEnabled(!0),i.addChild(s);var n=new cc.Sprite(bundles.centerhint.frames.worker_hint_png);n.setAnchorPoint2();var o=new cleverapps.Layout([n,i],{direction:cleverapps.UI.HORIZONTAL});return o.setAnchorPoint2(),o.setPositionRound(this.width/2,.8*this.height),o.setCascadeOpacityEnabled(!0),cleverapps.UI.fitToBox(o,{width:.8*this.width,height:o.height}),o},showHintView:function(e){this.addChild(e),
e.setOpacity(0),e.stopAllActions(),e.runAction(new cc.FadeIn(.4).easing(cc.easeIn(2)))},hideHintView:function(e){e.stopAllActions(),e.runAction(new cc.Sequence(new cc.FadeOut(.4).easing(cc.easeIn(2)),new cc.RemoveSelf))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{CENTER_HINT_TEXT:{size:45,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.CenterHint={margin:10,padding:{x:40,top:12,bottom:35}};var NewElementsWindow=Window.extend({onWindowLoaded:function(e,t,s){this._super({name:e,content:this.createContent(t,s),noBackground:!0,closeButton:!1}),this.addPerson(t),cleverapps.audio.playSound(bundles.newelements.urls.quest_new_effect)},createOneScroll:function(e,t,s){var i=cleverapps.styles.NewElementsWindow.scroll,n=new cleverapps.Spine(bundles.newelements.jsons.scroll_json);n.setAnchorPoint2(),n.setScale(1.3),t.setAnchorPoint2(),t.setPositionRound(i.icon),n.addChild(t);var o=t.scale;t.setScale(0);for(var r=Math.floor(s.length/2),a=-1,c=0;c<=r&&-1===a;c++
)" "===s.charAt(r-c)?a=r-c:" "===s.charAt(r+c)&&(a=r+c);-1!==a&&(s=s.substr(0,a)+"\n"+s.substr(a+1));var l=cleverapps.UI.generateOnlyText(s,cleverapps.styles.FONTS.NEWELEMENTSWINDOW_TEXT);return l.setAnchorPoint2(),l.setPositionRound(i.text.x,i.text.y),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.fitTo(i.text.width,i.text.height),n.addChild(l),l.setOpacity(0),n.runAction(new cc.Sequence(new cc.DelayTime(.5+e),new cc.CallFunc(function(){n.setAnimationAndIdleAfter("open","idle"),t.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.5,o).easing(cc.easeBackOut(1)))),l.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.FadeIn(1)))}))),n},createContent:function(e,t){var s=cleverapps.styles.NewElementsWindow;(t=cleverapps.UI.generateOnlyText(t,cleverapps.styles.FONTS.NEWELEMENTSWINDOW_TITLE_TEXT)).setAnchorPoint2();for(var i=[],n=0;n<e.length;n++)i.push(this.createOneScroll(n,e[n].icon,e[n].title));i=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,
margin:s.scrolls.margin});var o=new cleverapps.Layout([i,t],{direction:cleverapps.UI.VERTICAL,margin:s.margin,y:s.offsetY});return cleverapps.UI.onClick(o,this.close.bind(this)),t.setScale(.3),t.runAction(new cc.Sequence(new cc.ScaleTo(.26,1.4),new cc.ScaleTo(.37,1))),o},addPerson:function(e){var t=1===e.length?cleverapps.styles.NewElementsWindow.person1:cleverapps.styles.NewElementsWindow.person2,s=Game.currentGame.unitsLibrary.getCurrentHero();bundles.dialogues.jsons[s+"_json"]||(s="dwarf");var i=new cleverapps.Spine(bundles.dialogues.jsons[s+"_json"],t.scale);i.setAnchorPoint2(),i.setPositionRound(t.position),i.setAnimation(0,"idle",!0),i.setLocalZOrder(1),this.addChild(i),i.y-=i.height,i.runAction(new cc.MoveBy(.4,0,i.height).easing(cc.easeBackOut()))},listBundles:function(){return["newelements"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{NEWELEMENTSWINDOW_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,
stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE},NEWELEMENTSWINDOW_TEXT:{size:28,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.NewElementsWindow={width:400,height:600,margin:48,offsetY:300,scrolls:{margin:50},scroll:{icon:{x:{align:"center",dx:0},y:{align:"center",dy:40}},text:{x:{align:"center",dx:0},y:{align:"center",dy:-105},width:300,height:80}},person1:{position:[{x:{align:"center",dx:-440},y:{align:"bottom",dy:-30}},{x:{align:"center",dx:-440},y:{align:"bottom",dy:-30}},{x:{align:"left",dx:150},y:{align:"bottom",dy:-30}}],scale:1.3},person2:{position:[{x:{align:"center",dx:-630},y:{align:"bottom",dy:-75}},{x:{align:"center",dx:-630},y:{align:"bottom",dy:-75}},{x:{align:"left",dx:50},y:{align:"bottom",dy:-75}}],scale:1}};var NewRecipesWindow=NewElementsWindow.extend({onWindowLoaded:function(e){for(var t=[],s=0;s<e.length;s++)t.push({icon:this.createIcon(e[s]),title:Messages.get("Units.dishes."+e[s].title+".name")});this._super("newRecipesWindow",t,
"messages:NewRecipesWindow.recipes.title")},createIcon:function(e){var t=new cc.Sprite(bundles.newelements.frames.elements_icon_bg);t.setAnchorPoint2(),t.setScale(1.2);var s=UnitView.getUnitImage(e);return s.setAnchorPoint2(),s.setPositionRound(t.width/2,t.height/2),cleverapps.UI.fitToBox(s,{width:.7*t.width,height:.7*t.height}),t.addChild(s),t}});NewRecipesWindow.ListNewRecipes=function(){var t=Game.currentGame.gameLevel.getLevel();return Recipes.filter(function(e){return e.level===t}).map(function(e){return{title:e.code,code:"dishes",stage:Recipes.indexOf(e)}})};var Worker=function(e){this.options=e,this.unit=void 0,this.start=void 0,this.duration=void 0,this.bonus=void 0,this.onRemove=function(){},this.onStartBuilding=function(e){},this.onCompleteBuilding=function(e){},this.onStartMining=function(e){},this.onCompleteMining=function(e){},this.onClear=function(){},this.onShowSpeedUp=function(e,t,s){}};Worker.prototype.save=function(){if(this.unit)return{unit:{x:this.unit.x,
y:this.unit.y},start:this.start,duration:this.duration}},Worker.prototype.run=function(){if(this.options){var e=Game.currentGame.map.getUnit(this.options.unit.x,this.options.unit.y);if(e&&this.assign(e,this.options.duration,this.options.start))return;this.clearAssignment()}},Worker.MINING_ANIMATION_TIME=3e3,Worker.prototype.isBusy=function(){return void 0!==this.unit},Worker.prototype.assign=function(e,t,s){this.isBusy()&&this.completeAssignment();var i=e&&e.findComponent(Mineable),n=e&&e.findComponent(Buildable);if(!i&&!n)return!1;if(n&&Game.currentGame.workers.findInstantAssigned(n))return!1;if(Game.currentGame.workers.findAssigned(e))return!1;this.unit=e,this.duration=t,this.start=s||Date.now();var o=this.getTimeLeft();return 0!==t&&0!==o||(o=Worker.MINING_ANIMATION_TIME),this.timeout=new cleverapps.LongTimeout(this.completeAssignment.bind(this),o),Game.currentGame.storeSave(),Game.currentGame.workers.onChangeStatusListener(),Game.currentGame.workers.assignSpeedUpBonus(this),i?(
this.onStartMining(i),Game.currentGame.pushes.updateChopped()):n&&(this.onStartBuilding(n),Game.currentGame.pushes.updateBuilt()),!0},Worker.prototype.clearAssignment=function(){clearTimeout(this.timeout),this.unit=void 0,this.start=void 0,this.duration=void 0,this.bonus&&(clearTimeout(this.bonus.timeout),this.bonus=void 0),Game.currentGame.workers.removeRegularIfNeeded(),Game.currentGame.storeSave(),Game.currentGame.workers.onChangeStatusListener()},Worker.prototype.getTimeSpent=function(){return Date.now()-this.start},Worker.prototype.completeAssignment=function(e){if(this.isBusy()){var t=this.getTimeSpent()+(e||0),s=this.unit;this.clearAssignment();var i=s.findComponent(Mineable);i&&(i.completeMining(),this.onCompleteMining(i));var n=s.findComponent(Buildable);n&&(n.completeBuilding(t),this.onCompleteBuilding(n))}},Worker.prototype.getTimeLeft=function(){var e=this.getTimeSpent();return 0<this.duration-e?this.duration-e:0},Worker.prototype.clear=function(){clearTimeout(this.timeout)
,delete this.timeout,this.bonus&&(clearTimeout(this.bonus.timeout),delete this.bonus),this.onClear()},Worker.prototype.speedUpPartially=function(t,e){if(this.isBusy()){var s=this.unit;this.speedupInProgress=!0;var i=function(){this.completeAssignment(t);var e=s.findComponent(Buildable);e&&!e.isCompleted()&&this.assign(s,e.time),this.speedupInProgress=!1,Game.currentGame.pushes.updateBuilt(),Game.currentGame.pushes.updateChopped()}.bind(this);e?this.onShowSpeedUp(s,Math.min(t,this.getTimeLeft()),i):i()}},Worker.prototype.speedUp=function(){Game.currentGame.gameEvent(Merge.SPEED_UP,{affected:this.unit}),this.speedUpPartially(this.getTimeLeft())},Worker.prototype.setSpeedUpBonus=function(){this.bonus||(this.bonus={time:Workers.SPEEDUP_BONUS_TIME,timeout:new cleverapps.LongTimeout(this.removeSpeedUpBonus.bind(this),cleverapps.parseInterval(Workers.SPEEDUP_BONUS_DURATION))})},Worker.prototype.removeSpeedUpBonus=function(){this.bonus&&(clearTimeout(this.bonus.timeout),this.bonus=void 0)},
Worker.prototype.isSpeedUpBonusAvailable=function(){return cleverapps.rewardedAdsManager.isAvailable()&&this.isBusy()&&this.getTimeLeft()>cleverapps.parseInterval(Workers.SPEEDUP_BONUS_MINIMUM_REQUIRED_TIME)&&this.unit.findComponent(Buildable)},Worker.prototype.isSpeedUpBonusActive=function(){return this.bonus};var WorkerView=cc.Node.extend({ctor:function(e){this._super(),(this.worker=e).onRemove=this.removeFromParent.bind(this),e.onStartBuilding=this.startBuilding.bind(this),e.onCompleteBuilding=this.complete.bind(this),e.onStartMining=this.startMining.bind(this),e.onCompleteMining=this.complete.bind(this),e.onShowSpeedUp=this.showSpeedUp.bind(this)},_startMining:function(e){e.onHideDetails(),this.createMiningAnimation(e),0<cleverapps.parseInterval(e.getTask().time)&&this.showTimer(e)},startMining:function(e){InfoView.CloseInfo(this._startMining.bind(this,e))},createBuildingAnimation:function(e){var t=this.animation=new cleverapps.Spine(bundles.mineable.jsons.mining_start_json),
s=WorkerView.mineEffects[e.unit.code]||WorkerView.mineEffects.default;this.sound=cleverapps.audio.playSound(s.sound),t.setAnimation(0,"building",!0),t.setLocalZOrder(2),e.unit.onGetView().addChild(t),t.setPositionRound(cleverapps.styles.WorkerView.buildingAnimation)},createMiningAnimation:function(e){var t=this.animation=new cleverapps.Spine(bundles.mineable.jsons.mining_start_json),s=WorkerView.mineEffects.default;e.unit.getResource()&&WorkerView.mineEffects[e.unit.getResource()]&&(s=WorkerView.mineEffects[e.unit.getResource()]),this.sound=cleverapps.audio.playSound(s.sound),t.setAnimation(0,s.animation,!0),t.setLocalZOrder(2),e.unit.onGetView().addChild(t);var i=Game.currentGame.map,n=cleverapps.styles.WorkerView.miningAnimation;i.getFog(e.unit.x+Iso.DOWN_RIGHT.x,e.unit.y+Iso.DOWN_RIGHT.y)&&((n=cleverapps.clone(n,!0)).x.dx=n.x.leftDx,t.setScaleX(-1)),t.setPositionRound(n)},removeAnimation:function(){this.animation.removeFromParent(),delete this.animation,cleverapps.audio.stopSound(
this.sound)},complete:function(e){this.hideTimer(e),this.removeAnimation()},startBuilding:function(e){InfoView.CloseInfo(function(){cleverapps.audio.playSound(bundles.buildable.urls.build_start_effect),e.onHideDetails(),this.createBuildingAnimation(e),this.showTimer(e)}.bind(this))},showTimer:function(e){if(this.hideTimer(e),!(this.worker.getTimeLeft()<=0)){var t=e.unit.onGetView(),s=new WorkerComponentTimer(this.worker);s.setPositionRound(cleverapps.styles.WorkerView.timer),t.insertAdditionalView("timer",s,this.worker.speedupInProgress)}},hideTimer:function(e){e.unit.onGetView().removeAdditionalView("timer",function(){},this.worker.speedupInProgress)},showSpeedUp:function(t,s,i){var n=t.onGetView().additionalViews.timer;cleverapps.metha.display({focus:"AdsTimeSpeedUp",actions:[function(e){setTimeout(e,200)},function(e){Game.currentGame.map.onZoomTo({zoom:1.3,direction:MergeScene.ZOOM_DIRECTION_IN,duration:.5}),Game.currentGame.map.onCenterTo(t.x,t.y,{
duration:1.5*MergeScene.SCROLL_TO_DURATION}),setTimeout(e,600)},function(e){n.showBoost({limit:s,duration:Workers.BOOST_ANIMATE_DURATION,callback:function(){e(),i()}})}]})}});WorkerView.mineEffects={default:{animation:"chop",sound:bundles.mineable.urls.mining_start_effect},wood:{animation:"chop",sound:bundles.mineable.urls.mining_wood_start_effect},stone:{animation:"chop2",sound:bundles.mineable.urls.mining_stone_start_effect},wagon:{animation:"chop2",sound:bundles.mineable.urls.mining_wagon_start_effect},bamboo:{animation:"chop",sound:bundles.mineable.urls.mining_wood_start_effect}},cleverapps.styles.WorkerView={timer:{x:{align:"center",dx:0},y:{align:"center",dy:-29}},miningAnimation:{x:{align:"center",dx:90,leftDx:-45},y:{align:"bottom",dy:0}},buildingAnimation:{x:{align:"center",dx:70},y:{align:"bottom",dy:0}}};var Workers=function(){this.regular=[],this.instant=[],this.onAddWorker=function(){},this.onChangeStatusListener=function(){},this.onChangeTotalAmount=function(){},
this.lastSpeedUp=0};Workers.prototype.save=function(){return{regular:this.regular.map(function(e){return e.save()}),bonusWorkerEnd:this.bonusWorkerEnd,lastSpeedUp:this.lastSpeedUp}},Workers.prototype.clear=function(){this.regular.forEach(function(e){e.clear()}),clearTimeout(this.bonusWorkerTimeout),clearTimeout(this.speedUpTimeout)},Workers.prototype.load=function(e){Array.isArray(e)&&(e={regular:e}),e||(e={regular:[void 0,void 0]}),this.regular=e.regular.map(function(e){return new Worker(e)}),e.bonusWorker&&!e.bonusWorkerEnd&&(e.bonusWorkerEnd=e.bonusWorker+cleverapps.parseInterval(Workers.BONUS_WORKER_PERIOD)),this.bonusWorkerEnd=e.bonusWorkerEnd,this.instant=[],this.lastSpeedUp=e.lastSpeedUp||0,this.assignSpeedUpBonus()},Workers.prototype.runSpecialWorkers=function(){this.runBonusWorkerTimeout(),cleverapps.subscription&&cleverapps.subscription.isActive()&&this.addSubscriptionWorker(!0),this.removeRegularIfNeeded()&&Game.currentGame.storeSave()},
Workers.prototype.removeBonusWorker=function(){this.bonusWorkerEnd=void 0,clearTimeout(this.bonusWorkerTimeout),this.bonusWorkerTimeout=void 0,this.removeRegularIfNeeded(),Game.currentGame.storeSave()},Workers.prototype.bonusWorkerLeftTime=function(){return this.bonusWorkerEnd?this.bonusWorkerEnd-Date.now():0},Workers.prototype.runBonusWorkerTimeout=function(){if(this.bonusWorkerEnd){var e=this.bonusWorkerLeftTime();0<e?this.bonusWorkerTimeout=new cleverapps.LongTimeout(this.removeBonusWorker.bind(this),e):this.removeBonusWorker()}},Workers.prototype.isBonusWorkerBuyed=function(){return 0<this.bonusWorkerLeftTime()},Workers.prototype.addBonusWorkerPeriod=function(e,t){this.isBonusWorkerBuyed()?(this.bonusWorkerEnd+=cleverapps.parseInterval(e),clearTimeout(this.bonusWorkerTimeout),t||this.onChangeTotalAmount()):(this.bonusWorkerEnd=Date.now()+cleverapps.parseInterval(e),this.addRegular(t)),this.runBonusWorkerTimeout(),Game.currentGame.storeSave()},
Workers.prototype.buyBonusWorker=function(){return!!levels.user.takeGold(Workers.BONUS_WORKER_PRICE)&&(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.BONUS_WORKER_BOUGHT),this.addBonusWorkerPeriod(Workers.BONUS_WORKER_PERIOD),!0)},Workers.prototype.addSubscriptionWorker=function(e){cleverapps.subscription&&cleverapps.subscription.isActive()&&(this.addRegular(e),Game.currentGame.storeSave())},Workers.prototype.removeSubscriptionWorker=function(){this.removeRegularIfNeeded(),Game.currentGame.storeSave()},Workers.prototype.removeRegularIfNeeded=function(){var e=2;this.isBonusWorkerBuyed()&&(e+=1),cleverapps.subscription&&cleverapps.subscription.isActive()&&(e+=1);for(var t=!1,s=0;s<this.regular.length&&this.regular.length>e;++s){var i=this.regular[s];i.isBusy()||(i.onRemove(),this.regular.splice(s,1),t=!0,--s)}return!!t&&(this.onChangeTotalAmount(),!0)},Workers.prototype.countRegularFree=function(){return this.regular.filter(function(e){return!e.isBusy()}).length},
Workers.prototype.countRegularTotal=function(){return this.regular.length},Workers.prototype.addRegular=function(e){var t=new Worker;this.regular.push(t),this.onAddWorker(t),e||this.onChangeTotalAmount()},Workers.prototype.addInstant=function(e){-1===this.instant.indexOf(e)&&this.instant.push(e)},Workers.prototype.removeInstant=function(e){var t=this.instant.indexOf(e);-1!==t&&this.instant.splice(t,1)},Workers.prototype.hasInstant=function(){return 0<this.listInstantFree().length},Workers.prototype.findAssigned=function(e){if(e)for(var t=0;t<this.regular.length;t++){var s=this.regular[t];if(s.unit===e)return s}},Workers.prototype.findInstantAssigned=function(e){for(var t=0;t<this.instant.length;t++){var s=this.instant[t];if(s.assignment===e)return s}},Workers.prototype.findFree=function(){for(var e=0;e<this.regular.length;++e){var t=this.regular[e];if(!t.isBusy())return t}},Workers.prototype.findLeastBusy=function(t){var s,i=1/0;return this.listBusy().forEach(function(e){
t&&!e.unit.findComponent(t)||i>e.getTimeLeft()&&(i=(s=e).getTimeLeft())}),s},Workers.prototype.listBusy=function(){return this.regular.filter(function(e){return e.isBusy()})},Workers.prototype.listInstantFree=function(){return this.instant.filter(function(e){return!e.isWorking()})},Workers.prototype.assignSpeedUpBonus=function(e){clearTimeout(this.speedUpTimeout),this.speedUpTimeout=new cleverapps.LongTimeout(this.assignSpeedUpBonus.bind(this),cleverapps.parseInterval(Workers.SPEEDUP_BONUS_CHECK_INTERVAL));var t=(this.lastSpeedUp||0)+cleverapps.parseInterval(Workers.SPEEDUP_BONUS_TIMEOUT);if(!(Date.now()<t)){var s=e?[e]:this.regular;(e=cleverapps.Random.choose(s.filter(function(e){return e.isSpeedUpBonusAvailable()&&!e.isSpeedUpBonusActive()})))&&(e.setSpeedUpBonus(),this.lastSpeedUp=Date.now(),Game.currentGame.storeSave())}},Workers.BONUS_WORKER_PERIOD="7 day",Workers.BONUS_WORKER_PRICE=225,Workers.SPEEDUP_BONUS_CHECK_INTERVAL="1 minute",Workers.SPEEDUP_BONUS_TIMEOUT="2 hours",
Workers.SPEEDUP_BONUS_DURATION="15 minutes",Workers.SPEEDUP_BONUS_TIME="15 minutes",Workers.SPEEDUP_BONUS_MINIMUM_REQUIRED_TIME="2 minutes",cleverapps.config.debugMode&&(Workers.SPEEDUP_BONUS_CHECK_INTERVAL="1 seconds",Workers.SPEEDUP_BONUS_TIMEOUT="1 seconds",Workers.SPEEDUP_BONUS_DURATION="30 seconds"),Workers.BOOST_ANIMATE_DURATION=1250;var BonusWorkerWindow=Window.extend({onWindowLoaded:function(){this._super({name:"BonusWorkerWindow",title:"messages:BonusWorkerWindow.title",content:this.createContent()}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createInfoBlock:function(){var e=cleverapps.styles.BonusWorkerWindow.infoBlock,t=cleverapps.UI.createScale9Sprite(bundles.bonusworkerwindow.frames.info_background);t.setContentSize2(e);var s=Game.currentGame.workers.isBonusWorkerBuyed()?"buyed":"buy",i=cleverapps.UI.generateOnlyText("messages:BonusWorkerWindow."+s+".info.title",cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_INFO_TITLE_TEXT);i.fitTo(e.infoTitle.width),
i.setPositionRound(e.infoTitle),t.addChild(i);var n=cleverapps.UI.generateOnlyText("messages:BonusWorkerWindow."+s+".info.text",cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_INFO_TEXT);return n.setPositionRound(e.infoText),n.setDimensions(e.infoText.width,0),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(n),t},createContent:function(){var e=cleverapps.styles.BonusWorkerWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=this.createInfoBlock();s.setPositionRound(e.infoBlock.position),t.addChild(s);var i=new cleverapps.Spine(bundles.dialogues.jsons.worker_json,e.person.scale);if(i.setAnchorPoint2(),i.setPositionRound(e.person),i.setAnimation(0,"idle",!0),t.addChild(i),Game.currentGame.workers.isBonusWorkerBuyed()){var n=cleverapps.UI.generateOnlyText("messages:BonusWorkerWindow.buy.lefttime.text",cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_BUY_NOW_TEXT);n.fitTo(e.leftTimeText.width),n.setPositionRound(e.leftTimeText),t.addChild(n)
;var o=new cleverapps.CountDown(Game.currentGame.workers.bonusWorkerLeftTime()),r=new cleverapps.CountDownView(o,{font:cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_TIMER_TEXT}),a=new cc.Scale9Sprite(bundles.bonusworkerwindow.frames.timer_substrate);a.setAnchorPoint2(),a.setContentSize2(e.timer.width,e.timer.height),r.setAnchorPoint2(),r.setPositionRound(a.width/2+e.timer.text.x,a.height/2+e.timer.text.y),a.addChild(r);var c=new cc.Sprite(bundles.bonusworkerwindow.frames.sanglass_timer_icon);c.setAnchorPoint2(),c.setPositionRound(e.timer.iconOffsetX,a.height/2),a.addChild(c),a.setPositionRound(e.timer),t.addChild(a)}else{var l=cleverapps.UI.generateOnlyText("messages:BonusWorkerWindow.buy.buynow.text",cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_BUY_NOW_TEXT);l.fitTo(e.buyNowText.width),l.setPositionRound(e.buyNowText),t.addChild(l);var p=new cc.Sprite(bundles.reward_icons.frames.gold_small_png),d=cleverapps.UI.generateImageText(Workers.BONUS_WORKER_PRICE,
cleverapps.styles.FONTS.BONUS_WORKER_WINDOW_BUTTON_TEXT),h=new cleverapps.UI.Button({content:new cleverapps.Layout([p,d],{direction:cleverapps.UI.HORIZONTAL,margin:e.button.margin}),width:e.button.width,height:e.button.height,onClicked:function(){Game.currentGame.workers.buyBonusWorker()&&this.close()}.bind(this)});h.setPositionRound(e.button),t.addChild(h)}return t}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BONUS_WORKER_WINDOW_BUTTON_TEXT:{name:"default",size:70},BONUS_WORKER_WINDOW_TIMER_TEXT:{size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},BONUS_WORKER_WINDOW_INFO_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.YELLOW_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BONUS_WORKER_WINDOW_BUY_NOW_TEXT:{size:45,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},BONUS_WORKER_WINDOW_INFO_TEXT:{size:45,color:cleverapps.styles.COLORS.WHITE,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,
shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.BonusWorkerWindow={width:1470,height:550,infoBlock:{width:1500,height:450,position:{x:{align:"center"},y:{align:"top",dy:15}},infoTitle:{x:{align:"center",dx:380},y:{align:"top",dy:-60},width:650},infoText:{x:{align:"center",dx:380},y:{align:"center",dy:-30},width:680}},timer:{iconOffsetX:30,width:360,height:85,text:{x:15,y:2},x:{align:"right",dx:-20},y:{align:"bottom",dy:-25}},buyNowText:{width:380,x:{align:"right",dx:-450},y:{align:"bottom",dy:-10}},leftTimeText:{width:380,x:{align:"right",dx:-420},y:{align:"bottom",dy:-10}},button:{margin:10,width:380,height:130,x:{align:"right",dx:-20},y:{align:"bottom",dy:-50}},person:{scale:1.5,x:{align:"left",dx:50},y:{align:"bottom",dy:-10}}};var Recipes=[{code:"icecream",level:1,time:"10 seconds",ingredients:{wheat:2},prize:[{code:"wands",stage:0},{code:"coins",stage:1}]},{code:"cookies",level:4,time:"45 seconds",ingredients:{candies:2},prize:[{code:"wands",stage:0},{
code:"coins",stage:0},{code:"coins",stage:0}]},{code:"gingerbread",level:4,time:"90 seconds",ingredients:{candies:2,wheat:3},prize:[{code:"wands",stage:0},{code:"coins",stage:0},{code:"coins",stage:0}]},{code:"croissant",level:5,time:"15 minutes",ingredients:{candies:3,wheat:4},prize:[{code:"wands",stage:0},{code:"wands",stage:0},{code:"coins",stage:0}]},{code:"caramelpie",level:6,time:"5 minutes",ingredients:{candies:2,wheat:2},prize:[{code:"wands",stage:0},{code:"coins",stage:0}]},{code:"bakedapple",level:7,time:"5 minutes",ingredients:{apple:4},prize:[{code:"wands",stage:0},{code:"coins",stage:0}]},{code:"applejam",level:7,time:"15 minutes",ingredients:{apple:5,wheat:2},prize:[{code:"wands",stage:1},{code:"coins",stage:0}]},{code:"caramelapple",level:8,time:"10 minutes",ingredients:{apple:4,wheat:2},prize:[{code:"wands",stage:0},{code:"wands",stage:0},{code:"coins",stage:0},{code:"coins",stage:0}]},{code:"applepie",level:8,time:"25 minutes",ingredients:{candies:6,apple:2,wheat:2},
prize:[{code:"wands",stage:0},{code:"wands",stage:1},{code:"coins",stage:1}]},{code:"strawberryjuice",level:9,time:"5 minutes",ingredients:{strawberry:4},prize:[{code:"wands",stage:0},{code:"coins",stage:0}]},{code:"strawberrycake",level:9,time:"30 minutes",ingredients:{candies:4,wheat:3,strawberry:5},prize:[{code:"wands",stage:1},{code:"wands",stage:1},{code:"coins",stage:0},{code:"coins",stage:1}]},{code:"salad",level:10,time:"18 minutes",ingredients:{candies:2,strawberry:6},prize:[{code:"wands",stage:1},{code:"coins",stage:0},{code:"coins",stage:0}]},{code:"bubblegum",level:11,time:"20 minutes",ingredients:{wheat:6,apple:3},prize:[{code:"wands",stage:1},{code:"coins",stage:1}]},{code:"granola",level:12,time:"20 minutes",ingredients:{candies:4,apple:5},prize:[{code:"wands",stage:1},{code:"coins",stage:1}]},{code:"strawberrypie",level:12,time:"15 minutes",ingredients:{strawberry:4,candies:3},prize:[{code:"wands",stage:1},{code:"coins",stage:0}]},{code:"mushroomcnacks",level:13,
time:"5 minutes",ingredients:{mushrooms:2,wheat:3},prize:[{code:"wands",stage:0},{code:"coins",stage:0}]},{code:"mintcookies",level:13,time:"18 minutes",ingredients:{mushrooms:2,candies:2,apple:3},prize:[{code:"wands",stage:1},{code:"coins",stage:0},{code:"coins",stage:0}]},{code:"stage18",level:14,time:"30 minutes",ingredients:{wheat:4,apple:3,strawberry:2},prize:[{code:"wands",stage:0},{code:"wands",stage:1},{code:"coins",stage:1},{code:"coins",stage:0}]},{code:"stage19",level:15,time:"15 minutes",ingredients:{mushrooms:2,strawberry:2,apple:2},prize:[{code:"wands",stage:1},{code:"coins",stage:0}]},{code:"stage20",level:16,time:"20 minutes",ingredients:{mushrooms:2,candies:3,corn:4},prize:[{code:"wands",stage:0},{code:"wands",stage:0},{code:"coins",stage:0},{code:"coins",stage:0}]}],Orders=function(){cleverapps.EventEmitter.call(this),this.makers=[]};Orders.prototype=Object.create(cleverapps.EventEmitter.prototype),(Orders.prototype.constructor=Orders).prototype.getMaker=function(t){
return this.makers.filter(function(e){return e.unit.code===t})[0]},Orders.prototype.listOrders=function(){return this.makers.filter(function(e){return e.state!==MakesOrder.STATE_EMPTY}).map(function(e){return{code:"dishes",stage:Recipes.indexOf(e.recipe),recipe:e.recipe,maker:e,type:"order"}})},Orders.prototype.findMaker=function(t){return this.makers.filter(function(e){return e.recipe===t})[0]},Orders.prototype.addOrder=function(e){-1===this.makers.indexOf(e)&&this.makers.push(e)},Orders.prototype.updateOrder=function(e){this.trigger("updateOrder",e),this.updateIngredients()},Orders.prototype.findCanCook=function(){for(var e=0;e<this.makers.length;e++)if(this.makers[e].canCook())return this.makers[e]},Orders.prototype.findReady=function(){for(var e=0;e<this.makers.length;e++)if(this.makers[e].isReady())return this.makers[e]},Orders.prototype.updateIngredients=function(){this.makers.forEach(function(e){e.onUpdateIngredients()}),this.trigger("canCook"),
cleverapps.sideBar.resetByClassName(OrdersIcon)},Orders.prototype.chooseFreeRecipe=function(){var e=Recipes.filter(function(t,e){return 0<e&&Game.currentGame.harvested.isAvailableList(t.ingredients)&&t.level<=Game.currentGame.gameLevel.getLevel()&&this.makers.every(function(e){return e.recipe!==t})},this);if(0===e.length&&1<Game.currentGame.gameLevel.getLevel())return Recipes[0];if(e.length<=3)return cleverapps.Random.choose(e);for(var t=e.length-1;0<t&&cleverapps.Random.nextDouble()<.6;)t--;return e[t]};var Quest=function(e){cleverapps.EventEmitter.call(this),this.config=QuestsConfig[e.id].quest,this.dynamic=QuestsConfig[e.id].dynamic||{},this.id=e.id,this.type=this.config.type,this.progress=e.progress||0,this.fresh=e.fresh,this.unit=e.unit||this.config.unit,this.goal=e.goal||e.amount||1};Quest.prototype=Object.create(cleverapps.EventEmitter.prototype),(Quest.prototype.constructor=Quest).prototype.addProgress=function(e){this.progress+=e||1,this.progress>this.goal&&(
this.progress=this.goal),this.isFinished()&&Game.currentGame.counter.setTimeout(function(){},0),this.trigger("updateProgress",this),Game.currentGame.storeSave(),cleverapps.sideBar.resetByClassName(QuestsSideBarIcon)},Quest.prototype.onClick=function(){Game.currentGame.quests.select(this)},Quest.prototype.setFresh=function(e){this.fresh=e},Quest.prototype.isFresh=function(){return this.fresh},Quest.prototype.select=function(){this.selected||(this.selected=!0,this.trigger("select",this))},Quest.prototype.unselect=function(){this.selected&&(this.selected=!1,this.trigger("unselect",this))},Quest.prototype.getSpawnTargets=function(e){e=e||0;var t=[],s=Game.currentGame,i=this.unit.code,n=this.unit.stage;if("dishes"===i){var o=Recipes[n],r=s.orders.findMaker(o)||s.orders.makers[0];return r?[r]:[]}return t=void 0!==n?Unit.getPreviousStagesTargets(i,n+e):Unit.getAllStagesTargets(i),s.unitsLibrary.listCodesByType(["chest","source","generator"]).forEach(function(e){t=t.concat(
Unit.getAllStagesTargets(e))}),t},Quest.prototype.getBuildUnits=function(){var e=this.unit&&this.unit.code?this.getSpawnTargets(1):{};return Game.currentGame.map.listAvailableUnits(e).filter(function(e){var t=e.findComponent(Buildable);return!t||!t.isCompleted()},this)},Quest.prototype.getTargetUnits=function(){var e=Game.currentGame;switch(this.type){case Merge.SPAWN:return e.map.listAvailableUnits(this.getSpawnTargets());case Merge.HARVEST:case Merge.PRIZE_HARVESTED:return e.map.listAvailableUnits(this.getSpawnTargets(1));case Merge.MINE:case Merge.COMPLETE_MINING:return e.map.listAvailableUnits(this.unit);case Merge.BUILD:return this.getBuildUnits();case Merge.OPENFOG:return e.fogs.findAvailableFogBlock().head;case Merge.OPENDRAGON:return e.fogs.blocks.dragonIsland.head;case Merge.MERGE:return e.map.listAvailableUnits()}return[]},Quest.prototype.find=function(){var e=Game.currentGame.map,n=e.getScreenCenterCell(),t=cleverapps.toArray(this.getTargetUnits()),s={};t.forEach(function(e
){if(e instanceof Unit&&e.isMergeable(e)){var t=Unit.GetKey(e);s[t]=(s[t]||0)+1}}),t=t.filter(function(e){return this.type===Merge.MERGE?s[Unit.GetKey(e)]>=this.config.minUnits&&e.isMergeable(e):!s[Unit.GetKey(e)]||e.getData().chest||3<=s[Unit.GetKey(e)]},this);var o=this.unit&&this.unit.code,r=this.unit&&this.unit.stage,a=this.unit&&this.unit.type,c=["chest","source","generator"],l=function(e){var t=0,s=-1;if(this.type===Merge.BUILD&&void 0===r&&Unit.IsApplicable(this.unit,e)){var i=e.findComponent&&e.findComponent(Buildable);i&&!i.isCompleted()&&(s=1,t-=20)}return t+=s*e.stage,o&&o===e.code&&(t-=2e3),a&&e.getType&&a===e.getType()&&(t-=1e3),t+=100*(c.indexOf(e.getType())+1)}.bind(this);t.sort(function(e,t){var s=l(e),i=l(t);return s!==i?s-i:cc.getDistanceChebyshev(e,n)-cc.getDistanceChebyshev(t,n)}),0!==t.length?this.type===Merge.MERGE?(Game.currentGame.advice.setLogic(Merge.MERGE,{targets:t,minUnits:this.config.minUnits,highlight:!0}),Game.currentGame.advice.startHintOnce()):(
e.onCenterTo(t[0].x,t[0].y),e.onAddTarget(t[0].x,t[0].y)):cleverapps.Notification.create("messages:Quest.find.empty")},Quest.prototype.isFinished=function(){return this.progress>=this.goal},Quest.prototype.getTitle=function(){if(this.dynamic.getTitle)return this.dynamic.getTitle(this.unit);if(this.unit){var e=Families[this.unit.code];if("hero"===e.type&&this.unit.stage===e.units.length-1)return Messages.get("Quest.hero.title")}return Messages.get("Quest."+this.type+".title")},Quest.prototype.save=function(){var e={id:this.id,goal:this.goal,progress:this.progress};return this.fresh&&(e.fresh=1),this.unit&&this.unit!==this.config.unit&&(e.unit=this.unit),e},Quest.prototype.getDialogue=function(){return QuestsConfig[this.id].dialogue},Quest.prototype.getTutorial=function(){return QuestsConfig[this.id].tutorial&&MergeTutorials[QuestsConfig[this.id].tutorial]},Quest.prototype.showDialogue=function(e){var t=this.getDialogue();if(t){var s=cleverapps.clone(t,!0);s.forEach(function(e){if(
e.person){var t=cleverapps.styles.DialogueView.persons[e.person];t?e.person=t:delete e.person}if(e.person2){var s=cleverapps.styles.DialogueView.persons[e.person2];s?e.person2=s:delete e.person2}},this);var i=new Dialogue(s,{showUp:!0,autoClose:!1,autoScroll:!1}),n=function(){!i.typing&&i.stage>=i.data.length-1&&i.close()};i.on("buttonClicked",n),i.on("screenClicked",n),i.on("afterClose",e),new DialogueView(i,{screenClicked:!0,overlay:!0,button:{noButton:!0},delay:0}),i.run()}else e()},Quest.prototype.showTutorial=function(e){var t=this.getTutorial();t?Game.currentGame.tutorial.showTutorial(t,e):e()},Quest.prototype.replayTutorial=function(){if(!this.isFinished()){var e=this.getTutorial();e&&e.replayOnReload&&Game.currentGame.tutorial.triggerTutorial(e)}},Quest.prototype.isApplicable=function(e,t){if(this.config.type!==e)return!1;var s=t&&(t.unit||t.affected);switch(Array.isArray(s)&&(s=s[0]),e){case Merge.MERGE:var i=this.config.minUnits||0;return t.affected.length>=i
;case Merge.SPAWN:case Merge.MINE:case Merge.COMPLETE_MINING:case Merge.BUILD:case Merge.HARVEST:case Merge.PRIZE_HARVESTED:return Unit.IsApplicable(this.unit,s)}return!0},Quest.prototype.getIcon=function(){if(this.dynamic.getIcon)return this.dynamic.getIcon(this.unit);switch(this.type){case Merge.SPAWN:case Merge.BUILD:case Merge.MINE:case Merge.HARVEST:case Merge.PRIZE_HARVESTED:case Merge.COMPLETE_MINING:return UnitView.getUnitImage(this.unit);case Merge.OPENFOG:return new cc.Sprite(bundles.unit_icons.frames.fog_icon_png)}},Quest.GetId=function(e){return e.id};var Quests=function(e){cleverapps.EventEmitter.call(this);var t=Game.currentGame;this.quests=[],this.seed=0,t.unitsLibrary.on("unitAvailable",this.unitAvailable.bind(this)),e&&this.load(e),t.on("gameEvent",this.onGameEvent.bind(this))};Quests.prototype=Object.create(cleverapps.EventEmitter.prototype),(Quests.prototype.constructor=Quests).prototype.migrateLinear=function(e){var t=e&&e.quests||[];t.forEach(function(e){
"woodsource_1"===e.id?e.id=1===e.configIndex?"woodsource_1_1":"woodsource_1_0":"wood_9"===e.id&&1===e.configIndex&&(e.id="wheat_4")});var s={};e.quests=t.filter(function(e){if(!s[e.id]){var t=QuestsConfig[e.id];if(t){if(t.dynamic.filter&&!t.dynamic.filter())return!1;if(t.dynamic.getUnit&&void 0===e.unit)return!1}return s[e.id]=!0}})},Quests.prototype.load=function(e){if(!cleverapps.config.wysiwygMode||!cleverapps.flags.wysiwyg.skipQuests){this.migrateLinear(e),this.quests=(e&&e.quests||[]).filter(function(e){return QuestsConfig[e.id]}).map(function(e){var t=new Quest(e);return t.replayTutorial(),t});var t=e.selected;(void 0===t||t<0||t>=this.quests.length)&&(t=this.quests.length-1),this.quests[t]&&this.select(this.quests[t],t===e.selected),this.seed=e.seed||0}},Quests.prototype.deleteHeroItemsQuests=function(t){if(!this.isEmpty()){var e=this.getSelectedQuest();this.quests=this.quests.filter(function(e){return!(e.unit&&e.unit.code===t&&e.unit.stage<Families[e.unit.code].units.length-1)}
),this.chooseSelected(e)}},Quests.prototype.chooseSelected=function(e){if(this.selected=-1,0<this.quests.length)if(-1!==this.quests.indexOf(e))this.select(e);else for(var t=this.quests.length-1;0<=t;t--)if(!this.quests[t].isFresh()){this.select(this.quests[t]);break}cleverapps.sideBar.resetByClassName(QuestsSideBarIcon),Game.currentGame.storeSave()},Quests.prototype.save=function(){return{quests:this.quests.map(function(e){return e.save()}),selected:this.selected,seed:this.seed}},Quests.prototype.getSelectedQuest=function(){return this.quests[this.selected]},Quests.prototype.select=function(e,t){var s=this.quests.indexOf(e);if(-1!==s&&s!==this.selected){var i=void 0!==this.selected&&this.quests[this.selected];i&&i.unselect(),this.selected=s,e.select(),this.trigger("select",this.selected),cleverapps.sideBar.resetByClassName(QuestsSideBarIcon),t||Game.currentGame.storeSave()}},Quests.prototype.isRunning=function(t){return this.quests.some(function(e){return t===e.id})},
Quests.prototype.isEmpty=function(){return 0===this.quests.length},Quests.prototype.create=function(t){if(!cleverapps.config.wysiwygMode||!cleverapps.flags.wysiwyg.skipQuests){var e=cleverapps.values(QuestsConfig).filter(function(e){return!(!e.trigger||this.isRunning(e.id))&&(!(e.dynamic.filter&&!e.dynamic.filter())&&(!!e.trigger.unit&&Unit.Equals(t.unit,e.trigger.unit)))}.bind(this));this.startQuests(e)}},Quests.prototype.startQuests=function(e){0<e.length&&(e.forEach(function(e){var t=new Quest(e.quest);t.setFresh(!0),this.quests.push(t)}.bind(this)),Game.currentGame.storeSave(),Game.currentGame.counter.setTimeout(function(){},0))},Quests.prototype.unitAvailable=function(e){this.create({unit:e})},Quests.prototype.findFinishedIndex=function(){for(var e=0;e<this.quests.length;e++)if(this.quests[e].isFinished())return e;return-1},Quests.prototype.finish=function(){if(!cleverapps.metha.isFocused()){var e=this.findFinishedIndex();if(-1!==e){var t=this.quests[e],s=this.getSelectedQuest(),
i=function(){this.quests.splice(e,1),this.chooseSelected(s)}.bind(this);cleverapps.metha.display({focus:"FinishQuest",control:["MenuBarGoldItem","MenuBarGameLevelItem","MenuBarLivesItem","MenuBarCoinsItem"],actions:[function(e){new FinishQuestWindow(t,i),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){Game.currentGame.counter.setTimeout(e,300)}]})}}},Quests.prototype.getFreshQuestsBatch=function(){var e=this.quests.filter(function(e){return e.isFresh()}),t=e.filter(function(e){return e.getTutorial()||e.getDialogue()});return e=cleverapps.substract(e,t,Quest.GetId),(e=t.slice(0,1).concat(e)).slice(0,2)},Quests.prototype.processFresh=function(){if(!cleverapps.metha.isFocused()){var t=this.getFreshQuestsBatch(),i=t[0];0!==t.length&&cleverapps.metha.display({focus:"StartQuest",control:["MenuBarGameLevelItem","MenuBarCoinsItem"],actions:[function(e){var t=i.dynamic&&i.dynamic.attentionTo;if(t){var s=t();s&&Game.currentGame.map.onCenterTo(s.x,s.y,{
duration:MergeScene.SCROLL_TO_DURATION}),e()}else e()},function(e){i.config.silent?e():Game.currentGame.counter.setTimeout(function(){i.showDialogue(e)},300)},function(e){cleverapps.metha.hideControlsWhileFocused(["MenuBarGameLevelItem","MenuBarCoinsItem"]),t.forEach(function(e){e.setFresh(!1)}),this.select(t[t.length-1]),Game.currentGame.storeSave(),cleverapps.sideBar.resetByClassName(QuestsSideBarIcon),i.config.silent?e():(new StartQuestWindow(t),cleverapps.metha.onceNoWindowsListener=e)}.bind(this),function(e){Game.currentGame.counter.setTimeout(e,300)},function(e){i.showTutorial(e)}]})}},Quests.prototype.onGameEvent=function(t,s){this.quests.forEach(function(e){e.isApplicable(t,s)&&e.addProgress(s&&s.amount||1)},this),t===Merge.OPENFOG&&this.create(s)},Quests.prototype.isRepeatedQuestsAvailable=function(){return Game.currentGame.gameLevel.getLevel()>=Quests.REPEATED_AVAILABLE.level},Quests.prototype.runRepeatedQuests=function(){if(this.isRepeatedQuestsAvailable()&&!(
5<=this.quests.length)){var e=this.quests.map(Quest.GetId),t=cleverapps.intersect(Object.keys(RepeatedQuests),e),s=Quests.CONCURRENT_REPEATED_QUESTS-t.length;if(!(s<=0)){cleverapps.Random.seed(this.seed);var i=Object.keys(RepeatedQuests);i=cleverapps.Random.shuffle(i),i=cleverapps.substract(i,t);for(var n=[],o=0;o<i.length&&n.length<s;o++){var r=RepeatedQuests[i[o]],a=this.generateConfig(r);a&&n.push(a)}0<n.length&&(this.seed+=n.length,this.startQuests(n))}}},Quests.prototype.generateConfig=function(e){var t=cleverapps.extend({},e);if(t.quest=cleverapps.clone(t.quest,!0),Array.isArray(t.quest.goal)&&(t.quest.goal=cleverapps.Random.random(t.quest.goal[0],t.quest.goal[1])),!t.dynamic.getUnit||(t.quest.unit=t.dynamic.getUnit(),t.quest.unit))return t},Quests.CONCURRENT_REPEATED_QUESTS=2,Quests.REPEATED_AVAILABLE={episode:0,level:5};var QuestIcon=cc.Node.extend({ctor:function(e,t){this._super(),this.quest=e,this.options=t=t||{};var s,i=cleverapps.styles.QuestIcon;t.round?(
s=this.background=new cc.Sprite(bundles.sidebar.frames.icon_bg)).setScale(i.roundBackground.scale):(s=this.background=new cc.Scale9Sprite(bundles.mergeui.frames.icon_background)).setContentSize2(i.background),s.setPositionRound({align:"center"},{align:"center"}),this.setContentSize2(s.width*s.scale,s.height*s.scale),this.setAnchorPoint2(),this.addChild(s);var n=QuestIcon.getIconImage(e);if(cleverapps.UI.fitToBox(n,{width:.7*this.width,height:.7*this.height,maxScale:i.icon.maxScale}),n.setPositionRound(i.icon),this.addChild(n),!1!==t.progress){var o=this.progress=new QuestProgressView(e);o.setPositionRound(i.progress),this.addChild(o)}e.on("select",this.update.bind(this),this),e.on("unselect",this.update.bind(this),this),this.update(),!1!==t.clickable&&cleverapps.UI.onClick(this,function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),e.onClick()}.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0})},update:function(){if(!this.options.round){
var e=bundles.mergeui.frames.icon_background;this.quest.selected&&(e=bundles.mergeui.frames.icon_background_light),this.background.setSpriteFrame(new cc.Sprite(e).getSpriteFrame())}}});QuestIcon.getIconImage=function(e){return e.getIcon()},cleverapps.styles.QuestIcon={background:{width:300,height:300},roundBackground:{scale:1.3},icon:{x:{align:"center"},y:{align:"center",dy:10},maxScale:1.6},progress:{x:{align:"center"},y:{align:"bottom",dy:-10}}};var QuestProgressView=cc.Node.extend({ctor:function(e){this._super();var t=this.styles=cleverapps.styles.QuestProgressView;this.quest=e;var s=this.background=cleverapps.UI.createSprite(t.background);this.setContentSize2(s.getContentSize()),this.setAnchorPoint2(),s.setPositionRound(this.width/2,this.height/2),this.addChild(s);var i=this.progressText=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.QUEST_PROGRESS_TEXT);i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setPositionRound(t.text),this.addChild(i),e.on("updateProgress",
this.update.bind(this),this),this.update()},update:function(){this.progressText.setString(this.quest.progress+"/"+this.quest.goal),this.progressText.fitTo({width:.9*this.background.width,height:0})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{QUEST_PROGRESS_TEXT:{name:"default",size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR}}),cleverapps.styles.QuestProgressView={text:{x:{align:"center"},y:{align:"center",dy:3}},background:{image:bundles.sidebar.frames.caption_bg,width:240,height:90,scale9:!0}};var QuestsWindow=Window.extend({onWindowLoaded:function(){this._super({name:"QuestsWindow",title:"messages:QuestsWindow.title",content:this.createContent(),adjustToContent:!0,closeButton:!0,foreground:bundles.windows.frames.window_foreground_png}),Game.currentGame.quests.on("select",this.createDetails.bind(this),this),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.QuestsWindow,t=new cc.Node;t.setAnchorPoint2(),
t.setContentSize2(e);var s=this.createDetails();s.setAnchorPoint2(),s.setPositionRound(e.details),t.addChild(s);var i=this.createSelect();return i.setAnchorPoint2(),i.setPositionRound(e.select),t.addChild(i),t},createDetails:function(){var e=cleverapps.styles.QuestsWindow.details,t=this.details;t?t.removeAllChildren():((t=this.details=cleverapps.UI.createScale9Sprite(bundles.mergeui.frames.details_background,cleverapps.UI.Scale9Rect.TwoPixelXY)).setContentSize2(e),t.setAnchorPoint2());var s=Game.currentGame.quests.getSelectedQuest();if(!s)return t;var i=new QuestIcon(s,{round:!0,clickable:!1});i.setPositionRound(e.icon),i.setScale(e.icon.scale),t.addChild(i);var n=cleverapps.UI.generateOnlyText(s.getTitle(),cleverapps.styles.FONTS.QUEST_DETAILS_TITLE_TEXT);n.setDimensions(e.title.fitTo.width,0),n.fitToHeight(e.title.fitTo.height),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),n.setPositionRound(e.title),t.addChild(n);var o=this.button=new cleverapps.UI.Button({width:e.button.width,
height:e.button.height,maxWidth:e.button.maxWidth,text:"messages:QuestsWindow.find",font:cleverapps.styles.FONTS.QUEST_DETAILS_BUTTON_TEXT,onClicked:function(){s.find(),this.close()}.bind(this)});o.setPositionRound(e.button),t.addChild(o);var r=new RewardsListComponent(s.config.prize,{font:cleverapps.styles.FONTS.QUEST_REWARDS_TEXT,iconScale:e.rewards.scale,title:{text:"messages:RewardsListComponent.rewardTitle",direction:cleverapps.UI.HORIZONTAL},amountInRow:6,reward:{direction:cleverapps.UI.HORIZONTAL,amountPrefix:""}});return r.setPositionRound(e.rewards),t.addChild(r),t},createSelect:function(){var e=cleverapps.styles.QuestsWindow.select,t=this.icons=Game.currentGame.quests.quests.map(function(e){return new QuestIcon(e)},this),s=this.select=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,padding:e.padding,margin:e.margin});return s.width>e.width&&(this.select=new cleverapps.UI.ScrollView(s,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,
direction:cleverapps.UI.ScrollView.DIR_HORIZONTAL,scrollBarEnabled:!1}),this.select.setContentSize(e.width,s.height),this.select.scrollToDefault()),this.select.setAnchorPoint2(),this.select}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{QUEST_DETAILS_TITLE_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},QUEST_REWARDS_TEXT:{name:"default",size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},QUEST_DETAILS_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.QuestsWindow={width:2e3,height:1050,details:{width:1850,height:500,x:{align:"center",dx:0},y:{align:"top",dy:-80},icon:{x:{align:"left",dx:100},y:{
align:"center",dy:-5},scale:1.2},title:{x:{align:"center",dx:0},y:{align:"center",dy:50},fitTo:{width:840,height:110}},button:{x:{align:"right",dx:-80},y:{align:"center",dy:40},maxWidth:380,width:300,height:110},rewards:{x:{align:"center",dx:0},y:{align:"center",dy:-80},titleMargin:20,scale:.5}},select:{width:1950,margin:60,x:{align:"left",dx:25},y:{align:"top",dy:-580},icon:{scale:1.4},padding:{x:60,y:70}}};var StartQuestWindow=NewElementsWindow.extend({onWindowLoaded:function(e){var t=cleverapps.toArray(e).map(function(e){return{icon:this.createIcon(e),title:e.getTitle()}},this);this._super("StartQuestWindow",t,Messages.get("StartQuestWindow.title"))},createIcon:function(e){var t=new QuestIcon(e,{round:!0,clickable:!1});return t.setScale(.7),t}}),FinishQuestWindow=Window.extend({onWindowLoaded:function(e,t){this.quest=e,this.callback=t||function(){},this._super({name:"FinishQuestWindow",content:this.createContent(),noBackground:!0,closeButton:!1}),this.addPerson(),
cleverapps.audio.playSound(bundles.newelements.urls.quest_completed_effect)},createContent:function(){var e=cleverapps.styles.FinishQuestWindow,t=cleverapps.UI.generateOnlyText(Messages.get("FinishQuestWindow.title").replace(/\s+/g,"\n"),cleverapps.styles.FONTS.FINISHQUESTWINDOW_TITLE_TEXT);t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setAnchorPoint2();var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.middle.width,e.middle.height);var i=new QuestIcon(this.quest,{round:!0,clickable:!1,progress:!1});i.setAnchorPoint2(),i.setPositionRound(e.middle.icon.x,e.middle.icon.y),i.setScale(e.middle.icon.scale),s.addChild(i);var n=new cleverapps.Spine(bundles.newelements.jsons.shining_json,e.middle.shining.scale);n.setAnchorPoint2(),n.setLocalZOrder(-1),n.setPositionRound(e.middle.shining.x,e.middle.shining.y),n.setAnimation(0,"animation",!0),s.addChild(n);var o=this.rewards=new RewardsListComponent(this.quest.config.prize,{
font:cleverapps.styles.FONTS.FINISHQUESTWINDOW_REWARD_TEXT,iconScale:e.rewards.scale,title:"messages:RewardsListComponent.rewardTitle",amountInRow:6,reward:{direction:cleverapps.UI.HORIZONTAL,amountPrefix:""}});o.setLocalZOrder(1);var r=new cleverapps.Layout([o,s,t],{direction:cleverapps.UI.VERTICAL,y:e.offsetY});return cleverapps.UI.onClick(r,this.close.bind(this)),t.runAction(new cc.Sequence(new cc.ScaleTo(.26,1.4),new cc.ScaleTo(.37,1))),o.setVisible(!1),o.runAction(new cc.Sequence(new cc.DelayTime(.36),new cc.Show,new cc.ScaleTo(.2,1.14),new cc.ScaleTo(.2,1))),r},close:function(){if(!this.closing){this.closing=!0;var e=300;e=this.rewards.gameReceiveRewards(e),e+=1e3,Game.currentGame.counter.setTimeout(Window.prototype.close.bind(this),e),this.callback()}},addPerson:function(){var e=cleverapps.styles.FinishQuestWindow.person,t=Game.currentGame.unitsLibrary.getCurrentHero()||"dwarf",s=new cleverapps.Spine(bundles.dialogues.jsons[t+"_json"],e.scale);s.setAnchorPoint2(),
s.setPositionRound(e.position),s.setAnimation(0,"dialogue_smile",!0),s.setLocalZOrder(-1),this.addChild(s),s.y-=s.height,s.runAction(new cc.MoveBy(.4,0,s.height).easing(cc.easeBackOut()))},listBundles:function(){return["newelements"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{FINISHQUESTWINDOW_TITLE_TEXT:{size:70,lineHeight:77,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},FINISHQUESTWINDOW_REWARD_TEXT:{name:"default",size:90,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.FinishQuestWindow={offsetY:0,middle:{width:400,height:500,icon:{x:{align:"center",dx:0},y:{align:"center",dy:40},scale:1.3},shining:{x:{align:"center",dx:0},y:{align:"center",dy:40},scale:.7}},person:{position:[{x:{align:"center",dx:-460},y:{align:"bottom",dy:-30}},{x:{
align:"center",dx:-460},y:{align:"bottom",dy:-30}},{x:{align:"left",dx:150},y:{align:"bottom",dy:-30}}],scale:1.3},rewards:{scale:.7}};var UnitLibraryIcon=cleverapps.Layout.extend({ctor:function(e){this.unit=e;var t=this.styles=cleverapps.styles.UnitLibraryIcon,s=this.library=Game.currentGame.unitsLibrary,i=[],n=this.background=new cc.Scale9Sprite(bundles.mergeui.frames.icon_background_light);n.setContentSize2(t);var o=this.icon=UnitView.getUnitImage(e);o.clearTrack&&o.clearTrack(0),o.setAnchorPoint2(),o.setPositionRound(t.icon),o.setLocalZOrder(1),cleverapps.UI.fitToBox(o,{width:n.width-2*t.icon.padding.x,height:n.height-2*t.icon.padding.y,maxScale:t.icon.scale}),n.addChild(o);var r=s.getUnitName(e);0<=r.indexOf(" ")&&r.lastIndexOf(" ")===r.indexOf(" ")&&(r=r.replace(" ","\n"));var a=cleverapps.UI.generateOnlyText(r,cleverapps.styles.FONTS.LIGHT_SUBTITLE_TEXT);a.setDimensions(n.width,0),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),a.fitToHeight(t.text.maxHeight),i.push(a),
i.push(n),this._super(i,{direction:cleverapps.UI.VERTICAL}),s.isOpened(e)||(o.setCascadeOpacityEnabled(!0),o.setCascadeColorEnabled(!0),o.setOpacity(120),o.setColor(new cc.Color(0,150,255,255))),s.isFresh(e)&&(cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,this.onClick.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0})),s.on("unitStatusChanged",this.onUpdateStatus.bind(this),this),this.onUpdateStatus()},onClick:function(){this.library.removeFresh(this.unit,this.background),this.removeRays(),this.removeAttention(),cc.eventManager.removeListeners(this)},onUpdateStatus:function(){this.library.isFresh(this.unit)?(this.addRays(),this.setAttention(bundles.mergeui.frames.attention_coin)):(this.removeRays(),this.removeAttention())},setAttention:function(e){this.attention&&(this.attention.removeFromParent(),delete this.attention);var t=this.attention=new cc.Sprite(e);t.setPositionRound(this.styles.attention),t.setLocalZOrder(2),this.background.addChild(t)},
removeAttention:function(){this.attention&&(this.attention.runAction(new cc.Sequence(new cc.ScaleTo(.15,0),new cc.RemoveSelf)),delete this.attention)},addRays:function(){if(!this.rays){var e=this.rays=new cleverapps.Spine(bundles.merge.jsons.rays_json,1.2);e.setAnchorPoint2(),e.setPositionRound(this.background.width/2,this.background.height/2),e.setAnimation(0,"animation",!0),this.background.addChild(e)}},removeRays:function(){this.rays&&(this.rays.runAction(new cc.Sequence(new cc.ScaleTo(.5,0),new cc.RemoveSelf)),delete this.rays)}});cleverapps.styles.UnitLibraryIcon={width:260,height:260,icon:{x:{align:"center"},y:{align:"center",dy:5},scale:1.3,padding:{x:10,y:10}},text:{maxHeight:80},attention:{x:{align:"right",dx:15},y:{align:"top",dy:15}}};var HeroIcon=cc.Sprite.extend({ctor:function(e,t){this.unit=e,this._super(bundles.orderswindow.frames.hero_background),this.addIcon(),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,t,{swallowTouches:!1,ignoreOnTouchMoved:!0,
useInteractiveScale:!0}),Game.currentGame.unitsLibrary.on("unitStatusChanged",this.updateAttention.bind(this),this),this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),this.updateAttention()},addIcon:function(){var e;e=this.unit.unknownHero?new cc.Sprite(bundles.unitslibrarywindow.frames.icon_unknown):new cc.Sprite(bundles.unitslibrarywindow.frames["icon_"+this.unit.code]),this.icon=e,this.addChild(e)},setAttention:function(e){this.attention&&(this.attention.removeFromParent(),delete this.attention);var t=this.attention=new cc.Sprite(e);t.setPositionRound(cleverapps.styles.HeroIcon.attention),t.setLocalZOrder(2),this.addChild(t)},removeAttention:function(){this.attention&&(this.attention.runAction(new cc.Sequence(new cc.ScaleTo(.15,0),new cc.RemoveSelf)),delete this.attention)},onSelect:function(){this.selected=!0;var e=Game.currentGame.unitsLibrary;this.unit.unknownHero||e.isOpened(this.unit)?(this.icon.setColor(new cc.Color(255,255,255,255)),this.icon.setOpacity(255)):(
this.icon.setColor(new cc.Color(160,160,160,255)),this.icon.setOpacity(120)),this.setColor(new cc.Color(255,255,255,255)),this.setSpriteFrame(bundles.orderswindow.frames.hero_selected_background),this.icon.setPositionRound(this.unit.unknownHero?cleverapps.styles.HeroIcon.unknown_icon:cleverapps.styles.HeroIcon.icon_selected),this.updateAttention()},onUnSelect:function(){this.selected=!1,this.icon.setColor(new cc.Color(255,255,255,255)),this.icon.setOpacity(140),this.setColor(new cc.Color(160,160,160,255)),this.setSpriteFrame(bundles.orderswindow.frames.hero_background),this.icon.setPositionRound(this.unit.unknownHero?cleverapps.styles.HeroIcon.unknown_icon:cleverapps.styles.HeroIcon.icon),this.updateAttention()},updateAttention:function(){this.unit.unknownHero||(Game.currentGame.unitsLibrary.hasFresh(this.unit.code)?this.setAttention(bundles.mergeui.frames.attention_exclamation):this.removeAttention())}});cleverapps.styles.HeroIcon={icon:{x:{align:"center",dx:0},y:{align:"bottom",dy:12
}},icon_selected:{x:{align:"center",dx:0},y:{align:"bottom",dy:30}},unknown_icon:{x:{align:"center",dx:0},y:{align:"center",dy:0}},attention:{x:{align:"center",dx:100},y:{align:"center",dy:100}}};var FamilyLayout=cc.Node.extend({ctor:function(e,t,s){s=s||{},this._super(),this.styles=this.getStyles(),this.code=e;var i=this.icons=t.map(function(e){return new UnitLibraryIcon(e)}),n=this.createGrid(i,s.columns||6),o=this.background=cleverapps.UI.createScale9Sprite(bundles.mergeui.frames.details_background,cleverapps.UI.Scale9Rect.TwoPixelXY);if(o.setContentSize2(s.width||n.width,s.height||n.height),o.addChild(n),this.setContentSize2(o.getContentSize()),this.setAnchorPoint2(),o.setPositionRound(this.width/2,this.height/2),this.addChild(o),!1!==s.title){var r=this.createTitle(s.title||Game.currentGame.unitsLibrary.getFamilyName(e));o.addChild(r)}},gridSeparator:function(){return{horizontal:this.styles.grid.separator}},createGrid:function(e,t){var s=this.styles,i=new cleverapps.GridLayout(e,{
columns:t,direction:cleverapps.GridLayout.TOP_TO_BOTTOM,align:{y:cleverapps.GridLayout.ALIGN_END},padding:s.grid.padding,margin:s.grid.margin,separator:this.gridSeparator()});return i.setAnchorPoint2(),i.setPositionRound(s.grid),i},createTitle:function(e){var t=this.styles.title,s=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.LIGHT_TITLE_TEXT);s.setPositionRound(t.text);var i=cc.size(s.width+2*t.padding.x,s.height+2*t.padding.y);t.fitToLayoutWidth&&(i.width=this.width+2*t.padding.x);var n=cleverapps.UI.createScale9Sprite(bundles.unitslibrarywindow.frames.ow_tab_header_on,cleverapps.UI.Scale9Rect.TwoPixelXY);return n.setContentSize2(i),n.addChild(s),n.setPositionRound(t),n},getStyles:function(){return cleverapps.styles.FamilyLayout}});cleverapps.styles.FamilyLayout={title:{x:{align:"center"},y:{align:"top",dy:30},text:{x:{align:"center"},y:{align:"center",dy:6}},padding:{x:55,y:24}},grid:{x:{align:"left"},y:{align:"center",dy:-40},padding:{x:50,y:85},margin:{x:44,y:20},
separator:{image:bundles.mergeui.frames.next_arrow,x:{align:"center"},y:{align:"top",dy:-100}}}};var HeroDetailsLayout=FamilyLayout.extend({ctor:function(e,t,s){e.unknownHero&&(s.title="messages:Units.unknownHero.title"),this.searchUnit=s.searchUnit,this._super(e.code,t,s);var i=this.styles,n=cleverapps.UI.createScale9Sprite(bundles.unitslibrarywindow.frames.horizontal_scroll_foreground,cleverapps.UI.Scale9Rect.TwoPixelXY);if(n.setAnchorPoint2(),n.setPositionRound(i.foreground),n.setContentSize(i.foreground),this.addChild(n),e.unknownHero){var o=cleverapps.UI.generateOnlyText("messages:Units.unknownHero.details",cleverapps.styles.FONTS.LIGHT_TITLE_TEXT);o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(this.styles.unknownHeroText.width,0),o.setPositionRound(this.styles.unknownHeroText),this.addChild(o)}},createGrid:function(e){var t=this.styles,s=new cleverapps.GridLayout(e,{columns:e.length,direction:cleverapps.GridLayout.TOP_TO_BOTTOM,align:{
y:cleverapps.GridLayout.ALIGN_END},padding:t.grid.padding,margin:t.grid.margin,separator:this.gridSeparator()});if(s.setAnchorPoint2(),s.width<=t.grid.width)return s.setPositionRound(t.grid),s;var i=new cleverapps.UI.ScrollView(s,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,scrollBarEnabled:!1,direction:cleverapps.UI.ScrollView.DIR_HORIZONTAL});i.setContentSize(t.grid),i.setPositionRound(t.grid);var n=e.map(function(e){return e.unit}),o=this.searchUnit&&Unit.findUnit(n,this.searchUnit)||Game.currentGame.unitsLibrary.findFreshUnit(n)||Game.currentGame.unitsLibrary.findLastOpenedUnit(n),r=o?n.indexOf(o):n.length-1;return i.scrollTo(cleverapps.UI.ScrollView.SCROLLS.LOWER_RIGHT),i.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){i.scrollToMakeNodeVisible(e[r],.6,{easing:cc.easeBackInOut(),visibleBox:{left:.96,right:.96}})}))),i},getStyles:function(){return cleverapps.overrideStyles(this._super(),cleverapps.styles.HeroDetailsLayout,!0)}})
;cleverapps.styles.HeroDetailsLayout={unknownHeroText:{width:1600,x:{align:"center"},y:{align:"center"}},grid:{width:1870,height:540,x:{align:"left",dx:3},y:{align:"center",dy:-20},padding:{x:50,y:100},margin:{x:54,y:20}},foreground:{width:1880,height:380,x:{align:"center",dx:4},y:{align:"center",dy:0}}};var UnitsTab=cc.Node.extend({ctor:function(e,s){this.library=Game.currentGame.unitsLibrary;var t=this.families=e.map(function(e){var t=UnitsLibrary.ListByCode(e);return new FamilyLayout(e,t,{width:s.width})},this),i=cleverapps.styles.UnitsTab,n=new cleverapps.Layout(t,{direction:cleverapps.UI.TOP_TO_BOTTOM,margin:i.margin,padding:i.padding}),o=this.scroll=new cleverapps.UI.ScrollView(n,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK,scrollBarEnabled:!1,direction:cleverapps.UI.ScrollView.DIR_VERTICAL});o.setContentSize(n.width,Math.min(n.height,s.height)),o.scrollToDefault(),o.setPositionRound({x:{align:"center"},y:{align:"top"}}),this._super(),
this.setContentSize2(s),this.setAnchorPoint2(),this.setPositionRound({x:{align:"center"},y:{align:"center"}}),this.addChild(o)},onSelectTab:function(e){var t=(e=e||{}).searchUnit&&Unit.findUnit(this.families,{code:e.searchUnit.code})||Game.currentGame.unitsLibrary.findFreshUnit(this.families)||this.families[0];this.scroll.scrollToDefault(),this.scroll.scrollToMakeNodeVisible(t,.8,{easing:cc.easeBackInOut()})},onUnSelectTab:function(){this.scroll.stopAutoScroll()}});cleverapps.styles.UnitsTab={margin:60,padding:{x:0,y:55}};var HeroesTab=cc.Node.extend({ctor:function(e){this._super(),this.setContentSize2(e),this.setAnchorPoint2(),this.setPositionRound({x:{align:"center"},y:{align:"center"}}),this.styles=cleverapps.styles.HeroesTab,this.icons=this.createHeroIcons(),this.scroll=this.createScroll(),this.selectHero(0)},createHeroIcons:function(){var t=Game.currentGame.unitsLibrary,s=t.getNextHero(),e=t.listCodesByType("hero").map(function(e){return t.isHeroAvailable(e)||s===e?{code:e,
stage:Families[e].units.length-1,type:"hero"}:{type:"hero",unknownHero:!0}});return e.push({type:"hero",unknownHero:!0}),e.map(function(e,t){return new HeroIcon(e,function(){cleverapps.audio.playSound(bundles.main.urls.click_effect),this.selectHero(t)}.bind(this))},this)},createScroll:function(){var e=new cleverapps.Layout(this.icons,{direction:cleverapps.UI.HORIZONTAL,padding:this.styles.scroll.padding,margin:this.styles.scroll.margin}),t=new cleverapps.UI.ScrollView(e,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,scrollBarEnabled:!1,direction:cleverapps.UI.ScrollView.DIR_HORIZONTAL});return t.setContentSize(this.styles.scroll),t.setPositionRound(this.styles.scroll),this.addChild(t),t},createHeroDetails:function(e,t){this.details&&this.details.removeFromParent();var s=this.icons[e].unit,i=s.code?UnitsLibrary.ListByCode(s.code):[],n=new HeroDetailsLayout(s,i,{width:this.width,height:this.styles.details.height,searchUnit:t});return n.setPositionRound(
this.styles.details),n.setLocalZOrder(1),this.details=n,this.addChild(n),n},selectHero:function(s,e){this.selectedIndex!==s&&(this.icons.forEach(function(e,t){t===s?e.onSelect():e.onUnSelect()}),this.selectedIndex=s,this.createHeroDetails(s,e))},onSelectTab:function(e){e=e||{};var t=this.icons.map(function(e){return{code:e.unit.code}}),s=e.searchUnit&&Unit.findUnit(t,{code:e.searchUnit.code})||Game.currentGame.unitsLibrary.findFreshUnit(t)||Unit.findUnit(t,{code:Game.currentGame.unitsLibrary.getNextHero()}),i=s?t.indexOf(s):0;this.scroll.scrollToDefault(),this.scroll.scrollToMakeNodeVisible(this.icons[i],0,{easing:cc.easeBackInOut(),visibleBox:{left:.96,right:.96}}),this.selectHero(i,e.searchUnit)},onUnSelectTab:function(){this.scroll.stopAutoScroll()}});cleverapps.styles.HeroesTab={details:{x:{align:"center"},y:{align:"top",dy:-60},height:540},scroll:{width:1960,height:380,x:{align:"center"},y:{align:"bottom",dy:2},padding:{x:60,y:65},margin:40}};var MergeScene=GameSceneBase.extend({
ctor:function(e,t){var s=this.merge=new Merge(t);this._super(s,s.level);var i=this.map=new Map2dView(s.map);if(s.workers.regular.map(function(e){var t=new WorkerView(e);return this.scene.addChild(t),t},this),s.workers.onAddWorker=function(e){var t=new WorkerView(e);this.scene.addChild(t)}.bind(this),this.scroll=new cleverapps.UI.ScrollView(i,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK,childrenVisibilityPadding:Math.max(cleverapps.styles.Map2dView.cell.width,cleverapps.styles.Map2dView.cell.height),scrollBarEnabled:!1,zoom:!0,outOfBoundaryScale:.25,inertialScrollFactor:.2}),s.getScrollZoom=function(){return this.scroll.zoomHandler.normalizeZoom(this.scroll.zoom)}.bind(this),s.isScrollProcessing=this.createListener(function(){return this.scroll.scrollHandler.isProcessing()}.bind(this)),this.scroll.setContentSize(this.width,this.height),this.scroll.setPositionRound(this.scene.width/2,this.scene.height/2),this.scroll.setLocalZOrder(-1),this.scene.addChild(
this.scroll),Game.currentMiniGame&&(s.scrollCell=Game.currentMiniGame),s.scrollCell){var n=this.map.getCell(Map2d.LAYER_UNITS,s.scrollCell.x,s.scrollCell.y);this.scroll.scrollTo(n,0)}else if(s.fogs.blocks.fog0){var o=s.fogs.blocks.fog0.head;o&&this.centerTo(o.x,o.y,{silent:!0})}s.map.onCenterTo=this.centerTo.bind(this),s.map.onAddTarget=this.addTarget.bind(this),s.map.onZoomTo=this.zoomTo.bind(this),this.scroll.updateVisibility(),this.addCenterHint(),this.addSideBar(),this.addTutorial(),this.advice=new MergeAdviceView(s.advice,this),this.game.onSubstractEnergy=this.onSubEnergy.bind(this),this.game.gameLevel.onLevelUp=this.onLevelUp.bind(this),this.game.onAddItemsAnimation=this.addItemsAnimation.bind(this),this.game.pixelsPlanner.onCreateSwarm=this.createPixelsSwarmView.bind(this),this.game.barrelPlanner.onCreateBarrel=this.createBarrelView.bind(this),this.scroll.zoomHandler.setZoom(.8*this.getBasicZoom(),!0),this.game.onShowUp=this.showUp.bind(this),
cleverapps.canBlockOrientation&&this.height>this.width&&cleverapps.rotatePhoneInfo(!1),cleverapps.environment.levelNo=levels.user.level,this.merge.on("stop",this.onStop.bind(this),this)},onStop:function(){this.onChangeSize=function(){}},createPixelsSwarmView:function(e){var t=new PixelsSwarmView(e,this.scroll.getVisibleRect());this.map.animations.addChild(t)},createBarrelView:function(e){var t=new BarrelView(e);this.map.animations.addChild(t)},_playIntro:function(){this.needDisplayIntro=!1,cleverapps.metha.display({focus:"GameScene.intro",control:this.introControls(),action:this.displayIntro.bind(this)})},onChangeSize:function(){if(cleverapps.forces.isRunningForce())cleverapps.FixedWidthScene.changedSize=!0;else{var e=cc.director.getWinSize();this.setContentSize(e),this.scene.setPositionRound(this.width/2,this.height/2),this.scene.setContentSize2(cleverapps.UI.getSceneSize()),this.scroll.setPositionRound(this.scene.width/2,this.scene.height/2),this.scroll.setContentSize(this.width,
this.height),cleverapps.wideMode.refresh(),this.addMenuBar(),this.addSideBar(),this.addCenterHint(),cleverapps.Notification.remove(!0),cleverapps.eventBus.trigger("changeSceneSize")}},getBasicZoom:function(){return this.merge.zoom?this.merge.zoom:cc.sys.isMobile?1.85:1.2},miniGameReward:function(){if(Game.currentMiniGame){if(Game.currentMiniGame.reward){var e=Game.currentGame.map.getUnit(Game.currentMiniGame.x,Game.currentMiniGame.y);Game.currentMiniGame.reward.coins&&Game.currentGame.addCoins(Game.currentMiniGame.reward.coins,e,{withoutDelta:!0}),Game.currentMiniGame.reward.energy&&Game.currentGame.addEnergy(Game.currentMiniGame.reward.energy,e,{withoutDelta:!0}),Game.currentMiniGame.reward.gold&&Game.currentGame.addRubies(Game.currentMiniGame.reward.gold,e,{withoutDelta:!0})}Game.currentMiniGame=void 0}},showUp:function(e){var t=this.game.workers.findLeastBusy(Buildable),s=t&&t.getTimeLeft()<=0;s&&(this.game.map.onCenterTo(t.unit.x,t.unit.y,{silent:!0}),
cleverapps.metha.showControlsWhileFocused(["MenuBarGameLevelItem","MenuBarCoinsItem"])),this.runAction(new cc.Sequence(new cc.PlaySound(bundles.game.urls.start_game),new cc.CallFunc(function(){this.scroll.zoomTo(this.getBasicZoom(),1)}.bind(this)),new cc.DelayTime(1+(s?2:0)),new cc.CallFunc(function(){this.miniGameReward(),e()}.bind(this))))},getSourceCenterPosition:function(e){var t=this.map.alignInIsometricGrid(e.x,e.y);if(e instanceof Unit&&e.findComponent(MultiCell)){var s=e.findComponent(MultiCell).getCenter();t.x+=s.x,t.y+=s.y}return t},onSubEnergy:function(e,t){var s=void 0,i=this.map.animations;(t instanceof Unit||t instanceof FogTile)&&(s=this.getSourceCenterPosition(t),cleverapps.UI.animateDelta(-e,{icon:bundles.flying.frames.flying_energy_png,x:s.x,y:s.y,iconScale:cleverapps.styles.MergeScene.flyingIcons.scale,parent:i,font:cleverapps.styles.FONTS.MENUBAR_TEXT}))},getAmountFlyItems:function(e){return 100<=e?8:50<=e?5:3<=e?3:e},addItemsAnimation:function(e,t,s,i,n){
var o=void 0,r=this.map.animations;o=s instanceof Unit||s instanceof FogTile?this.getSourceCenterPosition(s):s.getPosition(),s instanceof cc.Node&&(r=s.parent);var a=i.beginScale||cleverapps.styles.MergeScene.flyingIcons.scale,c=i.flyAmount||this.getAmountFlyItems(t),l=bundles.flying.frames.flying_exp_png;switch(e){case"coins":l=bundles.flying.frames.flying_coin_png;break;case"energy":l=bundles.flying.frames.flying_energy_png;break;case"wands":l=bundles.flying.frames.flying_wand_png;break;case"rubies":l=bundles.flying.frames.flying_ruby_png;break;case"worker":l=bundles.reward_icons.frames.reward_worker_png,c=1}for(var p=0;p<c;p++){var d=new cc.Sprite(l);d.setScale(a),d.setLocalZOrder(1e3-p),d.setPositionRound(o),r.addChild(d),d.replaceParentSamePlace(this.scene,{keepScale:!0}),this.jumpCollectAnimation(p,c,d,i,e,p===c-1?n:void 0)}i.withoutDelta||this.runAction(new cc.Sequence(new cc.DelayTime(.1*c+.7),new cc.CallFunc(function(){cleverapps.UI.animateDelta(t,{icon:l,iconScale:a,x:o.x,
y:o.y+cleverapps.styles.MergeScene.changeInfo.dy,parent:r,font:cleverapps.styles.FONTS.MENUBAR_TEXT})})))},onLevelUp:function(){cleverapps.metha.display({focus:"onLevelUp",control:["MenuBarGoldItem","MenuBarGameLevelItem","MenuBarLivesItem","MenuBarCoinsItem"],actions:[function(e){new LevelUpWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){var t=NewRecipesWindow.ListNewRecipes();0!==t.length?(cleverapps.metha.hideAllControls(),new NewRecipesWindow(t),cleverapps.metha.onceNoWindowsListener=e):e()}.bind(this)]})},jumpCollectAnimation:function(e,t,s,i,n,o){var r=cleverapps.styles.MergeScene.jumpCollect,a=r.jumpBoth;i.jumpSide&&(a="left"===i.jumpSide?r.jumpLeft:r.jumpRight);var c={dist:{x:a.x1+e*(a.x2-a.x1)/t,y:a.y1+Math.random()*(a.y2-a.y1)},sound:bundles.merge.urls.coins_drop_effect,soundDelay:.3},l={speed:r.collect.speed,jump:!0};switch(n){case"coins":l.target=cleverapps.styles.MenuBar.CoinsItem.target;break;case"energy":
l.target=cleverapps.styles.MenuBar.LivesItem.target;break;case"wands":l.target=cleverapps.styles.MenuBar.WandsItem.target;var p=this.game.fogs.findBlockWithProgress();if(p){var d=p.getProgressTarget();d&&(l.target=d,c.parent=this.map.animations,l.parent=this.map.animations,s.replaceParentSamePlace(this.map.animations),this.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.CallFunc(function(){var e=new cc.Node;e.setAnchorPoint2(),e.setPositionRound(d.getPosition());var t=cleverapps.UI.getSceneSize();e.setContentSize2(2*t.width/3,2*t.height/3),d.getParent().addChild(e),this.scroll.scrollToMakeNodeVisible(e,1),e.removeFromParent()}.bind(this)))))}break;case"rubies":l.target=cleverapps.styles.MenuBar.GoldItem.target;break;case"worker":l.target=cleverapps.styles.MenuBar.WorkersItem.target;break;default:l.target=cleverapps.styles.MenuBar.GameLevelItem.target}s.setVisible(!1),s.runAction(new cc.Sequence(new cc.DelayTime(.1*e+.1*Math.random()),new cc.Show,new cc.CallFunc(
cleverapps.UI.jumpCollectAnimation.bind(null,s,{jump:c,collect:l,callback:o}))))},makeNodeVisible:function(e){this.scroll.scrollToMakeNodeVisible(e,1,{visibleBox:{left:.74,right:.74,top:.78,bottom:.94}})},centerTo:function(n,o,r){cleverapps.windows.whenAllClosed(function(){var e=(r=r||{}).silent?0:void 0!==r.duration?r.duration:MergeScene.SCROLL_TO_DURATION,t=void 0!==r.layer?r.layer:Map2d.LAYER_UNITS,s=this.map.getCell(t,n,o),i=cleverapps.extend({left:.1,right:.1,top:.1,bottom:.1},r.visibleBox);this.scroll.scrollToMakeNodeVisible(s,e,{visibleBox:i,callback:r.callback})}.bind(this))},addTarget:function(t,s){cleverapps.windows.whenAllClosed(function(){var e=new FingerView;e.setPositionRound(this.map.getUnitCenterPos(t,s)),this.map.animations.addChild(e),e.standardLoop({runOnce:!0})}.bind(this))},closeAction:function(){if(cleverapps.administrator&&!cc.sys.isNative)return this.game.stop(),void AdministratorScene.open();window.closeApplication&&window.closeApplication()},
addSideBar:function(){this.sideBar&&this.sideBar.removeFromParent();var e=this.sideBar=new SideBarView({silent:Boolean(this.sideBar)});e.setPositionRound(this.scene.width/2,this.scene.height/2),e.setLocalZOrder(1),this.scene.addChild(e)},addTutorial:function(){var e=new MergeTutorialView(this.merge.tutorial);e.setPositionRound(this.scene.width/2,this.scene.height/2),this.scene.addChild(e)},addCenterHint:function(){this.centerHint&&this.centerHint.removeFromParent();var e=this.centerHint=new CenterHint(this.merge);e.setAnchorPoint2(),e.setPositionRound(this.width/2,this.height/2),e.setContentSize2(this.width,this.height),this.scene.addChild(e)},zoomTo:function(e){var t=Game.currentGame.getScrollZoom(),s=e.zoom;if(!(e.direction===MergeScene.ZOOM_DIRECTION_IN&&s<t||e.direction===MergeScene.ZOOM_DIRECTION_OUT&&t<s)){var i=void 0!==e.duration?e.duration:.35+.35*(s-t);this.scroll.zoomTo(s,i)}}});(GameScene=MergeScene).SCROLL_TO_DURATION=1,MergeScene.ZOOM_DIRECTION_IN=0,
MergeScene.ZOOM_DIRECTION_OUT=1,GameScene.BUNDLES=function(e,t){var s=t&&t.episodeNo||0,i=GameSceneBase.BUNDLES();return i.push("episode_"+s,"particle","tiles"),i},cleverapps.styles.MergeScene={changeInfo:{dy:75},flyingIcons:{scale:.6},jumpCollect:{jumpRight:{x1:50,x2:150,y1:-50,y2:-100},jumpLeft:{x1:-50,x2:-150,y1:-50,y2:-100},jumpBoth:{x1:-50,x2:50,y1:-50,y2:-100},collect:{speed:2600}}};var Pulsing=function(e){this.unit=e,this.beforeCollect=function(){},this.buildingComplete=function(){},this.init=function(){}},Bubble=function(e){this.unit=e,this.beforeCollect=function(){}},Shine=function(){},Collectible=function(e){this.unit=e,this.onCollection=function(){}};Collectible.prototype.handleClick=function(){return this.collect(),!0},Collectible.prototype.clear=function(){this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},Collectible.prototype.handleTouchBegin=function(){return!!this.unit.getData().unmergeable&&(this.collect(),!0)},Collectible.prototype.collect=function(){
this.unit.findComponent(Pulsing)&&this.unit.findComponent(Pulsing).beforeCollect(),this.unit.findComponent(Bubble)&&this.unit.findComponent(Bubble).beforeCollect(),this.onCollection(),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.collectionWithSwipe||cleverapps.audio.playSound(bundles.main.urls.click_effect),Game.currentGame.advice.boo(),this.unit.remove(!0),this.timeout=setTimeout(function(){delete this.timeout,Game.currentGame.harvest(this.unit)}.bind(this),500)};var DivideCollectible=function(e){this.unit=e,this.onCollection=function(){}};DivideCollectible.prototype.handleClick=function(){return this.collect(),!0},DivideCollectible.prototype.handleTouchBegin=function(){return!!this.unit.getData().unmergeable&&(this.collect(),!0)},DivideCollectible.prototype.collect=function(){this.unit.findComponent(Pulsing)&&this.unit.findComponent(Pulsing).beforeCollect(),this.onCollection(function(){Game.currentGame.harvest(this.unit)}.bind(this)),cleverapps.audio.playSound(
bundles.main.urls.click_effect),this.unit.remove(!0)};var ResourceCollectible=function(e){this.unit=e,this.onCollection=function(){}};ResourceCollectible.prototype.handleClick=function(){if(!Buildable.IsBuilt(this.unit))return!1;var e=this.getResourceTarget();return!!e&&(this.collect(e),!0)},ResourceCollectible.prototype.getResourceTarget=function(){return Game.currentGame.getTargetCastle(this.unit)},ResourceCollectible.prototype.handleTouchBegin=function(){if(!Buildable.IsBuilt(this.unit))return!1;var e=this.getResourceTarget();return!!e&&(this.collect(e),!0)},ResourceCollectible.prototype.collect=function(e){this.unit.findComponent(Pulsing)&&this.unit.findComponent(Pulsing).beforeCollect(),this.onCollection(),cleverapps.audio.playSound(bundles.main.urls.click_effect),Game.currentGame.advice.boo(),e.findComponent(Upgradable).incProgress(500),this.unit.remove(!0)};var Dish=function(e){this.unit=e,this.openAnimation=function(){}};Dish.prototype.listPrize=function(){
return Recipes.filter(function(e){return e.code===this.unit.getData().dish},this)[0].prize},Dish.prototype.handleTouchBegin=function(){var e=Game.currentGame,t=this.listPrize(),s=t.length-e.map.countEmptySlots()-1;if(!(0<s)){this.unit.findComponent(Bubble)&&this.unit.findComponent(Bubble).beforeCollect(),this.unit.remove(!0);var i=t.map(function(e){return new Unit(e)});return e.spawn(i,this.unit,{radius:Map2d.RADIUS_SMALL}),this.openAnimation(),!0}Game.currentGame.onHintMessage("messages:Spawn.nospace",!1,{left:s})};var MakesOrder=function(e,t){var s=Game.currentGame;(this.unit=e).onPrizeHarvested=this.reset.bind(this),this.onChangeState=function(e){},this.onUpdateIngredients=function(){},s.orders.addOrder(this),cleverapps.config.editorMode||this.restore(t)};MakesOrder.ORDER_TIMEOUT="30 seconds",MakesOrder.prototype.save=function(e){e.state=this.state,e.recipe=this.recipe&&this.recipe.code,e.timeToReady=this.timeToReady},MakesOrder.prototype.restore=function(e){
var t=e.recipe&&this.restoreRecipe(e.recipe);e.state!==MakesOrder.STATE_EMPTY&&t?e.state===MakesOrder.STATE_RECIPE?this._setState(MakesOrder.STATE_RECIPE,t):e.state===MakesOrder.STATE_COOKING?this._setState(MakesOrder.STATE_COOKING,t,e.timeToReady-Date.now()):(this._setState(MakesOrder.STATE_READY,t),this.unit.setPrizes([this.createPrizeUnit()])):this._setState(MakesOrder.STATE_EMPTY)},MakesOrder.prototype.isCooking=function(){return this.state===MakesOrder.STATE_COOKING},MakesOrder.prototype.restoreRecipe=function(e){for(var t=0;t<Recipes.length;++t){var s=Recipes[t];if(s.code===e&&Game.currentGame.harvested.isAvailableList(s.ingredients))return s}},MakesOrder.prototype.clear=function(){clearTimeout(this.timeout)},MakesOrder.prototype._setState=function(e,t,s){if(!cleverapps.config.editorMode){var i=Game.currentGame;switch(clearTimeout(this.timeout),e){case MakesOrder.STATE_RECIPE:case MakesOrder.STATE_READY:this.state=e,this.recipe=t,delete this.timeToReady;break
;case MakesOrder.STATE_COOKING:this.state=e,this.recipe=t,this.timeToReady=Date.now()+s,this.timeout=new cleverapps.LongTimeout(this.enjoy.bind(this),s);break;default:this.state=MakesOrder.STATE_EMPTY,delete this.recipe,delete this.timeToReady,this.timeout=new cleverapps.LongTimeout(this.order.bind(this),cleverapps.parseInterval(MakesOrder.ORDER_TIMEOUT))}this.onChangeState(),i.orders.updateOrder(this)}},MakesOrder.prototype.order=function(){var e=Game.currentGame.orders.chooseFreeRecipe();e?(this._setState(MakesOrder.STATE_RECIPE,e),this.unit.save()):this.reset()},MakesOrder.prototype.canCook=function(){return this.state===MakesOrder.STATE_RECIPE&&Game.currentGame.harvested.canTakeList(this.recipe.ingredients)},MakesOrder.prototype.isReady=function(){return this.state===MakesOrder.STATE_READY},MakesOrder.prototype.cook=function(){return!!this.canCook()&&(Game.currentGame.harvested.takeList(this.recipe.ingredients),this._setState(MakesOrder.STATE_COOKING,this.recipe,
cleverapps.parseInterval(this.recipe.time)),this.unit.save(),Game.currentGame.pushes.updateOrders(),!0)},MakesOrder.prototype.enjoy=function(){return this.state===MakesOrder.STATE_COOKING&&(this._setState(MakesOrder.STATE_READY,this.recipe),this.unit.setPrizes([this.createPrizeUnit()]),this.unit.save(),cleverapps.sideBar.resetByClassName(OrdersIcon),Game.currentGame.pushes.updateOrders(),!0)},MakesOrder.prototype.reset=function(){this._setState(MakesOrder.STATE_EMPTY),this.unit.save()},MakesOrder.prototype.handleClick=function(){return-1===[MakesOrder.STATE_EMPTY,MakesOrder.STATE_READY].indexOf(this.state)&&(Game.currentGame.tutorial.checkTargets(this.unit)?new OrdersWindow(this):cleverapps.metha.display({focus:"openOrdersWindow",action:function(e){new OrdersWindow(this),cleverapps.metha.onceNoWindowsListener=e}.bind(this)}),!0)},MakesOrder.prototype.getTimeLeft=function(){return Math.max(this.timeToReady-Date.now()||0,0)},MakesOrder.prototype.getPrizeUnitInfo=function(){
return this.recipe&&{code:"dishes",stage:Recipes.indexOf(this.recipe)}},MakesOrder.prototype.createPrizeUnit=function(){return new Unit(this.getPrizeUnitInfo())},MakesOrder.STATE_EMPTY=0,MakesOrder.STATE_RECIPE=1,MakesOrder.STATE_COOKING=2,MakesOrder.STATE_READY=3;var Chest=function(e){this.unit=e,this.openAnimation=function(){}};Chest.prototype.open=function(){var e=Game.currentGame,t=this.listPrize(),s=t.length-e.map.countEmptySlots()-1;if(0<s)e.onHintMessage("messages:Spawn.nospace",!1,{left:s});else{e.gameEvent(Merge.PRIZE_HARVESTED,{affected:this.unit,prizes:t}),this.unit.remove(!0);var i=t.map(function(e){return new Unit({code:e.code,stage:e.stage})}),n={radius:Map2d.RADIUS_BIG};cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.fastSpawnPrizes&&(n.wysiwygExplosionChest=!0),e.spawn(i,this.unit,n),this.openAnimation()}},Chest.prototype.listAvailable=function(){var s=ChestListPrize[this.unit.code][this.unit.stage],i=[];for(var n in s){var e=[n],o=s[n].basic.length;if(s[n].hero
)Game.currentGame.unitsLibrary.getNextHero()?(e=[Game.currentGame.unitsLibrary.getNextHero()],o=Math.min(o,Families[e[0]].units.length-1)):e=[];s[n].family&&(e=Game.currentGame.unitsLibrary.listAvailableByType(n)),e.forEach(function(e){for(var t=0;t<o;t++)0<=s[n].basic[t]&&i.push({code:e,stage:t})})}return i},Chest.ListPrizeProb=function(e){var t,s=ChestListPrize[e.code][e.stage],c={},i=function(e,t,s,i,n){if(n){var o=[e];if(!s||(o=Game.currentGame.unitsLibrary.listAvailableByType(e)).length){if(i){var r=Game.currentGame.unitsLibrary.getNextHero();if(!r||t>=Families[r].units.length-1)return;o=[r]}n/=o.length;for(var a=0;a<o.length;a++)c[e].types.push({code:o[a],stage:t,prob:n})}}};for(t in s){var n,o=0;for(c[t]={minAmount:0,maxAmount:0,resource:s[t].resource,types:[]},n=0;n<s[t].basic.length;n++)0<=s[t].basic[n]&&o++;for(n=0;n<s[t].basic.length;n++)0<=s[t].basic[n]&&(c[t].minAmount+=s[t].basic[n],c[t].maxAmount+=s[t].basic[n],i(t,n,s[t].family,s[t].hero,
s[t].itemsProb?s[t].itemsProb[n]:1/o));s[t].bonus&&(s[t].prob||(c[t].minAmount+=s[t].bonus[0]),c[t].maxAmount+=s[t].bonus[1]),c[t].types.length&&c[t].maxAmount||delete c[t]}var r={minAmount:0,maxAmount:0,types:[]};for(t in c)r.minAmount+=c[t].minAmount,r.maxAmount+=c[t].maxAmount;var a,l=(r.minAmount+r.maxAmount)/2;for(t in c){var p=(c[t].minAmount+c[t].maxAmount)/2;for(a=0;a<c[t].types.length;a++){var d=c[t].types[a];r.types.push(d),d.prob*=p/l}}var h=0;for(a=0;a<r.types.length-1;a++){if(1<=h+r.types[a].prob){r.types=r.types.slice(0,a+1);break}h+=r.types[a].prob}for(r.types[r.types.length-1].prob=1-h,a=0;a<r.types.length;a++)r.types[a].prob=Math.round(1e4*r.types[a].prob)/100;var u=[];for(a=0;a<r.types.length;a++)u.push(a);for(u=u.sort(function(e,t){return r.types[t].prob!=r.types[e].prob?r.types[t].prob-r.types[e].prob:e-t}),c={minAmount:r.minAmount,maxAmount:r.maxAmount,types:[]},a=0;a<u.length;a++)c.types.push(r.types[u[a]]);return c},Chest.prototype.listPrize=function(){
this.unit.seedRandom();var e=ChestListPrize[this.unit.code][this.unit.stage],o=[],t=function(e,t,s,i){if(s){var n=Game.currentGame.unitsLibrary.listAvailableByType(e);if(!n.length)return;e=cleverapps.Random.choose(n)}i&&(!(e=Game.currentGame.unitsLibrary.getNextHero())||t>=Families[e].units.length-1||Game.currentGame.gameLevel.getLevel()<3)||o.push(Game.currentGame.decreasePrizeStageIfNeeded({code:e,stage:t}))};for(var s in e){var i,n,r=[],a=0;for(n=0;n<e[s].basic.length;n++)0<=e[s].basic[n]&&a++;for(n=0;n<e[s].basic.length;n++)if(0<=e[s].basic[n]){for(i=0;i<e[s].basic[n];i++)t(s,n,e[s].family,e[s].hero);r.push({code:s,stage:n,family:e[s].family,hero:e[s].hero,prob:e[s].itemsProb?e[s].itemsProb[n]:1/a})}if(e[s].bonus){var c=cleverapps.Random.random(e[s].bonus[0],e[s].bonus[1]);for(i=0;i<c;i++)if(!(e[s].prob&&cleverapps.Random.nextDouble()>e[s].prob))for(var l=cleverapps.Random.nextDouble(),p=0,d=0;d<r.length;d++)if(l<=(p+=r[d].prob)){t(r[d].code,r[d].stage,r[d].family,r[d].hero);break}
}}return o},Chest.prototype.handleClick=function(){if(this.unit.onSqueeze(),cleverapps.audio.playSound(bundles.collectible.urls.coins_fly_finish_effect),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.skipOpenChestWindow)return this.open(),!0;var t={executed:!1},e=[function(e){setTimeout(e,300)},function(e){new OpenChestWindow(this.unit,t),cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){t.executed?cleverapps.metha.compound(e,[function(e){setTimeout(e,300)},function(e){this.open(),e()}.bind(this)]):e()}.bind(this)];return Game.currentGame.tutorial.checkTargets(this.unit)?cleverapps.metha.compound(function(){},e):cleverapps.metha.display({focus:"openChestWindow",actions:e}),!0};var Generator=function(e,t){this.unit=e,this.levels=e.getData().generator.levels,this.brightLevels=e.getData().generator.brightLevels,this.level=t.level||0,this.changedLevels=t.changedLevels||0,this.beforeUpdateStage=function(){},this.afterUpdateStage=function(){},
this.beforeUpdateLevel=function(){},this.levels&&this.level>=this.levels&&setTimeout(this._gotoNextStage.bind(this),0)};Generator.prototype.save=function(e){e.level=this.level,e.changedLevels=this.changedLevels},Generator.prototype.clear=function(){this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},Generator.prototype._gotoNextStage=function(){this.beforeUpdateStage(),this.timeout=setTimeout(function(){delete this.timeout;var e=new Unit({code:this.unit.code,stage:this.unit.stage+1,level:0,changedLevels:this.changedLevels});Game.currentGame.replace(this.unit,e,!0),e.findComponent(Generator).afterUpdateStage()}.bind(this),1e3)},Generator.prototype.gotoNextLevel=function(){this.beforeUpdateLevel(),this.timeout=setTimeout(function(){delete this.timeout;var e=new Unit({code:this.unit.code,stage:this.unit.stage,level:this.levels?this.level+1:0,changedLevels:this.changedLevels+1});Game.currentGame.replace(this.unit,e,!0)}.bind(this),this.levels?600:0)};var InstantWorker=function(
e,t){this.unit=e,this.limit=t.limit||cleverapps.parseInterval("1 hour"),this.onStartMagic=function(){},this.onFinishMagic=function(){},this.onPercentageChanged=function(){},this.onDragStart=function(){},this.onDragFinish=function(){},this.onClear=function(){}};InstantWorker.prototype.isFresh=function(){return this.limit===cleverapps.parseInterval("1 hour")},InstantWorker.prototype.isWorking=function(){return Boolean(this.assignment)},InstantWorker.prototype.save=function(e){e.limit=this.limit},InstantWorker.prototype.clear=function(){this.onClear()},InstantWorker.prototype.getInfo=function(){return{title:this.unit,duration:this.limit,remains:{value:this.limit,total:cleverapps.parseInterval("1 hour")},guide:{class:InstantWorkerGuideWindow,unit:this.unit}}},InstantWorker.prototype.getPercentage=function(){return 100*this.limit/cleverapps.parseInterval("1 hour")},InstantWorker.BUILDING_ANIMATION_TIME=5500,InstantWorker.prototype.buildInstantly=function(e){if(
!Game.currentGame.workers.findInstantAssigned(e)){var t=Game.currentGame.map.findEmptySlot(e.unit.x,e.unit.y);t&&this.unit.move(t.x,t.y);var s=Game.currentGame.workers.findAssigned(e.unit);s&&s.completeAssignment(),this.assignment=e,this.onStartMagic(e),Game.currentGame.counter.setTimeout(this.doMagic.bind(this,e),InstantWorker.BUILDING_ANIMATION_TIME)}},InstantWorker.prototype.doMagic=function(e){delete this.assignment,this.onFinishMagic(e);var t=Math.min(this.limit,e.time);if(e.completeBuilding(t),this.limit-=t,this.unit.save(),this.onPercentageChanged(),this.limit<=0){Game.currentGame.workers.removeInstant(this);var s=new Unit({code:this.unit.code,stage:0});Game.currentGame.replace(this.unit,s)}},InstantWorker.prototype.getTarget=function(e,t){var s=Game.currentGame.map.getUnit(e,t);if(!s)return!1;var i=s.findComponent(Buildable);return i&&!i.isCompleted()&&void 0===Game.currentGame.workers.findInstantAssigned(i)?s:void 0},InstantWorker.prototype.handleDragStart=function(){
return this.availableBuildings=Game.currentGame.map.listAvailableUnits().filter(function(e){return this.getTarget(e.x,e.y)},this),this.availableBuildings.forEach(function(e){e.highlight(),e.findComponent(Buildable).onHighlight()}),this.onDragStart(),!1},InstantWorker.prototype.handleDragMove=function(e,t){this.getTarget(e,t)&&this.unit.light.hide()},InstantWorker.prototype.handleDragEnd=function(e,t){var s=this.getTarget(e,t);if(this.availableBuildings.forEach(function(e){e.unhighlight(),e.findComponent(Buildable).onUnhighlight()}),this.availableBuildings=void 0,this.onDragFinish(),s)return this.buildInstantly(s.findComponent(Buildable)),!0};var Grounded=function(e){this.unit=e,this.remove=function(){}};Grounded.prototype.save=function(e){e.grounded=1};var SourceChestBonues=[{heroitems:{hero:!0,basic:[0,0,0],bonus:[1,1],itemsProb:[.58,.29,.13],prob:.5},fruit:{family:!0,basic:[0],bonus:[1,1],prob:.5}},{coins:{basic:[0],bonus:[2,2],prob:.3},worker:{basic:[0],bonus:[1,1],prob:.2},
heroitems:{hero:!0,basic:[0,0,0],bonus:[2,2],itemsProb:[.58,.29,.13],prob:.8},fruit:{family:!0,basic:[0,-1,-1,-1,0],bonus:[1,3]}},{rubies:{basic:[0],bonus:[2,2],prob:.3},coins:{basic:[0],bonus:[2,2],prob:.3},crystal:{basic:[0],bonus:[2,2],prob:.3},worker:{basic:[0],bonus:[0,1]},heroitems:{hero:!0,basic:[0,0,0],bonus:[2,2],itemsProb:[.58,.29,.13],prob:.8},fruit:{family:!0,basic:[0,-1,-1,-1,0],bonus:[2,4]}}],ChestListPrize={treasure:[{rubies:{basic:[0,0],bonus:[2,3]},coins:{basic:[0,0],bonus:[1,2]}},{rubies:{basic:[0,1],bonus:[1,2]},coins:{basic:[0,2,0],bonus:[2,3]}},{rubies:{basic:[0,1,1],bonus:[3,4]},coins:{basic:[0,2,1],bonus:[2,4]}}],freechest:[{rubies:{basic:[0],bonus:[1,1],prob:.7},coins:{basic:[0,0],bonus:[6,6],itemsProb:[.66,.34],prob:.5},crystal:{basic:[0],bonus:[2,2],prob:.3},worker:{basic:[0],bonus:[2,2],prob:.2},heroitems:{hero:!0,basic:[0,0,0],bonus:[2,2],itemsProb:[.58,.29,.13],prob:.8},fruit:{family:!0,basic:[0,-1,-1,-1,0],bonus:[3,6]}}],herochest:[{coins:{basic:[0,0],
bonus:[2,2],prob:.8},worker:{basic:[0],bonus:[3,3],prob:.3},heroitems:{hero:!0,basic:[1,1,1],bonus:[3,6],itemsProb:[.25,.5,.25]}}],woodchest:[cleverapps.extend({wood:{basic:[3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({wood:{basic:[1,1],bonus:[2,4],itemsProb:[.6,.4],resource:!0}},SourceChestBonues[1]),cleverapps.extend({wood:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],stonechest:[cleverapps.extend({stone:{basic:[1,0],bonus:[2,2],itemsProb:[.7,.3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({stone:{basic:[0,0,0],bonus:[3,5],itemsProb:[.25,.5,.25],resource:!0}},SourceChestBonues[1]),cleverapps.extend({stone:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],wagonchest:[cleverapps.extend({wagon:{basic:[1,0],bonus:[2,2],itemsProb:[.7,.3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({wagon:{basic:[0,0,0],bonus:[3,5],itemsProb:[.25,.5,.25],resource:!0}},SourceChestBonues[1]),
cleverapps.extend({wagon:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],bamboochest:[cleverapps.extend({bamboo:{basic:[1,0],bonus:[2,2],itemsProb:[.7,.3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({bamboo:{basic:[0,0,0],bonus:[3,5],itemsProb:[.25,.5,.25],resource:!0}},SourceChestBonues[1]),cleverapps.extend({bamboo:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],sapphirechest:[cleverapps.extend({sapphire:{basic:[1,0],bonus:[2,2],itemsProb:[.7,.3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({sapphire:{basic:[0,0,0],bonus:[3,5],itemsProb:[.25,.5,.25],resource:!0}},SourceChestBonues[1]),cleverapps.extend({sapphire:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],magicalwoodchest:[cleverapps.extend({magicalwood:{basic:[1,0],bonus:[2,2],itemsProb:[.7,.3],resource:!0}},SourceChestBonues[0]),cleverapps.extend({magicalwood:{basic:[0,0,0],bonus:[3,5],itemsProb:[.25
,.5,.25],resource:!0}},SourceChestBonues[1]),cleverapps.extend({magicalwood:{basic:[0,0,0],bonus:[7,9],itemsProb:[.2,.4,.4],resource:!0}},SourceChestBonues[2])],sacks:[{fruit:{family:!0,basic:[4,-1,-1,-1,0],bonus:[0,1]}},{fruit:{family:!0,basic:[7,-1,-1,-1,1],bonus:[0,2]}},{fruit:{family:!0,basic:[11,-1,-1,-1,3],bonus:[0,2]}}]};ChestListPrize.coinsplantchest=[cleverapps.extend({coinsplant:{basic:[1]}},ChestListPrize.treasure[0]),cleverapps.extend({coinsplant:{basic:[3]}},ChestListPrize.treasure[1]),cleverapps.extend({coinsplant:{basic:[0,2]}},ChestListPrize.treasure[2])],ChestListPrize.rubiesplantchest=[cleverapps.extend({rubiesplant:{basic:[1]}},ChestListPrize.treasure[0]),cleverapps.extend({rubiesplant:{basic:[3]}},ChestListPrize.treasure[1]),cleverapps.extend({rubiesplant:{basic:[0,2]}},ChestListPrize.treasure[2])],ChestListPrize.energyplantchest=[cleverapps.extend({energyplant:{basic:[1]}},ChestListPrize.treasure[0]),cleverapps.extend({energyplant:{basic:[3]}},
ChestListPrize.treasure[1]),cleverapps.extend({energyplant:{basic:[0,2]}},ChestListPrize.treasure[2])];var ChestCreatePrize={treasure:[void 0,{exp:1},{exp:2}],coinsplantchest:[void 0,{exp:1},{exp:2}],rubiesplantchest:[void 0,{exp:1},{exp:2}],energyplantchest:[void 0,{exp:1},{exp:2}],woodchest:[void 0,{exp:1},{exp:3}],stonechest:[void 0,{exp:5},{exp:15}],wagonchest:[void 0,{exp:5},{exp:15}],bamboochest:[void 0,{exp:5},{exp:15}],sapphirechest:[void 0,{exp:5},{exp:15}],magicalwoodchest:[void 0,{exp:5},{exp:15}],sacks:[void 0,{exp:1},{exp:2}]},CastleListPrize=function(e){e.unit.seedRandom(e.harvested);var t=cleverapps.Random.choose([5,6,7,8]);t*=e.unit.findComponent(Upgradable).level;var s=[{code:"sacks",stage:0},{code:"sacks",stage:1},{code:"worker",stage:0},{code:"worker",stage:1},{code:"crystal",stage:0},{code:"wands",stage:0},{code:"coins",stage:0},{code:"coins",stage:1},{code:"rubies",stage:0},{code:"rubies",stage:1}];cleverapps.config.wysiwygMode&&(t=16,s=[{code:"sacks",stage:2},{
code:"woodchest",stage:1},{code:"treasure",stage:2},{code:"crystal",stage:3},{code:"wands",stage:2},{code:"coins",stage:3},{code:"coins",stage:2},{code:"rubies",stage:2},{code:"rubies",stage:1}]);var i,n=[];for(i=0;i<t;i++){var o=cleverapps.Random.choose(s);n.push(o)}for(var r=!0;r;){r=!1,n.sort(function(e,t){return e.code!==t.code?e.code<t.code:e.stage-t.stage});var a=[];for(i=0;i<n.length;i++)i<n.length-2&&n[i].code===n[i+2].code&&n[i].stage===n[i+2].stage&&n[i].stage<Families[n[i].code].units.length-1?(a.push({code:n[i].code,stage:n[i].stage+1}),i+=2,r=!0):a.push(n[i]);n=a}var c=[];for(i=0;i<n.length;i++)c.push(Game.currentGame.decreasePrizeStageIfNeeded({code:n[i].code,stage:n[i].stage}));return c},ShapeSquare=[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],ShapeTopRightCorner=[{x:0,y:0},{x:-1,y:0},{x:0,y:-1}],ResourceFamily=function(n,o){for(var e=[0,1,2,3,5,10,15,25,150,300,500,1e3,3e3,5e3,8e3],t=[0,0,1,2,3,5,10,15,20,25,30,35,40,45,50],r=[],s=0;s<n;s++)if(s===n-1)r.push({
exp:10*r[s-1].exp,coins:75});else{var i=void 0;(e[s]||t[s])&&(i={},e[s]&&(i.exp=e[s]),t[s]&&(i.coins=t[s])),r.push(i)}var a=["0 seconds","0 seconds","15 seconds","40 seconds","1 minute","5 minute","15 minute","2 hour","4 hour","8 hour","12 hour","14 hour","16 hour","18 hour","20 hour","22 hour"],c=[1,3,10,30,90,270,810,2430,7290,21870,65610,196830,590490,177e4,53e5].slice(0,n-1).map(function(e,t){var s=t;"wood"!==o&&1<s&&s++,a.length<=s&&(s=a.length-1);var i={buildable:a[s],createPrize:r[t]};return t<2&&(i.removable=!0),t===n-2&&(i.unmergeable=!0,i.resourceCollectible=!0,i.pulsing=!0),i.value=e,i});return c.push({unmergeable:!0,temporary:!0,multicell:ShapeSquare,important:!0,upgradable:{stages:5,level:0,collectedStage:n-2,moveToNextStageOnUpgrade:!0,changeImageStages:[2]}}),c.push({unmergeable:!0,multicell:ShapeSquare,upgradable:{stages:5,level:1,collectedStage:n-2},castle:!0,important:!0,buildable:"24 hour",createPrize:r[n-1]}),{type:"resource",units:c}},FruitFamily=function(){return{
type:"fruit",units:[{removable:!0},{createPrize:{exp:1,coins:1},removable:!0},{createPrize:{exp:2,coins:2},removable:!0},{fruit:!0,unmergeable:!0,createPrize:{exp:3,coins:3}},{pulsing:!0,collectible:!0,value:1,unmergeable:!0},{mineable:[{time:"15 seconds",exp:5,energy:5}]}]}},CustomFamily=function(e,t,s){for(var i=[void 0,5,10,15,25],n=[],o=0;o<e;o++){var r={createPrize:{exp:i[o]}};s.shine&&0<o&&(r.shine=!0),s.instantWorker&&o===e-1&&(r.instantWorker=!0),s.crystal&&(r.crystal=!0),n.push(r)}return{type:t,units:n}},ChestFamily=function(e){for(var t=ChestListPrize[e],s=[],i=0;i<t.length;i++){var n={chest:!0};ChestCreatePrize[e]&&(n.createPrize=ChestCreatePrize[e][i]),s.push(n)}return{type:"chest",resource:e,units:s}},ValuableFamily=function(i,n){var e=n.amounts,o=n.exp;return{type:"valuables",id:i,units:e.map(function(e,t){var s;return s="wands"===i?{value:e,divideCollectible:0!==e}:{value:e,collectible:0!==e},o[t]&&(s.createPrize={exp:o[t]}),n.shineFrom&&t>=n.shineFrom&&(s.shine=!0),s})}
},GeneratorFamily=function(e){var t,s,i=[],n=[],o=[];for(s=7,t=0;t<s;t++)i.push({time:t===s-1?"3 hours":"0 seconds",exp:t===s-1?50:15,energy:t===s-1?30:5});for(s=6,t=0;t<s;t++)n.push({time:t===s-1?"3 hours":"0 seconds",exp:t===s-1?100:30,energy:t===s-1?40:10});for(s=5,t=0;t<s;t++)o.push({time:t===s-1?"3 hours":"0 seconds",exp:t===s-1?150:50,energy:t===s-1?50:15});return{type:"generator",resource:e,units:[{unmergeable:!0,mineable:i,multicell:ShapeSquare,generator:{levels:3},important:!0},{unmergeable:!0,mineable:n,multicell:ShapeSquare,generator:{levels:5},important:!0},{unmergeable:!0,mineable:o,multicell:ShapeSquare,generator:{brightLevels:5},important:!0}]}},SourceFamily=function(e){var t={stump:[{time:"0 second",exp:5,energy:3},{time:"30 seconds",exp:20,energy:5}],sapling:[{time:"0 second",exp:5,energy:3},{time:"0 second",exp:20,energy:5},{time:"45 second",exp:25,energy:10},{time:"1 minute",exp:30,energy:15}],tree:[{time:"0 minute",exp:5,energy:5},{time:"0 minute",exp:20,energy:10},
{time:"0 minute",exp:25,energy:15},{time:"45 seconds",exp:30,energy:20},{time:"1 minute",exp:35,energy:25},{time:"5 minute",exp:40,energy:30}]};return{type:"source",resource:e,units:[{removable:!0},{mineable:t.stump,unmergeable:!0,createPrize:{exp:1,coins:1}},{removable:!0},{mineable:t.sapling,unmergeable:!0,createPrize:{exp:5,coins:2}},{removable:!0},{mineable:t.tree,unmergeable:!0,createPrize:{exp:10,coins:5}}]}},DishesFamily=function(){return{type:"dish",units:Recipes.map(function(e,t){return{dish:e.code,recipe:e,bubble:!0,unmergeable:!0}})}},HeroFamily=function(s){for(var e=[void 0,{exp:1,coins:1},{exp:2,coins:1},{exp:3,coins:1},{exp:5,coins:2},{exp:10,coins:3},{exp:25,coins:5},{exp:40,coins:5},{exp:50,coins:5},{exp:70,coins:7},{exp:100,coins:7},{exp:120,coins:8},{exp:150,coins:10}],t=cleverapps.arrayFill(s).map(function(e,t){return t===s-1?{makesorder:!0,unmergeable:!0}:{heroitem:!0}}),i=0;i<t.length-1;i++)t[i].createPrize=e[i];return{type:"hero",units:t}},
MagicPlantFamily=function(e){for(var t=[0,1,2,3,5,10,15,25,150],s=[0,0,1,2,3,5,10,15,20],i=[],n=0;n<e;++n){var o={};(t[n]||s[n])&&(o.createPrize={exp:t[n],coins:s[n]}),n===e-1&&(o.magicplant={listPrize:[{code:"crystal",stage:3}],timeout:"24 hours"},o.unmergeable=!0),4<n&&(o.shine=!0),i.push(o)}return{type:"magicplant",units:i}},RubiesPlantFamily=function(e){for(var t=[0,50,200],s=[0,10,30],i=[],n=0;n<e;++n){var o={magicplant:{listPrize:[{code:"rubies",stage:n}],timeout:"6 hours"},shine:!0};(t[n]||s[n])&&(o.createPrize={exp:t[n],coins:s[n]}),i.push(o)}return{type:"rubiesplant",units:i}},CoinsPlantFamily=function(e){for(var t=[0,50,200],s=[0,10,30],i=[],n=0;n<e;++n){var o={magicplant:{listPrize:[{code:"coins",stage:n+1}],timeout:"6 hours"},shine:!0};(t[n]||s[n])&&(o.createPrize={exp:t[n],coins:s[n]}),i.push(o)}return{type:"coinsplant",units:i}},EnergyPlantFamily=function(e){for(var t=[0,50,200],s=[0,10,30],i=[3,10,35],n=[1,3,5],o=[],r=0;r<e;++r){var a={magicplant:{listPrize:{resource:!0,
type:"energy",amount:i[r],flyAmount:n[r],infoViewImage:bundles.flying.frames.flying_energy_png},timeout:"6 hours"},shine:!0};(t[r]||s[r])&&(a.createPrize={exp:t[r],coins:s[r]}),o.push(a)}return{type:"energyplant",units:o}},SpecialUnitFamily=function(e){return{units:[e]}},DecoratorFamily=function(){var e=[{multicell:ShapeTopRightCorner}];return e.forEach(function(e){e.unmergeable=!0}),{type:"decorator",units:e}},Families={};Families.wood=ResourceFamily(9,"wood"),Families.stone=ResourceFamily(10,"stone"),Families.wagon=ResourceFamily(10,"wagon"),Families.bamboo=ResourceFamily(10,"bamboo"),Families.sapphire=ResourceFamily(11,"sapphire"),Families.wheat=FruitFamily(),Families.candies=FruitFamily(),Families.apple=FruitFamily(),Families.strawberry=FruitFamily(),Families.mushrooms=FruitFamily(),Families.corn=FruitFamily(),Families.treasure=ChestFamily("treasure"),Families.herochest=ChestFamily("herochest"),Families.freechest=ChestFamily("freechest"),Families.sacks=ChestFamily("sacks"),
Families.coinsplantchest=ChestFamily("coinsplantchest"),Families.rubiesplantchest=ChestFamily("rubiesplantchest"),Families.energyplantchest=ChestFamily("energyplantchest"),Families.woodchest=ChestFamily("woodchest"),Families.stonechest=ChestFamily("stonechest"),Families.wagonchest=ChestFamily("wagonchest"),Families.bamboochest=ChestFamily("bamboochest"),Families.sapphirechest=ChestFamily("sapphirechest"),Families.wands=ValuableFamily("wands",{amounts:[5,15,45,135,405,1215],exp:[0,1,3,5,7,10]}),Families.coins=ValuableFamily("coins",{amounts:[0,1,3,10,30,90,270,810],exp:[0,1,2,3,5,7,9,15],shineFrom:4}),Families.rubies=ValuableFamily("rubies",{amounts:[0,2,6,20,60,180],exp:[0,1,1,2,3,10],shineFrom:2}),Families.worker=CustomFamily(5,"custom",{instantWorker:!0}),Families.crystal=CustomFamily(4,"custom",{shine:!0,crystal:!0}),Families.woodsource=SourceFamily("wood"),Families.stonesource=SourceFamily("stone"),Families.wagonsource=SourceFamily("wagon"),Families.bamboosource=SourceFamily(
"bamboo"),Families.sapphiresource=SourceFamily("sapphire"),Families.woodgenerator=GeneratorFamily("wood"),Families.stonegenerator=GeneratorFamily("stone"),Families.wagongenerator=GeneratorFamily("wagon"),Families.bamboogenerator=GeneratorFamily("bamboo"),Families.sapphiregenerator=GeneratorFamily("sapphire"),Families.dishes=DishesFamily(),Families.dwarf=HeroFamily(2),Families.king=HeroFamily(4),Families.bear=HeroFamily(7),Families.elf=HeroFamily(8),Families.warlock=HeroFamily(9),Families.troll=HeroFamily(10),Families.knight=HeroFamily(11),Families.multiCellBody=SpecialUnitFamily({multiCellBody:!0}),Families.specialoffer=SpecialUnitFamily({unmergeable:!0,specialoffer:!0}),Families.dragonmine=SpecialUnitFamily({minigame:"minesweeper",unmergeable:!0,multicell:ShapeSquare,important:!0}),Families.decorator=DecoratorFamily(),Families.magicplant=MagicPlantFamily(9),Families.rubiesplant=RubiesPlantFamily(3),Families.coinsplant=CoinsPlantFamily(3),Families.energyplant=EnergyPlantFamily(3),
function(){for(var e in Families)Families[e].code=e}();var SourceMine={chestPrizes:{stump:function(e){var t=[{code:e.getResource()+"chest",stage:0}];return e.isGrounded()||t.push({code:e.getResource()+"source",stage:2}),t},sapling:function(e){var t=[{code:e.getResource()+"chest",stage:1}];return e.isGrounded()||t.push({code:e.getResource()+"source",stage:4}),t},tree:function(e){return[{code:e.getResource()+"chest",stage:2}]}},defaults:function(e,t){switch(e){case 0:return Mines.Times(2,{code:t.getResource(),stage:0}).concat(Mines.HeroItem(.25,1));case 1:return Mines.Probability(4,[.02,.25,.5,1],[{code:"worker",stage:0},{type:"resource",stage:0},{code:t.getResource(),stage:0},{code:t.getResource(),stage:1}]).concat(Mines.HeroItem(.35,1));case 2:return Mines.Probability(4,[.13,.13,.15,.25,1],[{code:"worker",stage:0},{code:"coins",stage:0},{type:"resource",stage:0},{code:t.getResource(),stage:0},{code:t.getResource(),stage:1}]).concat(Mines.HeroItem(.4,1));case 3:return Mines.Probability(
5,[.1,.1,.15,.25,1],[{code:"worker",stage:0},{code:"coins",stage:0},{type:"resource",stage:0},{code:t.getResource(),stage:0},{code:t.getResource(),stage:1}]).concat(Mines.Maybe(.1,{type:"fruit",stage:0})).concat(Mines.HeroItem(.5,2));case 4:return Mines.Probability(6,[.06,.1,.25,.16,1],[{code:"worker",stage:0},{code:"crystal",stage:0},{code:"coins",stage:0},{type:"resource",stage:0},{code:t.getResource(),stage:1}]).concat(Mines.Maybe(.25,{type:"fruit",stage:0})).concat(Mines.HeroItem(.7,2))}},stump:function(e,t){return e===t.getData().mineable.length-1?SourceMine.chestPrizes.stump(t):SourceMine.defaults(e,t)},sapling:function(e,t){return e===t.getData().mineable.length-1?SourceMine.chestPrizes.sapling(t):SourceMine.defaults(e,t)},tree:function(e,t){return e===t.getData().mineable.length-1?SourceMine.chestPrizes.tree(t):SourceMine.defaults(e,t)}},FruitMine=function(e,t){return Mines.Probability(5,[.166,.166,1],[{code:t.code,stage:1},{code:"coins",stage:0},{code:t.code,stage:0}])},
GeneratorSourceMine={level1:function(e,t){var s=Mines.Probability(3,[.75,.25],[{code:t.getResource()+"source",stage:0},{code:t.getResource(),stage:0}]);return e===t.getData().mineable.length-1&&(s=s.concat([{code:"coins",stage:0},{code:"coins",stage:0},{code:"coins",stage:0},{code:"rubies",stage:0}])),s},level2:function(e,t){var s=Mines.Probability(4,[.35,.35,.15,.15],[{code:t.getResource()+"source",stage:0},{code:t.getResource()+"source",stage:2},{code:t.getResource(),stage:0},{code:t.getResource(),stage:1}]);return e===t.getData().mineable.length-1&&(s=s.concat([{code:"coins",stage:0},{code:"coins",stage:0},{code:"coins",stage:0},{code:"coins",stage:0},{code:"rubies",stage:0}])),s},level3:function(e,t){var s=Mines.Probability(5,[.2,.3,.3,.1,.1],[{code:t.getResource()+"source",stage:0},{code:t.getResource()+"source",stage:2},{code:t.getResource()+"source",stage:4},{code:t.getResource(),stage:0},{code:t.getResource(),stage:1}]);return e===t.getData().mineable.length-1&&(s=s.concat([{
code:"coins",stage:1},{code:"coins",stage:1},{code:"rubies",stage:0}])),s}},Mines={fruit:{5:FruitMine},source:{1:SourceMine.stump,3:SourceMine.sapling,5:SourceMine.tree},generator:[GeneratorSourceMine.level1,GeneratorSourceMine.level2,GeneratorSourceMine.level3],HeroItem:function(e,t){if(cleverapps.Random.nextDouble()<e){var s=Math.floor(cleverapps.Random.nextDouble()*t),i=Game.currentGame.unitsLibrary.getNextHero();if(i&&s<Families[i].units.length-1&&3<=Game.currentGame.gameLevel.getLevel())return[{code:i,stage:s}]}return[]},Maybe:function(e,t){return cleverapps.Random.nextDouble()<e?[t]:[]},Times:function(e,t){for(var s=[],i=0;i<e;i++)s.push({code:t.code,stage:t.stage});return s},Probability:function(e,t,s){t[t.length-1]=100;for(var i=[],n=0;n<e;n++)for(var o=cleverapps.Random.nextDouble(),r=0;r<t.length;r++)if((o-=t[r])<0){i.push({unit:cleverapps.clone(s[r]),probability:t[r]});break}return i.sort(function(e,t){return e.probability-t.probability}),i.map(function(e){return e.unit})}},
Buildable=function(e,t){this.unit=e,this.load(t),this.onCompletion=function(){},this.onHighlight=function(){},this.onUnhighlight=function(){},this.onHideDetails=function(){},this.onShowDetails=function(){},e.onInfoOpened=function(){this.onHideDetails()}.bind(this),e.onInfoClosed=function(e){e||this.onShowDetails()}.bind(this)};Buildable.IsBuilt=function(e){var t=e.findComponent(Buildable);return!t||t.isCompleted()},Buildable.STATES={WAIT:0,FINISHED:1},Buildable.prototype.isCompleted=function(){return this.state===Buildable.STATES.FINISHED},Buildable.prototype.load=function(e){void 0!==e.time?(this.time=e.time,this.state=Buildable.STATES.WAIT):(this.time=cleverapps.parseInterval(this.unit.getData().buildable),this.state=0===this.time?Buildable.STATES.FINISHED:Buildable.STATES.WAIT)},Buildable.prototype.save=function(e){this.isCompleted()||(e.time=this.time,e.unbuilt=!0)},Buildable.prototype.getInfo=function(){if(!Game.currentGame.workers.findInstantAssigned(this
)&&this.state===Buildable.STATES.WAIT)return{title:"messages:Buildable.info.title",duration:this.time,actions:{build:this.startBuilding.bind(this),instant:Game.currentGame.workers.hasInstant()&&this.assignInstantWorker.bind(this)}}},Buildable.prototype.getTask=function(){return{time:this.time}},Buildable.prototype.assignInstantWorker=function(){var e=Game.currentGame.workers.listInstantFree()[0];e?e.buildInstantly(this):console.log("No instant")},Buildable.prototype.startBuilding=function(){var e,t=Game.currentGame.workers.findFree();t||Game.currentGame.workersBusyHint(),t&&t.assign(this.unit,this.time)&&(Game.currentGame.gameEvent(Merge.START_BUILDING,{affected:this.unit}),e=!0),e||this.onShowDetails()},Buildable.prototype.completeBuilding=function(e){var t=this.time-e;if(0<t)this.time=t,this.state=Buildable.STATES.WAIT;else{this.time=0,this.state=Buildable.STATES.FINISHED,this.onCompletion(),this.unit.onCreatePrize(),Game.currentGame.gameEvent(Merge.BUILD,{affected:this.unit})
;var s=this.unit.findComponent(Castle);s&&s.buildingComplete();var i=this.unit.findComponent(Upgradable);i&&i.buildingComplete();var n=this.unit.findComponent(Pulsing);n&&n.init(),Game.currentGame.onUnitAvailable(this.unit);var o=cleverapps.missionManager.findByType(Mission.TYPE_BATTLEPASS);o&&o.isRunning()&&!o.battlePass.isAllTasksCompleted()&&2<=this.unit.stage&&this.unit.setPoints(Buildable.POINTS[Math.min(this.unit.stage,Buildable.POINTS.length-1)])}this.unit.save(),this.onShowDetails()},Buildable.POINTS=[0,0,5,10,20,60,300,600,2e3,2500,3e3,4e3];var Mineable=function(e,t){this.unit=e,this.mined=t.mined||0,this.state=t.state||Mineable.STATES.WAIT,this.onMoveNext=function(){},e.onPrizeHarvested=this.nextPosition.bind(this),this.isCompleted()?this.removeUponCompletion():this.state===Mineable.STATES.FINISHED&&this.unit.setPrizes(this.listPrize(),this.getTask().exp),this.onHideDetails=function(){},this.onShowDetails=function(){},e.onInfoOpened=function(){this.onHideDetails()}.bind(this)
,e.onInfoClosed=function(e){e||(this.onShowDetails(),cleverapps.lives.canTake(this.getTask().energy)||(cleverapps.lives.needShowSpecialOffer=!0),Game.currentGame&&Game.currentGame.counter.trigger())}.bind(this)};Mineable.STATES={WAIT:0,FINISHED:1},Mineable.prototype.save=function(e){e.mined=this.mined,e.state=this.state},Mineable.prototype.listPrize=function(){var e=this.unit.findComponent(Generator);return this.unit.seedRandom(this.mined+(e?10*e.changedLevels:0)),Mines[this.unit.getType()][this.unit.stage](this.mined,this.unit).map(function(e){if(e instanceof Unit)return e;if(e.type){var t=Game.currentGame.listAvailableByType(e.type);return new Unit(Game.currentGame.decreasePrizeStageIfNeeded({code:cleverapps.Random.choose(t),stage:e.stage}))}return new Unit(Game.currentGame.decreasePrizeStageIfNeeded(e))})},Mineable.prototype.getTask=function(){return this.unit.getData().mineable[this.mined]},Mineable.prototype.startMine=function(){var e=Game.currentGame,t=e.workers.findFree()
;t||e.workersBusyHint();var s,i=this.getTask();if(t&&e.useEnergy(i.energy,this.unit)){e.gameEvent(Merge.START_MINING,{unit:this.unit});var n=cleverapps.parseInterval(i.time);s=t.assign(this.unit,n)}s||this.onShowDetails()},Mineable.prototype.completeMining=function(){this.state=Mineable.STATES.FINISHED,this.unit.save(),Game.currentGame.gameEvent(Merge.COMPLETE_MINING,{unit:this.unit}),this.unit.setPrizes(this.listPrize(),this.getTask().exp)},Mineable.prototype.isCompleted=function(){return this.mined>=this.unit.getData().mineable.length},Mineable.prototype.removeUponCompletion=function(){this.unit.movable=!1,this.timeout=setTimeout(function(){delete this.timeout,delete this.unit.movable;var e=this.unit.findComponent(Generator);e?e.gotoNextLevel():(this.unit.onDestruction(),this.unit.remove(!0),Game.currentGame.fogs.updateBlockedGrounds())}.bind(this),1e3)},Mineable.prototype.nextPosition=function(){this.mined++,this.onMoveNext(),this.onShowDetails(),this.isCompleted()?(
Game.currentGame.gameEvent(Merge.MINE,{affected:this.unit}),this.removeUponCompletion()):this.state=Mineable.STATES.WAIT,this.unit.save()},Mineable.prototype.clear=function(){this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},Mineable.prototype.getInfo=function(){if(this.state===Mineable.STATES.WAIT)return{title:this.unit,progress:{value:this.mined,total:this.unit.getData().mineable.length},duration:cleverapps.parseInterval(this.getTask().time),actions:{energy:{action:this.startMine.bind(this),energy:this.getTask().energy}}}};var MiniGame=function(e,t){this.unit=e,this.sinceLastHarvest=void 0,this.harvestDuration=cleverapps.parseInterval(MiniGame.HARVEST_INTERVAL),this.onCompleteWait=function(){},this.onStartWait=function(){},e.onPrizeHarvested=this.restartHarvest.bind(this),this.sinceLastHarvest=t.sinceLastHarvest,this.isPrizeReady()?(this.sinceLastHarvest=void 0,this.unit.setPrizes(this.getMiniGamePrize())):this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this
),this.timeToReady())};MiniGame.prototype.getMiniGamePrize=function(){return{minigame:!0}},MiniGame.prototype.isPrizeReady=function(){return void 0===this.sinceLastHarvest||0===this.timeToReady()},MiniGame.prototype.save=function(e){e.sinceLastHarvest=this.sinceLastHarvest},MiniGame.prototype.getInfo=function(){return{title:this.unit,countdown:this.timeToReady(),actions:{speedup:{unit:this.unit,action:this.makeReady.bind(this),duration:this.timeToReady()}}}},MiniGame.prototype.clear=function(){clearTimeout(this.timeout)},MiniGame.prototype.restartHarvest=function(){this.sinceLastHarvest=Date.now(),clearTimeout(this.timeout),this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.timeToReady()),this.unit.save(),this.onStartWait(),Game.currentGame.pushes.updateMiniGames()},MiniGame.prototype.makeReady=function(){clearTimeout(this.timeout),this.sinceLastHarvest=void 0,this.unit.setPrizes(this.getMiniGamePrize()),this.unit.save(),this.onCompleteWait(),
Game.currentGame.pushes.updateMiniGames()},MiniGame.prototype.timeToReady=function(){return Math.max(0,this.sinceLastHarvest+this.harvestDuration-Date.now())},MiniGame.HARVEST_INTERVAL="6 hours";var MultiCell=function(e){this.unit=e,this.shape=e.getData().multicell,this.bodyUnits=this.shape.map(function(){var e=new Unit({code:"multiCellBody",stage:0});return e.head=this.unit,e},this)};MultiCell.prototype.getCenter=function(){for(var e=0,t=0,s=0;s<this.shape.length;s++)e+=this.shape[s].x+this.shape[s].y,t+=this.shape[s].x-this.shape[s].y;return e/=this.shape.length,t/=this.shape.length,{x:cleverapps.styles.Map2dView.cell.width*e/2,y:cleverapps.styles.Map2dView.cell.height*t/2}},MultiCell.prototype.restore=function(){for(var e,t,s,i,n=Game.currentGame.map,o=0;o<this.shape.length;o++)if((this.shape[o].x||this.shape[o].y)&&(s=this.unit.x+this.shape[o].x,i=this.unit.y+this.shape[o].y,(e=this.bodyUnits[o])!==(t=n.getUnit(s,i)))){if(t){var r=n.findEmptySlot(s,i);r&&(t.move(r.x,r.y),t=void 0)}
t||(e.setPosition(s,i),n.add(Map2d.LAYER_UNITS,e.x,e.y,e),cleverapps.eventLogger.logEvent("restore_multicellbody"))}},MultiCell.prototype.remove=function(){for(var e,t=0;t<this.shape.length;t++)void 0!==(e=this.bodyUnits[t]).x&&void 0!==e.y&&e.remove()},MultiCell.prototype.occupite=function(){for(var e,t,s,i,n=Game.currentGame.map,o=0;o<this.shape.length;o++)(this.shape[o].x||this.shape[o].y)&&(e=this.unit.x+this.shape[o].x,t=this.unit.y+this.shape[o].y,s=n.getUnit(e,t),i=this.bodyUnits[o],s&&s!==i||(i.setPosition(e,t),n.add(Map2d.LAYER_UNITS,i.x,i.y,i)))};var Fruit=function(e,t){this.unit=e,this.harvested=t.harvested||0,this.harvestDuration=cleverapps.parseInterval(Fruit.HARVEST_DURATION_PER_CODE[this.unit.code]),this.onStartGrowth=function(){},this.onCompleteGrowth=function(){},e.onPrizeHarvested=this.restartGrowth.bind(this),this.sinceLastHarvest=t.sinceLastHarvest,void 0!==this.sinceLastHarvest&&this.timeToReady()?this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),
this.timeToReady()):(this.unit.setPrizes(this.listPrize(),Fruit.HARVESTED_EXP),this.sinceLastHarvest=void 0)};Fruit.HARVESTED_EXP=3,Fruit.MAX_HARVESTED=3,Fruit.HARVEST_DURATION_PER_CODE={candies:"4 hour",wheat:"3 hour",apple:"5 hour",strawberry:"3 hour",mushrooms:"4 hour",corn:"5 hour"},Fruit.prototype.save=function(e){e.harvested=this.harvested,e.sinceLastHarvest=this.sinceLastHarvest},Fruit.prototype.clear=function(){clearTimeout(this.timeout)},Fruit.prototype.getInfo=function(){return{title:{code:this.unit.code,stage:4,icon:!0},progress:{value:this.harvested,total:Fruit.MAX_HARVESTED},countdown:this.timeToReady(),actions:{speedup:{unit:this.unit,action:this.makeReady.bind(this),duration:this.timeToReady()}}}},Fruit.prototype.timeToReady=function(){return Math.max(0,this.sinceLastHarvest+this.harvestDuration-Date.now())},Fruit.prototype.listPrize=function(){this.unit.seedRandom(this.harvested);for(var e=cleverapps.Random.choose([4,5,6]),t=[],s=0;s<e;s++)t.push(new Unit({
code:this.unit.code,stage:4}));return 6<=Game.currentGame.gameLevel.getLevel()&&cleverapps.Random.random(0,1)<1&&t.push(new Unit({code:"magicplant",stage:0})),t},Fruit.prototype.restartGrowth=function(){if(this.harvested++,this.sinceLastHarvest=Date.now(),this.unit.save(),clearTimeout(this.timeout),this.harvested===Fruit.MAX_HARVESTED){this.unit.remove();var e=new Unit({code:this.unit.code,stage:5});e.setPosition(this.unit.x,this.unit.y),Game.currentGame.map.add(Map2d.LAYER_UNITS,e.x,e.y,e),Game.currentGame.map.onAdd(Map2d.LAYER_UNITS,e.x,e.y,e),Game.currentGame.onUnitAvailable(e)}else this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.timeToReady()),this.onStartGrowth();Game.currentGame.pushes.updateFruits()},Fruit.prototype.isGrowing=function(){return void 0!==this.sinceLastHarvest&&0<this.timeToReady()},Fruit.prototype.makeReady=function(){clearTimeout(this.timeout),this.sinceLastHarvest=void 0,this.unit.save(),this.unit.setPrizes(this.listPrize(),
Fruit.HARVESTED_EXP),this.onCompleteGrowth(),Game.currentGame.pushes.updateFruits()};var Upgradable=function(e,t){var s=(this.unit=e).getData().upgradable;this.level=void 0!==t.level?t.level:s.level,this.progress=void 0!==t.progress?t.progress:0,this.stages=s.stages,this.collectedStage=s.collectedStage,this.moveToNextStageOnUpgrade=s.moveToNextStageOnUpgrade,this.changeImageStages=s.changeImageStages,this.onBuild=function(){},this.onUpdateLevel=function(){},this.onChangeProgress=function(){},this.highlightCollect=function(){},this.unhighlightCollect=function(){},this.onStartUpdateLevel=function(){},this.beforeChangeUnit=function(){},this.progress>=this.stages&&setTimeout(this.moveToNextLevel.bind(this),0)};Upgradable.prototype.save=function(e){e.progress=this.progress,e.level=this.level},Upgradable.prototype.getProgressAnimation=function(){if(!this.changeImageStages||this.progress<this.changeImageStages[0])return"animation";for(
var e=0;e<this.changeImageStages.length&&this.progress>=this.changeImageStages[e];)e++;return"animation"+(e+1)},Upgradable.prototype.canCollectStage=function(e){return Buildable.IsBuilt(this.unit)?e===this.collectedStage&&this.progress<this.stages:(Game.currentGame.onHintMessage(Messages.get("cantCollectBuilding",{target:Messages.get("Units."+this.unit.code+".stage"+this.unit.stage+".name")})),!1)},Upgradable.prototype.buildingComplete=function(){this.buildingCompleteTimeout=setTimeout(function(){delete this.buildingCompleteTimeout,this.onBuild()}.bind(this),1500)},Upgradable.prototype.clear=function(){this.buildingCompleteTimeout&&(clearTimeout(this.buildingCompleteTimeout),delete this.buildingCompleteTimeout),this.moveToNextLevelTimeout&&(clearTimeout(this.moveToNextLevelTimeout),delete this.moveToNextLevelTimeout),this.incProgressTimeout&&(clearTimeout(this.incProgressTimeout),delete this.incProgressTimeout)},Upgradable.prototype.moveToNextLevel=function(){if(
this.moveToNextStageOnUpgrade){this.beforeChangeUnit();var e=new Unit({code:this.unit.code,stage:this.unit.stage+1,unbuilt:!0});if(this.unit.remove(),e.setPosition(this.unit.x,this.unit.y),Game.currentGame.map.add(Map2d.LAYER_UNITS,e.x,e.y,e),Game.currentGame.map.onAdd(Map2d.LAYER_UNITS,e.x,e.y,e),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.skipBuildingStage){var t=e.findComponent(Buildable);t.onHideDetails(),setTimeout(function(){t.completeBuilding(t.time)},200)}}else this.level++,this.progress=0,this.onUpdateLevel(),this.onChangeProgress(!0),this.unit.save()},Upgradable.prototype.incProgress=function(e){this.progress++,this.unit.save(),this.incProgressTimeout=setTimeout(function(e){delete this.incProgressTimeout,this.onChangeProgress(),e===this.stages&&(this.onStartUpdateLevel(),this.moveToNextLevelTimeout=setTimeout(function(){delete this.moveToNextLevelTimeout,this.moveToNextLevel()}.bind(this),500))}.bind(this,this.progress),e)},
Upgradable.prototype.handleClick=function(){var t=this.unit,s=t.getFamily();if("resource"===s.type&&t.stage===s.units.length-2&&!cleverapps.metha.isFocused())return cleverapps.metha.display({focus:"CastleWindow",action:function(e){new CastleGuideWindow({code:t.code,stage:s.units.length-1}),cleverapps.metha.onceNoWindowsListener=e}}),!0};var Castle=function(e,t){if(this.unit=e,this.harvested=t.harvested||0,this.builded=!1,this.sinceLastHarvest=void 0,this.harvestDuration=cleverapps.parseInterval("24 hour"),this.onBuildCastle=function(){},this.onCompleteWait=function(){},this.onStartWait=function(){},e.onPrizeHarvested=this.restartHarvest.bind(this),Buildable.IsBuilt(this.unit))if(this.builded=!0,this.sinceLastHarvest=t.sinceLastHarvest,this.isCreatingPrize())this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.timeToReady());else{var s=this.listPrize().map(function(e){return new Unit(e)});this.unit.setPrizes(s,Castle.HARVESTED_EXP),this.sinceLastHarvest=void 0}}
;Castle.prototype.isCreatingPrize=function(){return void 0!==this.sinceLastHarvest&&0<this.timeToReady()},Castle.prototype.save=function(e){e.sinceLastHarvest=this.sinceLastHarvest,e.harvested=this.harvested},Castle.prototype.getInfo=function(){if(this.builded)return{title:this.unit,countdown:this.timeToReady(),actions:{speedup:{unit:this.unit,action:this.makeReady.bind(this),duration:this.timeToReady()}}}},Castle.prototype.clear=function(){clearTimeout(this.timeout)},Castle.prototype.listPrize=function(){return CastleListPrize(this)},Castle.prototype.restartHarvest=function(){this.sinceLastHarvest=Date.now(),this.harvested++,clearTimeout(this.timeout),this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.timeToReady()),this.unit.save(),this.onStartWait(),Game.currentGame.pushes.updateCastles()},Castle.prototype.makeReady=function(){clearTimeout(this.timeout);var e=this.listPrize().map(function(e){return new Unit(e)});this.unit.setPrizes(e,Castle.HARVESTED_EXP),
this.sinceLastHarvest=void 0,this.unit.save(),this.onCompleteWait(),Game.currentGame.pushes.updateCastles()},Castle.prototype.timeToReady=function(){return Math.max(0,this.sinceLastHarvest+this.harvestDuration-Date.now())},Castle.prototype.buildingComplete=function(){var e=3500;cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.skipBuildingStage&&(e=2e3),Game.currentGame.counter.setTimeout(function(){this.builded=!0,this.onBuildCastle(),this.makeReady()}.bind(this),e)},Castle.HARVESTED_EXP=50;var Crystal=function(e){this.unit=e};Crystal.prototype.getInfo=function(){return{title:Game.currentGame.unitsLibrary.getUnitName(this.unit),guide:{class:CrystalGuideWindow,unit:this.unit}}};var HeroItem=function(e){this.unit=e};HeroItem.prototype.getInfo=function(){if(!(cleverapps.metha.isFocused()||Game.currentGame.gameLevel.getLevel()<3))return{title:Game.currentGame.unitsLibrary.getUnitName(this.unit),guide:{class:UnitsLibraryWindow,unit:this.unit}}};var SpecialOffer=function(e,t){
this.unit=e,this.prize=new Unit({code:t.prize.code,stage:t.prize.stage}),this.timeStart=Date.now(),this.timeout=new cleverapps.LongTimeout(this.pass.bind(this),cleverapps.parseInterval(SpecialOffer.DURATION)),cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.SPECIAL_OFFER_LAST_TIME,this.timeStart),this.onAppearance=function(){},this.onDestruction=function(){},this.onBuying=function(){},cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SPECIAL_OFFER_COUNT)};SpecialOffer.IsAvailable=function(e){if(cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.skipSpecialOffer)return!1;if(e.stage<6)return!1;if(cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.SPECIAL_OFFER_LAST_TIME)+cleverapps.parseInterval(SpecialOffer.TIMEOUT)>Date.now())return!1;var t=Families[e.code];return"resource"===t.type?e.stage>=t.units.length-4&&e.stage<t.units.length-2:"hero"===t.type&&(e.stage>=t.units.length-3&&e.stage<t.units.length-1)},SpecialOffer.CreateOffer=function(e){var t=Game.currentGame,s=t.map,
i=s.findEmptySlot(e.x,e.y);if(i){var n=new Unit({code:"specialoffer",stage:0,prize:e});n.setPosition(i.x,i.y),s.add(Map2d.LAYER_UNITS,i.x,i.y,n),t.counter.setTimeout(function(){s.onAdd(Map2d.LAYER_UNITS,n.x,n.y,n),n.findComponent(SpecialOffer).onAppearance()}.bind(this),1e3)}},SpecialOffer.prototype.clear=function(){clearTimeout(this.timeout)},SpecialOffer.prototype.getTimeLeft=function(){return Math.max(0,this.timeStart+cleverapps.parseInterval(SpecialOffer.DURATION)-Date.now())},SpecialOffer.prototype.getPrice=function(){return Math.max(300,300+200*(this.prize.stage-6))},SpecialOffer.prototype.handleClick=function(){cleverapps.metha.display({focus:"specialOfferWindow",actions:[function(e){setTimeout(e,300)},function(e){new SpecialOfferWindow(this),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},SpecialOffer.prototype.buy=function(){if(this.getTimeLeft()&&cleverapps.user.takeGold(this.getPrice())){var e=Game.currentGame.map,t=this.unit,s=this.prize;return t.remove(!0),
s.setPosition(t.x,t.y),e.add(Map2d.LAYER_UNITS,s.x,s.y,s),e.onAdd(Map2d.LAYER_UNITS,s.x,s.y,s),this.onBuying(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SPECIAL_OFFER_BUY),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.SPECIAL_OFFER_RUBY,{amount:this.getPrice()}),!0}return!1},SpecialOffer.prototype.pass=function(){this.onDestruction(),this.unit.onDestruction(),this.unit.remove(!0)},SpecialOffer.TIMEOUT="24 hours",SpecialOffer.DURATION="5 minutes",cleverapps.config.debugMode&&(SpecialOffer.TIMEOUT="10 seconds",SpecialOffer.DURATION="30 seconds");var MagicPlant=function(e,t){this.unit=e,this.lastHarvested=t.lastHarvested||0;var s=e.getData();this.prizes=s.magicplant.listPrize,this.growTime=s.magicplant.timeout,e.onPrizeHarvested=this.restartGrowth.bind(this),this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.getTimeLeft()),this.onStartGrowth=function(){},this.onCompleteGrowth=function(){}};MagicPlant.prototype.save=function(e){
e.lastHarvested=this.lastHarvested},MagicPlant.prototype.clear=function(){clearTimeout(this.timeout)},MagicPlant.prototype.restartGrowth=function(){clearTimeout(this.timeout),this.lastHarvested=Date.now(),this.timeout=new cleverapps.LongTimeout(this.makeReady.bind(this),this.getTimeLeft()),this.unit.save(),this.onStartGrowth(),Game.currentGame.pushes.updateMagicPlants()},MagicPlant.prototype.isGrowing=function(){return 0<this.getTimeLeft()},MagicPlant.prototype.makeReady=function(){clearTimeout(this.timeout);var e=this.listPrize();e.resource||(e=e.map(function(e){return new Unit(e)})),this.lastHarvested=void 0,this.unit.setPrizes(e,MagicPlant.HARVESTED_EXP),this.unit.save(),this.onCompleteGrowth(),Game.currentGame.pushes.updateMagicPlants()},MagicPlant.prototype.getTimeLeft=function(){return Math.max(0,this.lastHarvested+cleverapps.parseInterval(this.growTime)-Date.now())},MagicPlant.prototype.listPrize=function(){return this.prizes},MagicPlant.prototype.getInfo=function(){return{
title:this.unit,countdown:this.getTimeLeft(),actions:{speedup:{unit:this.unit,action:this.makeReady.bind(this),duration:this.getTimeLeft()}}}},MagicPlant.HARVESTED_EXP=10;var ComponentsFactory=function(e,t,s){s.grounded&&e.push(new Grounded(t));var i=t.getData();i.chest&&e.push(new Chest(t)),i.fruit&&e.push(new Fruit(t,s)),i.pulsing&&e.push(new Pulsing(t)),i.bubble&&e.push(new Bubble(t)),i.collectible&&e.push(new Collectible(t)),i.divideCollectible&&e.push(new DivideCollectible(t)),i.resourceCollectible&&e.push(new ResourceCollectible(t)),i.shine&&e.push(new Shine),i.dish&&e.push(new Dish(t)),i.makesorder&&e.push(new MakesOrder(t,s)),i.mineable&&e.push(new Mineable(t,s)),i.instantWorker&&e.push(new InstantWorker(t,s)),i.buildable&&s.unbuilt&&e.push(new Buildable(t,s)),i.generator&&e.push(new Generator(t,s)),i.upgradable&&e.push(new Upgradable(t,s)),i.castle&&e.push(new Castle(t,s)),i.multicell&&e.push(new MultiCell(t)),i.crystal&&e.push(new Crystal(t)),i.heroitem&&e.push(new HeroItem(t
)),i.specialoffer&&e.push(new SpecialOffer(t,s)),i.magicplant&&e.push(new MagicPlant(t,s)),i.minigame&&e.push(new MiniGame(t,s))},Unit=function(e){this.code=e.code,this.stage=e.stage,this.checkTouchInside=function(){},this.onClickEvent=function(){},this.onDragStart=function(){},this.onDragMove=function(){},this.onDragEnd=function(){},this.onAdd=function(){},this.onRemove=function(){},this.onDestruction=function(){},this.onMove=function(){},this.onMerge=function(){},this.onStartAnimateMerge=function(){},this.onStopAnimateMerge=function(){},this.onSqueeze=function(){},this.onSpawned=function(){},this.onFogOpen=function(){},this.onDidMerged=function(){},this.onMarkError=function(){},this.onMarkNormal=function(){},this.onInfoOpened=function(){},this.onInfoClosed=function(){},this.onChangePrizes=function(){},this.onPrizeHarvested=function(){},this.onGetView=function(){},this.onShowPoints=function(){},this.onHidePoints=function(){},this.onClaimPoints=function(){},this.load(e),
this.components=[],ComponentsFactory(this.components,this,e)};Unit.prototype.getResource=function(){return Families[this.code].resource},Unit.prototype.getType=function(){return Families[this.code].type},Unit.prototype.onTouchBeginEvent=function(){if(this.claimPoints())return Game.currentGame.userStatus.reportUserAction(),!0;for(var e=0;e<this.components.length;e++){var t=this.components[e];if(t.handleTouchBegin&&t.handleTouchBegin())return Game.currentGame.userStatus.reportUserAction(),!0}return!1},Unit.prototype.getData=function(){return Families[this.code].units[this.stage]},Unit.prototype.saveRemoval=function(){cleverapps.config.adminMode||cleverapps.unitSaver.remove(this.x,this.y)},Unit.prototype.load=function(e){if(e.points){var t=cleverapps.missionManager.findByType(Mission.TYPE_BATTLEPASS);t&&t.isRunning()&&(this.points=e.points)}},Unit.prototype.save=function(){if(!(cleverapps.config.adminMode||cleverapps.config.editorMode||cleverapps.config.wysiwygMode
)&&Game.currentGame.initialized&&this.isPersistent()&&"decorator"!==this.code&&void 0!==this.x&&void 0!==this.y){var t={stage:this.stage,code:this.code};this.points&&cleverapps.missionManager.findByType(Mission.TYPE_BATTLEPASS)&&(t.points=this.points),this.components.forEach(function(e){e.save&&e.save(t)}),cleverapps.unitSaver.update(this.x,this.y,t)}},Unit.prototype.clear=function(){this.components.forEach(function(e){e.clear&&e.clear()}),this.light&&this.light.clear()},Unit.prototype.isPersistent=function(){return"multiCellBody"!==this.code&&"specialoffer"!==this.code&&this.code&&void 0!==this.stage},Unit.prototype.getKey=function(){return Unit.GetKey(this)},Unit.GetKey=function(e){return e.code+"_"+e.stage},Unit.GetPositionKey=function(e){return e.x+"_"+e.y},Unit.ParseKey=function(e){if(2===(e=e.split("_")).length)return{code:e[0],stage:cleverapps.castType(e[1])}},Unit.findUnit=function(e,t){t=t||{};for(var s=0;s<e.length;++s){var i=e[s];if(!(
void 0!==t.code&&i.code!==t.code||void 0!==t.stage&&i.stage!==t.stage))return i}},Unit.prototype.findComponent=function(e){for(var t=0;t<this.components.length;t++)if(this.components[t]instanceof e)return this.components[t]},Unit.prototype.setPrizes=function(e,t){this.prizes=e,this.prizesExp=t,this.onChangePrizes()},Unit.prototype.getFogState=function(){var e=Game.currentGame.map.getFog(this.x,this.y);if(e)return e.fogBlock.state},Unit.prototype.isGrounded=function(){return void 0!==this.findComponent(Grounded)},Unit.prototype.isMultiCell=function(){return void 0!==this.findComponent(MultiCell)},Unit.prototype.isUpgradable=function(){return void 0!==this.findComponent(Upgradable)},Unit.prototype.isMultiCellBody=function(){return"multiCellBody"===this.code},Unit.prototype.getInfo=function(){for(var e,t=0;t<this.components.length;t++){var s=this.components[t];if(e=s.getInfo&&s.getInfo())break}return!cleverapps.metha.isFocused()&&this.getData().removable&&(e?(e.actions=e.actions||{},
e.actions.remove={unit:this}):e={title:Game.currentGame.unitsLibrary.getUnitName(this),actions:{remove:{unit:this}}}),e},Unit.prototype.isMoveable=function(){if(this.getData().important||!1===this.movable)return!1;for(var e=[Grounded,MultiCell,Dish,SpecialOffer],t=0;t<e.length;t++)if(void 0!==this.findComponent(e[t]))return!1;if(void 0!==this.findComponent(Collectible)&&this.getData().unmergeable&&Buildable.IsBuilt(this)){if("resource"!==this.getType())return!1;if(0<Game.currentGame.map.listAvailableUnits().filter(function(e){return e.code===this.code&&e.isUpgradable()}.bind(this)).length)return!1}return!this.isMultiCellBody()},Unit.prototype.handleClick=function(){if("decorator"!==this.code){this.getData().developing&&Game.currentGame.onHintMessage("messages:Unit.Developing"),Game.currentGame.userStatus.reportUserAction();var t=Game.currentGame.workers.findAssigned(this);if(void 0!==t)return 0<SpeedUpWindow.CalcPrice(t.getTimeLeft())&&!t.speedupInProgress&&cleverapps.metha.display({
focus:"SpeedUp",action:function(e){new SpeedUpWindow(t),cleverapps.metha.onceNoWindowsListener=e}}),!0;if(this.prizes){if(this.onSqueeze(),this.prizes.minigame)return this.prizes=void 0,this.onChangePrizes(),this.onPrizeHarvested(),cleverapps.metha.display({focus:"MinesweeperScene",actions:[function(e){setTimeout(e,300)},function(e){Game.currentGame.stop(),Game.currentGame=void 0,Game.currentMiniGame={x:this.x,y:this.y},cleverapps.scenes.replaceScene(new MineGameScene,e)}.bind(this)]}),!0;if(this.prizes.resource)return Game.currentGame.addReward(this.prizes.type,this.prizes.amount,this,{flyAmount:this.prizes.flyAmount}),this.prizes=void 0,this.onChangePrizes(),this.onPrizeHarvested(),!0;var e=this.prizes.length-Game.currentGame.map.countEmptySlots();if(0<e)return Game.currentGame.onHintMessage("messages:Spawn.nospace",!1,{left:e}),this.onChangePrizes(!0),!0;Game.currentGame.spawn(this.prizes,this,{radius:Map2d.RADIUS_SMALL});var s=this.prizes;return this.prizes=void 0,this.prizesExp&&(
Game.currentGame.gameLevel.addExp(this.prizesExp,this,{delay:100*s.length+500}),this.prizesExp=void 0),this.onChangePrizes(),this.onPrizeHarvested(),Game.currentGame.gameEvent(Merge.PRIZE_HARVESTED,{affected:this,prizes:s}),!0}for(var i=0;i<this.components.length;i++){var n=this.components[i];if(n.handleClick&&n.handleClick())return!0}return!1}},Unit.prototype.distanceTo=function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},Unit.prototype.isMergeable=function(e,t){return!this.getData().unmergeable&&!e.getData().unmergeable&&(!!Buildable.IsBuilt(this)&&(!!Buildable.IsBuilt(e)&&(!e.isLast()&&(!(!t||"crystal"!==this.code||!this.isLast()||e.code===this.code)||e.code===this.code&&e.stage===this.stage))))},Unit.prototype.setPosition=function(e,t){if(this.x!==e||this.y!==t){void 0!==this.x&&void 0!==this.y&&this.saveRemoval(),this.x=e,this.y=t;var s=this.findComponent(MultiCell);s&&!cleverapps.config.editorMode&&s.occupite(),this.save()}},Unit.prototype.remove=function(e){
this.unhighlight();var t=Game.currentGame.map,s=t.getUnit(this.x,this.y);s&&s!==this||(t.remove(Map2d.LAYER_UNITS,this.x,this.y),this.saveRemoval());var i=this.findComponent(MultiCell);i&&i.remove(),e||this.onRemove(),this.clear()},Unit.prototype.seedRandom=function(e){e=e||0,void 0===this.x&&void 0===this.y?Game.currentGame.currentLoadingUnitPosition&&(e+=1e3*Game.currentGame.currentLoadingUnitPosition.x+Game.currentGame.currentLoadingUnitPosition.y):e+=1e3*this.x+this.y,cleverapps.Random.seed(cleverapps.user.id+e)},Unit.prototype.highlight=function(e){this.unhighlight(),this.light=new Highlight(this.x,this.y),e&&e.drag?(Game.currentGame.map.onAnimationsAdd(this.light),this.light.move(this.x,this.y,!0)):Game.currentGame.map.onAdd(Map2d.LAYER_UNITS,this.light.x,this.light.y,this.light),e&&e.duration&&this.light.schedule(this.unhighlight.bind(this),e.duration)},Unit.prototype.unhighlight=function(){this.light&&(this.light.remove(),delete this.light)},
Unit.prototype.unhighlightMerge=function(){this.clusters&&(this.onStopAnimateMerge(this),Game.currentGame.onFinishMergeHint(),this.clusters.forEach(function(e){e.forEach(function(e){var t=Game.currentGame.map.getUnit(e.x,e.y);t&&(t.unhighlight(),t.onStopAnimateMerge(this))})}),this.clusters=void 0)},Unit.prototype.highlightMerge=function(e,t){t=t||{},(this.clusters=e).length&&(cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.automerge||this.onStartAnimateMerge(this),t.noMessage||Game.currentGame.onStartMergeHint(e.reduce(function(e,t){return e+t.length},1),this),e.forEach(function(e){var s=e[0];e.forEach(function(e){var t=Game.currentGame.map.getUnit(e.x,e.y);t.highlight(),cleverapps.config.wysiwygMode&&(cleverapps.flags.wysiwyg.mergeAnimation2||cleverapps.flags.wysiwyg.automerge)||0!==t.distanceTo(s)||t===this||t.light.up(),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.automerge||t.onStartAnimateMerge(s)}.bind(this))}.bind(this)))},Unit.prototype.didMerged=function(){
Buildable.IsBuilt(this)&&this.onCreatePrize(),this.onDidMerged()},Unit.prototype.handleDragStart=function(){if(!this.isMoveable())return!1;Game.currentGame.userStatus.reportUserAction(),Game.currentGame.map.setDragging(this),this.highlight({drag:!0});var e=this.findComponent(InstantWorker);e&&e.handleDragStart();var t=this.findComponent(MultiCell);if(t)for(var s=0;s<t.shape.length;s++)Game.currentGame.map.layers[Map2d.LAYER_UNITS][this.y+t.shape[s].y][this.x+t.shape[s].x]=void 0;else Game.currentGame.map.layers[Map2d.LAYER_UNITS][this.y][this.x]=void 0;return this.lastX=this.x,this.lastY=this.y,!0},Unit.prototype.listMergeAtPoint=function(e,t){var s=Game.currentGame.map;if(s.isGround(e,t)&&!s.getFog(e,t)&&s.getUnit(e,t)&&this.isMergeable(s.getUnit(e,t),!0)){var i=s.bfs(e,t,s.getUnit(e,t));if(2<=i.length)return i}},Unit.prototype.listMergeClusters=function(e,t){var s=Game.currentGame.map,i=s.listUnitsFromPointByCircle(e,t).filter(this.equals.bind(this)),n={},o=[];return i.forEach(
function(e){if(!n[e.x+1e4*e.y]){var t=s.bfs(e.x,e.y,e);t.forEach(function(e){n[e.x+1e4*e.y]=!0}),1<t.length&&o.push(t)}}),o},Unit.prototype.handleDragMove=function(e,t){if(this.lastX!==e||this.lastY!==t||!this.clusters&&cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.mergeAnimation2){this.lastX=e,this.lastY=t;var s=this.findComponent(InstantWorker);if(s&&s.handleDragMove(e,t),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.automerge)AutomergeHelper.handleDragMove(e,t,this);else if(cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.mergeAnimation2){if(!this.clusters){var i=this.listMergeClusters(this.x,this.y);this.unhighlightMerge(),this.light.show(),this.light.hide(),this.highlightMerge(i)}}else{this.unhighlightMerge(),this.light.show();var n=this.listMergeAtPoint(e,t);n&&(this.light.hide(),this.highlightMerge([n]))}this.light.move(e,t),this.light.error?this.onMarkError():this.onMarkNormal()}},Unit.prototype.handleDragEnd=function(){var e=this.light.error
;this.unhighlightMerge(),this.unhighlight(),Game.currentGame.userStatus.reportUserAction(),Game.currentGame.map.setDragging(void 0),Game.currentGame.onFinishMergeHint();var t=this.findComponent(InstantWorker);if(!t||!t.handleDragEnd(this.lastX,this.lastY))if(e)this.move(this.x,this.y);else{var s=this.listMergeAtPoint(this.lastX,this.lastY);if(s){var i=Game.currentGame.map.getUnit(this.lastX,this.lastY);Game.currentGame.merge(s,this,i)}else this.move(this.lastX,this.lastY),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.automerge&&AutomergeHelper.handleDragEnd(this);Game.currentGame.tutorial.processFresh()}},Unit.prototype.onCreatePrize=function(){if(this.getData().createPrize){var e=0;this.getData().createPrize.coins&&(Game.currentGame.addCoins(this.getData().createPrize.coins,this,{delay:e,jumpSide:"left"}),e+=1e3),this.getData().createPrize.exp&&Game.currentGame.gameLevel.addExp(this.getData().createPrize.exp,this,{delay:e,jumpSide:"right"})}},Unit.prototype.move=function(s,i
){var n=Game.currentGame.map,e=n.getUnit(s,i);if(e!==this){var t,o=this.findComponent(MultiCell),r=[];if(o)for(t=0;t<o.shape.length;t++)(e=n.getUnit(s+o.shape[t].x,i+o.shape[t].y))&&e!==this&&e.head!==this&&r.push(e);else e&&r.push(e);if(void 0!==this.x&&void 0!==this.y&&n.getUnit(this.x,this.y)===this)if(o)for(t=0;t<o.shape.length;t++)n.layers[Map2d.LAYER_UNITS][this.y+o.shape[t].y][this.x+o.shape[t].x]=void 0;else n.layers[Map2d.LAYER_UNITS][this.y][this.x]=void 0;if(r.length){var a=[];r.forEach(function(e){a.push({x:e.x,y:e.y})}),r.forEach(function(e){if(e.isMultiCell())e.remove();else if(e.isMultiCellBody())e.head.remove();else{var t=n.findEmptySlot(s,i,void 0,void 0,a);t?e.move(t.x,t.y):e.remove()}})}void 0!==this.x&&void 0!==this.y&&n.getUnit(this.x,this.y)&&n.getUnit(this.x,this.y)!==this&&(delete this.x,delete this.y),(n.layers[Map2d.LAYER_UNITS][i][s]=this).setPosition(s,i),this.onMove(),Game.currentGame.workers.findAssigned(this)&&Game.currentGame.storeSave()}},
Unit.prototype.getFamily=function(){return Families[this.code]},Unit.prototype.isLast=function(){return this.getFamily().units.length-1===this.stage},Unit.getPreviousStagesTargets=function(s,e){return cleverapps.arrayFill(e).map(function(e,t){return{code:s,stage:t}})},Unit.getAllStagesTargets=function(e){return Unit.getPreviousStagesTargets(e,Families[e].units.length)},Unit.prototype.equals=function(e){return Unit.Equals(this,e)},Unit.Equals=function(e,t){return e&&t&&void 0!==e.code&&void 0!==e.stage&&e.code===t.code&&e.stage===t.stage},Unit.IsApplicable=function(e,t){return Array.isArray(e)?t&&e.some(function(e){return Unit.IsApplicable(e,t)}):!(e&&(void 0!==e.type&&e.type!==t.getType()||void 0!==e.code&&e.code!==t.code||void 0!==e.stage&&e.stage!==t.stage))},Unit.prototype.setPoints=function(e){this.points=e,this.save(),e?this.onShowPoints():this.onHidePoints()},Unit.prototype.claimPoints=function(){if(this.points)return cleverapps.missionManager.dispatchEvent(
Mission.EVENT_COLLECT_BATTLE_PASS_STARS,{amount:this.points})?(this.onClaimPoints(this.points),Game.currentGame.counter.trigger(1e3)):this.onHidePoints(),delete this.points,this.save(),!0};var GameLevel=function(e){this.calcThreshold(),this.calcMaxEnergy(),this.onChangeValue=function(){},this.onChangeExp=function(){},this.onLevelUp=function(){},this.onChangeGameLevel=function(){}};GameLevel.prototype.calcThreshold=function(){GameLevel.THRESHOLD=[20,100,200,500,1e3,2200,3500];for(var e=GameLevel.THRESHOLD.length;e<100;e++)GameLevel.THRESHOLD.push(GameLevel.THRESHOLD[e-1]+1500)},GameLevel.prototype.getLevel=function(){return cleverapps.user.level+1},GameLevel.prototype.getNextLevel=function(){return cleverapps.user.level+2},GameLevel.prototype.nextLevelThreshold=function(){if(cleverapps.user.level<=GameLevel.THRESHOLD.length-1)return GameLevel.THRESHOLD[cleverapps.user.level];var e=cleverapps.user.level-(GameLevel.THRESHOLD.length-1);return(
GameLevel.THRESHOLD[GameLevel.THRESHOLD.length-1]-GameLevel.THRESHOLD[GameLevel.THRESHOLD.length-2])*e},GameLevel.prototype.checkLevelUp=function(){cleverapps.user.exp>=this.nextLevelThreshold()&&this.onLevelUp()},GameLevel.prototype.moveToNextLevel=function(){cleverapps.user.exp-=this.nextLevelThreshold(),cleverapps.user.level++,this.calcMaxEnergy(),Game.currentGame.fogs.onChangeGameLevel(),this.onChangeValue(),this.onChangeExp(),Game.currentGame.energyLottery.onChangeGameLevel(),Game.currentGame.barrelPlanner.onChangeGameLevel(),cleverapps.user.save(),cleverapps.sideBar.refreshAllIcons();var e=Game.currentGame.level.hash;if(cleverapps.eventLogger.logEvent(cleverapps.EVENTS.LEVEL_FINISH,{hash:e}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNIQUE_FINISH,{hash:e}),void 0!==cleverapps.abTest.group&&cleverapps.eventLogger.logEvent("abtest_"+cleverapps.abTest.group+"_"+cleverapps.EVENTS.LEVEL_FINISH),"merge"===cleverapps.config.type){var t=cleverapps.user.getDaysSinceRegistration()
;6===cleverapps.user.level&&t<=2?cleverapps.eventLogger.logEvent("gamelevel_conversion_d2"):7===cleverapps.user.level&&t<=7&&cleverapps.eventLogger.logEvent("gamelevel_conversion_d7"),3===levels.user.level&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.TUTORIAL_COMPLETED),6<=levels.user.level&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.ACHIEVED_LEVEL)}cleverapps.environment.levelNo=levels.user.level},GameLevel.prototype.setExp=function(e){cleverapps.user.exp=e,this.onChangeExp(),cleverapps.user.save()},GameLevel.prototype.addExp=function(e,t,s){cleverapps.user.exp+=e,cleverapps.user.save(),Game.currentGame.addItemsAnimation("exp",e,t,s,function(){this.onChangeExp(),this.checkLevelUp()}.bind(this))},GameLevel.prototype.calcMaxEnergy=function(){cleverapps.lives.setMaxAmount(75+2*cleverapps.user.level),0===cleverapps.user.level&&cleverapps.lives.setAmount(cleverapps.Lives.MAX_REGEN_AMOUNT)},GameLevel.prototype.levelUpPrize=function(){var e,t,s;switch(cleverapps.user.level+1){
case 1:e=150,t=5;break;case 2:e=50,t=5,s=25;break;case 3:case 4:case 5:e=50,t=10,s=30;break;case 6:case 7:case 8:e=100,t=5,s=50;break;default:e=150,t=10,s=100}return{coins:e,rubies:t,energy:s}};var Harvested=function(e){this.items=e,this.onChangeItems=function(){}};Harvested.prototype.save=function(){return this.items},Harvested.prototype.get=function(e){return this.items[e]||0},Harvested.prototype.add=function(e,t){this.items[e]=(this.items[e]||0)+t,Game.currentGame.storeSave(),this.onChangeItems()},Harvested.prototype.addList=function(e){for(var t in e)this.items[t]=(this.items[t]||0)+e[t];Game.currentGame.storeSave(),this.onChangeItems()},Harvested.prototype.canTake=function(e,t){return this.items[e]&&this.items[e]>=t},Harvested.prototype.isAvailableList=function(e){var t=Game.currentGame.unitsLibrary.listAvailableByType("fruit");for(var s in e)if(t.indexOf(s)<0)return!1;return!0},Harvested.prototype.canTakeList=function(e){for(var t in e)if(!this.canTake(t,e[t]))return!1;return!0},
Harvested.prototype.take=function(e,t){return!!this.canTake(e,t)&&(this.items[e]-=t,Game.currentGame.storeSave(),this.onChangeItems(),!0)},Harvested.prototype.takeList=function(e){if(this.canTakeList(e)){for(var t in e)this.items[t]-=e[t];return Game.currentGame.storeSave(),this.onChangeItems(),!0}return!1},Harvested.prototype.calcMissingIngredients=function(e){var t={};for(var s in e.ingredients){var i=Math.max(0,e.ingredients[s]-this.get(s));i&&(t[s]=i)}return t};var UnitSaver=function(){this.prefix=cleverapps.config.prefix+cleverapps.social.getLocalStoragePreffix()+"_map",this.loadMap()};UnitSaver.prototype.update=function(e,t,s,i){cleverapps.DataLoader.save(this.getStoreKey(e,t),s),!0!==i&&cleverapps.unitSyncer.save(e,t,s)},UnitSaver.prototype.getStoreKey=function(e,t){return this.prefix+e+"_"+t},UnitSaver.prototype.parseStoreKey=function(e){var t=e.replace(this.prefix,"").split("_");return{x:parseInt(t[0]),y:parseInt(t[1])}},UnitSaver.prototype.remove=function(e,t){
cleverapps.DataLoader.remove(this.getStoreKey(e,t)),cleverapps.unitSyncer.remove(e,t)},UnitSaver.prototype.load=function(e,t){return cleverapps.DataLoader.load(this.getStoreKey(e,t))},UnitSaver.prototype.loadMap=function(){var i=[];return this.listUnitsKeys().forEach(function(e){var t=cleverapps.DataLoader.load(e);if(t){var s=this.parseStoreKey(e);s.data=t,i.push(s)}},this),cleverapps.unitSyncer.loadMap(i),i},UnitSaver.prototype.listUnitsKeys=function(){return Object.keys(cleverapps.DataLoader.data).filter(function(e){return 0===e.indexOf(this.prefix)},this)},UnitSaver.prototype.updateInfo=function(e){this.listUnitsKeys().forEach(function(e){cleverapps.DataLoader.load(e)&&(cleverapps.DataLoader.remove(e),0)});var t=[];e.forEach(function(e){e.kickout?t.push(e):(this.update(e.x,e.y,e.data,!0),0)},this),this.saveKickOuts(t)},UnitSaver.prototype.loadKickOuts=function(){return cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.UNIT_SAVER_KICKOUTS)||[]},
UnitSaver.prototype.saveKickOuts=function(e){cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.UNIT_SAVER_KICKOUTS,e)};var Merge=function(e,t){var s=e&&e.episodeNo||0,i=e&&e.levelNo||0;(e=new Episode(s,i).getLevel(i)).load(),GameBase.call(this,e,t),this.onShowUp=function(){},this.onChangeCoinsListener=function(){},this.onChangeWandsListener=function(){},this.onSubstractEnergy=function(){},this.onAddItemsAnimation=function(){},this.getScrollZoom=function(){},this.isScrollProcessing=function(){},this.onHintMessage=function(){},this.onStartMergeHint=function(){},this.onFinishMergeHint=function(){};var n=this.loadSave();console.log("Stored",n),this.map=new Map2d(e.content.map,{visibleBox:e.content.visibleBox,regions:e.content.regions,decorators:e.content.decorators,terrains:e.content.terrains});var o=cleverapps.unitSaver.loadMap(),r=this.isRegularGame=e.episode.type===Episode.Types.REGULAR&&!isNaN(e.episode.episodeNo);if(r){var a=[];0===o.filter(function(e){var t=Families[e.data.code],
s=t&&t.units[e.data.stage];return s&&s.makesorder}).length&&cleverapps.user.level<2&&(n=this.getInitialInfo(),a=o),a.forEach(function(e){cleverapps.unitSaver.remove(e.x,e.y)}),o=cleverapps.substract(o,a,Unit.GetPositionKey)}n.gameLevel&&(cleverapps.user.level=n.gameLevel.value,cleverapps.user.exp=n.gameLevel.exp,cleverapps.user.save()),this.coins=n.coins,this.wands=n.wands,this.wands<0&&(this.wands=0),this.scrollCell=n.scrollCell,this.zoom=cleverapps.DataLoader.load(cleverapps.DataLoaderTypes.ZOOM),this.gameLevel=new GameLevel,this.workers=new Workers,this.orders=new Orders,this.harvested=new Harvested(n.harvested),this.harvested.onChangeItems=this.orders.updateIngredients.bind(this.orders),this.unitsLibrary=new UnitsLibrary(n.unitsLibrary),this.energyLottery=new EnergyLottery(n.energyLottery),this.energyProducts=new EnergyProducts(n.energyProducts),r?(o.forEach(function(e){this.loadUnit(e)},this),this.workers.load(n.workers)):(MergeEditor.InsertDefaults(this.map,e.content.field),
this.workers.regular=[new Worker,new Worker]),this.pixelsPlanner=new PixelsPlanner(n.pixels),this.barrelPlanner=new BarrelPlanner(n.barrel),this.unitsShop=new UnitsShop(n.unitsShop),this.fogs=new Fogs(n.fogs||[]),this.fogs.calcFogStates(),this.advice=new MergeAdvice,this.tutorial=new MergeTutorial,this.pushes=new MergePushes,this.quests=new Quests(n.quests),cleverapps.config.adminMode||cleverapps.config.wysiwygMode||(this.counter.registerStage(0,this.initStage.bind(this)),this.counter.registerStage(5,this.education.bind(this)),this.counter.registerStage(6,this.userStatus.reportUserAction.bind(this.userStatus)),this.counter.registerStage(10,this.quests.finish.bind(this.quests)),this.counter.registerStage(20,this.gameLevel.checkLevelUp.bind(this.gameLevel)),this.counter.registerStage(30,this.tutorial.processFresh.bind(this.tutorial)),this.counter.registerStage(40,this.quests.processFresh.bind(this.quests)),this.counter.registerStage(50,this.runEmptyCounter.bind(this)),this.initialized=!0
,this.updateAvailableUnits())},Game=Merge;Merge.prototype=Object.create(GameBase.prototype),(Merge.constructor=Merge).prototype.runEmptyCounter=function(){cleverapps.metha.isFocused()||cleverapps.placements.run(Placements.EMPTY_COUNTER)},Merge.prototype.listUnitsByType=function(t){return this.map.listAvailableUnits().filter(function(e){return void 0!==e.findComponent(t)})},Merge.prototype.loadUnit=function(e){this.currentLoadingUnitPosition={x:e.x,y:e.y};var t=new Unit(e.data);t.setPosition(e.x,e.y),this.map.add(Map2d.LAYER_UNITS,e.x,e.y,t),this.map.onAdd(Map2d.LAYER_UNITS,e.x,e.y,t)},Merge.prototype.initStage=function(){this.initStageRunned||(this.initStageRunned=!0,this.initWorkers(),this.restoreStaticUnits(),this.restoreImportantUnits(),this.restoreMultiCells(),this.restoreKickOuts())},Merge.prototype.restoreImportantUnits=function(){var e=[],n=[];for(var t in this.fogs.fakeUnits)for(var s in this.fogs.fakeUnits[t]){var o=parseInt(t),r=parseInt(s)
;this.fogs.fakeUnits[o][r].important&&!this.map.getFog(o,r)&&e.push({x:o,y:r,fakeUnit:this.fogs.fakeUnits[o][r]})}for(r=0;r<this.map.getHeight();r++)for(o=0;o<this.map.getWidth();o++){var i=this.map.getUnit(o,r);i&&i.getData().important&&n.push(i)}e.forEach(function(e){var s=e.fakeUnit;o=e.x,r=e.y;var t,i=void 0;(n.forEach(function(e,t){e.code===s.code&&e.getType()===s.type&&(void 0===i||n[i].stage<e.stage)&&(i=t)}),void 0===i)?((t=new Unit(s)).move(o,r),Game.currentGame.map.onAdd(Map2d.LAYER_UNITS,o,r,t)):((t=n[i]).move(o,r),n.splice(i,1))}),0<n.length&&n.forEach(function(e){e.remove()})},Merge.prototype.restoreMultiCells=function(){this.map.listAvailableUnits().forEach(function(e){var t=e.findComponent(MultiCell);t&&t.restore()})},Merge.prototype.restoreKickOuts=function(){cleverapps.unitSaver.loadKickOuts().forEach(function(e){var t=this.map.findEmptySlot(e.x,e.y),s="fail";if(t){e.x=t.x,e.y=t.y,this.loadUnit(e);var i=this.map.getUnit(e.x,e.y);s=i.code,(i.getData(
).makesorder||i.getData().important)&&(s+="_"+i.stage)}cleverapps.eventLogger.logEvent("restore_kickout_"+s)},this),cleverapps.unitSaver.saveKickOuts([])},Merge.prototype.restoreStaticUnits=function(){var e=this.fogs.fakeUnits;for(var t in e)for(var s in e[t]){var i=parseInt(t),n=parseInt(s),o=e[i][n];if("decorator"===o.code&&!this.map.getFog(i,n)){var r=new Unit(o);r.move(i,n),this.map.onAdd(Map2d.LAYER_UNITS,i,n,r)}}},Merge.prototype.workersBusyHint=function(){if(this.workers.isBonusWorkerBuyed()||this.lastWorkersWindowShowed&&!(this.lastWorkersWindowShowed<Date.now()-cleverapps.parseInterval(Merge.WORKERS_WINDOW_INTERVAL))){this.onHintMessage(Messages.get("Workers.busy"));var e=this.workers.findLeastBusy();e&&(this.map.onCenterTo(e.unit.x,e.unit.y),this.map.onAddTarget(e.unit.x,e.unit.y))}else cleverapps.metha.display({focus:"BonusWorkerWindow",control:["MenuBarGoldItem","MenuBarWorkersItem"],action:function(e){this.lastWorkersWindowShowed=Date.now(),new BonusWorkerWindow,
cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},Merge.prototype.initWorkers=function(){this.workers.regular.forEach(function(e){e.run()}),this.workers.runSpecialWorkers()},Merge.prototype.education=function(){this.fogs.blocks.fog1&&!cleverapps.config.wysiwygMode&&cleverapps.metha.display({focus:"Education",actions:[function(e){this.fogs.blocks.fog0&&this.fogs.blocks.fog0.open(),setTimeout(e,500)}.bind(this),function(e){this.unitsLibrary.isHeroAvailable("dwarf")?e():this.tutorial.showTutorial(MergeTutorials.dwarf,e)}.bind(this),function(e){this.fogs.blocks.fog1.open(),setTimeout(e,500)}.bind(this)]})},Merge.prototype.storeSave=function(){this.initialized&&(this.saveZoom&&cleverapps.DataLoader.save(cleverapps.DataLoaderTypes.ZOOM,this.getScrollZoom()),GameBase.prototype.storeSave.call(this))},Merge.prototype.getInfo=function(){return{workers:this.workers.save(),harvested:this.harvested.save(),unitsLibrary:this.unitsLibrary.save(),fogs:this.fogs.save(),
pixels:this.pixelsPlanner.save(),barrel:this.barrelPlanner.save(),quests:this.quests.save(),energyLottery:this.energyLottery.save(),energyProducts:this.energyProducts.save(),scrollCell:this.map.getScreenCenterCell()||this.scrollCell,unitsShop:this.unitsShop.save(),coins:this.coins,wands:this.wands}},Merge.prototype.getInitialInfo=function(){return{harvested:{},coins:100,wands:0,fogs:[]}},Merge.prototype.stop=function(){GameBase.prototype.stop.call(this),this.tutorial.clear(),this.advice.clear(),this.pixelsPlanner.clear(),this.barrelPlanner.clear(),this.workers.clear(),this.unitsShop.clear(),this.energyLottery.clear(),this.map.stop(),InfoView.Clear(),this.level.unload()},Merge.prototype.useEnergy=function(e,t){return cleverapps.lives.amount<e?(cleverapps.metha.display({focus:"buy_energy",control:["MenuBarGoldItem","MenuBarGameLevelItem","MenuBarLivesItem","MenuBarCoinsItem"],action:function(e){new LivesShopWindow,cleverapps.metha.onceNoWindowsListener=e}}),!1):(
cleverapps.eventLogger.logEvent("use_energy",{amount:e}),cleverapps.lives.setAmount(cleverapps.lives.amount-e),this.onSubstractEnergy(e,t),!0)},Merge.prototype.addItemsAnimation=function(e,t,s,i,n){(i=i||{}).delay?this.counter.setTimeoutUnblocked(function(){i.delay=void 0,this.addItemsAnimation(e,t,s,i,n)}.bind(this),i.delay):s?this.onAddItemsAnimation(e,t,s,i,n):n()},Merge.prototype.setCoins=function(e){this.coins=e,this.onChangeCoinsListener(this.coins),Game.currentGame.storeSave()},Merge.prototype.canTakeCoins=function(e){return this.coins>=e},Merge.prototype.takeCoins=function(e){if(this.canTakeCoins(e)){this.setCoins(this.coins-e);var t=cleverapps.missionManager.findByType(Mission.TYPE_COINS_FEAST);return t&&t.update(e),cleverapps.audio.playSound(bundles.main.urls.shop_buy_effect),!0}return cleverapps.metha.isFocused()?(cleverapps.metha.showControlsWhileFocused(["MenuBarGoldItem","MenuBarCoinsItem"]),new SoftCurrencyShopWindow):cleverapps.metha.display({focus:"ShopWindow",
control:["MenuBarGoldItem","MenuBarCoinsItem"],action:function(e){new SoftCurrencyShopWindow,cleverapps.metha.onceNoWindowsListener=e}}),!1},Merge.prototype.setWands=function(e){this.wands=e,this.fogs.onChangeWandsAmount(),this.onChangeWandsListener(this.wands),Game.currentGame.storeSave()},Merge.prototype.takeWands=function(e){this.setWands(this.wands-e),Game.currentGame.storeSave()},Merge.prototype.addReward=function(e,t,s,i){switch(e){case"exp":return void this.gameLevel.addExp(t,s,i);case"coins":return void this.addCoins(t,s,i);case"rubies":case"gold":return void this.addRubies(t,s,i);case"energy":case"lives":return void this.addEnergy(t,s,i);case"wands":return void this.addWands(t,s,i);case"worker":return void this.addWorker(t,s,i)}},Merge.prototype.addCoins=function(e,t,s){this.coins=this.coins+e,Game.currentGame.storeSave(),this.addItemsAnimation("coins",e,t,s,function(){this.onChangeCoinsListener(this.coins)}.bind(this))},Merge.prototype.addRubies=function(e,t,s){
cleverapps.user.setGold(cleverapps.user.gold+e,!0),this.addItemsAnimation("rubies",e,t,s,function(){cleverapps.user.onChangeGold()}.bind(this))},Merge.prototype.addEnergy=function(e,t,s){cleverapps.lives.give(e,!0),this.addItemsAnimation("energy",e,t,s,function(){cleverapps.lives.runListeners(),cleverapps.lives.processRegenerateState()}.bind(this))},Merge.prototype.addWands=function(e,t,s){this.wands=this.wands+e,Game.currentGame.storeSave(),this.addItemsAnimation("wands",e,t,s,function(){this.fogs.onChangeWandsAmount(),this.onChangeWandsListener(this.wands)}.bind(this))},Merge.prototype.addWorker=function(e,t,s){this.workers.addBonusWorkerPeriod(e.interval,!0),this.addItemsAnimation("worker",1,t,s,function(){this.workers.onChangeTotalAmount()}.bind(this))},Merge.prototype.harvest=function(e){if("resource"!==e.getType())switch(e.code){case"rubies":this.addRubies(e.getData().value);break;case"coins":this.addCoins(e.getData().value);break;case"wands":this.addWands(e.getData().value)
;break;default:this.harvested.add(e.code,e.getData().value)}this.counter.setTimeout(function(){this.gameEvent(Merge.HARVEST,{affected:e})}.bind(this),0)},Merge.prototype.addUnits=function(e,s){s=s||{};var i=this.map.getScreenCenterCell()||this.map.getMapCenterCell();cleverapps.toArray(e).forEach(function(e){var t=this.map.findEmptySlot(i.x,i.y,void 0,{skipCheckScreen:s.skipCheckScreen});e.setPosition(t.x,t.y),this.map.add(Map2d.LAYER_UNITS,t.x,t.y,e),this.onUnitAvailable(e),this.counter.setTimeout(function(){this.map.onAdd(Map2d.LAYER_UNITS,t.x,t.y,e),e.onAdd()}.bind(this),1e3*(s.delay||0))},this)},Merge.prototype.spawn=function(e,i,n){this.advice.boo();var o=[];if(0===e.length||cleverapps.config.editorMode)return o;var t=e.filter(function(e){var t=n.fromNode?this.map.getView().getCellByCoordinates(i):i,s=this.map.findEmptySlot(t.x,t.y,e,n);return s?(e.setPosition(s.x,s.y),this.map.add(Map2d.LAYER_UNITS,s.x,s.y,e),this.onUnitAvailable(e),!0):(o.push(e),!1)},this)
;return this.spawnAction(t,i,n),o},Merge.prototype.spawnAction=function(e,s,i){e.length?cleverapps.audio.playSound(i.sound||bundles.merge.urls.spawn_start_effect):(cleverapps.audio.playSound(bundles.merge.urls.spawn_fail_effect),Game.currentGame.onHintMessage("messages:Spawn.nospace",!1,{left:1})),this.counter.setTimeout(function(){e.forEach(function(e,t){this.map.onAdd(Map2d.LAYER_UNITS,e.x,e.y,e),e.onSpawned(s,t,i)},this)}.bind(this),100),this.counter.setTimeout(function(){e.forEach(function(e){this.gameEvent(Merge.SPAWN,{unit:e,affected:i.fromNode?void 0:s})},this)}.bind(this),700)},Merge.prototype.mergeBonus=function(e,t){var s=0,i=5;if(3<=t&&"hero"===Families[e.code].type&&e.stage===Families[e.code].units.length-2)s=1,t-=3;else for(;3<=t;){for(var n=3,o=1;2*n-1<=t;)o*=2,n=2*n-1;5===i&&(i=2*n-1),t-=n,s+=o}return{bonus:s,keepLast:t,next:i}},Merge.prototype.playMergeSound=function(){cleverapps.audio.playSound(bundles.merge.urls.merge_effect)},Merge.prototype.gameEvent=function(e,t){
this.trigger("gameEvent",e,t)},Merge.prototype.merge=function(s,e,t,i){var n,o=[e];cleverapps.config.wysiwygMode&&i?(n=this.mergeBonus(t,s.length),o=[],s.forEach(function(e){var t=this.map.getUnit(e.x,e.y);t.claimPoints(),t.onMerge(s[0]),t.remove(!0),o.push(t)},this)):(n=this.mergeBonus(t,s.length+1),s.forEach(function(e){var t=this.map.getUnit(e.x,e.y);t.claimPoints(),t.onMerge(s[0]),t.remove(!0),o.push(t)},this),e.remove());for(var r=[],a=!(cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.skipBuildingStage),c=0;c<n.bonus+n.keepLast;c++){var l=s[c],p=void 0;(p=c<n.bonus?new Unit({code:t.code,stage:t.stage+1,unbuilt:a}):new Unit({code:t.code,stage:t.stage})).setPosition(l.x,l.y),this.map.add(Map2d.LAYER_UNITS,l.x,l.y,p),r.push(p)}var d=SpecialOffer.IsAvailable(r[0]);d&&SpecialOffer.CreateOffer(r[0]),this.counter.setTimeout(function(){r.forEach(function(e){this.map.onAdd(Map2d.LAYER_UNITS,e.x,e.y,e),e.onStartDidMerged()},this),this.playMergeSound()}.bind(this),200);var h=void 0
;this.tutorial.isActive()||d||(h=r.filter(function(e){return!Buildable.IsBuilt(e)})[0]),this.counter.setTimeout(function(){r.forEach(function(e){e.didMerged()},this)}.bind(this),300),h&&this.counter.setTimeout(function(){InfoView.DisplayInfo(h)}.bind(this),1100),this.counter.setTimeout(function(){r.forEach(function(e){this.onUnitAvailable(e),this.gameEvent(Merge.SPAWN,{unit:e,affected:o})},this),this.gameEvent(Merge.MERGE,{affected:o})}.bind(this),400),5<n.next&&n.next===2*s.length+1&&this.counter.setTimeout(function(){this.map.showMergeBonus(r)}.bind(this),600)},Merge.prototype.replace=function(e,t,s){s?(e.remove(),t.setPosition(e.x,e.y),this.map.add(Map2d.LAYER_UNITS,t.x,t.y,t),this.map.onAdd(Map2d.LAYER_UNITS,t.x,t.y,t),this.onUnitAvailable(t),this.counter.setTimeout(this.gameEvent.bind(this,Merge.SPAWN,{unit:t}),0)):(e.onDestruction(),e.remove(!0),this.spawn([t],e,{radius:0}))},Merge.prototype.replaceHeroFamilyWithCoins=function(n){this.counter.setTimeout(function(){for(
var e=this.map.listAvailableUnits(),t=0;t<e.length;++t){var s=e[t];if("specialoffer"===s.code&&s.findComponent(SpecialOffer).prize.code===n.code)s.remove();else if(s.code===n.code&&s.stage<n.units.length-1)this.replace(s,new Unit({code:"coins",stage:Math.min(s.stage,3)}));else if(s.prizes&&s.prizes.length){var i=s.prizes.filter(function(e){return e.code!==n.code});0===i.length?(s.prizes=void 0,s.prizesExp=void 0,s.onChangePrizes(),s.onPrizeHarvested()):i.length!==s.prizes.length&&(s.prizes=i,s.onChangePrizes())}}}.bind(this),100)},Merge.prototype.getTargetCastle=function(e){for(var t=this.map.listAvailableUnits(),s=0;s<t.length;s++)if(t[s].code===e.code&&t[s].isUpgradable()&&t[s].findComponent(Upgradable).canCollectStage(e.stage))return t[s]},Merge.prototype.updateAvailableUnits=function(){for(var e in this.map.listAvailableUnits().forEach(this.onUnitAvailable.bind(this)),this.fogs.fakeUnits)for(var t in this.fogs.fakeUnits[e]){var s=parseInt(e),i=parseInt(t);!this.map.getFog(s,i
)&&this.fogs.fakeUnits[s][i]&&this.unitsLibrary.openUnit(this.fogs.fakeUnits[s][i])}},Merge.prototype.decreasePrizeStageIfNeeded=function(e){if(!e.stage)return e;if("resource"!==Families[e.code].type&&"hero"!==Families[e.code].type)return e;for(;0<e.stage&&!this.unitsLibrary.isOpened({code:e.code,stage:e.stage});)e.stage--;return e},Merge.prototype.onUnitAvailable=function(s){if("resource"===s.getType()&&s.isUpgradable()&&Game.currentGame.map.listAvailableUnits().forEach(function(e){if(e.code===s.code){var t=e.findComponent(Pulsing);t&&t.init()}}),Buildable.IsBuilt(s)){this.unitsLibrary.openUnit(s),"hero"===s.getType()&&this.unitsLibrary.isHeroAvailable(s.code)&&(this.fogs.calcFogStates(),this.replaceHeroFamilyWithCoins(Families[s.code]),this.quests.deleteHeroItemsQuests(s.code));var e=s.findComponent(InstantWorker);e&&this.workers.addInstant(e)}else this.tutorial.triggerBuildTutorial({unit:s})},Merge.prototype.listAvailableByType=function(e){
return this.unitsLibrary.listAvailableByType(e)},Merge.prototype.showUp=function(e){this.onShowUp(function(){this.saveZoom=!0,e()}.bind(this))},Merge.WORKERS_WINDOW_INTERVAL="15 minutes",Merge.MERGE="merge",Merge.SPAWN="spawn",Merge.HARVEST="harvest",Merge.OPENFOG="openfog",Merge.OPENDRAGON="opendragon",Merge.START_MINING="startmining",Merge.COMPLETE_MINING="completemining",Merge.MINE="mine",Merge.START_BUILDING="startbuilding",Merge.BUILD="build",Merge.SPEED_UP="speedup",Merge.PRIZE_HARVESTED="prizeharvested";var MergeTutorial=function(){cleverapps.EventEmitter.call(this),this.fresh=[];var e=Game.currentGame;e.on("gameEvent",this.onGameEvent.bind(this)),e.advice.on("showHint",this.onShowHint.bind(this))};MergeTutorial.prototype=Object.create(cleverapps.EventEmitter.prototype),(MergeTutorial.prototype.constructor=MergeTutorial).prototype.isActive=function(){return this.runningTutorial},MergeTutorial.prototype.showTutorial=function(e,t){var s=e.steps||e;s=cleverapps.toArray(s),
cleverapps.metha.compound(t,[function(e){this.runningTutorial=s,Game.currentGame.advice.stopHint(),InfoView.CloseInfo(void 0,!0),e()}.bind(this),function(e){var t=s.map(function(t,s){return function(e){this.finished?e():(t.targets=cleverapps.toArray(t.targets),this.showTutorialStep(t,s,e))}.bind(this)},this);cleverapps.metha.compound(e,t)}.bind(this),function(e){delete this.runningTutorial,delete this.finished,e()}.bind(this)])},MergeTutorial.prototype.showTutorialStep=function(t,e,s){this.step=t,this.runningIndex=e,this.onceStepCallback=cleverapps.once(s),this.onceFinishTutorialStep=cleverapps.once(this.finishTutorialStep.bind(this)),t.controls&&cleverapps.metha.showControlsWhileFocused(t.controls),cleverapps.metha.showControlsWhileFocused("map2d");var i=Game.currentGame;i.advice.setLogic(t.type,t);var n=t.wait||MergeTutorial.WAIT_MOVE,o=cleverapps.once(function(){this.clearFinishAllTimeout();var e=i.advice.findMove();!i.advice.hasHints()||t.targets&&!e?this.runOnceFinishTutorialStep(
):(this.trigger("showTutorialStep",t),e.cells&&!t.noScroll&&i.map.onCenterTo(e.cells[0].x,e.cells[0].y,{visibleBox:{left:.3,right:.4,top:.4,bottom:.1}}))}.bind(this));i.advice.hasHints()&&(t.wait||!t.targets||i.advice.findMove())?(this.finishAllTimeout=setTimeout(this.finishAll.bind(this),cleverapps.parseInterval(n)),this.onShowHintCallback=o,i.advice.startHint()):o()},MergeTutorial.prototype.onShowHint=function(){this.isActive()&&this.onShowHintCallback&&this.onShowHintCallback()},MergeTutorial.prototype.onGameEvent=function(e,t){if(this.isActive()){var s=MergeTutorial.Types[this.step.type]||{};if(-1!==(s.types||[this.step.type]).indexOf(e)){var i=Game.currentGame;s.allMoves&&i.advice.findMove()||s.affected&&t.affected&&!this.checkTargets(t.affected)||this.runOnceFinishTutorialStep()}}},MergeTutorial.prototype.triggerBuildTutorial=function(e){e.unit&&!Game.currentGame.unitsLibrary.isOpened(e.unit)&&("wood"!==e.unit.code||2!==e.unit.stage||Game.currentGame.workers.findAssigned(e.unit
)||this.triggerTutorial(MergeTutorials.wood_2))},MergeTutorial.prototype.triggerTutorial=function(e){e&&this.runningTutorial!==e&&-1===this.fresh.indexOf(e)&&(this.fresh.push(e),Game.currentGame.counter.setTimeout(function(){},0))},MergeTutorial.prototype.processFresh=function(){if(this.fresh.length&&!cleverapps.metha.isFocused()&&!Game.currentGame.map.dragging){var t=this.fresh.shift();cleverapps.metha.display({focus:"StartTutorial",action:function(e){this.showTutorial(t,e)}.bind(this)})}},MergeTutorial.prototype.clear=function(){this.clearFinishAllTimeout()},MergeTutorial.prototype.clearFinishAllTimeout=function(){this.finishAllTimeout&&(clearTimeout(this.finishAllTimeout),delete this.finishAllTimeout)},MergeTutorial.prototype.runOnceFinishTutorialStep=function(){if(this.onceFinishTutorialStep){var e=this.onceFinishTutorialStep;delete this.onceFinishTutorialStep,e()}},MergeTutorial.prototype.finishAll=function(){this.finished=!0,this.runOnceFinishTutorialStep()},
MergeTutorial.prototype.isFirstStep=function(){return 0===this.runningIndex},MergeTutorial.prototype.isLastStep=function(){return this.runningIndex===this.runningTutorial.length-1},MergeTutorial.prototype.finishTutorialStep=function(){var e=Game.currentGame;e.advice.stopHint(),cleverapps.metha.hideControlsWhileFocused("map2d"),e.counter.setTimeout(this.runNextStep.bind(this),300)},MergeTutorial.prototype.runNextStep=function(){if(this.trigger("finishTutorialStep"),!this.isLastStep()&&this.step.controls&&cleverapps.metha.hideControlsWhileFocused(this.step.controls),delete this.step,delete this.runningIndex,delete this.onShowHintCallback,this.clearFinishAllTimeout(),this.onceStepCallback){var e=this.onceStepCallback;delete this.onceStepCallback,e()}},MergeTutorial.prototype.checkTargets=function(e){return this.isActive()&&this.step&&this.step.targets&&cleverapps.contains(this.step.targets,e,Unit.GetKey)},MergeTutorial.prototype.isInfoAvailable=function(){return!(this.isActive(
)&&this.step&&this.step.type===Merge.MERGE)},MergeTutorial.WAIT_MOVE="10 seconds",MergeTutorial.Types={},MergeTutorial.Types[Merge.MERGE]={affected:!0},MergeTutorial.Types[Merge.SPAWN]={affected:!0},MergeTutorial.Types[Merge.HARVEST]={affected:!0,allMoves:!0},MergeTutorial.Types[Merge.SPEED_UP]={affected:!0,types:[Merge.SPEED_UP,Merge.MINE,Merge.BUILD]};var MergeTutorials={dwarf:{steps:[{type:Merge.MERGE,targets:{code:"dwarf",stage:0},person:"dwarf",text:"messages:Tutorial.dwarf.step1"}]},wheat_3:{replayOnReload:!0,steps:[{type:Merge.MERGE,targets:{code:"wheat",stage:0},person:"dwarf",controls:["MenuBarGameLevelItem","MenuBarCoinsItem"],text:"messages:Tutorial.wheat_3_tutorial.step1"},{type:Merge.MERGE,targets:{code:"wheat",stage:1},person:"dwarf",controls:["MenuBarGameLevelItem","MenuBarCoinsItem"],text:"messages:Tutorial.wheat_3_tutorial.step2"},{type:Merge.MERGE,targets:{code:"wheat",stage:2},person:"dwarf",controls:["MenuBarGameLevelItem","MenuBarCoinsItem"],
text:"messages:Tutorial.wheat_3_tutorial.step3"}]},dishes_0:{replayOnReload:!0,steps:[{type:Merge.SPAWN,targets:{code:"wheat",stage:3},person:"dwarf",controls:"sidebar",text:"messages:Tutorial.dishes_0.step1"},{type:Merge.HARVEST,targets:{code:"wheat",stage:4},person:"dwarf",controls:"sidebar",text:"messages:Tutorial.dishes_0.step2"},{type:Merge.SPAWN,targets:{code:"dwarf",stage:1},prizes:{code:"dishes",stage:0},person:"dwarf",controls:"sidebar",text:"messages:Tutorial.dishes_0.step3"},{type:Merge.SPAWN,targets:{code:"dishes",stage:0},person:"dwarf",controls:"sidebar",text:"messages:Tutorial.dishes_0.step4"},{type:Merge.HARVEST,targets:{code:"wands",stage:0},person:"dwarf",controls:"MenuBarWandsItem",text:"messages:Tutorial.dishes_0.step5"},{type:Merge.OPENFOG,noScroll:!0,targets:"fog2",person:"dwarf",controls:"MenuBarWandsItem",text:"messages:Tutorial.dishes_0.step6"}]},woodsource_1_1:{steps:[{type:Merge.START_MINING,targets:{code:"woodsource",stage:1,mined:0},person:"worker",
text:"messages:Tutorial.woodsource_1.step1"},{type:Merge.SPAWN,targets:{code:"woodsource",stage:1},prizes:{code:"wood",stage:0},person:"worker",wait:"15 seconds",text:"messages:Tutorial.woodsource_1.step2"},{type:Merge.MERGE,targets:{code:"wood",stage:0},person:"worker",text:"messages:Tutorial.woodsource_1.step2.1"},{type:Merge.START_MINING,targets:{code:"woodsource",stage:1,mined:1},person:"worker",text:"messages:Tutorial.woodsource_1.step3"},{type:Merge.SPEED_UP,targets:{code:"woodsource",stage:1,mined:1},person:"worker",text:"messages:Tutorial.woodsource_1.step4"},{type:Merge.SPAWN,targets:{code:"woodsource",stage:1},prizes:{code:"woodchest",stage:0},person:"worker",text:"messages:Tutorial.woodsource_1.step5"},{type:Merge.SPAWN,targets:{code:"woodchest",stage:0},person:"worker",text:"messages:Tutorial.woodsource_1.step6"}]},wood_2:{steps:[{type:Merge.START_BUILDING,targets:{code:"wood",stage:2},person:"worker",text:"messages:Tutorial.wood_2.step1"},{type:Merge.SPEED_UP,targets:{
code:"wood",stage:2},person:"worker",text:"messages:Tutorial.wood_2.step2"}]},woodgenerator_1:{steps:[{type:Merge.START_MINING,targets:{code:"woodgenerator",stage:0},person:"worker",text:"messages:Tutorial.woodgenerator_1.step1"},{type:Merge.SPAWN,targets:{code:"woodgenerator",stage:0},person:"worker",wait:"15 seconds",text:"messages:Tutorial.woodgenerator_1.step2"}]}},MergeTutorialView=cc.Node.extend({ctor:function(e){this._super(),this.tutorial=e;var t=cleverapps.UI.getSceneSize();this.setContentSize2(t),this.setAnchorPoint2(.5,.5),this.setLocalZOrder(12),this.setCascadeOpacityEnabled(!0),this.tutorial.on("showTutorialStep",this.showTutorialStep.bind(this),this),this.tutorial.on("finishTutorialStep",this.finishTutorialStep.bind(this),this),cleverapps.windows.onOpenListeners.tutorial=this.createListener(this.hideDialogue.bind(this)),cleverapps.windows.onCloseListeners.tutorial=this.createListener(this.showDialogue.bind(this))},showTutorialStep:function(e){this.data=e,
this.createDialogue()},finishTutorialStep:function(){this.dialogue&&(this.dialogue.options.showUp=this.tutorial.isLastStep(),this.dialogue.close(),delete this.dialogue),this.dialogueComponent&&this.dialogueComponent.hide()},createDialogue:function(){Messages.has(this.data.text)&&(this.dialogueComponent=new MinimalDialogue({text:Messages.get(this.data.text),person:this.data.person&&cleverapps.styles.DialogueView.persons[this.data.person]}),this.addChild(this.dialogueComponent))},showDialogue:function(){this.dialogueView&&this.dialogueView.setVisible(!0)},hideDialogue:function(){this.dialogueView&&this.dialogueView.setVisible(!1)}});cleverapps.styles.MergeTutorialView={};var MergePushes=function(){this.updateFruits(),this.updateCastles(),this.updateOrders()};MergePushes.prototype.updateBuilt=function(){var e=this._buildingBuilt();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.BUILDING_BUILT),void 0!==e&&cleverapps.localPushes.sendPush(
cleverapps.LocalPushes.TYPES.BUILDING_BUILT,e)},MergePushes.prototype._buildingBuilt=function(){var e=Game.currentGame.workers.findLeastBusy(Buildable);if(e)return e.getTimeLeft()},MergePushes.prototype.updateChopped=function(){var e=this._treeChopped();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.TREE_CHOPPED),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.TREE_CHOPPED,e)},MergePushes.prototype._treeChopped=function(){var e=Game.currentGame.workers.findLeastBusy(Mineable);if(e)return e.getTimeLeft()},MergePushes.prototype.updateOrders=function(){var e=this._orderReady();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.ORDER_READY),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.ORDER_READY,e)},MergePushes.prototype._orderReady=function(){var e=Game.currentGame.listUnitsByType(MakesOrder),i=void 0;return e.forEach(function(e){var t=e.findComponent(MakesOrder);if(t.isCooking()){var s=t.getTimeLeft();(
void 0===i||s<i)&&(i=s)}}),i},MergePushes.prototype.updateCastles=function(){var e=this._castlePrize();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.CASTLE_PRIZE),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.CASTLE_PRIZE,e)},MergePushes.prototype.updateMiniGames=function(){var e=this._miniGamePrize();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.MINI_GAME_PRIZE),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.MINI_GAME_PRIZE,e)},MergePushes.prototype._castlePrize=function(){var e=Game.currentGame.listUnitsByType(Castle),i=void 0;return e.forEach(function(e){var t=e.findComponent(Castle);if(t.isCreatingPrize()){var s=t.timeToReady();(void 0===i||s<i)&&(i=s)}}),i},MergePushes.prototype._miniGamePrize=function(){var e=Game.currentGame.listUnitsByType(MiniGame),s=void 0;return e.forEach(function(e){var t=e.findComponent(MiniGame).timeToReady();0<t&&(void 0===s||t<s)&&(s=t)}),s},
MergePushes.prototype.updateFruits=function(){var e=this._fruitRipe();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.FRUIT_RIPE),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.FRUIT_RIPE,e)},MergePushes.prototype._fruitRipe=function(){var e=Game.currentGame.listUnitsByType(Fruit),i=void 0;return e.forEach(function(e){var t=e.findComponent(Fruit);if(t.isGrowing()){var s=t.timeToReady();(void 0===i||s<i)&&(i=s)}}),i},MergePushes.prototype.updateMagicPlants=function(){var e=this._magicPlantsReady();cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.MAGIC_PLANT_READY),void 0!==e&&cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.MAGIC_PLANT_READY,e)},MergePushes.prototype._magicPlantsReady=function(){var e=Game.currentGame.listUnitsByType(MagicPlant),i=void 0;return e.forEach(function(e){var t=e.findComponent(MagicPlant);if(t.isGrowing()){var s=t.getTimeLeft();(void 0===i||s<i)&&(i=s)}}),i};var Highlight=function(e,t){
this.error=0,this.x=e,this.y=t,this.onMove=function(){},this.onRemove=function(){},this.show=function(){},this.hide=function(){},this.up=function(){}};Highlight.prototype.isBlockedCell=function(e,t){var s=Game.currentGame.map;if(!s.isGround(e,t))return!0;var i=s.getUnit(e,t);return!(!i||i.isMoveable())||void 0!==s.layers[Map2d.LAYER_FOG][t][e]},Highlight.prototype.move=function(e,t,s){this.error=this.isBlockedCell(e,t),this.onMove(e,t,s)},Highlight.prototype.clear=function(){clearTimeout(this.timeout)},Highlight.prototype.remove=function(){clearTimeout(this.timeout),this.onRemove()},Highlight.prototype.schedule=function(e,t){clearTimeout(this.timeout),this.timeout=setTimeout(e,t)},Highlight.ONE_PULSE=1500;var PixelsPlanner=function(e){this.stored=e,this.onCreateSwarm=function(){},this.init()};PixelsPlanner.prototype.clear=function(){clearTimeout(this.waitTimeout),this.waitTimeout=void 0},PixelsPlanner.prototype.restart=function(){this.waitingRestart=!0,void 0!==this.waitTimeout?(
this.clear(),this.startCurrentLevel()):(this.level=0,Game.currentGame.storeSave())},PixelsPlanner.prototype.init=function(){this.inited||cleverapps.config.editorMode||cleverapps.config.adminMode||cleverapps.config.wysiwygMode||(Game.currentGame.unitsLibrary.listAvailableByType("fruit").length<2?this.waitTimeout=new cleverapps.LongTimeout(this.init.bind(this),cleverapps.parseInterval(PixelsPlanner.BETWEEN_INIT_TIMEOUT)):(this.inited=!0,this.stored?(this.level=this.stored.level,this.time=this.stored.time,this.firstTime=!1):(this.level=2,this.time=Date.now(),this.firstTime=!0),this.waitTimeout=void 0,this.startCurrentLevel()))},PixelsPlanner.prototype.save=function(){if(this.inited)return{level:this.level,time:this.time}},PixelsPlanner.prototype.sendPixels=function(){this.onCreateSwarm(new PixelsSwarm(this,{amount:cleverapps.Random.choose(PixelsPlanner.LEVELS[this.level].amount),onFirstCollected:this.nextLevel.bind(this),onFinish:this.startCurrentLevel.bind(this)}))},
PixelsPlanner.prototype.nextLevel=function(){this.level<PixelsPlanner.LEVELS.length-1&&(this.level++,Game.currentGame.storeSave())},PixelsPlanner.prototype.startCurrentLevel=function(){if(void 0===this.waitTimeout){(this.waitingRestart||this.time<Date.now()-cleverapps.parseInterval(PixelsPlanner.CLEAR_TIMEOUT))&&(this.level=0,delete this.waitingRestart),this.time=Date.now(),Game.currentGame.storeSave();var e=cleverapps.parseInterval(this.firstTime?PixelsPlanner.FIRST_TIMEOUT:PixelsPlanner.LEVELS[this.level].timeout);this.firstTime=!1,this.waitTimeout=new cleverapps.LongTimeout(function(){this.waitTimeout=void 0,this.sendPixels()}.bind(this),e)}},PixelsPlanner.LEVELS=[{amount:[4,5,5,6],timeout:"30 seconds"},{amount:[3,4],timeout:"3 minutes"},{amount:[2,3,3,4],timeout:"4 minutes"},{amount:[2,3],timeout:"5 minutes"},{amount:[2],timeout:"10 minutes"}],PixelsPlanner.BETWEEN_INIT_TIMEOUT="5 seconds",PixelsPlanner.FIRST_TIMEOUT="20 seconds",PixelsPlanner.CLEAR_TIMEOUT="1 hour"
;var PixelsSwarm=function(e,t){this.pixelsPlanner=e,this.amountPixels=t.amount,this.onFinish=t.onFinish,this.onFirstCollected=t.onFirstCollected};PixelsSwarm.prototype.createPixels=function(){var o=[];return Object.keys(PixelsSwarmConfig).forEach(function(e){var t=PixelsSwarmConfig[e];if(t.mission){var s=cleverapps.missionManager.findByType(t.mission);if(!s||!s.isRunning())return}for(var i=Math.ceil(this.amountPixels*(t.amountCoef||1)),n=0;n<i;n++)o.push({type:e})}.bind(this)),cleverapps.Random.shuffle(o)},PixelsSwarm.prototype.pixelCollectPrize=function(e,t){var s,i=PixelsSwarmConfig[e.type].reward;if("fruit"===i.type){var n=Game.currentGame.unitsLibrary.listAvailableByType("fruit"),o=new Unit({code:cleverapps.Random.choose(n),stage:0});s=!Game.currentGame.spawn([o],e,{fromNode:!0,parentWorldPosition:t,sound:bundles.merge.urls.spawn_beetle_effect}).length}else cleverapps.audio.playSound(bundles.merge.urls.spawn_beetle_effect),Game.currentGame.addReward(i.type,cleverapps.Random.random(
i.amount[0],i.amount[1]),e,{withoutDelta:!0}),s=!0;return s&&!this.pixelCollected&&(this.pixelCollected=!0,this.onFirstCollected()),s},PixelsSwarm.PIXEL_TYPE_FRUIT="fruit",PixelsSwarm.PIXEL_TYPE_ENERGY="energy",PixelsSwarm.PIXEL_TYPE_COINS="coins";var PixelsSwarmConfig={};PixelsSwarmConfig[PixelsSwarm.PIXEL_TYPE_FRUIT]={reward:{type:"fruit"}},PixelsSwarmConfig[PixelsSwarm.PIXEL_TYPE_ENERGY]={amountCoef:.5,mission:Mission.TYPE_ENERGY_FEAST,reward:{type:"energy",amount:[4,9]}},PixelsSwarmConfig[PixelsSwarm.PIXEL_TYPE_COINS]={amountCoef:.5,mission:Mission.TYPE_COINS_FEAST,reward:{type:"coins",amount:[10,20]}};var PixelsSwarmView=cc.Node.extend({ctor:function(e,t){this._super(),this.model=e,this.visibleRect=t,this.pixels=[];var s=Math.random()*this.visibleRect.width*.3,i=e.createPixels();this.amountPixels=i.length;for(var n=0;n<i.length;n++)this.sendPixel({type:i[n].type,order:n,groupDelta:s,totalAmount:i.length,onDie:this.pixelDie.bind(this)});cleverapps.audio.playSound(
bundles.merge.urls.pixel_spawn_effect)},pixelDie:function(){this.amountPixels--,this.amountPixels||this.finish()},finish:function(){this.pixels=void 0,this.removeFromParent(),this.model.onFinish()},findClosestPixel:function(e){for(var t=void 0,s=void 0,i=0;i<this.pixels.length;i++)if(this.pixels[i]!==e&&this.pixels[i].flying){var n=cc.pDistance(e,this.pixels[i]);n<cleverapps.styles.PixelsSwarmView.minimalDistance&&(void 0===t||n<t)&&(t=n,s=this.pixels[i])}return s},sendPixel:function(e){var t=cleverapps.styles.PixelsSwarmView,s=this.visibleRect.x,i=this.visibleRect.y+this.visibleRect.height,n={x:s+(e.order-e.totalAmount/2)*t.x-t.y/2-t.dy+e.groupDelta,y:i+Math.random()*t.y+t.dy},o={x:1.2*this.visibleRect.width,y:1.2*this.visibleRect.height},r=new PixelView({type:e.type,pixelsSwarmView:this,distance:o,onDie:e.onDie});r.setPositionRound(n),this.addChild(r),this.pixels.push(r)}});cleverapps.styles.PixelsSwarmView={x:120,y:200,dy:100,minimalDistance:80};var PixelView=cc.Node.extend({
ctor:function(e){switch(this._super(),this.type=e.type,this.pixelsSwarmView=e.pixelsSwarmView,this.onDie=e.onDie,this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.PixelView.width,cleverapps.styles.PixelView.height),this.animation=new cleverapps.Spine(bundles.merge.jsons.pixels_json),this.animation.setPositionRound(cleverapps.styles.PixelView.animation),this.animation.setAnimation(0,"animation",!0),this.addChild(this.animation),this.type){case PixelsSwarm.PIXEL_TYPE_FRUIT:this.animation.setSkin("standart");break;case PixelsSwarm.PIXEL_TYPE_ENERGY:this.animation.setSkin("energy");break;case PixelsSwarm.PIXEL_TYPE_COINS:this.animation.setSkin("coin")}this.speed={x:e.distance.x/90,y:-e.distance.y/90},this.flying=!0,this.scheduleUpdate(),this.setScale(0),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1),new cc.DelayTime(89.4),new cc.ScaleTo(.2,0),new cc.CallFunc(this.die.bind(this)))),cleverapps.UI.onClick(this,this.collect.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0})
,cleverapps.UI.onDrag(this,{onDragStart:function(){return this.flying=!1,this.setLocalZOrder(1),this.unscheduleUpdate(),!0}.bind(this),onDragEnd:function(){this.flying=!0,this.setLocalZOrder(0),this.scheduleUpdate()}.bind(this),swallowTouches:!0,followPointer:!0})},die:function(){this.flying=!1,this.removeFromParent(),this.onDie()},collect:function(){this.collected||this.pixelsSwarmView.model.pixelCollectPrize(this,this.parent.convertToWorldSpace(this.getPosition()))&&(this.collected=!0,this.flying=!1,this.unscheduleUpdate(),this.stopAllActions(),this.animation.setAnimation(0,"animation2",!1),this.animation.setCompleteListener(this.die.bind(this)))},update:function(e){this._super(e);var t={x:this.speed.x,y:this.speed.y},s=this.pixelsSwarmView.findClosestPixel(this);if(s){var i={x:this.x-s.x,y:this.y-s.y},n=cc.pLength(i);i=n<1?{x:1,y:0}:{x:i.x/n,y:i.y/n},t={x:t.x+i.x*cleverapps.styles.PixelView.gravitySpeed,y:t.y+i.y*cleverapps.styles.PixelView.gravitySpeed}}this.setPosition({
x:this.x+e*t.x,y:this.y+e*t.y})}});cleverapps.styles.PixelView={width:80,height:80,animation:{x:{align:"center"},y:{align:"center",dy:-40}},gravitySpeed:100};var BarrelPlanner=function(e){this.time=e&&e.time||0,this.onCreateBarrel=function(){},this.init()};BarrelPlanner.prototype.onChangeGameLevel=function(){this.inited||this.init()},BarrelPlanner.prototype.init=function(){this.isAvailable()&&(this.inited=!0,this.checkTimeout=new cleverapps.LongTimeout(this.scheduleSending.bind(this),cleverapps.parseInterval(BarrelPlanner.INIT_TIMEOUT)))},BarrelPlanner.prototype.isAvailable=function(){return RewardedAdsManager.IsEnabled()&&cleverapps.user.checkAvailable(BarrelPlanner.AVAILABLE)&&!cleverapps.config.editorMode&&!cleverapps.config.adminMode},BarrelPlanner.prototype.clear=function(){clearInterval(this.checkTimeout),delete this.checkTimeout},BarrelPlanner.prototype.sendBarrel=function(){var e=new Barrel;e.on("collect",function(){this.time=Date.now(),Game.currentGame.storeSave(),
this.scheduleSending()}.bind(this)),this.onCreateBarrel(e)},BarrelPlanner.prototype.scheduleSending=function(){if(this.clear(),!(cleverapps.config.editorMode||cleverapps.config.adminMode||cleverapps.config.wysiwygMode)){var e=this.time+cleverapps.parseInterval(BarrelPlanner.BARRELS_INTERVAL)-Date.now();e<=0&&cleverapps.rewardedAdsManager.isAvailable(RewardedAdsManager.REWARDED,!0)?this.sendBarrel():this.checkTimeout=new cleverapps.LongTimeout(this.scheduleSending.bind(this),e<=0?cleverapps.parseInterval(BarrelPlanner.AD_CHECK_INTERVAL):e)}},BarrelPlanner.prototype.save=function(){if(this.inited)return{time:this.time}},BarrelPlanner.AVAILABLE={episode:0,level:3},BarrelPlanner.BARRELS_INTERVAL="3 hours",BarrelPlanner.AD_CHECK_INTERVAL="1 minute",BarrelPlanner.INIT_TIMEOUT="10 second",cleverapps.config.debugMode&&(BarrelPlanner.BARRELS_INTERVAL="3 minutes",BarrelPlanner.AD_CHECK_INTERVAL="10 seconds",BarrelPlanner.INIT_TIMEOUT="5 seconds");var Barrel=function(){
cleverapps.EventEmitter.call(this)};Barrel.prototype=Object.create(cleverapps.EventEmitter.prototype),(Barrel.prototype.constructor=Barrel).prototype.collect=function(e){if(!this.collected){e.price.type===Barrel.PRICE_TYPES.RUBY&&cleverapps.user.takeGold(e.price.amount),e.price.type===Barrel.PRICE_TYPES.COIN&&Game.currentGame.takeCoins(e.price.amount);var t=Barrel.ITEMS.indexOf(e);cleverapps.eventLogger.logEvent("barrel_reward_"+t),this.trigger("collect",e.reward),this.collected=!0}},Barrel.prototype.showItemAds=function(e){if(!this.collected){var t=e.reward.amount-Game.currentGame.map.countEmptySlots();0<t?Game.currentGame.onHintMessage("messages:Spawn.nospace",!0,{left:t}):e.price.type!==Barrel.PRICE_TYPES.RUBY||cleverapps.user.canTakeGold(e.price.amount)?e.price.type!==Barrel.PRICE_TYPES.COIN||Game.currentGame.canTakeCoins(e.price.amount)?cleverapps.rewardedAdsManager.play(RewardedAdsManager.REWARDED,this.collect.bind(this,e)):Game.currentGame.takeCoins(e.price.amount
):cleverapps.user.takeGold(e.price.amount)}},Barrel.PRICE_TYPES={RUBY:0,COIN:1},Barrel.ITEMS=[{buttonTxt:"messages:FREE",price:{},reward:{unit:{code:"rubies",stage:0},amount:1}},{reward:{unit:{code:"woodchest",stage:1},amount:1},price:{type:Barrel.PRICE_TYPES.COIN,amount:50,icon:bundles.reward_icons.frames.shop_coin_png}},{reward:{unit:{code:"worker",stage:2},amount:2},price:{type:Barrel.PRICE_TYPES.RUBY,amount:10,icon:bundles.reward_icons.frames.gold_small_png}}];var BarrelView=cc.Node.extend({ctor:function(e){this._super(),(this.barrel=e).on("collect",this.createListener(this.animateCollect.bind(this))),this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.BarrelView),this.animation=new cleverapps.Spine(bundles.merge.jsons.adsbarrel_json),this.animation.setPositionRound(this.width/2,this.height/2),this.addChild(this.animation),cleverapps.UI.onClick(this,this.onClick.bind(this),{swallowTouches:!1,ignoreOnTouchMoved:!0});var t=Game.currentGame.map.getView().getCell(
Map2d.LAYER_WATER,BarrelView.POSSIBLE_CELL.x,BarrelView.POSSIBLE_CELL.y).getPosition();this.setPositionRound(t),this.showUp()},showUp:function(){this.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(function(){var e=new PrizeView({sprite:bundles.shared.frames.adicon_png,padding:cleverapps.styles.BarrelView.ad_icon_padding,onClick:this.onClick.bind(this)});e.setPositionRound(this.width/2,this.height),e.basePosition=e.getPosition(),this.addChild(e),e.runAnimation(),e.runAction(new cc.ScaleTo(.2,1,1).easing(cc.easeIn(1)))}.bind(this)))),this.animation.setAnimationAndIdleAfter("appearance","animation"),cleverapps.audio.playSound(bundles.merge.urls.barrel_appear_sfx)},animateCollect:function(e){this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(1.25),new cc.ScaleTo(.2,.1),new cc.Hide,new cc.DelayTime(2),new cc.RemoveSelf));for(var s=[],t=0;t<e.amount;t++)s.push(new Unit(e.unit));var i={focus:"barrelReward",actions:[function(e){setTimeout(e,250)},function(e
){Game.currentGame.map.onCenterTo(BarrelView.POSSIBLE_CELL.x,BarrelView.POSSIBLE_CELL.y,{layer:Map2d.LAYER_WATER,callback:e})}.bind(this),function(e){Game.currentGame.spawn(s,this,{fromNode:!0}),setTimeout(e,700)}.bind(this),function(e){var t=s[0];t&&t.x&&t.y&&Game.currentGame.map.onCenterTo(t.x,t.y,{duration:1.7*MergeScene.SCROLL_TO_DURATION}),e()}]};cleverapps.metha.isFocused()&&"BarrelAdsOpen"===cleverapps.metha.focus?cleverapps.metha.distract(i):cleverapps.metha.display(i)},onClick:function(){this.barrel.collected||cleverapps.metha.display({focus:"BarrelAdsOpen",control:["MenuBarGoldItem","MenuBarCoinsItem"],action:function(e){new BarrelAdsWindow(this.barrel),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}});BarrelView.POSSIBLE_CELL={x:38,y:37},cleverapps.styles.BarrelView={width:100,height:100,ad_icon_padding:{x:15,y:15}};var BarrelAdsWindow=Window.extend({onWindowLoaded:function(e){this.barrel=e,this._super({name:"barreladswindow",title:"messages:BarrelAdsWindow.title",
content:this.createContent(),styles:cleverapps.overrideStyles(cleverapps.styles.Window,cleverapps.styles.BarrelAdsWindow.Window,!0)}),e.on("collect",this.createListener(this.close.bind(this)))},createContent:function(){var e=Barrel.ITEMS.map(function(e){return this.createItem(e)},this),t=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:cleverapps.styles.BarrelAdsWindow.itemsMargin}),s=cleverapps.UI.generateOnlyText("messages:BarrelAdsWindow.subTitle",cleverapps.styles.FONTS.BARREL_ADS_TITLE);return new cleverapps.Layout([t,s],{direction:cleverapps.UI.VERTICAL,margin:cleverapps.styles.BarrelAdsWindow.contentMargin,padding:cleverapps.styles.BarrelAdsWindow.contentPadding})},createItem:function(e){var t=cleverapps.styles.BarrelAdsWindow.item,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t);var i=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.bg_png,cleverapps.UI.Scale9Rect.TwoPixelXY);i.setContentSize2(s.getContentSize()),s.addChild(i,-1),
i.setPositionRound(s.width/2,s.height/2);var n=this.createIcon(e);s.addChild(n),n.setPositionRound(t.iconNode);var o=this.createItemStrip(e);s.addChild(o),o.setPositionRound(t.strip);var r=cleverapps.UI.generateOnlyText("messages:Units."+e.reward.unit.code+".stage"+(e.reward.unit.stage+1)+".name",cleverapps.styles.FONTS.BARREL_ADS_TITLE);return s.addChild(r),r.setPositionRound(t.title),r.setDimensions(t.title.maxWidth,0),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),cleverapps.UI.onClick(s,this.barrel.showItemAds.bind(this.barrel,e)),new cleverapps.Layout([this.createItemButton(e),s],{direction:cleverapps.UI.VERTICAL,margin:t.buttonMargin})},createItemStrip:function(e){var t=cleverapps.styles.BarrelAdsWindow.item.strip,s=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.amount_bg_png,cleverapps.UI.Scale9Rect.TwoPixelXY);s.setContentSize2(t);var i=cleverapps.UI.generateImageText("x"+e.reward.amount,cleverapps.styles.FONTS.BARREL_ADS_AMOUNT);return s.addChild(i),
i.setPositionRound(t.amount),s},createIcon:function(e){return new UnitOnCell(e.reward.unit,{scale:cleverapps.styles.BarrelAdsWindow.item.iconNode.scale,animation:!0})},createItemButton:function(e){var t=cleverapps.styles.BarrelAdsWindow.item.button,s=new cc.Node;s.setAnchorPoint2();var i=new cc.Sprite(bundles.shared.frames.adicon_png);i.setPositionRound(t.adIcon),s.setContentSize2(i.getContentSize()),s.addChild(i),s.setScale(t.adIcon.scale);var n=[];if(e.buttonTxt){(o=cleverapps.UI.generateOnlyText(e.buttonTxt,cleverapps.styles.FONTS.BUTTON_TEXT)).fitTo(t.textWidth),n.push(o)}else{var o=cleverapps.UI.generateOnlyText(e.price.amount,cleverapps.styles.FONTS.BUTTON_TEXT),r=new cc.Sprite(e.price.icon);e.price.type===Barrel.PRICE_TYPES.RUBY&&r.setScale(t.rubyIcon.scale);var a=new cleverapps.Layout([o,r],{direction:cleverapps.UI.HORIZONTAL,margin:t.iconMargin});cleverapps.UI.fitToBox(a,{width:t.textWidth,height:a.height}),n.push(a);var c=cleverapps.UI.generateOnlyText("+",
cleverapps.styles.FONTS.BUTTON_TEXT);n.push(c)}n.push(s);var l=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin});return new cleverapps.UI.Button({button_images:cleverapps.UI.Button.Images.button_blue,width:t.width,height:t.height,content:l,fitTo:!1,onClicked:this.barrel.showItemAds.bind(this.barrel,e)})},listBundles:function(){return["reward_icons","units_shop"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{BARREL_ADS_TITLE:{size:35,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},BARREL_ADS_AMOUNT:{name:"nostroke",size:60,color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.BarrelAdsWindow={itemsMargin:65,contentMargin:20,contentPadding:{x:40,y:0},item:{width:350,height:590,buttonMargin:20,iconNode:{x:{align:"center"},y:{align:"center",dy:130},scale:1.5},strip:{width:360,height:150,x:{align:"center"},y:{align:"bottom",dy:120},amount:{x:{align:"center"},y:{align:"center",dy:7}}},title:{maxWidth:320,x:{align:"center"},y:{align:"bottom",dy:50}},
button:{margin:10,textWidth:190,iconMargin:5,width:350,height:120,rubyIcon:{scale:.85},adIcon:{x:{align:"center"},y:{align:"center",dy:10},scale:.8}}},Window:{contentOffset:-10,Border:{y:70}}};var Fogs=function(t){this.blocks={};var e=Object.keys(FogsConfig).filter(function(e){return!FogsConfig[e].opened&&-1===t.indexOf(e)});this.fakeUnits=this.readDefaults(Game.currentGame.level.content.field);var n=Game.currentGame,o=n.map.regions;e.forEach(function(e){var s=new FogBlock(e,FogsConfig[e]),i=o[e];if(i){if(n.isRegularGame)if(0<i.positions.filter(function(e){return n.map.getUnit(e.x,e.y)}).length)return void console.log("Units available in closed fog - "+e+" - open it");i.positions.forEach(function(e){var t=i.head&&e.x===i.head.x&&e.y===i.head.y;s.add(e.x,e.y,t)}),this.blocks[e]=s}},this),this.blockedGrounds=new FogBlockedGround};Fogs.ReadMapUnit=function(e){var t=Families[e.code].units[e.stage];return e.type=Families[e.code].type,"source"===e.type&&t.mineable&&(e.grounded=!0),
t.multicell&&(e.multicell=t.multicell),t.important&&(e.important=t.important),e},Fogs.prototype.readDefaults=function(e){var i={};return e.forEach(function(e){var t=(e=Fogs.ReadMapUnit(e)).x,s=e.y;void 0===i[t]&&(i[t]={}),i[t][s]=e}),i},Fogs.prototype.open=function(e){delete this.blocks[e],this.blockedGrounds.updateBlockedGrounds(),this.calcFogStates(),Game.currentGame.storeSave()},Fogs.prototype.save=function(){return cleverapps.substract(Object.keys(FogsConfig),Object.keys(this.blocks))},Fogs.prototype.onChangeGameLevel=function(){this.calcFogStates()},Fogs.prototype.onChangeWandsAmount=function(){for(var e in this.blocks)this.blocks[e].onChangeWandsAmount()},Fogs.prototype.calcFogStates=function(){for(var e in this.blocks){var t=this.blocks[e];t.state;t.calcState()}},Fogs.prototype.isOpened=function(e){return!this.blocks[e]},Fogs.prototype.getBlockById=function(e){return this.blocks[e]},Fogs.prototype.updateBlockedGrounds=function(){this.blockedGrounds.updateBlockedGrounds()},
Fogs.prototype.findAvailableFogBlock=function(){var e;for(var t in this.blocks){var s=this.blocks[t];s.state!==FogBlock.UNAVAILABLE&&(!e||e.state<s.state)&&(e=s)}return e},Fogs.prototype.findBlockWithProgress=function(){return cleverapps.values(this.blocks).filter(function(e){return e.state===FogBlock.CANTOPEN&&!e.isMoney()&&!e.isSpecial()}).sort(function(e,t){return e.getOpenPrice()-t.getOpenPrice()})[0]};var FogsConfig={fog0:{price:0,exp:0,headless:!0},fog1:{price:0,exp:0,headless:!0},fog2:{price:5,exp:10,conditions:{level:2}},fog3:{price:5,exp:10,parentFogId:"fog2",conditions:{level:3}},fog4_0:{price:5,exp:20,parentFogId:"fog3",conditions:{level:4}},fog4_1:{price:5,exp:25,parentFogId:"fog3",conditions:{level:4}},fog5:{price:15,exp:50,parentFogId:"fog2",conditions:{level:5}},fog6:{price:20,exp:50,parentFogId:"fog3",conditions:{level:6,hero:"king"}},fog7:{price:115,exp:50,parentFogId:"fog6",conditions:{level:7}},fog8:{price:225,exp:50,parentFogId:"fog7",conditions:{level:8,hero:"bear"
}},fog9:{price:500,exp:50,parentFogId:"fog7",conditions:{level:9,hero:"bear"}},fog10:{price:1e3,exp:50,parentFogId:"fog9",conditions:{level:10}},fog11:{price:1500,exp:50,parentFogId:"fog3",conditions:{level:11,hero:"elf"}},fog12:{price:1300,exp:50,parentFogId:"fog11",conditions:{level:12}},fog13:{price:1600,exp:50,parentFogId:"fog12",conditions:{level:13,hero:"warlock"}},fog14:{price:1950,exp:50,parentFogId:"fog13",conditions:{level:14}},fog15:{price:2350,exp:50,parentFogId:"fog13",conditions:{level:15}},fog16:{price:2800,exp:50,parentFogId:"fog15",conditions:{level:16,hero:"troll"}},fog17:{price:3300,exp:50,parentFogId:"fog16",conditions:{level:17}},fog18:{price:4160,exp:50,parentFogId:"fog17",conditions:{level:18}},moneyFog1:{price:240,money:!0,parentFogId:"fog4_1",conditions:{hero:"king"}},moneyFog2:{price:900,money:!0,parentFogId:"fog5",conditions:{level:7}},moneyFog3:{price:800,money:!0,parentFogId:"fog7",conditions:{hero:"bear"}},moneyFog4:{price:1100,money:!0,
parentFogId:"fog14",conditions:{hero:"warlock"}},fog99:{price:1e3,exp:50,available:!(Fogs.prototype.findFogReadyToOpen=function(){for(var e in this.blocks)if(!this.blocks[e].isMoney()&&this.blocks[e].canOpen())return this.blocks[e]}),conditions:{level:100}},dragonIsland:{special:!0,price:1e3,conditions:{hero:"king"}}},FogBlock=function(e,t){this.id=cleverapps.castType(e),this.options=t,this.tiles=[],this.state=FogBlock.UNAVAILABLE,this.clear(),this.getProgressTarget=function(){},this.onGetView=function(){}};FogBlock.prototype.clear=function(){this.onOpen=function(){},this.onUpdateState=function(){},this.onWandsChanged=function(){},this.onUpdateConditions=function(){},this.onUpdatePromptFinger=function(){}},FogBlock.prototype.getKey=function(){return this.id},FogBlock.prototype.isMoney=function(){return this.options&&this.options.money},FogBlock.prototype.isSpecial=function(){return this.options&&this.options.special},FogBlock.prototype.click=function(){if(
this.state!==FogBlock.UNAVAILABLE){var e=this.listNotFinishedConditions();e.length&&this.displayCondition(e[e.length-1]),this.isMoney()||(this.state===FogBlock.CANTOPEN&&this.displayWandsCondition(),this.state===FogBlock.CANOPEN&&Game.currentGame.onHintMessage("messages:Fog.clear.clearNow"));for(var t=0;t<this.tiles.length;t++)this.tiles[t].onClick()}},FogBlock.prototype.displayCondition=function(e){if(e.level){var t=Messages.get("Fog.clear.levelCondition",{level:e.level});Game.currentGame.onHintMessage(t,!0)}e.hero&&this.displayHeroCondition(e)},FogBlock.prototype.displayItemCondition=cleverapps.throttle(500,function(t){InfoView.CloseInfo();var s=Game.currentGame.map,e=s.listAvailableUnits({code:t.itemCode});if(0!==e.length){var i=[];e.forEach(function(e){if(e.highlight({duration:2*Highlight.ONE_PULSE}),-1===i.indexOf(e)){var t=s.bfs(e.x,e.y,e);t.length>i.length&&(i=t)}});var n=s.getUnit(i[0].x,i[0].y);s.onCenterTo(n.x,n.y,{callback:function(){InfoView.DisplayInfo(n)}}),
Game.currentGame.map.onZoomTo({zoom:1.3,direction:MergeScene.ZOOM_DIRECTION_IN}),Game.currentGame.onHintMessage(t.text)}else cleverapps.metha.display({focus:"FogLockLibrary",action:function(e){new UnitsLibraryWindow({code:t.itemCode,stage:Families[t.itemCode].units.length-1}),cleverapps.metha.onceNoWindowsListener=e}})}),FogBlock.prototype.displayHeroCondition=function(e){var t=Messages.get("Fog.clear.heroCondition",{hero:Messages.get("Units."+e.hero+".name")});Game.currentGame.unitsLibrary.getNextHero()===e.hero?this.displayItemCondition({itemCode:e.hero,text:t}):Game.currentGame.onHintMessage(t)},FogBlock.prototype.displayWandsCondition=function(){this.displayItemCondition({itemCode:"wands",text:Messages.get("Fog.clear.notEnoughWands",{wands:this.getOpenPrice()-Game.currentGame.wands})})},FogBlock.prototype.setState=function(e){if(this.state!==e){this.state=e,this.onUpdateState(this.state);for(var t=0;t<this.tiles.length;t++)this.tiles[t].updateState(this.state)
}else this.onUpdatePromptFinger(),e===FogBlock.NOTREADY&&this.onUpdateConditions(e)},FogBlock.prototype.onChangeWandsAmount=function(){this.state!==FogBlock.CANTOPEN&&this.state!==FogBlock.CANOPEN||(this.setState(this.canOpen()?FogBlock.CANOPEN:FogBlock.CANTOPEN),this.onWandsChanged())},FogBlock.prototype.calcState=function(){var e=FogBlock.UNAVAILABLE;this.isAvailable()&&(e=FogBlock.NOTREADY,this.isReady()&&(e=FogBlock.CANTOPEN,this.canOpen()&&(e=FogBlock.CANOPEN))),this.setState(e)},FogBlock.prototype.add=function(e,t,s){var i=new FogTile(e,t,this,s);s&&(this.head=i),this.tiles.push(i)},FogBlock.prototype.getOpenPrice=function(){return this.options.price},FogBlock.prototype.isAvailable=function(){return!(!1===this.options.available||!0===this.options.debugMode&&!cleverapps.config.debugMode)&&(void 0===this.options.parentFogId||Game.currentGame.fogs.isOpened(this.options.parentFogId))},FogBlock.prototype.showBuyWindow=function(){this.isMoney()&&cleverapps.metha.display({
focus:"BuyFogWindow",control:["MenuBarGoldItem"],action:function(e){new BuyFogWindow(this),cleverapps.metha.onceNoWindowsListener=e}.bind(this)})},FogBlock.prototype.buy=function(){return!(!this.isMoney()||!cleverapps.user.takeGold(this.getOpenPrice()))&&(this.open(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MONEY_FOG_RUBY,{amount:this.getOpenPrice()}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MONEY_FOG+"_"+this.id),!0)},FogBlock.prototype.isReady=function(){return!cleverapps.environment.isEditorScene()&&0===this.listNotFinishedConditions().length},FogBlock.prototype.canOpen=function(){if(this.isMoney())return!0;var e=Game.currentGame;return this.getOpenPrice()<=e.wands},FogBlock.prototype.listNotFinishedConditions=function(){var e=[];if(this.options.conditions){var t=Game.currentGame;for(var s in this.options.conditions)switch(s){case"level":(cleverapps.config.editorMode||t.gameLevel.getLevel()<this.options.conditions.level)&&e.push({level:this.options.conditions.level
});break;case"hero":!cleverapps.config.editorMode&&t.unitsLibrary.isHeroAvailable(this.options.conditions.hero)||e.push({hero:this.options.conditions.hero})}}return e},FogBlock.prototype.open=function(){var e=Game.currentGame;this.options.exp&&e.gameLevel.addExp(this.options.exp,this.head),this.onOpen();for(var t=0;t<this.tiles.length;t++)this.tiles[t].onOpen(),e.fogs.blockedGrounds.add(this.tiles[t].x,this.tiles[t].y);this.tiles=[],this.head=void 0,this.isMoney()||e.takeWands(this.getOpenPrice()),e.gameEvent(Merge.OPENFOG,{fog:this.id}),e.fogs.open(this.id),"dragonIsland"===this.id&&e.gameEvent(Merge.OPENDRAGON)},FogBlock.UNAVAILABLE=0,FogBlock.NOTREADY=1,FogBlock.CANTOPEN=2,FogBlock.CANOPEN=3;var FogTile=function(e,t,s,i){this.x=e,this.y=t,this.isHead=i,this.fogBlock=s,this.clear();var n=Game.currentGame;n.map.add(Map2d.LAYER_FOG,this.x,this.y,this),n.map.onAdd(Map2d.LAYER_FOG,this.x,this.y,this)};FogTile.prototype.clear=function(){this.onOpen=function(){},
this.onUpdateState=function(){},this.onClick=function(){}},FogTile.prototype.onClickEvent=function(){this.fogBlock.click()},FogTile.prototype.isBorderFog=function(e){var t=Game.currentGame.map.getFog(this.x+e.x,this.y+e.y);return void 0===t||t.fogBlock!==this.fogBlock},FogTile.prototype.getFakeUnit=function(){var e=Game.currentGame;if(e.fogs.fakeUnits[this.x])return e.fogs.fakeUnits[this.x][this.y]},FogTile.prototype.updateState=function(e){this.onUpdateState(e)},FogTile.prototype.open=function(){Game.currentGame.map.remove(Map2d.LAYER_FOG,this.x,this.y);var e=this.getFakeUnit();if(e){var t=new Unit(e);t.setPosition(this.x,this.y),Game.currentGame.map.add(Map2d.LAYER_UNITS,this.x,this.y,t),Game.currentGame.map.onAdd(Map2d.LAYER_UNITS,this.x,this.y,t),Game.currentGame.onUnitAvailable(t),t.onFogOpen()}this.onOpen(),this.fogBlock=void 0};var FogBlockedGround=function(){FogBlock.call(this,FogBlockedGround.ID),this.state=FogBlock.CANTOPEN,this.updateBlockedGrounds()}
;FogBlockedGround.prototype=Object.create(FogBlock.prototype),(FogBlockedGround.prototype.constructor=FogBlockedGround).prototype.click=function(){Game.currentGame.onHintMessage(Messages.get("FogBlockedGround.clickMessage"))},FogBlockedGround.prototype.updateBlockedGrounds=function(){var r={},a=ISO_NEIGHBORS,c=[],s=0,l=Game.currentGame.map,i=function(e){var t=c[e].cell,s=c[e].status;if(!(s<=(r[t.x+t.y*l.getWidth()]||0))&&l.isGround(t.x,t.y)){var i=l.getFog(t.x,t.y);if(!i||i.fogBlock===this){r[t.x+t.y*l.getWidth()]=s;var n=i?i.getFakeUnit():l.getUnit(t.x,t.y);n&&(n instanceof Unit&&n.findComponent(Grounded)||n.grounded)&&(s=1);for(var o=0;o<a.length;o++)c.push({cell:cc.p(t.x+a[o].x,t.y+a[o].y),status:s})}}}.bind(this);Object.keys(FogsConfig).forEach(function(e){var t=l.regions[e]&&l.regions[e].head;if(t&&!r[t.x+t.y*l.getWidth()])for(c.push({cell:t,status:2});s<c.length;)i(s++)});for(var e=l.onDiscoverView(),t=0;t<l.getHeight();t++)for(var n=0;n<l.getWidth();n++)1!==r[n+t*l.getWidth(
)]||l.getFog(n,t)||e&&!e.getCell(Map2d.LAYER_FOG,n,t)||this.add(n,t);this.tiles=this.tiles.filter(function(e){var t=1!==r[e.x+e.y*l.getWidth()];return t&&e.open(),!t})},FogBlockedGround.ID="blockedGroundFog";var FogBlockView=cc.Node.extend({ctor:function(e){this._super(),this.fogBlock=e,this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setAnchorPoint2(),e.onGetView=this.createListener(function(){return this}.bind(this)),e.onOpen=this.onOpen.bind(this),e.onUpdateState=this.onUpdateState.bind(this),e.onUpdateConditions=this.onUpdateConditions.bind(this),e.onUpdatePromptFinger=this.updatePromptFinger.bind(this),e.onWandsChanged=this.onWandsChanged.bind(this),e.getProgressTarget=this.getProgressTarget.bind(this),this.onUpdateState(e.state,!0),this.onWandsChanged()},hideBlocker:function(){this.blocker&&(this.blocker.runAction(new cc.Sequence(new cc.ScaleTo(.2,0),new cc.RemoveSelf)),this.blocker=void 0)},getProgressTarget:function(){return this.opener},
createBlocker:function(e,t){for(var s,i=cleverapps.styles.FogBlockView.blocker,n=[],o=0;o<e.length;o++){var r=new cc.Sprite(bundles.fog.frames.fog_blocker_png);if(n.push(r),r.setCascadeColorEnabled(!0),r.setCascadeOpacityEnabled(!0),e[o].hero&&(s=bundles.unit_icons.frames["small_icon_"+e[o].hero])){var a=new cc.Sprite(s);a.setPositionRound(i.icon.x,i.icon.y),r.addChild(a)}if(e[o].level){var c=cleverapps.UI.generateImageText(e[o].level,cleverapps.styles.FONTS.FOG_BLOCKER_TEXT);c.setPositionRound(i.text.x,i.text.y),c.fitTo(i.content.width,i.content.height),r.addChild(c)}cleverapps.UI.onClick(r,this.fogBlock.displayCondition.bind(this.fogBlock,e[o]));var l=new cc.Sprite(bundles.fog.frames.fog_blocker_cloud_png);l.setPositionRound(i.cloud.x,i.cloud.y),r.addChild(l)}this.blocker&&this.blocker.removeFromParent(),this.blocker=new cleverapps.Layout(n,{direction:cleverapps.UI.HORIZONTAL,margin:i.margin}),this.blocker.setCascadeColorEnabled(!0),this.blocker.setCascadeOpacityEnabled(!0),
this.addChild(this.blocker),this.blocker.setPositionRound(i.position),t||(this.blocker.setScale(0),this.blocker.runAction(new cc.ScaleTo(.3,1))),cleverapps.config.debugMode&&cleverapps.UI.onClick(this.blocker,function(){this.lastClick>Date.now()-200?(Game.currentGame.addWands(this.fogBlock.options.price),this.fogBlock.open()):this.lastClick=Date.now()}.bind(this),{noThrottle:!0})},addBlocker:function(e,t){e===FogBlock.NOTREADY?this.createBlocker(this.fogBlock.listNotFinishedConditions(),t):this.hideBlocker()},hideOpener:function(){this.opener&&(this.opener.runAction(new cc.Sequence(new cc.ScaleTo(.2,0),new cc.RemoveSelf)),this.opener=void 0)},hideOpenerWindow:function(){this.openerWindow&&(this.openerWindow.runAction(new cc.Sequence(new cc.ScaleTo(.2,0),new cc.RemoveSelf)),this.openerWindow=void 0)},onWandsChanged:function(){if(this.opener&&!this.fogBlock.isMoney()){var e=Game.currentGame.wands,t=this.fogBlock.getOpenPrice(),s=t<e?t:e;if(this.opener.currentAmount===s)return
;this.opener.text.stopAllActions();var i=cleverapps.UI.generateImageText(s,cleverapps.styles.FONTS.WAND_PROGRESS_TEXT),n=cleverapps.UI.generateImageText("/"+t,cleverapps.styles.FONTS.WAND_PROGRESS_TEXT),o=new cleverapps.Layout([i,n],{direction:cleverapps.UI.HORIZONTAL});o.width>cleverapps.styles.FogBlockView.opener.text.width&&o.setScale(cleverapps.styles.FogBlockView.opener.text.width/o.width),this.opener.text.removeAllChildren(),this.opener.text.addChild(o),this.opener.text.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.4),new cc.ScaleTo(.15,1)));var r=e/t*100;void 0!==this.opener.lastPercent?this.opener.bar.animatedChange(r-this.opener.lastPercent):this.opener.bar.setPercentage(r),this.opener.lastPercent=r,this.opener.currentAmount=s}},addMoneyOpenner:function(e){var t=cleverapps.styles.FogBlockView.opener;this.opener=new cc.Node,this.opener.setAnchorPoint2(),this.opener.setContentSize2(t.size),this.opener.setPositionRound(t),this.addChild(this.opener);var s=new cc.Sprite(
bundles.merge.frames.seller_icon);s.setPositionRound(t.money.sellerIcon),cleverapps.UI.onClick(s,this.handleBuy.bind(this)),cleverapps.UI.applyHover(s),this.opener.addChild(s),e||(this.opener.setScale(0),this.opener.runAction(new cc.ScaleTo(.3,1)))},handleBuy:function(){this.fogBlock.showBuyWindow()},addOpenner:function(e,t){if(e===FogBlock.CANTOPEN||e===FogBlock.CANOPEN){if(this.fogBlock.isMoney())return void this.addMoneyOpenner(t);var s=cleverapps.styles.FogBlockView.opener;if(!this.opener){this.opener=cleverapps.UI.createScale9Sprite(bundles.merge.frames.bar_bg_png),this.opener.setContentSize2(s.size),this.opener.setPositionRound(s),this.addChild(this.opener),this.opener.bar=new ScaledProgressBar(bundles.merge.frames.bar_png),this.opener.bar.setDimension(s.bar.size),this.opener.bar.setPositionRound(s.bar),this.opener.addChild(this.opener.bar);var i=new cc.Sprite(bundles.menubar.frames.merge_wand_png);i.setPositionRound(s.icon),i.setScale(s.icon.scale),this.opener.addChild(i),
this.opener.text=new cc.Node,this.opener.text.setAnchorPoint2(),this.opener.text.setPositionRound(s.text),this.opener.addChild(this.opener.text),this.onWandsChanged(),t||(this.opener.setScale(0),this.opener.runAction(new cc.ScaleTo(.3,1)))}}else this.hideOpener()},addOpennerWindow:function(e,t){if(e!==FogBlock.CANOPEN||this.fogBlock.isMoney())this.hideOpenerWindow();else{var s=cleverapps.styles.FogBlockView.openerWindow,i=cleverapps.styles.CommonButtons;this.openerWindow=cleverapps.UI.createScale9Sprite(bundles.mergeui.frames.background);var n=cleverapps.UI.generateOnlyText(Messages.get("Fog.clear"),cleverapps.styles.FONTS.INFO_TEXT),o=cleverapps.UI.generateImageText(this.fogBlock.getOpenPrice(),cleverapps.styles.FONTS.LIGHT_BUTTON_IMAGE_TEXT),r=new cc.Sprite(bundles.fog.frames.button_wand_png),a=new cleverapps.Layout([r,o],{direction:cleverapps.UI.HORIZONTAL,margin:i.margin}),c=this.openerWindow.button=new cleverapps.UI.Button({width:s.button.width,height:s.button.height,
padding:i.padding,contentOffset:i.contentOffset,fitTo:i.fitTo,content:a,ignoreOnTouchMoved:!0,onClicked:this.handleOpen.bind(this),button_images:cleverapps.UI.Button.Images.button_green});c.adviceTarget="openfog";var l=new cleverapps.Layout([c,n],{direction:cleverapps.UI.VERTICAL,margin:s.content.margin,padding:s.content.padding});this.openerWindow.setContentSize(l.getContentSize()),this.openerWindow.addChild(l),l.setPositionRound(this.openerWindow.width/2,this.openerWindow.height/2);var p=new cc.Sprite(bundles.mergeui.frames.pointer);p.setAnchorPoint2(),p.setPositionRound(l.width/2,s.pointer.dy),p.setLocalZOrder(-1),l.addChild(p),this.addChild(this.openerWindow),this.openerWindow.setPositionRound(s),t||(this.openerWindow.setScale(0),this.openerWindow.runAction(new cc.ScaleTo(.3,1))),this.updatePromptFinger()}},updatePromptFinger:function(){if(this.openerWindow&&!this.openerWindow.button.finger&&!Game.currentGame.tutorial.isActive(
)&&this.fogBlock===Game.currentGame.fogs.findAvailableFogBlock()){var e=this.openerWindow.button.finger=new FingerView({scaleX:.8,scaleY:.8});this.openerWindow.button.addChild(e),e.setPositionRound(this.openerWindow.button.width/2,this.openerWindow.button.height/2),e.standardLoop({delay:1,runOnce:!0,delayOnBegin:!0})}},onUpdateState:function(e,t){this.addBlocker(e,t),this.addOpenner(e,t),this.addOpennerWindow(e,t)},onUpdateConditions:function(e){this.addBlocker(e,!0)},handleOpen:function(){this.fogBlock.open()},onOpen:function(){this.fogBlock.clear(),this.fogBlock=void 0,this.hideBlocker(),this.hideOpener(),this.hideOpenerWindow(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.RemoveSelf))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{FOG_BLOCKER_TEXT:{name:"nostroke",size:36,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},WAND_PROGRESS_TEXT:{name:"default",size:30},BUY_BUTTON_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,
stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.FogBlockView={openerWindow:{x:{align:"center"},y:{align:"top",dy:250},pointer:{dy:-6},content:{margin:15,padding:{x:20,y:20}},button:{width:160,height:60}},opener:{x:{align:"center"},y:{align:"top",dy:70},size:{width:200,height:40},text:{width:130,x:{align:"center"},y:{algin:"center",dy:2}},icon:{x:{align:"left",dx:-42},y:{algin:"center",dy:0},scale:.8},bar:{size:{width:190,height:32},x:5,y:6},money:{sellerIcon:{x:{align:"center",dx:30},y:{align:"center"}}}},blocker:{margin:16,content:{width:44,height:44},position:{x:{align:"center"},y:{align:"center",dy:100}},text:{x:{align:"center",dx:7},y:{align:"center",dy:-29}},icon:{x:{align:"center",dx:4},y:{align:"center",dy:-28}},cloud:{x:{align:"center",dx:1},y:{align:"bottom",dy:-1}}}};var FogTileView=cc.Node.extend({ctor:function(e){if(this._super(),this.fogTile=e,this.setCascadeColorEnabled(!0),
this.setCascadeOpacityEnabled(!0),this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.Map2dView.cell),this.tileView=new cc.Node,this.tileView.setCascadeColorEnabled(!0),this.tileView.setCascadeOpacityEnabled(!0),this.tileView.setContentSize2(this.getContentSize()),this.tileView.setPositionRound(this.width/2,this.height/2),this.addChild(this.tileView),e.onOpen=this.onOpen.bind(this),e.onUpdateState=this.onUpdateState.bind(this),e.onClick=this.onClick.bind(this),this.onUpdateState(e.fogBlock.state,!0),e.isHead&&!e.fogBlock.options.headless&&!cleverapps.config.editorMode){var t=Game.currentGame.map.getView(),s=this.fogBlockView=new FogBlockView(e.fogBlock);s.setPositionRound(t.alignInIsometricGrid(e.x,e.y)),s.setLocalZOrder(-s.y),t.animations.addChild(s)}},onClick:function(){this.fogTile.fogBlock.isMoney()&&this.fogTile.fogBlock.state===FogBlock.CANOPEN?this.fogTile.fogBlock.showBuyWindow():this.clickAnimation()},onUpdateState:function(e,t){if(
e===FogBlock.CANTOPEN||e===FogBlock.CANOPEN){if(this.state!==FogTileView.GROUND_STATE){if(this.state===FogTileView.FULL_STATE){this.sprite.removeFromParent();for(var s=0;s<this.borders.length;s++)this.borders[s].removeFromParent();this.borders=[]}this.tileView.setAnchorPoint2(),this.sprite=new cc.Sprite(bundles.tiles.frames.fog2_png);var i=Game.currentGame.map.getView().getCell(Map2d.LAYER_GROUND,this.fogTile.x,this.fogTile.y);if(this.sprite.setPositionRound(i.width/2,i.height/2),i.addChild(this.sprite),this.fogTile.fogBlock.isMoney()){this.sprite.setColor(new cc.Color(255,150,255,255));var n=new cleverapps.Spine(bundles.tiles.jsons.buy_fog_tile_json);n.setTimeScale(.5+Math.random()),n.setPositionRound(this.sprite.width/2,this.sprite.height/2),this.sprite.addChild(n),n.setAnimation(0,"animation",!0)}this.state=FogTileView.GROUND_STATE;var o=this.fogTile.getFakeUnit();if(o){var r=this.unitNode=new cc.Node;r.setPositionRound(this.tileView.width/2,this.tileView.height/2),
r.setCascadeOpacityEnabled(!0),r.setCascadeColorEnabled(!0),r.setOpacity(120),this.fogTile.fogBlock.isMoney()?r.setColor(new cc.Color(255,100,100,255)):r.setColor(new cc.Color(0,150,255,255)),this.tileView.addChild(r);var a=UnitView.getUnitStyles(o);r.setAnchorPoint2(a.anchorX,a.anchorY);var c=UnitView.getUnitImage(o);if(r.setContentSize(c.getContentSize()),c.setPositionRound(r.width/2,r.height/2),r.addChild(c),c.clearTrack&&c.clearTrack(0),o.grounded){var l=new cc.Sprite(GroundedView.getImage(o.x,o.y));l.setOpacity(130),l.setPositionRound(this.sprite.width/2,this.sprite.height/2),this.sprite.addChild(l)}o.multicell&&MultiCellView(o.multicell,r)}}this.runRepeatAnimation(e)}else if(this.state!==FogTileView.FULL_STATE){a=cleverapps.styles.FogTileView.borders;var p=bundles.fog.frames.fog_png;cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.customFog&&(p=bundles.ads_map2d.frames.fog_png),this.tileView.setAnchorPoint2(cleverapps.styles.FogTileView.anchorX,
cleverapps.styles.FogTileView.anchorY),this.sprite=new cc.Sprite(p),this.sprite.setPositionRound(a.center),this.tileView.addChild(this.sprite),this.borders=[];var d={down_left:{x:-1,y:0},down_right:{x:0,y:1},up_left:{x:0,y:-1},up_right:{x:1,y:0}};for(var h in d)if((!cleverapps.config.wysiwygMode||!cleverapps.flags.wysiwyg.customFog)&&this.fogTile.isBorderFog(d[h])){var u=new cc.Sprite(bundles.fog.frames["fog_"+h+"_png"]);u.setPositionRound(a[h]),this.tileView.addChild(u),this.borders.push(u)}this.state=FogTileView.FULL_STATE}},runRepeatAnimation:function(e){e!==FogBlock.CANOPEN||this.fogTile.fogBlock.options.headless||this.fogTile.fogBlock.isMoney()||(this.tileView.stopAllActions(),this.tileView.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(1,255),new cc.FadeTo(2,70).easing(cc.easeIn(1.5))))))},clickAnimation:function(){var e=this;this.state===FogTileView.GROUND_STATE&&(e=this.sprite),this.tileView.stopAllActions();var t,s=this.fogTile.fogBlock.state,i=230
;s!==FogBlock.CANTOPEN&&s!==FogBlock.CANOPEN||(i=210),t=new cc.Sequence(new cc.TintTo(.3,i,i,i),new cc.TintTo(.3,255,255,255)),e.runAction(new cc.Sequence(t,t,t,t,t,new cc.CallFunc(function(){this.runRepeatAnimation(s)}.bind(this))))},onOpen:function(){this.fogTile.clear(),this.fogTile=void 0,this.stopAllActions(),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.RemoveSelf)),this.sprite.stopAllActions(),this.sprite.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.RemoveSelf)),this.unitNode&&(this.unitNode.removeFromParent(),this.unitNode=void 0),this.tileView.stopAllActions(),this.tileView.runAction(new cc.FadeOut(.2))},onCellSetVisible:function(e){this.fogBlockView&&this.fogBlockView.setVisible(e)}});FogTileView.FULL_STATE=0,FogTileView.GROUND_STATE=1,cleverapps.styles.FogTileView={anchorX:.5,anchorY:.22,borders:{center:{x:{align:"center",dx:1},y:{align:"center",dy:-13}},down_left:{x:{align:"left",dx:-12},y:{align:"bottom",dy:-32}},down_right:{x:{align:"right",dx:10},y:{
align:"bottom",dy:-36}},up_left:{x:{align:"left",dx:-12},y:{align:"top",dy:4}},up_right:{x:{align:"right",dx:16},y:{align:"top",dy:10}}}};var QuestsConfig={wheat_3:{trigger:{unit:{code:"dwarf",stage:1}},tutorial:"wheat_3",quest:{silent:!0,type:Merge.SPAWN,unit:{code:"wheat",stage:3}}},dishes_0:{trigger:{unit:{code:"wheat",stage:3}},tutorial:"dishes_0",quest:{type:Merge.SPAWN,unit:{code:"dishes",stage:0}}},woodsource_1_0:{trigger:{unit:{code:"woodsource",stage:1}},quest:{type:Merge.OPENFOG}},woodsource_1_1:{trigger:{unit:{code:"woodsource",stage:1}},tutorial:"woodsource_1_1",quest:{type:Merge.MINE,unit:{code:"woodsource",stage:1}}},candies_4:{trigger:{unit:{code:"candies",stage:4}},quest:{type:Merge.HARVEST,unit:{code:"candies",stage:4}}},wheat_4:{trigger:{unit:{code:"wood",stage:8}},quest:{type:Merge.HARVEST,unit:{code:"wheat",stage:4}}},dragonisland_1:{trigger:{unit:{code:"king",stage:3}},dynamic:{filter:function(){return!Game.currentGame.unitsLibrary.isOpened({code:"dragonmine",
stage:0})},getIcon:function(){return UnitView.getUnitImage({code:"dragonmine",stage:0})},attentionTo:function(){var e=Game.currentGame.fogs.getBlockById("dragonIsland");return e&&e.head}},quest:{type:Merge.OPENDRAGON}},woodgenerator_1:{trigger:{unit:{code:"woodgenerator",stage:0}},tutorial:"woodgenerator_1",dynamic:{getTitle:function(){return Messages.get("Quest.woodgenerator_1.title",{name:Game.currentGame.unitsLibrary.getUnitName({code:"woodgenerator",stage:1})})}},quest:{type:Merge.SPAWN,unit:{code:"woodgenerator",stage:1}}},woodgenerator_2:{trigger:{unit:{code:"woodgenerator",stage:1}},dynamic:{getTitle:function(){return Messages.get("Quest.woodgenerator_1.title",{name:Game.currentGame.unitsLibrary.getUnitName({code:"woodgenerator",stage:2})})}},quest:{type:Merge.SPAWN,unit:{code:"woodgenerator",stage:2}}}},RepeatedQuests={r_collectfruit:{dynamic:{getTitle:function(e){return Messages.get("Quest.r_collectfruit.title",{name:Game.currentGame.unitsLibrary.getFamilyName(e.code)})},
getUnit:function(){var e=Game.currentGame.unitsLibrary.listAvailableByType("fruit"),t=cleverapps.Random.choose(e);if(t)return{code:t,stage:4}}},quest:{type:Merge.HARVEST}},r_createfruit:{dynamic:{getTitle:function(e){return Messages.get("Quest.r_createfruit.title",{name:Game.currentGame.unitsLibrary.getFamilyName(e.code)})},getUnit:function(){var e=Game.currentGame.unitsLibrary.listAvailableByType("fruit"),t=cleverapps.Random.choose(e);if(t)return{code:t,stage:3}}},quest:{type:Merge.SPAWN}},r_bonusmerge:{dynamic:{getTitle:function(){return Messages.get("Quest.r_bonusmerge.title")},getIcon:function(){return new cc.Sprite(bundles.repeated_quests.frames.bonus_merge)}},quest:{type:Merge.MERGE,minUnits:5}},r_open_freechest:{dynamic:{getTitle:function(e){return Messages.get("Quest.r_open_chest.title",{name:Game.currentGame.unitsLibrary.getUnitName(e)})}},quest:{type:Merge.PRIZE_HARVESTED,unit:{code:"freechest",stage:0}}},r_open_herochest:{dynamic:{getTitle:function(e){return Messages.get(
"Quest.r_open_chest.title",{name:Game.currentGame.unitsLibrary.getUnitName(e)})}},quest:{type:Merge.PRIZE_HARVESTED,unit:{code:"herochest",stage:0}}},r_open_randomchest:{dynamic:{getTitle:function(e){return Messages.get("Quest.r_open_randomchest.title",{name:Game.currentGame.unitsLibrary.getFamilyName(e.code)})},getIcon:function(e){return UnitView.getUnitImage(UnitsLibrary.ListByCode(e.code).pop())},getUnit:function(){var e=Game.currentGame.unitsLibrary.listAvailableByType("chest");e=cleverapps.intersect(e,["sacks","woodchest","stonechest","wagonchest","bamboochest","sapphirechest","magicalwoodchest"]);var t=cleverapps.Random.choose(e);if(t)return{code:t}}},quest:{type:Merge.PRIZE_HARVESTED}},r_use_randomcastle:{dynamic:{getTitle:function(e){var t=Game.currentGame.unitsLibrary.getUnitName(e);return Messages.get("Quest.r_use_randomcastle.title",{name:t})},getIcon:function(e){return UnitView.getUnitImage(UnitsLibrary.ListByCode(e.code).pop())},getUnit:function(){
var e=Game.currentGame.unitsLibrary.listAvailableByType("resource").map(function(e){return UnitsLibrary.ListByCode(e).pop()});e=Game.currentGame.map.listAvailableUnits(e);var t=cleverapps.Random.choose(e);if(t)return{code:t.code,stage:t.stage}}},quest:{type:Merge.PRIZE_HARVESTED}},r_use_randommine:{dynamic:{getTitle:function(e){return Messages.get("Quest.r_use_randommine.title",{name:Game.currentGame.unitsLibrary.getFamilyName(e.code)})},getIcon:function(e){return UnitView.getUnitImage(UnitsLibrary.ListByCode(e.code)[0])},getUnit:function(){var e=Game.currentGame.map.listAvailableUnits({type:"generator"}),t=cleverapps.Random.choose(e);if(t)return{code:t.code}}},quest:{type:Merge.COMPLETE_MINING}},r_builditems:{dynamic:{getTitle:function(){return Messages.get("Quest.r_builditems.title")},getIcon:function(){return new cc.Sprite(bundles.repeated_quests.frames.build_object)}},quest:{type:Merge.BUILD,unit:{type:"resource"}}}};Object.assign(QuestsConfig,RepeatedQuests),Object.keys(Families
).forEach(function(e){var i=Families[e];-1!==["hero","resource","magicplant"].indexOf(i.type)&&Unit.getAllStagesTargets(e).filter(function(e){return 0!==e.stage&&!i.units[e.stage].temporary&&("dwarf"!==e.code&&!QuestsConfig[Unit.GetKey(e)]||void 0)}).forEach(function(e){var t=i.units[e.stage],s=t.buildable&&0<cleverapps.parseInterval(t.buildable);QuestsConfig[Unit.GetKey(e)]={trigger:{unit:{code:e.code,stage:e.stage-1}},quest:{type:s?Merge.BUILD:Merge.SPAWN,unit:e}},"magicplant"===i.type&&1===e.stage&&delete QuestsConfig[Unit.GetKey(e)].trigger})}),function(){var i=cc.loader.getRes(bundles.main.jsons.quests_data_json).quests;Object.keys(QuestsConfig).forEach(function(e){var t=QuestsConfig[e];t.quest.id=e,t.dynamic=t.dynamic||{};var s=i[e];s?(t.dialogue=s.dialogue,void 0!==s.goal?(t.quest.goal=s.goal,void 0!==s.prize?t.quest.prize=s.prize:console.error("No prize specified for quest '"+e+"'")):console.error("No goal specified for quest '"+e+"'")):console.error("No data for quest '"+e+"'"
)})}();var MergeAdviceBaseLogic=function(e){e=e||{};var t=cleverapps.toArray(e.targets);t&&0<t.length&&(this.targets=t);var s=cleverapps.toArray(e.priority);s&&0<s.length&&(this.priority={},s.forEach(function(e,t){this.priority[Unit.GetKey(e)]=t+1},this))};MergeAdviceBaseLogic.prototype.findMove=function(){},MergeAdviceBaseLogic.prototype.listAvailableUnits=function(){var e=Game.currentGame.map.listAvailableUnits();if(this.targets){var s={};this.targets.forEach(function(e){s[Unit.GetKey(e)]=[]}),e.forEach(function(e){var t=Unit.GetKey(e);s[t]&&s[t].push(e)}),e=this.targets.reduce(function(e,t){return e.concat(s[Unit.GetKey(t)])},[])}return this.priority&&(e=e.sort(function(e,t){return this.getPriorityIndex(e)-this.getPriorityIndex(t)}.bind(this))),e},MergeAdviceBaseLogic.prototype.isPriorityUnit=function(e){return this.getPriorityIndex(e)<1e4},MergeAdviceBaseLogic.prototype.getPriorityIndex=function(e){return this.priority&&this.priority[Unit.GetKey(e)]||1e4}
;var MergeAdviceMergeLogic=function(e){e=e||{},MergeAdviceBaseLogic.call(this,e),this.minUnits=e.minUnits||3,this.highlight=e.highlight};MergeAdviceMergeLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceMergeLogic.prototype.constructor=MergeAdviceMergeLogic).prototype.getShowHintTimeout=function(){return 1500},MergeAdviceMergeLogic.prototype.findMove=function(){var e=function(e){var t=[];if(cleverapps.values(e).forEach(function(e){t=t.concat(e)}),0!==t.length){var s,i=t.filter(function(e){return e.cells.length>=this.minUnits},this),n=[],o=[];if(i.length)o=(s=function(e){for(var t=0;t<e.length;t++)if(e[t].isScreenCluster())return e[t]}(i)||i.sort(MergeAdviceMergeLogic.Cluster.WEIGHT_COMPARATOR)[0]).cells,n=this.merge(s);else{var r=this.chooseBiggerClustersFamily(e);if(r.amount>=this.minUnits){var a=r.clusters.slice().sort(MergeAdviceMergeLogic.Cluster.WEIGHT_COMPARATOR);2<=a.length&&(n=this.combine(a.slice(0,2)),o=a[0].cells.concat(a[1].cells)),0===n.length&&(
n=this.combine(r.clusters),o=r.clusters.reduce(function(e,t){return e.concat(t.cells)},[]))}}if(n&&2<=n.length){var c=n[1];if(o.sort(function(e,t){return e===c?-1:1}),this.highlight){var l=t.reduce(function(e,t){return Unit.Equals(s,t)?e.concat(t.cells):e},[]);n=s.cells}return{mergeCluster:o,highlight:l,cells:n}}}}.bind(this),t=this.getClusters(),s={},i=t;if(this.priority)for(var n in i={},t){(this.priority[n]?s:i)[n]=t[n]}return e(s)||e(i)},MergeAdviceMergeLogic.prototype.merge=function(e){cleverapps.Random.seed(100*e.cells.length+e.stage);var r=cleverapps.shuffle(e.cells.slice()),a=Game.currentGame.map,s=r.filter(function(e,t){var s=a.getUnit(e.x,e.y);a.layers[Map2d.LAYER_UNITS][e.y][e.x]=void 0;var i=r[(t+1)%r.length],n=a.getUnit(i.x,i.y).listMergeAtPoint(i.x,i.y),o=n&&r.length-1===n.length;return a.layers[Map2d.LAYER_UNITS][e.y][e.x]=s,o},this)[0];if(s){var t=cleverapps.shuffle(e.cells.slice()).filter(function(t){return ISO_NEIGHBORS.some(function(e){
return s.x+e.x===t.x&&s.y+e.y===t.y})})[0];return[s,t]}},MergeAdviceMergeLogic.prototype.getClusters=function(){var n={},o={},r={};return this.listAvailableUnits().forEach(function(e){if(!o[e.x+1e4*e.y]&&e.isMergeable(e)){var t=e.listMergeAtPoint(e.x,e.y)||[cc.p(e.x,e.y)],s=new MergeAdviceMergeLogic.Cluster(e.code,e.stage,t);t.forEach(function(e){o[e.x+1e4*e.y]=!0});var i=e.getKey();n[i]||(n[i]=[]),n[i].push(s),r[e.code]||(r[e.code]=cleverapps.arrayFill(Families[e.code].units.length,0)),r[e.code][e.stage]+=t.length}},this),n},MergeAdviceMergeLogic.prototype.chooseBiggerClustersFamily=function(e){var t,s;for(var i in e){var n=e[i],o=0;n.forEach(function(e){o+=e.cells.length}),(!s||s<o)&&(t=n,s=o)}return{clusters:t,amount:s}},MergeAdviceMergeLogic.prototype.combine=function(e){var t=(e=e.slice().sort(function(e,t){return e.cells.length-t.cells.length})).reverse().filter(function(e){return 2<=e.cells.length||this.findCombineAdjacentCell(e.cells[0])},this)[0],s=e.filter(function(e){
return e!==t})[0];if(t&&s)return cleverapps.Random.seed(100*e.length+s.stage),[cleverapps.Random.choose(s.cells),2<=t.cells.length?cleverapps.Random.choose(t.cells):this.findCombineAdjacentCell(t.cells[0])]},MergeAdviceMergeLogic.prototype.findCombineAdjacentCell=function(i){var n,o,r=Game.currentGame.map;return[{x:0,y:1},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}].forEach(function(e){var t=cc.p(i.x+e.x,i.y+e.y);if(r.isGround(t.x,t.y)&&!r.getFog(t.x,t.y)){var s=r.getUnit(t.x,t.y);s?s.isMoveable()&&(o=t):n=t}},this),n||o},MergeAdviceMergeLogic.Cluster=function(e,t,s){this.code=e,this.stage=t,this.cells=s},MergeAdviceMergeLogic.Cluster.prototype.getWeight=function(){var e=Game.currentGame.map.getScreenCenterCell();return this.weight&&cc.pointEqualToPoint(e,this.weight.center)||(this.weight={center:e,value:1e3*Boolean(this.isScreenCluster())+this.cells.length+1/(this.getDistanceToCenter()+1)}),this.weight.value},MergeAdviceMergeLogic.Cluster.prototype.getDistanceToCenter=function(){
var i=Game.currentGame.map.getScreenCenterCell();return this.cells.reduce(function(e,t){var s=Math.abs(t.x-i.x)+Math.abs(t.y-i.y);return s<e?s:e},0)},MergeAdviceMergeLogic.Cluster.prototype.isScreenCluster=function(){return this.cells.every(function(e){return Game.currentGame.map.isScreenCell(e.x,e.y)})},MergeAdviceMergeLogic.Cluster.WEIGHT_COMPARATOR=function(e,t){return t.getWeight()-e.getWeight()};var MergeAdviceSpawnLogic=function(e){MergeAdviceBaseLogic.call(this,e);var t=cleverapps.toArray(e&&e.prizes);t&&0<t.length&&(this.prizes=t)};MergeAdviceSpawnLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceSpawnLogic.prototype.constructor=MergeAdviceSpawnLogic).prototype.checkUnitPrizes=function(e){if("dishes"===e.code||"chest"===e.getType())return!0;var t=e.prizes||[];if("hero"===e.getType()&&0===t.length){var s=e.findComponent(MakesOrder);s.state===MakesOrder.STATE_EMPTY&&s.order();var i=s.getPrizeUnitInfo();i&&t.push(i)}return 0<t.length&&(
!this.prizes||cleverapps.contains(t,this.prizes,Unit.GetKey))},MergeAdviceSpawnLogic.prototype.findMove=function(){var e=this.listAvailableUnits().filter(this.checkUnitPrizes.bind(this))[0],t={};e&&Game.currentGame.map.findEmptySlot(e.x,e.y)&&(t.cells=[cc.p(e.x,e.y)]);var s=cleverapps.windows.currentWindow();if((s instanceof OrdersWindow&&e&&"hero"===e.getType()||s instanceof OpenChestWindow&&e&&"chest"===e.getType())&&(t.window=Merge.SPAWN),t.cells||t.window)return t};var MergeAdviceHarvestLogic=function(e){MergeAdviceBaseLogic.call(this,e)};MergeAdviceHarvestLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceHarvestLogic.prototype.constructor=MergeAdviceHarvestLogic).prototype.findMove=function(){var e=this.listAvailableUnits().filter(function(e){return e.getData().collectible||e.getData().divideCollectible||e.getData().resourceCollectible},this)[0];if(e)return{cells:[cc.p(e.x,e.y)]}};var MergeAdviceMineLogic=function(e){MergeAdviceBaseLogic.call(this,e)}
;MergeAdviceMineLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceMineLogic.prototype.constructor=MergeAdviceMineLogic).prototype.findMove=function(){if(Game.currentGame.workers.findFree()){var e=this.listAvailableUnits().map(function(e){return e.findComponent(Mineable)}).filter(function(e){return e&&e.state===Mineable.STATES.WAIT&&!Game.currentGame.workers.findAssigned(e.unit)}).sort(function(e,t){return t.mined-e.mined})[0];return e?{cells:[cc.p(e.unit.x,e.unit.y)],unitView:["energy"]}:void 0}};var MergeAdviceOpenFogLogic=function(e){MergeAdviceBaseLogic.call(this,e)};MergeAdviceOpenFogLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceOpenFogLogic.prototype.constructor=MergeAdviceOpenFogLogic).prototype.findMove=function(){for(var e=0;e<this.targets.length;++e){var t=Game.currentGame.fogs.blocks[this.targets[e]];if(t&&t.head&&t.state===FogBlock.CANOPEN)return{cells:[cc.p(t.head.x,t.head.y)],fogView:["openfog"]}}}
;var MergeAdviceSpeedupLogic=function(e){MergeAdviceBaseLogic.call(this,e)};MergeAdviceSpeedupLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceSpeedupLogic.prototype.constructor=MergeAdviceSpeedupLogic).prototype.findMove=function(){for(var e=Game.currentGame.workers.listBusy().sort(function(e,t){return e.getTimeLeft()-t.getTimeLeft()}),t=0;t<e.length;++t){var s=e[t],i=s.unit.findComponent(Buildable);if(i&&0!==i.time)return{cells:[cc.p(s.unit.x,s.unit.y)],unitView:["speedup"]};var n=s.unit.findComponent(Mineable);if(n&&0!==cleverapps.parseInterval(n.getTask().time))return{cells:[cc.p(s.unit.x,s.unit.y)],unitView:["speedup"]}}};var MergeAdviceBuildLogic=function(e){MergeAdviceBaseLogic.call(this,e)};MergeAdviceBuildLogic.prototype=Object.create(MergeAdviceBaseLogic.prototype),(MergeAdviceBuildLogic.prototype.constructor=MergeAdviceBuildLogic).prototype.findMove=function(){var e=this.listAvailableUnits().filter(function(e){return!Buildable.IsBuilt(e
)&&!Game.currentGame.workers.findAssigned(e)})[0];if(e)return{cells:[cc.p(e.x,e.y)],unitView:["build"]}};var MergeAdvice=function(){cleverapps.EventEmitter.call(this),this.logics=[],Game.currentGame.map.on("changeDragging",this.onChangeDragging.bind(this)),Game.currentGame.userStatus.on("active",this.stopInactiveHint.bind(this)),Game.currentGame.userStatus.on("inactive_very_short",this.startInactiveHint.bind(this,"very_short")),Game.currentGame.userStatus.on("inactive_long",this.startInactiveHint.bind(this,"long")),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this.onShow.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,this.onHide.bind(this))};MergeAdvice.prototype=Object.create(cleverapps.EventEmitter.prototype),(MergeAdvice.prototype.constructor=MergeAdvice).prototype.setLogic=function(e,t){var s,i=[];switch(e){case Merge.MERGE:s=MergeAdviceMergeLogic;break;case Merge.SPAWN:s=MergeAdviceSpawnLogic;break;case Merge.HARVEST:s=MergeAdviceHarvestLogic;break
;case Merge.OPENFOG:s=MergeAdviceOpenFogLogic;break;case Merge.START_MINING:s=MergeAdviceMineLogic;break;case Merge.SPEED_UP:s=MergeAdviceSpeedupLogic;break;case Merge.START_BUILDING:s=MergeAdviceBuildLogic}s&&i.push(new s(t)),this.logics=i},MergeAdvice.prototype.onChangeDragging=function(e){e&&this.boo()},MergeAdvice.prototype.clear=function(){this.stopHint()},MergeAdvice.prototype.onHide=function(){this.paused||(this.paused=!0,clearTimeout(this.showHintTimeout),this.trigger("hideHint"))},MergeAdvice.prototype.onShow=function(){this.paused&&(delete this.paused,this.showHint())},MergeAdvice.prototype.boo=function(){this.hintActive&&(this.trigger("hideHint"),clearTimeout(this.showHintTimeout),this.showHintTimeout=setTimeout(this.showHint.bind(this),MergeAdvice.SCARED_TIMEOUT))},MergeAdvice.prototype.showHint=function(){if(this.hintActive){var e,t=Game.currentGame.map,s=!t.dragging;this.trigger("hideHint",s),t.dragging||(e=this.findMove()),e&&this.trigger("showHint",e),clearTimeout(
this.showHintTimeout),this.showHintTimeout=setTimeout(this.showHint.bind(this),this.getShowHintTimeout())}},MergeAdvice.prototype.getShowHintTimeout=function(){var e=this.logics[0];return e&&e.getShowHintTimeout?e.getShowHintTimeout():MergeAdvice.ONE_ITERATION_DURATION},MergeAdvice.prototype.startHint=function(e){this.hintActive||(this.hintActive=!0,this.showHint(),clearTimeout(this.stopHintTimeout),e&&(this.stopHintTimeout=setTimeout(this.stopHint.bind(this),e)))},MergeAdvice.prototype.startHintOnce=function(){this.startHint(2*this.getShowHintTimeout())},MergeAdvice.prototype.stopHint=function(){this.hintActive&&(delete this.inactiveHintRunning,delete this.hintActive,clearTimeout(this.showHintTimeout),clearTimeout(this.stopHintTimeout),this.trigger("hideHint"))},MergeAdvice.prototype.findMove=function(){for(var e=0;e<this.logics.length;++e){var t=this.logics[e].findMove();if(t)return t}},MergeAdvice.prototype.hasHints=function(){return 0<this.logics.length},
MergeAdvice.prototype.stopInactiveHint=function(){this.inactiveHintRunning&&this.stopHint()},MergeAdvice.prototype.startInactiveHint=function(e){if(!(Game.currentGame.tutorial.isActive()||Game.currentGame.counter.isActive()||cleverapps.metha.isFocused()||this.hintActive))if(Game.currentGame.isScrollProcessing())Game.currentGame.userStatus.reportUserAction();else{var t=Game.currentGame.gameLevel.getLevel();if(!("long"===e&&t<=5||"very_short"===e&&5<t||15<t)){var s=function(){this.inactiveHintRunning=!0,this.startHint()}.bind(this),i=Game.currentGame.fogs.findBlockWithProgress();if(i){var n=Game.currentGame.map.listAvailableUnits({code:"wands"}).reduce(function(e,t){return e+t.getData().value},0);if(Game.currentGame.wands+n>=i.getOpenPrice()){this.setLogic(Merge.HARVEST,{targets:Unit.getAllStagesTargets("wands")}),s();var o=this.findMove();return void(o&&o.cells&&Game.currentGame.map.onCenterTo(o.cells[0].x,o.cells[0].y,{duration:2,visibleBox:{left:.6,right:.6,top:.5,bottom:.6}}))}}
this.setLogic(Merge.MERGE),this.findMove()||this.setLogic(Merge.START_MINING),s(),5<t&&(clearTimeout(this.stopHintTimeout),this.stopHintTimeout=setTimeout(function(){Game.currentGame.userStatus.reportUserAction()},2*this.getShowHintTimeout()))}}},MergeAdvice.SCARED_TIMEOUT=1e3,MergeAdvice.ONE_ITERATION_DURATION=2e3;var MergeAdviceView=function(e,t){this.advice=e,this.mapView=t.map,this.advice.on("showHint",this.showHint.bind(this),t),this.advice.on("hideHint",this.hideHint.bind(this),t)};MergeAdviceView.prototype.findAdviceTarget=function(e,t){t=cleverapps.toArray(t);for(var s=[e];0<s.length;){var i=s.pop();if(i.adviceTarget&&t.some(function(e){return e===i.adviceTarget}))return i;s=s.concat(i.children),i.additionalViews&&Object.keys(i.additionalViews).forEach(function(e){s.push(i.additionalViews[e])})}},MergeAdviceView.prototype.showHint=function(e){var t;if(e.window){var s=cleverapps.windows.currentWindow();s&&(t=this.findAdviceTarget(s,e.window))}if(e.fogView){
var i=Game.currentGame.map.getFog(e.cells[0].x,e.cells[0].y),n=i&&i.fogBlock.onGetView();n&&(t=this.findAdviceTarget(n,e.fogView))}if(e.unitView){var o=this.mapView.getCell(Map2d.LAYER_UNITS,e.cells[0].x,e.cells[0].y);o&&(t=this.findAdviceTarget(o,e.unitView))}t?this.showButtonHint(t):e.highlight?this.showHighlight(e):e.mergeCluster?this.showMergeHint(e):e.cells&&this.showCellHint(e.cells)},MergeAdviceView.prototype.showButtonHint=function(e){var t=new FingerView;t.setLocalZOrder(100),t.setCascadeOpacityEnabled(!0),t.moveSpeed=MergeAdviceView.HINT_SPEED,e.addChild(t),t.delay(.2),t.fadeIn(cc.p(e.width/2,e.height/2)),t.press(),t.delay(.3),t.unPress(),t.fadeOut(),t.delay(.8),t.runOnce(t.removeFromParent.bind(t)),this.hintFinger&&this.hintFinger.removeFromParent(),this.hintFinger=t},MergeAdviceView.prototype.showHighlight=function(e){this.highlightUnits||(this.highlightUnits=e.highlight.map(function(e){return Game.currentGame.map.getUnit(e.x,e.y)}).filter(function(e){if(e
)return e.highlight(),!0}),Game.currentGame.map.onCenterTo(e.cells[0].x,e.cells[0].y),this.showCellHint(e.cells.slice(0,1)))},MergeAdviceView.prototype.showMergeHint=function(e){if(!this.mergeHintUnit){var t=e.mergeCluster[0];(this.mergeHintUnit=Game.currentGame.map.getUnit(t.x,t.y)).highlightMerge([e.mergeCluster],{noMessage:!0}),this.hintFinger?delete this.hintFinger:this.showCellHint(e.cells)}},MergeAdviceView.prototype.showCellHint=function(e){var t=new FingerView;t.setLocalZOrder(100),t.setCascadeOpacityEnabled(!0),t.moveSpeed=MergeAdviceView.HINT_SPEED,this.mapView.animations.addChild(t),t.delay(.2),t.fadeIn(this.mapView.getUnitCenterPos(e[0].x,e[0].y)),t.press(),t.delay(.3),2<=e.length&&t.moveTo(this.mapView.getUnitCenterPos(e[1].x,e[1].y)),t.unPress(),t.fadeOut(),t.delay(.8),t.runOnce(t.removeFromParent.bind(t)),this.hintFinger&&this.hintFinger.removeFromParent(),this.hintFinger=t},MergeAdviceView.prototype.hideHint=function(e){var t=this.hintFinger;t&&(t.clearActions(),
e?t.removeFromParent():t.runAction(new cc.Sequence(new cc.FadeOut(.2),new cc.RemoveSelf))),this.mergeHintUnit&&(this.mergeHintUnit.unhighlightMerge(),delete this.mergeHintUnit),this.highlightUnits&&(this.highlightUnits.forEach(function(e){e.unhighlight()}),delete this.highlightUnits)},MergeAdviceView.RUN_SPEED=1e3,MergeAdviceView.HINT_SPEED=500;var ViewFactory=function(e,t){if(e instanceof Fruit){var s=new FruitView(e);s.setPositionRound(t.width/2,t.height/2),t.addChild(s)}if(e instanceof Shine&&ShineView(t),e instanceof Dish&&DishView(e,t),e instanceof Mineable){var i=new MineableView(e,t);i.setPositionRound(t.width/2,t.height/2),t.addChild(i)}if(e instanceof Buildable&&!e.isCompleted()){var n=new BuildableView(e,t);n.setPositionRound(t.width/2,t.height/2),t.addChild(n)}if(e instanceof Collectible&&CollectibleView(e,t),e instanceof DivideCollectible&&DivideCollectibleView(e,t),e instanceof ResourceCollectible&&ResourceCollectibleView(e,t),e instanceof Pulsing&&PulsingView(e,t),
e instanceof Bubble&&BubbleView(e,t),e instanceof Chest&&ChestView(e,t),e instanceof Generator){var o=new GeneratorView(e,t);o.setPositionRound(t.width/2,t.height/2),t.addChild(o)}if(e instanceof Castle){var r=new CastleView(e);r.setPositionRound(t.width/2,t.height/2),t.addChild(r)}if(e instanceof MiniGame){var a=new MiniGameView(e);a.setPositionRound(t.width/2,t.height/2),t.addChild(a)}if(e instanceof Upgradable){var c=new UpgradableView(e,t);c.setPositionRound(t.width/2,t.height/2),t.addChild(c,1)}if(e instanceof Grounded){var l=new GroundedView(e),p=Game.currentGame.map.getView().getCell(Map2d.LAYER_GROUND,t.unit.x,t.unit.y);l.setPositionRound(p.width/2,p.height/2),p.addChild(l)}if(e instanceof MakesOrder){var d=new MakesOrderView(e,t);d.setPositionRound(t.width/2,t.height/2),t.addChild(d)}if(e instanceof MultiCell&&MultiCellView(e.shape,t),e instanceof InstantWorker){var h=new InstantWorkerView(e,t);h.setPositionRound(t.width/2,t.height/2),t.addChild(h)}if(e instanceof SpecialOffer
){var u=new SpecialOfferView(e,t);u.setPositionRound(t.width/2,t.height/2),t.addChild(u)}if(e instanceof MagicPlant){var g=new MagicPlantView(e);g.setPositionRound(t.width/2,t.height/2),t.addChild(g)}},PulsingView=function(e,t){e.init=PulsingView.init.bind(this,e,t),e.init()};PulsingView.init=function(t,e){Buildable.IsBuilt(t.unit)&&("resource"!==t.unit.getType()||0<Game.currentGame.map.listAvailableUnits().filter(function(e){return e.code===t.unit.code&&e.isUpgradable()}.bind(this)).length)&&PulsingView.create(t,e)},PulsingView.create=function(e,t){var s=new cleverapps.Spine(bundles.merge.jsons.flickering_json),i=t.getAnchorPoint();s.setPositionRound(t.width*i.x+cleverapps.styles.PulsingView.flickering.x,t.height*i.y+cleverapps.styles.PulsingView.flickering.y),s.setLocalZOrder(-1),s.setAnimation(0,"animation",!0),t.addChild(s),e.beforeCollect=function(){s&&(s.replaceParentSamePlace(t.getParent()),s.setCompleteListenerRemove(),s=void 0)},t.runAction(new cc.Sequence(new cc.DelayTime(.8)
,new cc.CallFunc(function(){t.sprite.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.7,1.1),new cc.ScaleTo(.7,1))))})))},cleverapps.styles.PulsingView={flickering:{x:2,y:4}};var BubbleView=function(e,t){var s=new cleverapps.Spine(bundles.merge.jsons.recipe_bubble_down_json);s.setPositionRound(cleverapps.styles.BubbleView.animation),s.setLocalZOrder(-1),s.setAnimation(0,"idle",!0),t.addChild(s);var i=new cleverapps.Spine(bundles.merge.jsons.recipe_bubble_up_json);i.setPositionRound(cleverapps.styles.BubbleView.animation),i.setLocalZOrder(1),i.setAnimation(0,"idle",!0),t.addChild(i),t.setAnchorPoint2(),t.sprite.setScale(.8),t.sprite.y+=cleverapps.styles.BubbleView.unit.dy,t.sprite.runAction(new cc.RepeatForever(new cc.Sequence(new cc.RotateBy(2,-5),new cc.RotateBy(4,10),new cc.RotateBy(2,-5)))),t.sprite.runAction(new cc.RepeatForever(new cc.Sequence(new cc.MoveBy(.9,0,cleverapps.styles.BubbleView.unit.moveY/2),new cc.MoveBy(1.8,0,-cleverapps.styles.BubbleView.unit.moveY),
new cc.MoveBy(.9,0,cleverapps.styles.BubbleView.unit.moveY/2)))),e&&(e.beforeCollect=function(){t.sprite.stopAllActions(),s&&(s.replaceParentSamePlace(t.getParent()),s.setAnimation(0,"disappearance",!1),s.setCompleteListenerRemove(),s=void 0),i&&(i.replaceParentSamePlace(t.getParent()),i.setAnimation(0,"disappearance",!1),i.setCompleteListenerRemove(),i=void 0)})};cleverapps.styles.BubbleView={animation:{x:{align:"center"},y:{align:"center",dy:35}},unit:{moveY:6,dy:37}};var ShineView=function(e){var t=new cleverapps.Spine(bundles.shine.jsons.shine_animation_json);t.setAnimation(0,"animation",!0),t.setPositionRound(e.width/2,e.height/2),e.addChild(t)},CollectibleView=function(e,t){e.onCollection=CollectibleView.collectionAnimation.bind(e,t)};CollectibleView.GetCollectAnimationOptions=function(e){if("fruit"===e.unit.getType())return{target:cleverapps.styles.SideBarIconView.orders,sound:bundles.collectible.urls.fruit_fly_finish_effect,targetEffect:!0};switch(e.unit.code){case"coins":
return{target:cleverapps.styles.MenuBar.CoinsItem.target};case"rubies":return{target:cleverapps.styles.MenuBar.GoldItem.target}}return{target:cleverapps.styles.MenuBar.GameLevelItem.target}},CollectibleView.collectionAnimation=function(e){var t=CollectibleView.GetCollectAnimationOptions(this);t.target=t.target||cleverapps.styles.MenuBar.GameLevelItem.target;var s=new cc.Node;s.setAnchorPoint2(),s.setPosition(e.getPosition()),e.getParent().addChild(s),e.replaceParentSamePlace(s,{keepScale:!0}),e.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.4*e.getScale()))),t.sound&&s.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.PlaySound(t.sound))),cleverapps.UI.collectAnimation(s,t.target,{targetEffect:t.targetEffect,finishRemove:!1,noScale:!0,callback:function(){e.removeFromParent(),i.stop(function(){s.removeFromParent()})}.bind(this)});var i=new cleverapps.Particles(bundles.particle.jsons.particles_collect_json,bundles.game.urls.particle_texture);i.setScale(1/s.getScale()),
i.setLocalZOrder(-1),s.addChild(i)};var DivideCollectibleView=function(t){t.onCollection=function(e){DivideCollectibleView.collectionAnimation.call(t,e)}};DivideCollectibleView.collectionAnimation=function(e){var t=Math.floor(this.unit.getData().value/50)+3;5<t&&(t=5),Game.currentGame.onAddItemsAnimation("wands",this.unit.getData().value,this.unit,{withoutDelta:!0,flyAmount:t},e),this.unit.onDestruction()};var ResourceCollectibleView=function(e,t){e.onCollection=ResourceCollectibleView.collectionAnimation.bind(e,t)};ResourceCollectibleView.collectionAnimation=function(e){var t=Game.currentGame.getTargetCastle(this.unit),s=Map2dView.IsoToScreen(t.x-this.unit.x,t.y-this.unit.y);if(t.findComponent(MultiCell)){var i=t.findComponent(MultiCell).getCenter();s.x+=i.x,s.y+=i.y}Game.currentGame.map.onCenterTo(t.x,t.y),cleverapps.UI.jumpAnimation(e,s,{parent:Game.currentGame.map.getView().animations,h:cleverapps.styles.UnitView.spawnHeight,time:.5,callback:function(){e.removeFromParent()}.bind(
this)})};var ChestView=function(e,t){if(e.openAnimation=ChestView.openAnimation.bind(e,t),"sacks"!==e.unit.code){var s=Families[e.unit.code].units.length,i=void 0;if(e.unit.stage===s-1&&(i="stage3"),e.unit.stage===s-2&&(i="stage2"),i){var n=new cleverapps.Spine(bundles.chests.jsons.chest_animation_json);n.setAnimation(0,i,!0),n.setPositionRound(t.width/2,t.height/2),t.addChild(n)}}};ChestView.openAnimation=function(e){e.playAppearance()};var GeneratorView=cc.Node.extend({ctor:function(t,e){this._super(),this.unitView=e,(this.generator=t).afterUpdateStage=this.createListener(this.afterUpdateStage.bind(this)),t.beforeUpdateStage=this.createListener(this.beforeUpdateStage.bind(this)),t.beforeUpdateLevel=this.createListener(this.beforeUpdateLevel.bind(this));var s=cleverapps.styles.GeneratorView;this.levelStars=[];var i=t.levels,n=t.level;if(!i&&t.brightLevels&&(i=n=t.brightLevels),i){for(var o=0;o<i;o++){var r=new cc.Sprite(
o<n?bundles.merge.frames.generator_star_on:bundles.merge.frames.generator_star_off);this.levelStars.push(r)}var a=new cleverapps.Layout(this.levelStars,{direction:cleverapps.UI.HORIZONTAL,margin:s.stars.margin});a.width>s.stars.maxWidth&&a.setScale(s.stars.maxWidth/a.width),a.setPositionRound(s.stars),this.addChild(a)}this.guideButton=new cleverapps.UI.Button({button_png:bundles.merge.frames.guide_button_png,button_on_png:bundles.merge.frames.guide_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"GeneratorGuideWindow",action:function(e){new GeneratorGuideWindow(t.unit),cleverapps.metha.onceNoWindowsListener=e}})}}),this.guideButton.setPositionRound(s.guideButton),this.addChild(this.guideButton)},beforeUpdateLevel:function(){if(this.generator.levels){var e=this.levelStars[this.generator.level];e.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.7),new cc.CallFunc(function(){e.setSpriteFrame(bundles.merge.frames.generator_star_on)}),new cc.ScaleTo(.3,1)))}},
beforeUpdateStage:function(){var e=cleverapps.styles.GeneratorView,t=Game.currentGame.map.getView(),s=new cleverapps.Spine(bundles.merge.jsons.change_stage_cloud_json,e.cloud.scale),i=t.alignInIsometricGrid(this.generator.unit.x,this.generator.unit.y);s.setPositionRound(i.x+e.cloud.x,i.y+e.cloud.y),t.animations.addChild(s),s.setAnimation(0,"animation",!1),s.setCompleteListenerRemove()},afterUpdateStage:function(){this.unitView.setScale(.8),this.unitView.runAction(new cc.ScaleTo(.3,1))}});cleverapps.styles.GeneratorView={cloud:{x:84,y:70,scale:1.35},stars:{x:{align:"center"},y:{align:"top",dy:0},margin:0,maxWidth:200},guideButton:{x:{align:"right",dx:100},y:{align:"top",dy:120}}};var UpgradableView=cc.Node.extend({ctor:function(t,e){this._super(),this.setAnchorPoint2(),this.unitView=e,(this.upgradable=t).onUpdateLevel=this.createListener(this.onUpdateLevel.bind(this)),t.onStartUpdateLevel=this.createListener(this.onStartUpdateLevel.bind(this)),t.onChangeProgress=this.createListener(
this.onChangeProgress.bind(this)),t.onBuild=this.createListener(this.onBuild.bind(this)),t.highlightCollect=this.createListener(this.highlightCollect.bind(this)),t.unhighlightCollect=this.createListener(this.unhighlightCollect.bind(this)),t.beforeChangeUnit=this.createListener(this.beforeChangeUnit.bind(this));var s=cleverapps.styles.UpgradableView;this.progressBlock=new cc.Node,this.progressBlock.setAnchorPoint2(),this.progressBlock.setPositionRound(s.progress),this.addChild(this.progressBlock),this.progress=cleverapps.UI.createScale9Sprite(bundles.merge.frames.upgradable_bar_bg_png),this.progress.setContentSize2(s.progress.size),this.progressBlock.addChild(this.progress),this.progress.bar=new ScaledProgressBar(bundles.merge.frames.upgradable_bar_png),this.progress.bar.setDimension(s.progress.bar.size),this.progress.bar.setPositionRound(s.progress.bar),this.progress.addChild(this.progress.bar),this.progress.textContainer=new cc.Node,this.progress.textContainer.setAnchorPoint2(),
this.progress.textContainer.setPositionRound(s.progress.text),this.progress.text=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.UPGRADABLE_PROGRESS_TEXT),this.progress.textContainer.addChild(this.progress.text),this.progress.addChild(this.progress.textContainer),this.onChangeProgress(!0),this.level=new cc.Sprite(bundles.merge.frames.upgradable_level_png),this.level.setPositionRound(s.level),this.level.setVisible(!1),this.level.text=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.UPGRADABLE_LEVEL_TEXT),this.level.text.setPositionRound(s.level.text),this.level.addChild(this.level.text),this.progressBlock.addChild(this.level),this.guideButton=new cleverapps.UI.Button({button_png:bundles.merge.frames.guide_button_png,button_on_png:bundles.merge.frames.guide_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"CastleWindow",action:function(e){new CastleGuideWindow({code:t.unit.code,stage:Families[t.unit.code].units.length-1}),
cleverapps.metha.onceNoWindowsListener=e}})}}),this.guideButton.setPositionRound(s.guideButton),this.addChild(this.guideButton),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.hideGuideAndProgress&&(this.guideButton.setVisible(!1),this.progressBlock.setVisible(!1)),this.onUpdateLevel(!0),Buildable.IsBuilt(this.upgradable.unit)||(this.progressBlock.setScale(0),this.guideButton.setScale(0))},beforeChangeUnit:function(){this.children.slice().forEach(function(e){e.cloudAnimation&&e.replaceParentSamePlace(Game.currentGame.map.getView().animations)})},highlightCollect:function(){this.unitView.sprite.stopAllActions(),this.unitView.sprite.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.05),new cc.ScaleTo(.3,1))))},unhighlightCollect:function(){this.unitView.sprite.stopAllActions(),this.unitView.sprite.setScale(1)},onChangeStageImage:function(){var e=new cleverapps.Spine(bundles.merge.jsons.change_stage_cloud_json);e.cloudAnimation=!0,e.setPositionRound(
cleverapps.styles.UpgradableView.cloudAnimation),this.addChild(e,-1),e.setAnimation(0,"animation",!1),e.setCompleteListenerRemove(),cleverapps.audio.playSound(bundles.merge.urls.upgradable_build_effect,{throttle:2e3})},onChangeProgress:function(e){this.progress.text.setString(this.upgradable.progress+"/"+this.upgradable.stages),e||this.progress.textContainer.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.4),new cc.ScaleTo(.15,1)));var t=this.upgradable.progress/this.upgradable.stages*100;void 0===this.progress.lastPercent||e?this.progress.bar.setPercentage(t):this.progress.bar.animatedChange(t-this.progress.lastPercent),this.progress.lastPercent=t,e?this.unitView.sprite.setAnimation(0,this.upgradable.getProgressAnimation(),!0):(this.onChangeStageImage(),this.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.CallFunc(function(){this.unitView.sprite.setAnimation(0,this.upgradable.getProgressAnimation(),!0)}.bind(this)))))},onUpdateLevel:function(e){this.level.text.setString(
this.upgradable.level),this.level.text.fitTo(cleverapps.styles.UpgradableView.level.text.maxWidth),this.upgradable.level&&this.level.setVisible(!0),e||this.onBuild()},onBuild:function(){this.progressBlock.runAction(new cc.ScaleTo(.3,1)),this.guideButton.runAction(new cc.ScaleTo(.3,1))},onStartUpdateLevel:function(){this.progressBlock.runAction(new cc.ScaleTo(.3,0)),this.guideButton.runAction(new cc.ScaleTo(.3,0))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{UPGRADABLE_PROGRESS_TEXT:{name:"default",size:30},UPGRADABLE_LEVEL_TEXT:{name:"default",size:40}}),cleverapps.styles.UpgradableView={guideButton:{x:{align:"right",dx:100},y:{align:"top",dy:100}},level:{x:{align:"left",dx:-120},y:{align:"center",dy:0},text:{x:{align:"center",dx:3},y:{algin:"center",dy:3},maxWidth:40}},cloudAnimation:{x:{align:"center"},y:{align:"center"}},progress:{x:{align:"center"},y:{align:"bottom",dy:-80},size:{width:180,height:34},text:{width:130,x:{align:"center"},y:{algin:"center",dy:3}},bar:{size:{
width:174,height:27},x:3,y:5}}};var CastleView=cc.Node.extend({ctor:function(e){this._super(),this.castle=e,this.castle.onBuildCastle=this.createListener(this.buildCastle.bind(this)),this.castle.onStartWait=this.createListener(this.startWait.bind(this)),this.castle.onCompleteWait=this.createListener(this.completeWait.bind(this)),this.castle.builded&&(this.buildCastle(),this.startWait(),void 0===this.castle.sinceLastHarvest&&this.completeWait())},buildCastle:function(e){this.animation=new cleverapps.Spine(bundles.castle.jsons.castle_animation_json),this.addChild(this.animation)},startWait:function(){this.animation.setAnimation(0,"animation",!0)},completeWait:function(){this.animation.setAnimation(0,"blink",!1),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"ready",!0)}.bind(this))}}),MiniGameView=cc.Node.extend({ctor:function(e){this._super(),this.minigame=e,this.minigame.onStartWait=this.createListener(
this.startWait.bind(this)),this.minigame.onCompleteWait=this.createListener(this.completeWait.bind(this)),this.animation=new cleverapps.Spine(bundles.castle.jsons.castle_animation_json),this.animation.setPositionRound(cleverapps.styles.MiniGameView),this.addChild(this.animation),this.startWait(),void 0===this.minigame.sinceLastHarvest&&this.completeWait()},startWait:function(){this.animation.setAnimation(0,"animation",!0)},completeWait:function(){this.animation.setAnimation(0,"blink",!1),this.animation.setCompleteListener(function(){this.animation.setCompleteListener(function(){}),this.animation.setAnimation(0,"ready",!0)}.bind(this))}});cleverapps.styles.MiniGameView={x:{align:"center"},y:{align:"center",dy:-20}};var MultiCellView=function(e,t){var s=MultiCellView.calcCenterPosition(e);t.x+=s.x,t.y+=s.y};MultiCellView.calcCenterPosition=function(e){for(var t=0,s=0,i=0;i<e.length;i++){var n=e[i].x+e[i].y+1,o=e[i].x-e[i].y;t+=n*cleverapps.styles.Map2dView.cell.width/2,
s+=o*cleverapps.styles.Map2dView.cell.height/2}return t/=e.length,s/=e.length,{x:t-=cleverapps.styles.Map2dView.cell.width/2,y:s}};var DishView=function(e,t){e.openAnimation=DishView.openAnimation.bind(e,t)};DishView.openAnimation=function(e){e.playAppearance()};var BuildableView=cc.Node.extend({ctor:function(e,t){this._super(),this.build=e,(this.parentUnitView=t).setImageOpacity(180),this.showCheckmark(),e.onCompletion=this.createListener(this.animateCompletion.bind(this)),e.onHighlight=this.createListener(this.highlight.bind(this)),e.onUnhighlight=this.createListener(this.unhighlight.bind(this)),e.onHideDetails=this.createListener(this.hideCheckmark.bind(this)),e.onShowDetails=this.createListener(this.showCheckmark.bind(this))},showCheckmark:function(e){e=e||function(){},this.build.isCompleted()?e():this.checkmark?e():(this.checkmark=new cc.Sprite(bundles.buildable.frames.buildable_exclamation),this.checkmark.setScale(.3),this.addChild(this.checkmark),this.checkmark.runAction(
new cc.Sequence(new cc.ScaleTo(.1,1).easing(cc.easeOut(2)),new cc.CallFunc(e))))},hideCheckmark:function(e){e=e||function(){},this.checkmark?(this.checkmark.stopAllActions(),this.checkmark.runAction(new cc.Sequence(new cc.ScaleTo(.1,.3).easing(cc.easeIn(2)),new cc.RemoveSelf,new cc.CallFunc(e))),this.checkmark=void 0):e()},highlight:function(){this.parentUnitView.setImageOpacity(255),this.parentUnitView.sprite.setColor(cc.color(255,255,0))},unhighlight:function(){this.build.isCompleted()?this.parentUnitView.setImageOpacity(255):this.parentUnitView.setImageOpacity(180),this.parentUnitView.sprite.setColor(cc.color(255,255,255))},animateCompletion:function(){var e=this.parentUnitView;if(e.setImageOpacity(255),!this.build.unit.findComponent(MultiCell)){var t=e.parent,s=new cleverapps.Spine(bundles.buildable.jsons.buildable_below_json);s.setLocalZOrder(-1),t.addChild(s);var i=new cleverapps.Spine(bundles.buildable.jsons.buildable_above_json);i.setLocalZOrder(1),t.addChild(i),s.setAnimation(
0,"animation",!1),s.setCompleteListenerRemove(),i.setAnimation(0,"animation",!1),i.setCompleteListenerRemove()}e.runAction(new cc.Sequence(new cc.DelayTime(.13),new cc.ScaleTo(.5,1.3),new cc.ScaleTo(.4,1))),cleverapps.audio.playSound(bundles.buildable.urls.build_finish_effect)}}),MineableView=cc.Node.extend({ctor:function(e,t){var s=cleverapps.styles.MineableView;this._super(),this.mine=e,this.parentUnitView=t,this.visible=!1;var i=this.progress=new DiscreteProgress(e.mined,e.unit.getData().mineable.length,!0);i.setAnchorPoint2(),i.setPositionRound(s.progress),t.addChild(i),this.shouldDisplayProgress()||i.setVisible(!1),e.onMoveNext=this.createListener(this.moveNext.bind(this)),e.onHideDetails=this.createListener(this.hideProgress.bind(this)),e.onShowDetails=this.createListener(this.showProgress.bind(this))},shouldDisplayProgress:function(){return 0!==this.mine.mined||1===this.mine.unit.getData().mineable.length},moveNext:function(){this.progress.setStep(this.mine.mined),
this.showProgress()},showProgress:function(){this.shouldDisplayProgress()&&(this.progress.visible||this.progress.runAction(new cc.Sequence(new cc.MoveBy(0,0,15),new cc.ScaleTo(0,.5),new cc.Show,new cc.Spawn(new cc.MoveBy(.1,0,-15),new cc.ScaleTo(.1,1)))))},hideProgress:function(){this.progress.setVisible(!1)}});cleverapps.styles.MineableView={progress:{x:{align:"center"},y:{align:"bottom",dy:25}}};var GroundedView=cc.Sprite.extend({ctor:function(e){this._super(GroundedView.getImage(e.unit.x,e.unit.y)),e.remove=function(e){e?this.removeFromParent():this.runAction(new cc.Sequence(new cc.FadeOut(.5),new cc.RemoveSelf))}.bind(this)}});GroundedView.getImage=function(e,t){return Game.currentGame.map.getTerrainFrames(e,t).grounded_bg};var FruitView=cc.Node.extend({ctor:function(e){this._super(),this.fruit=e,this.startGrowth(),e.onStartGrowth=this.createListener(this.startGrowth.bind(this)),e.onCompleteGrowth=this.createListener(this.completeGrowth.bind(this)),
void 0===this.fruit.sinceLastHarvest&&this.completeGrowth()},updateAnimation:function(e){if(this.animation&&(this.animation.removeFromParent(),this.animation=void 0),e){if(cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.hideFruitParticlesAnimation)return;var t=this.animation=new cleverapps.Spine(e);t.setAnimation(0,"animation",!0),this.addChild(t)}},startGrowth:function(){this.updateAnimation(bundles.fruit.jsons.fruit_growing_json)},completeGrowth:function(){var e=new cleverapps.Spine(bundles.fruit.jsons.fruit_ready_json);e.setAnimation(0,"animation",!1),e.setCompleteListenerRemove(function(){this.updateAnimation(bundles.fruit.jsons.fruit_ripe_json)}.bind(this)),this.addChild(e)}}),MakesOrderView=cc.Node.extend({ctor:function(e,t){this._super(),this.maker=e,this.parentUnitView=t,this.prizeView=void 0,e.onChangeState=this.createListener(this.handleStateChange.bind(this)),e.onUpdateIngredients=this.createListener(this.handleUpdateIngredients.bind(this)),this.runAction(
new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(this.handleStateChange.bind(this))))},handleUpdateIngredients:function(){this.prizeView&&this.prizeView.hasAttention()&&this.prizeView.createAttention(this.getAttentionImage())},getAttentionImage:function(){return this.maker.canCook()?bundles.mergeui.frames.small_attention_exclamation:bundles.mergeui.frames.small_attention_exclamation_disabled},handleStateChange:function(){if(!cleverapps.config.wysiwygMode||!cleverapps.flags.wysiwyg.hidePrizeView){var e;this.prizeView&&(this.parentUnitView.removeAdditionalView("prize"),this.prizeView=void 0);var t=this.parentUnitView,s=t.getContentSize();switch(this.maker.state){case MakesOrder.STATE_RECIPE:e=new PrizeView({prize:this.maker.createPrizeUnit(),onClick:t.handleClick.bind(t),attention:this.getAttentionImage()}),cleverapps.audio.playSound(bundles.merge.urls.new_order_effect);break;case MakesOrder.STATE_COOKING:e=new PrizeView({animation:!0,onClick:t.handleClick.bind(t)})}e&&(
e.setPositionRound(s.width/2,s.height),t.insertAdditionalView("prize",e),this.prizeView=e)}}});cleverapps.styles.MakesOrderView={};var InstantWorkerView=cc.Node.extend({ctor:function(e,t){this._super(),this.worker=e,this.parentUnitView=t,this.worker.onStartMagic=this.createListener(this.startMagic.bind(this)),this.worker.onFinishMagic=this.createListener(this.finishMagic.bind(this)),this.worker.onDragStart=this.createListener(this.handleDragStart.bind(this)),this.worker.onDragFinish=this.createListener(this.handleDragFinish.bind(this)),this.worker.onPercentageChanged=this.createListener(this.onUpdateProgress.bind(this)),e.unit.onInfoOpened=this.createListener(this.hideProgress.bind(this)),e.unit.onInfoClosed=this.createListener(this.onUpdateProgress.bind(this)),this.onUpdateProgress()},handleDragStart:function(){var e=this.parentUnitView.getAnimation();e.setCompleteListener(null),e.setAnimation(0,"idle_up",!0)},handleDragFinish:function(){var e=this.parentUnitView.getAnimation()
;e.setCompleteListener(null);var t=UnitView.getUnitAnimations(this.worker.unit);t?e.setIdleSet(t):e.setAnimation(0,"animation",!0)},showTimer:function(e){this.hideTimer(e);var t=e.unit.onGetView(),s=new InstantComponentTimer(this.worker,{timeLeft:e.time,limit:Math.min(e.time,this.worker.limit),duration:InstantWorker.BUILDING_ANIMATION_TIME});s.setPositionRound(cleverapps.styles.WorkerView.timer),t.insertAdditionalView("timer",s)},hideTimer:function(e){e.unit.onGetView().removeAdditionalView("timer")},jumpAnimation:function(e,t,s,i){var n=t.convertToNodeSpace(t.parent.convertToWorldSpace(t)),o=t.convertToNodeSpace(e.parent.convertToWorldSpace(e)),r=cc.pDistance(o,n);this.animation.replaceParent(t),this.animation.setPositionRound(o),this.animation.setAnimation(0,s,!0),this.animation.runAction(new cc.Sequence(new cc.JumpTo(.45,n.x,n.y,.3*r,1),new cc.CallFunc(function(){i&&i()})))},startMagic:function(e){var t=this.worker.unit;if(e.onHideDetails(),this.showTimer(e),!this.animation){
var s=this.animation=UnitView.getUnitImage(t),i=UnitView.getUnitStyles(t);s.setAnchorPoint2(i.anchorX,i.anchorY),s.setCompleteListener(null)}this.parentUnitView.setVisible(!1),this.jumpAnimation(t.onGetView(),e.unit.onGetView(),"jump",function(){this.animation.setAnimation(0,"building",!0),cleverapps.audio.playSound(bundles.merge.urls.instantworker_build_effect)}.bind(this))},finishMagic:function(e){this.hideTimer(e),this.animation&&this.jumpAnimation(e.unit.onGetView(),this.worker.unit.onGetView().parent,"jump_back",function(){e.onShowDetails(),this.parentUnitView.setVisible(!0),this.animation.removeFromParent(),delete this.animation}.bind(this))},onUpdateProgress:function(){this.worker.isFresh()||this.showProgress()},showProgress:function(){var e=cleverapps.styles.InstantWorkerView.progress;if(!this.progress){var t=new ScaledProgressBar(bundles.mergeui.frames.progress_bar);t.setDimension(e.width,e.height),t.setPositionRound(0,0),t.setPercentage(100);var s=new cc.Scale9Sprite(
bundles.mergeui.frames.progress_stroke);s.setAnchorPoint2(0,0),s.setPositionRound(0,0),s.setContentSize2(t.width,t.height);var i=this.progress=new cc.Scale9Sprite(bundles.mergeui.frames.progress_background);i.setAnchorPoint2(),i.setPositionRound(e),i.setContentSize2(t.width,t.height),i.addChild(t),i.addChild(s),i.bar=t,this.addChild(i)}this.progress.bar.setPercentage(this.worker.getPercentage()),this.progress.visible||this.progress.runAction(new cc.Sequence(new cc.MoveBy(0,0,-15),new cc.ScaleTo(0,.5),new cc.Show,new cc.Spawn(new cc.MoveBy(.1,0,15),new cc.ScaleTo(.1,1))))},hideProgress:function(){this.progress&&this.progress.setVisible(!1)}});cleverapps.styles.InstantWorkerView={progress:{width:80,height:13,x:5,y:47},timer:{x:{align:"center",dx:0},y:{align:"center",dy:-29}}};var SpecialOfferView=cc.Node.extend({ctor:function(e,t){this._super(),this.specialOffer=e,this.parentUnitView=t,e.onAppearance=this.createListener(this.playAppearance.bind(this)),e.onDestruction=this.createListener(
this.playDestruction.bind(this)),e.onBuying=this.createListener(this.playBuying.bind(this))},createPrizeView:function(e){var t=UnitView.getUnitStyles(e),s=UnitView.getUnitImage(e);return s.setAnchorPoint2(t.anchorX,t.anchorY),s.setLocalZOrder(-1),s},createTimer:function(){var e=cleverapps.styles.SpecialOfferView.timer,t=new cc.Scale9Sprite(bundles.mergeui.frames.timer_substrate);t.setAnchorPoint2(),t.setContentSize2(e),t.setPositionRound(e);var s=new cleverapps.CountDownView(new cleverapps.CountDown(this.specialOffer.getTimeLeft()),{font:cleverapps.styles.FONTS.COMPONENT_TIMER_TEXT});s.setAnchorPoint2(),s.setPositionRound(e.countdown),t.addChild(s);var i=new cc.Sprite(bundles.mergeui.frames.timer_icon_png);i.setAnchorPoint2(),i.setPositionRound(e.icon),t.addChild(i);var n=new cleverapps.UI.Button({styles:e.button,content:cleverapps.UI.generateOnlyText("messages:SpecialOfferView.buy",cleverapps.styles.FONTS.BUTTON_SMALL_TEXT),onClicked:this.specialOffer.handleClick.bind(
this.specialOffer),button_images:cleverapps.UI.Button.Images.small_button_blue});return n.setAnchorPoint2(),n.setPositionRound(e.button),t.addChild(n),t},playAppearance:function(){var e=cleverapps.styles.SpecialOfferView,t=this.parentUnitView;t.sprite.setVisible(!1);var s=new cleverapps.Spine(bundles.merge.jsons.specialoffer_helicopter_json);s.setPositionRound(e.helicopter),t.addChild(s),s.replaceParentSamePlace(Game.currentGame.map.getView().animations);var i=this.createPrizeView(this.specialOffer.prize);i.setPositionRound(e.prize),i.y+=e.prize.offset.y-i.height/2,i.setVisible(!1),s.addChild(i);var n=new cleverapps.Spine(bundles.buildable.jsons.buildable_above_json);n.setLocalZOrder(1),n.setPositionRound(t.width/2,t.height/2),n.setVisible(!1),t.addChild(n);var o=e.helicopter.offset;s.runAction(new cc.Sequence(new cc.PlaySound(bundles.merge.urls.specialoffer_helicopter_effect),new cc.DelayTime(.5667),new cc.CallFunc(s.runAction.bind(s,new cc.RepeatForever(new cc.Sequence(new cc.MoveBy(
1.25,o.x,o.y).easing(cc.easeQuadraticActionInOut()),new cc.MoveBy(1.25,-o.x,-o.y).easing(cc.easeQuadraticActionInOut()))))))),i.runAction(new cc.Sequence(new cc.DelayTime(.5667),new cc.Show,new cc.MoveBy(.2,0,-62),new cc.CallFunc(i.runAction.bind(i,new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.247,.92,1),new cc.ScaleTo(.169,1,1))))))),s.setAnimation(0,"appearance",!1),s.setCompleteListener(function(){s.stopAllActions(),s.setAnimation(0,"disappearance",!1),s.setCompleteListenerRemove();var e=t.convertToWorldSpace(cc.p(t.width/2,t.height/2));e=s.convertToNodeSpace(e),i.stopAllActions(),i.runAction(new cc.Sequence(new cc.ScaleTo(.2,1,1),new cc.MoveTo(.17,e.x,e.y),new cc.CallFunc(function(){i.replaceParentSamePlace(t),i.runAction(new cc.Sequence(new cc.PlaySound(bundles.merge.urls.spawn_landing_effect),new cc.ScaleTo(.15,1,.8),new cc.ScaleTo(.15,1,1))),n.setVisible(!0),n.setAnimation(0,"animation_bonus",!1),n.setCompleteListenerRemove(),t.sprite.setScale(.3),t.sprite.runAction(
new cc.Sequence(new cc.DelayTime(.3),new cc.Show,new cc.PlaySound(bundles.merge.urls.specialoffer_appearance_effect),new cc.ScaleTo(.4,1.3),new cc.ScaleTo(.2,1),new cc.CallFunc(function(){var e=this.createTimer();t.insertAdditionalView("timer",e)}.bind(this))))}.bind(this))))}.bind(this))},playDestruction:function(){cleverapps.audio.playSound(bundles.merge.urls.specialoffer_destruction_effect),this.parentUnitView.removeAdditionalView("timer")},playBuying:function(){var e=this.specialOffer.prize.onGetView();e.setScale(.2),e.setVisible(!1);var t=this.parentUnitView,s=new cleverapps.Spine(bundles.buildable.jsons.buildable_above_json);s.setLocalZOrder(2),s.setCompleteListenerRemove(),t.parent.addChild(s),t.stopAllActions(),t.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.PlaySound(bundles.merge.urls.specialoffer_buying_effect),new cc.CallFunc(function(){s.setAnimation(0,"animation",!1),t.removeAdditionalView("timer"),e.setVisible(!0),e.runAction(new cc.ScaleTo(.2,1))}),
new cc.ScaleTo(.2,.3),new cc.RemoveSelf))}});cleverapps.styles.SpecialOfferView={timer:{width:135,height:29,x:{align:"center",dx:0},y:{align:"center",dy:-10},margin:20,countdown:{x:{align:"right",dx:-7},y:{align:"center",dy:1}},icon:{x:{align:"left",dx:-12},y:{align:"center"}},button:{x:{align:"center"},y:{align:"bottom",dy:-56},width:130,height:50,padding:{left:12,right:12,top:0,bottom:0},margin:0}},prize:{x:{align:"center"},y:260,offset:{y:62}},helicopter:{x:{align:"center"},y:{align:"bottom"},offset:{x:20,y:10}}};var MagicPlantView=cc.Node.extend({ctor:function(e){this._super(),(this.plant=e).onStartGrowth=this.createListener(this.startGrowth.bind(this)),e.onCompleteGrowth=this.createListener(this.completeGrowth.bind(this)),0<e.getTimeLeft()?this.startGrowth():this.completeGrowth()},updateAnimation:function(e){if(this.animation&&(this.animation.removeFromParent(),this.animation=void 0),e){var t=this.animation=new cleverapps.Spine(e);t.setAnimation(0,"animation",!0),this.addChild(t)}
},startGrowth:function(){this.updateAnimation(bundles.fruit.jsons.fruit_growing_json)},completeGrowth:function(){var e=new cleverapps.Spine(bundles.fruit.jsons.fruit_ready_json);e.setAnimation(0,"animation",!1),e.setCompleteListenerRemove(function(){this.updateAnimation(bundles.fruit.jsons.fruit_ripe_json)}.bind(this)),this.addChild(e)}}),DiscreteProgress=cc.Node.extend({ctor:function(e,t,s){this._super(),this.total=t=t||1;var i=new cc.Scale9Sprite(s?bundles.discreteprogress.frames.dp_background_small:bundles.discreteprogress.frames.dp_background);this.addChild(i);var n=this.generateProgressBar(t,s);i.setAnchorPoint2(0,.5),i.setPositionRound(0,n.height/2),i.setContentSize2(n.width,n.height);var o=new cc.Scale9Sprite(s?bundles.discreteprogress.frames.dp_stroke_small:bundles.discreteprogress.frames.dp_stroke);o.setAnchorPoint2(0,.5),o.setPositionRound(0,n.height/2),o.setContentSize2(n.width,n.height),this.addChild(o),this.setContentSize2(n.width,n.height),this.setAnchorPoint2(),
this.setStep(e)},generateProgressBar:function(e,t){var s=t?cleverapps.styles.SmallDiscreteProgress:cleverapps.styles.DiscreteProgress,i=s.width,n=s.height;this.steps=[];for(var o=0,r=0;o<e;++o){var a;a=1===e?t?bundles.discreteprogress.frames.dp_progress_0_small:bundles.discreteprogress.frames.dp_progress_0:0===o?t?bundles.discreteprogress.frames.dp_progress_1_small:bundles.discreteprogress.frames.dp_progress_1:o===e-1?t?bundles.discreteprogress.frames.dp_progress_2_small:bundles.discreteprogress.frames.dp_progress_2:t?bundles.discreteprogress.frames.dp_progress_3_small:bundles.discreteprogress.frames.dp_progress_3;var c=new cc.Scale9Sprite(a);c.setAnchorPoint(0,.5),c.setPosition(r,n/2+s.adjust.y),c.setContentSize(i/e,n),r+=c.width+s.smallMargin,this.steps.push(c),this.addChild(c)}return{width:r,height:n}},setStep:function(e){e=this.step=Math.min(this.total-e-1,this.total);for(var t=0;t<this.total;++t){var s=this.steps[t];s.stopAllActions(),t<e?(s.setOpacity(255),s.setVisible(!0)
):t===e?s.runAction(new cc.RepeatForever(new cc.Sequence(new cc.FadeTo(.7,50),new cc.FadeTo(.7,170)))):s.setVisible(!1)}}});cleverapps.styles.DiscreteProgress={width:170,height:25,smallMargin:1,adjust:{y:0}},cleverapps.styles.SmallDiscreteProgress=cleverapps.overrideStyles(cleverapps.styles.DiscreteProgress,{width:80,height:13,smallMargin:.5,adjust:{y:-1}},!0);var ComponentTimer=cc.Node.extend({ctor:function(e,t){this._super(),this.worker=e,this.createTimer(t),this.createAnimation(),this.worker.onClear=this.createListener(this.clear.bind(this))},clear:function(){this.countdown.countDown.stop()},createTimer:function(e){var t=cleverapps.styles.ComponentTimer.timer;this.timer&&this.timer.removeFromParent();var s=this.timer=new cc.Scale9Sprite(bundles.mergeui.frames.timer_substrate);s.setAnchorPoint2(),s.setPositionRound(t),s.setContentSize2(t.width,t.height),this.addChild(s);var i=this.countdown=new cleverapps.CountDownView(e,{font:cleverapps.styles.FONTS.COMPONENT_TIMER_TEXT})
;i.setAnchorPoint2(),i.setPositionRound(t.countdown),s.addChild(i);var n=this.icon=new cc.Sprite(bundles.mergeui.frames.timer_icon_png);n.setAnchorPoint2(),n.setPositionRound(t.icon),s.addChild(n)},createAnimation:function(){var e=cleverapps.styles.ComponentTimer.animation,t=this.animation=new cleverapps.Spine(bundles.mergeui.jsons.timer_json);t.setAnchorPoint2(),t.setPositionRound(e),t.setAnimation(0,"animation",!0),this.addChild(t)},createFastCountdown:function(e,t,s,i){var n=s/50,o=t/n,r=setInterval(function(){if(n<=0)return clearInterval(r),void a.onFinish();e=Math.max(0,e-o),n-=1,a.onSecond()}.bind(this),50),a={onSecond:function(){},onFinish:i||function(){},getTimeLeft:function(){return e},stop:function(){clearInterval(r)},remove:function(){clearInterval(r)}};return a},runFastCountdownAnimation:function(e){var t=e/1e3,s=Math.ceil(t),i=t/s;this.timer.runAction(new cc.Repeat(new cc.Sequence(new cc.ScaleTo(i/2,1.15*this.timer.scale),new cc.ScaleTo(i/2,this.timer.scale)),s)),
this.countdown.setCascadeColorEnabled(!0),this.countdown.setColor(cleverapps.styles.COLORS.CONGRATS_BLUE)}}),InstantComponentTimer=ComponentTimer.extend({ctor:function(e,t){var s=this.createFastCountdown(t.timeLeft,t.limit,t.duration);this._super(e,s),this.runFastCountdownAnimation(t.duration)}}),WorkerComponentTimer=ComponentTimer.extend({ctor:function(e){this.state=void 0;var t=new cleverapps.CountDown(e.getTimeLeft(),{onTick:this.updateState.bind(this)});this._super(e,t),this.updateState(!0)},calcState:function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_COINS_TIME),t=WorkerComponentTimer.STATE_DEFAULT;return 0===SpeedUpWindow.CalcPrice(this.worker.getTimeLeft())?t=WorkerComponentTimer.STATE_FREE:this.worker.isSpeedUpBonusActive()?t=WorkerComponentTimer.STATE_BONUS_WATCH_AD:e&&e.isRunning()&&(t=WorkerComponentTimer.STATE_BONUS_COINS),t},updateState:function(e){var t=this.calcState();if(this.state!==t)switch(this.state=t,this.hideButton(),this.hideBonus(),t){
case WorkerComponentTimer.STATE_FREE:this.showButton(e);break;case WorkerComponentTimer.STATE_BONUS_COINS:this.showBonus(bundles.mergeui.frames.coins_feast_icon,e);break;case WorkerComponentTimer.STATE_BONUS_WATCH_AD:this.showBonus(bundles.mergeui.frames.watch_ad_icon,e)}},showButton:function(e){var t=cleverapps.styles.WorkerComponentTimer.button,s=this.button=new UseGoldButton({canCoins:!0,button_images:cleverapps.UI.Button.Images.small_button_blue,price:SpeedUpWindow.CalcPrice(this.worker.getTimeLeft()),onClicked:this.worker.speedUp.bind(this.worker),font:cleverapps.styles.FONTS.BUTTON_SMALL_TEXT,eventName:"speedup_worker_ruby"},t);s.setAnchorPoint2(),s.setPositionRound(t),s.adviceTarget=Merge.SPEED_UP,this.addChild(s),!0!==e&&(s.setScale(.3),s.runAction(new cc.ScaleTo(.2,1)))},hideButton:function(){this.button&&(this.button.runAction(new cc.Sequence(new cc.ScaleTo(.2,.3),new cc.RemoveSelf)),this.button=void 0)},showBonus:function(e,t){
var s=cleverapps.styles.WorkerComponentTimer.bonus,i=this.bonus=new cc.Sprite(e);i.setAnchorPoint2(),i.setPositionRound(s),this.addChild(i),cleverapps.UI.onClick(i,this.worker.unit.handleClick.bind(this.worker.unit)),this.icon.setSpriteFrame(bundles.mergeui.frames.timer_ribbon_icon_png),!0!==t&&(i.setScale(.3),i.runAction(new cc.ScaleTo(.2,1)))},hideBonus:function(){this.bonus&&(this.bonus.runAction(new cc.Sequence(new cc.ScaleTo(.2,.3),new cc.RemoveSelf)),this.bonus=void 0,this.icon.setSpriteFrame(bundles.mergeui.frames.timer_icon_png))},showBoost:function(e){this.hideButton(),this.hideBonus(),this.createTimer(this.createFastCountdown(this.worker.getTimeLeft(),e.limit,e.duration,e.callback)),this.runFastCountdownAnimation(e.duration)}});WorkerComponentTimer.STATE_DEFAULT=0,WorkerComponentTimer.STATE_FREE=1,WorkerComponentTimer.STATE_BONUS_COINS=2,WorkerComponentTimer.STATE_BONUS_WATCH_AD=3,cleverapps.overrideFonts(cleverapps.styles.FONTS,{COMPONENT_TIMER_TEXT:{size:22,
color:cleverapps.styles.COLORS.WHITE}}),cleverapps.styles.ComponentTimer={timer:{width:132,height:26,x:0,y:0,icon:{x:{align:"left",dx:-16},y:{align:"center"}},countdown:{x:{align:"right",dx:-5},y:{align:"center"}}},animation:{x:0,y:45}},cleverapps.styles.WorkerComponentTimer={button:{x:0,y:-45,width:130,height:50,padding:{left:12,right:12,top:0,bottom:0},margin:0},bonus:{x:-43,y:58}};var InfoView=cc.Scale9Sprite.extend({ctor:function(e){var t=cleverapps.styles.InfoView;this._super(bundles.mergeui.frames.background);var s=[];e.title&&s.push(this.createTitle(e.title)),e.progress&&s.push(this.createProgressBar(e.progress)),e.duration&&s.push(this.createDuration(e.duration)),e.countdown&&s.push(this.createCountDown(e.countdown)),e.remains&&s.push(this.createRemainsBar(e.remains)),e.actions&&s.push(this.createActions(e.actions));var i=new cleverapps.Layout(s,{direction:cleverapps.UI.TOP_TO_BOTTOM,margin:t.margin,padding:t.padding});i.setAnchorPoint2(),i.setPositionRound(i.width/2,i.height/2
),this.setAnchorPoint2(.5,0),this.setContentSize2(i.width,i.height),this.setLocalZOrder(2);var n=new cc.Sprite(bundles.mergeui.frames.pointer);n.setPositionRound(t.pointer.x,t.pointer.y),this.addChild(n),this.addChild(i),e.guide&&this.addChild(this.createGuide(e.guide)),this.baseScale=1,cleverapps.UI.onClick(this,function(){InfoView.CloseInfo()}),cleverapps.windows.onOpenListeners.infoview=this.createListener(function(){InfoView.CloseInfo()})},createTitle:function(e){var t=cleverapps.styles.InfoView.title,s="string"==typeof e?e:Game.currentGame.unitsLibrary.getUnitName(e),i=t.width;if(e.icon){var n=UnitView.getUnitImage(e);n.setScale(t.icon.scale),i-=n.width*n.scaleX}var o=cleverapps.UI.generateOnlyText(s,cleverapps.styles.FONTS.INFO_TEXT);return o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.width>i&&0<=s.indexOf(" ")&&s.lastIndexOf(" ")===s.indexOf(" ")&&(s=s.replace(" ","\n"),o.setString(s)),o.fitTo(i),e.icon?new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,
margin:t.icon.margin,padding:t.icon.padding}):o},createProgressBar:function(e){return new DiscreteProgress(e.value,e.total)},createRemainsBar:function(e){var t=cleverapps.styles.InfoView.remains,s=new ScaledProgressBar({progress:bundles.mergeui.frames.progress_bar,background:bundles.mergeui.frames.progress_background,foreground:bundles.mergeui.frames.progress_stroke,padding:t.padding});return s.setAnchorPoint2(),s.setPercentage(e.value/e.total*100),s.setDimension(t.width,t.height),s},createDuration:function(e){var t=cleverapps.UI.generateImageText(cleverapps.intervalToString(e),cleverapps.styles.FONTS.INFO_TIMER_TEXT);return this.createTimer(t)},createCountDown:function(e){var t=this.countdown=new cleverapps.CountDown(e,{onFinish:InfoView.CloseInfo}),s=new cleverapps.CountDownView(t,{font:cleverapps.styles.FONTS.INFO_TIMER_TEXT});return this.createTimer(s)},createTimer:function(e){var t=cleverapps.styles.InfoView.timer,s=new cc.Sprite(bundles.infoview.frames.timer)
;return new cleverapps.Layout([s,e],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:t.padding})},createActions:function(e){var t=cleverapps.styles.InfoView.actions,s=[];for(var i in e){var n=e[i];if(n)switch(i){case"build":s.push(this.createBuildButton(n));break;case"instant":s.push(this.createInstantButton(n));break;case"energy":s.push(this.createEnergyButton(n));break;case"speedup":s.push(this.createSpeedUpButton(n));break;case"remove":s.push(this.createRemoveButton(n))}}return new cleverapps.Layout(s,{direction:cleverapps.UI.TOP_TO_BOTTOM,padding:t.padding,margin:t.margin})},createBuildButton:function(e){e={button_images:e.button_images||cleverapps.UI.Button.Images.button_green,text:e.text||"messages:InfoView.button.build",icon:e.icon||new cc.Sprite(bundles.infoview.frames.dwarf_head),action:e instanceof Function?e:e.action,adviceTarget:e.adviceTarget||"build"};var t=cleverapps.styles.InfoView.button,s=cleverapps.UI.generateOnlyText(e.text,
cleverapps.styles.FONTS.INFO_BUILD_BUTTON_TEXT),i=e.icon,n=t.width-t.padding.left-t.padding.right-i.width*i.scale;s.fitTo(n);var o=new cleverapps.Layout([s,i],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin}),r=new cleverapps.UI.Button({styles:t,content:o,onClicked:InfoView.CloseInfo.bind(null,e.action),button_images:e.button_images});return r.adviceTarget=e.adviceTarget,r},createInstantButton:function(e){return this.createBuildButton({button_images:cleverapps.UI.Button.Images.button_blue,text:"messages:InfoView.button.instant",icon:new cc.Sprite(bundles.infoview.frames.instant_dwarf_head),action:e,adviceTarget:"instant"})},createRemoveButton:function(t){var e=cleverapps.styles.InfoView.button,s=Messages.get("InfoView.button.remove"),i=!1;return Game.currentGame.gameLevel.getLevel()<InfoView.MINIMAL_REMOVE_LEVEL&&(s=Messages.get("InfoView.button.level",{level:InfoView.MINIMAL_REMOVE_LEVEL}),i=!0),new cleverapps.UI.Button({styles:e,text:s,disabled:i,
font:cleverapps.styles.FONTS.INFO_BUILD_BUTTON_TEXT,onClicked:InfoView.CloseInfo.bind(null,function(){cleverapps.metha.isFocused()||cleverapps.metha.display({focus:"ShovelWindow",action:function(e){new RemoveUnitWindow(t.unit),cleverapps.metha.onceNoWindowsListener=e}})}),button_images:cleverapps.UI.Button.Images.button_red})},createEnergyButton:function(e){var t=cleverapps.styles.InfoView.button,s=new UseEnergyButton({energy:e.energy,onClicked:InfoView.CloseInfo.bind(InfoView,e.action),font:cleverapps.styles.FONTS.INFO_BUTTON_TEXT},t);return s.adviceTarget="energy",s},createSpeedUpButton:function(e){var t=cleverapps.styles.InfoView.button,s=["speedup_refresh_unit_ruby"],i="speedup_fruit_ruby";return e.unit&&"fruit"!==e.unit.getType()&&(i="speedup_"+e.unit.code+"_ruby"),s.push(i),new UseGoldButton({price:SpeedUpWindow.CalcPrice(e.duration),canCoins:!0,onClicked:InfoView.CloseInfo.bind(InfoView,e.action),image:bundles.infoview.frames.button_ruby_png,
coinImage:bundles.infoview.frames.button_coin_png,font:cleverapps.styles.FONTS.INFO_BUTTON_TEXT,eventName:s},t)},createGuide:function(t){var e=cleverapps.styles.InfoView.guide,s=new cleverapps.UI.Button({button_png:bundles.merge.frames.guide_button_png,button_on_png:bundles.merge.frames.guide_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"InfoViewGuide",action:function(e){new t.class(t.unit),cleverapps.metha.onceNoWindowsListener=e}}),InfoView.CloseInfo()}});return s.setAnchorPoint2(),s.setPositionRound(e),s}});InfoView.MINIMAL_REMOVE_LEVEL=6,InfoView.SqueezeAndDisplay=function(e){if(!InfoView.blocked){var t=InfoView.latestParent===e;t||InfoView.CloseInfo(),(InfoView.blocked=e).onSqueeze(function(){InfoView.blocked=!1,t?InfoView.CloseInfo():InfoView.DisplayInfo(e)}.bind(this))}},InfoView.DisplayInfo=function(e){var t=e.getInfo();t&&!Game.currentGame.map.dragging&&Game.currentGame.tutorial.isInfoAvailable()&&(InfoView.IsOpened()&&InfoView.CloseInfo(),
InfoView.CreateInfo(t,e))},InfoView.IsOpened=function(){return void 0!==InfoView.latestParent},InfoView.Clear=function(e){e&&InfoView.latestParent!==e||(InfoView.latestParent=void 0),e&&InfoView.blocked!==e||(InfoView.blocked=!1)},InfoView.CloseInfo=function(e,t){InfoView.latestParent?(InfoView.latestParent.onGetView().removeAdditionalView("info",e,t),InfoView.latestParent.onInfoClosed(e),InfoView.latestParent=void 0):e&&e()},InfoView.CreateInfo=function(e,t){var s=cleverapps.styles.InfoView,i=new InfoView(e),n=t.onGetView();(i.setPositionRound(n.width/2,n.height+s.dy),n.insertAdditionalView("info",i),t.onInfoOpened(),cleverapps.config.wysiwygMode)||cc.director.getRunningScene().makeNodeVisible(i);InfoView.latestParent=t},cleverapps.overrideFonts(cleverapps.styles.FONTS,{INFO_TEXT:{size:23,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},INFO_BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,
shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},INFO_BUILD_BUTTON_TEXT:{size:28,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},INFO_TIMER_TEXT:{name:"nostroke",size:30,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.InfoView={dy:10,margin:5,padding:{x:20,y:20},pointer:{x:{align:"center"},y:-6},title:{width:185,height:80,icon:{scale:.6,margin:2,padding:{left:-15,right:0,y:0}}},remains:{width:170,height:25,padding:{x:0,y:0}},timer:{margin:5,padding:{x:0,top:10,bottom:0}},actions:{margin:10,padding:{x:0,top:10,bottom:0}},button:{width:170,height:70,padding:{left:20,right:20,top:5,bottom:10},margin:5},guide:{x:{align:"right",dx:35},y:{align:"top",dy:35}}};var PrizeView=cc.Scale9Sprite.extend({ctor:function(e){e=e||{};var t=cleverapps.styles.PrizeView;this._super(!0===e.warning?bundles.mergeui.frames.background_warning:bundles.mergeui.frames.background),
this.setAnchorPoint2(.5,0),this.setContentSize2(t.width,t.height),this.setLocalZOrder(1);var s=new cc.Sprite(!0===e.warning?bundles.mergeui.frames.pointer2_warning:bundles.mergeui.frames.pointer2);if(s.setAnchorPoint2(),s.setPositionRound(this.width/2,t.pointer.dy),this.addChild(s),e.prize||e.sprite){var i;e.sprite?i=new cc.Sprite(e.sprite):(i=UnitView.getUnitImage(e.prize)).clearTrack&&i.clearTrack(0),i.setPositionRound(this.width/2,this.height/2);var n=e.padding||t.padding;cleverapps.UI.fitToBox(i,{width:this.width-2*n.x,height:this.height-2*n.y}),this.addChild(i)}if(e.animation){var o=new cleverapps.Spine(bundles.mergeui.jsons.timer_json,t.animation.scale);o.setAnchorPoint2(),o.setPositionRound(t.animation),o.setAnimation(0,"animation",!0),this.addChild(o)}e.attention&&this.createAttention(e.attention),e.onClick&&!cleverapps.environment.isSceneWithPreview()&&cleverapps.UI.onClick(this,e.onClick),this.setScale(.5)},createAttention:function(e){
this.attention&&this.attention.removeFromParent();var t=cleverapps.styles.PrizeView,s=this.attention=new cc.Sprite(e);s.setPositionRound(this.width+t.attention.dx,this.height+t.attention.dy),this.addChild(s)},hasAttention:function(){return this.attention},runAnimation:function(){var e=cleverapps.styles.PrizeView;this.stopAllActions(),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1,1).easing(cc.easeIn(1)),new cc.CallFunc(function(){this.runAction(new cc.RepeatForever(new cc.Sequence(new cc.MoveBy(e.duration,0,e.delta).easing(cc.easeInOut(1.7)),new cc.MoveBy(e.duration,0,-e.delta).easing(cc.easeInOut(1.7)))))}.bind(this))))}});cleverapps.styles.PrizeView={width:72,height:72,padding:{x:10,y:10},duration:1,delta:10,pointer:{dy:2},attention:{dx:-7,dy:-7},animation:{x:{align:"center"},y:{align:"center",dy:3},scale:.8}};var HighlightView=cc.Node.extend({ctor:function(e){this._super(),this.highlight=e;var t=bundles.merge.jsons.hint_json
;cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.customHighlight&&(t=bundles.ads_map2d.jsons.highlight,this.customHighlight=Game.currentGame.map.getAdsMapView().customHighlightColor,this.setColor(this.customHighlight));var s=new cleverapps.Spine(t);this.setAnchorPoint2(),this.setContentSize2(cleverapps.styles.Map2dView.cell),s.setPositionRound(this.width/2,this.height/2),s.setAnimation(0,"animation",!0),this.addChild(s),this.setLocalZOrder(-1),this.setRecCascadeColorEnabled(),e.onMove=this.createListener(this.move.bind(this)),e.hide=this.createListener(this.hide.bind(this)),e.show=this.createListener(this.show.bind(this)),e.onRemove=this.createListener(this.removeFromParent.bind(this)),e.up=this.createListener(this.up.bind(this))}});HighlightView.prototype.hide=function(){this.visible=!1},HighlightView.prototype.show=function(e,t){this.visible=!0},HighlightView.prototype.up=function(){this.setLocalZOrder(1)},HighlightView.prototype.move=function(e,t,s){this.stopAllActions()
;var i=Game.currentGame.map.getView().alignInIsometricGrid(e,t);s?this.setPositionRound(i):this.runAction(new cc.MoveTo(.05,i.x,i.y));var n=cleverapps.styles.COLORS.WHITE;this.highlight.error?n=cleverapps.styles.COLORS.COLOR_RED:cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.customHighlight&&(n=this.customHighlight),this.setColor(n)};var UnitAdditionalView=cc.Node.extend({ctor:function(e,t,s){this._super(),this.unitView=e,this.view=t,this.type=s,this.setPositionRound(t.alignment||t.getPosition()),delete t.alignment,t.setPositionRound(0,0),this.addChild(t),e.addChild(this),this.basePosition=this.getPosition(),this.invertZOrder="timer"===s;var i=Game.currentGame.map.getView();i&&this.replaceParentSamePlace(i.animations),this.hidden=!1},updatePosition:function(){var e=Game.currentGame.map.getView(),t=e&&this.invertZOrder?this.y-2*e.height:-this.y;this.setPositionRound(this.parent.convertToNodeSpace(this.unitView.convertToWorldSpace(this.basePosition))),this.view.setPositionRound(
0,0),this.setLocalZOrder(t)},show:function(e,t){if(!cleverapps.config.editorMode){if(this.updatePosition(),this.hidden||(t=!0),this.hidden=!1,this.stopAllActions(),t)return this.setScale(1),this.setVisible(!0),e&&e(),void(this.view.runAnimation&&this.view.runAnimation());var s=[new cc.Show,new cc.ScaleTo(.2,1,1).easing(cc.easeIn(1))];e&&s.push(new cc.CallFunc(e)),this.view.runAnimation&&s.push(new cc.CallFunc(this.view.runAnimation.bind(this.view))),this.setScale(.5),this.runAction(new cc.Sequence(s))}},hide:function(e,t){if(this.hidden&&(t=!0),this.hidden=!0,this.stopAllActions(),t)return this.setVisible(!1),void(e&&e());var s=[new cc.ScaleTo(.1,.5,.5).easing(cc.easeIn(1)),new cc.Hide];e&&s.push(new cc.CallFunc(e)),this.setScale(1),this.runAction(new cc.Sequence(s))},remove:function(e,t){var s=function(){this.removeFromParent(),e&&e()}.bind(this);this.hide(s,t)},onCellSetVisible:function(e){e?this.hidden?this.hide():this.show():(this.stopAllActions(),this.setVisible(!1))}}),
UnitView=cc.Node.extend({ctor:function(e){this._super(),this.unit=e,this.additionalViews={},this.sprite=UnitView.getUnitImage(e);var t=UnitView.getUnitStyles(e);this.setAnchorPoint2(t.anchorX,t.anchorY);var s=this.sprite.getContentSize();s.width=Math.max(cleverapps.styles.UnitView.minimalSize.width,s.width),s.height=Math.max(cleverapps.styles.UnitView.minimalSize.height,s.height),this.setContentSize2(s),this.sprite.setPositionRound(this.width/2,this.height/2),this.addChild(this.sprite),e.checkTouchInside=this.createListener(this.checkTouchInside.bind(this)),e.onClickEvent=this.createListener(this.handleClick.bind(this)),e.onDragStart=this.createListener(this.handleDragStart.bind(this)),e.onDragMove=this.createListener(this.handleDragMove.bind(this)),e.onDragEnd=this.createListener(this.handleDragEnd.bind(this)),e.onAdd=this.createListener(this.playAddAnimation.bind(this)),e.onDestruction=this.createListener(this.playDestruction.bind(this)),e.onRemove=this.createListener(
this.removeFromParent.bind(this)),e.onMove=this.createListener(this.move.bind(this)),e.onStartDidMerged=this.createListener(this.startDidMerged.bind(this)),e.onDidMerged=this.createListener(this.didMerged.bind(this)),e.onMerge=this.createListener(this.merge.bind(this)),e.onStartAnimateMerge=this.createListener(this.startAnimateMerge.bind(this)),e.onStopAnimateMerge=this.createListener(this.stopAnimateMerge.bind(this)),e.onSqueeze=this.createListener(this.squeeze.bind(this)),e.onSpawned=this.createListener(this.spawn.bind(this)),e.onFogOpen=this.createListener(this.fogOpen.bind(this)),e.onChangePrizes=this.createListener(this.showPrizeView.bind(this)),e.onMarkError=this.createListener(this.markError.bind(this)),e.onMarkNormal=this.createListener(this.markNormal.bind(this)),e.onGetView=this.createListener(function(){return this}.bind(this)),e.onShowPoints=this.createListener(this.showPoints.bind(this)),e.onHidePoints=this.createListener(this.hidePoints.bind(this)),
e.onClaimPoints=this.createListener(this.claimPoints.bind(this)),this.unit.components.forEach(function(e){ViewFactory(e,this)},this);var i=this.unit.prizes;void 0!==i&&(i.length||i.minigame||i.resource)&&this.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(this.showPrizeView.bind(this)))),this.unit.points&&this.showPoints()},checkTouchInside:function(e){if(!this.isDisplayed())return!1;var t={width:cleverapps.styles.Map2dView.cell.width,height:cleverapps.styles.Map2dView.cell.height};return this.unit.isMultiCell()&&(t.width*=2,t.height*=2),cleverapps.UI.targetContainPoint(this,this.convertTouchToNodeSpace(e),t)},update:function(e){if(void 0!==this.lastDragTouchMove){this.setPositionRound(this.parent.convertTouchToNodeSpace(this.lastDragTouchMove));var t=Game.currentGame.map.getView(),s=t.convertTouchToNodeSpace(this.lastDragTouchMove),i=t.getCellByCoordinates(s);this.unit.handleDragMove(i.x,i.y);var n=cc.director.getRunningScene().scroll;n&&n.borderTouchScrollIteration(
this.lastDragTouchMove,15*e/.016,85)}},unscheduleUpdate:function(){this.lastDragTouchMove=void 0,this._super()},cleanup:function(){this._super(),Object.keys(this.additionalViews).forEach(function(e){this.removeAdditionalView(e)}.bind(this)),InfoView.Clear(this.unit)}});UnitView.prototype.removeSilent=function(){this.unit.findComponent(Grounded)&&this.unit.findComponent(Grounded).remove(!0),this.removeFromParent()},UnitView.prototype.fogOpen=function(){this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.2).easing(cc.easeOut(2)),new cc.ScaleTo(.3,1).easing(cc.easeInOut(2))))},UnitView.prototype.spawn=function(e,t,s){var i;if(s.parentWorldPosition)i=this.getParent().convertToNodeSpace(s.parentWorldPosition);else if(s.fromNode)i=e.parent?this.getRelativeCoordinates(e):e;else{(i=Map2dView.IsoToScreen(e.x-this.unit.x,e.y-this.unit.y)).y+=cleverapps.styles.Map2dView.cell.height/2;var n=e.findComponent&&e.findComponent(MultiCell);if(n){var o=n.getCenter();i.x+=o.x,i.y+=o.y}}this.setScale(
s.startScale?s.startScale:.3),s.startAnchors&&(i.x+=this.scale*this.width*(this.anchorX-s.startAnchors.anchorX),i.y+=this.scale*this.height*(this.anchorY-s.startAnchors.anchorY));var r={x:this.x-i.x,y:this.y-i.y};this.setPositionRound(i.x,i.y),this.visible=!1;var a=this.getAnimation(),c=a&&a.findAnimation("landing");c&&(a.setCompleteListener(null),a.setAnimation(0,"landing",!1),a.clearTrack(0)),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.fastSpawnPrizes?this.runAction(new cc.Sequence(new cc.DelayTime(s.wysiwygExplosionChest?.5:0),new cc.Show,new cc.CallFunc(function(){cleverapps.UI.jumpAnimation(this,r,{parent:Game.currentGame.map.getView().animations,h:cleverapps.styles.UnitView.spawnHeight,time:.3,spawn:new cc.ScaleTo(.3,1).easing(cc.easeOut(2)),callback:function(){cleverapps.audio.playSound(bundles.merge.urls.spawn_landing_effect)}.bind(this)})}.bind(this)))):this.runAction(new cc.Sequence(new cc.DelayTime(.1*t),new cc.Show,new cc.CallFunc(function(){
var s=new cleverapps.Particles(bundles.particle.jsons.particles_spawn_json,bundles.game.urls.particle_texture);Game.currentGame.map.getView().animations.addChild(s),s.followTarget(this);var e=.6*(.5+.001*Math.sqrt(r.x*r.x+r.y*r.y));cleverapps.UI.jumpAnimation(this,r,{parent:Game.currentGame.map.getView().animations,h:cleverapps.styles.UnitView.spawnHeight,time:e,spawn:new cc.ScaleTo(e,1).easing(cc.easeOut(2)),callback:function(){var e=Game.currentGame.map.getView().getCell(Map2d.LAYER_UNITS,this.unit.x,this.unit.y),t=new cleverapps.Spine(bundles.merge.jsons.reward_highlight_json);t.setPositionRound(e.width/2,e.height/2),t.setLocalZOrder(-1),t.setCompleteListenerRemove(),t.setAnimation(0,"animation",!1),e.addChild(t),s.stop(),c&&(a.setAnimation(0,"landing",!1),a.setCompleteListener(function(){a.setCompleteListener(null),UnitView.applyDefaultAnimation(a,this.unit)}.bind(this))),cleverapps.audio.playSound(bundles.merge.urls.spawn_landing_effect)}.bind(this)})}.bind(this))))},
UnitView.prototype.squeeze=function(e){this.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.1,.9),new cc.ScaleTo(.1,1,1),new cc.CallFunc(function(){e&&e()})))},UnitView.prototype.handleClick=function(){this.unit.handleClick()?InfoView.CloseInfo():(cleverapps.audio.playSound(bundles.main.urls.click_effect),InfoView.SqueezeAndDisplay(this.unit))},UnitView.prototype.startDidMerged=function(){this.visible=!1;var e=bundles.merge.jsons.merge_json;cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.customMergeAnimation&&(e=Game.currentGame.map.getAdsMapView().getStyles().mergeAnimation.animation);var t=new cleverapps.Spine(e);this.parent.addChild(t),t.replaceParentSamePlace(Game.currentGame.map.getView().animations),t.setAnimation(0,"animation",!1),t.setCompleteListener(t.removeFromParent.bind(t))},UnitView.prototype.didMerged=function(){this.visible=!0,this.setScale(.5),this.runAction(new cc.Sequence(new cc.ScaleTo(.3,1.2,1.2).easing(cc.easeOut(2)),new cc.ScaleTo(.2,1,1).easing(cc.easeIn(2
))))},UnitView.prototype.stopAnimateMerge=function(e){this.animateMergeAction&&!this.animateMergeAction.isDone()&&(this.stopAction(this.animateMergeAction),delete this.animateMergeAction),this.unit!==e&&this.runAction(new cc.MoveTo(.1,0,0)),this.runAction(new cc.ScaleTo(.1,1))},UnitView.prototype.merge=function(e){var t=Game.currentGame.map.getView();this.replaceParentSamePlace(t.getCell(Map2d.LAYER_UNITS,e.x,e.y)),this.runAction(new cc.Sequence(new cc.MoveTo(.2,0,0).easing(cc.easeIn(2)),new cc.RemoveSelf))},UnitView.prototype.startAnimateMerge=function(e){if(!this.animateMergeAction){var t=[];if(t.push(new cc.Sequence(new cc.ScaleTo(.325,1.03),new cc.ScaleTo(.325,1),new cc.DelayTime(.1))),0!==this.unit.distanceTo(e)&&this.unit!==e){var s=Game.currentGame.map.getView().getCell(Map2d.LAYER_UNITS,e.x,e.y),i=s.x-this.parent.x,n=s.y-this.parent.y,o=Math.sqrt(i*i+n*n);i=i/o*cleverapps.styles.UnitView.merge,n=n/o*cleverapps.styles.UnitView.merge,2<this.unit.distanceTo(e)&&(i/=2,n/=2),
cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.automerge?t.push(new cc.Sequence(new cc.MoveBy(.35,-i,-n).easing(cc.easeBackOut()))):t.push(new cc.Sequence(new cc.MoveBy(.325,i,n).easing(cc.easeBackIn()),new cc.MoveBy(.325,-i,-n).easing(cc.easeOut(2)),new cc.DelayTime(.1)))}if(0<t.length){var r=1===t.length?t[0]:new cc.Spawn(t);this.animateMergeAction=this.runAction(new cc.RepeatForever(r))}}},UnitView.prototype.handleDragStart=function(){if(!this.unit.handleDragStart())return!1;for(var e in InfoView.CloseInfo(),this.additionalViews){var t=this.additionalViews[e];t.hide(t.replaceParentSamePlace.bind(t,Game.currentGame.map.getView().animations))}var s=Game.currentGame.map.getView();if(this.replaceParentSamePlace(s.animations),this.unit.findComponent(Shine)||this.unit.findComponent(Chest)||this.unit.findComponent(Fruit)){var i=this.path=new cleverapps.Particles(bundles.particle.jsons.particles_drag_json,bundles.game.urls.particle_texture);i.setScale(
1/Game.currentGame.getScrollZoom()),i.setPosition(this.width/2,this.height/2),this.addChild(i),i.setLocalZOrder(-1)}return this.scheduleUpdate(),!0},UnitView.prototype.handleDragMove=function(e){this.lastDragTouchMove=e.touch},UnitView.prototype.handleDragEnd=function(){for(var e in this.markNormal(),this.path&&(this.path.stop(),this.path=void 0),this.additionalViews)this.additionalViews[e].show();this.unscheduleUpdate(),this.unit.handleDragEnd()},UnitView.prototype.markNormal=function(){this.sprite&&this.sprite.setColor(cleverapps.styles.COLORS.WHITE)},UnitView.prototype.markError=function(){this.sprite&&this.sprite.setColor(cleverapps.styles.COLORS.COLOR_RED)},UnitView.prototype.move=function(){var e=Game.currentGame.map.getView();for(var t in this.replaceParentSamePlace(e.getCell(Map2d.LAYER_UNITS,this.unit.x,this.unit.y)),this.additionalViews){var s=this.additionalViews[t];s.replaceParentSamePlace(this),s.updatePosition()}var i={x:0,y:0};this.unit.isMultiCell()&&(
i=MultiCellView.calcCenterPosition(this.unit.findComponent(MultiCell).shape)),this.stopAllActions(),this.runAction(new cc.Sequence(new cc.MoveTo(.1,i),new cc.CallFunc(function(){for(var e in this.additionalViews){var t=this.additionalViews[e];t.replaceParentSamePlace(Game.currentGame.map.getView().animations),t.updatePosition()}}.bind(this))))},UnitView.UnitIconFrame=function(e){return bundles["unit_"+e.code].frames["unit_"+e.code+(e.stage+1)]},UnitView.UnitIconJson=function(e){return bundles["unit_"+e.code].jsons["unit_"+e.code+(e.stage+1)]},UnitView.getUnitStyles=function(e){var t=cleverapps.styles.UnitAnchors[e.code]&&cleverapps.styles.UnitAnchors[e.code]["stage"+(e.stage+1)]||{};return{anchorX:void 0===t.anchorX?.5:t.anchorX,anchorY:void 0===t.anchorY?.5:t.anchorY}},UnitView.getUnitAnimations=function(e){return cleverapps.styles.UnitAnimations[e.code]&&cleverapps.styles.UnitAnimations[e.code]["stage"+(e.stage+1)]},UnitView.getUnitImage=function(e){if(!bundles["unit_"+e.code]
)throw"Not found bundle unit_"+e.code;var t,s=UnitView.UnitIconJson(e),i=UnitView.UnitIconFrame(e);if(!s&&!i)throw"Not found frame unit_"+(e.code+(e.stage+1));return s?(t=new cleverapps.Spine(s),UnitView.applyDefaultAnimation(t,e)):t=new cc.Sprite(i),t},UnitView.applyDefaultAnimation=function(e,t){var s=UnitView.getUnitAnimations(t);s?e.setIdleSet(s):e.setAnimation(0,e.findAnimation("idle")?"idle":"animation",!0)},UnitView.prototype.playDestruction=function(){this.stopAllActions();var e=new cleverapps.Spine(bundles.merge.jsons.destruction_json);e.setPositionRound(this.width/2,this.height/2),e.setCompleteListenerRemove(this.removeFromParent.bind(this)),e.setAnimation(0,"animation",!1),this.addChild(e),e.replaceParentSamePlace(this.parent),this.unit.findComponent(Grounded)&&this.unit.findComponent(Grounded).remove(),cleverapps.audio.playSound(bundles.merge.urls.unit_desturction_effect),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.3,1.3).easing(cc.easeIn(1)),new cc.ScaleTo(.2,.5,.5
).easing(cc.easeOut(1)),new cc.RemoveSelf))},UnitView.prototype.playAppearance=function(){this.stopAllActions();var e=new cleverapps.Spine(bundles.merge.jsons.appearance_json);e.setPositionRound(this.width/2,this.height/2),e.setCompleteListenerRemove(this.removeFromParent.bind(this)),e.setAnimation(0,"animation",!1),this.addChild(e),e.replaceParentSamePlace(this.parent),this.runAction(new cc.Sequence(new cc.ScaleTo(.2,1.3,1.3).easing(cc.easeIn(1)),new cc.ScaleTo(.2,.5,.5).easing(cc.easeOut(1)),new cc.RemoveSelf))},UnitView.prototype.playAddAnimation=function(){var e=new cleverapps.Spine(bundles.buildable.jsons.buildable_above_json);e.setLocalZOrder(1),e.setAnimation(0,"animation_bonus",!1),e.setCompleteListenerRemove(),this.parent.addChild(e),this.setVisible(!1),this.setScale(.3),this.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.PlaySound(bundles.merge.urls.specialoffer_appearance_effect),new cc.Show,new cc.ScaleTo(.4,1.3),new cc.ScaleTo(.2,1)))},
UnitView.prototype.showPrizeView=function(e){if(!cleverapps.config.wysiwygMode||!cleverapps.flags.wysiwyg.hidePrizeView){this.removeAdditionalView("prize");var t=this.unit.prizes;if(void 0!==t){var s={warning:e,onClick:this.handleClick.bind(this)};this.unit.findComponent(MakesOrder)&&(s.attention=bundles.mergeui.frames.small_ok_exclamation),t.minigame?s.sprite=bundles.merge.frames.pickaxe:t.resource?s.sprite=t.infoViewImage:s.prize=t[0];var i=new PrizeView(s);i.setPositionRound(this.width/2,this.height),this.insertAdditionalView("prize",i),cleverapps.audio.playSound(bundles.merge.urls.prize_view_created_effect)}}},UnitView.prototype.insertAdditionalView=function(e,t,s){this.removeAdditionalView(e);var i=new UnitAdditionalView(this,t,e);this.additionalViews[e]=i,Game.currentGame.map.dragging===this.unit?i.hide(void 0,!0):i.show(void 0,s)},UnitView.prototype.getAdditionalView=function(e){return this.additionalViews[e]},UnitView.prototype.removeAdditionalView=function(e,t,s){
var i=this.additionalViews[e];return delete this.additionalViews[e],i&&i.remove(t,s),i},UnitView.prototype.setImageOpacity=function(e){this.sprite.setOpacity(e)},UnitView.prototype.onDeletePressed=function(){confirm('Delete unit "'+this.unit.code+"'?")&&(this.unit.onDestruction(),this.unit.remove(!0),Game.currentGame.fogs.updateBlockedGrounds())},UnitView.prototype.getAnimation=function(){if(this.sprite instanceof cleverapps.Spine)return this.sprite},UnitView.prototype.showPoints=function(){var e=cleverapps.styles.UnitView.pointsAnimation;if(!this.pointAnimation){var t=this.pointAnimation=new cleverapps.Spine(bundles.merge.jsons.battle_star);t.setAnchorPoint2(),t.setPositionRound(e),t.setAnimation(0,"idle",!0),this.addChild(t),t.setScale(.1),t.runAction(new cc.ScaleTo(1,1)),t.runAction(new cc.MoveBy(1,0,e.offsetY)),cleverapps.UI.onTouchBegan(t,this.unit.onTouchBeginEvent.bind(this.unit)),cleverapps.config.wysiwygMode&&cleverapps.flags.wysiwyg.hideUnitPointAnimation&&t.setVisible(!1)}},
UnitView.prototype.hidePoints=function(){var e=cleverapps.styles.UnitView.pointsAnimation;this.pointAnimation&&(this.pointAnimation.stopAllActions(),this.pointAnimation.runAction(new cc.ScaleTo(.3,.1)),this.pointAnimation.runAction(new cc.Sequence(new cc.MoveBy(.3,0,-e.offsetY),new cc.RemoveSelf)),delete this.pointAnimation)},UnitView.prototype.claimPoints=function(e){if(this.pointAnimation){this.pointAnimation.stopAllActions();var t=cleverapps.styles.SideBarIconView.battlepass;t?cleverapps.UI.collectAnimation(this.pointAnimation,t,{targetEffect:!0,callback:function(){cleverapps.UI.animateDelta(e,{x:cleverapps.styles.UnitView.iconPoints.position.x,y:cleverapps.styles.UnitView.iconPoints.position.y,parent:t,font:cleverapps.styles.FONTS.MENUBAR_TEXT}),cleverapps.audio.playSound(bundles.collectible.urls.exp_fly_finish_effect)}}):this.pointAnimation.removeFromParent(),delete this.pointAnimation}},UnitView.prototype.onCellSetVisible=function(e){for(var t in this.additionalViews){
this.additionalViews[t].onCellSetVisible(e)}},cleverapps.styles.UnitView={merge:16,iconPoints:{position:{x:{align:"center"},y:{align:"center",dy:100}}},minimalSize:{width:108,height:80},spawnHeight:240,pointsAnimation:{x:{align:"center",dx:0},y:{align:"center",dy:0},offsetY:50}};var OrdersTab=cc.Node.extend({ctor:function(t){var e=cleverapps.styles.OrdersTab;this._super(),this.setContentSize2(e);var s=Game.currentGame.orders.listOrders();if(0===s.length){var i=cleverapps.UI.generateOnlyText("messages:OrdersWindow.orders.placeholder",cleverapps.styles.FONTS.DARK_TEXT);return i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(.9*this.width,0),i.setPositionRound(this.width/2,this.height/2),void this.addChild(i)}this.createScroll(),void 0===t&&(t=Game.currentGame.orders.findReady()||Game.currentGame.orders.findCanCook());var n=s.filter(function(e){return e.maker===t})[0]||s[0];this.selectOrder(n)},createDetails:function(e){this.details&&(this.details.removeFromParent(),
delete this.details);var t=cleverapps.styles.OrdersTab.details,s=this.details=new OrderDetails(e);s.setAnchorPoint2(),s.setPositionRound(t),this.addChild(s)},createScroll:function(){var e,t=cleverapps.styles.OrdersTab.scroll,s=Game.currentGame.orders.listOrders(),i=this.icons=s.map(function(e){return new OrderMakerIcon(e,this.createListener(this.selectOrder.bind(this,e)))},this),n=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:t.padding});n.width>t.width?((e=new cleverapps.UI.ScrollView(n,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_NONE,direction:cleverapps.UI.ScrollView.DIR_HORIZONTAL,scrollBarEnabled:!1})).setContentSize2(t.width,t.height),e.scrollToDefault()):((e=new cc.Node).setContentSize2(t.width,t.height),n.setPositionRound({align:"left"},{align:"top"}),e.addChild(n)),e.setAnchorPoint2(),e.setPositionRound(t),this.addChild(e)},selectOrder:function(t){this.icons.forEach(function(e){e.unit===t.maker.unit?e.onSelect(
):e.onUnSelect()}),this.createDetails(t)}});cleverapps.styles.OrdersTab={width:1800,height:1030,details:{width:1150,height:450,x:{align:"center"},y:{align:"top",dy:-55}},scroll:{width:1752,height:395,x:{align:"center"},y:{align:"bottom",dy:35},margin:50,padding:{x:60,y:60}}};var OrderMakerIcon=cc.Sprite.extend({ctor:function(e,t){this.order=e,this.unit=e.maker.unit,this._super(bundles.orderswindow.frames.hero_background),this.icon=new cc.Sprite(bundles.unitslibrarywindow.frames["icon_"+this.unit.code]),this.addChild(this.icon),cleverapps.UI.applyHover(this),cleverapps.UI.onClick(this,t,{swallowTouches:!1,ignoreOnTouchMoved:!0,useInteractiveScale:!0}),Game.currentGame.orders.on("canCook",this.updateAttention.bind(this),this),Game.currentGame.orders.on("updateOrder",this.updateAttention.bind(this),this),this.setCascadeOpacityEnabled(!0),this.setCascadeColorEnabled(!0),this.updateAttention()},setAttention:function(e){this.attention&&(this.attention.removeFromParent(),delete this.attention
);var t=this.attention=new cc.Sprite(e);t.setPositionRound(cleverapps.styles.OrderMakerIcon.attention),t.setLocalZOrder(2),this.addChild(t)},removeAttention:function(){this.attention&&(this.attention.runAction(new cc.Sequence(new cc.ScaleTo(.15,0),new cc.RemoveSelf)),delete this.attention)},onSelect:function(){this.selected=!0,this.setColor(new cc.Color(255,255,255,255)),this.icon.setOpacity(255),this.setSpriteFrame(bundles.orderswindow.frames.hero_selected_background),this.icon.setPositionRound(cleverapps.styles.OrderMakerIcon.icon_selected),this.updateAttention()},onUnSelect:function(){this.selected=!1,this.setColor(new cc.Color(160,160,160,255)),this.icon.setOpacity(140),this.setSpriteFrame(bundles.orderswindow.frames.hero_background),this.icon.setPositionRound(cleverapps.styles.OrderMakerIcon.icon),this.updateAttention()},updateAttention:function(){switch(this.order.maker.state){case MakesOrder.STATE_RECIPE:this.order.maker.canCook()?this.setAttention(
bundles.mergeui.frames.attention_exclamation):this.unit.prize||this.setAttention(bundles.mergeui.frames.attention_exclamation_disabled);break;case MakesOrder.STATE_COOKING:this.unit.prize?this.removeAttention():this.setAttention(bundles.mergeui.frames.attention_sandglass);break;case MakesOrder.STATE_READY:this.setAttention(bundles.mergeui.frames.attention_ok);break;default:this.removeAttention()}}});cleverapps.styles.OrderMakerIcon={icon:{x:{align:"center",dx:0},y:{align:"bottom",dy:12}},icon_selected:{x:{align:"center",dx:0},y:{align:"bottom",dy:30}},attention:{x:{align:"center",dx:100},y:{align:"center",dy:100}}};var OrderDetails=cc.Node.extend({ctor:function(e){var t=cleverapps.styles.OrderDetails;this._super(),this.setContentSize2(t),this.setAnchorPoint2(),this.order=e=cleverapps.extend({},e,{prize:!0});var s=cleverapps.UI.createScale9Sprite(bundles.mergeui.frames.details_background,cleverapps.UI.Scale9Rect.TwoPixelXY);if(s.setContentSize2(t),s.setPositionRound(this.width/2,
this.height/2),this.addChild(s),t.line){var i=cleverapps.UI.createScale9Sprite(bundles.orderswindow.frames.details_line,cleverapps.UI.Scale9Rect.TwoPixelXY);i.setContentSize(this.width+2*t.line.padding.x,t.line.height),i.setAnchorPoint2(),i.setPositionRound(t.line),s.addChild(i)}var n=this.prize=this.createPrize(e);n.setPositionRound(t.prize),s.addChild(n);var o=this.timer=this.createTimer();n.addChild(o);var r=this.rewards=this.createRewards();r.setPositionRound(t.rewards),s.addChild(r);var a=this.button=this.createButton();a.setPositionRound(t.button),s.addChild(a);var c=this.ingredients=this.createIngredients();c.setPositionRound(t.ingredients),s.addChild(c);var l=new cc.Sprite(bundles.orderswindow.frames.equal_separator);l.setAnchorPoint2(),l.setPositionRound(t.equalSeparator),s.addChild(l),Game.currentGame.orders.on("updateOrder",function(e){e===this.order.maker&&(this.updateButton(),this.updateTimer(),this.updateIngredients())}.bind(this),this)},createPrize:function(){
var e=cleverapps.styles.OrderDetails.prize,t=this.order,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e);var i=new cc.Sprite(bundles.merge.frames.stand_ground);i.setAnchorPoint2(),i.setPositionRound(e.ground),s.addChild(i);var n=new cc.Node;return n.sprite=UnitView.getUnitImage(t),n.addChild(n.sprite),n.setContentSize(n.sprite.getContentSize()),n.sprite.setPositionRound(n.width/2,n.height/2),BubbleView(void 0,n),n.setPositionRound(e.icon),n.setScale(e.icon.scale),s.addChild(n),s},createTimer:function(){var e,t=cleverapps.styles.OrderDetails.timer,s=this.order.maker.getTimeLeft();return s?(e=new cleverapps.CountDownView(new cleverapps.CountDown(s),{font:cleverapps.styles.FONTS.ORDERDETAILS_TIMER_TEXT,background_image:{image:bundles.mergeui.frames.timer_substrate,width:t.width,height:t.height,scale9:!0}})).fitTo(.9*e.width,e.height):e=new cc.Node,e.setPositionRound(t),e},createRewards:function(){var s=cleverapps.styles.OrderDetails.rewards,e=cleverapps.UI.generateOnlyText(
"messages:OrdersWindow.orders.reward",cleverapps.styles.FONTS.ORDERDETAILS_REWARD_LABEL_TEXT);e.fitTo(s.label.width,s.label.height);var t=this.order.recipe.prize.map(function(e){var t=UnitView.getUnitImage(e);return t.clearTrack&&t.clearTrack(0),cleverapps.UI.fitToBox(t,{width:t.width,height:s.height}),t.scale*=1.4*(OrderDetails.UNIT_SCALES[Unit.GetKey(e)]||1),t});return t.unshift(e),new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:s.margin,padding:s.padding})},claimIngredients:function(){this.ingredients&&this.ingredients.icons&&this.ingredients.icons.forEach(function(e){e.flyIconAnimation(this.prize)},this),this.prize.runAction(new cc.Sequence(new cc.DelayTime(.8),new cc.CallFunc(function(){var e=new cleverapps.Spine(bundles.orderswindow.jsons.ow_rewards_highlight_json,1.7);e.setAnchorPoint2(),e.setPositionRound(this.width/2,this.height/2),e.setAnimation(0,"animation",!1),e.setCompleteListenerRemove(),this.addChild(e)},this.prize)))},createButton:function(){var e,
t=cleverapps.styles.OrderDetails.button,s=this.order.maker;if(s.state===MakesOrder.STATE_COOKING)e=new UseGoldButton({canCoins:!0,price:SpeedUpWindow.CalcPrice(s.getTimeLeft()),onClicked:this.makeOrder.bind(this),font:cleverapps.styles.FONTS.ORDERDETAILS_BUTTON_TEXT,image:bundles.reward_icons.frames.gold_small_png,coinImage:bundles.reward_icons.frames.coin_small_png,eventName:"speedup_order_ruby"},t);else if(-1!==[MakesOrder.STATE_RECIPE,MakesOrder.STATE_READY].indexOf(s.state)){var i=MakesOrder.STATE_RECIPE===s.state?"messages:OrdersWindow.orders.button.make":"messages:OrdersWindow.orders.button.claim";if(e=new cleverapps.UI.Button({styles:t,content:cleverapps.UI.generateOnlyText(i,cleverapps.styles.FONTS.ORDERDETAILS_BUTTON_TEXT),onClicked:this.makeOrder.bind(this),button_images:cleverapps.UI.Button.Images.button_green}),s.state===MakesOrder.STATE_READY&&!Game.currentGame.tutorial.isActive()){var n=new FingerView({scaleX:.8,scaleY:.8});e.addChild(n),n.setPositionRound(e.width/2,
e.height/2),n.standardLoop({delay:2.5})}}return e.adviceTarget=Merge.SPAWN,e},createIngredients:function(){for(var e=cleverapps.styles.OrderDetails.ingredients,t=Object.keys(this.order.recipe.ingredients),s=(t=t.concat(cleverapps.arrayFill(3-t.length,"")).reverse()).map(function(e){return new IngredientOrderIcon({code:e,stage:4,order:this.order})},this),i=s.slice(),n=0;n<s.length;n+=2){var o=new cc.Sprite(bundles.orderswindow.frames.plus_separator);""===i[n].unit.code&&o.setOpacity(150),i.splice(n+1,0,o)}var r=new cleverapps.Layout(i,{direction:cleverapps.UI.HORIZONTAL,margin:e.margin});return r.setAnchorPoint2(),r.icons=s,r},updateButton:function(){var e=this.button;if(e){var t=this.createButton();t.setVisible(!1),t.setScale(.1),t.setPositionRound(e.getPosition()),e.parent.addChild(t),e.runAction(new cc.Sequence(new cc.ScaleTo(.15,.1),new cc.CallFunc(t.runAction.bind(t,new cc.Sequence(new cc.Show,new cc.ScaleTo(.15,1)))),new cc.RemoveSelf)),this.button=t}},updateTimer:function(){
var e=this.timer;if(e){var t=this.createTimer();t.setPositionRound(e.getPosition()),e.parent.addChild(t),e.removeFromParent(),this.timer=t}},updateIngredients:function(){var e=this.ingredients;if(e){var t=this.createIngredients();t.setPositionRound(e.getPosition()),e.parent.addChild(t),e.removeFromParent(),this.ingredients=t}},makeOrder:function(){var e=this.order.maker;switch(e.state){case MakesOrder.STATE_RECIPE:e.cook()?(this.claimIngredients(),this.updateIngredients(),this.updateButton(),this.updateTimer()):this.showBuyIngredientsWindow();break;case MakesOrder.STATE_COOKING:e.enjoy()&&(this.updateIngredients(),this.updateButton(),this.updateTimer());break;case MakesOrder.STATE_READY:var t=e.unit;cleverapps.windows.currentWindow().close(),Game.currentGame.map.onCenterTo(t.x,t.y,{callback:t.handleClick.bind(t)})}},showBuyIngredientsWindow:function(){var e=Game.currentGame.harvested.calcMissingIngredients(this.order.recipe);cleverapps.metha.showControlsWhileFocused("MenuBarGoldItem"),
new BuyIngredientsWindow(e,function(){cleverapps.metha.hideControlsWhileFocused("MenuBarGoldItem"),this.order.maker.canCook()&&this.makeOrder()}.bind(this))}});OrderDetails.UNIT_SCALES={wands_0:.85,wands_1:1.2,wands_3:1.3,wands_4:1.1,wands_5:1.3},cleverapps.overrideFonts(cleverapps.styles.FONTS,{ORDERDETAILS_REWARD_LABEL_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},ORDERDETAILS_TIMER_TEXT:{size:48,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},ORDERDETAILS_BUTTON_TEXT:{size:54,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.OrderDetails={width:1680,height:550,x:{align:"center"},y:{align:"top",dy:-60},ingredients:{x:{
align:"center",dx:-220},y:{align:"center",dy:70},margin:15},rewards:{x:{align:"center",dx:-250},y:{align:"center",dy:-150},margin:20,padding:{x:10,y:0},height:84,label:{width:310,height:0}},button:{x:{align:"center",dx:570},y:{align:"center",dy:-145},width:280,height:100,padding:{left:20,right:20,top:5,bottom:5},margin:4},prize:{x:{align:"center",dx:570},y:{align:"center",dy:70},width:300,height:300,icon:{x:{align:"center",dx:-7},y:{align:"center",dy:-20},scale:1.7},ground:{x:{align:"center",dx:0},y:{align:"center",dy:-25}}},timer:{x:{align:"center"},y:{align:"bottom",dy:5},width:250,height:64},equalSeparator:{x:{align:"center",dx:350},y:{align:"center",dy:70}}};var IngredientIcon=cc.Scale9Sprite.extend({ctor:function(e){var t=cleverapps.styles.IngredientIcon;this._super(bundles.mergeui.frames.icon_background),this.setContentSize2(t);var s=UnitView.getUnitImage(e);s.setScale(t.icon.scale),s.setPositionRound(t.icon),this.addChild(s);var i=Game.currentGame.harvested.get(e.code),
n=cleverapps.UI.generateImageText(i,cleverapps.styles.FONTS.INGREDIENT_ICON_TEXT);n.setLocalZOrder(2),n.setPositionRound(t.amountText),this.addChild(n)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{INGREDIENT_ICON_TEXT:{name:"default",size:72,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR}}),cleverapps.styles.IngredientIcon={width:280,height:280,icon:{x:{align:"center",dx:0},y:{align:"center",dy:10},scale:1.4},amountText:{x:{align:"right",dx:-35},y:{align:"bottom",dy:35}}};var IngredientOrderIcon=cc.Scale9Sprite.extend({ctor:function(e){this.unit=e,this._super(bundles.mergeui.frames.icon_background_light),this.setContentSize2(cleverapps.styles.IngredientOrderIcon),e.code?(this.addIcon(),this.addAmountText()):this.setOpacity(150)},addIcon:function(){var e=cleverapps.styles.IngredientOrderIcon.icon,t=this.icon=UnitView.getUnitImage(this.unit);t.setScale(e.scale),t.setPositionRound(e),this.addChild(t);var s=this.unit.order;s&&s.maker.state!==MakesOrder.STATE_RECIPE&&t.setOpacity(
127)},addAmountText:function(){var e=this.unit.order;if(!e||e.maker.state===MakesOrder.STATE_RECIPE){var t=cleverapps.styles.IngredientOrderIcon,s=Game.currentGame.harvested.get(this.unit.code),i=this.unit.order.recipe.ingredients[this.unit.code],n=cleverapps.UI.generateImageText(s,cleverapps.styles.FONTS.INGREDIENT_ORDER_ICON_TEXT);n.setColor(s<i?cleverapps.styles.COLORS.COLOR_RED:cleverapps.styles.COLORS.GREEN);var o=cleverapps.UI.generateImageText("/"+i,cleverapps.styles.FONTS.INGREDIENT_ORDER_ICON_TEXT),r=new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL});r.setLocalZOrder(2),r.setPositionRound(t.amountText),cleverapps.UI.fitToBox(r,{width:t.amountText.width,height:r.height}),this.addChild(r)}},flyIconAnimation:function(e){if(this.unit.code){var t=UnitView.getUnitImage(this.unit),s=cleverapps.windows.currentWindow(),i=s.convertToNodeSpace(this.convertToWorldSpace(this.icon)),n=s.convertToNodeSpace(e.parent.convertToWorldSpace(e));s.addChild(t),t.setLocalZOrder(100),
t.setPositionRound(i),t.runAction(new cc.Sequence(new cc.ScaleTo(0,this.scale),new cc.Spawn(new cc.JumpTo(.8,n.x,n.y,200,1),new cc.Sequence(new cc.ScaleTo(.6,2),new cc.ScaleTo(.2,this.scale))),new cc.RemoveSelf))}}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{INGREDIENT_ORDER_ICON_TEXT:{name:"default",size:72,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR}}),cleverapps.styles.IngredientOrderIcon={width:280,height:280,icon:{x:{align:"center",dx:0},y:{align:"center",dy:35},scale:1.4},amountText:{width:200,x:{align:"center",dx:0},y:{align:"bottom",dy:35}}};var OrdersWindowUnitsTab=cc.Node.extend({ctor:function(e){var t=cleverapps.styles.OrdersWindowUnitsTab;this._super(),this.setContentSize2(t);var s=new cleverapps.GridLayout(e,{columns:5,direction:cleverapps.GridLayout.TOP_TO_BOTTOM,margin:t.grid.margin,padding:t.grid.padding});s.height>t.grid.height&&((s=new cleverapps.UI.ScrollView(s,{childrenVisibility:cleverapps.UI.ScrollView.CHILDREN_VISIBILITY_FULLCHECK,
direction:cleverapps.UI.ScrollView.DIR_VERTICAL,scrollBarEnabled:!1})).setContentSize(t.grid.width,t.grid.height),s.scrollToDefault()),s.setAnchorPoint2(),s.setPositionRound(t.grid),this.addChild(s)}});cleverapps.styles.OrdersWindowUnitsTab={width:1800,height:1030,grid:{x:{align:"left",dx:62},y:{align:"top",dy:-5},width:1680,height:990,margin:{x:60,y:40},padding:{x:25,y:60}}};var RecipeIcon=cc.Scale9Sprite.extend({ctor:function(e){var t=cleverapps.styles.RecipeIcon;this.unit=e,this.recipe=Families.dishes.units[e.stage].recipe,this._super(bundles.mergeui.frames.icon_background),this.setContentSize2(t);var s=Game.currentGame.gameLevel.getLevel();this.recipe.level<=s?(this.addIcon(),this.addTooltip()):this.addLevelBlocker()},addIcon:function(){var e=cleverapps.styles.RecipeIcon.icon,t=UnitView.getUnitImage(this.unit);t.setScale(e.scale),t.setPositionRound(e),this.addChild(t)},addLevelBlocker:function(){var e=cleverapps.styles.RecipeIcon.blocker,t=new cc.Sprite(
bundles.mergeui.frames.icon_blocker);t.setPositionRound(e),this.addChild(t);var s=new cleverapps.UI.generateImageText(this.recipe.level,cleverapps.styles.FONTS.RECIPE_ICON_BLOCKER_TEXT);s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setPositionRound(e.text),s.fitTo(e.text.width,e.text.height),t.addChild(s)},addTooltip:function(){var s=cleverapps.styles.RecipeIcon.tooltip,e=cleverapps.UI.generateOnlyText("messages:OrdersWindow.icons.required",cleverapps.styles.FONTS.DARK_TEXT),t=Object.keys(this.recipe.ingredients).map(function(e){var t=UnitView.getUnitImage({code:e,stage:4});return t.setScale(s.scale),t});t=new cleverapps.Layout(t,{direction:cleverapps.UI.HORIZONTAL,margin:s.margin});var i=new cleverapps.Layout([t,e],{direction:cleverapps.UI.VERTICAL,margin:s.margin});cleverapps.tooltipManager.create(this,{content:i,size:i.getContentSize(),position:cleverapps.styles.UI.Tooltip.LOCATION.below,swallowTouches:!1,ignoreOnTouchMoved:!0,
ignoreOnTouchMovedThreshold:s.ignoreOnTouchMovedThreshold,useInteractiveScale:!0})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{RECIPE_ICON_BLOCKER_TEXT:{name:"nostroke",size:58,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.RecipeIcon={width:280,height:280,blocker:{x:{align:"center"},y:{align:"center"},text:{width:62,height:85,x:{align:"center",dx:8},y:{align:"center",dy:-29}}},tooltip:{scale:1,margin:0,ignoreOnTouchMovedThreshold:10},icon:{x:{align:"center"},y:{align:"center",dy:5},scale:1.8}};var OrdersWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.OrdersWindow;this.tabsInfo=this.createTabs(e),this._super({name:"OrdersWindow",title:"messages:OrdersWindow.orders.title",adjustToContent:!0,closeButton:!0,noBackground:!0,regularCloseButton:!0,extraWidth:2*t.contentOffsetX,contentOffsetX:t.contentOffsetX,content:this.createContent(),foreground:bundles.windows.frames.window_foreground_png}),cleverapps.audio.playSound(
bundles.main.urls.window_effect),this.tabs.activateTab(0)},createTabs:function(e){var t=function(e){return this.content.addChild(e),e}.bind(this);return{0:{icon:bundles.windows.frames.tab_icon_orders,updateTitle:this.setTitle.bind(this,"messages:OrdersWindow.orders.title"),generator:function(){return t(new OrdersTab(e))}},1:{icon:bundles.windows.frames.tab_icon_recipes,updateTitle:this.setTitle.bind(this,"messages:OrdersWindow.recipes.title"),generator:function(){return t(new OrdersWindowUnitsTab(this.listRecipeUnits()))}.bind(this)},2:{icon:bundles.windows.frames.tab_icon_ingredients,updateTitle:this.setTitle.bind(this,"messages:OrdersWindow.ingredients.title"),generator:function(){return t(new OrdersWindowUnitsTab(this.listIngredientUnits()))}.bind(this)}}},createContent:function(){var e=cleverapps.styles.OrdersWindow,t=this.content=cleverapps.UI.createScale9Sprite(bundles.windows.frames.window_bg_png,cleverapps.styles.Window.Background.scale9);t.setContentSize2(e.width,e.height)
;var s=this.tabs=new Tabs(this.tabsInfo,e.tabs);return s.setAnchorPoint2(),s.setPositionRound(e.tabs),t.addChild(s),t},listIngredientUnits:function(){return Game.currentGame.listAvailableByType("fruit").map(function(e){return new IngredientIcon({code:e,stage:4})})},listRecipeUnits:function(){return Families.dishes.units.map(function(e,t){return new RecipeIcon({code:"dishes",stage:t})})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{ORDERSWINDOW_TITLE:{size:24,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},ORDERSWINDOW_TITLE_DISABLED:{size:24,color:cleverapps.styles.COLORS.LIGHT_TEXT_DISABLED_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.OrdersWindow={width:1800,height:1050,contentOffsetX:60,tabs:{x:{align:"left",dx:-118},y:{align:"top",dy:-40}}};var UnitOnCell=cc.Node.extend({
ctor:function(e,t){var s=(t=t||{}).scale||1,i=cleverapps.styles.UnitOnCell;this._super(),this.setAnchorPoint2(),this.setContentSize2(i.width*s,i.height*s);var n=new cc.Sprite(bundles.merge.frames.stand_ground);n.setAnchorPoint2(),n.setPositionRound(this.width/2+i.ground.x*s,this.height/2+i.ground.y*s),n.setScale(i.ground.scale*s),this.addChild(n);var o=UnitView.getUnitStyles(e);if(t.animation){var r=new cleverapps.Spine(bundles.merge.jsons.prize_shining_json,i.shine.scale*s);r.setPositionRound(this.width/2+i.shine.x*s,this.height/2+i.shine.y*s),r.setAnimation(0,"idle",!0),this.addChild(r)}var a=UnitView.getUnitImage(e);a.setAnchorPoint2(o.anchorX,o.anchorY),a.setPositionRound(this.width/2+i.icon.x*s,this.height/2+i.icon.y*s),a.setScale(s),this.addChild(a)}});cleverapps.styles.UnitOnCell={width:169,height:131,icon:{x:0,y:-22},shine:{x:0,y:-9,scale:.75},ground:{x:3,y:-24,scale:.625}};var OpenChestWindow=Window.extend({onWindowLoaded:function(e,t){this.unit=e,this.asyncResult=t,
this._super({title:this.getTitle(),name:"OpenChestWindow",content:this.createContent(),buttons:this.createButton(),adjustToContent:!0,closeButton:!0,foreground:bundles.windows.frames.window_foreground_png}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getTitle:function(){var e=Messages.get("sacks"===this.unit.getResource()?"sack":"chest");return Messages.get("OpenChestWindow.title",{name:e})},openChest:function(){this.asyncResult.executed=!0,this.close()},generateContains:function(){var i=cleverapps.styles.OpenChestWindow.prize,n=[];return this.unit.findComponent(Chest).listAvailable().forEach(function(e){var t=new cc.Scale9Sprite(bundles.openchestwindow.frames.icon_background_light);t.setContentSize2(i.background);var s=UnitView.getUnitImage(e);s.setAnchorPoint2(),s.setPositionRound(t.width/2,t.height/2),cleverapps.UI.fitToBox(s,i.icon),t.addChild(s),n.push(t)}),n},generateMayContain:function(){var e=cleverapps.styles.OpenChestWindow,t=new cleverapps.Layout(
this.generateContains(),{direction:cleverapps.UI.HORIZONTAL,margin:e.containScroll.margin,padding:e.containScroll.padding}),s=new cleverapps.UI.ScrollView(t,{scrollBarEnabled:!1,direction:cleverapps.UI.HORIZONTAL});return s.setContentSize2(e.containScroll.width,t.height+2),s.scrollToDefault(),s},generateMayContainText:function(){return cleverapps.UI.generateOnlyText("messages:OpenChestWindow.suggestion",cleverapps.styles.FONTS.DARK_TEXT)},generateQuestion:function(){return cleverapps.UI.generateOnlyText("messages:OpenChestWindow.question",cleverapps.styles.FONTS.OPENCHESTWINDOW_TITLE_TEXT,{name:Messages.get("sacks"===this.unit.getResource()?"sack":"chest")})},createContent:function(){var e=cleverapps.styles.OpenChestWindow;return new cleverapps.Layout([this.generateMayContain(),this.generateMayContainText(),new UnitOnCell(this.unit,{scale:e.chest.scale,animation:!0}),this.generateQuestion()],{margin:e.margin,padding:e.padding})},createButton:function(){
var e=cleverapps.styles.OpenChestWindow.button,t=new cleverapps.UI.Button({font:cleverapps.styles.FONTS.LIGHT_BUTTON_TEXT,text:"messages:OpenChestWindow.button",width:e.width,height:e.height,onClicked:this.openChest.bind(this),button_images:cleverapps.UI.Button.Images.button_green});return t.adviceTarget=Merge.SPAWN,t}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{OPENCHESTWINDOW_TITLE_TEXT:{name:"nostroke",size:55,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.OpenChestWindow={margin:30,padding:{left:25,right:28,top:90,bottom:200},containScroll:{width:1400,margin:14,padding:{x:40,y:0}},button:{width:300,height:110},chest:{scale:1.6},prize:{background:{width:200,height:200},icon:{width:160,height:160,maxScale:1.6}}};var ChestPrizeProbWindow=Window.extend({onWindowLoaded:function(e){this.unit=e,this.prob=Chest.ListPrizeProb(e),this._super({title:"messages:Units."+e.code+".stage"+(e.stage+1)+".name",name:"ChestPrizeProbWindow",content:this.createContent(),
adjustToContent:!0,closeButton:!0,foreground:bundles.windows.frames.window_foreground_png}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},generateContains:function(){var n=[],o=cleverapps.styles.ChestPrizeProbWindow.prize;return this.prob.types.forEach(function(e){var t=new cc.Scale9Sprite(bundles.openchestwindow.frames.icon_background_light);t.setContentSize2(o.background);var s=UnitView.getUnitImage(e);s.setAnchorPoint2(),s.setPositionRound(t.width/2,t.height/2),cleverapps.UI.fitToBox(s,o.icon),t.addChild(s);var i=cleverapps.UI.generateOnlyText(e.prob+"%",cleverapps.styles.FONTS.UNIT_PROB);i.setPositionRound(o.probText),t.addChild(i),n.push(t)}),n},generateSameItemsText:function(){return cleverapps.UI.generateOnlyText("messages:ChestContainSameItems",cleverapps.styles.FONTS.SAME_ITEMS_TEXT)},generateMayContainText:function(){return cleverapps.UI.generateOnlyText("messages:ChestContainAmount",cleverapps.styles.FONTS.DARK_TEXT,{min:this.prob.minAmount,
max:this.prob.maxAmount})},generateMayContain:function(){var e=cleverapps.styles.ChestPrizeProbWindow,t=new cleverapps.Layout(this.generateContains(),{direction:cleverapps.UI.HORIZONTAL,margin:e.containScroll.margin,padding:e.containScroll.padding}),s=new cleverapps.UI.ScrollView(t,{scrollBarEnabled:!1,direction:cleverapps.UI.HORIZONTAL});return s.setContentSize2(e.containScroll.width,t.height+2),s.scrollToDefault(),s},createContent:function(){var e=cleverapps.styles.ChestPrizeProbWindow;return new cleverapps.Layout([this.generateSameItemsText(),this.generateMayContain(),this.generateMayContainText(),new UnitOnCell(this.unit,{scale:e.chest.scale,animation:!0})],{margin:e.margin,padding:e.padding})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{SAME_ITEMS_TEXT:{size:23,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.ChestPrizeProbWindow={margin:30,prize:{background:{width:200,height:200},icon:{width:160,height:160,maxScale:1.6},probText:{x:{align:"right",dx:-10
},y:{align:"bottom"}}},padding:{left:25,right:28,top:90,bottom:80},chest:{scale:1.6},containScroll:{width:1400,margin:14,padding:{x:40,y:0}}};var UnitsLibrary=function(e){cleverapps.EventEmitter.call(this),this.codesByType={},this.opened={},this.fresh={},e&&this.load(e),this.init()};UnitsLibrary.prototype=Object.create(cleverapps.EventEmitter.prototype),(UnitsLibrary.prototype.constructor=UnitsLibrary).prototype.load=function(e){var t=e.opened||{},s=e.fresh||{};for(var i in Object.keys(t).forEach(function(e){Families[e]||(delete t[e],delete s[e])}),s=this.listFromBit(s),t=this.listFromBit(t),s)Object.keys(s[i]).forEach(function(e){this.isHidden({code:i,stage:e})&&delete s[i][e]},this);this.opened=t,this.fresh=s},UnitsLibrary.prototype.fromBit=function(e){for(var t={},s=0;e;)e%2&&(t[s]=!0),e=Math.floor(e/2),s++;return t},UnitsLibrary.prototype.toBit=function(e){var t=0;for(var s in e)t|=1<<s;return t},UnitsLibrary.prototype.listToBit=function(e){var t={};for(var s in e){
var i=this.toBit(e[s]);0!==i&&(t[s]=i)}return t},UnitsLibrary.prototype.listFromBit=function(e){var t={};for(var s in e)"object"==typeof e[s]?t[s]=e[s]:t[s]=this.fromBit(e[s]);return t},UnitsLibrary.prototype.save=function(){return{opened:this.listToBit(this.opened),fresh:this.listToBit(this.fresh)}},UnitsLibrary.prototype.init=function(){for(var e in Families){var t=Families[e].type;this.codesByType[t]||(this.codesByType[t]=[]),this.codesByType[t].push(e),this.opened[e]||(this.opened[e]={},this.fresh[e]={}),this.fresh[e]||(this.fresh[e]={})}},UnitsLibrary.ListByCode=function(e){for(var t=[],s=0;s<Families[e].units.length;s++)Families[e].units[s].temporary||t.push({code:e,stage:s});return t},UnitsLibrary.prototype.isOpened=function(e){return this.opened[e.code][e.stage]},UnitsLibrary.prototype.isFresh=function(e){return void 0!==this.fresh[e.code][e.stage]},UnitsLibrary.prototype.storeSave=function(){Game.currentGame.storeSave()},UnitsLibrary.prototype.openUnit=function(e){
this.isOpened(e)||(this.opened[e.code][e.stage]=!0,this.isHidden(e)||(this.fresh[e.code][e.stage]=!0),this.trigger("unitAvailable",e),this.trigger("unitStatusChanged"),cleverapps.sideBar.resetByClassName(UnitsLibraryIcon),this.storeSave())},UnitsLibrary.prototype.isHidden=function(e){var t=Families[e.code],s=t.units[e.stage];return void 0===s&&console.log("UNIT",e.code,e.stage),-1!==UnitsLibrary.HIDDEN_CODES.indexOf(e.code)||s.temporary||-1!==UnitsLibrary.HIDDEN_TYPES.indexOf(t.type)},UnitsLibrary.prototype.removeFresh=function(e,t){this.fresh[e.code][e.stage]&&(delete this.fresh[e.code][e.stage],Game.currentGame.addCoins(this.calcRewardCoins(e),t,{beginScale:1}),this.trigger("unitStatusChanged"),cleverapps.sideBar.resetByClassName(UnitsLibraryIcon),this.storeSave())},UnitsLibrary.prototype.hasOpened=function(e){return 0<Object.keys(this.opened[e]).length},UnitsLibrary.prototype.hasFresh=function(e){return 0<Object.keys(this.fresh[e]).length},
UnitsLibrary.prototype.listAvailableByType=function(e){return this.codesByType[e].filter(function(e){return this.hasOpened(e)},this)},UnitsLibrary.prototype.listCodesByType=function(e){if(Array.isArray(e)){var t=[];return e.forEach(function(e){t=t.concat(this.listCodesByType(e))},this),t}return this.codesByType[e]},UnitsLibrary.prototype.getFamilyName=function(e){return Messages.get("Units."+e+".name")||e+" family"},UnitsLibrary.prototype.getUnitName=function(e){return Messages.get("Units."+e.code+".stage"+(e.stage+1)+".name")||e.code+" stage "+(e.stage+1)},UnitsLibrary.prototype.hasAnyFresh=function(e){return(e=e||Object.keys(this.fresh)).some(this.hasFresh.bind(this))},UnitsLibrary.prototype.calcRewardCoins=function(e){return Math.round(3*Math.pow(1.3,e.stage))},UnitsLibrary.prototype.getCurrentHero=function(){for(var e=this.codesByType.hero.length-1;0<=e;e--){var t=this.codesByType.hero[e];if(this.isHeroAvailable(t))return t}},UnitsLibrary.prototype.getCurrentResource=function(){
for(var e=this.codesByType.resource.length-1;0<=e;e--){var t=this.codesByType.resource[e];if(this.hasOpened(t))return t}},UnitsLibrary.prototype.getNextHero=function(){for(var e=0;e<this.codesByType.hero.length;e++){var t=this.codesByType.hero[e];if(!this.isHeroAvailable(t))return t}},UnitsLibrary.prototype.isHeroAvailable=function(e){return Game.currentGame.orders.getMaker(e)},UnitsLibrary.prototype.findFreshUnit=function(e){for(var t=0;t<e.length;++t){var s=e[t];if(s.code&&(void 0===s.stage&&this.hasFresh(s.code)||this.isFresh(s)))return s}},UnitsLibrary.prototype.findLastOpenedUnit=function(e){for(var t=e.length-1;0<=t;--t){var s=e[t];if(s.code&&this.isOpened(s))return s}},UnitsLibrary.HIDDEN_CODES=["herochest","coinsplantchest","rubiesplantchest","energyplantchest","freechest","dishes","multiCellBody","decorator","dragonmine","specialoffer"],UnitsLibrary.HIDDEN_TYPES=["generator"];var UnitsLibraryWindow=Window.extend({onWindowLoaded:function(e){this.searchUnit=e
;var t=cleverapps.styles.UnitsLibraryWindow;this.unitsLibrary=Game.currentGame.unitsLibrary,this.tabsInfo=this.createTabs(),this._super({name:"UnitsLibraryWindow",content:this.createContent(),adjustToContent:!0,noBackground:!0,closeButton:!0,regularCloseButton:!0,extraWidth:2*t.contentOffsetX,contentOffsetX:t.contentOffsetX,foreground:bundles.windows.frames.window_foreground_png,styles:cleverapps.extendStyles(cleverapps.styles.Window,t.window)}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createTabs:function(){return{0:{icon:bundles.windows.frames.tab_icon_heroes,generator:this.createTab.bind(this,0)},1:{icon:bundles.windows.frames.tab_icon_resource,generator:this.createTab.bind(this,1)},2:{icon:bundles.windows.frames.tab_icon_fruit,generator:this.createTab.bind(this,2)},3:{icon:bundles.windows.frames.tab_icon_source,generator:this.createTab.bind(this,3)},4:{icon:bundles.windows.frames.tab_icon_chest,generator:this.createTab.bind(this,4)},5:{
icon:bundles.windows.frames.tab_icon_valuable,generator:this.createTab.bind(this,5)}}},createContent:function(){var e=cleverapps.styles.UnitsLibraryWindow,t=this.content=cleverapps.UI.createScale9Sprite(bundles.windows.frames.window_bg_png,cleverapps.styles.Window.Background.scale9);t.setAnchorPoint2(),t.setContentSize2(e.width,e.height);var s,i,n=this.tabs=new Tabs(this.tabsInfo,e.tabs);for(var o in n.setAnchorPoint2(),n.setPositionRound(e.tabs),t.addChild(n),this.tabsInfo){var r=UnitsLibraryWindow.listCodesByTabId(o);!s&&this.searchUnit&&-1!==r.indexOf(this.searchUnit.code)&&(s=o),!i&&this.unitsLibrary.hasAnyFresh(r)&&(i=o)}return n.activateTab(s||i||0,{searchUnit:this.searchUnit}),this.unitsLibrary.on("unitStatusChanged",this.updateTabsAttentions.bind(this),this),this.updateTabsAttentions(),t},updateTabsAttentions:function(){for(var e in this.tabsInfo){var t=UnitsLibraryWindow.listCodesByTabId(e);this.tabs.setAttention(e,this.unitsLibrary.hasAnyFresh(t))}},createTab:function(e){
var t,s=cleverapps.styles.UnitsLibraryWindow,i={width:s.width-2*s.padding.x,height:s.height-2*s.padding.y};if(0===e)t=new HeroesTab(i);else{var n=UnitsLibraryWindow.listCodesByTabId(e);t=new UnitsTab(n,i)}return this.content.addChild(t),t}});UnitsLibraryWindow.listCodesByTabId=function(e){var t=Game.currentGame.unitsLibrary,s=[];return UnitsLibraryWindow.TabsInfo[e].types.forEach(function(e){s=s.concat(t.listCodesByType(e))}),s=cleverapps.substract(s,UnitsLibrary.HIDDEN_CODES)},UnitsLibraryWindow.TabsInfo={0:{types:["hero"]},1:{types:["resource"]},2:{types:["fruit"]},3:{types:["source"]},4:{types:["chest"]},5:{types:["valuables","custom","magicplant","energyplant","coinsplant","rubiesplant"]}},cleverapps.styles.UnitsLibraryWindow={width:2e3,height:1050,contentOffsetX:60,window:{bgOffset:{y:-30}},padding:{x:60,y:34},tabs:{x:{align:"left",dx:-118},y:{align:"top",dy:-40},height:154}};var LevelUpWindow=Window.extend({onWindowLoaded:function(){this._super({name:"LevelUpWindow",
content:this.createContent(),noBackground:!0,closeButton:!1}),cleverapps.audio.playSound(bundles.levelupwindow.urls.levelup_effect)},createContent:function(){var e=Game.currentGame.gameLevel,t=cleverapps.styles.LevelUpWindow,s=new cleverapps.Spine(bundles.levelupwindow.jsons.levelup_json);s.setPositionRound(s.width/2,s.height/2),s.setAnimationAndIdleAfter("animation","idle");var i=cleverapps.UI.generateOnlyText(Messages.get("LevelUpWindow.title"),cleverapps.styles.FONTS.LEVELUPWINDOW_TITLE_TEXT);i.setAnchorPoint2(),i.setPositionRound(s.width/2,s.height/2+t.title.dy),i.fitTo(t.title.fitTo.width,t.title.fitTo.height);var n=this.newLevel=cleverapps.UI.generateOnlyText(e.getNextLevel(),cleverapps.styles.FONTS.LEVELUPWINDOW_VALUE_TEXT);n.setAnchorPoint2(),n.setPositionRound(s.width/2,s.height/2+t.value.dy);var o=new cc.Node;o.addChild(s),o.addChild(i),o.addChild(n),cleverapps.UI.wrap(o);var r=this.rewards=new RewardsListComponent(e.levelUpPrize(),{
font:cleverapps.styles.FONTS.LEVELUPWINDOW_REWARD_TEXT,iconScale:t.rewards.scale,title:"messages:RewardsListComponent.rewardTitle",amountInRow:6,reward:{direction:cleverapps.UI.HORIZONTAL,amountPrefix:""}}),a=new cleverapps.Layout([r,o],{direction:cleverapps.UI.VERTICAL,margin:t.margin,y:t.dy});return r.setLocalZOrder(1),cleverapps.UI.onClick(a,this.close.bind(this)),i.runAction(new cc.Sequence(new cc.ScaleTo(.26,1.4),new cc.ScaleTo(.37,1))),n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.ScaleTo(.26,1.4),new cc.ScaleTo(.37,1))),r.setVisible(!1),r.runAction(new cc.Sequence(new cc.DelayTime(.36),new cc.Show,new cc.ScaleTo(.2,1.14),new cc.ScaleTo(.2,1))),a},close:function(){if(!this.closing){this.closing=!0,Game.currentGame.gameLevel.moveToNextLevel();var e=0;e=this.rewards.gameReceiveRewards(e),e+=1500,Game.currentGame.counter.setTimeout(function(){Window.prototype.close.call(this)}.bind(this),e)}},listBundles:function(){return["levelupwindow"]}})
;cleverapps.overrideFonts(cleverapps.styles.FONTS,{LEVELUPWINDOW_TITLE_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},LEVELUPWINDOW_VALUE_TEXT:{size:220,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},LEVELUPWINDOW_REWARD_TEXT:{name:"default",size:90,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.LevelUpWindow={dy:-1e3,margin:0,title:{dy:223,fitTo:{width:500,height:0}},value:{dy:-10},rewards:{scale:.8}},RewardsListComponent.prototype.gameReceiveRewards=function(i){return this.iterateRewards(function(t,e,s){t.setCascadeOpacityEnabled(!0),t.runAction(new cc.Sequence(new cc.DelayTime(i/1e3),new cc.FadeOut(.3))),0===e.indexOf("unit"
)?(t.icon.replaceParentSamePlace(cc.director.getRunningScene(),{keepScale:!0}),t.icon.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.ScaleTo((i+200)/1e3,1.7),new cc.CallFunc(function(){var e=cleverapps.arrayFill(s.amount||1).map(function(){return new Unit({code:s.code,stage:s.stage})});Game.currentGame.spawn(e,t.icon,{fromNode:!0,startScale:t.icon.adjustScaleTo(Game.currentGame.map.getView().animations),startAnchors:{anchorX:.5,anchorY:.5}})}),new cc.DelayTime(.2),new cc.RemoveSelf))):Game.currentGame.addReward(e,s,t,{delay:i,beginScale:1,withoutDelta:!0}),i+=300}.bind(this)),i},RewardWindow.prototype.beforeCloseAnimation=function(e){if(Game.currentGame&&this.reward){var t=this.rewardsList.gameReceiveRewards(300),s=this.reward;delete this.reward,new ActionPlayer([function(e){Game.currentGame.counter.setTimeout(e,t)},function(e){s.unit?(this.hideSelf(),Game.currentGame.counter.setTimeout(e,1200)):e()}.bind(this)]).play(e)}else e()},BattlePass.LEVELS=[{energy:30,task:{goal:30},
reward:{unit:{code:"treasure",stage:0,amount:1}},premiumReward:{unit:{code:"treasure",stage:0,amount:2}}},{energy:35,task:{goal:75},reward:{unit:{code:"worker",stage:2,amount:2}},premiumReward:{unit:{code:"worker",stage:4,amount:1}}},{energy:40,task:{goal:150},reward:{unit:{code:"sacks",stage:0,amount:1}},premiumReward:{unit:{code:"sacks",stage:0,amount:3}}},{energy:45,task:{goal:350},reward:{unit:{code:"treasure",stage:1,amount:1}},premiumReward:{unit:{code:"treasure",stage:2,amount:3}}},{energy:50,task:{goal:700},reward:{unit:{code:"crystal",stage:2,amount:1}},premiumReward:{unit:{code:"worker",stage:4,amount:1}}},{energy:55,task:{goal:2500},reward:{unit:{code:"treasure",stage:2,amount:1}},premiumReward:{unit:{code:"rubies",stage:4,amount:1}}},{energy:60,task:{goal:3750},reward:{unit:{code:"sacks",stage:1,amount:1}},premiumReward:{unit:{code:"sacks",stage:1,amount:3}}},{energy:65,task:{goal:5e3},reward:{unit:{code:"worker",stage:4,amount:1}},premiumReward:{unit:{code:"crystal",
stage:3,amount:1}}},{energy:70,task:{goal:8e3},reward:{unit:{code:"sacks",stage:2,amount:2}},premiumReward:{unit:{code:"sacks",stage:2,amount:2}}},{energy:75,task:{goal:12e3},reward:{unit:{code:"magicplant",stage:5,amount:2}},premiumReward:{unit:{code:"rubiesplant",stage:1,amount:1}}}];var UnitSyncer=function(){for(var e in this.syncers={},this.index={},Families)if(!UnitSyncer.DISABLED_CODES[e]){var t=this.syncers[e]=new FamilySyncer(e);CustomSyncers.extractors[t.getSyncerCode()]=this.getInfo.bind(this,e)}};UnitSyncer.prototype.reset=function(){for(var e in this.syncers)this.syncers[e].reset()},UnitSyncer.prototype.remove=function(e,t){var s=FamilySyncer.GetKey(e,t),i=this.index[s],n=this.syncers[i];n&&(n.remove(e,t),delete this.index[s])},UnitSyncer.prototype.save=function(e,t,s,i){this.remove(e,t);var n=this.syncers[s&&s.code];n&&(n.save(e,t,s,i),this.index[FamilySyncer.GetKey(e,t)]=s.code)},UnitSyncer.prototype.loadMap=function(e){cleverapps.values(this.syncers).forEach(function(e){
e.reset(!0)}),this.index={},e.forEach(function(e){this.save(e.x,e.y,e.data,!0)},this)},UnitSyncer.prototype.getInfo=function(e){return this.syncers[e].getInfo()},UnitSyncer.prototype.updateInfo=function(s){if(void 0!==s){Object.keys(this.syncers).forEach(function(e){var t=s[e]||{};this.syncers[e].updateInfo(t)},this);var t=[];cleverapps.values(this.syncers).forEach(function(e){t=t.concat(e.listUnits())},this),t=t.sort(UnitSyncer.UNITS_IMPORTANCE_ORDER),this.index={},t.forEach(function(e){var t=FamilySyncer.GetKey(e.x,e.y);this.index[t]?e.kickout=!0:this.index[t]=e.data.code},this),cleverapps.unitSaver.updateInfo(t)}},UnitSyncer.UNITS_IMPORTANCE_ORDER=function(e,t){var s=Families[e.data.code].units[e.data.stage],i=Families[t.data.code].units[t.data.stage];return s.makesorder!==i.makesorder?s.makesorder?-1:1:s.important!==i.important?s.important?-1:1:t.data.stage-e.data.stage},UnitSyncer.DISABLED_CODES=cleverapps.createSet(["multiCellBody","specialoffer","decorator"])
;var FamilySyncer=function(e,t){this.code=e,this.data={},this.syncerCode="units_"+e};FamilySyncer.prototype.getSyncerCode=function(){return this.syncerCode},FamilySyncer.prototype.addUpdateTask=function(){cleverapps.synchronizer.addUpdateTask(this.syncerCode)},FamilySyncer.prototype.remove=function(e,t){var s=FamilySyncer.GetKey(e,t);this.data[s]&&(delete this.data[s],this.addUpdateTask())},FamilySyncer.prototype.save=function(e,t,s,i){var n=FamilySyncer.GetKey(e,t),o=this.encode(s);this.data[n]=o,!0!==i&&this.addUpdateTask()},FamilySyncer.prototype.reset=function(e){this.data={},!0!==e&&this.addUpdateTask()},FamilySyncer.GetKey=function(e,t){return e+"_"+t},FamilySyncer.ParseKey=function(e){var t=e.split("_");return{x:parseInt(t[0]),y:parseInt(t[1])}},FamilySyncer.prototype.encode=function(e){var t=cleverapps.clone(e,!0);return delete t.code,t},FamilySyncer.prototype.decode=function(e){var t=cleverapps.clone(e,!0);return t.code=this.code,t},FamilySyncer.prototype.getInfo=function(){
return this.data},FamilySyncer.prototype.updateInfo=function(e){this.data=e},FamilySyncer.prototype.listUnits=function(){return Object.keys(this.data).map(function(e){var t=FamilySyncer.ParseKey(e);return t.data=this.decode(this.data[e]),t},this).filter(function(e){return Families[e.data.code].units[e.data.stage]})};var GuideWindow=Window.extend({onWindowLoaded:function(e,t){this._super({title:this.getWindowTitle(e),name:t.name,content:this.createContent(e),adjustToContent:!0,closeButton:!0}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getWindowTitle:function(e){return Game.currentGame.unitsLibrary.getUnitName(e)},getStageSize:function(){var e=cleverapps.styles.GuideWindow.stages;return cc.size(e.width,e.height)},getUpperArrowStyle:function(){return cleverapps.styles.GuideWindow.upperArrow},getLowerArrowStyle:function(){return cleverapps.styles.GuideWindow.lowerArrow},createContent:function(e){var t=cleverapps.styles.GuideWindow,s=new cleverapps.Layout([
this.createFirstStage(e),this.createArrow(bundles.guidewindow.frames.upper_arrow,this.getUpperArrowStyle()),this.createSecondStage(e),this.createArrow(bundles.guidewindow.frames.lower_arrow,this.getLowerArrowStyle()),this.createThirdStage(e)],{direction:cleverapps.UI.HORIZONTAL,margin:t.margin,padding:t.padding});return s.setAnchorPoint2(),s},createArrow:function(e,t){var s=new cc.Node;return s.setAnchorPoint2(),s.setContentSize2(0,0),s.setLocalZOrder(10),this.addSprite(s,e,t),s},createStageBackgroundWithText:function(e,t){var s=cleverapps.styles.GuideWindow.stages,i=cleverapps.UI.createScale9Sprite(bundles.guidewindow.frames.stage_background,cleverapps.UI.Scale9Rect.TwoPixelXY);return i.setAnchorPoint2(),i.setContentSize2(this.getStageSize()),(e=cleverapps.UI.generateOnlyText(e,cleverapps.styles.FONTS.GUIDE_WINDOW_INDEX_TEXT)).setAnchorPoint2(.5,0),e.setPositionRound(s.index.x,s.index.y),i.addChild(e),(t=cleverapps.UI.generateOnlyText(t,
cleverapps.styles.FONTS.GUIDE_WINDOW_DESCRIPTION_TEXT)).setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(s.description.width,0),t.fitTo(s.description.width,s.description.height),t.setAnchorPoint2(.5,1),t.setPositionRound(s.description.x,s.description.y),i.addChild(t),i},addContainer:function(e,t){var s=new cc.Node;return s.setAnchorPoint2(),s.setPositionRound(t.x,t.y),e.addChild(s),s},addUnitIcon:function(e,t,s,i){var n=UnitView.getUnitImage({code:t,stage:s});return n.setAnchorPoint2(),n.setPositionRound(i.x,i.y),i.scale&&n.setScale(i.scale),e.addChild(n),n},addSprite:function(e,t,s){var i=new cc.Sprite(t);return i.setAnchorPoint2(),i.setPositionRound(s.x,s.y),s.scale&&i.setScale(s.scale),e.addChild(i),i},createFirstStage:function(e){return new cc.Node},createSecondStage:function(e){return new cc.Node},createThirdStage:function(e){return new cc.Node},listBundles:function(){return["guidewindow"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{
GUIDE_WINDOW_INDEX_TEXT:{size:70,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},GUIDE_WINDOW_DESCRIPTION_TEXT:{size:35,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR,lineHeight:40}}),cleverapps.styles.GuideWindow={margin:15,padding:{x:60,top:90,bottom:60},stages:{width:400,height:800,index:{x:{align:"center"},y:150},description:{width:320,height:156,x:{align:"center"},y:160}},upperArrow:{x:{align:"center"},y:{align:"center",dy:180}},lowerArrow:{x:{align:"center"},y:{align:"center",dy:-120}}};var CastleGuideWindow=GuideWindow.extend({onWindowLoaded:function(e){this._super(e,{name:"CastleGuideWindow"})},createFirstStage:function(t){var e=cleverapps.styles.CastleGuideWindow.firstStage,s=this.createStageBackgroundWithText(1,Messages.get("CastleGuideWindow.firstStage")),i=this.addContainer(s,e.container);return this.addSprite(i,bundles.guidewindow.frames.blue_light,e.light),this.addUnitIcon(i,t.code,t.stage-2,e.result),this.addSprite(i,bundles.guidewindow.frames.blue_light_foreground,
e.foreground),this.addSprite(i,bundles.guidewindow.frames.blue_light_tears,e.tears),e.components.forEach(function(e){this.addUnitIcon(i,t.code,t.stage-3,e)},this),s},createSecondStage:function(t){var e=cleverapps.styles.CastleGuideWindow.secondStage,s=this.createStageBackgroundWithText(2,Messages.get("CastleGuideWindow.secondStage")),i=this.addContainer(s,e.container);this.addUnitIcon(i,t.code,t.stage-1,e.castle);var n=this.addSprite(i,bundles.guidewindow.frames.progress,e.progress);return this.addUnitIcon(n,t.code,t.stage,e.icon),this.addSprite(i,bundles.guidewindow.frames.white_arrows,e.arrows),e.components.forEach(function(e){this.addUnitIcon(i,t.code,t.stage-2,e)},this),s},createThirdStage:function(e){var t=cleverapps.styles.CastleGuideWindow.thirdStage,s=this.createStageBackgroundWithText(3,Messages.get("CastleGuideWindow.thirdStage")),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.yellow_light,t.light),this.addUnitIcon(i,e.code,e.stage,
t.castle),this.addSprite(i,bundles.guidewindow.frames.crystals,t.crystals),s}});cleverapps.styles.CastleGuideWindow={firstStage:{container:{x:{align:"center"},y:{align:"center",dy:180}},result:{x:0,y:0},light:{x:0,y:0},foreground:{x:0,y:0},tears:{x:0,y:-279},components:[{x:-107,y:-166,scale:.9},{x:-4,y:-236,scale:.9},{x:105,y:-166,scale:.9}]},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:60}},castle:{x:0,y:0,scale:.9},progress:{x:0,y:-125},icon:{x:{align:"left",dx:10},y:{align:"center",dy:-2},scale:.3},arrows:{x:-10,y:125},components:[{x:-94,y:218,scale:.7},{x:96,y:200,scale:.8}]},thirdStage:{container:{x:{align:"center"},y:{align:"center",dy:60}},castle:{x:0,y:0,scale:1.1},light:{x:0,y:50},crystals:{x:0,y:50}}};var GeneratorGuideWindow=GuideWindow.extend({onWindowLoaded:function(e){this._super(e,{name:"CastleWindow"})},createFirstStage:function(e){var t=cleverapps.styles.GeneratorGuideWindow.firstStage,s=this.createStageBackgroundWithText(1,Messages.get(
"GeneratorGuideWindow.firstStage")),i=this.addContainer(s,t.container);this.addSprite(i,bundles.guidewindow.frames.yellow_light,t.light),this.addUnitIcon(i,e.code,e.stage,t.generator);var n=new cleverapps.Layout([new cc.Sprite(bundles.merge.frames.generator_star_on),new cc.Sprite(bundles.merge.frames.generator_star_on),new cc.Sprite(bundles.merge.frames.generator_star_on)],{direction:cleverapps.UI.HORIZONTAL,margin:t.stars.margin});return n.setPositionRound(t.stars),i.addChild(n),s},createSecondStage:function(e){var t=cleverapps.styles.GeneratorGuideWindow.secondStage,s=e.code.replace("generator","source"),i=this.createStageBackgroundWithText(2,Messages.get("GeneratorGuideWindow.secondStage")),n=this.addContainer(i,t.container);return this.addSprite(n,bundles.guidewindow.frames.blue_light,t.light),t.units.forEach(function(e){this.addUnitIcon(n,s,e.stage,e)},this),i},createThirdStage:function(e){var t=cleverapps.styles.GeneratorGuideWindow.thirdStage,s=e.code.replace("generator",
"source"),i=this.createStageBackgroundWithText(3,Messages.get("GeneratorGuideWindow.thirdStage")),n=this.addContainer(i,t.container);return t.components.forEach(function(e){this.addUnitIcon(n,s,2,e)},this),this.addUnitIcon(n,s,3,t.result),this.addSprite(n,bundles.guidewindow.frames.white_plus,t.plus),this.addSprite(n,bundles.guidewindow.frames.white_arrow_up,t.arrow),i}});cleverapps.styles.GeneratorGuideWindow={firstStage:{container:{x:{align:"center"},y:{align:"center",dy:100}},light:{x:0,y:0},generator:{x:0,y:0,scale:1.2},stars:{x:0,y:-30,margin:10}},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:80}},light:{x:0,y:0,scale:.7},units:[{x:-13,y:64,scale:1,stage:0},{x:52,y:2,scale:1.15,stage:2},{x:-41,y:-25,scale:1.3,stage:4}]},thirdStage:{container:{x:{align:"center"},y:{align:"center",dy:210}},result:{x:70,y:25,scale:1.3},plus:{x:-6,y:-181},arrow:{x:-7,y:-45},components:[{x:-44,y:-255,scale:1.15},{x:74,y:-177,scale:1.15},{x:-68,y:-125,scale:1.15}]}}
;var CrystalGuideWindow=GuideWindow.extend({onWindowLoaded:function(e){this._super(e,{name:"CrystalGuideWindow"})},createFirstStage:function(t){var e=cleverapps.styles.CrystalGuideWindow.firstStage,s=t.getFamily().units.length-1,i=this.createStageBackgroundWithText(1,Messages.get("CrystalGuideWindow.firstStage")),n=this.addContainer(i,e.container);return this.addUnitIcon(n,t.code,s-1,e.unit),this.addSprite(n,bundles.guidewindow.frames.three_white_arrows,e.arrows),e.components.forEach(function(e){this.addUnitIcon(n,t.code,s-2,e)},this),i},createSecondStage:function(e){var t=cleverapps.styles.CrystalGuideWindow.secondStage,s=e.getFamily().units.length-1,i=this.createStageBackgroundWithText(2,Messages.get("CrystalGuideWindow.secondStage")),n=this.addContainer(i,t.container);return this.addSprite(n,bundles.guidewindow.frames.blue_light,t.background),this.addUnitIcon(n,e.code,s,t.unit),this.addSprite(n,bundles.guidewindow.frames.blue_light_foreground,t.foreground),i},
createThirdStage:function(e){var i=cleverapps.styles.CrystalGuideWindow.thirdStage,t=e.getFamily().units.length-1,s=this.createStageBackgroundWithText(3,Messages.get("CrystalGuideWindow.thirdStage")),n=this.addContainer(s,i.container);return[{code:"coins",stage:3},{code:"coins",stage:2},{code:"coins",stage:2},{code:e.code,stage:t}].forEach(function(e,t){if(i.icons[t]){var s=this.addSprite(n,bundles.guidewindow.frames.tile_light,i.icons[t]);this.addUnitIcon(s,e.code,e.stage,i.units)}},this),this.addSprite(n,bundles.guidewindow.frames.white_plus,i.plus),this.addSprite(n,bundles.guidewindow.frames.white_arrow_up,i.arrow),s}});cleverapps.styles.CrystalGuideWindow={firstStage:{container:{x:{align:"center"},y:{align:"center",dy:180}},unit:{x:0,y:0,scale:1.4},arrows:{x:-10,y:-129},components:[{x:-107,y:-166,scale:1.2},{x:-4,y:-224,scale:1.2},{x:105,y:-166,scale:1.2}]},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:90}},unit:{x:0,y:0,scale:1.8},background:{x:0,y:0,scale:.9},
foreground:{x:0,y:0}},thirdStage:{container:{x:{align:"center"},y:{align:"center",dy:210}},units:{x:{align:"center",dx:5},y:{align:"bottom",dy:25}},icons:[{x:80,y:15,scale:1.3},{x:-52,y:-102,scale:1.3},{x:79,y:-181,scale:1.3},{x:-49,y:-260,scale:1.3}],plus:{x:9,y:-136},arrow:{x:0,y:-25}}};var InstantWorkerGuideWindow=GuideWindow.extend({onWindowLoaded:function(e){this._super(e,{name:"InstantWorkerGuideWindow"})},createFirstStage:function(t){var e=cleverapps.styles.InstantWorkerGuideWindow.firstStage,s=this.createStageBackgroundWithText(1,Messages.get("InstantWorkerGuideWindow.firstStage")),i=this.addContainer(s,e.container);return this.addUnitIcon(i,t.code,t.stage-1,e.unit),this.addSprite(i,bundles.guidewindow.frames.three_white_arrows,e.arrows),e.components.forEach(function(e){this.addUnitIcon(i,t.code,t.stage-2,e)},this),s},createSecondStage:function(e){var t=cleverapps.styles.InstantWorkerGuideWindow.secondStage,s=this.createStageBackgroundWithText(2,Messages.get(
"InstantWorkerGuideWindow.secondStage")),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.blue_light,t.background),this.addUnitIcon(i,e.code,e.stage,t.unit),this.addSprite(i,bundles.guidewindow.frames.blue_light_foreground,t.foreground),s},createThirdStage:function(e){var t=cleverapps.styles.InstantWorkerGuideWindow.thirdStage,s=this.createStageBackgroundWithText(3,Messages.get("InstantWorkerGuideWindow.thirdStage")),i=this.addContainer(s,t.container),n=this.addSprite(i,bundles.guidewindow.frames.guide_rays,t.rays);this.addUnitIcon(n,e.code,e.stage,t.unit);var o=this.addUnitIcon(i,"wood",3,t.building);return this.addSprite(o,bundles.guidewindow.frames.guide_attention,t.attention),this.addSprite(i,bundles.guidewindow.frames.white_arrow_up,t.arrow),this.addSprite(i,bundles.finger.frames.tutorial_hand_png,t.hand),s}});cleverapps.styles.InstantWorkerGuideWindow={firstStage:{container:{x:{align:"center",dx:25},y:{align:"center",dy:180}},unit:{x:0,y:0,
scale:1.4},arrows:{x:-22,y:-112},components:[{x:-129,y:-140,scale:1.2},{x:-32,y:-214,scale:1.2},{x:78,y:-147,scale:1.2}]},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:50}},unit:{x:0,y:0,scale:1.6},background:{x:0,y:0,scale:.8},foreground:{x:-2,y:19}},thirdStage:{container:{x:{align:"center",dx:-50},y:{align:"center",dy:90}},rays:{x:0,y:0},unit:{x:{align:"center"},y:{align:"center"},scale:1.6},building:{x:145,y:83,scale:1.4},attention:{x:{align:"center"},y:{align:"center"},scale:.7},hand:{x:70,y:-100,scale:.7},arrow:{x:65,y:45}}};var FeastMissionRulesWindow=GuideWindow.extend({onWindowLoaded:function(e){this._super(e,{name:"FeastMissionRulesWindow"})},getWindowTitle:function(e){return"messages:FeastMissionRulesWindow."+e.name+".title"},getStageSize:function(){var e=cleverapps.styles.FeastMissionRulesWindow.stages;return cc.size(e.width,e.height)},createContent:function(e){var t=cleverapps.styles.FeastMissionRulesWindow,s=new cleverapps.Layout([this.createFirstStage(e)
,this.createArrow(bundles.guidewindow.frames.upper_arrow,t.upperArrow),this.createSecondStage(e),this.createArrow(bundles.guidewindow.frames.lower_arrow,t.lowerArrow),this.createThirdStage(e)],{direction:cleverapps.UI.HORIZONTAL,margin:t.stages.margin});s.setAnchorPoint2();var i=cleverapps.UI.generateOnlyText("messages:FeastMissionRulesWindow."+e.name+".description",cleverapps.styles.FONTS.GUIDE_WINDOW_DESCRIPTION_TEXT);i.setAnchorPoint2(),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.setDimensions(s.width,0);var n=new cleverapps.Layout([s,i],{direction:cleverapps.UI.VERTICAL,margin:t.margin,padding:t.padding});return n.setAnchorPoint2(),n},createFirstStage:function(e){var t=cleverapps.styles.FeastMissionRulesWindow.firstStage,s=this.createStageBackgroundWithText(1,"messages:FeastMissionRulesWindow."+e.name+".firstStage"),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.blue_light,t.light),e.type===Mission.TYPE_COINS_FEAST?this.addSprite(i,
bundles.guidewindow.frames.coins,t.energies):this.addSprite(i,bundles.guidewindow.frames.energies,t.energies),s},createSecondStage:function(e){var t=cleverapps.styles.FeastMissionRulesWindow.secondStage,s=this.createStageBackgroundWithText(2,"messages:FeastMissionRulesWindow."+e.name+".secondStage"),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.rating,t.rating),s},createThirdStage:function(e){var t=cleverapps.styles.FeastMissionRulesWindow.thirdStage,s=this.createStageBackgroundWithText(3,"messages:FeastMissionRulesWindow."+e.name+".thirdStage"),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.yellow_light,t.light),this.addSprite(i,bundles.guidewindow.frames.treasure,t.present),s}});cleverapps.styles.FeastMissionRulesWindow={margin:30,padding:{x:60,top:100,bottom:70},stages:{width:400,height:700,margin:15},upperArrow:{x:{align:"center"},y:{align:"center",dy:200}},lowerArrow:{x:{align:"center"},y:{
align:"center",dy:-100}},firstStage:{container:{x:{align:"center"},y:{align:"center",dy:90}},light:{x:0,y:0,scale:.9},energies:{x:0,y:0}},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:60}},rating:{x:0,y:0,scale:.9}},thirdStage:{container:{x:{align:"center"},y:{align:"center",dy:90}},light:{x:0,y:0,scale:.9},present:{x:10,y:-5,scale:2}}};BattlePassRulesWindow=GuideWindow.extend({onWindowLoaded:function(){this._super(null,{name:"BattlePassRulesWindow"})},getWindowTitle:function(e){return"messages:BattlePassRulesWindow.title"},createFirstStage:function(e){var t=cleverapps.styles.BattlePassRulesWindow.firstStage,s=this.createStageBackgroundWithText(1,"messages:BattlePassRulesWindow.firstStage"),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.blue_light,t.light),this.addSprite(i,bundles.guidewindow.frames.worker_with_building,t.unit),s},createSecondStage:function(e){var t=cleverapps.styles.BattlePassRulesWindow.secondStage,
s=this.createStageBackgroundWithText(2,"messages:BattlePassRulesWindow.secondStage"),i=this.addContainer(s,t.container);this.addSprite(i,bundles.merge.frames.stand_ground,t.ground),this.addSprite(i,bundles.guidewindow.frames.guide_rays,t.light),this.addUnitIcon(i,"wood",6,t.unit);var n=new cleverapps.Spine(bundles.merge.jsons.battle_star,t.star.scale);return n.setAnchorPoint2(),n.setPositionRound(t.star),n.setAnimation(0,"idle",!0),i.addChild(n),n.runAction(new cc.RepeatForever(new cc.Sequence(new cc.CallFunc(function(){var e=new FingerView;e.setPositionRound(n.width/2,n.height/2),n.addChild(e),e.standardLoop({runOnce:!0})}),new cc.DelayTime(2.5)))),s},createThirdStage:function(e){var t=cleverapps.styles.BattlePassRulesWindow.thirdStage,s=this.createStageBackgroundWithText(3,"messages:BattlePassRulesWindow.thirdStage"),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.yellow_light,t.light),this.addSprite(i,bundles.merge.frames.stand_ground,t.ground),
this.addSprite(i,bundles.guidewindow.frames.prizes_heap,t.prizes),s}});cleverapps.styles.BattlePassRulesWindow={firstStage:{container:{x:{align:"center"},y:{align:"center",dy:90}},light:{x:0,y:0,scale:1.2},unit:{x:0,y:0,scale:.8}},secondStage:{container:{x:{align:"center"},y:{align:"center",dy:60}},ground:{x:0,y:-40},light:{x:0,y:10},unit:{x:-5,y:30,scale:1.5},star:{x:-15,y:155,scale:1.5}},thirdStage:{container:{x:{align:"center"},y:{align:"center",dy:60}},light:{x:0,y:0},ground:{x:0,y:-40},prizes:{x:0,y:0,scale:.7}}};var UnitsShop=function(e){this.stored=e,this.inited=!1};UnitsShop.prototype.save=function(){return this.inited?{refreshTime:this.refreshTime,buyed:this.buyed}:this.stored},UnitsShop.prototype.init=function(){this.inited||(this.inited=!0,this.stored?(this.refreshTime=this.stored.refreshTime,this.buyed=this.stored.buyed,this.runRefreshTimeout()):this.refreshProducts())},UnitsShop.prototype.clear=function(){this.refreshTimeout&&clearTimeout(this.refreshTimeout)},
UnitsShop.prototype.getLeftTime=function(){return this.refreshTime+cleverapps.parseInterval(UnitsShop.PRODUCTS_TIMEOUT)-Date.now()},UnitsShop.prototype.processCartUnits=function(e){this.cartUnits&&this.cartUnits.length&&(this.cartUnits.forEach(function(e){Game.currentGame.onUnitAvailable(e)},this),Game.currentGame.spawnAction(this.cartUnits,e,{fromNode:!0,startScale:1/Game.currentGame.getScrollZoom()}),this.cartUnits=void 0)},UnitsShop.prototype.getCartAmount=function(){return this.cartUnits?this.cartUnits.length:0},UnitsShop.prototype.buy=function(e,t){for(this.buyed||(this.buyed=[]),this.buyed.push({code:e.code,stage:e.stage,amount:t}),Game.currentGame.storeSave(),"freechest"===e.code&&(cleverapps.sideBar.resetByClassName(UnitsShopIcon),cleverapps.localPushes.sendPush(cleverapps.LocalPushes.TYPES.FREE_CHEST,this.getLeftTime())),this.cartUnits||(this.cartUnits=[]),i=0;i<t;i++){var s=new Unit(e),n=Game.currentGame.map.getScreenCenterCell(),o=Game.currentGame.map.findEmptySlot(n.x,n.y,s
);o&&(s.setPosition(o.x,o.y),Game.currentGame.map.add(Map2d.LAYER_UNITS,o.x,o.y,s),this.cartUnits.push(s))}},UnitsShop.prototype.runRefreshTimeout=function(){0<this.getLeftTime()?(this.clear(),this.refreshTimeout=new cleverapps.LongTimeout(this.refreshProducts.bind(this),this.getLeftTime())):this.refreshProducts()},UnitsShop.prototype.canTakeFreeChest=function(){return this.init(),!this.buyed||0===this.buyed.filter(function(e){return"freechest"===e.code}).length},UnitsShop.prototype.generateProducts=function(){var i=cleverapps.clone(UnitsShop.DEFAULT_PRODUCTS,!0),n=Game.currentGame.unitsLibrary.listAvailableByType("fruit");UnitsShop.FRUIT_TEMPLATE.forEach(function(e){for(var t=0;t<n.length;t++){var s=cleverapps.clone(e,!0);s.unit.code=n[t],i.push(s)}});var s=Game.currentGame.unitsLibrary.getCurrentResource();if(s){UnitsShop.RESOURCE_CHESTS_TEMPLATE.forEach(function(e){var t=cleverapps.clone(e,!0);t.unit.code=s+"chest",i.push(t)});for(
var e=UnitsShop.RESOURCE_DATA[s]||UnitsShop.RESOURCE_DATA.default,t=0,o=e.basicPrice;t<e.stages;t++,o*=3){var r=cleverapps.clone(UnitsShop.RESOURCE_TEMPLATE,!0);r.unit={stage:t,code:s},r.price=o,r.energyTime=r.energyTime[t]||0,i.push(r)}}var a=Game.currentGame.unitsLibrary.getNextHero();return a&&"dwarf"!==a&&UnitsShop.HERO_ITEMS_TEMPLATE.forEach(function(e){var t=cleverapps.clone(e,!0);t.unit.code=a,i.unshift(t)}),this.buyed&&this.buyed.forEach(function(e){for(var t=0;t<i.length;t++)if(0<i[t].left&&i[t].unit.code===e.code&&i[t].unit.stage===e.stage&&i[t].amount===e.amount){i[t].left--;break}}),i},UnitsShop.prototype.buyedSomething=function(){return this.buyed&&this.buyed.length},UnitsShop.prototype.buyRefresh=function(){return!(!this.buyedSomething()||!cleverapps.user.takeGold(UnitsShop.REFRESH_PRICE))&&(cleverapps.eventLogger.logEvent("refresh_unit_shop_ruby",{amount:UnitsShop.REFRESH_PRICE}),this.refreshProducts(),!0)},UnitsShop.prototype.refreshProducts=function(){
this.refreshTime=Date.now(),this.buyed=void 0,this.runRefreshTimeout(),Game.currentGame.storeSave(),cleverapps.localPushes.cancelPush(cleverapps.LocalPushes.TYPES.FREE_CHEST),cleverapps.sideBar.resetByClassName(UnitsShopIcon)},UnitsShop.PRODUCTS_TIMEOUT="6 hours",UnitsShop.COIN_PRICE=0,UnitsShop.RUBY_PRICE=1,UnitsShop.FRUIT_TAB=0,UnitsShop.RESOURCE_TAB=1,UnitsShop.OTHER_TAB=2,UnitsShop.REFRESH_PRICE=99;var UnitsShopWindow=Window.extend({onWindowLoaded:function(e){var t=cleverapps.styles.UnitsShopWindow;e=e||{},Game.currentGame.unitsShop.init(),this.products=Game.currentGame.unitsShop.generateProducts(),this.tabsInfo=this.createTabs(),this._super({name:"UnitsShop",content:this.createContent(e),adjustToContent:!0,noBackground:!0,closeButton:!0,regularCloseButton:!0,extraWidth:2*t.contentOffsetX,contentOffsetX:t.contentOffsetX,foreground:bundles.windows.frames.window_foreground_png}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},getTabProducts:function(t){
return this.products.filter(function(e){return e.tab===t})},generateTab:function(e){var t=cleverapps.styles.UnitsShopWindow.tab,s=this.getTabProducts(e).map(function(e){var t=new UnitsShopTileModel(e);return new UnitsShopTile(t,{cart:this.cart,onClicked:function(){t.buy(),this.updateTabsAttention(),Game.currentGame.unitsShop.buyedSomething()&&(this.refreshButton.enable(),this.refreshButton.buttonContent.setOpacity(255))}.bind(this)})}.bind(this)),i=new cleverapps.Layout(s,{direction:cleverapps.UI.HORIZONTAL,margin:t.tiles.margin,padding:t.tiles.padding}),n=new cleverapps.UI.ScrollView(i,{scrollBarEnabled:!1,touchPadding:t.tiles.touchPadding,direction:cleverapps.UI.HORIZONTAL});return n.setContentSize2(t.tiles.width,i.height+2),n.scrollToDefault(),n.setPositionRound(t),n.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(function(){for(var e=0;e<s.length;e++){var t=s[e];if(t.attention){n.scrollTo(s[e],1.5,{callback:function(){t.addAttentionFinger()}.bind(this)});break}}
}.bind(this)))),n},createTabs:function(){var e=function(e){var t=this.generateTab(e);return this.content.addChild(t),t},t={};return t[UnitsShop.FRUIT_TAB]={icon:bundles.windows.frames.tab_icon_ingredients,generator:e.bind(this,UnitsShop.FRUIT_TAB)},t[UnitsShop.RESOURCE_TAB]={icon:bundles.windows.frames.tab_icon_resource,generator:e.bind(this,UnitsShop.RESOURCE_TAB)},t[UnitsShop.OTHER_TAB]={icon:bundles.windows.frames.tab_icon_specials,generator:e.bind(this,UnitsShop.OTHER_TAB)},t},createBottomLine:function(e){var t=cleverapps.styles.UnitsShopWindow.bottomLine,s=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.title_png);s.setContentSize2(t),s.setPositionRound(t);var i=cleverapps.UI.generateOnlyText("messages:UnitsShop.newItemsWillAppear",cleverapps.styles.FONTS.UNITSSHOP_APPEAR_IN);i.setPositionRound(t.appearInText),i.fitTo(t.appearInText.maxWidth),s.addChild(i);var n=new cc.Sprite(bundles.mergeui.frames.timer_icon_large);n.setPositionRound(t.timerIcon),n.setScale(
t.timerIcon.scale),s.addChild(n);var o=new cleverapps.CountDown(Game.currentGame.unitsShop.getLeftTime()),r=new cleverapps.CountDownView(o,{font:cleverapps.styles.FONTS.UNITSSHOP_TIMER});r.setAnchorPoint2(0,.5),r.setPositionRound(t.timer),s.addChild(r);var a=cleverapps.UI.generateOnlyText("messages:UnitsShop.reset",cleverapps.styles.FONTS.UNITSSHOP_BUTTON_TEXT),c=new cc.Sprite(bundles.reward_icons.frames.gold_small_png),l=cleverapps.UI.generateImageText(UnitsShop.REFRESH_PRICE,cleverapps.styles.FONTS.UNITSSHOP_BUTTON_PRICE),p=new cleverapps.Layout([a,c,l],{direction:cleverapps.UI.HORIZONTAL,margin:t.button.margin});p.setCascadeOpacityEnabled(!0),a.y+=t.button.textOffsetY,l.y+=t.button.priceOffsetY;var d=this.refreshButton=new cleverapps.UI.Button({content:p,width:t.button.width,height:t.button.height,padding:t.button.padding,onClicked:function(){Game.currentGame.unitsShop.buyRefresh()&&(this.cart.removeFromParent(!1),new UnitsShopWindow({activeTab:this.tabs.getActive(),cart:this.cart})
,this.onClose=function(){},this.close())}.bind(this)});return d.buttonContent=p,Game.currentGame.unitsShop.buyedSomething()||(d.disable(),p.setOpacity(150)),d.setPositionRound(t.button),s.addChild(d),this.cart=e||new UnitsShopCart,s.addChild(this.cart),s},onClose:function(){this.cart.processItems()},getAttentionTabs:function(){var e=[];return Game.currentGame.unitsShop.canTakeFreeChest()&&e.push(UnitsShop.OTHER_TAB),e},updateTabsAttention:function(){var s=this.getAttentionTabs();this.tabs.listIds().forEach(function(e){var t=-1!==s.indexOf(cleverapps.castType(e));this.tabs.setAttention(e,t)},this)},createContent:function(e){var t=cleverapps.styles.UnitsShopWindow,s=this.content=cleverapps.UI.createScale9Sprite(bundles.windows.frames.window_bg_png,cleverapps.styles.Window.Background.scale9);s.setAnchorPoint2(),s.setContentSize2(t.width,t.height),s.addChild(this.createBottomLine(e.cart));var i=this.tabs=new Tabs(this.tabsInfo,t.tabs);i.setAnchorPoint2(0,0),i.setPositionRound(t.tabs),
s.addChild(i);var n=e.activeTab||0;if(!e.activeTab){var o=this.getAttentionTabs();0<o.length&&(n=o[0])}return i.activateTab(n),this.updateTabsAttention(),s}});UnitsShopWindow.prototype.listBundles=function(){return["units_shop"]},cleverapps.overrideFonts(cleverapps.styles.FONTS,{UNITSSHOP_BUTTON_TEXT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},UNITSSHOP_BUTTON_PRICE:{name:"default",size:48},UNITSSHOP_APPEAR_IN:{size:48,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},UNITSSHOP_TIMER:{name:"default",size:56}}),cleverapps.styles.UnitsShopWindow={width:2e3,height:1050,contentOffsetX:60,tabs:{x:{align:"left",dx:-118},y:{align:"top",dy:-40}},bottomLine:{width:1960,height:90,x:{align:"center"},y:{align:"bottom",dy:105},timerIcon:{x:{align:"left",dx:1136},y:{
align:"center",dy:-2},scale:.6},timer:{x:{align:"left",dx:1224},y:{align:"center",dy:0}},appearInText:{x:{align:"right",dx:-842},y:{align:"center",dy:-5},maxWidth:800},button:{x:{align:"right",dx:-80},y:{align:"center"},width:360,height:110,textOffsetY:-2,priceOffsetY:5,margin:8,padding:{left:10,right:10,top:10,bottom:15}}},tab:{x:{align:"center"},y:{align:"top",dy:-70},tiles:{margin:40,width:1950,padding:{x:50,bottom:140},touchPadding:{bottom:140}}}};var UnitsShopCart=cc.Node.extend({ctor:function(){this._super();var e=cleverapps.styles.UnitsShopCart;this.amount=Game.currentGame.unitsShop.getCartAmount(),this.setAnchorPoint2(),this.setPositionRound(e),this.setContentSize2(e),this.icon=new cc.Node,this.icon.setAnchorPoint2(),this.icon.setContentSize2(e),this.icon.setCascadeOpacityEnabled(!0),this.icon.setPositionRound(this.width/2,this.height/2),this.addChild(this.icon);var t=new cc.Sprite(bundles.units_shop.frames.cart_bottom_png);t.setPositionRound(e.bottomIcon),this.icon.addChild(t)
;var s=new cc.Sprite(bundles.units_shop.frames.cart_top_png);s.setPositionRound(e.topIcon),s.setLocalZOrder(2),this.icon.addChild(s),this.amountBlock=new cc.Sprite(bundles.merge.frames.upgradable_level_png),this.amountBlock.setPositionRound(e.amountBlock),this.amountText=cleverapps.UI.generateImageText("",cleverapps.styles.FONTS.UNITSSHOP_CART_AMOUNT),this.amountText.setPositionRound(e.amountBlock.amountText),this.amountBlock.addChild(this.amountText),this.addChild(this.amountBlock),this.firstItem=this.target=new cc.Node,this.firstItem.setPositionRound(e.item.firstItem.oneItem),this.firstItem.setLocalZOrder(1),this.icon.addChild(this.firstItem),this.secondItem=new cc.Node,this.secondItem.setPositionRound(e.item.secondItem),this.icon.addChild(this.secondItem),this.updateCartAmount()},incAmount:function(e){this.amount++,this.updateCartAmount(),this.firstItem.children.length&&(this.secondItem.removeAllChildren(),this.firstItem.children[0].replaceParent(this.secondItem),
this.firstItem.removeAllChildren(),this.firstItem.setPositionRound(cleverapps.styles.UnitsShopCart.item.firstItem.twoItems)),e.setScale(cleverapps.styles.UnitsShopCart.item.scale),e.replaceParent(this.firstItem)},updateCartAmount:function(){this.amountBlock&&(this.amountText.setString(this.amount),this.amountText.fitTo(cleverapps.styles.UnitsShopCart.amountBlock.amountText.maxWidth))},processItems:function(){if(Game.currentGame.unitsShop.cartUnits&&Game.currentGame.unitsShop.cartUnits.length){this.replaceParentSamePlace(Game.currentGame.map.getView().animations),this.setScale(1/Game.currentGame.getScrollZoom()),this.amountBlock.removeFromParent(),this.amountBlock=void 0,this.runAction(new cc.Sequence(new cc.MoveBy(.5,{x:cleverapps.styles.UnitsShopCart.moveDelta.x/Game.currentGame.getScrollZoom(),y:cleverapps.styles.UnitsShopCart.moveDelta.y/Game.currentGame.getScrollZoom()}),new cc.CallFunc(function(){this.setLocalZOrder(-1),Game.currentGame.unitsShop.processCartUnits(this),e.stop()
}.bind(this)),new cc.DelayTime(.2),new cc.CallFunc(function(){this.firstItem.removeFromParent(),this.secondItem.removeFromParent()}.bind(this)))),this.icon.runAction(new cc.Sequence(new cc.ScaleTo(.5,1.5),new cc.DelayTime(.7),new cc.FadeOut(.3),new cc.CallFunc(function(){this.removeFromParent()}.bind(this))));var e=new cleverapps.Particles(bundles.particle.jsons.particles_collect_json,bundles.game.urls.particle_texture);e.setScale(1.5),e.setLocalZOrder(-1),e.setPositionRound(this.width/2,this.height/2),this.addChild(e)}},listNodeBundles:function(){return["units_shop"]}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{UNITSSHOP_CART_AMOUNT:{name:"default",size:40}}),cleverapps.styles.UnitsShopCart={x:{align:"left",dx:120},y:{align:"center",dy:-5},width:189,height:139,bottomIcon:{x:{align:"center"},y:{align:"center"}},topIcon:{x:{align:"center",dx:-18},y:{align:"center",dy:-18}},amountBlock:{x:{align:"right",dx:-10},y:{align:"bottom",dy:4},amountText:{x:{align:"center",dx:2},y:{
align:"center",dy:4},maxWidth:40}},item:{scale:.8,firstItem:{oneItem:{x:{align:"center",dx:-15},y:{align:"bottom",dy:85}},twoItems:{x:{align:"center",dx:-30},y:{align:"bottom",dy:85}}},secondItem:{x:{align:"center",dx:0},y:{align:"bottom",dy:100}}},moveDelta:{x:500,y:400}},UnitsShop.DEFAULT_PRODUCTS=[{unit:{code:"herochest",stage:0},price:80,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.OTHER_TAB,amount:1,left:2,energyTime:16},{unit:{code:"crystal",stage:0},price:75,priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.OTHER_TAB,amount:1,left:1,energyTime:6},{unit:{code:"crystal",stage:3},price:195,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.OTHER_TAB,amount:1,left:1,energyTime:24},{unit:{code:"freechest",stage:0},tab:UnitsShop.OTHER_TAB,amount:1,left:1,energyTime:2},{unit:{code:"worker",stage:4},price:150,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.OTHER_TAB,amount:2,left:2,energyTime:20},{unit:{code:"sacks",stage:2},price:150,priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.FRUIT_TAB,amount:1,
left:3,energyTime:10}],UnitsShop.FRUIT_TEMPLATE=[{unit:{stage:4},price:75,priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.FRUIT_TAB,amount:5,left:3,energyTime:6},{unit:{stage:4},price:25,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.FRUIT_TAB,amount:10,left:3,energyTime:6}],UnitsShop.RESOURCE_CHESTS_TEMPLATE=[{unit:{stage:0},price:55,priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.RESOURCE_TAB,amount:1,left:2,energyTime:4},{unit:{stage:1},price:135,priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.RESOURCE_TAB,amount:1,left:2,energyTime:10},{unit:{stage:2},price:75,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.RESOURCE_TAB,amount:1,left:2,energyTime:16}],UnitsShop.RESOURCE_TEMPLATE={priceType:UnitsShop.COIN_PRICE,tab:UnitsShop.RESOURCE_TAB,amount:1,left:5,energyTime:[2,6,14,24,32,45]},UnitsShop.HERO_ITEMS_TEMPLATE=[{unit:{stage:1},price:25,priceType:UnitsShop.RUBY_PRICE,tab:UnitsShop.OTHER_TAB,amount:1,left:3,energyTime:6},{unit:{stage:0},price:35,priceType:UnitsShop.COIN_PRICE,
tab:UnitsShop.OTHER_TAB,amount:1,left:3,energyTime:2}],UnitsShop.RESOURCE_DATA={default:{basicPrice:50,stages:6},wood:{basicPrice:25,stages:4},stone:{basicPrice:30,stages:5},wagon:{basicPrice:35,stages:5}};var UnitsShopTileModel=function(e){TileModel.call(this,e),this.onBuy=function(){}};UnitsShopTileModel.prototype=Object.create(TileModel.prototype),(UnitsShopTileModel.prototype.constructor=UnitsShopTileModel).prototype.getAvailable=function(){return 0<this.product.left},UnitsShopTileModel.prototype.getCurrentPrice=function(){return this.product.price?this.product.price:"messages:FREE"},UnitsShopTileModel.prototype.getPriceIcon=function(){if(this.product.price)return this.product.priceType===UnitsShop.COIN_PRICE?bundles.reward_icons.frames.shop_coin_png:this.product.priceType===UnitsShop.RUBY_PRICE?bundles.reward_icons.frames.gold_small_png:void 0},UnitsShopTileModel.prototype.buy=function(){if(0<this.product.left){var e=this.product.amount-Game.currentGame.map.countEmptySlots();if(
0<e)return void Game.currentGame.onHintMessage("messages:Spawn.nospace",!0,{left:e});var t=!1;this.product.priceType===UnitsShop.RUBY_PRICE?t=cleverapps.user.takeGold(this.product.price):this.product.priceType===UnitsShop.COIN_PRICE?t=Game.currentGame.takeCoins(this.product.price):this.product.price||(t=!0),t&&(this.product.priceType===UnitsShop.RUBY_PRICE?cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNITS_SHOP_RUBY,{amount:this.product.price}):this.product.priceType===UnitsShop.COIN_PRICE&&cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNITS_SHOP_COINS,{amount:this.product.price}),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.UNITS_SHOP_ITEM+"_"+this.product.unit.code+"_"+this.product.unit.stage+"_"+this.product.amount),Game.currentGame.unitsShop.buy(this.product.unit,this.product.amount),this.product.left--,this.onBuy())}};var UnitsShopTile=cc.Node.extend({ctor:function(e,t){this._super(),this.tileModel=e,this.options=t||{},this.createContent(),
this.tileModel.product.left||this.disable(),this.tileModel.onBuy=this.createListener(this.onBuyProduct.bind(this))},flyUnitToCart:function(e){var t=cleverapps.styles.UnitsShopTile,s=new cc.Node;s.setAnchorPoint2();var i=UnitView.getUnitImage(this.tileModel.product.unit);i.setScale(t.icon.scale),s.addChild(i),this.iconNode.addChild(s),s.setPositionRound(this.iconNode.width/2,this.iconNode.height/2),s.setVisible(!1),s.runAction(new cc.Sequence(new cc.DelayTime(.1*e),new cc.CallFunc(function(){s.setVisible(!0),cleverapps.UI.collectAnimation(s,this.options.cart.target,{targetEffect:!0,finishRemove:!1,callback:function(){this.options.cart.incAmount(i),n.stop(function(){s.removeFromParent()})}.bind(this)})}.bind(this))));var n=new cleverapps.Particles(bundles.particle.jsons.particles_collect_json,bundles.game.urls.particle_texture);n.setLocalZOrder(-1),s.addChild(n),s.replaceParentSamePlace(cc.director.getRunningScene())},onBuyProduct:function(){for(
var e=0;e<this.tileModel.product.amount;e++)this.flyUnitToCart(e);this.grantEnergy(),this.updateLeft(),this.tileModel.product.left||this.disable()},grantEnergy:function(){var e=cleverapps.missionManager.findByType(Mission.TYPE_ENERGY_TIME);e&&e.isRunning()&&this.energyIcon&&(this.energyIcon.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.15),new cc.ScaleTo(.1,1))),Game.currentGame.addReward("energy",this.tileModel.product.energyTime,this.energyIcon,{beginScale:.8,withoutDelta:!0}))},disable:function(){var e=cleverapps.styles.UnitsShopTile;this.amountBg.removeFromParent(),this.amountText.removeFromParent(),this.iconNode.removeFromParent(),this.iconNode=new cc.Sprite(bundles.units_shop.frames.lock_png),this.iconNode.setPositionRound(e.blockIcon),this.bg.addChild(this.iconNode),this.button.disable(),this.updateAttention(),this.energyIcon&&this.energyIcon.removeFromParent()},updateLeft:function(){this.leftText.setString(Messages.get("UnitsShop.left",{left:this.tileModel.product.left})),
this.leftText.fitTo(cleverapps.styles.UnitsShopTile.title.left.maxWidth)},addAttentionFinger:function(){this.attention&&(this.attentionFinger=new FingerView,this.button.addChild(this.attentionFinger),this.attentionFinger.setPositionRound(cleverapps.styles.UnitsShopTile.attentionFinger),this.attentionFinger.standardLoop({delay:2.5}))},updateAttention:function(){!this.tileModel.product.left||this.tileModel.product.price?(this.attention&&(this.attention.removeFromParent(),this.attention=void 0),this.attentionFinger&&(this.attentionFinger.removeFromParent(),this.attentionFinger=void 0)):this.attention||(this.attention=new cc.Sprite(bundles.windows.frames.tab_attention),this.attention.setPositionRound(cleverapps.styles.UnitsShopTile.attention),this.addChild(this.attention),this.attention.runAction(new cc.RepeatForever(new cc.Sequence(new cc.ScaleTo(.3,1.1),new cc.ScaleTo(.3,1)))))},createContent:function(){var e=cleverapps.styles.UnitsShopTile;this.setContentSize2(e),this.setAnchorPoint2(),
this.bg=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.bg_png),this.bg.setContentSize2(e.bg),this.bg.setPositionRound(e.bg),this.addChild(this.bg);var t=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.title_png);t.setContentSize2(e.title),t.setPositionRound(e.title),this.bg.addChild(t),this.leftText=cleverapps.UI.generateOnlyText("",cleverapps.styles.FONTS.UNITSSHOPTILE_LEFT),this.leftText.setPositionRound(e.title.left),t.addChild(this.leftText),this.updateLeft(),this.amountBg=cleverapps.UI.createScale9Sprite(bundles.units_shop.frames.amount_bg_png),this.amountBg.setContentSize2(e.amount),this.amountBg.setPositionRound(e.amount),this.bg.addChild(this.amountBg),this.amountText=cleverapps.UI.generateImageText("x"+this.tileModel.product.amount,cleverapps.styles.FONTS.UNITSSHOPTILE_AMOUNT),this.amountText.setPositionRound(e.amount.text),this.bg.addChild(this.amountText),this.iconNode=new UnitOnCell(this.tileModel.product.unit,{scale:e.icon.scale}),
this.iconNode.setAnchorPoint2(),this.iconNode.setPositionRound(e.icon),this.bg.addChild(this.iconNode);var s,i=Game.currentGame.unitsLibrary.getUnitName(this.tileModel.product.unit);if(0<=i.indexOf(" ")?(i.lastIndexOf(" ")===i.indexOf(" ")&&(i=i.replace(" ","\n")),(s=cleverapps.UI.generateOnlyText(i,cleverapps.styles.FONTS.UNITSSHOPTILE_NAME)).setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER)):s=cleverapps.UI.generateOnlyText(i,cleverapps.styles.FONTS.UNITSSHOPTILE_NAME),s.fitTo(e.name.maxWidth,e.name.maxHeight),s.setPositionRound(e.name),this.bg.addChild(s),"chest"===Families[this.tileModel.product.unit.code].type){var n=new cleverapps.UI.Button({button_png:bundles.merge.frames.guide_button_png,button_on_png:bundles.merge.frames.guide_button_on_png,onClicked:function(){new ChestPrizeProbWindow(this.tileModel.product.unit)}.bind(this)});n.setPositionRound(e.guideButton),this.addChild(n)}this.button=new TileButton(this.tileModel,!1,{
button_png:this.tileModel.product.price?e.button.button_png:e.button.free_button_png,button_on_png:this.tileModel.product.price?e.button.button_on_png:e.button.free_button_on_png,button_off_png:e.button.button_off_png,width:e.button.width,height:e.button.height,onClicked:this.options.onClicked,font:cleverapps.styles.FONTS.UNITSSHOPTILE_BUTTON,scale:e.button.scale}),this.button.setPositionRound(e.button),this.addChild(this.button),this.updateAttention(),this.createEnergyIcon()},createEnergyIcon:function(){if(this.tileModel.product.energyTime){var e=cleverapps.missionManager.findByType(Mission.TYPE_ENERGY_TIME);if(e&&e.isRunning()){var t=this.tileModel.product.energyTime,s="energy_time_icon"+(10<t?20<t?3:2:1),i=this.energyIcon=new cc.Sprite(bundles.mergeui.frames[s]);this.bg.addChild(i),i.setPositionRound(cleverapps.styles.UnitsShopTile.energyIcon);var n=new cleverapps.CountDown(e.getTimeLeft(),{onFinish:this.createListener(function(){i.runAction(new cc.Sequence(new cc.ScaleTo(.2,.2),
new cc.RemoveSelf))}.bind(this))});this.registerCleanupCallback(function(){n.remove()})}}}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{UNITSSHOPTILE_AMOUNT:{name:"default",size:68},UNITSSHOPTILE_NAME:{size:46,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},UNITSSHOPTILE_LEFT:{size:46,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},UNITSSHOPTILE_BUTTON:{size:68,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.UnitsShopTile={width:380,height:740,bg:{width:370,height:600,x:{align:"center"},y:{align:"top",dy:-5}},attention:{x:{align:"right",dx:30},y:{align:"bottom",dy:42}},attentionFinger:{x:{align:"center"},y:{align:"center"}},name:{maxWidth:340,maxHeight:100,x:{align:"center"},y:{align:"center",dy:-230}},icon:{x:{align:"center"},y:{align:"top",
dy:-144},scale:1.4},blockIcon:{x:{align:"center"},y:{align:"center",dy:0}},amount:{width:380,height:120,x:{align:"center"},y:{align:"bottom",dy:120},text:{x:{align:"center"},y:{align:"bottom",dy:160}}},title:{width:356,height:80,x:{align:"center"},y:{align:"top",dy:-6},left:{x:{align:"center"},y:{align:"center",dy:-4},maxWidth:264}},guideButton:{x:{align:"left",dx:-14},y:{align:"top",dy:2}},energyIcon:{x:{align:"right",dx:-5},y:{align:"top",dy:-70}},button:{x:{align:"center"},y:{align:"bottom",dy:10},width:380,height:106,scale:1,button_png:bundles.buttons_main.frames.blue_button_png,button_on_png:bundles.buttons_main.frames.blue_button_on_png,free_button_png:bundles.buttons.frames.window_button_png,free_button_on_png:bundles.buttons.frames.window_button_on_png,button_off_png:bundles.buttons.frames.window_button_disabled_png}};var SpecialOfferWindow=Window.extend({onWindowLoaded:function(e){this.specialOffer=e,this._super({title:"messages:SpecialOfferWindow.title",
name:"SpecialOfferWindow",content:this.createContent(),closeButton:!0}),cleverapps.audio.playSound(bundles.merge.urls.specialoffer_window_effect)},createContent:function(){var e=cleverapps.styles.SpecialOfferWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize(e);var s=this.offerButtons=this.createButtons();s.setAnchorPoint2(),s.setPositionRound(e.buttons),t.addChild(s);var i=this.createInfoBlock();i.setAnchorPoint2(),i.setPositionRound(e.infoBlock),t.addChild(i);var n=new cleverapps.Spine(bundles.dialogues.jsons.seller_json);n.setAnchorPoint2(),n.setPositionRound(e.person),t.addChild(n),this.specialOffer.prize.getData().buildable?n.setAnimation(0,"special_offer_building",!0):n.setAnimation(0,"special_offer",!0);var o=cleverapps.UI.generateOnlyText("messages:SpecialOfferWindow.text",cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_TEXT);return o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),o.setDimensions(e.title.width,e.title.height),o.setAnchorPoint2(),o.setPositionRound(e.title
),t.addChild(o),t},createInfoBlock:function(){var e=cleverapps.styles.SpecialOfferWindow.infoBlock,t=cleverapps.UI.createScale9Sprite(bundles.bonusworkerwindow.frames.info_background);t.setContentSize2(e);var s=this.createTimer();s.setAnchorPoint2(),s.setPositionRound(e.timer),t.addChild(s);var i=this.createUnitIcon();return i.setAnchorPoint2(),i.setPositionRound(e.icon),t.addChild(i),t},createUnitIcon:function(){var e=cleverapps.styles.SpecialOfferWindow.infoBlock.icon,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=new cc.Sprite(bundles.merge.frames.stand_ground);s.setAnchorPoint2(),s.setPositionRound(e.ground),t.addChild(s);var i=UnitView.getUnitStyles(this.specialOffer.prize),n=UnitView.getUnitImage(this.specialOffer.prize);return n.setAnchorPoint2(i.anchorX,i.anchorY),n.setPositionRound(e.icon),n.setScale(e.icon.scale),t.addChild(n),t},createTimer:function(){var e=cleverapps.styles.SpecialOfferWindow.infoBlock.timer,t=new cc.Scale9Sprite(
bundles.merge.frames.bar_bg_png);t.setAnchorPoint2(),t.setContentSize2(e);var s=new cleverapps.CountDownView(new cleverapps.CountDown(this.specialOffer.getTimeLeft(),{onFinish:this.timeIsOver.bind(this)}),{font:cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_TIMER_TEXT});s.setAnchorPoint2(),s.setPositionRound(e.countdown),t.addChild(s);var i=new cc.Sprite(bundles.mergeui.frames.timer_icon_large);i.setAnchorPoint2(),i.setPositionRound(e.icon),i.setScale(e.icon.scale),t.addChild(i);var n=cleverapps.UI.generateOnlyText("messages:SpecialOfferWindow.timer",cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_TITLE_TEXT);return new cleverapps.Layout([t,n],{direction:cleverapps.UI.VERTICAL,margin:e.margin})},createButtons:function(){var e=cleverapps.styles.SpecialOfferWindow.buttons,t=new cc.Sprite(bundles.reward_icons.frames.shop_gold_png),s=cleverapps.UI.generateImageText(this.specialOffer.getPrice(),cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_BUTTON_PRICE_TEXT),i=new cleverapps.Layout([t,s],{
direction:cleverapps.UI.HORIZONTAL,margin:e.button.margin}),n=new cleverapps.UI.Button({styles:e.button,content:i,contentOff:cleverapps.UI.generateOnlyText("messages:SpecialOfferWindow.timeIsOver",cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_BUTTON_TEXT),onClicked:this.tryBuy.bind(this),button_images:cleverapps.UI.Button.Images.button_blue}),o=new cleverapps.UI.Button({styles:e.button,content:cleverapps.UI.generateOnlyText("messages:SpecialOfferWindow.pass",cleverapps.styles.FONTS.SPECIAL_OFFER_WINDOW_BUTTON_TEXT),onClicked:this.tryPass.bind(this),button_images:cleverapps.UI.Button.Images.button_red});return new cleverapps.Layout([n,o],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin})},tryBuy:function(){this.specialOffer.buy()&&this.close()},tryPass:function(){this.close(),this.specialOffer.pass()},timeIsOver:function(){this.offerButtons.children[0].disable(),this.offerButtons.children[1].disable()}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{
SPECIAL_OFFER_WINDOW_TIMER_TEXT:{size:38,color:cleverapps.styles.COLORS.WHITE},SPECIAL_OFFER_WINDOW_TITLE_TEXT:{size:55,color:cleverapps.styles.COLORS.YELLOW_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SPECIAL_OFFER_WINDOW_TEXT:{size:40,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},SPECIAL_OFFER_WINDOW_BUTTON_PRICE_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SPECIAL_OFFER_WINDOW_BUTTON_TEXT:{size:50,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.SpecialOfferWindow={width:1400,height:610,person:{scale:1.5,x:{align:"left",dx:-30},y:{align:"bottom",dy:-100}},infoBlock:{width:1430,height:340,x:{align:"center"},y:{align:"top"},icon:{width:270,height:270,x:{
align:"right",dx:-70},y:{align:"center",dy:5},icon:{x:{align:"center"},y:{align:"center",dy:-45},scale:1.5},shine:{x:{align:"center"},y:{align:"center",dy:-25},scale:1.4},ground:{x:{align:"center",dx:5},y:{align:"center",dy:-50}}},timer:{width:260,height:50,x:{align:"right",dx:-350},y:{align:"center",dy:10},margin:20,countdown:{x:{align:"right",dx:-20},y:{align:"center",dy:2}},icon:{x:{align:"left",dx:-20},y:{align:"center"},scale:.5}}},title:{width:600,height:0,x:{align:"right",dx:-90},y:{align:"bottom",dy:125}},buttons:{x:{align:"right",dx:-30},y:{align:"bottom",dy:-25},margin:52,button:{width:360,height:110,padding:{left:20,right:20,top:5,bottom:10},margin:12}}};var EnergyProducts=function(e){this.data=e||{}};EnergyProducts.prototype.save=function(){return this.data},EnergyProducts.prototype.getBuyTime=function(e){return this.data[e]||0},EnergyProducts.prototype.buyProduct=function(e){this.data[e]=Date.now(),Game.currentGame.storeSave()};var EnergyLottery=function(e){
this.onLotteryStatusChanged=function(e){},this.load(e),this.update()};EnergyLottery.prototype.onChangeGameLevel=function(){this.update()},EnergyLottery.prototype.load=function(e){e=e||{},this.refreshTime=e.refreshTime||0,this.roundTime=e.roundTime||0,this.seed=e.seed||0,this.used=e.used||0,e.swaps&&(this.swaps=e.swaps.split("").map(cleverapps.castType)),e.lastRefreshTime&&0===e.roundTime&&(e.roundTime=1)},EnergyLottery.prototype.save=function(){var e={refreshTime:this.refreshTime,roundTime:this.roundTime,seed:this.seed,used:this.used};return this.swaps&&(e.swaps=this.swaps.join("")),e},EnergyLottery.prototype.update=function(){clearTimeout(this.timeout);var e=this.getTimeLeft(),t=e<=0&&this.isAvailable();this.ready!==t&&(this.ready=t,this.onLotteryStatusChanged()),0<e&&(this.timeout=new cleverapps.LongTimeout(this.update.bind(this),e))},EnergyLottery.prototype.clear=function(){clearTimeout(this.timeout)},EnergyLottery.prototype.isAvailable=function(){
return cleverapps.user.checkAvailable(EnergyLottery.AVAILABLE)},EnergyLottery.prototype.isReady=function(){return this.isAvailable()&&this.ready},EnergyLottery.prototype.getTimeLeft=function(){var e=this.roundTime+cleverapps.parseInterval(EnergyLottery.ROUND_INTERVAL);return this.used===EnergyLottery.USED_ALL&&(e=Math.max(e,this.getNextRefreshTime())),Math.max(0,e-Date.now())},EnergyLottery.prototype.getNextRefreshTime=function(){return this.refreshTime+cleverapps.parseInterval(EnergyLottery.REFRESH_INTERVAL)},EnergyLottery.prototype.getLot=function(e){return this.lots[e]},EnergyLottery.prototype.isUsed=function(e){return this.used&1<<e},EnergyLottery.prototype.refresh=function(){this.lots=void 0,this.refreshTime=Date.now(),this.used=0,this.seed++,this.swaps=void 0,Game.currentGame.storeSave()},EnergyLottery.prototype.initializeLots=function(){this.getNextRefreshTime()<=Date.now()&&this.refresh(),this.lots||(cleverapps.Random.seed(this.seed),this.lots=cleverapps.Random.shuffle(
EnergyLottery.LOTS),this.swaps&&this.makeSwaps(this.lots,this.swaps))},EnergyLottery.prototype.refreshRound=function(){this.roundTime=1,Game.currentGame.storeSave(),this.update()},EnergyLottery.prototype.useLot=function(e){if(!this.isUsed(e)&&this.isReady()){if(0===this.roundTime){var t=this.lots.indexOf(EnergyLottery.MAX_VALUE);t!==e&&(this.swaps=[e,t],this.makeSwaps(this.lots,this.swaps))}this.used=this.used|1<<e,this.roundTime=Date.now(),Game.currentGame.storeSave(),this.update()}},EnergyLottery.prototype.makeSwaps=function(e,t){for(var s=0;s<t.length;s+=2){var i=e[t[s]];e[t[s]]=e[t[s+1]],e[t[s+1]]=i}},EnergyLottery.maxValue=function(){return EnergyLottery.MAX_VALUE},EnergyLottery.countLots=function(){return EnergyLottery.LOTS.length},EnergyLottery.AVAILABLE={level:4},EnergyLottery.LOTS=[30,35,40,45,50,55,60,65,100],EnergyLottery.MAX_VALUE=Math.max.apply(Math,EnergyLottery.LOTS),EnergyLottery.USED_ALL=(1<<EnergyLottery.LOTS.length)-1,EnergyLottery.ROUND_INTERVAL="3 hours",
EnergyLottery.REFRESH_INTERVAL="24 hours",cleverapps.config.debugMode&&(EnergyLottery.ROUND_INTERVAL="30 seconds",EnergyLottery.REFRESH_INTERVAL="5 minutes");var EnergyLotteryWindow=Window.extend({onWindowLoaded:function(e){this.used=!1,Game.currentGame.energyLottery.initializeLots(),this._super({name:"EnergyLotteryWindow",content:this.createContent(),noBackground:!0,adjustToContent:!0,closeButton:!0}),this.onClose=e},createContent:function(){var e=cleverapps.styles.EnergyLotteryWindow,t=new cleverapps.Spine(bundles.energylotterywindow.jsons.energy_lottery_json);t.setAnchorPoint2(),t.setPositionRound(e.background),t.setAnimation(0,"animation",!0);var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(t.width,t.height),s.addChild(t);var i=this.createField();i.setAnchorPoint2(),i.setPositionRound(e.field),s.addChild(i);var n=cleverapps.UI.generateOnlyText("messages:EnergyLotteryWindow.title",cleverapps.styles.FONTS.ENERGY_LOTTERY_TITLE_TEXT);n.setAnchorPoint2(),n.setPositionRound(
e.title),n.fitTo(e.title.width,e.title.height),s.addChild(n);var o=cleverapps.UI.generateOnlyText("messages:EnergyLotteryWindow.description",cleverapps.styles.FONTS.ENERGY_LOTTERY_DESCRIPTION_TEXT);o.setAnchorPoint2(),o.setPositionRound(e.description),o.fitTo(e.description.width,e.description.height),s.addChild(o);var r=new cleverapps.Spine(bundles.dialogues.jsons.seller_json);r.setAnchorPoint2(),r.setPositionRound(e.person),r.setAnimation(0,"lottery",!0),r.setLocalZOrder(1),s.addChild(r);var a=this.axe=new cleverapps.Spine(bundles.energylotterywindow.jsons.energy_lottery_axe_json);return a.setAnchorPoint2(),a.setPositionRound(e.axe),a.setLocalZOrder(10),a.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.CallFunc(a.setAnimationAndIdleAfter.bind(a,"axe_emergence","axe_idle")))),s.addChild(a),s},createDescription:function(){return cleverapps.UI.generateOnlyText("messages:EnergyLotteryWindow.description",cleverapps.styles.FONTS.WINDOW_TEXT)},createField:function(){for(
var e=cleverapps.styles.EnergyLotteryWindow.field,t=[],s=0;s<EnergyLottery.countLots();s++)t[s]=this.createLotIcon(s);return this.icons=t,new cleverapps.GridLayout(t,{columns:3,margin:e.margin,padding:e.padding})},createLotIcon:function(e){var t=cleverapps.styles.EnergyLotteryWindow.icon,s=Game.currentGame.energyLottery,i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(t);var n=i.animation=new cleverapps.Spine(bundles.energylotterywindow.jsons.energy_lottery_icon_json);n.setAnchorPoint2(),n.setPositionRound(i.width/2,i.height/2),i.addChild(n);var o=i.reward=cleverapps.UI.generateImageText(s.getLot(e),cleverapps.styles.FONTS.ENERGY_LOTTERY_VALUE_TEXT);return o.setAnchorPoint2(),o.setPositionRound(t.reward),i.addChild(o),s.isUsed(e)?n.setAnimation(0,"idle_crashed",!0):(n.setAnimation(0,"idle",!0),o.setVisible(!1),cleverapps.UI.applyHover(i),cleverapps.UI.onClick(i,this.onIconClicked.bind(this,e),{useInteractiveScale:!0})),i},onIconClicked:function(s){
var i=Game.currentGame.energyLottery;if(!this.used&&!i.isUsed(s)&&i.isReady()){var n=this.icons[s];this.used=!0,this.icons.forEach(function(e,t){cc.eventManager.removeListeners(e),i.isUsed(t)||e===n||e.animation.setAnimationAndIdleAfter("close","idle_closed")}.bind(this)),cleverapps.audio.playSound(bundles.energylotterywindow.urls.open_lot_effect);var o=this.axe;o.stopAllActions(),o.setAnimation(0,"axe_crash1",!1),o.setCompleteListener(function(){var e=cleverapps.styles.EnergyLotteryWindow.axe.target.offset,t=o.parent.convertToNodeSpace(n.parent.convertToWorldSpace(n.getPosition()));o.setCompleteListener(null),o.setAnimation(0,"axe_crash2",!1),o.runAction(new cc.Sequence(new cc.MoveTo(.5667,t.x+e.x,t.y+e.y),new cc.CallFunc(function(){n.animation.setAnimationAndIdleAfter("crash","idle_crashed"),n.setLocalZOrder(1),i.useLot(s),n.reward.setVisible(!0),n.reward.setString(i.getLot(s)),Game.currentGame.addReward("energy",i.getLot(s),n,{beginScale:.8,withoutDelta:!0}),
cleverapps.UI.onTouchBegan(this.window,this.close.bind(this))}.bind(this))))}.bind(this))}},listBundles:function(){return["energylotterywindow"]}});cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{ENERGY_LOTTERY_STROKE:{color:new cc.Color(95,29,17,255),size:1},ENERGY_LOTTERY_SHADOW:{color:new cc.Color(11,13,37,128),direction:cc.size(0,-3),blur:4}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{ENERGY_LOTTERY_TITLE_TEXT:{size:78,color:new cc.Color(255,201,39,255),stroke:cleverapps.styles.DECORATORS.ENERGY_LOTTERY_STROKE,shadow:cleverapps.styles.DECORATORS.ENERGY_LOTTERY_SHADOW},ENERGY_LOTTERY_DESCRIPTION_TEXT:{size:34,color:new cc.Color(255,220,132,255),stroke:cleverapps.styles.DECORATORS.ENERGY_LOTTERY_STROKE,shadow:cleverapps.styles.DECORATORS.ENERGY_LOTTERY_SHADOW},ENERGY_LOTTERY_VALUE_TEXT:{size:40,color:new cc.Color(253,236,65,255),stroke:cleverapps.styles.DECORATORS.ENERGY_LOTTERY_STROKE}}),cleverapps.styles.EnergyLotteryWindow={background:{x:{align:"center"},y:{
align:"center",dy:-45}},field:{x:{align:"center",dx:0},y:{align:"center",dy:-28},margin:{x:50,y:50},padding:{x:30,y:30}},person:{x:{align:"center",dx:-609},y:{align:"bottom",dy:50}},icon:{width:150,height:150,reward:{x:{align:"center"},y:{align:"center",dy:-17}}},title:{x:{align:"center",dx:0},y:{align:"center",dy:396},width:600,height:90},description:{x:{align:"center",dx:0},y:{align:"center",dy:306},width:400,height:50},axe:{x:{align:"right",dx:155},y:{align:"bottom",dy:-360},target:{offset:{x:709,y:-465}}}};var FeastMissionWindow=Window.extend({onWindowLoaded:function(e){this.mission=e.mission,this.pack=e.pack,this._super({name:e.name,content:this.createContent(),noBackground:!0}),cleverapps.metha.showControlsWhileFocused(e.controls),this.mission.updateCompetitionResults();var t=cleverapps.styles.FeastMissionWindow,s=new cc.Node;s.setAnchorPoint2(),s.setContentSize(this.getContentSize()),s.setPositionRound(this.width/2,this.height/2),this.addChild(s)
;var i=cleverapps.UI.getSceneSize();if(i.width<t.needWidth){var n=i.width/t.needWidth;s.setScale(n),s.height/=n,this.content.setScale(n)}this.addPerson(s),this.addBugs(s)},createContent:function(){var e=cleverapps.styles.FeastMissionWindow,t=this.mission,s=new cleverapps.Spine(bundles.energy_feast.jsons.feast_mission_board);s.setAnchorPoint2(),s.setPositionRound(e.background),s.setAnimation(0,"animation",!0);var i=new cc.Node;i.setAnchorPoint2(),i.setContentSize2(s.width,s.height),i.addChild(s);var n=this.createTable();n.setAnchorPoint2(),n.setPositionRound(e.table),i.addChild(n);var o=cleverapps.UI.generateOnlyText(this.getTitle(),cleverapps.styles.FONTS.FEAST_MISSION_MAIN_TITLE_TEXT);o.setAnchorPoint2(),o.setPositionRound(e.mainTitle),o.fitTo(e.mainTitle.width,e.mainTitle.height),i.addChild(o);var r=new cleverapps.UI.Button({button_png:bundles.merge.frames.guide_button_png,button_on_png:bundles.merge.frames.guide_button_on_png,onClicked:function(){new FeastMissionRulesWindow(t)}})
;if(r.setAnchorPoint2(),r.setPositionRound(e.helpButton),i.addChild(r),t.isRunning()){var a=new cleverapps.CountDownView(new cleverapps.CountDown(t.getTimeLeft(),{onFinish:this.reopen.bind(this)}),{font:cleverapps.styles.FONTS.FEAST_MISSION_TIMER_TEXT});a.setAnchorPoint2(),a.setPositionRound(e.timer),i.addChild(a)}else{var c=cleverapps.UI.generateOnlyText("messages:FeastMissionWindow.finished",cleverapps.styles.FONTS.FEAST_MISSION_TIMER_TEXT);c.setAnchorPoint2(),c.setPositionRound(e.finishTitle),c.fitTo(e.finishTitle.width,e.finishTitle.height),i.addChild(c);var l=new cleverapps.UI.Button({styles:e.finishButton,button_images:cleverapps.UI.Button.Images.button_blue,text:t.getPrize()?"messages:ClaimPrize.Button.text":"messages:Close",font:cleverapps.styles.FONTS.BUTTON_TEXT,onClicked:this.close.bind(this)});l.setAnchorPoint2(),l.setPositionRound(e.finishButton),i.addChild(l)}return this.content=i},createTable:function(){var e=cleverapps.styles.FeastMissionWindow.table,t=this.mission,
s=cleverapps.missionManager.table.createTableView({id:t.type,data:t.getResults(),dataIcon:t.getIcon(),options:{styles:e},rowConstructor:FeastMissionWindow.MissionRow({amountTooltip:this.getAmountTooltip()})});return t.onChangeResults=this.createListener(function(){var e=t.getResults();s.updateResults(e),cleverapps.missionManager.table.updateResults(t.type,e)}),s},buyPackProduct:function(){cleverapps.eventLogger.logEvent(this.pack.type+cleverapps.EVENTS.FEAST_PACK_BUY),cleverapps.eventLogger.logEvent(this.pack.type+cleverapps.EVENTS.FEAST_PACK_RUBY,{amount:this.pack.price}),new RewardWindow({reward:this.pack.prizes}),this.close()},addBugs:function(e){var t=cleverapps.styles.FeastMissionWindow,s=this.smallBug=this.createBugAnimation("small");s.setAnimation(0,"animation",!0),s.setAnchorPoint2(),s.setPositionRound(t.smallBug),e.addChild(s);var i=this.mediumBug=this.createBugAnimation("medium");i.setAnimation(0,"animation",!0),i.setAnchorPoint2(),i.setPositionRound(t.mediumBug),e.addChild(i
);var n=this.bigBug=this.createOfferBug();n.setAnchorPoint2(),n.setPositionRound(t.bigBug),e.addChild(n)},createOfferBug:function(){var e=this.createBugAnimation("big");if(e.setAnimation(0,"animation",!0),!this.mission.isRunning())return e.setAnimation(0,"animation2",!0),e;var t=this.createPack();return t.setAnchorPoint2(),t.setPositionRound(this.getPackPosition()),e.addChild(t),e},createPack:function(){var e=cleverapps.styles.FeastMissionWindow.pack,t=new cc.Node,s=this.createReward(bundles.energy_feast.frames.energy_reward,this.pack.prizes.energy,e.energyReward);s.setAnchorPoint2(.5,0),s.setPositionRound(e.energyReward),t.addChild(s);var i="coins"===this.pack.type?this.createReward(bundles.energy_feast.frames.coins_reward,this.pack.prizes.coins,e.workerReward):this.createReward(bundles.reward_icons.frames.reward_worker_png,this.pack.prizes.worker.title,e.workerReward);i.setAnchorPoint2(.5,0),i.setPositionRound(e.workerReward),t.addChild(i);var n=this.buyPackButton=new UseGoldButton({
button_images:cleverapps.UI.Button.Images.button_green,image:bundles.reward_icons.frames.gold_small_png,price:this.pack.price,onClicked:this.buyPackProduct.bind(this)},e.buyPackButton);return n.setAnchorPoint2(),n.setPositionRound(e.buyPackButton),t.addChild(n),t},createReward:function(e,t,s){var i=new cc.Sprite(e),n=cleverapps.UI.generateOnlyText("number"==typeof t?"x"+t:t,cleverapps.styles.FONTS.FEAST_MISSION_REWARD_TEXT);return n.fitTo(s.width),new cleverapps.Layout([n,i],{direction:cleverapps.UI.VERTICAL})},onShow:function(){this.person&&(this.person.y-=this.person.height,this.person.runAction(new cc.MoveBy(.4,0,this.person.height).easing(cc.easeBackOut()))),this.bigBug.y+=this.bigBug.height,this.bigBug.x+=this.bigBug.height,this.bigBug.runAction(new cc.MoveBy(.6,-this.bigBug.height,-this.bigBug.height).easing(cc.easeCubicActionOut())),this.mediumBug.y+=this.bigBug.height,this.mediumBug.x+=this.bigBug.height,this.mediumBug.runAction(new cc.MoveBy(.8,-this.bigBug.height,
-this.bigBug.height).easing(cc.easeCubicActionOut())),this.smallBug.y+=this.bigBug.height,this.smallBug.x+=this.bigBug.height,this.smallBug.runAction(new cc.MoveBy(.7,-this.bigBug.height,-this.bigBug.height).easing(cc.easeCubicActionOut())),cleverapps.audio.playSound(bundles.merge.urls.pixel_fly_effect)},listBundles:function(){return["energy_feast"]},addPerson:function(e){},getTitle:function(){return""},getAmountTooltip:function(){return""},createBugAnimation:function(e){},getPackPosition:function(){}});FeastMissionWindow.MissionRow=function(e){return e=e||{},cleverapps.MissionRow.extend({getTooltipText:function(){return e.amountTooltip},addPrizeBannerTooltip:function(e,t){cleverapps.tooltipManager.create(t,{text:e,position:cleverapps.styles.UI.Tooltip.LOCATION.above,clickableArea:this.clickableArea})}})},cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{FEAST_MISSION_STROKE:{color:new cc.Color(95,29,17,255),size:1},FEAST_MISSION_SHADOW:{color:new cc.Color(11,13,37,128),
direction:cc.size(0,-3),blur:4}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{FEAST_MISSION_MAIN_TITLE_TEXT:{size:78,color:new cc.Color(255,201,39,255),stroke:cleverapps.styles.DECORATORS.FEAST_MISSION_STROKE,shadow:cleverapps.styles.DECORATORS.FEAST_MISSION_SHADOW},FEAST_MISSION_TIMER_TEXT:{size:52,color:new cc.Color(255,220,132,255),stroke:cleverapps.styles.DECORATORS.FEAST_MISSION_STROKE,shadow:cleverapps.styles.DECORATORS.FEAST_MISSION_SHADOW},FEAST_MISSION_REWARD_TEXT:{size:34,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.FeastMissionWindow={background:{x:{align:"center"},y:{align:"center",dy:15}},needWidth:1800,table:{x:{align:"center",dx:-12},y:{align:"center",dy:-92},height:680,margin:-2,bg:void 0},mainTitle:{x:{align:"center",dx:0},y:{align:"center",dy:386},width:700,height:90},helpButton:{x:{align:"center",dx:-385},y:{align:"center",dy:383}},timer:{x:{align:"center",dx:0},y:{align:"center",dy:293}},finishTitle:{x:{align:"center",dx:0},y:{
align:"center",dy:291},width:415,height:60},finishButton:{x:{align:"center",dx:0},y:{align:"bottom",dy:-90},width:400,height:95},smallBug:{x:{align:"center",dx:1108},y:{align:"center",dy:62}},mediumBug:{x:{align:"center",dx:857},y:{align:"center",dy:411}},bigBug:{x:{align:"center",dx:730},y:{align:"center",dy:75}},pack:{workerReward:{x:85,y:60,width:130},energyReward:{x:-80,y:60,width:130},buyPackButton:{x:0,y:0,width:230,height:90}}};var EnergyFeastMissionWindow=FeastMissionWindow.extend({onWindowLoaded:function(e){this._super({mission:e,pack:EnergyFeastMissionWindow.PACK,name:"EnergyFeastMissionWindow",controls:["MenuBarGoldItem","MenuBarLivesItem","MenuBarWorkersItem"]})},reopen:function(){new EnergyFeastMissionWindow(this.mission),this.close()},getTitle:function(){return"messages:EnergyFeastMissionWindow.title"},getAmountTooltip:function(){return"messages:EnergyFeastMissionWindow.tooltip.amount"},addPerson:function(e){var t=cleverapps.styles.EnergyFeastMissionWindow.person,
s=this.person=new cleverapps.Spine(bundles.dialogues.jsons.warlock_json,t.scale);s.setAnchorPoint2(),s.setPositionRound(t),s.setAnimation(0,"dialogue_smile",!0),e.addChild(s)},createBugAnimation:function(e){switch(e){case"small":return new cleverapps.Spine(bundles.energy_feast.jsons.small_energy_bug_json);case"medium":return new cleverapps.Spine(bundles.energy_feast.jsons.medium_energy_bug_json);case"big":return new cleverapps.Spine(bundles.energy_feast.jsons.big_energy_bug_json)}},getPackPosition:function(){return cleverapps.styles.EnergyFeastMissionWindow.pack}});EnergyFeastMissionWindow.PACK={type:"energy",price:250,prizes:{energy:250,worker:Product.FormatUnlimitedLives("1 day")}},cleverapps.styles.EnergyFeastMissionWindow={person:{x:{align:"center",dx:-700},y:{align:"bottom",dy:52},scale:1.6},pack:{x:{align:"center",dx:-73},y:{align:"center",dy:-512}}};var CoinsFeastMissionWindow=FeastMissionWindow.extend({onWindowLoaded:function(e){this._super({mission:e,
pack:CoinsFeastMissionWindow.PACK,name:"CoinsFeastMissionWindow",controls:["MenuBarGoldItem","MenuBarLivesItem","MenuBarCoinsItem"]})},reopen:function(){new CoinsFeastMissionWindow(this.mission),this.close()},getTitle:function(){return"messages:CoinsFeastMissionWindow.title"},getAmountTooltip:function(){return"messages:CoinsFeastMissionWindow.tooltip.amount"},addPerson:function(e){var t=cleverapps.styles.CoinsFeastMissionWindow.person,s=this.person=new cleverapps.Spine(bundles.dialogues.jsons.elf_json,t.scale);s.setAnchorPoint2(),s.setPositionRound(t),s.setAnimation(0,"dialogue_smile",!0),e.addChild(s)},createBugAnimation:function(e){switch(e){case"small":return new cleverapps.Spine(bundles.energy_feast.jsons.small_coins_bug_json);case"medium":return new cleverapps.Spine(bundles.energy_feast.jsons.medium_coins_bug_json);case"big":return new cleverapps.Spine(bundles.energy_feast.jsons.big_coins_bug_json)}},getPackPosition:function(){return cleverapps.styles.CoinsFeastMissionWindow.pack}
});CoinsFeastMissionWindow.PACK={type:"coins",price:250,prizes:{coins:1e3,energy:100}},cleverapps.styles.CoinsFeastMissionWindow={person:{x:{align:"center",dx:-730},y:{align:"bottom",dy:52},scale:1.4},pack:{x:{align:"center",dx:-78},y:{align:"center",dy:-487}}};var EnergyFeastLockedIcon=function(){SideBarIcon.call(this,{animation:bundles.sidebar.jsons.energy_feast_icon_json})};EnergyFeastLockedIcon.prototype=Object.create(SideBarIcon.prototype),(EnergyFeastLockedIcon.prototype.constructor=EnergyFeastLockedIcon).prototype.resetState=function(){if(this.available=!1,-1!==cleverapps.missionManager.getProjectAvailableTypes().indexOf(Mission.TYPE_ENERGY_FEAST)){var e=Missions[Mission.TYPE_ENERGY_FEAST].available;cleverapps.user.checkAvailable(e,{future:!0})&&(cleverapps.user.checkAvailable(e)||(this.available=!0,this.setLocked(!0),this.setAttention(!1),this.setTitle(Messages.get("IconLocked.TextDefault",{levelNo:this.getTipData()}))))}},EnergyFeastLockedIcon.prototype.onPressed=function(){
this.removeFromSideBar(),cleverapps.metha.display({focus:"reloadMainScene",action:function(e){cleverapps.metha.gotoMainScene(e)}})},EnergyFeastLockedIcon.prototype.getTipData=function(){var e=Missions[Mission.TYPE_ENERGY_FEAST].available;return cleverapps.humanReadableNumber(e.episode,e.level)};var SlaveMissionWindow=Window.extend({onWindowLoaded:function(e){this.mission=e,this._super({name:this.getName(),title:"messages:"+this.getName()+".title",content:this.createContent(),adjustToContent:!0}),this.addPerson()},getName:function(){},createContent:function(){var e=cleverapps.styles.SlaveMissionWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=this.createDetails();s.setPositionRound(e.details),t.addChild(s);var i=cleverapps.UI.generateOnlyText("messages:"+this.getName()+".description",cleverapps.styles.FONTS.COINS_TIME_WINDOW_DESCRIPTION_TEXT);i.setPositionRound(e.description),i.setDimensions(e.description.width,0),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),
i.fitToHeight(e.description.height),t.addChild(i);var n=new cleverapps.UI.Button({text:"messages:OK",onClicked:this.close.bind(this),button_images:cleverapps.UI.Button.Images.button_green,styles:e.button});return n.setPositionRound(e.button),t.addChild(n),t},createDetails:function(){var e=cleverapps.styles.SlaveMissionWindow.details,t=cleverapps.UI.createScale9Sprite(this.getBgImg(),cleverapps.UI.Scale9Rect.TwoPixelXY);t.setContentSize2(e);var s=cleverapps.UI.generateOnlyText("messages:"+this.getName()+".details.text",cleverapps.styles.FONTS.COINS_TIME_WINDOW_TITLE_TEXT);s.setPositionRound(e.text),s.setDimensions(e.text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.fitToHeight(e.text.height),t.addChild(s);var i=this.createTimer();i.setPositionRound(e.timer),t.addChild(i);var n=this.getDetailsIcon();return n.setPositionRound(e.icon),t.addChild(n),t},getBgImg:function(){return bundles.mergeui.frames.details_background},getDetailsIcon:function(){},createTimer:function(){
var e=cleverapps.styles.SlaveMissionWindow.details.timer,t=new cc.Scale9Sprite(bundles.merge.frames.bar_bg_png);t.setContentSize2(e);var s=new cleverapps.CountDownView(new cleverapps.CountDown(this.mission.getTimeLeft()),{font:cleverapps.styles.FONTS.COINS_TIME_WINDOW_TIMER_TEXT});s.setPositionRound(e.countdown),t.addChild(s);var i=new cc.Sprite(bundles.mergeui.frames.timer_icon_large);return i.setPositionRound(e.icon),i.setScale(e.icon.scale),t.addChild(i),t},addPerson:function(){if(cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL){var e=this.getPersonAnimation(),t=e.getBoundingBox().height;e.y-=t,e.runAction(new cc.MoveBy(.4,0,t).easing(cc.easeBackOut()))}},getPersonAnimation:function(){var e=cleverapps.styles.SlaveMissionWindow.person,t=new cleverapps.Spine(bundles.dialogues.jsons.worker_json,cleverapps.styles.SlaveMissionWindow.person.scale);return t.setPositionRound(e),t.setAnimation(0,"idle",!0),this.addChild(t),t},listBundles:function(){return[]}})
;cleverapps.overrideFonts(cleverapps.styles.FONTS,{COINS_TIME_WINDOW_TITLE_TEXT:{size:60,lineHeight:66,color:cleverapps.styles.COLORS.YELLOW_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},COINS_TIME_WINDOW_TIMER_TEXT:{size:42,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR},COINS_TIME_WINDOW_DESCRIPTION_TEXT:{size:42,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR}}),cleverapps.styles.SlaveMissionWindow={width:1400,height:770,person:{x:{align:"center",dx:-880},y:{align:"bottom",dy:0},scale:1.4},description:{x:{align:"center"},y:{align:"bottom",dy:210},width:1280,height:120},button:{x:{align:"center"},y:{align:"bottom",dy:70},width:400,height:120},details:{x:{align:"center"},y:{align:"top",dy:-80},width:1300,height:340,text:{x:{align:"center",dx:165},y:{align:"center",dy:55},width:800,height:160},icon:{x:{align:"center",dx:-420},y:{align:"center",dy:10}},timer:{x:{align:"center",dx:175},y:{align:"center",dy:-70},
width:300,height:60,icon:{x:{align:"left",dx:-10},y:{align:"center"},scale:.6},countdown:{x:{align:"center",dx:25},y:{align:"center",dy:0}}}}};var CoinsTimeMissionWindow=SlaveMissionWindow.extend({getName:function(){return"CoinsTimeMissionWindow"},getDetailsIcon:function(){return new cc.Sprite(bundles.coins_time.frames.gold_and_hammer)},listBundles:function(){return["coins_time"]}}),EnergyTimeMissionWindow=SlaveMissionWindow.extend({getName:function(){return"EnergyTimeMissionWindow"},getBgImg:function(){return bundles.mergeui.frames.icon_background},getDetailsIcon:function(){return new cc.Sprite(bundles.energy_time.frames.energy)},getPersonAnimation:function(){var e=cleverapps.styles.EnergyTimeMissionWindow.person,t=new cleverapps.Spine(bundles.energy_time.jsons.jinn_json);return t.setScale(e.scale),t.setPositionRound(e),t.setAnimation(0,"special_offer",!0),this.addChild(t),t},listBundles:function(){return["energy_time"]}});cleverapps.styles.EnergyTimeMissionWindow={person:{scale:.8,
x:{align:"center",dx:-880},y:{align:"bottom",dy:-200}}};var RemoveUnitWindow=Window.extend({onWindowLoaded:function(e){this.unit=e,this._super({name:"RemoveUnitWindow",title:"messages:RemoveUnitWindow.title",adjustToContent:!0,closeButton:!0,content:this.createContent()}),cleverapps.audio.playSound(bundles.main.urls.window_effect)},createContent:function(){var e=cleverapps.styles.RemoveUnitWindow,t=this.createIcon();t.setAnchorPoint2();var s=cleverapps.UI.generateOnlyText("messages:RemoveUnitWindow.text",cleverapps.styles.FONTS.DARK_TEXT);s.setAnchorPoint2(),s.setDimensions(e.text.width,0),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var i=this.createButtons();return i.setAnchorPoint2(),new cleverapps.Layout([i,s,t],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},createIcon:function(){var e=cleverapps.styles.RemoveUnitWindow.icon,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=UnitView.getUnitStyles(this.unit),i=UnitView.getUnitImage(this.unit)
;cleverapps.UI.fitToBox(i,e.icon),i.setAnchorPoint2(s.anchorX,s.anchorY),i.setPositionRound(e.icon),t.addChild(i),i.clearTrack&&i.clearTrack(0);var n=new cc.Sprite(bundles.merge.frames.stand_ground);return n.setAnchorPoint2(),n.setPositionRound(e.ground),n.setLocalZOrder(-1),t.addChild(n),t},createButtons:function(){var e=cleverapps.styles.RemoveUnitWindow.buttons,t=new cleverapps.UI.Button({width:e.width,height:e.height,button_images:cleverapps.UI.Button.Images.button_red,font:cleverapps.styles.FONTS.LIGHT_BUTTON_TEXT,text:"messages:Yes",onClicked:function(){this.unit.onDestruction(),this.unit.remove(!0),this.close()}.bind(this)}),s=new cleverapps.UI.Button({width:e.width,height:e.height,button_images:cleverapps.UI.Button.Images.button_green,font:cleverapps.styles.FONTS.LIGHT_BUTTON_TEXT,text:"messages:No",onClicked:this.close.bind(this)});return new cleverapps.Layout([t,s],{direction:cleverapps.UI.HORIZONTAL,margin:e.margin})}});cleverapps.styles.RemoveUnitWindow={margin:50,padding:{
x:100,top:120,bottom:80},icon:{width:300,height:220,icon:{width:180,height:180,maxScale:1.7,x:{align:"center",dx:0},y:{align:"center",dy:-10}},ground:{x:{align:"center",dx:10},y:{align:"center",dy:-20}}},text:{width:1e3},buttons:{width:300,height:110,margin:40}};var SpecialEnergyOfferWindow=Window.extend({onWindowLoaded:function(){this._super({name:"SpecialEnergyOfferWindow",content:this.createContent(),noBackground:!0,adjustToContent:!0,closeButton:!0}),cleverapps.metha.showControlsWhileFocused(["MenuBarGoldItem","MenuBarLivesItem"]),this.addPerson()},createContent:function(){var e=cleverapps.styles.SpecialEnergyOfferWindow,t=new cc.Node;t.setAnchorPoint2(),t.setContentSize2(e);var s=new cleverapps.Spine(bundles.specialenergyofferwindow.jsons.jinn_lamp_json);s.setAnchorPoint2(),s.setPositionRound(e.animation),s.setAnimation(0,"animation",!0),t.addChild(s);var i=cleverapps.UI.generateOnlyText("messages:SpecialEnergyOfferWindow.title",
cleverapps.styles.FONTS.SPECIALENERGYOFFER_TITLE_TEXT);i.setAnchorPoint2(),i.setPositionRound(e.title),i.fitTo(e.title.width,void 0),t.addChild(i);var n=new UseGoldButton({button_images:cleverapps.UI.Button.Images.button_green,font:cleverapps.styles.FONTS.SPECIALENERGYOFFER_BUTTON_TEXT,image:bundles.reward_icons.frames.gold_small_png,price:SpecialEnergyOfferWindow.ENERGY_PRICE,onClicked:this.buyEnergy.bind(this),eventName:"buy_special_energy_ruby"},e.button);return n.setAnchorPoint2(),n.setPositionRound(e.button),t.addChild(n),s.setOpacity(0),s.runAction(new cc.FadeIn(.4)),i.setScale(0),i.runAction(new cc.Sequence(new cc.DelayTime(.15),new cc.ScaleTo(.2,1))),n.setScale(0),n.runAction(new cc.Sequence(new cc.DelayTime(.15),new cc.ScaleTo(.2,1))),t},addPerson:function(){var e=cleverapps.styles.SpecialEnergyOfferWindow.person,t=new cleverapps.Spine(bundles.specialenergyofferwindow.jsons.jinn_json);t.setAnimation(0,"special_offer",!0),t.setPositionRound(e.position),this.addChild(t),
t.setOpacity(0),t.setVisible(!1),t.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.Show,new cc.FadeIn(.4)))},buyEnergy:function(){cleverapps.lives.give(SpecialEnergyOfferWindow.ENERGY_AMOUNT),this.close()},listBundles:function(){return["specialenergyofferwindow"]}});SpecialEnergyOfferWindow.ENERGY_AMOUNT=330,SpecialEnergyOfferWindow.ENERGY_PRICE=200,cleverapps.overrideFonts(cleverapps.styles.FONTS,{SPECIALENERGYOFFER_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SPECIALENERGYOFFER_BUTTON_TEXT:{size:84,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.SpecialEnergyOfferWindow={width:1200,height:1200,animation:{x:{align:"center"},y:{align:"center",dy:70}},title:{x:{align:"center"},y:{align:"center",dy:425},width:1200},button:{
x:{align:"center"},y:{align:"center",dy:-440},width:300,height:120},person:{position:[{x:{align:"center",dx:-610},y:{align:"bottom",dy:-240}},{x:{align:"center",dx:-610},y:{align:"bottom",dy:-240}},{x:{align:"center",dx:-710},y:{align:"bottom",dy:-240}}]}};var MergeSubscriptionPrize=cc.Node.extend({ctor:function(){var e=cleverapps.styles.MergeSubscriptionPrize;this._super(),this.setAnchorPoint2(),this.setContentSize2(e);var t=new cleverapps.Spine(bundles.subscription_window.jsons.subscription_json);t.setAnchorPoint2(),t.setPositionRound(e.animation),t.setAnimation(0,"idle",!0),this.addChild(t);var s=cleverapps.UI.generateOnlyText("messages:SubscriptionWindow.Title",cleverapps.styles.FONTS.MERGE_SUBSCRIPTION_PRIZE_TITLE);s.setAnchorPoint2(),s.setPositionRound(e.title),s.fitTo(e.title.width,e.title.height),this.addChild(s);var i=cleverapps.UI.generateOnlyText("messages:MergeSubscriptionPrize.subtitle",cleverapps.styles.FONTS.MERGE_SUBSCRIPTION_PRIZE_SUBTITLE);i.setAnchorPoint2(),
i.setPositionRound(e.subtitle),i.fitTo(e.subtitle.width,e.subtitle.height),this.addChild(i);var n=cleverapps.subscription.calcReward();[[bundles.subscription_window.frames.subscription_worker_png,"1*","middle"],[bundles.subscription_window.frames.subscription_energy_png,n.energy,"left"],[bundles.subscription_window.frames.subscription_chest_png,n.unit.amount,"right"]].forEach(function(e){this.createReward.apply(this,e)},this)},createReward:function(e,t,s){var i=cleverapps.styles.MergeSubscriptionPrize.rewards,n=new cc.Sprite(e);n.setAnchorPoint2();var o=cleverapps.UI.createScale9Sprite(bundles.subscription_window.frames.subscription_amount_png,cleverapps.UI.Scale9Rect.TwoPixelXY);o.setAnchorPoint2(),o.setContentSize(i.amount);var r=cleverapps.UI.generateImageText("x"+t,cleverapps.styles.FONTS.MERGE_SUBSCRIPTION_PRIZE_AMOUNT);r.setAnchorPoint2(),r.setPositionRound(i.amount),o.addChild(r);var a=new cleverapps.Layout([n,o],{direction:cleverapps.UI.TOP_TO_BOTTOM,margin:i[s].margin})
;a.setAnchorPoint2(.5,0),a.setPositionRound(this.width/2+i[s].x,i[s].y),this.addChild(a)}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MERGE_SUBSCRIPTION_PRIZE_TITLE:{size:80,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},MERGE_SUBSCRIPTION_PRIZE_SUBTITLE:{size:48,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},MERGE_SUBSCRIPTION_PRIZE_AMOUNT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},MERGE_SUBSCRIPTION_PRIZE_CAPTION:{size:35,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.styles.MergeSubscriptionPrize={width:1200,height:800,animation:{x:{align:"center"},y:{align:"center",dy:-565}},title:{x:{align:"center"},y:{align:"center",dy:320},width:550,height:120},subtitle:{x:{align:"center"},y:{align:"center",dy:170},width:600,height:70},
rewards:{amount:{width:200,height:70,x:{align:"center"},y:{align:"center",dy:2}},left:{x:-300,y:4,margin:25},right:{x:300,y:4,margin:20},middle:{x:0,y:0,margin:-75}}};var MineSweeper=function(){BaseGame.call(this),this.width=MineSweeper.WIDTH,this.height=MineSweeper.HEIGHT,this.cellsToOpen=this.width*this.height-MineSweeper.CONFIG.b};MineSweeper.CONFIG={b:11,energy:14,coins:16,gold:2},MineSweeper.prototype=Object.create(BaseGame.prototype),(MineSweeper.prototype.constructor=MineSweeper).ELEMENT_OPENED=0,MineSweeper.ELEMENT_BOMB="b",MineSweeper.ELEMENT_OPENED_BOMB="bo",MineSweeper.ELEMENT_EXPLODED_BOMB="be",MineSweeper.ELEMENT_EMPTY="e",MineSweeper.ELEMENT_RUBY="gold",MineSweeper.ELEMENT_ENERGY="energy",MineSweeper.ELEMENT_COIN="coins",MineSweeper.WIDTH=8,MineSweeper.HEIGHT=7,MineSweeper.REPLAY_PRICE=20,MineSweeper.prototype.generateField=function(s,i){var e,t;this.reward={},this.board=[],this.bombs=[],this.prizes=[];var n=function(e,t){return Math.abs(e-i)<=1&&Math.abs(t-s)<=1},o=0
;for(e=0;e<this.height;e++)for(t=0;t<this.width;t++)n(e,t)&&o++;var r=function(e,t){var s=[];for(var i in e)for(var n=0;n<e[i];n++)s.length<t&&s.push(i);for(;s.length<t;)s.push(MineSweeper.ELEMENT_EMPTY);return cleverapps.Random.randomSeed(),s=cleverapps.Random.shuffle(s)}(MineSweeper.CONFIG,this.width*this.height-o);for(this.board=[],e=0;e<this.height;e++)for(this.board.push([]),t=0;t<this.width;t++)if(n(e,t))this.board[e].push(MineSweeper.ELEMENT_EMPTY);else{var a=r.pop();this.board[e].push(a),a===MineSweeper.ELEMENT_BOMB?this.bombs.push({col:t,row:e}):-1!==[MineSweeper.ELEMENT_RUBY,MineSweeper.ELEMENT_ENERGY,MineSweeper.ELEMENT_COIN].indexOf(a)&&this.prizes.push({col:t,row:e})}this.cellsToOpen=this.width*this.height-this.bombs.length,this.trigger("cellsToOpen",this.cellsToOpen)},MineSweeper.prototype.initFlags=function(){this.flags=[];for(var e=0;e<this.height;e++){this.flags.push([]);for(var t=0;t<this.width;t++)this.flags[e].push(!1)}},MineSweeper.prototype.hasElement=function(e,t
){return!(t<0||e<0||t>=this.height||e>=this.width)&&(!this.board||this.board[t][e]!==MineSweeper.ELEMENT_OPENED&&this.board[t][e]!==MineSweeper.ELEMENT_OPENED_BOMB&&this.board[t][e]!==MineSweeper.ELEMENT_EXPLODED_BOMB)},MineSweeper.prototype.getPrizeValue=function(e){return e===MineSweeper.ELEMENT_ENERGY?cleverapps.Random.random(3,5):e===MineSweeper.ELEMENT_COIN?cleverapps.Random.random(2,3):cleverapps.Random.random(1,2)},MineSweeper.prototype.openField=function(){this.trigger("openField");for(var e=0;e<this.height;e++)for(var t=0;t<this.width;t++)this.flags[e][t]&&(this.trigger("removeFlag",{row:e,col:t,silent:!0}),this.flags[e][t]=!1);this.prizes.forEach(function(e){this.board[e.row][e.col]!==MineSweeper.ELEMENT_OPENED&&this.trigger("showPrize",{col:e.col,row:e.row,prize:{type:this.board[e.row][e.col]}})}.bind(this)),this.bombs.forEach(function(e){this.board[e.row][e.col]!==MineSweeper.ELEMENT_OPENED_BOMB&&this.trigger("showBomb",{col:e.col,row:e.row})}.bind(this))},
MineSweeper.prototype.win=function(){this.board||this.generateField(0,0),this.flags||this.initFlags(),this.openField(),this.trigger("win"),this.finish(),setTimeout(function(){this.trigger("victory")}.bind(this),1e3)},MineSweeper.prototype.explode=function(e){cleverapps.audio.fadeOut(),this.board[e.row][e.col]=MineSweeper.ELEMENT_EXPLODED_BOMB,e.callback=function(){for(var e in this.reward){var t=Math.floor(this.reward[e]*(.3+.2*Math.random())),s=t-this.reward[e];this.reward[e]=t,this.trigger("explodePrize",{type:e,amount:s})}Game.currentMiniGame.reward=this.reward,this.openField(),this.trigger("lose")}.bind(this),this.trigger("bomb",e)},MineSweeper.prototype.switchFlag=function(e,t){t<0||e<0||t>=this.height||e>=this.width||(!this.board||this.board[t][e]!==MineSweeper.ELEMENT_OPENED&&this.board[t][e]!==MineSweeper.ELEMENT_OPENED_BOMB&&this.board[t][e]!==MineSweeper.ELEMENT_EXPLODED_BOMB)&&(this.flags||this.initFlags(),this.flags[t][e]?(this.trigger("removeFlag",{row:t,col:e}),
this.flags[t][e]=!1):(this.trigger("addFlag",{row:t,col:e}),this.flags[t][e]=!0))},MineSweeper.prototype.open=function(e,t){if(!(t<0||e<0||t>=this.height||e>=this.width||(this.board||this.generateField(e,t),this.board[t][e]===MineSweeper.ELEMENT_OPENED||this.board[t][e]===MineSweeper.ELEMENT_OPENED_BOMB||this.board[t][e]===MineSweeper.ELEMENT_EXPLODED_BOMB||(this.flags||this.initFlags(),this.flags[t][e])))){if(this.board[t][e]===MineSweeper.ELEMENT_BOMB)return this.board[t][e]=MineSweeper.ELEMENT_OPENED_BOMB,this.pause(),this.trigger("open",{row:t,col:e,bomb:!0}),void setTimeout(function(){this.trigger("askContinue",{row:t,col:e})}.bind(this),500);var s=this.board[t][e];this.board[t][e]=MineSweeper.ELEMENT_OPENED;var i=this.countBombsNearby(e,t),n={row:t,col:e,bombs:i};if(this.cellsToOpen--,this.trigger("cellsToOpen",this.cellsToOpen),this.trigger("open",n),i||(this.open(e-1,t-1),this.open(e,t-1),this.open(e+1,t-1),this.open(e-1,t),this.open(e+1,t),this.open(e-1,t+1),this.open(e,t+1),
this.open(e+1,t+1)),-1!==[MineSweeper.ELEMENT_RUBY,MineSweeper.ELEMENT_ENERGY,MineSweeper.ELEMENT_COIN].indexOf(s)){var o=this.getPrizeValue(s);this.trigger("prize",{col:e,row:t,prize:{type:s,amount:o}}),this.reward[s]=(this.reward[s]||0)+o}this.isFinished()&&this.win()}},MineSweeper.prototype.listNearby=function(e,t){for(var s=[],i=e-1;i<=e+1;i++)if(0<=i&&i<this.width)for(var n=t-1;n<=t+1;n++)0<=n&&n<this.height&&this.board[n][i]!==MineSweeper.ELEMENT_OPENED&&s.push({row:n,col:i});return s},MineSweeper.prototype.countBombsNearby=function(e,t){return this.listNearby(e,t).filter(function(e){return this.board[e.row][e.col]===MineSweeper.ELEMENT_BOMB||this.board[e.row][e.col]===MineSweeper.ELEMENT_OPENED_BOMB||this.board[e.row][e.col]===MineSweeper.ELEMENT_EXPLODED_BOMB}.bind(this)).length},MineSweeper.prototype.isFinished=function(){return 0===this.cellsToOpen};var MineGameScene=cleverapps.FixedWidthScene.extend({ctor:function(){this._super(cleverapps.Environment.SCENE_MINE),
this.mineGame=new MineSweeper,this.createCellsToOpen(),this.createGameNode(),this.createGuideButton(),this.background.animation.replaceParentSamePlace(this.scene,{keepScale:!0}),this.gameNode.bucket.replaceParentSamePlace(this.scene),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MINESWEEPER_START)},createGuideButton:function(){var e=cleverapps.styles.MineGameScene.guideButton,t=new cleverapps.UI.Button({button_png:bundles.minesweeper.frames.guide_button_png,button_on_png:bundles.minesweeper.frames.guide_button_on_png,onClicked:function(){cleverapps.metha.display({focus:"GuideMine",action:function(e){new MineGuideWindow,cleverapps.metha.onceNoWindowsListener=e}.bind(this)})}.bind(this)});t.baseScale=e.wideModeScales[cleverapps.wideMode.mode],t.setScale(t.baseScale),t.setPositionRound(e),this.scene.addChild(t),cleverapps.UI.makeHideable(t,cleverapps.UI.VERTICAL),cleverapps.metha.registerControl("guideButton",t)},createGameNode:function(){var e=cleverapps.styles.MineGameScene
;this.gameNode=new MineSweeperNode(this.mineGame),this.scene.addChild(this.gameNode),this.gameNode.setPositionRound(e.minigame),this.mineGame.on("win",this.gameFinish.bind(this),this),this.mineGame.on("lose",this.hideCellsToOpen.bind(this),this),this.mineGame.on("victory",this.hideCellsToOpen.bind(this),this),this.mineGame.on("askContinue",this.askContinue.bind(this),this),this.mineGame.on("cellsToOpen",this.cellsToOpenChange.bind(this),this)},hideCellsToOpen:function(){this.cellsToOpenProgress.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.RemoveSelf))},createCellsToOpen:function(){var e=cleverapps.styles.MineGameScene.cellsToOpen;this.cellsToOpenProgress=new ScaledProgressBar({progress:bundles.minesweeper.frames.progressbar}),this.cellsToOpenProgress.setAnchorPoint(0,.5),this.cellsToOpenProgress.setDimension(e.width,this.cellsToOpenProgress.height),this.cellsToOpenProgress.setPositionRound(e),this.scene.addChild(this.cellsToOpenProgress),
this.cellsToOpenProgress.setCascadeOpacityEnabled(!0),this.cellsToOpen=cleverapps.UI.generateImageText("0/"+this.mineGame.cellsToOpen,cleverapps.styles.FONTS.MINESWEEPER_PROGRESS),this.cellsToOpen.baseScale=this.cellsToOpen.scale,this.cellsToOpen.total=this.mineGame.cellsToOpen,this.cellsToOpen.setPositionRound(e.text),this.cellsToOpenProgress.addChild(this.cellsToOpen)},cellsToOpenChange:function(e){var t=Math.floor((this.cellsToOpen.total-e)/this.cellsToOpen.total*100);this.cellsToOpenProgress.animatedChange(t-this.cellsToOpenProgress.getPercentage()),this.cellsToOpen.setString(this.cellsToOpen.total-e+"/"+this.cellsToOpen.total),this.cellsToOpen.stopAllActions(),this.cellsToOpen.runAction(new cc.Sequence(new cc.ScaleTo(.15,1.3*this.cellsToOpen.baseScale),new cc.ScaleTo(.15,1*this.cellsToOpen.baseScale)))},askContinue:function(t){var s=!1;cleverapps.metha.display({focus:"loseMine",actions:[function(e){new MineContinueWindow({reward:this.mineGame.reward,callback:function(){s=!0}}),
cleverapps.metha.onceNoWindowsListener=e}.bind(this),function(e){s?(this.mineGame.resume(),e()):this.mineGame.explode(t)}.bind(this)]})},gameFinish:function(){cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MINESWEEPER_VICTORY),cleverapps.metha.display({focus:"VictoryMine",actions:[function(e){setTimeout(e,1e3)},function(e){new MineVictoryWindow({reward:this.mineGame.reward}),cleverapps.metha.onceNoWindowsListener=e}.bind(this)]})},getBackgroundStyles:function(){return{background:bundles.minesweeper.urls.background,animation:bundles.minesweeper.jsons.bg_json,scale:cleverapps.styles.MineGameScene.background.scale,parallax:!1}},getAudioStyles:function(){return{res:bundles.minesweeper.urls.mine_music,delay:1}},closeAction:function(){var s=this._super;cleverapps.metha.display({focus:"ConfirmMineExit",action:function(e){var t=!1;new ConfirmExitWindow({text:"messages:ConfirmExitWindow.text",reward:cleverapps.extend({gold:0,coins:0,energy:0},this.mineGame.reward),onAction:function(){t=!0}})
,cleverapps.metha.onceNoWindowsListener=function(){e(),t&&s()}.bind(this)}.bind(this)})}});MineGameScene.BUNDLES=function(){return["minesweeper"]},cleverapps.styles.MineGameScene={minigame:{x:{align:"center"},y:{align:"center",dy:-67}},guideButton:{x:{align:"left",dx:65},y:{align:"top",dy:-30},wideModeScales:[.5,.7,1]},cellsToOpen:{x:{align:"center",dx:4},y:{align:"bottom",dy:49},width:960,text:{x:{align:"center"},y:{align:"center",dy:1}}},background:{scale:1.14}};var MineSweeperNode=cc.Node.extend({ctor:function(e){this.game=e,this._super(),this.createFieldNode(),this.createScore(),this.createPerson(),this.createBucket(),this.game.on("open",this.open.bind(this),this),this.game.on("bomb",this.bomb.bind(this),this),this.game.on("prize",this.prize.bind(this),this),this.game.on("explodePrize",this.explodePrize.bind(this),this),this.game.on("openField",this.openField.bind(this),this),this.game.on("showBomb",this.showBomb.bind(this),this),this.game.on("removeFlag",this.removeFlag.bind(this)
,this),this.game.on("addFlag",this.addFlag.bind(this),this),this.game.on("showPrize",this.showPrize.bind(this),this),this.game.on("resumed",this.onContinue.bind(this),this),this.game.on("win",this.onWin.bind(this),this),this.game.on("victory",this.onVictory.bind(this),this),this.game.on("lose",this.onLose.bind(this),this),this.controls()},onVictory:function(){this.hideTopBlock(),this.hideFieldNode(),this.person&&this.person.runAction(new cc.Sequence(new cc.MoveBy(.2,cc.p(0,-this.person.height*this.person.scale)),new cc.RemoveSelf))},createBucket:function(){var e=cleverapps.styles.MineSweeperNode.bucket;this.bucket=new cc.Node,this.bucket.setLocalZOrder(10),this.bucket.setAnchorPoint2(),this.bucket.setContentSize2(e);var s,t=new cc.Sprite(bundles.minesweeper.frames.bucket_png);t.setScale(1.5),t.setPositionRound(e.image),this.bucket.addChild(t),this.bucket.setPositionRound(e),this.addChild(this.bucket),cleverapps.UI.onDrag(this.bucket,{dragMinDist:0,onTouchBegan:function(e){
this.game.running&&!this.game.paused&&(s=this.getFlyFlag()).runAction(new cc.MoveTo(.01,s.parent.convertTouchToNodeSpace(e)))}.bind(this),onDragMove:function(e){s&&s.parent&&(s.stopAllActions(),s.runAction(new cc.MoveTo(.01,s.parent.convertTouchToNodeSpace(e.touch))))}.bind(this),onDragEnd:function(e){if(s&&s.parent){var t=this.calculateIndex(e.touch);!(t&&this.game.hasElement(t.col,t.row)&&this.game.running)||this.game.paused||this.game.flags&&this.game.flags[t.row][t.col]?this.removeFlyFlag():this.game.switchFlag(t.col,t.row)}}.bind(this)}),cleverapps.UI.applyHover(this.bucket,{filter:function(){return this.game.running&&!this.game.paused}.bind(this)})},hideFieldNode:function(){this.fieldNode.runForAllChildren(function(e){e.setCascadeOpacityEnabled(!0)},{selfRun:!0}),this.fieldNode.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.RemoveSelf))},hideTopBlock:function(){this.topBlock.runAction(new cc.Sequence(new cc.FadeOut(.3),new cc.RemoveSelf))},onLose:function(){
var e=cleverapps.styles.MineSweeperNode,t=cleverapps.UI.generateOnlyText("messages:minesweeper.youLoseContinue",cleverapps.styles.FONTS.MINESWEEPER_TEXT_EXIT);t.setPositionRound(e.exitText),this.addChild(t),t.setOpacity(0),t.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.FadeIn(.3))),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(){this.exit||(this.exit=!0,cleverapps.metha.distract({focus:"backToMain",action:function(e){cleverapps.metha.gotoMainScene(e)}}))}.bind(this)},this)},onWin:function(){this.person&&this.person.setAnimation(0,"dialogue_smile",!0),cleverapps.audio.playSound(bundles.minesweeper.urls.victory_sfx)},removeFlag:function(e){var t=this.field[e.row][e.col];if(t.flag&&(t.flag.removeFromParent(),t.flag=void 0,!e.silent)){this.removeFlyFlag();var s=cleverapps.styles.MineSweeperNode.flag;this.getFlyFlag({pos:s.cell,parent:t}).replaceParentSamePlace(this.bucket),this.removeFlyFlag()}},getFlyFlag:function(e){
if(!this.flyFlag){var t=cleverapps.styles.MineSweeperNode.flag,s=(e=e||{}).pos||t.bucket,i=e.parent||this.bucket;this.flyFlag=new cc.Sprite(bundles.minesweeper.frames.flag_png),this.flyFlag.setScale(t.bucket.scale),i.addChild(this.flyFlag),this.flyFlag.setPositionRound(s)}return this.flyFlag},getFlyFlagTime:function(e){var t=this.getFlyFlag(),s=cc.pDistance(t.getPosition(),e)/cleverapps.styles.MineSweeperNode.flag.speed;return Math.max(s,.15)},removeFlyFlag:function(){if(this.flyFlag){var e=cleverapps.styles.MineSweeperNode.flag.bucket;this.flyFlag.runAction(new cc.Sequence(new cc.MoveTo(this.getFlyFlagTime(e),e),new cc.RemoveSelf)),this.flyFlag=void 0}},addFlag:function(e){var t=cleverapps.styles.MineSweeperNode.flag,s=this.field[e.row][e.col],i=this.getFlyFlag(),n=i.parent.convertToNodeSpace(s.convertToWorldSpace(t.cell)),o=this.getFlyFlagTime(n);i.runAction(new cc.Sequence(new cc.Spawn(new cc.MoveTo(o,n),new cc.ScaleTo(o,1)),new cc.RemoveSelf,new cc.CallFunc(function(){
this.game.flags[e.row][e.col]&&(s.flag=new cc.Sprite(bundles.minesweeper.frames.flag_png),s.addChild(s.flag),s.flag.setPositionRound(t.stableCell))}.bind(this)))),this.flyFlag=void 0},onContinue:function(){this.person&&this.person.setAnimationAndIdleAfter("dialogue_smile_short","idle"),cleverapps.audio.playSound(bundles.minesweeper.urls.buy_continue_sfx),cleverapps.audio.playSound(bundles.minesweeper.urls.miner_good_sfx)},controls:function(){cc.eventManager.addListener({event:cc.EventListener.MOUSE,onMouseDown:this.onMouseDown.bind(this),onMouseMove:this.onMouseMove.bind(this)},this.fieldNode),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchEnded:this.onTouchEnded.bind(this)},this.fieldNode)},calculateIndex:function(e){var t=this.fieldNode.convertTouchToNodeSpace(e),s=cc.rect(0,0,this.fieldNode.width,this.fieldNode.height);if(cc.rectContainsPoint(s,t)){var i=cleverapps.styles.MineSweeperNode.cell,
n=Math.floor(t.x/i.width),o=Math.floor(t.y/i.height);return{row:Math.max(Math.min(o,MineSweeper.HEIGHT-1),0),col:Math.max(Math.min(n,MineSweeper.WIDTH-1),0)}}},onMouseDown:function(e){this.rightMouseButton=!1,e.getButton()&&(this.rightMouseButton=!0)},onTouchBegan:function(e){return!(!this.game.running||this.game.paused)&&!!this.calculateIndex(e)},onTouchEnded:function(e){if(this.game.running&&!this.game.paused&&!this.hammerAnimation){var t=this.calculateIndex(e);if(t&&this.game.hasElement(t.col,t.row)){if(this.rightMouseButton||this.game.flags&&this.game.flags[t.row][t.col])return void this.game.switchFlag(t.col,t.row);var s=cleverapps.styles.MineSweeperNode.hammer;this.hammerAnimation=!0;var i=new cleverapps.Spine(bundles.minesweeper.jsons.custom_cursor_json,s.scale),n=this.field[t.row][t.col];i.setPositionRound(s),i.setLocalZOrder(10),n.getParent().addChild(i),i.replaceParentSamePlace(this.getParent()),i.setCompleteListener(function(){i.runAction(new cc.Sequence(new cc.ScaleTo(.15,0
),new cc.RemoveSelf))}),i.setAnimation(0,"animation",!1),this.runAction(new cc.Sequence(new cc.DelayTime(.35),new cc.CallFunc(function(){this.hammerAnimation=!1,this.game.open(t.col,t.row)}.bind(this))))}}},onMouseMove:function(e){if(this.game.running&&!this.game.paused){var t=this.calculateIndex(e),s=this.index;t&&this.game.hasElement(t.col,t.row)&&(void 0!==this.index&&100*t.row+t.col===100*this.index.row+this.index.col||(this.index=t,this.field[t.row][t.col].stopAllActions(),this.field[t.row][t.col].setScale(1.05))),s&&this.index!==s&&(this.field[s.row][s.col].stopAllActions(),this.field[s.row][s.col].runAction(new cc.ScaleTo(.15,1)))}},createFieldNode:function(){this.fieldNode=this.createField(),this.addChild(this.fieldNode),this.setAnchorPoint2(),this.setContentSize2(this.fieldNode.getContentSize()),this.fieldNode.setPositionRound(this.width/2,this.height/2)},createScore:function(){var n=cleverapps.styles.MineSweeperNode;this.scores={};var e=[MineSweeper.ELEMENT_RUBY,
MineSweeper.ELEMENT_ENERGY,MineSweeper.ELEMENT_COIN].map(function(e){var t=new cc.Sprite(this.getRewardIcon(e));t.setScale(n.topBlock.icon.scale);var s=cleverapps.UI.generateImageText("0",cleverapps.styles.FONTS.MINESWEEPER_TEXT_TOP);s.setLocalZOrder(1),s.baseScale=s.scale;var i=new cleverapps.Layout([s,t],{direction:cleverapps.UI.HORIZONTAL,margin:n.topBlock.scoreMargin});return i.rewardText=s,(this.scores[e]=i).setCascadeOpacityEnabled(!0),i},this),t=new cleverapps.Layout(e,{direction:cleverapps.UI.HORIZONTAL,margin:n.topBlock.betweenScores});t.setCascadeOpacityEnabled(!0);var s=cleverapps.UI.generateOnlyText("messages:minesweeper.prize",cleverapps.styles.FONTS.MINESWEEPER_TEXT_TOP),i=this.topBlock=new cleverapps.Layout([t,s],{direction:cleverapps.UI.VERTICAL,margin:n.topBlock.margin});this.addChild(i),i.setCascadeOpacityEnabled(!0),i.setPositionRound(n.topBlock)},createField:function(){var s=cleverapps.styles.MineSweeperNode;this.field=[];for(var e=0;e<this.game.height;e++){for(
var t=[],i=0;i<this.game.width;i++){var n=new cleverapps.Spine(bundles.minesweeper.jsons.minesweeper,s.cell.scale);n.setSkin((e+i)%2==0?"1":"2"),n.setAnimation(0,"idle",!0),t.push(n)}this.field.push(t)}var o=this.field.map(function(e){return new cleverapps.Layout(e.map(function(e){var t=new cc.Node;return t.setAnchorPoint2(),t.setContentSize2(s.cell.width,s.cell.height),e.setPositionRound(t.width/2,t.height/2),t.addChild(e),t}),{direction:cleverapps.UI.HORIZONTAL})});return new cleverapps.Layout(o,{direction:cleverapps.UI.VERTICAL})},openField:function(){for(var e=0;e<this.field.length;e++)for(var t=0;t<this.field[e].length;t++){var s=this.field[e][t];this.game.hasElement(t,e)&&s.setAnimation(1,"boom",!1)}},bomb:function(e){var t=this.field[e.row][e.col];t.setLocalZOrder(1),t.replaceParentSamePlace(this),t.bomb.removeFromParent(),t.setAnimation(2,"bomb",!1),cleverapps.audio.playSound(bundles.minesweeper.urls.pickaxe_sfx),t.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(
function(){this.person&&this.person.setAnimationAndIdleAfter("dialogue_fail1","dialogue_fail"),cleverapps.audio.playSound(bundles.minesweeper.urls.bomb_sfx)}.bind(this)),new cc.CallFunc(e.callback)))},showBomb:function(e){var t=this.field[e.row][e.col],s=t.bomb=new cleverapps.Spine(bundles.minesweeper.jsons.minesweeper);s.setLocalZOrder(t.getLocalZOrder()-1),t.getParent().addChild(s),s.setPositionRound(t.getPosition()),s.setAnimation(0,"bomb_idle",!1)},getRewardIcon:function(e){switch(e){case MineSweeper.ELEMENT_RUBY:return bundles.menubar.frames.coin_png;case MineSweeper.ELEMENT_ENERGY:return bundles.menubar.frames.life_png;case MineSweeper.ELEMENT_COIN:return bundles.menubar.frames.merge_coin_png}},createReward:function(e){var t=this.field[e.row][e.col],s=new cc.Sprite(this.getRewardIcon(e.prize.type));s.setScale(.9);var i=cleverapps.styles.MineSweeperNode,n=new cc.Node;return n.setAnchorPoint2(),n.setContentSize2(i.cell),n.addChild(s),s.setPositionRound(n.width/2,n.height/2),
n.setPositionRound(t.getPosition()),n.setCascadeOpacityEnabled(!0),n.setLocalZOrder(1),t.getParent().addChild(n),n},showPrize:function(e){this.createReward(e).runAction(new cc.Spawn(new cc.ScaleTo(1,1).easing(cc.easeBackOut()),new cc.FadeIn(1)))},explodePrize:function(e){this.updateRewardAmount(e);var i=cleverapps.styles.MineSweeperNode.explodePrize,t=function(e){var t={x:2*Math.random()*i.dx-i.dx,y:i.dy},s=.6+.3*Math.random();cleverapps.UI.jumpAnimation(e,t,{time:s,h:i.h+Math.random()*i.dh,spawn:new cc.Spawn(new cc.RotateBy(s,150+150*Math.random()),new cc.ScaleTo(s,1.4)),callback:function(){e.removeFromParent()}})},s=-e.amount;8<s&&(s=8);for(var n=0;n<s;n++){var o=new cc.Sprite(this.getRewardIcon(e.type));o.setScale(.9);var r=this.scores[e.type];r.getParent().addChild(o),o.setPosition(r.getPosition()),t(o)}},prize:function(e){var t=this.createReward(e),s=cleverapps.styles.MineSweeperNode.prize;cleverapps.UI.jumpCollectAnimation(t,{jump:{dist:{x:2*Math.random()*s.dx-s.dx,
y:-Math.random()*s.dy-3*s.dy}},collect:{speed:2600,target:this.scores[e.prize.type]},callback:function(){cleverapps.audio.playSound(bundles.minesweeper.urls.mine_vin_sfx),this.updateRewardAmount(e.prize)}.bind(this)})},createPerson:function(){if(cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL){var e=cleverapps.styles.MineSweeperNode.person,t=this.person=new cleverapps.Spine(bundles.dialogues.jsons.miner_json,e.scale);t.setAnchorPoint2(),t.setPositionRound(e),t.setAnimation(0,"idle",!0),t.setLocalZOrder(1),this.addChild(t)}},open:function(e){var t=this.field[e.row][e.col];if(t.setAnimation(1,"boom",!1),cleverapps.audio.playSound(bundles.minesweeper.urls.pickaxe_sfx),e.bombs){var s=cleverapps.UI.generateImageText(e.bombs,cleverapps.styles.FONTS.MINESWEEPER_BOMBS);s.setColor(cleverapps.styles.MineSweeperNode.bombs["color"+e.bombs]),s.setPositionRound(cleverapps.styles.MineSweeperNode.bombs),t.getParent().addChild(s)}e.bomb?(this.showBomb(e),
this.person&&this.person.setAnimationAndIdleAfter("dialogue_sad1","dialogue_sad"),cleverapps.audio.playSound(bundles.minesweeper.urls.miner_fail_sfx)):(this.person&&this.person.setAnimationAndIdleAfter("dialogue_smile_short","idle"),cleverapps.audio.playSound(bundles.minesweeper.urls.miner_good_sfx))},updateRewardAmount:function(e){this.rewardTimeouts||(this.rewardTimeouts={}),this.rewardTimeouts[e.type]||(this.rewardTimeouts[e.type]=0),this.rewardTimeouts[e.type]+=e.amount,this.scores[e.type].stopAllActions(),this.scores[e.type].runAction(new cc.Sequence(new cc.DelayTime(.15),new cc.CallFunc(function(e){this.scores[e].rewardText.setString(this.game.reward[e]),this.scores[e].rewardText.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.4*this.scores[e].rewardText.baseScale),new cc.ScaleTo(.25,1*this.scores[e].rewardText.baseScale)));var t=cleverapps.UI.animateDelta(this.rewardTimeouts[e],{});this.rewardTimeouts[e]=void 0,this.addChild(t),t.setPosition(t.getRelativeCoordinates(
this.scores[e].rewardText)),t.y+=cleverapps.styles.MineSweeperNode.prize.delta}.bind(this,e.type))))}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MINESWEEPER_BOMBS:{name:"default",size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINESWEEPER_TEXT_TOP:{name:"default",size:55,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINESWEEPER_PROGRESS:{name:"default",size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINESWEEPER_TEXT_EXIT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.MineSweeperNode={topBlock:{
margin:0,betweenScores:60,scoreMargin:17,x:{align:"center"},y:{align:"top",dy:240},icon:{scale:.7}},loseText:{x:{align:"center"},y:{align:"top",dy:200}},person:{scale:1.3,x:{align:"center",dx:-880},y:{align:"center",dy:-130}},prize:{dx:100,dy:50,margin:20,padding:0,delta:30},explodePrize:{dx:1e3,dy:-1500,h:1200,dh:400},reward:{amount:{x:{align:"center",dx:20},y:{align:"bottom",dy:0}}},hammer:{x:{align:"center"},y:{align:"center"},scale:1.2},bucket:{x:{align:"right",dx:270},y:{align:"bottom",dy:-210},width:250,height:300,image:{x:{align:"center",dx:30},y:{align:"center",dy:20}}},flag:{bucket:{x:150,y:230,scale:2},cell:{x:155,y:53},stableCell:{x:{align:"center"},y:{align:"center"}},speed:4e3},bombs:{x:{align:"center"},y:{align:"center",dy:-3},color1:new cc.Color(62,113,235,255),color2:new cc.Color(56,215,66,255),color3:new cc.Color(219,81,46,255),color4:new cc.Color(222,207,42,255),color5:new cc.Color(189,67,204,255),color6:new cc.Color(79,178,183,255),color7:new cc.Color(218,57,84,255),
color8:new cc.Color(100,49,221,255)},cell:{width:123,height:123,scale:1.22},exitText:{x:{align:"center"},y:{align:"bottom",dy:-125}}};var MineContinueWindow=Window.extend({onWindowLoaded:function(e){this.reward=cleverapps.extend({gold:0,coins:0,energy:0},e.reward),this.callback=e.callback,this._super({name:"minecontinuewindow",title:"messages:MineContinueWindow.title",content:this.createContent(),adjustToContent:!0,notCloseByTouchInShadow:!0}),this.addPerson()},addPerson:function(){if(cleverapps.wideMode.mode===cleverapps.WideMode.HORIZONTAL){var e=cleverapps.styles.MineContinueWindow.person,t=this.person=new cleverapps.Spine(bundles.dialogues.jsons.miner_json);t.setAnchorPoint2(),t.setPositionRound(e),t.setAnimation(0,"dialogue_sad",!0),t.setScale(e.scaleX,e.scaleY),t.setLocalZOrder(1),this.addChild(t);var s=t.height*e.scaleY;t.y-=s,t.runAction(new cc.MoveBy(.4,0,s).easing(cc.easeBackOut()))}},createContent:function(){var e=cleverapps.styles.MineContinueWindow,
t=cleverapps.UI.generateOnlyText("messages:MineContinueWindow.description",cleverapps.styles.FONTS.MINESWEEPERCONTINUE_TEXT);t.setAnchorPoint2(),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.setDimensions(e.details.width,0);var s=this.createRewards();s.setAnchorPoint2();var i=new cleverapps.Layout([s,t],{direction:cleverapps.UI.VERTICAL,margin:e.details.margin,padding:e.details.padding});i.setAnchorPoint2(),i.setPositionRound(i.width/2,i.height/2);var n=cleverapps.UI.createScale9Sprite(bundles.minesweeper.frames.details_background,cleverapps.UI.Scale9Rect.TwoPixelXY);n.setContentSize(i.width,i.height),n.setAnchorPoint2(),n.addChild(i);var o=this.createButtons();return o.setAnchorPoint2(),new cleverapps.Layout([o,n],{direction:cleverapps.UI.VERTICAL,margin:e.margin,padding:e.padding})},createRewards:function(){var e=cleverapps.styles.MineContinueWindow.rewards,t=new cc.Sprite(bundles.reward_icons.frames.reward_gold_png),s=new cc.Sprite(bundles.reward_icons.frames.reward_coin_png)
,i=new cc.Sprite(bundles.reward_icons.frames.reward_energy_png),n=cleverapps.UI.generateImageText("x"+this.reward.gold,cleverapps.styles.FONTS.MINESWEEPERCONTINUE_REWARDS_TEXT),o=cleverapps.UI.generateImageText("x"+this.reward.coins,cleverapps.styles.FONTS.MINESWEEPERCONTINUE_REWARDS_TEXT),r=cleverapps.UI.generateImageText("x"+this.reward.energy,cleverapps.styles.FONTS.MINESWEEPERCONTINUE_REWARDS_TEXT);return new cleverapps.GridLayout([t,s,i,n,o,r],{columns:3,direction:cleverapps.GridLayout.TOP_TO_BOTTOM,margin:e.margin,padding:e.padding})},createButtons:function(){var e=cleverapps.styles.MineContinueWindow.buttons,t=cleverapps.UI.generateOnlyText("messages:MineContinueWindow.continue.caption",cleverapps.styles.FONTS.DARK_TEXT);t.setDimensions(e.width,0),t.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER);var s=cleverapps.UI.generateOnlyText("messages:MineContinueWindow.giveup.caption",cleverapps.styles.FONTS.DARK_TEXT);s.setDimensions(e.width,0),s.setHorizontalAlignment(
cc.TEXT_ALIGNMENT_CENTER);var i=new UseGoldButton({price:MineSweeper.REPLAY_PRICE,image:bundles.reward_icons.frames.gold_small_png,font:cleverapps.styles.FONTS.MINESWEEPERCONTINUE_BUTTON_TEXT,button_images:cleverapps.UI.Button.Images.button_green,eventName:cleverapps.EVENTS.MINESWEEPER_CONTINUE_RUBY,onClicked:function(){this.callback(),this.close(),cleverapps.eventLogger.logEvent(cleverapps.EVENTS.MINESWEEPER_CONTINUE)}.bind(this)},{width:e.width,height:e.height}),n=new cleverapps.UI.Button({text:"messages:GiveUp",font:cleverapps.styles.FONTS.MINESWEEPERCONTINUE_BUTTON_TEXT,width:e.width,height:e.height,onClicked:this.close.bind(this),button_images:cleverapps.UI.Button.Images.button_red});return new cleverapps.GridLayout([t,s,i,n],{columns:2,direction:cleverapps.GridLayout.TOP_TO_BOTTOM,margin:e.margin,padding:e.padding})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MINESWEEPERCONTINUE_TEXT:{size:35,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,
stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINESWEEPERCONTINUE_REWARDS_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINESWEEPERCONTINUE_BUTTON_TEXT:{size:80,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.MineContinueWindow={margin:25,padding:{x:65,top:90,bottom:60},person:{scaleX:-1.4,scaleY:1.4,x:{align:"center",dx:800},y:{align:"center",dy:-330}},details:{width:760,margin:30,padding:{x:50,top:30,bottom:40}},rewards:{margin:{x:130,y:10}},buttons:{width:400,height:136,margin:{x:50,y:15},padding:{x:0,y:0}}};var MineVictoryWindow=Window.extend({onWindowLoaded:function(e){this.reward=e.reward,this._super({name:"minevictorywindow",content:this.createContent(),
noBackground:!0}),this.addPerson()},createContent:function(){var e=cleverapps.styles.MineVictoryWindow,t=new cleverapps.Spine(bundles.minesweeper.jsons.victory_animation,e.animation.scale);t.setAnchorPoint2(),t.setPositionRound(e.animation),t.setAnimationAndIdleAfter("emergence","idle");var s=new cc.Node;s.setAnchorPoint2(),s.setContentSize2(e.width,t.height*t.scaleY),s.addChild(t);var i=new RewardsListComponent(cleverapps.extend({gold:0,coins:0,energy:0},this.reward),{font:cleverapps.styles.FONTS.MINEVICTORY_REWARDS_TEXT,iconScale:e.rewards.scale,margin:e.rewards.margin});i.setAnchorPoint2(),i.setPositionRound(e.rewards),i.setScale(0),s.addChild(i),i.runAction(new cc.Sequence(new cc.DelayTime(.5),new cc.ScaleTo(.2,1)));var n=cleverapps.UI.generateOnlyText("messages:MineVictoryWindow.title",cleverapps.styles.FONTS.MINEVICTORY_TITLE_TEXT);return n.setAnchorPoint2(),n.setPositionRound(e.title),n.fitTo(e.title.width,e.title.height),n.setVisible(!1),n.setScale(.8),s.addChild(n),
n.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.Show,new cc.ScaleTo(.1,1.1),new cc.ScaleTo(.05,1))),this.addExitText(s),cleverapps.UI.onClick(s,this.close.bind(this)),s},addExitText:function(e){var t=cleverapps.UI.generateOnlyText("messages:minesweeper.youLoseContinue",cleverapps.styles.FONTS.MINESWEEPER_TEXT_EXIT);t.setPositionRound(cleverapps.styles.MineVictoryWindow.exitText),e.addChild(t),t.setOpacity(0),t.runAction(new cc.Sequence(new cc.DelayTime(.7),new cc.FadeIn(.3)))},addPerson:function(){var e=cleverapps.styles.MineVictoryWindow.person,t=this.person=new cleverapps.Spine(bundles.dialogues.jsons.miner_json);t.setAnchorPoint2(),t.setPositionRound(e),t.setAnimation(0,"dialogue_smile",!0),t.setScale(e.scaleX,e.scaleY),t.setLocalZOrder(1),this.addChild(t);var s=t.height*e.scaleY;t.y-=s,t.runAction(new cc.Sequence(new cc.DelayTime(.3),new cc.MoveBy(.4,0,s).easing(cc.easeBackOut())))},onClose:function(){Game.currentMiniGame.reward=this.reward,cleverapps.metha.distract({
focus:"backToMain",action:function(e){cleverapps.metha.gotoMainScene(e)}})}});cleverapps.overrideFonts(cleverapps.styles.FONTS,{MINEVICTORY_TITLE_TEXT:{size:70,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},MINEVICTORY_REWARDS_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW}}),cleverapps.styles.MineVictoryWindow={width:1e3,animation:{x:{align:"center"},y:{align:"center"},scale:1.3},rewards:{x:{align:"center",dx:-25},y:{align:"center",dy:235},margin:30,scale:1.4},title:{x:{align:"center",dx:-15},y:{align:"center",dy:580},width:400,height:100},person:{scaleX:-1.4,scaleY:1.4,x:{align:"center",dx:600},y:{align:"center",dy:-285}},exitText:{x:{align:"center",dx:0},y:{align:"bottom",dy:40}}};var MineGuideWindow=GuideWindow.extend({onWindowLoaded:function(e){
this._super(e,{name:"MineGuideWindow"})},getWindowTitle:function(e){return"messages:Units.dragonmine.stage1.name"},getUpperArrowStyle:function(){return cleverapps.styles.MineGuideWindow.upperArrow},createFirstStage:function(e){var t=cleverapps.styles.MineGuideWindow.firstStage,s=this.createStageBackgroundWithText(1,Messages.get("MineGuideWindow.firstStage")),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.guide_stage_1,t.image),s},createSecondStage:function(e){var t=cleverapps.styles.MineGuideWindow.secondStage,s=this.createStageBackgroundWithText(2,Messages.get("MineGuideWindow.secondStage")),i=this.addContainer(s,t.container);return this.addSprite(i,bundles.guidewindow.frames.guide_stage_2,t.image),s},createThirdStage:function(e){var t=cleverapps.styles.MineGuideWindow.thirdStage,s=this.createStageBackgroundWithText(3,Messages.get("MineGuideWindow.thirdStage")),i=this.addContainer(s,t.container);return this.addSprite(i,
bundles.guidewindow.frames.yellow_light,t.light),this.addSprite(i,bundles.guidewindow.frames.guide_prize,t.image),s}});cleverapps.styles.MineGuideWindow={upperArrow:{x:{align:"center"},y:{align:"center",dy:260}},firstStage:{container:{x:{align:"center"},y:{align:"center"}},image:{x:0,y:100,scale:.9}},secondStage:{container:{x:{align:"center"},y:{align:"center"}},image:{x:6,y:120,scale:.9}},thirdStage:{container:{x:{align:"center"},y:{align:"center"}},image:{x:15,y:100},light:{x:0,y:90}}},cleverapps.styles.UnitAnchors={wood:{stage1:{anchorX:.48,anchorY:.41},stage2:{anchorX:.5,anchorY:.44},stage3:{anchorX:.52,anchorY:.37},stage4:{anchorX:.54,anchorY:.35},stage5:{anchorY:.39},stage6:{anchorX:.52,anchorY:.24},stage7:{anchorY:.24},stage8:{anchorX:.47,anchorY:.15},stage9:{anchorY:.34},stage10:{anchorY:.34}},stone:{stage1:{anchorX:.5,anchorY:.4},stage2:{anchorX:.55,anchorY:.4},stage3:{anchorX:.46,anchorY:.35},stage4:{anchorY:.35},stage5:{anchorY:.32},stage6:{anchorY:.22},stage7:{anchorX:.54,
anchorY:.18},stage8:{anchorX:.41,anchorY:.16},stage9:{anchorX:.36,anchorY:.18},stage10:{anchorX:.49,anchorY:.32},stage11:{anchorX:.49,anchorY:.32}},wagon:{stage1:{anchorX:.5,anchorY:.38},stage2:{anchorX:.5,anchorY:.36},stage3:{anchorX:.46,anchorY:.32},stage4:{anchorY:.35},stage5:{anchorY:.32},stage6:{anchorY:.22},stage7:{anchorY:.22},stage8:{anchorY:.2},stage9:{anchorY:.22},stage10:{anchorX:.5,anchorY:.28},stage11:{anchorX:.5,anchorY:.28}},bamboo:{stage1:{anchorX:.5,anchorY:.38},stage2:{anchorX:.5,anchorY:.36},stage3:{anchorX:.46,anchorY:.32},stage4:{anchorY:.35},stage5:{anchorY:.32},stage6:{anchorY:.22},stage7:{anchorY:.22},stage8:{anchorY:.2},stage9:{anchorY:.22},stage10:{anchorX:.49,anchorY:.33},stage11:{anchorX:.49,anchorY:.33}},sapphire:{stage1:{anchorX:.48,anchorY:.36},stage2:{anchorX:.47,anchorY:.37},stage3:{anchorX:.42,anchorY:.37},stage4:{anchorX:.42,anchorY:.36},stage5:{anchorX:.46,anchorY:.33},stage6:{anchorX:.44,anchorY:.31},stage7:{anchorX:.47,anchorY:.29},stage8:{
anchorX:.43,anchorY:.25},stage9:{anchorX:.45,anchorY:.24},stage10:{anchorX:.44,anchorY:.23},stage11:{anchorX:.49,anchorY:.35},stage12:{anchorX:.49,anchorY:.35}},wheat:{stage1:{anchorX:.48,anchorY:.29},stage2:{anchorX:.49,anchorY:.32},stage3:{anchorX:.5,anchorY:.3},stage4:{anchorY:.32},stage5:{anchorX:.5,anchorY:.3},stage6:{anchorX:.51,anchorY:.36}},candies:{stage1:{anchorX:.48,anchorY:.44},stage2:{anchorX:.49,anchorY:.41},stage3:{anchorX:.49,anchorY:.4},stage4:{anchorY:.42},stage5:{anchorX:.46,anchorY:.34},stage6:{anchorX:.5,anchorY:.46}},apple:{stage1:{anchorX:.43,anchorY:.31},stage2:{anchorX:.49,anchorY:.31},stage3:{anchorY:.35},stage4:{anchorX:.5,anchorY:.34},stage5:{anchorX:.44,anchorY:.22},stage6:{anchorX:.5,anchorY:.4}},strawberry:{stage1:{anchorX:.46,anchorY:.4},stage2:{anchorX:.48,anchorY:.43},stage3:{anchorX:.5,anchorY:.41},stage4:{anchorX:.47,anchorY:.38},stage5:{anchorX:.47,anchorY:.3},stage6:{anchorX:.45,anchorY:.43}},mushrooms:{stage1:{anchorX:.5,anchorY:.41},stage2:{
anchorX:.5,anchorY:.37},stage3:{anchorX:.5,anchorY:.4},stage4:{anchorX:.5,anchorY:.33},stage5:{anchorX:.46,anchorY:.22},stage6:{anchorX:.5,anchorY:.42}},corn:{stage1:{anchorX:.46,anchorY:.4},stage2:{anchorX:.48,anchorY:.4},stage3:{anchorX:.5,anchorY:.4},stage4:{anchorX:.48,anchorY:.42},stage5:{anchorX:.47,anchorY:.33},stage6:{anchorX:.48,anchorY:.43}},treasure:{stage1:{anchorX:.42,anchorY:.39},stage2:{anchorX:.43,anchorY:.3},stage3:{anchorX:.45,anchorY:.28}},coinsplantchest:{stage1:{anchorX:.45,anchorY:.37},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.29}},energyplantchest:{stage1:{anchorX:.45,anchorY:.37},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.29}},rubiesplantchest:{stage1:{anchorX:.45,anchorY:.37},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.29}},herochest:{stage1:{anchorX:.48,anchorY:.34}},freechest:{stage1:{anchorX:.48,anchorY:.31}},sacks:{stage1:{anchorY:.22},stage2:{anchorX:.46,anchorY:.22},stage3:{anchorX:.42,anchorY:.22}
},woodchest:{stage1:{anchorX:.46,anchorY:.36},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.28}},stonechest:{stage1:{anchorX:.46,anchorY:.36},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.3}},wagonchest:{stage1:{anchorX:.48,anchorY:.36},stage2:{anchorX:.46,anchorY:.32},stage3:{anchorX:.48,anchorY:.28}},bamboochest:{stage1:{anchorX:.54,anchorY:.36},stage2:{anchorX:.54,anchorY:.34},stage3:{anchorX:.54,anchorY:.29}},sapphirechest:{stage1:{anchorX:.46,anchorY:.36},stage2:{anchorX:.48,anchorY:.32},stage3:{anchorX:.47,anchorY:.32}},wands:{stage1:{anchorY:.2},stage2:{anchorY:.22},stage3:{anchorY:.2},stage4:{anchorX:.6,anchorY:.2},stage5:{anchorY:.2},stage6:{anchorY:.2}},coins:{stage1:{anchorX:.46,anchorY:.42},stage2:{anchorX:.4,anchorY:.38},stage3:{anchorX:.44,anchorY:.32},stage4:{anchorX:.41,anchorY:.28},stage5:{anchorX:.44,anchorY:.28},stage6:{anchorX:.5,anchorY:.31},stage7:{anchorX:.5,anchorY:.31},stage8:{anchorX:.5,anchorY:.31}},rubies:{stage1:{anchorX:.44,
anchorY:.36},stage2:{anchorX:.44,anchorY:.43},stage3:{anchorY:.4},stage4:{anchorX:.48,anchorY:.37},stage5:{anchorX:.38,anchorY:.34},stage6:{anchorX:.43,anchorY:.34}},worker:{stage1:{anchorX:.49,anchorY:.46},stage2:{anchorX:.46,anchorY:.47},stage3:{anchorX:.47,anchorY:.4},stage4:{anchorX:.54,anchorY:.33},stage5:{anchorX:.53,anchorY:.2}},crystal:{stage1:{anchorX:.46,anchorY:.32},stage2:{anchorX:.46,anchorY:.3},stage3:{anchorX:.46,anchorY:.24},stage4:{anchorX:.47,anchorY:.22}},woodsource:{stage1:{anchorX:.47,anchorY:.2},stage2:{anchorY:.25},stage3:{anchorX:.44,anchorY:.22},stage4:{anchorX:.46,anchorY:.26},stage5:{anchorY:.25},stage6:{anchorX:.52,anchorY:.26}},stonesource:{stage1:{anchorY:.3},stage2:{anchorY:.4},stage3:{anchorY:.2},stage4:{anchorY:.32},stage5:{anchorY:.22},stage6:{anchorY:.28}},wagonsource:{stage1:{anchorX:.5,anchorY:.2},stage2:{anchorX:.5,anchorY:.2},stage3:{anchorX:.49,anchorY:.22},stage4:{anchorX:.49,anchorY:.35},stage5:{anchorX:.48,anchorY:.23},stage6:{anchorX:.51,
anchorY:.34}},bamboosource:{stage1:{anchorY:.25},stage2:{anchorX:.55,anchorY:.17},stage3:{anchorY:.26},stage4:{anchorY:.24},stage5:{anchorY:.25},stage6:{anchorY:.3}},sapphiresource:{stage1:{anchorX:.49,anchorY:.22},stage2:{anchorX:.53,anchorY:.26},stage3:{anchorY:.24},stage4:{anchorX:.48,anchorY:.25},stage5:{anchorY:.21},stage6:{anchorX:.49,anchorY:.27}},woodgenerator:{stage1:{anchorX:.42,anchorY:.22},stage2:{anchorX:.52,anchorY:.14},stage3:{anchorX:.42,anchorY:.2}},stonegenerator:{stage1:{anchorX:.5,anchorY:.24},stage2:{anchorX:.49,anchorY:.27},stage3:{anchorX:.48,anchorY:.24}},wagongenerator:{stage1:{anchorX:.48,anchorY:.25},stage2:{anchorX:.5,anchorY:.17},stage3:{anchorX:.51,anchorY:.18}},bamboogenerator:{stage1:{anchorX:.43,anchorY:.17},stage2:{anchorX:.53,anchorY:.16},stage3:{anchorX:.48,anchorY:.19}},sapphiregenerator:{stage1:{anchorX:.56,anchorY:.15},stage2:{anchorX:.53,anchorY:.23},stage3:{anchorX:.48,anchorY:.17}},dwarf:{stage1:{anchorX:.43,anchorY:.35},stage2:{anchorY:.25}},
king:{stage4:{anchorY:.15}},bear:{stage1:{anchorX:.45,anchorY:.34},stage2:{anchorX:.49,anchorY:.36},stage3:{anchorX:.48,anchorY:.37},stage4:{anchorX:.46,anchorY:.35},stage5:{anchorX:.44,anchorY:.28},stage6:{anchorX:.42,anchorY:.28},stage7:{anchorY:.25}},elf:{stage1:{anchorX:.44,anchorY:.3},stage2:{anchorX:.48,anchorY:.3},stage3:{anchorX:.44,anchorY:.28},stage4:{anchorX:.42,anchorY:.29},stage5:{anchorX:.37,anchorY:.28},stage6:{anchorX:.41,anchorY:.27},stage7:{anchorX:.4,anchorY:.24},stage8:{anchorX:.5,anchorY:.16}},warlock:{stage1:{anchorX:.48,anchorY:.38},stage2:{anchorX:.51,anchorY:.38},stage3:{anchorX:.48,anchorY:.38},stage4:{anchorX:.44,anchorY:.37},stage5:{anchorX:.44,anchorY:.35},stage6:{anchorX:.43,anchorY:.32},stage7:{anchorX:.41,anchorY:.3},stage8:{anchorX:.39,anchorY:.29},stage9:{anchorX:.53,anchorY:.16}},troll:{stage1:{anchorX:.5,anchorY:.4},stage2:{anchorX:.5,anchorY:.4},stage3:{anchorX:.5,anchorY:.35},stage4:{anchorX:.5,anchorY:.33},stage5:{anchorX:.5,anchorY:.3},stage6:{
anchorX:.48,anchorY:.31},stage7:{anchorX:.48,anchorY:.31},stage8:{anchorX:.47,anchorY:.3},stage9:{anchorX:.42,anchorY:.26},stage10:{anchorX:.56,anchorY:.18}},knight:{stage1:{anchorX:.39,anchorY:.35},stage2:{anchorX:.39,anchorY:.32},stage3:{anchorX:.39,anchorY:.32},stage4:{anchorX:.43,anchorY:.33},stage5:{anchorX:.41,anchorY:.28},stage6:{anchorX:.41,anchorY:.28},stage7:{anchorX:.42,anchorY:.29},stage8:{anchorX:.41,anchorY:.28},stage9:{anchorX:.36,anchorY:.25},stage10:{anchorX:.37,anchorY:.25},stage11:{anchorX:.5,anchorY:.13}},dragonmine:{stage1:{anchorX:.52,anchorY:.27}},decorator:{stage1:{anchorX:.46,anchorY:.37}},rubiesplant:{stage1:{anchorY:.22},stage2:{anchorX:.47,anchorY:.19},stage3:{anchorX:.51,anchorY:.17}},coinsplant:{stage1:{anchorX:.47,anchorY:.19},stage2:{anchorX:.48,anchorY:.2},stage3:{anchorX:.42,anchorY:.23}},energyplant:{stage1:{anchorX:.46,anchorY:.22},stage2:{anchorX:.53,anchorY:.23},stage3:{anchorX:.55,anchorY:.25}},magicplant:{stage1:{anchorX:.47,anchorY:.52},stage2:{
anchorX:.5,anchorY:.38},stage3:{anchorX:.51,anchorY:.35},stage4:{anchorX:.46,anchorY:.24},stage5:{anchorX:.45,anchorY:.23},stage6:{anchorX:.5,anchorY:.16},stage7:{anchorX:.45,anchorY:.22},stage8:{anchorX:.5,anchorY:.21},stage9:{anchorX:.54,anchorY:.2}}},cleverapps.styles.UnitAnimations={worker:{stage5:{idle:1e3,idle1:100,idle2:100}},dwarf:{stage2:{animation:100,animation2:100,idle:800}},king:{stage4:{animation:800,animation2:100,animation3:100}},bear:{stage7:{animation1:100,animation2:100,idle:800}},elf:{stage8:{animation:100,animation2:100,idle:800}},warlock:{stage9:{animation:100,animation2:100,idle:800}},troll:{stage10:{animation:100,animation2:100,idle:800}},knight:{stage11:{animation:100,idle:900}},wands:{stage1:{animation:100,animation2:50,animation3:50,idle:3600},stage2:{animation:100,idle:1800},stage3:{animation:100,idle:1800},stage4:{animation:100,idle:1800},stage5:{animation:100,idle:1800},stage6:{idle:1e3}},woodgenerator:{stage1:{animation:100,idle:1e3},stage2:{
animation:100,idle:1e3},stage3:{animation:100,idle:1e3}},stonegenerator:{stage1:{animation:100,idle:1e3},stage2:{animation:100,idle:1e3},stage3:{animation:100,idle:1e3}},wagongenerator:{stage1:{animation:100,idle:1e3},stage2:{animation:100,idle:1e3},stage3:{animation:100,idle:1e3}},bamboogenerator:{stage1:{animation:100,idle:1e3},stage2:{animation:100,idle:1e3},stage3:{animation:100,idle:1e3}},sapphiregenerator:{stage1:{animation:100,idle:1e3},stage2:{animation:100,idle:1e3},stage3:{animation:100,idle:1e3}}},cleverapps.styles.SCENE_MAX_WIDTH=3900,cleverapps.styles.HORIZONTAL_MODE_WIDTH=2e3,cleverapps.styles.COLORS=cleverapps.overrideColors(cleverapps.styles.COLORS,{TITLE_COLOR_YELLOW:new cc.Color(134,56,10,255),TITLE_SHADOW:new cc.Color(255,251,126,255)}),cleverapps.styles.DECORATORS=cleverapps.overrideStyles(cleverapps.styles.DECORATORS,{WHITE_TEXT_STROKE:{color:cleverapps.styles.COLORS.BLACK,size:2},TITLE_TEXT_SHADOW:{color:cleverapps.styles.COLORS.TITLE_SHADOW,direction:cc.size(0,-2
),blur:1}}),cleverapps.overrideFonts(cleverapps.styles.FONTS,{DIALOGUE_PERSON_TITLE_TEXT:{size:44,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},STARTER_PACK_REWARD:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SHOP_USER_GOLD_TEXT:{name:"nostroke"},ROW_PLAYER_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},ROW_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_TITLE_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},BATTLEPASS_TIMER_TEXT:{size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,
stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_PROGRESS_TEXT:{size:38,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_PROGRESS_IMAGE_TEXT:{size:42,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_TICKET_TEXT:{size:45,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_TICKET_SMALL_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_BUTTON_TEXT:{size:60,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,
stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},BATTLEPASS_DESCRIPTION_TEXT:{size:50,color:cleverapps.styles.COLORS.DARK_TEXT_COLOR},BATTLEPASS_REWARD_TEXT:{size:68,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.LIGHT_TEXT_STROKE,shadow:cleverapps.styles.DECORATORS.LIGHT_TEXT_SHADOW},SUBSCRIPTION_BUTTON_ADDITIONAL_TEXT:{size:30,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIPTION_BUTTON_TITLE:{size:22,color:cleverapps.styles.COLORS.LIGHT_TEXT_DISABLED_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIPTION_MAIN_TEXT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIPTION_REWARD_READY_TEXT:{size:40,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},SUBSCRIPTION_TIMER_TEXT:{size:40,
color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},TERMS_LINK_TEXT:{size:26,color:cleverapps.styles.COLORS.LIGHT_TEXT_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE},TERMS_TEXT:{size:22,color:cleverapps.styles.COLORS.LIGHT_TEXT_DISABLED_COLOR,stroke:cleverapps.styles.DECORATORS.IMAGE_FONT_STROKE}}),cleverapps.overrideStyles(cleverapps.styles.GameScene,{startAnimation:{scale:1}}),cleverapps.overrideStyles(cleverapps.styles.NewVersionWindow,{button:{width:220,height:90}}),cleverapps.overrideStyles(cleverapps.styles.RestartWindow,{button:{width:220,height:90}}),cleverapps.overrideStyles(cleverapps.styles.ReloadWindow,{padding:{x:0,y:80},Button:{width:220,height:90}}),cleverapps.overrideStyles(cleverapps.styles.BandButton,{width:120,height:266,position:{x:{align:"right",dx:-80},y:{align:"top",dy:40}},icon:{x:{align:"center"},y:{align:"bottom",dy:35}}}),cleverapps.overrideStyles(cleverapps.styles.LoadingScene,{
showMessageOnRewrite:!0,barBg:{y:120,scale9:{width:1e3,height:41,padding:100}},bar:{x:0,y:0,scale9:{width:1e3,height:41,minWidth:30,padding:100}},message:{x:0,y:50}}),cleverapps.overrideStyles(cleverapps.styles.SceneControlButtonsView,{position:{x:{align:"right",dx:-78},y:{align:"top",dy:-33}}}),cleverapps.overrideStyles(cleverapps.styles.SceneControlButton,{scale:[.5,.7,1]}),cleverapps.styles.CommonButtons={width:200,height:74,contentOffset:{x:0,y:0},fitTo:!1,margin:4,padding:{left:20,right:20,top:5,bottom:10}},cleverapps.overrideStyles(cleverapps.styles.SideBarSlot,{padding:{top:380,horizontal:110},wideModeScales:[.7,.9,1],margin:50}),cleverapps.overrideStyles(cleverapps.styles.PackWindow,{width:440,height:900,animation:{default:{idleDelay:-.7,dx:0,dy:50},starterPack0:{idleAnimation:"0_idle",introAnimation:"0_start"},starterPack:{idleAnimation:"1_idle",introAnimation:"1_start"},starterPack2:{idleAnimation:"2_idle",introAnimation:"2_start"}},rewards:{
font:cleverapps.styles.FONTS.STARTER_PACK_REWARD,fontSize:50,delay:1.5,duration:.675,fitTo:{width:166},positions:{default:{gold:{x:144,y:-48},energy:{x:-126,y:-48},wands:{x:-256,y:15},coins:{x:10,y:18},worker:{x:-190,y:266}},starterPack:{gold:{x:215,y:270},energy:{x:300,y:12}},starterPack2:{gold:{x:214,y:270},energy:{x:258,y:-90},wands:{x:-210,y:-90},worker:{x:-196,y:266}}}},heroAnimation:{json:bundles.dialogues.jsons.king_json,animation:"dialogue_smile",scale:1.6,position:[{x:{align:"center",dx:-510},y:{align:"bottom",dy:70}},{x:{align:"center",dx:-510},y:{align:"bottom",dy:70}},{x:{align:"left",dx:240},y:{align:"bottom",dy:70}}]}}),cleverapps.overrideStyles(cleverapps.styles.RewardWindow,{rewards:{padding:{y:80},dy:20}}),cleverapps.overrideStyles(cleverapps.styles.MinimalDialogue,{person:{offsetX:-80,offsetY:0},maxWidth:1500,text:{arrow:void 0,padding:{fromWallX:100,verticalX:0,x:90,y:80},bg:{offsetX:5,offsetY:-8,padding:{x:40,y:28}}}}),cleverapps.overrideStyles(
cleverapps.styles.DialogueView,{widthPadding:8,positions:{bottom:{y:30}},text:{padding:{fromWallX:50,x:50,y:50},arrow:{img:bundles.dialogues.frames.arrow_png,y:{align:"top",dy:23},offsetX:"relative"}},persons:{default:{animation:"dialogue",idleAnimation:"idle",styles:{width:550,height:500,jsonPos:{x:{align:"center"},y:{align:"center"}}}}}}),cleverapps.overrideStyles(cleverapps.styles.DialoguePersonTitleView,{y:{align:"top",dy:0},text:{padding:{x:30,y:1},offset:{y:-1}}}),cleverapps.overrideStyles(cleverapps.styles.DialoguePersonView,{mobileScale:1,scale:1}),cleverapps.overrideStyles(cleverapps.styles.DialogueView,{persons:{worker:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{title:"messages:Dialogue.person.worker",json:bundles.dialogues.jsons.worker_json,minimalJson:bundles.dialogues_minimal.jsons.worker_minimal_json,offsetY:-60}},!0),dwarf:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{
title:"messages:Dialogue.person.dwarf",json:bundles.dialogues.jsons.dwarf_json,minimalJson:bundles.dialogues_minimal.jsons.dwarf_minimal_json,offsetY:-80}},!0),king:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{width:700,title:"messages:Dialogue.person.king",json:bundles.dialogues.jsons.king_json,minimalJson:bundles.dialogues_minimal.jsons.king_minimal_json,offsetY:-60}},!0),bear:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{width:700,title:"messages:Dialogue.person.bear",json:bundles.dialogues.jsons.bear_json,minimalJson:bundles.dialogues_minimal.jsons.bear_minimal_json,offsetX:85,offsetY:10}},!0),elf:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{title:"messages:Dialogue.person.elf",json:bundles.dialogues.jsons.elf_json,minimalJson:bundles.dialogues_minimal.jsons.elf_minimal_json,offsetX:0,offsetY:40}},!0),warlock:cleverapps.overrideStyles(
cleverapps.styles.DialogueView.persons.default,{styles:{title:"messages:Dialogue.person.warlock",json:bundles.dialogues.jsons.warlock_json,minimalJson:bundles.dialogues_minimal.jsons.warlock_minimal_json,offsetX:0,offsetY:-20}},!0),troll:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{title:"messages:Dialogue.person.troll",json:bundles.dialogues.jsons.troll_json,minimalJson:bundles.dialogues_minimal.jsons.troll_minimal_json,offsetY:-45}},!0),knight:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.default,{styles:{title:"messages:Dialogue.person.knight",json:bundles.dialogues.jsons.knight_json,minimalJson:bundles.dialogues_minimal.jsons.knight_minimal_json,offsetX:60,offsetY:-20}},!0)}}),cleverapps.overrideStyles(cleverapps.styles.DialogueView,{persons:{worker_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.worker,{position:"right"},!0),dwarf_right:cleverapps.overrideStyles(
cleverapps.styles.DialogueView.persons.dwarf,{position:"right"},!0),king_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.king,{position:"right"},!0),bear_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.bear,{position:"right"},!0),elf_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.elf,{position:"right"},!0),warlock_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.warlock,{position:"right"},!0),troll_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.troll,{position:"right"},!0),knight_right:cleverapps.overrideStyles(cleverapps.styles.DialogueView.persons.knight,{position:"right"},!0)}}),cleverapps.overrideStyles(cleverapps.styles.ShadowView,{opacity:150}),cleverapps.extend(cleverapps.UI.Button.Images,{button_blue:{button_png:bundles.buttons.frames.blue_button_png,button_on_png:bundles.buttons.frames.blue_button_on_png,
button_off_png:bundles.buttons.frames.window_button_disabled_png},small_button_blue:{button_png:bundles.buttons.frames.small_blue_button,button_on_png:bundles.buttons.frames.small_blue_button_on,button_off_png:bundles.buttons.frames.small_blue_button},button_green:{button_png:bundles.buttons.frames.window_button_png,button_on_png:bundles.buttons.frames.window_button_on_png,button_off_png:bundles.buttons.frames.window_button_disabled_png},button_red:{button_png:bundles.buttons_main.frames.red_button,button_on_png:bundles.buttons_main.frames.red_button_on,button_off_png:bundles.buttons_main.frames.window_button_disabled_png}}),cleverapps.overrideStyles(cleverapps.styles.GiftContentView,{width:640,minHeight:160}),cleverapps.overrideStyles(cleverapps.styles.TransitionAnimation,{loading:!1}),cleverapps.overrideStyles(cleverapps.styles.ShopUserGoldView,{person:!1,bg:!1,items:{gold:{scale:.55,dy:-3}}}),cleverapps.overrideStyles(cleverapps.styles.SmallTileButton,{contentOffset:{x:0,y:2}}),
cleverapps.overrideStyles(cleverapps.styles.LargeTileButton,{contentOffset:{x:0,y:2}}),cleverapps.overrideStyles(cleverapps.styles.ProductPriceView,{regularFontOffsetY:-4}),cleverapps.overrideStyles(cleverapps.styles.ConfirmExitWindow,{width:700,animation:!1,text:{y:{align:"center",dy:50},width:700}}),cleverapps.overrideStyles(cleverapps.styles.Row,{size:{width:760,height:82},placeBadges:{x:0,y:2},place:{x:85,y:4},avatar:{position:{x:164,y:3}},text:{x:370,y:2,width:300},reward:{x:556,y:0},prizes:[{banner:void 0,icon:bundles.merge.frames.first_place_prize_png,scale:.6,y:6},{banner:void 0,icon:bundles.merge.frames.second_place_prize_png,scale:.6,y:6},{banner:void 0,icon:bundles.merge.frames.third_place_prize_png,scale:.75,y:6}],data:{size:{width:140,height:60},position:{x:672,y:3},amount:{x:99,y:2,width:75}}}),cleverapps.overrideStyles(cleverapps.styles.SubscriptionWindow,{window:{adjustToWindow:!0,noBackground:!0,Title:void 0,Border:{}},contentPadding:{x:0,y:0,bottom:100,isTop:void 0},
animation:{person:void 0}}),cleverapps.overrideStyles(cleverapps.styles.SubscriptionButtons,{align:cleverapps.UI.ALIGN_START,buttonWidth:410,buttonHeight:120,buttonsMargin:40}),cleverapps.overrideStyles(cleverapps.styles.SubscriptionInfo,{padding:{x:0,y:10},timer:{width:290,height:54,textYShift:1,textXShift:36,icon:{x:{align:"left"},y:{align:"center"}}}}),"undefined"!=typeof mobileOkReturned&&mobileOkReturned||(cc.game.onStart=function(){cleverapps.onStart()},cc.game.run());
//# sourceMappingURL=main-a51c0ac845.js.map
}.call(this));